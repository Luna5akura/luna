(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))c(d);new MutationObserver(d=>{for(const $ of d)if($.type==="childList")for(const g of $.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&c(g)}).observe(document,{childList:!0,subtree:!0});function o(d){const $={};return d.integrity&&($.integrity=d.integrity),d.referrerPolicy&&($.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?$.credentials="include":d.crossOrigin==="anonymous"?$.credentials="omit":$.credentials="same-origin",$}function c(d){if(d.ep)return;d.ep=!0;const $=o(d);fetch(d.href,$)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(e.__esModule)return e;var a=e.default;if(typeof a=="function"){var o=function c(){return this instanceof c?Reflect.construct(a,arguments,this.constructor):a.apply(this,arguments)};o.prototype=a.prototype}else o={};return Object.defineProperty(o,"__esModule",{value:!0}),Object.keys(e).forEach(function(c){var d=Object.getOwnPropertyDescriptor(e,c);Object.defineProperty(o,c,d.get?d:{enumerable:!0,get:function(){return e[c]}})}),o}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$3=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r$1=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$1=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1(e){return e===null||typeof e!="object"?null:(e=z$1&&e[z$1]||e["@@iterator"],typeof e=="function"?e:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$2={};function E$1(e,a,o){this.props=e,this.context=a,this.refs=D$2,this.updater=o||B$1}E$1.prototype.isReactComponent={};E$1.prototype.setState=function(e,a){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,a,"setState")};E$1.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function F(){}F.prototype=E$1.prototype;function G$1(e,a,o){this.props=e,this.context=a,this.refs=D$2,this.updater=o||B$1}var H$1=G$1.prototype=new F;H$1.constructor=G$1;C$1(H$1,E$1.prototype);H$1.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$1(e,a,o){var c,d={},$=null,g=null;if(a!=null)for(c in a.ref!==void 0&&(g=a.ref),a.key!==void 0&&($=""+a.key),a)J.call(a,c)&&!L$1.hasOwnProperty(c)&&(d[c]=a[c]);var b=arguments.length-2;if(b===1)d.children=o;else if(1<b){for(var _=Array(b),j=0;j<b;j++)_[j]=arguments[j+2];d.children=_}if(e&&e.defaultProps)for(c in b=e.defaultProps,b)d[c]===void 0&&(d[c]=b[c]);return{$$typeof:l$1,type:e,key:$,ref:g,props:d,_owner:K$1.current}}function N$1(e,a){return{$$typeof:l$1,type:e.type,key:a,ref:e.ref,props:e.props,_owner:e._owner}}function O$1(e){return typeof e=="object"&&e!==null&&e.$$typeof===l$1}function escape$1(e){var a={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(o){return a[o]})}var P$1=/\/+/g;function Q$1(e,a){return typeof e=="object"&&e!==null&&e.key!=null?escape$1(""+e.key):a.toString(36)}function R$1(e,a,o,c,d){var $=typeof e;($==="undefined"||$==="boolean")&&(e=null);var g=!1;if(e===null)g=!0;else switch($){case"string":case"number":g=!0;break;case"object":switch(e.$$typeof){case l$1:case n$1:g=!0}}if(g)return g=e,d=d(g),e=c===""?"."+Q$1(g,0):c,I$1(d)?(o="",e!=null&&(o=e.replace(P$1,"$&/")+"/"),R$1(d,a,o,"",function(j){return j})):d!=null&&(O$1(d)&&(d=N$1(d,o+(!d.key||g&&g.key===d.key?"":(""+d.key).replace(P$1,"$&/")+"/")+e)),a.push(d)),1;if(g=0,c=c===""?".":c+":",I$1(e))for(var b=0;b<e.length;b++){$=e[b];var _=c+Q$1($,b);g+=R$1($,a,o,_,d)}else if(_=A$1(e),typeof _=="function")for(e=_.call(e),b=0;!($=e.next()).done;)$=$.value,_=c+Q$1($,b++),g+=R$1($,a,o,_,d);else if($==="object")throw a=String(e),Error("Objects are not valid as a React child (found: "+(a==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":a)+"). If you meant to render a collection of children, use an array instead.");return g}function S$2(e,a,o){if(e==null)return e;var c=[],d=0;return R$1(e,c,"","",function($){return a.call(o,$,d++)}),c}function T$2(e){if(e._status===-1){var a=e._result;a=a(),a.then(function(o){(e._status===0||e._status===-1)&&(e._status=1,e._result=o)},function(o){(e._status===0||e._status===-1)&&(e._status=2,e._result=o)}),e._status===-1&&(e._status=0,e._result=a)}if(e._status===1)return e._result.default;throw e._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};function X$2(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$2,forEach:function(e,a,o){S$2(e,function(){a.apply(this,arguments)},o)},count:function(e){var a=0;return S$2(e,function(){a++}),a},toArray:function(e){return S$2(e,function(a){return a})||[]},only:function(e){if(!O$1(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};react_production_min.Component=E$1;react_production_min.Fragment=p$3;react_production_min.Profiler=r$1;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$1;react_production_min.Suspense=w;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.act=X$2;react_production_min.cloneElement=function(e,a,o){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var c=C$1({},e.props),d=e.key,$=e.ref,g=e._owner;if(a!=null){if(a.ref!==void 0&&($=a.ref,g=K$1.current),a.key!==void 0&&(d=""+a.key),e.type&&e.type.defaultProps)var b=e.type.defaultProps;for(_ in a)J.call(a,_)&&!L$1.hasOwnProperty(_)&&(c[_]=a[_]===void 0&&b!==void 0?b[_]:a[_])}var _=arguments.length-2;if(_===1)c.children=o;else if(1<_){b=Array(_);for(var j=0;j<_;j++)b[j]=arguments[j+2];c.children=b}return{$$typeof:l$1,type:e.type,key:d,ref:$,props:c,_owner:g}};react_production_min.createContext=function(e){return e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:t,_context:e},e.Consumer=e};react_production_min.createElement=M$1;react_production_min.createFactory=function(e){var a=M$1.bind(null,e);return a.type=e,a};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(e){return{$$typeof:v$1,render:e}};react_production_min.isValidElement=O$1;react_production_min.lazy=function(e){return{$$typeof:y,_payload:{_status:-1,_result:e},_init:T$2}};react_production_min.memo=function(e,a){return{$$typeof:x,type:e,compare:a===void 0?null:a}};react_production_min.startTransition=function(e){var a=V$1.transition;V$1.transition={};try{e()}finally{V$1.transition=a}};react_production_min.unstable_act=X$2;react_production_min.useCallback=function(e,a){return U$1.current.useCallback(e,a)};react_production_min.useContext=function(e){return U$1.current.useContext(e)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(e){return U$1.current.useDeferredValue(e)};react_production_min.useEffect=function(e,a){return U$1.current.useEffect(e,a)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function(e,a,o){return U$1.current.useImperativeHandle(e,a,o)};react_production_min.useInsertionEffect=function(e,a){return U$1.current.useInsertionEffect(e,a)};react_production_min.useLayoutEffect=function(e,a){return U$1.current.useLayoutEffect(e,a)};react_production_min.useMemo=function(e,a){return U$1.current.useMemo(e,a)};react_production_min.useReducer=function(e,a,o){return U$1.current.useReducer(e,a,o)};react_production_min.useRef=function(e){return U$1.current.useRef(e)};react_production_min.useState=function(e){return U$1.current.useState(e)};react_production_min.useSyncExternalStore=function(e,a,o){return U$1.current.useSyncExternalStore(e,a,o)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;const React=getDefaultExportFromCjs(reactExports);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$2={key:!0,ref:!0,__self:!0,__source:!0};function q(e,a,o){var c,d={},$=null,g=null;o!==void 0&&($=""+o),a.key!==void 0&&($=""+a.key),a.ref!==void 0&&(g=a.ref);for(c in a)m$1.call(a,c)&&!p$2.hasOwnProperty(c)&&(d[c]=a[c]);if(e&&e.defaultProps)for(c in a=e.defaultProps,a)d[c]===void 0&&(d[c]=a[c]);return{$$typeof:k,type:e,key:$,ref:g,props:d,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,client={},reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function a(Et,At){var dt=Et.length;Et.push(At);e:for(;0<dt;){var Mt=dt-1>>>1,It=Et[Mt];if(0<d(It,At))Et[Mt]=At,Et[dt]=It,dt=Mt;else break e}}function o(Et){return Et.length===0?null:Et[0]}function c(Et){if(Et.length===0)return null;var At=Et[0],dt=Et.pop();if(dt!==At){Et[0]=dt;e:for(var Mt=0,It=Et.length,$t=It>>>1;Mt<$t;){var Lt=2*(Mt+1)-1,Ot=Et[Lt],Vt=Lt+1,Ht=Et[Vt];if(0>d(Ot,dt))Vt<It&&0>d(Ht,Ot)?(Et[Mt]=Ht,Et[Vt]=dt,Mt=Vt):(Et[Mt]=Ot,Et[Lt]=dt,Mt=Lt);else if(Vt<It&&0>d(Ht,dt))Et[Mt]=Ht,Et[Vt]=dt,Mt=Vt;else break e}}return At}function d(Et,At){var dt=Et.sortIndex-At.sortIndex;return dt!==0?dt:Et.id-At.id}if(typeof performance=="object"&&typeof performance.now=="function"){var $=performance;e.unstable_now=function(){return $.now()}}else{var g=Date,b=g.now();e.unstable_now=function(){return g.now()-b}}var _=[],j=[],_e=1,et=null,tt=3,nt=!1,at=!1,lt=!1,mt=typeof setTimeout=="function"?setTimeout:null,ot=typeof clearTimeout=="function"?clearTimeout:null,st=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ut(Et){for(var At=o(j);At!==null;){if(At.callback===null)c(j);else if(At.startTime<=Et)c(j),At.sortIndex=At.expirationTime,a(_,At);else break;At=o(j)}}function pt(Et){if(lt=!1,ut(Et),!at)if(o(_)!==null)at=!0,zt(gt);else{var At=o(j);At!==null&&Nt(pt,At.startTime-Et)}}function gt(Et,At){at=!1,lt&&(lt=!1,ot(_t),_t=-1),nt=!0;var dt=tt;try{for(ut(At),et=o(_);et!==null&&(!(et.expirationTime>At)||Et&&!Tt());){var Mt=et.callback;if(typeof Mt=="function"){et.callback=null,tt=et.priorityLevel;var It=Mt(et.expirationTime<=At);At=e.unstable_now(),typeof It=="function"?et.callback=It:et===o(_)&&c(_),ut(At)}else c(_);et=o(_)}if(et!==null)var $t=!0;else{var Lt=o(j);Lt!==null&&Nt(pt,Lt.startTime-At),$t=!1}return $t}finally{et=null,tt=dt,nt=!1}}var ft=!1,yt=null,_t=-1,vt=5,Pt=-1;function Tt(){return!(e.unstable_now()-Pt<vt)}function St(){if(yt!==null){var Et=e.unstable_now();Pt=Et;var At=!0;try{At=yt(!0,Et)}finally{At?qt():(ft=!1,yt=null)}}else ft=!1}var qt;if(typeof st=="function")qt=function(){st(St)};else if(typeof MessageChannel<"u"){var Ft=new MessageChannel,Dt=Ft.port2;Ft.port1.onmessage=St,qt=function(){Dt.postMessage(null)}}else qt=function(){mt(St,0)};function zt(Et){yt=Et,ft||(ft=!0,qt())}function Nt(Et,At){_t=mt(function(){Et(e.unstable_now())},At)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Et){Et.callback=null},e.unstable_continueExecution=function(){at||nt||(at=!0,zt(gt))},e.unstable_forceFrameRate=function(Et){0>Et||125<Et?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):vt=0<Et?Math.floor(1e3/Et):5},e.unstable_getCurrentPriorityLevel=function(){return tt},e.unstable_getFirstCallbackNode=function(){return o(_)},e.unstable_next=function(Et){switch(tt){case 1:case 2:case 3:var At=3;break;default:At=tt}var dt=tt;tt=At;try{return Et()}finally{tt=dt}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Et,At){switch(Et){case 1:case 2:case 3:case 4:case 5:break;default:Et=3}var dt=tt;tt=Et;try{return At()}finally{tt=dt}},e.unstable_scheduleCallback=function(Et,At,dt){var Mt=e.unstable_now();switch(typeof dt=="object"&&dt!==null?(dt=dt.delay,dt=typeof dt=="number"&&0<dt?Mt+dt:Mt):dt=Mt,Et){case 1:var It=-1;break;case 2:It=250;break;case 5:It=1073741823;break;case 4:It=1e4;break;default:It=5e3}return It=dt+It,Et={id:_e++,callback:At,priorityLevel:Et,startTime:dt,expirationTime:It,sortIndex:-1},dt>Mt?(Et.sortIndex=dt,a(j,Et),o(_)===null&&Et===o(j)&&(lt?(ot(_t),_t=-1):lt=!0,Nt(pt,dt-Mt))):(Et.sortIndex=It,a(_,Et),at||nt||(at=!0,zt(gt))),Et},e.unstable_shouldYield=Tt,e.unstable_wrapCallback=function(Et){var At=tt;return function(){var dt=tt;tt=At;try{return Et.apply(this,arguments)}finally{tt=dt}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p$1(e){for(var a="https://reactjs.org/docs/error-decoder.html?invariant="+e,o=1;o<arguments.length;o++)a+="&args[]="+encodeURIComponent(arguments[o]);return"Minified React error #"+e+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(e,a){ha(e,a),ha(e+"Capture",a)}function ha(e,a){for(ea[e]=a,e=0;e<a.length;e++)da.add(a[e])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(e){return ja.call(ma,e)?!0:ja.call(la,e)?!1:ka.test(e)?ma[e]=!0:(la[e]=!0,!1)}function pa(e,a,o,c){if(o!==null&&o.type===0)return!1;switch(typeof a){case"function":case"symbol":return!0;case"boolean":return c?!1:o!==null?!o.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function qa(e,a,o,c){if(a===null||typeof a>"u"||pa(e,a,o,c))return!0;if(c)return!1;if(o!==null)switch(o.type){case 3:return!a;case 4:return a===!1;case 5:return isNaN(a);case 6:return isNaN(a)||1>a}return!1}function v(e,a,o,c,d,$,g){this.acceptsBooleans=a===2||a===3||a===4,this.attributeName=c,this.attributeNamespace=d,this.mustUseProperty=o,this.propertyName=e,this.type=a,this.sanitizeURL=$,this.removeEmptyString=g}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){z[e]=new v(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var a=e[0];z[a]=new v(a,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){z[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){z[e]=new v(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){z[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){z[e]=new v(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){z[e]=new v(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){z[e]=new v(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){z[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var a=e.replace(ra,sa);z[a]=new v(a,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var a=e.replace(ra,sa);z[a]=new v(a,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var a=e.replace(ra,sa);z[a]=new v(a,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){z[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)});z.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){z[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)});function ta(e,a,o,c){var d=z.hasOwnProperty(a)?z[a]:null;(d!==null?d.type!==0:c||!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(qa(a,o,d,c)&&(o=null),c||d===null?oa(a)&&(o===null?e.removeAttribute(a):e.setAttribute(a,""+o)):d.mustUseProperty?e[d.propertyName]=o===null?d.type===3?!1:"":o:(a=d.attributeName,c=d.attributeNamespace,o===null?e.removeAttribute(a):(d=d.type,o=d===3||d===4&&o===!0?"":""+o,c?e.setAttributeNS(c,a,o):e.setAttribute(a,o))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(e){return e===null||typeof e!="object"?null:(e=Ja&&e[Ja]||e["@@iterator"],typeof e=="function"?e:null)}var A=Object.assign,La;function Ma(e){if(La===void 0)try{throw Error()}catch(o){var a=o.stack.trim().match(/\n( *(at )?)/);La=a&&a[1]||""}return`
`+La+e}var Na=!1;function Oa(e,a){if(!e||Na)return"";Na=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(a)if(a=function(){throw Error()},Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(a,[])}catch(j){var c=j}Reflect.construct(e,[],a)}else{try{a.call()}catch(j){c=j}e.call(a.prototype)}else{try{throw Error()}catch(j){c=j}e()}}catch(j){if(j&&c&&typeof j.stack=="string"){for(var d=j.stack.split(`
`),$=c.stack.split(`
`),g=d.length-1,b=$.length-1;1<=g&&0<=b&&d[g]!==$[b];)b--;for(;1<=g&&0<=b;g--,b--)if(d[g]!==$[b]){if(g!==1||b!==1)do if(g--,b--,0>b||d[g]!==$[b]){var _=`
`+d[g].replace(" at new "," at ");return e.displayName&&_.includes("<anonymous>")&&(_=_.replace("<anonymous>",e.displayName)),_}while(1<=g&&0<=b);break}}}finally{Na=!1,Error.prepareStackTrace=o}return(e=e?e.displayName||e.name:"")?Ma(e):""}function Pa(e){switch(e.tag){case 5:return Ma(e.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return e=Oa(e.type,!1),e;case 11:return e=Oa(e.type.render,!1),e;case 1:return e=Oa(e.type,!0),e;default:return""}}function Qa(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Ca:return(e.displayName||"Context")+".Consumer";case Ba:return(e._context.displayName||"Context")+".Provider";case Da:var a=e.render;return e=e.displayName,e||(e=a.displayName||a.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Ga:return a=e.displayName||null,a!==null?a:Qa(e.type)||"Memo";case Ha:a=e._payload,e=e._init;try{return Qa(e(a))}catch{}}return null}function Ra(e){var a=e.type;switch(e.tag){case 24:return"Cache";case 9:return(a.displayName||"Context")+".Consumer";case 10:return(a._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=a.render,e=e.displayName||e.name||"",a.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return a;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(a);case 8:return a===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a}return null}function Sa(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Ta(e){var a=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Ua(e){var a=Ta(e)?"checked":"value",o=Object.getOwnPropertyDescriptor(e.constructor.prototype,a),c=""+e[a];if(!e.hasOwnProperty(a)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var d=o.get,$=o.set;return Object.defineProperty(e,a,{configurable:!0,get:function(){return d.call(this)},set:function(g){c=""+g,$.call(this,g)}}),Object.defineProperty(e,a,{enumerable:o.enumerable}),{getValue:function(){return c},setValue:function(g){c=""+g},stopTracking:function(){e._valueTracker=null,delete e[a]}}}}function Va(e){e._valueTracker||(e._valueTracker=Ua(e))}function Wa(e){if(!e)return!1;var a=e._valueTracker;if(!a)return!0;var o=a.getValue(),c="";return e&&(c=Ta(e)?e.checked?"true":"false":e.value),e=c,e!==o?(a.setValue(e),!0):!1}function Xa(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Ya(e,a){var o=a.checked;return A({},a,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:o??e._wrapperState.initialChecked})}function Za(e,a){var o=a.defaultValue==null?"":a.defaultValue,c=a.checked!=null?a.checked:a.defaultChecked;o=Sa(a.value!=null?a.value:o),e._wrapperState={initialChecked:c,initialValue:o,controlled:a.type==="checkbox"||a.type==="radio"?a.checked!=null:a.value!=null}}function ab(e,a){a=a.checked,a!=null&&ta(e,"checked",a,!1)}function bb(e,a){ab(e,a);var o=Sa(a.value),c=a.type;if(o!=null)c==="number"?(o===0&&e.value===""||e.value!=o)&&(e.value=""+o):e.value!==""+o&&(e.value=""+o);else if(c==="submit"||c==="reset"){e.removeAttribute("value");return}a.hasOwnProperty("value")?cb(e,a.type,o):a.hasOwnProperty("defaultValue")&&cb(e,a.type,Sa(a.defaultValue)),a.checked==null&&a.defaultChecked!=null&&(e.defaultChecked=!!a.defaultChecked)}function db(e,a,o){if(a.hasOwnProperty("value")||a.hasOwnProperty("defaultValue")){var c=a.type;if(!(c!=="submit"&&c!=="reset"||a.value!==void 0&&a.value!==null))return;a=""+e._wrapperState.initialValue,o||a===e.value||(e.value=a),e.defaultValue=a}o=e.name,o!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,o!==""&&(e.name=o)}function cb(e,a,o){(a!=="number"||Xa(e.ownerDocument)!==e)&&(o==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+o&&(e.defaultValue=""+o))}var eb=Array.isArray;function fb(e,a,o,c){if(e=e.options,a){a={};for(var d=0;d<o.length;d++)a["$"+o[d]]=!0;for(o=0;o<e.length;o++)d=a.hasOwnProperty("$"+e[o].value),e[o].selected!==d&&(e[o].selected=d),d&&c&&(e[o].defaultSelected=!0)}else{for(o=""+Sa(o),a=null,d=0;d<e.length;d++){if(e[d].value===o){e[d].selected=!0,c&&(e[d].defaultSelected=!0);return}a!==null||e[d].disabled||(a=e[d])}a!==null&&(a.selected=!0)}}function gb(e,a){if(a.dangerouslySetInnerHTML!=null)throw Error(p$1(91));return A({},a,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function hb(e,a){var o=a.value;if(o==null){if(o=a.children,a=a.defaultValue,o!=null){if(a!=null)throw Error(p$1(92));if(eb(o)){if(1<o.length)throw Error(p$1(93));o=o[0]}a=o}a==null&&(a=""),o=a}e._wrapperState={initialValue:Sa(o)}}function ib(e,a){var o=Sa(a.value),c=Sa(a.defaultValue);o!=null&&(o=""+o,o!==e.value&&(e.value=o),a.defaultValue==null&&e.defaultValue!==o&&(e.defaultValue=o)),c!=null&&(e.defaultValue=""+c)}function jb(e){var a=e.textContent;a===e._wrapperState.initialValue&&a!==""&&a!==null&&(e.value=a)}function kb(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(e,a){return e==null||e==="http://www.w3.org/1999/xhtml"?kb(a):e==="http://www.w3.org/2000/svg"&&a==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var mb,nb=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(a,o,c,d){MSApp.execUnsafeLocalFunction(function(){return e(a,o,c,d)})}:e}(function(e,a){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=a;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+a.valueOf().toString()+"</svg>",a=mb.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;a.firstChild;)e.appendChild(a.firstChild)}});function ob(e,a){if(a){var o=e.firstChild;if(o&&o===e.lastChild&&o.nodeType===3){o.nodeValue=a;return}}e.textContent=a}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(e){qb.forEach(function(a){a=a+e.charAt(0).toUpperCase()+e.substring(1),pb[a]=pb[e]})});function rb(e,a,o){return a==null||typeof a=="boolean"||a===""?"":o||typeof a!="number"||a===0||pb.hasOwnProperty(e)&&pb[e]?(""+a).trim():a+"px"}function sb(e,a){e=e.style;for(var o in a)if(a.hasOwnProperty(o)){var c=o.indexOf("--")===0,d=rb(o,a[o],c);o==="float"&&(o="cssFloat"),c?e.setProperty(o,d):e[o]=d}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(e,a){if(a){if(tb[e]&&(a.children!=null||a.dangerouslySetInnerHTML!=null))throw Error(p$1(137,e));if(a.dangerouslySetInnerHTML!=null){if(a.children!=null)throw Error(p$1(60));if(typeof a.dangerouslySetInnerHTML!="object"||!("__html"in a.dangerouslySetInnerHTML))throw Error(p$1(61))}if(a.style!=null&&typeof a.style!="object")throw Error(p$1(62))}}function vb(e,a){if(e.indexOf("-")===-1)return typeof a.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var yb=null,zb=null,Ab=null;function Bb(e){if(e=Cb(e)){if(typeof yb!="function")throw Error(p$1(280));var a=e.stateNode;a&&(a=Db(a),yb(e.stateNode,e.type,a))}}function Eb(e){zb?Ab?Ab.push(e):Ab=[e]:zb=e}function Fb(){if(zb){var e=zb,a=Ab;if(Ab=zb=null,Bb(e),a)for(e=0;e<a.length;e++)Bb(a[e])}}function Gb(e,a){return e(a)}function Hb(){}var Ib=!1;function Jb(e,a,o){if(Ib)return e(a,o);Ib=!0;try{return Gb(e,a,o)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(e,a){var o=e.stateNode;if(o===null)return null;var c=Db(o);if(c===null)return null;o=c[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(e=e.type,c=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!c;break e;default:e=!1}if(e)return null;if(o&&typeof o!="function")throw Error(p$1(231,a,typeof o));return o}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(e,a,o,c,d,$,g,b,_){var j=Array.prototype.slice.call(arguments,3);try{a.apply(o,j)}catch(_e){this.onError(_e)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(e){Ob=!0,Pb=e}};function Tb(e,a,o,c,d,$,g,b,_){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(e,a,o,c,d,$,g,b,_){if(Tb.apply(this,arguments),Ob){if(Ob){var j=Pb;Ob=!1,Pb=null}else throw Error(p$1(198));Qb||(Qb=!0,Rb=j)}}function Vb(e){var a=e,o=e;if(e.alternate)for(;a.return;)a=a.return;else{e=a;do a=e,a.flags&4098&&(o=a.return),e=a.return;while(e)}return a.tag===3?o:null}function Wb(e){if(e.tag===13){var a=e.memoizedState;if(a===null&&(e=e.alternate,e!==null&&(a=e.memoizedState)),a!==null)return a.dehydrated}return null}function Xb(e){if(Vb(e)!==e)throw Error(p$1(188))}function Yb(e){var a=e.alternate;if(!a){if(a=Vb(e),a===null)throw Error(p$1(188));return a!==e?null:e}for(var o=e,c=a;;){var d=o.return;if(d===null)break;var $=d.alternate;if($===null){if(c=d.return,c!==null){o=c;continue}break}if(d.child===$.child){for($=d.child;$;){if($===o)return Xb(d),e;if($===c)return Xb(d),a;$=$.sibling}throw Error(p$1(188))}if(o.return!==c.return)o=d,c=$;else{for(var g=!1,b=d.child;b;){if(b===o){g=!0,o=d,c=$;break}if(b===c){g=!0,c=d,o=$;break}b=b.sibling}if(!g){for(b=$.child;b;){if(b===o){g=!0,o=$,c=d;break}if(b===c){g=!0,c=$,o=d;break}b=b.sibling}if(!g)throw Error(p$1(189))}}if(o.alternate!==c)throw Error(p$1(190))}if(o.tag!==3)throw Error(p$1(188));return o.stateNode.current===o?e:a}function Zb(e){return e=Yb(e),e!==null?$b(e):null}function $b(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var a=$b(e);if(a!==null)return a;e=e.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(e){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,e,void 0,(e.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(e){return e>>>=0,e===0?32:31-(pc(e)/qc|0)|0}var rc=64,sc=4194304;function tc(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function uc(e,a){var o=e.pendingLanes;if(o===0)return 0;var c=0,d=e.suspendedLanes,$=e.pingedLanes,g=o&268435455;if(g!==0){var b=g&~d;b!==0?c=tc(b):($&=g,$!==0&&(c=tc($)))}else g=o&~d,g!==0?c=tc(g):$!==0&&(c=tc($));if(c===0)return 0;if(a!==0&&a!==c&&!(a&d)&&(d=c&-c,$=a&-a,d>=$||d===16&&($&4194240)!==0))return a;if(c&4&&(c|=o&16),a=e.entangledLanes,a!==0)for(e=e.entanglements,a&=c;0<a;)o=31-oc(a),d=1<<o,c|=e[o],a&=~d;return c}function vc(e,a){switch(e){case 1:case 2:case 4:return a+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(e,a){for(var o=e.suspendedLanes,c=e.pingedLanes,d=e.expirationTimes,$=e.pendingLanes;0<$;){var g=31-oc($),b=1<<g,_=d[g];_===-1?(!(b&o)||b&c)&&(d[g]=vc(b,a)):_<=a&&(e.expiredLanes|=b),$&=~b}}function xc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function yc(){var e=rc;return rc<<=1,!(rc&4194240)&&(rc=64),e}function zc(e){for(var a=[],o=0;31>o;o++)a.push(e);return a}function Ac(e,a,o){e.pendingLanes|=a,a!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,a=31-oc(a),e[a]=o}function Bc(e,a){var o=e.pendingLanes&~a;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=a,e.mutableReadLanes&=a,e.entangledLanes&=a,a=e.entanglements;var c=e.eventTimes;for(e=e.expirationTimes;0<o;){var d=31-oc(o),$=1<<d;a[d]=0,c[d]=-1,e[d]=-1,o&=~$}}function Cc(e,a){var o=e.entangledLanes|=a;for(e=e.entanglements;o;){var c=31-oc(o),d=1<<c;d&a|e[c]&a&&(e[c]|=a),o&=~d}}var C=0;function Dc$1(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc$1(e,a){switch(e){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(a.pointerId)}}function Tc$1(e,a,o,c,d,$){return e===null||e.nativeEvent!==$?(e={blockedOn:a,domEventName:o,eventSystemFlags:c,nativeEvent:$,targetContainers:[d]},a!==null&&(a=Cb(a),a!==null&&Fc(a)),e):(e.eventSystemFlags|=c,a=e.targetContainers,d!==null&&a.indexOf(d)===-1&&a.push(d),e)}function Uc(e,a,o,c,d){switch(a){case"focusin":return Lc=Tc$1(Lc,e,a,o,c,d),!0;case"dragenter":return Mc=Tc$1(Mc,e,a,o,c,d),!0;case"mouseover":return Nc=Tc$1(Nc,e,a,o,c,d),!0;case"pointerover":var $=d.pointerId;return Oc.set($,Tc$1(Oc.get($)||null,e,a,o,c,d)),!0;case"gotpointercapture":return $=d.pointerId,Pc.set($,Tc$1(Pc.get($)||null,e,a,o,c,d)),!0}return!1}function Vc(e){var a=Wc(e.target);if(a!==null){var o=Vb(a);if(o!==null){if(a=o.tag,a===13){if(a=Wb(o),a!==null){e.blockedOn=a,Ic(e.priority,function(){Gc(o)});return}}else if(a===3&&o.stateNode.current.memoizedState.isDehydrated){e.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Xc(e){if(e.blockedOn!==null)return!1;for(var a=e.targetContainers;0<a.length;){var o=Yc(e.domEventName,e.eventSystemFlags,a[0],e.nativeEvent);if(o===null){o=e.nativeEvent;var c=new o.constructor(o.type,o);wb=c,o.target.dispatchEvent(c),wb=null}else return a=Cb(o),a!==null&&Fc(a),e.blockedOn=o,!1;a.shift()}return!0}function Zc(e,a,o){Xc(e)&&o.delete(a)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(e,a){e.blockedOn===a&&(e.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(e){function a(d){return ad(d,e)}if(0<Kc.length){ad(Kc[0],e);for(var o=1;o<Kc.length;o++){var c=Kc[o];c.blockedOn===e&&(c.blockedOn=null)}}for(Lc!==null&&ad(Lc,e),Mc!==null&&ad(Mc,e),Nc!==null&&ad(Nc,e),Oc.forEach(a),Pc.forEach(a),o=0;o<Qc.length;o++)c=Qc[o],c.blockedOn===e&&(c.blockedOn=null);for(;0<Qc.length&&(o=Qc[0],o.blockedOn===null);)Vc(o),o.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(e,a,o,c){var d=C,$=cd.transition;cd.transition=null;try{C=1,fd(e,a,o,c)}finally{C=d,cd.transition=$}}function gd(e,a,o,c){var d=C,$=cd.transition;cd.transition=null;try{C=4,fd(e,a,o,c)}finally{C=d,cd.transition=$}}function fd(e,a,o,c){if(dd){var d=Yc(e,a,o,c);if(d===null)hd(e,a,c,id$2,o),Sc$1(e,c);else if(Uc(d,e,a,o,c))c.stopPropagation();else if(Sc$1(e,c),a&4&&-1<Rc.indexOf(e)){for(;d!==null;){var $=Cb(d);if($!==null&&Ec($),$=Yc(e,a,o,c),$===null&&hd(e,a,c,id$2,o),$===d)break;d=$}d!==null&&c.stopPropagation()}else hd(e,a,c,null,o)}}var id$2=null;function Yc(e,a,o,c){if(id$2=null,e=xb(c),e=Wc(e),e!==null)if(a=Vb(e),a===null)e=null;else if(o=a.tag,o===13){if(e=Wb(a),e!==null)return e;e=null}else if(o===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;e=null}else a!==e&&(e=null);return id$2=e,null}function jd(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var e,a=ld,o=a.length,c,d="value"in kd?kd.value:kd.textContent,$=d.length;for(e=0;e<o&&a[e]===d[e];e++);var g=o-e;for(c=1;c<=g&&a[o-c]===d[$-c];c++);return md=d.slice(e,1<c?1-c:void 0)}function od(e){var a=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&a===13&&(e=13)):e=a,e===10&&(e=13),32<=e||e===13?e:0}function pd(){return!0}function qd(){return!1}function rd(e){function a(o,c,d,$,g){this._reactName=o,this._targetInst=d,this.type=c,this.nativeEvent=$,this.target=g,this.currentTarget=null;for(var b in e)e.hasOwnProperty(b)&&(o=e[b],this[b]=o?o($):$[b]);return this.isDefaultPrevented=($.defaultPrevented!=null?$.defaultPrevented:$.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),a}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==yd&&(yd&&e.type==="mousemove"?(wd=e.screenX-yd.screenX,xd=e.screenY-yd.screenY):xd=wd=0,yd=e),wd)},movementY:function(e){return"movementY"in e?e.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(e){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(e):(e=Od[e])?!!a[e]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function(e){if(e.key){var a=Md[e.key]||e.key;if(a!=="Unidentified")return a}return e.type==="keypress"?(e=od(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Nd[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(e){return e.type==="keypress"?od(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?od(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce=ia&&"TextEvent"in window&&!be,de=ia&&(!ae||be&&8<be&&11>=be),ee=" ",fe=!1;function ge(e,a){switch(e){case"keyup":return $d.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ie=!1;function je(e,a){switch(e){case"compositionend":return he(a);case"keypress":return a.which!==32?null:(fe=!0,ee);case"textInput":return e=a.data,e===ee&&fe?null:e;default:return null}}function ke(e,a){if(ie)return e==="compositionend"||!ae&&ge(e,a)?(e=nd(),md=ld=kd=null,ie=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return de&&a.locale!=="ko"?null:a.data;default:return null}}var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(e){var a=e&&e.nodeName&&e.nodeName.toLowerCase();return a==="input"?!!le[e.type]:a==="textarea"}function ne(e,a,o,c){Eb(c),a=oe(a,"onChange"),0<a.length&&(o=new td("onChange","change",null,o,c),e.push({event:o,listeners:a}))}var pe=null,qe=null;function re$1(e){se(e,0)}function te(e){var a=ue(e);if(Wa(a))return e}function ve(e,a){if(e==="change")return a}var we=!1;if(ia){var xe;if(ia){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye=typeof ze.oninput=="function"}xe=ye}else xe=!1;we=xe&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be(e){if(e.propertyName==="value"&&te(qe)){var a=[];ne(a,qe,e,xb(e)),Jb(re$1,a)}}function Ce(e,a,o){e==="focusin"?(Ae(),pe=a,qe=o,pe.attachEvent("onpropertychange",Be)):e==="focusout"&&Ae()}function De(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return te(qe)}function Ee(e,a){if(e==="click")return te(a)}function Fe(e,a){if(e==="input"||e==="change")return te(a)}function Ge(e,a){return e===a&&(e!==0||1/e===1/a)||e!==e&&a!==a}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(e,a){if(He(e,a))return!0;if(typeof e!="object"||e===null||typeof a!="object"||a===null)return!1;var o=Object.keys(e),c=Object.keys(a);if(o.length!==c.length)return!1;for(c=0;c<o.length;c++){var d=o[c];if(!ja.call(a,d)||!He(e[d],a[d]))return!1}return!0}function Je(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Ke(e,a){var o=Je(e);e=0;for(var c;o;){if(o.nodeType===3){if(c=e+o.textContent.length,e<=a&&c>=a)return{node:o,offset:a-e};e=c}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=Je(o)}}function Le(e,a){return e&&a?e===a?!0:e&&e.nodeType===3?!1:a&&a.nodeType===3?Le(e,a.parentNode):"contains"in e?e.contains(a):e.compareDocumentPosition?!!(e.compareDocumentPosition(a)&16):!1:!1}function Me(){for(var e=window,a=Xa();a instanceof e.HTMLIFrameElement;){try{var o=typeof a.contentWindow.location.href=="string"}catch{o=!1}if(o)e=a.contentWindow;else break;a=Xa(e.document)}return a}function Ne(e){var a=e&&e.nodeName&&e.nodeName.toLowerCase();return a&&(a==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||a==="textarea"||e.contentEditable==="true")}function Oe(e){var a=Me(),o=e.focusedElem,c=e.selectionRange;if(a!==o&&o&&o.ownerDocument&&Le(o.ownerDocument.documentElement,o)){if(c!==null&&Ne(o)){if(a=c.start,e=c.end,e===void 0&&(e=a),"selectionStart"in o)o.selectionStart=a,o.selectionEnd=Math.min(e,o.value.length);else if(e=(a=o.ownerDocument||document)&&a.defaultView||window,e.getSelection){e=e.getSelection();var d=o.textContent.length,$=Math.min(c.start,d);c=c.end===void 0?$:Math.min(c.end,d),!e.extend&&$>c&&(d=c,c=$,$=d),d=Ke(o,$);var g=Ke(o,c);d&&g&&(e.rangeCount!==1||e.anchorNode!==d.node||e.anchorOffset!==d.offset||e.focusNode!==g.node||e.focusOffset!==g.offset)&&(a=a.createRange(),a.setStart(d.node,d.offset),e.removeAllRanges(),$>c?(e.addRange(a),e.extend(g.node,g.offset)):(a.setEnd(g.node,g.offset),e.addRange(a)))}}for(a=[],e=o;e=e.parentNode;)e.nodeType===1&&a.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<a.length;o++)e=a[o],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue(e,a,o){var c=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Te||Qe==null||Qe!==Xa(c)||(c=Qe,"selectionStart"in c&&Ne(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),Se&&Ie(Se,c)||(Se=c,c=oe(Re,"onSelect"),0<c.length&&(a=new td("onSelect","select",null,a,o),e.push({event:a,listeners:c}),a.target=Qe)))}function Ve(e,a){var o={};return o[e.toLowerCase()]=a.toLowerCase(),o["Webkit"+e]="webkit"+a,o["Moz"+e]="moz"+a,o}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(e){if(Xe[e])return Xe[e];if(!We[e])return e;var a=We[e],o;for(o in a)if(a.hasOwnProperty(o)&&o in Ye)return Xe[e]=a[o];return e}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(e,a){df.set(e,a),fa(a,[e])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(e,a,o){var c=e.type||"unknown-event";e.currentTarget=o,Ub(c,a,void 0,e),e.currentTarget=null}function se(e,a){a=(a&4)!==0;for(var o=0;o<e.length;o++){var c=e[o],d=c.event;c=c.listeners;e:{var $=void 0;if(a)for(var g=c.length-1;0<=g;g--){var b=c[g],_=b.instance,j=b.currentTarget;if(b=b.listener,_!==$&&d.isPropagationStopped())break e;nf(d,b,j),$=_}else for(g=0;g<c.length;g++){if(b=c[g],_=b.instance,j=b.currentTarget,b=b.listener,_!==$&&d.isPropagationStopped())break e;nf(d,b,j),$=_}}}if(Qb)throw e=Rb,Qb=!1,Rb=null,e}function D$1(e,a){var o=a[of];o===void 0&&(o=a[of]=new Set);var c=e+"__bubble";o.has(c)||(pf(a,e,2,!1),o.add(c))}function qf(e,a,o){var c=0;a&&(c|=4),pf(o,e,c,a)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(e){if(!e[rf]){e[rf]=!0,da.forEach(function(o){o!=="selectionchange"&&(mf.has(o)||qf(o,!1,e),qf(o,!0,e))});var a=e.nodeType===9?e:e.ownerDocument;a===null||a[rf]||(a[rf]=!0,qf("selectionchange",!1,a))}}function pf(e,a,o,c){switch(jd(a)){case 1:var d=ed;break;case 4:d=gd;break;default:d=fd}o=d.bind(null,a,o,e),d=void 0,!Lb||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(d=!0),c?d!==void 0?e.addEventListener(a,o,{capture:!0,passive:d}):e.addEventListener(a,o,!0):d!==void 0?e.addEventListener(a,o,{passive:d}):e.addEventListener(a,o,!1)}function hd(e,a,o,c,d){var $=c;if(!(a&1)&&!(a&2)&&c!==null)e:for(;;){if(c===null)return;var g=c.tag;if(g===3||g===4){var b=c.stateNode.containerInfo;if(b===d||b.nodeType===8&&b.parentNode===d)break;if(g===4)for(g=c.return;g!==null;){var _=g.tag;if((_===3||_===4)&&(_=g.stateNode.containerInfo,_===d||_.nodeType===8&&_.parentNode===d))return;g=g.return}for(;b!==null;){if(g=Wc(b),g===null)return;if(_=g.tag,_===5||_===6){c=$=g;continue e}b=b.parentNode}}c=c.return}Jb(function(){var j=$,_e=xb(o),et=[];e:{var tt=df.get(e);if(tt!==void 0){var nt=td,at=e;switch(e){case"keypress":if(od(o)===0)break e;case"keydown":case"keyup":nt=Rd;break;case"focusin":at="focus",nt=Fd;break;case"focusout":at="blur",nt=Fd;break;case"beforeblur":case"afterblur":nt=Fd;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":nt=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":nt=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":nt=Vd;break;case $e:case af:case bf:nt=Hd;break;case cf:nt=Xd;break;case"scroll":nt=vd;break;case"wheel":nt=Zd;break;case"copy":case"cut":case"paste":nt=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":nt=Td}var lt=(a&4)!==0,mt=!lt&&e==="scroll",ot=lt?tt!==null?tt+"Capture":null:tt;lt=[];for(var st=j,ut;st!==null;){ut=st;var pt=ut.stateNode;if(ut.tag===5&&pt!==null&&(ut=pt,ot!==null&&(pt=Kb(st,ot),pt!=null&&lt.push(tf(st,pt,ut)))),mt)break;st=st.return}0<lt.length&&(tt=new nt(tt,at,null,o,_e),et.push({event:tt,listeners:lt}))}}if(!(a&7)){e:{if(tt=e==="mouseover"||e==="pointerover",nt=e==="mouseout"||e==="pointerout",tt&&o!==wb&&(at=o.relatedTarget||o.fromElement)&&(Wc(at)||at[uf]))break e;if((nt||tt)&&(tt=_e.window===_e?_e:(tt=_e.ownerDocument)?tt.defaultView||tt.parentWindow:window,nt?(at=o.relatedTarget||o.toElement,nt=j,at=at?Wc(at):null,at!==null&&(mt=Vb(at),at!==mt||at.tag!==5&&at.tag!==6)&&(at=null)):(nt=null,at=j),nt!==at)){if(lt=Bd,pt="onMouseLeave",ot="onMouseEnter",st="mouse",(e==="pointerout"||e==="pointerover")&&(lt=Td,pt="onPointerLeave",ot="onPointerEnter",st="pointer"),mt=nt==null?tt:ue(nt),ut=at==null?tt:ue(at),tt=new lt(pt,st+"leave",nt,o,_e),tt.target=mt,tt.relatedTarget=ut,pt=null,Wc(_e)===j&&(lt=new lt(ot,st+"enter",at,o,_e),lt.target=ut,lt.relatedTarget=mt,pt=lt),mt=pt,nt&&at)t:{for(lt=nt,ot=at,st=0,ut=lt;ut;ut=vf(ut))st++;for(ut=0,pt=ot;pt;pt=vf(pt))ut++;for(;0<st-ut;)lt=vf(lt),st--;for(;0<ut-st;)ot=vf(ot),ut--;for(;st--;){if(lt===ot||ot!==null&&lt===ot.alternate)break t;lt=vf(lt),ot=vf(ot)}lt=null}else lt=null;nt!==null&&wf(et,tt,nt,lt,!1),at!==null&&mt!==null&&wf(et,mt,at,lt,!0)}}e:{if(tt=j?ue(j):window,nt=tt.nodeName&&tt.nodeName.toLowerCase(),nt==="select"||nt==="input"&&tt.type==="file")var gt=ve;else if(me(tt))if(we)gt=Fe;else{gt=De;var ft=Ce}else(nt=tt.nodeName)&&nt.toLowerCase()==="input"&&(tt.type==="checkbox"||tt.type==="radio")&&(gt=Ee);if(gt&&(gt=gt(e,j))){ne(et,gt,o,_e);break e}ft&&ft(e,tt,j),e==="focusout"&&(ft=tt._wrapperState)&&ft.controlled&&tt.type==="number"&&cb(tt,"number",tt.value)}switch(ft=j?ue(j):window,e){case"focusin":(me(ft)||ft.contentEditable==="true")&&(Qe=ft,Re=j,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(et,o,_e);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(et,o,_e)}var yt;if(ae)e:{switch(e){case"compositionstart":var _t="onCompositionStart";break e;case"compositionend":_t="onCompositionEnd";break e;case"compositionupdate":_t="onCompositionUpdate";break e}_t=void 0}else ie?ge(e,o)&&(_t="onCompositionEnd"):e==="keydown"&&o.keyCode===229&&(_t="onCompositionStart");_t&&(de&&o.locale!=="ko"&&(ie||_t!=="onCompositionStart"?_t==="onCompositionEnd"&&ie&&(yt=nd()):(kd=_e,ld="value"in kd?kd.value:kd.textContent,ie=!0)),ft=oe(j,_t),0<ft.length&&(_t=new Ld(_t,e,null,o,_e),et.push({event:_t,listeners:ft}),yt?_t.data=yt:(yt=he(o),yt!==null&&(_t.data=yt)))),(yt=ce?je(e,o):ke(e,o))&&(j=oe(j,"onBeforeInput"),0<j.length&&(_e=new Ld("onBeforeInput","beforeinput",null,o,_e),et.push({event:_e,listeners:j}),_e.data=yt))}se(et,a)})}function tf(e,a,o){return{instance:e,listener:a,currentTarget:o}}function oe(e,a){for(var o=a+"Capture",c=[];e!==null;){var d=e,$=d.stateNode;d.tag===5&&$!==null&&(d=$,$=Kb(e,o),$!=null&&c.unshift(tf(e,$,d)),$=Kb(e,a),$!=null&&c.push(tf(e,$,d))),e=e.return}return c}function vf(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function wf(e,a,o,c,d){for(var $=a._reactName,g=[];o!==null&&o!==c;){var b=o,_=b.alternate,j=b.stateNode;if(_!==null&&_===c)break;b.tag===5&&j!==null&&(b=j,d?(_=Kb(o,$),_!=null&&g.unshift(tf(o,_,b))):d||(_=Kb(o,$),_!=null&&g.push(tf(o,_,b)))),o=o.return}g.length!==0&&e.push({event:a,listeners:g})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(e){return(typeof e=="string"?e:""+e).replace(xf,`
`).replace(yf,"")}function Af(e,a,o){if(a=zf(a),zf(e)!==a&&o)throw Error(p$1(425))}function Bf(){}var Cf=null,Df=null;function Ef(e,a){return e==="textarea"||e==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(e){return Hf.resolve(null).then(e).catch(If)}:Ff;function If(e){setTimeout(function(){throw e})}function Kf(e,a){var o=a,c=0;do{var d=o.nextSibling;if(e.removeChild(o),d&&d.nodeType===8)if(o=d.data,o==="/$"){if(c===0){e.removeChild(d),bd(a);return}c--}else o!=="$"&&o!=="$?"&&o!=="$!"||c++;o=d}while(o);bd(a)}function Lf(e){for(;e!=null;e=e.nextSibling){var a=e.nodeType;if(a===1||a===3)break;if(a===8){if(a=e.data,a==="$"||a==="$!"||a==="$?")break;if(a==="/$")return null}}return e}function Mf(e){e=e.previousSibling;for(var a=0;e;){if(e.nodeType===8){var o=e.data;if(o==="$"||o==="$!"||o==="$?"){if(a===0)return e;a--}else o==="/$"&&a++}e=e.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(e){var a=e[Of];if(a)return a;for(var o=e.parentNode;o;){if(a=o[uf]||o[Of]){if(o=a.alternate,a.child!==null||o!==null&&o.child!==null)for(e=Mf(e);e!==null;){if(o=e[Of])return o;e=Mf(e)}return a}e=o,o=e.parentNode}return null}function Cb(e){return e=e[Of]||e[uf],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ue(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(p$1(33))}function Db(e){return e[Pf]||null}var Sf=[],Tf=-1;function Uf(e){return{current:e}}function E(e){0>Tf||(e.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G(e,a){Tf++,Sf[Tf]=e.current,e.current=a}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(e,a){var o=e.type.contextTypes;if(!o)return Vf;var c=e.stateNode;if(c&&c.__reactInternalMemoizedUnmaskedChildContext===a)return c.__reactInternalMemoizedMaskedChildContext;var d={},$;for($ in o)d[$]=a[$];return c&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=d),d}function Zf(e){return e=e.childContextTypes,e!=null}function $f(){E(Wf),E(H)}function ag(e,a,o){if(H.current!==Vf)throw Error(p$1(168));G(H,a),G(Wf,o)}function bg(e,a,o){var c=e.stateNode;if(a=a.childContextTypes,typeof c.getChildContext!="function")return o;c=c.getChildContext();for(var d in c)if(!(d in a))throw Error(p$1(108,Ra(e)||"Unknown",d));return A({},o,c)}function cg(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G(H,e),G(Wf,Wf.current),!0}function dg(e,a,o){var c=e.stateNode;if(!c)throw Error(p$1(169));o?(e=bg(e,a,Xf),c.__reactInternalMemoizedMergedChildContext=e,E(Wf),E(H),G(H,e)):E(Wf),G(Wf,o)}var eg=null,fg=!1,gg=!1;function hg(e){eg===null?eg=[e]:eg.push(e)}function ig(e){fg=!0,hg(e)}function jg(){if(!gg&&eg!==null){gg=!0;var e=0,a=C;try{var o=eg;for(C=1;e<o.length;e++){var c=o[e];do c=c(!0);while(c!==null)}eg=null,fg=!1}catch(d){throw eg!==null&&(eg=eg.slice(e+1)),ac(fc,jg),d}finally{C=a,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(e,a){kg[lg++]=ng,kg[lg++]=mg,mg=e,ng=a}function ug(e,a,o){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=e;var c=rg;e=sg;var d=32-oc(c)-1;c&=~(1<<d),o+=1;var $=32-oc(a)+d;if(30<$){var g=d-d%5;$=(c&(1<<g)-1).toString(32),c>>=g,d-=g,rg=1<<32-oc(a)+d|o<<d|c,sg=$+e}else rg=1<<$|o<<d|c,sg=e}function vg(e){e.return!==null&&(tg(e,1),ug(e,1,0))}function wg(e){for(;e===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;e===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag(e,a){var o=Bg(5,null,null,0);o.elementType="DELETED",o.stateNode=a,o.return=e,a=e.deletions,a===null?(e.deletions=[o],e.flags|=16):a.push(o)}function Cg(e,a){switch(e.tag){case 5:var o=e.type;return a=a.nodeType!==1||o.toLowerCase()!==a.nodeName.toLowerCase()?null:a,a!==null?(e.stateNode=a,xg=e,yg=Lf(a.firstChild),!0):!1;case 6:return a=e.pendingProps===""||a.nodeType!==3?null:a,a!==null?(e.stateNode=a,xg=e,yg=null,!0):!1;case 13:return a=a.nodeType!==8?null:a,a!==null?(o=qg!==null?{id:rg,overflow:sg}:null,e.memoizedState={dehydrated:a,treeContext:o,retryLane:1073741824},o=Bg(18,null,null,0),o.stateNode=a,o.return=e,e.child=o,xg=e,yg=null,!0):!1;default:return!1}}function Dg(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Eg(e){if(I){var a=yg;if(a){var o=a;if(!Cg(e,a)){if(Dg(e))throw Error(p$1(418));a=Lf(o.nextSibling);var c=xg;a&&Cg(e,a)?Ag(c,o):(e.flags=e.flags&-4097|2,I=!1,xg=e)}}else{if(Dg(e))throw Error(p$1(418));e.flags=e.flags&-4097|2,I=!1,xg=e}}}function Fg(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;xg=e}function Gg(e){if(e!==xg)return!1;if(!I)return Fg(e),I=!0,!1;var a;if((a=e.tag!==3)&&!(a=e.tag!==5)&&(a=e.type,a=a!=="head"&&a!=="body"&&!Ef(e.type,e.memoizedProps)),a&&(a=yg)){if(Dg(e))throw Hg(),Error(p$1(418));for(;a;)Ag(e,a),a=Lf(a.nextSibling)}if(Fg(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(p$1(317));e:{for(e=e.nextSibling,a=0;e;){if(e.nodeType===8){var o=e.data;if(o==="/$"){if(a===0){yg=Lf(e.nextSibling);break e}a--}else o!=="$"&&o!=="$!"&&o!=="$?"||a++}e=e.nextSibling}yg=null}}else yg=xg?Lf(e.stateNode.nextSibling):null;return!0}function Hg(){for(var e=yg;e;)e=Lf(e.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg(e){zg===null?zg=[e]:zg.push(e)}var Kg=ua.ReactCurrentBatchConfig;function Lg(e,a,o){if(e=o.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(o._owner){if(o=o._owner,o){if(o.tag!==1)throw Error(p$1(309));var c=o.stateNode}if(!c)throw Error(p$1(147,e));var d=c,$=""+e;return a!==null&&a.ref!==null&&typeof a.ref=="function"&&a.ref._stringRef===$?a.ref:(a=function(g){var b=d.refs;g===null?delete b[$]:b[$]=g},a._stringRef=$,a)}if(typeof e!="string")throw Error(p$1(284));if(!o._owner)throw Error(p$1(290,e))}return e}function Mg(e,a){throw e=Object.prototype.toString.call(a),Error(p$1(31,e==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":e))}function Ng(e){var a=e._init;return a(e._payload)}function Og(e){function a(ot,st){if(e){var ut=ot.deletions;ut===null?(ot.deletions=[st],ot.flags|=16):ut.push(st)}}function o(ot,st){if(!e)return null;for(;st!==null;)a(ot,st),st=st.sibling;return null}function c(ot,st){for(ot=new Map;st!==null;)st.key!==null?ot.set(st.key,st):ot.set(st.index,st),st=st.sibling;return ot}function d(ot,st){return ot=Pg(ot,st),ot.index=0,ot.sibling=null,ot}function $(ot,st,ut){return ot.index=ut,e?(ut=ot.alternate,ut!==null?(ut=ut.index,ut<st?(ot.flags|=2,st):ut):(ot.flags|=2,st)):(ot.flags|=1048576,st)}function g(ot){return e&&ot.alternate===null&&(ot.flags|=2),ot}function b(ot,st,ut,pt){return st===null||st.tag!==6?(st=Qg(ut,ot.mode,pt),st.return=ot,st):(st=d(st,ut),st.return=ot,st)}function _(ot,st,ut,pt){var gt=ut.type;return gt===ya?_e(ot,st,ut.props.children,pt,ut.key):st!==null&&(st.elementType===gt||typeof gt=="object"&&gt!==null&&gt.$$typeof===Ha&&Ng(gt)===st.type)?(pt=d(st,ut.props),pt.ref=Lg(ot,st,ut),pt.return=ot,pt):(pt=Rg(ut.type,ut.key,ut.props,null,ot.mode,pt),pt.ref=Lg(ot,st,ut),pt.return=ot,pt)}function j(ot,st,ut,pt){return st===null||st.tag!==4||st.stateNode.containerInfo!==ut.containerInfo||st.stateNode.implementation!==ut.implementation?(st=Sg(ut,ot.mode,pt),st.return=ot,st):(st=d(st,ut.children||[]),st.return=ot,st)}function _e(ot,st,ut,pt,gt){return st===null||st.tag!==7?(st=Tg(ut,ot.mode,pt,gt),st.return=ot,st):(st=d(st,ut),st.return=ot,st)}function et(ot,st,ut){if(typeof st=="string"&&st!==""||typeof st=="number")return st=Qg(""+st,ot.mode,ut),st.return=ot,st;if(typeof st=="object"&&st!==null){switch(st.$$typeof){case va:return ut=Rg(st.type,st.key,st.props,null,ot.mode,ut),ut.ref=Lg(ot,null,st),ut.return=ot,ut;case wa:return st=Sg(st,ot.mode,ut),st.return=ot,st;case Ha:var pt=st._init;return et(ot,pt(st._payload),ut)}if(eb(st)||Ka(st))return st=Tg(st,ot.mode,ut,null),st.return=ot,st;Mg(ot,st)}return null}function tt(ot,st,ut,pt){var gt=st!==null?st.key:null;if(typeof ut=="string"&&ut!==""||typeof ut=="number")return gt!==null?null:b(ot,st,""+ut,pt);if(typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case va:return ut.key===gt?_(ot,st,ut,pt):null;case wa:return ut.key===gt?j(ot,st,ut,pt):null;case Ha:return gt=ut._init,tt(ot,st,gt(ut._payload),pt)}if(eb(ut)||Ka(ut))return gt!==null?null:_e(ot,st,ut,pt,null);Mg(ot,ut)}return null}function nt(ot,st,ut,pt,gt){if(typeof pt=="string"&&pt!==""||typeof pt=="number")return ot=ot.get(ut)||null,b(st,ot,""+pt,gt);if(typeof pt=="object"&&pt!==null){switch(pt.$$typeof){case va:return ot=ot.get(pt.key===null?ut:pt.key)||null,_(st,ot,pt,gt);case wa:return ot=ot.get(pt.key===null?ut:pt.key)||null,j(st,ot,pt,gt);case Ha:var ft=pt._init;return nt(ot,st,ut,ft(pt._payload),gt)}if(eb(pt)||Ka(pt))return ot=ot.get(ut)||null,_e(st,ot,pt,gt,null);Mg(st,pt)}return null}function at(ot,st,ut,pt){for(var gt=null,ft=null,yt=st,_t=st=0,vt=null;yt!==null&&_t<ut.length;_t++){yt.index>_t?(vt=yt,yt=null):vt=yt.sibling;var Pt=tt(ot,yt,ut[_t],pt);if(Pt===null){yt===null&&(yt=vt);break}e&&yt&&Pt.alternate===null&&a(ot,yt),st=$(Pt,st,_t),ft===null?gt=Pt:ft.sibling=Pt,ft=Pt,yt=vt}if(_t===ut.length)return o(ot,yt),I&&tg(ot,_t),gt;if(yt===null){for(;_t<ut.length;_t++)yt=et(ot,ut[_t],pt),yt!==null&&(st=$(yt,st,_t),ft===null?gt=yt:ft.sibling=yt,ft=yt);return I&&tg(ot,_t),gt}for(yt=c(ot,yt);_t<ut.length;_t++)vt=nt(yt,ot,_t,ut[_t],pt),vt!==null&&(e&&vt.alternate!==null&&yt.delete(vt.key===null?_t:vt.key),st=$(vt,st,_t),ft===null?gt=vt:ft.sibling=vt,ft=vt);return e&&yt.forEach(function(Tt){return a(ot,Tt)}),I&&tg(ot,_t),gt}function lt(ot,st,ut,pt){var gt=Ka(ut);if(typeof gt!="function")throw Error(p$1(150));if(ut=gt.call(ut),ut==null)throw Error(p$1(151));for(var ft=gt=null,yt=st,_t=st=0,vt=null,Pt=ut.next();yt!==null&&!Pt.done;_t++,Pt=ut.next()){yt.index>_t?(vt=yt,yt=null):vt=yt.sibling;var Tt=tt(ot,yt,Pt.value,pt);if(Tt===null){yt===null&&(yt=vt);break}e&&yt&&Tt.alternate===null&&a(ot,yt),st=$(Tt,st,_t),ft===null?gt=Tt:ft.sibling=Tt,ft=Tt,yt=vt}if(Pt.done)return o(ot,yt),I&&tg(ot,_t),gt;if(yt===null){for(;!Pt.done;_t++,Pt=ut.next())Pt=et(ot,Pt.value,pt),Pt!==null&&(st=$(Pt,st,_t),ft===null?gt=Pt:ft.sibling=Pt,ft=Pt);return I&&tg(ot,_t),gt}for(yt=c(ot,yt);!Pt.done;_t++,Pt=ut.next())Pt=nt(yt,ot,_t,Pt.value,pt),Pt!==null&&(e&&Pt.alternate!==null&&yt.delete(Pt.key===null?_t:Pt.key),st=$(Pt,st,_t),ft===null?gt=Pt:ft.sibling=Pt,ft=Pt);return e&&yt.forEach(function(St){return a(ot,St)}),I&&tg(ot,_t),gt}function mt(ot,st,ut,pt){if(typeof ut=="object"&&ut!==null&&ut.type===ya&&ut.key===null&&(ut=ut.props.children),typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case va:e:{for(var gt=ut.key,ft=st;ft!==null;){if(ft.key===gt){if(gt=ut.type,gt===ya){if(ft.tag===7){o(ot,ft.sibling),st=d(ft,ut.props.children),st.return=ot,ot=st;break e}}else if(ft.elementType===gt||typeof gt=="object"&&gt!==null&&gt.$$typeof===Ha&&Ng(gt)===ft.type){o(ot,ft.sibling),st=d(ft,ut.props),st.ref=Lg(ot,ft,ut),st.return=ot,ot=st;break e}o(ot,ft);break}else a(ot,ft);ft=ft.sibling}ut.type===ya?(st=Tg(ut.props.children,ot.mode,pt,ut.key),st.return=ot,ot=st):(pt=Rg(ut.type,ut.key,ut.props,null,ot.mode,pt),pt.ref=Lg(ot,st,ut),pt.return=ot,ot=pt)}return g(ot);case wa:e:{for(ft=ut.key;st!==null;){if(st.key===ft)if(st.tag===4&&st.stateNode.containerInfo===ut.containerInfo&&st.stateNode.implementation===ut.implementation){o(ot,st.sibling),st=d(st,ut.children||[]),st.return=ot,ot=st;break e}else{o(ot,st);break}else a(ot,st);st=st.sibling}st=Sg(ut,ot.mode,pt),st.return=ot,ot=st}return g(ot);case Ha:return ft=ut._init,mt(ot,st,ft(ut._payload),pt)}if(eb(ut))return at(ot,st,ut,pt);if(Ka(ut))return lt(ot,st,ut,pt);Mg(ot,ut)}return typeof ut=="string"&&ut!==""||typeof ut=="number"?(ut=""+ut,st!==null&&st.tag===6?(o(ot,st.sibling),st=d(st,ut),st.return=ot,ot=st):(o(ot,st),st=Qg(ut,ot.mode,pt),st.return=ot,ot=st),g(ot)):o(ot,st)}return mt}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(e){var a=Wg.current;E(Wg),e._currentValue=a}function bh(e,a,o){for(;e!==null;){var c=e.alternate;if((e.childLanes&a)!==a?(e.childLanes|=a,c!==null&&(c.childLanes|=a)):c!==null&&(c.childLanes&a)!==a&&(c.childLanes|=a),e===o)break;e=e.return}}function ch$1(e,a){Xg=e,Zg=Yg=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&a&&(dh=!0),e.firstContext=null)}function eh(e){var a=e._currentValue;if(Zg!==e)if(e={context:e,memoizedValue:a,next:null},Yg===null){if(Xg===null)throw Error(p$1(308));Yg=e,Xg.dependencies={lanes:0,firstContext:e}}else Yg=Yg.next=e;return a}var fh=null;function gh(e){fh===null?fh=[e]:fh.push(e)}function hh(e,a,o,c){var d=a.interleaved;return d===null?(o.next=o,gh(a)):(o.next=d.next,d.next=o),a.interleaved=o,ih(e,c)}function ih(e,a){e.lanes|=a;var o=e.alternate;for(o!==null&&(o.lanes|=a),o=e,e=e.return;e!==null;)e.childLanes|=a,o=e.alternate,o!==null&&(o.childLanes|=a),o=e,e=e.return;return o.tag===3?o.stateNode:null}var jh=!1;function kh(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(e,a){e=e.updateQueue,a.updateQueue===e&&(a.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function mh(e,a){return{eventTime:e,lane:a,tag:0,payload:null,callback:null,next:null}}function nh(e,a,o){var c=e.updateQueue;if(c===null)return null;if(c=c.shared,K&2){var d=c.pending;return d===null?a.next=a:(a.next=d.next,d.next=a),c.pending=a,ih(e,o)}return d=c.interleaved,d===null?(a.next=a,gh(c)):(a.next=d.next,d.next=a),c.interleaved=a,ih(e,o)}function oh(e,a,o){if(a=a.updateQueue,a!==null&&(a=a.shared,(o&4194240)!==0)){var c=a.lanes;c&=e.pendingLanes,o|=c,a.lanes=o,Cc(e,o)}}function ph(e,a){var o=e.updateQueue,c=e.alternate;if(c!==null&&(c=c.updateQueue,o===c)){var d=null,$=null;if(o=o.firstBaseUpdate,o!==null){do{var g={eventTime:o.eventTime,lane:o.lane,tag:o.tag,payload:o.payload,callback:o.callback,next:null};$===null?d=$=g:$=$.next=g,o=o.next}while(o!==null);$===null?d=$=a:$=$.next=a}else d=$=a;o={baseState:c.baseState,firstBaseUpdate:d,lastBaseUpdate:$,shared:c.shared,effects:c.effects},e.updateQueue=o;return}e=o.lastBaseUpdate,e===null?o.firstBaseUpdate=a:e.next=a,o.lastBaseUpdate=a}function qh(e,a,o,c){var d=e.updateQueue;jh=!1;var $=d.firstBaseUpdate,g=d.lastBaseUpdate,b=d.shared.pending;if(b!==null){d.shared.pending=null;var _=b,j=_.next;_.next=null,g===null?$=j:g.next=j,g=_;var _e=e.alternate;_e!==null&&(_e=_e.updateQueue,b=_e.lastBaseUpdate,b!==g&&(b===null?_e.firstBaseUpdate=j:b.next=j,_e.lastBaseUpdate=_))}if($!==null){var et=d.baseState;g=0,_e=j=_=null,b=$;do{var tt=b.lane,nt=b.eventTime;if((c&tt)===tt){_e!==null&&(_e=_e.next={eventTime:nt,lane:0,tag:b.tag,payload:b.payload,callback:b.callback,next:null});e:{var at=e,lt=b;switch(tt=a,nt=o,lt.tag){case 1:if(at=lt.payload,typeof at=="function"){et=at.call(nt,et,tt);break e}et=at;break e;case 3:at.flags=at.flags&-65537|128;case 0:if(at=lt.payload,tt=typeof at=="function"?at.call(nt,et,tt):at,tt==null)break e;et=A({},et,tt);break e;case 2:jh=!0}}b.callback!==null&&b.lane!==0&&(e.flags|=64,tt=d.effects,tt===null?d.effects=[b]:tt.push(b))}else nt={eventTime:nt,lane:tt,tag:b.tag,payload:b.payload,callback:b.callback,next:null},_e===null?(j=_e=nt,_=et):_e=_e.next=nt,g|=tt;if(b=b.next,b===null){if(b=d.shared.pending,b===null)break;tt=b,b=tt.next,tt.next=null,d.lastBaseUpdate=tt,d.shared.pending=null}}while(!0);if(_e===null&&(_=et),d.baseState=_,d.firstBaseUpdate=j,d.lastBaseUpdate=_e,a=d.shared.interleaved,a!==null){d=a;do g|=d.lane,d=d.next;while(d!==a)}else $===null&&(d.shared.lanes=0);rh|=g,e.lanes=g,e.memoizedState=et}}function sh(e,a,o){if(e=a.effects,a.effects=null,e!==null)for(a=0;a<e.length;a++){var c=e[a],d=c.callback;if(d!==null){if(c.callback=null,c=o,typeof d!="function")throw Error(p$1(191,d));d.call(c)}}}var th={},uh=Uf(th),vh$1=Uf(th),wh=Uf(th);function xh(e){if(e===th)throw Error(p$1(174));return e}function yh(e,a){switch(G(wh,a),G(vh$1,e),G(uh,th),e=a.nodeType,e){case 9:case 11:a=(a=a.documentElement)?a.namespaceURI:lb(null,"");break;default:e=e===8?a.parentNode:a,a=e.namespaceURI||null,e=e.tagName,a=lb(a,e)}E(uh),G(uh,a)}function zh(){E(uh),E(vh$1),E(wh)}function Ah(e){xh(wh.current);var a=xh(uh.current),o=lb(a,e.type);a!==o&&(G(vh$1,e),G(uh,o))}function Bh(e){vh$1.current===e&&(E(uh),E(vh$1))}var L=Uf(0);function Ch(e){for(var a=e;a!==null;){if(a.tag===13){var o=a.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if(a.flags&128)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===e)break;for(;a.sibling===null;){if(a.return===null||a.return===e)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var Dh=[];function Eh(){for(var e=0;e<Dh.length;e++)Dh[e]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M=null,N=null,O=null,Ih=!1,Jh=!1,Kh=0,Lh=0;function P(){throw Error(p$1(321))}function Mh(e,a){if(a===null)return!1;for(var o=0;o<a.length&&o<e.length;o++)if(!He(e[o],a[o]))return!1;return!0}function Nh(e,a,o,c,d,$){if(Hh=$,M=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,Fh.current=e===null||e.memoizedState===null?Oh:Ph,e=o(c,d),Jh){$=0;do{if(Jh=!1,Kh=0,25<=$)throw Error(p$1(301));$+=1,O=N=null,a.updateQueue=null,Fh.current=Qh,e=o(c,d)}while(Jh)}if(Fh.current=Rh,a=N!==null&&N.next!==null,Hh=0,O=N=M=null,Ih=!1,a)throw Error(p$1(300));return e}function Sh(){var e=Kh!==0;return Kh=0,e}function Th(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O===null?M.memoizedState=O=e:O=O.next=e,O}function Uh(){if(N===null){var e=M.alternate;e=e!==null?e.memoizedState:null}else e=N.next;var a=O===null?M.memoizedState:O.next;if(a!==null)O=a,N=e;else{if(e===null)throw Error(p$1(310));N=e,e={memoizedState:N.memoizedState,baseState:N.baseState,baseQueue:N.baseQueue,queue:N.queue,next:null},O===null?M.memoizedState=O=e:O=O.next=e}return O}function Vh(e,a){return typeof a=="function"?a(e):a}function Wh(e){var a=Uh(),o=a.queue;if(o===null)throw Error(p$1(311));o.lastRenderedReducer=e;var c=N,d=c.baseQueue,$=o.pending;if($!==null){if(d!==null){var g=d.next;d.next=$.next,$.next=g}c.baseQueue=d=$,o.pending=null}if(d!==null){$=d.next,c=c.baseState;var b=g=null,_=null,j=$;do{var _e=j.lane;if((Hh&_e)===_e)_!==null&&(_=_.next={lane:0,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null}),c=j.hasEagerState?j.eagerState:e(c,j.action);else{var et={lane:_e,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null};_===null?(b=_=et,g=c):_=_.next=et,M.lanes|=_e,rh|=_e}j=j.next}while(j!==null&&j!==$);_===null?g=c:_.next=b,He(c,a.memoizedState)||(dh=!0),a.memoizedState=c,a.baseState=g,a.baseQueue=_,o.lastRenderedState=c}if(e=o.interleaved,e!==null){d=e;do $=d.lane,M.lanes|=$,rh|=$,d=d.next;while(d!==e)}else d===null&&(o.lanes=0);return[a.memoizedState,o.dispatch]}function Xh(e){var a=Uh(),o=a.queue;if(o===null)throw Error(p$1(311));o.lastRenderedReducer=e;var c=o.dispatch,d=o.pending,$=a.memoizedState;if(d!==null){o.pending=null;var g=d=d.next;do $=e($,g.action),g=g.next;while(g!==d);He($,a.memoizedState)||(dh=!0),a.memoizedState=$,a.baseQueue===null&&(a.baseState=$),o.lastRenderedState=$}return[$,c]}function Yh(){}function Zh(e,a){var o=M,c=Uh(),d=a(),$=!He(c.memoizedState,d);if($&&(c.memoizedState=d,dh=!0),c=c.queue,$h(ai.bind(null,o,c,e),[e]),c.getSnapshot!==a||$||O!==null&&O.memoizedState.tag&1){if(o.flags|=2048,bi(9,ci.bind(null,o,c,d,a),void 0,null),Q===null)throw Error(p$1(349));Hh&30||di(o,a,d)}return d}function di(e,a,o){e.flags|=16384,e={getSnapshot:a,value:o},a=M.updateQueue,a===null?(a={lastEffect:null,stores:null},M.updateQueue=a,a.stores=[e]):(o=a.stores,o===null?a.stores=[e]:o.push(e))}function ci(e,a,o,c){a.value=o,a.getSnapshot=c,ei(a)&&fi(e)}function ai(e,a,o){return o(function(){ei(a)&&fi(e)})}function ei(e){var a=e.getSnapshot;e=e.value;try{var o=a();return!He(e,o)}catch{return!0}}function fi(e){var a=ih(e,1);a!==null&&gi(a,e,1,-1)}function hi(e){var a=Th();return typeof e=="function"&&(e=e()),a.memoizedState=a.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:e},a.queue=e,e=e.dispatch=ii.bind(null,M,e),[a.memoizedState,e]}function bi(e,a,o,c){return e={tag:e,create:a,destroy:o,deps:c,next:null},a=M.updateQueue,a===null?(a={lastEffect:null,stores:null},M.updateQueue=a,a.lastEffect=e.next=e):(o=a.lastEffect,o===null?a.lastEffect=e.next=e:(c=o.next,o.next=e,e.next=c,a.lastEffect=e)),e}function ji(){return Uh().memoizedState}function ki(e,a,o,c){var d=Th();M.flags|=e,d.memoizedState=bi(1|a,o,void 0,c===void 0?null:c)}function li(e,a,o,c){var d=Uh();c=c===void 0?null:c;var $=void 0;if(N!==null){var g=N.memoizedState;if($=g.destroy,c!==null&&Mh(c,g.deps)){d.memoizedState=bi(a,o,$,c);return}}M.flags|=e,d.memoizedState=bi(1|a,o,$,c)}function mi(e,a){return ki(8390656,8,e,a)}function $h(e,a){return li(2048,8,e,a)}function ni(e,a){return li(4,2,e,a)}function oi(e,a){return li(4,4,e,a)}function pi(e,a){if(typeof a=="function")return e=e(),a(e),function(){a(null)};if(a!=null)return e=e(),a.current=e,function(){a.current=null}}function qi(e,a,o){return o=o!=null?o.concat([e]):null,li(4,4,pi.bind(null,a,e),o)}function ri(){}function si(e,a){var o=Uh();a=a===void 0?null:a;var c=o.memoizedState;return c!==null&&a!==null&&Mh(a,c[1])?c[0]:(o.memoizedState=[e,a],e)}function ti(e,a){var o=Uh();a=a===void 0?null:a;var c=o.memoizedState;return c!==null&&a!==null&&Mh(a,c[1])?c[0]:(e=e(),o.memoizedState=[e,a],e)}function ui(e,a,o){return Hh&21?(He(o,a)||(o=yc(),M.lanes|=o,rh|=o,e.baseState=!0),a):(e.baseState&&(e.baseState=!1,dh=!0),e.memoizedState=o)}function vi(e,a){var o=C;C=o!==0&&4>o?o:4,e(!0);var c=Gh.transition;Gh.transition={};try{e(!1),a()}finally{C=o,Gh.transition=c}}function wi(){return Uh().memoizedState}function xi(e,a,o){var c=yi(e);if(o={lane:c,action:o,hasEagerState:!1,eagerState:null,next:null},zi(e))Ai(a,o);else if(o=hh(e,a,o,c),o!==null){var d=R();gi(o,e,c,d),Bi(o,a,c)}}function ii(e,a,o){var c=yi(e),d={lane:c,action:o,hasEagerState:!1,eagerState:null,next:null};if(zi(e))Ai(a,d);else{var $=e.alternate;if(e.lanes===0&&($===null||$.lanes===0)&&($=a.lastRenderedReducer,$!==null))try{var g=a.lastRenderedState,b=$(g,o);if(d.hasEagerState=!0,d.eagerState=b,He(b,g)){var _=a.interleaved;_===null?(d.next=d,gh(a)):(d.next=_.next,_.next=d),a.interleaved=d;return}}catch{}finally{}o=hh(e,a,d,c),o!==null&&(d=R(),gi(o,e,c,d),Bi(o,a,c))}}function zi(e){var a=e.alternate;return e===M||a!==null&&a===M}function Ai(e,a){Jh=Ih=!0;var o=e.pending;o===null?a.next=a:(a.next=o.next,o.next=a),e.pending=a}function Bi(e,a,o){if(o&4194240){var c=a.lanes;c&=e.pendingLanes,o|=c,a.lanes=o,Cc(e,o)}}var Rh={readContext:eh,useCallback:P,useContext:P,useEffect:P,useImperativeHandle:P,useInsertionEffect:P,useLayoutEffect:P,useMemo:P,useReducer:P,useRef:P,useState:P,useDebugValue:P,useDeferredValue:P,useTransition:P,useMutableSource:P,useSyncExternalStore:P,useId:P,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(e,a){return Th().memoizedState=[e,a===void 0?null:a],e},useContext:eh,useEffect:mi,useImperativeHandle:function(e,a,o){return o=o!=null?o.concat([e]):null,ki(4194308,4,pi.bind(null,a,e),o)},useLayoutEffect:function(e,a){return ki(4194308,4,e,a)},useInsertionEffect:function(e,a){return ki(4,2,e,a)},useMemo:function(e,a){var o=Th();return a=a===void 0?null:a,e=e(),o.memoizedState=[e,a],e},useReducer:function(e,a,o){var c=Th();return a=o!==void 0?o(a):a,c.memoizedState=c.baseState=a,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:a},c.queue=e,e=e.dispatch=xi.bind(null,M,e),[c.memoizedState,e]},useRef:function(e){var a=Th();return e={current:e},a.memoizedState=e},useState:hi,useDebugValue:ri,useDeferredValue:function(e){return Th().memoizedState=e},useTransition:function(){var e=hi(!1),a=e[0];return e=vi.bind(null,e[1]),Th().memoizedState=e,[a,e]},useMutableSource:function(){},useSyncExternalStore:function(e,a,o){var c=M,d=Th();if(I){if(o===void 0)throw Error(p$1(407));o=o()}else{if(o=a(),Q===null)throw Error(p$1(349));Hh&30||di(c,a,o)}d.memoizedState=o;var $={value:o,getSnapshot:a};return d.queue=$,mi(ai.bind(null,c,$,e),[e]),c.flags|=2048,bi(9,ci.bind(null,c,$,o,a),void 0,null),o},useId:function(){var e=Th(),a=Q.identifierPrefix;if(I){var o=sg,c=rg;o=(c&~(1<<32-oc(c)-1)).toString(32)+o,a=":"+a+"R"+o,o=Kh++,0<o&&(a+="H"+o.toString(32)),a+=":"}else o=Lh++,a=":"+a+"r"+o.toString(32)+":";return e.memoizedState=a},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(e){var a=Uh();return ui(a,N.memoizedState,e)},useTransition:function(){var e=Wh(Vh)[0],a=Uh().memoizedState;return[e,a]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(e){var a=Uh();return N===null?a.memoizedState=e:ui(a,N.memoizedState,e)},useTransition:function(){var e=Xh(Vh)[0],a=Uh().memoizedState;return[e,a]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(e,a){if(e&&e.defaultProps){a=A({},a),e=e.defaultProps;for(var o in e)a[o]===void 0&&(a[o]=e[o]);return a}return a}function Di(e,a,o,c){a=e.memoizedState,o=o(c,a),o=o==null?a:A({},a,o),e.memoizedState=o,e.lanes===0&&(e.updateQueue.baseState=o)}var Ei={isMounted:function(e){return(e=e._reactInternals)?Vb(e)===e:!1},enqueueSetState:function(e,a,o){e=e._reactInternals;var c=R(),d=yi(e),$=mh(c,d);$.payload=a,o!=null&&($.callback=o),a=nh(e,$,d),a!==null&&(gi(a,e,d,c),oh(a,e,d))},enqueueReplaceState:function(e,a,o){e=e._reactInternals;var c=R(),d=yi(e),$=mh(c,d);$.tag=1,$.payload=a,o!=null&&($.callback=o),a=nh(e,$,d),a!==null&&(gi(a,e,d,c),oh(a,e,d))},enqueueForceUpdate:function(e,a){e=e._reactInternals;var o=R(),c=yi(e),d=mh(o,c);d.tag=2,a!=null&&(d.callback=a),a=nh(e,d,c),a!==null&&(gi(a,e,c,o),oh(a,e,c))}};function Fi(e,a,o,c,d,$,g){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(c,$,g):a.prototype&&a.prototype.isPureReactComponent?!Ie(o,c)||!Ie(d,$):!0}function Gi(e,a,o){var c=!1,d=Vf,$=a.contextType;return typeof $=="object"&&$!==null?$=eh($):(d=Zf(a)?Xf:H.current,c=a.contextTypes,$=(c=c!=null)?Yf(e,d):Vf),a=new a(o,$),e.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=Ei,e.stateNode=a,a._reactInternals=e,c&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=d,e.__reactInternalMemoizedMaskedChildContext=$),a}function Hi(e,a,o,c){e=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(o,c),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(o,c),a.state!==e&&Ei.enqueueReplaceState(a,a.state,null)}function Ii(e,a,o,c){var d=e.stateNode;d.props=o,d.state=e.memoizedState,d.refs={},kh(e);var $=a.contextType;typeof $=="object"&&$!==null?d.context=eh($):($=Zf(a)?Xf:H.current,d.context=Yf(e,$)),d.state=e.memoizedState,$=a.getDerivedStateFromProps,typeof $=="function"&&(Di(e,a,$,o),d.state=e.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(a=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),a!==d.state&&Ei.enqueueReplaceState(d,d.state,null),qh(e,o,d,c),d.state=e.memoizedState),typeof d.componentDidMount=="function"&&(e.flags|=4194308)}function Ji(e,a){try{var o="",c=a;do o+=Pa(c),c=c.return;while(c);var d=o}catch($){d=`
Error generating stack: `+$.message+`
`+$.stack}return{value:e,source:a,stack:d,digest:null}}function Ki(e,a,o){return{value:e,source:null,stack:o??null,digest:a??null}}function Li(e,a){try{console.error(a.value)}catch(o){setTimeout(function(){throw o})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(e,a,o){o=mh(-1,o),o.tag=3,o.payload={element:null};var c=a.value;return o.callback=function(){Oi||(Oi=!0,Pi=c),Li(e,a)},o}function Qi(e,a,o){o=mh(-1,o),o.tag=3;var c=e.type.getDerivedStateFromError;if(typeof c=="function"){var d=a.value;o.payload=function(){return c(d)},o.callback=function(){Li(e,a)}}var $=e.stateNode;return $!==null&&typeof $.componentDidCatch=="function"&&(o.callback=function(){Li(e,a),typeof c!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var g=a.stack;this.componentDidCatch(a.value,{componentStack:g!==null?g:""})}),o}function Si(e,a,o){var c=e.pingCache;if(c===null){c=e.pingCache=new Mi;var d=new Set;c.set(a,d)}else d=c.get(a),d===void 0&&(d=new Set,c.set(a,d));d.has(o)||(d.add(o),e=Ti.bind(null,e,a,o),a.then(e,e))}function Ui(e){do{var a;if((a=e.tag===13)&&(a=e.memoizedState,a=a!==null?a.dehydrated!==null:!0),a)return e;e=e.return}while(e!==null);return null}function Vi(e,a,o,c,d){return e.mode&1?(e.flags|=65536,e.lanes=d,e):(e===a?e.flags|=65536:(e.flags|=128,o.flags|=131072,o.flags&=-52805,o.tag===1&&(o.alternate===null?o.tag=17:(a=mh(-1,1),a.tag=2,nh(o,a,1))),o.lanes|=1),e)}var Wi=ua.ReactCurrentOwner,dh=!1;function Xi(e,a,o,c){a.child=e===null?Vg(a,null,o,c):Ug(a,e.child,o,c)}function Yi(e,a,o,c,d){o=o.render;var $=a.ref;return ch$1(a,d),c=Nh(e,a,o,c,$,d),o=Sh(),e!==null&&!dh?(a.updateQueue=e.updateQueue,a.flags&=-2053,e.lanes&=~d,Zi(e,a,d)):(I&&o&&vg(a),a.flags|=1,Xi(e,a,c,d),a.child)}function $i(e,a,o,c,d){if(e===null){var $=o.type;return typeof $=="function"&&!aj($)&&$.defaultProps===void 0&&o.compare===null&&o.defaultProps===void 0?(a.tag=15,a.type=$,bj(e,a,$,c,d)):(e=Rg(o.type,null,c,a,a.mode,d),e.ref=a.ref,e.return=a,a.child=e)}if($=e.child,!(e.lanes&d)){var g=$.memoizedProps;if(o=o.compare,o=o!==null?o:Ie,o(g,c)&&e.ref===a.ref)return Zi(e,a,d)}return a.flags|=1,e=Pg($,c),e.ref=a.ref,e.return=a,a.child=e}function bj(e,a,o,c,d){if(e!==null){var $=e.memoizedProps;if(Ie($,c)&&e.ref===a.ref)if(dh=!1,a.pendingProps=c=$,(e.lanes&d)!==0)e.flags&131072&&(dh=!0);else return a.lanes=e.lanes,Zi(e,a,d)}return cj(e,a,o,c,d)}function dj(e,a,o){var c=a.pendingProps,d=c.children,$=e!==null?e.memoizedState:null;if(c.mode==="hidden")if(!(a.mode&1))a.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(ej,fj),fj|=o;else{if(!(o&1073741824))return e=$!==null?$.baseLanes|o:o,a.lanes=a.childLanes=1073741824,a.memoizedState={baseLanes:e,cachePool:null,transitions:null},a.updateQueue=null,G(ej,fj),fj|=e,null;a.memoizedState={baseLanes:0,cachePool:null,transitions:null},c=$!==null?$.baseLanes:o,G(ej,fj),fj|=c}else $!==null?(c=$.baseLanes|o,a.memoizedState=null):c=o,G(ej,fj),fj|=c;return Xi(e,a,d,o),a.child}function gj(e,a){var o=a.ref;(e===null&&o!==null||e!==null&&e.ref!==o)&&(a.flags|=512,a.flags|=2097152)}function cj(e,a,o,c,d){var $=Zf(o)?Xf:H.current;return $=Yf(a,$),ch$1(a,d),o=Nh(e,a,o,c,$,d),c=Sh(),e!==null&&!dh?(a.updateQueue=e.updateQueue,a.flags&=-2053,e.lanes&=~d,Zi(e,a,d)):(I&&c&&vg(a),a.flags|=1,Xi(e,a,o,d),a.child)}function hj(e,a,o,c,d){if(Zf(o)){var $=!0;cg(a)}else $=!1;if(ch$1(a,d),a.stateNode===null)ij(e,a),Gi(a,o,c),Ii(a,o,c,d),c=!0;else if(e===null){var g=a.stateNode,b=a.memoizedProps;g.props=b;var _=g.context,j=o.contextType;typeof j=="object"&&j!==null?j=eh(j):(j=Zf(o)?Xf:H.current,j=Yf(a,j));var _e=o.getDerivedStateFromProps,et=typeof _e=="function"||typeof g.getSnapshotBeforeUpdate=="function";et||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(b!==c||_!==j)&&Hi(a,g,c,j),jh=!1;var tt=a.memoizedState;g.state=tt,qh(a,c,g,d),_=a.memoizedState,b!==c||tt!==_||Wf.current||jh?(typeof _e=="function"&&(Di(a,o,_e,c),_=a.memoizedState),(b=jh||Fi(a,o,b,c,tt,_,j))?(et||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(a.flags|=4194308)):(typeof g.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=c,a.memoizedState=_),g.props=c,g.state=_,g.context=j,c=b):(typeof g.componentDidMount=="function"&&(a.flags|=4194308),c=!1)}else{g=a.stateNode,lh(e,a),b=a.memoizedProps,j=a.type===a.elementType?b:Ci(a.type,b),g.props=j,et=a.pendingProps,tt=g.context,_=o.contextType,typeof _=="object"&&_!==null?_=eh(_):(_=Zf(o)?Xf:H.current,_=Yf(a,_));var nt=o.getDerivedStateFromProps;(_e=typeof nt=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(b!==et||tt!==_)&&Hi(a,g,c,_),jh=!1,tt=a.memoizedState,g.state=tt,qh(a,c,g,d);var at=a.memoizedState;b!==et||tt!==at||Wf.current||jh?(typeof nt=="function"&&(Di(a,o,nt,c),at=a.memoizedState),(j=jh||Fi(a,o,j,c,tt,at,_)||!1)?(_e||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(c,at,_),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(c,at,_)),typeof g.componentDidUpdate=="function"&&(a.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof g.componentDidUpdate!="function"||b===e.memoizedProps&&tt===e.memoizedState||(a.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||b===e.memoizedProps&&tt===e.memoizedState||(a.flags|=1024),a.memoizedProps=c,a.memoizedState=at),g.props=c,g.state=at,g.context=_,c=j):(typeof g.componentDidUpdate!="function"||b===e.memoizedProps&&tt===e.memoizedState||(a.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||b===e.memoizedProps&&tt===e.memoizedState||(a.flags|=1024),c=!1)}return jj(e,a,o,c,$,d)}function jj(e,a,o,c,d,$){gj(e,a);var g=(a.flags&128)!==0;if(!c&&!g)return d&&dg(a,o,!1),Zi(e,a,$);c=a.stateNode,Wi.current=a;var b=g&&typeof o.getDerivedStateFromError!="function"?null:c.render();return a.flags|=1,e!==null&&g?(a.child=Ug(a,e.child,null,$),a.child=Ug(a,null,b,$)):Xi(e,a,b,$),a.memoizedState=c.state,d&&dg(a,o,!0),a.child}function kj(e){var a=e.stateNode;a.pendingContext?ag(e,a.pendingContext,a.pendingContext!==a.context):a.context&&ag(e,a.context,!1),yh(e,a.containerInfo)}function lj(e,a,o,c,d){return Ig(),Jg(d),a.flags|=256,Xi(e,a,o,c),a.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(e){return{baseLanes:e,cachePool:null,transitions:null}}function oj(e,a,o){var c=a.pendingProps,d=L.current,$=!1,g=(a.flags&128)!==0,b;if((b=g)||(b=e!==null&&e.memoizedState===null?!1:(d&2)!==0),b?($=!0,a.flags&=-129):(e===null||e.memoizedState!==null)&&(d|=1),G(L,d&1),e===null)return Eg(a),e=a.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(a.mode&1?e.data==="$!"?a.lanes=8:a.lanes=1073741824:a.lanes=1,null):(g=c.children,e=c.fallback,$?(c=a.mode,$=a.child,g={mode:"hidden",children:g},!(c&1)&&$!==null?($.childLanes=0,$.pendingProps=g):$=pj(g,c,0,null),e=Tg(e,c,o,null),$.return=a,e.return=a,$.sibling=e,a.child=$,a.child.memoizedState=nj(o),a.memoizedState=mj,e):qj(a,g));if(d=e.memoizedState,d!==null&&(b=d.dehydrated,b!==null))return rj(e,a,g,c,b,d,o);if($){$=c.fallback,g=a.mode,d=e.child,b=d.sibling;var _={mode:"hidden",children:c.children};return!(g&1)&&a.child!==d?(c=a.child,c.childLanes=0,c.pendingProps=_,a.deletions=null):(c=Pg(d,_),c.subtreeFlags=d.subtreeFlags&14680064),b!==null?$=Pg(b,$):($=Tg($,g,o,null),$.flags|=2),$.return=a,c.return=a,c.sibling=$,a.child=c,c=$,$=a.child,g=e.child.memoizedState,g=g===null?nj(o):{baseLanes:g.baseLanes|o,cachePool:null,transitions:g.transitions},$.memoizedState=g,$.childLanes=e.childLanes&~o,a.memoizedState=mj,c}return $=e.child,e=$.sibling,c=Pg($,{mode:"visible",children:c.children}),!(a.mode&1)&&(c.lanes=o),c.return=a,c.sibling=null,e!==null&&(o=a.deletions,o===null?(a.deletions=[e],a.flags|=16):o.push(e)),a.child=c,a.memoizedState=null,c}function qj(e,a){return a=pj({mode:"visible",children:a},e.mode,0,null),a.return=e,e.child=a}function sj(e,a,o,c){return c!==null&&Jg(c),Ug(a,e.child,null,o),e=qj(a,a.pendingProps.children),e.flags|=2,a.memoizedState=null,e}function rj(e,a,o,c,d,$,g){if(o)return a.flags&256?(a.flags&=-257,c=Ki(Error(p$1(422))),sj(e,a,g,c)):a.memoizedState!==null?(a.child=e.child,a.flags|=128,null):($=c.fallback,d=a.mode,c=pj({mode:"visible",children:c.children},d,0,null),$=Tg($,d,g,null),$.flags|=2,c.return=a,$.return=a,c.sibling=$,a.child=c,a.mode&1&&Ug(a,e.child,null,g),a.child.memoizedState=nj(g),a.memoizedState=mj,$);if(!(a.mode&1))return sj(e,a,g,null);if(d.data==="$!"){if(c=d.nextSibling&&d.nextSibling.dataset,c)var b=c.dgst;return c=b,$=Error(p$1(419)),c=Ki($,c,void 0),sj(e,a,g,c)}if(b=(g&e.childLanes)!==0,dh||b){if(c=Q,c!==null){switch(g&-g){case 4:d=2;break;case 16:d=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:d=32;break;case 536870912:d=268435456;break;default:d=0}d=d&(c.suspendedLanes|g)?0:d,d!==0&&d!==$.retryLane&&($.retryLane=d,ih(e,d),gi(c,e,d,-1))}return tj(),c=Ki(Error(p$1(421))),sj(e,a,g,c)}return d.data==="$?"?(a.flags|=128,a.child=e.child,a=uj.bind(null,e),d._reactRetry=a,null):(e=$.treeContext,yg=Lf(d.nextSibling),xg=a,I=!0,zg=null,e!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=e.id,sg=e.overflow,qg=a),a=qj(a,c.children),a.flags|=4096,a)}function vj(e,a,o){e.lanes|=a;var c=e.alternate;c!==null&&(c.lanes|=a),bh(e.return,a,o)}function wj(e,a,o,c,d){var $=e.memoizedState;$===null?e.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:c,tail:o,tailMode:d}:($.isBackwards=a,$.rendering=null,$.renderingStartTime=0,$.last=c,$.tail=o,$.tailMode=d)}function xj(e,a,o){var c=a.pendingProps,d=c.revealOrder,$=c.tail;if(Xi(e,a,c.children,o),c=L.current,c&2)c=c&1|2,a.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=a.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&vj(e,o,a);else if(e.tag===19)vj(e,o,a);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===a)break e;for(;e.sibling===null;){if(e.return===null||e.return===a)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}c&=1}if(G(L,c),!(a.mode&1))a.memoizedState=null;else switch(d){case"forwards":for(o=a.child,d=null;o!==null;)e=o.alternate,e!==null&&Ch(e)===null&&(d=o),o=o.sibling;o=d,o===null?(d=a.child,a.child=null):(d=o.sibling,o.sibling=null),wj(a,!1,d,o,$);break;case"backwards":for(o=null,d=a.child,a.child=null;d!==null;){if(e=d.alternate,e!==null&&Ch(e)===null){a.child=d;break}e=d.sibling,d.sibling=o,o=d,d=e}wj(a,!0,o,null,$);break;case"together":wj(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function ij(e,a){!(a.mode&1)&&e!==null&&(e.alternate=null,a.alternate=null,a.flags|=2)}function Zi(e,a,o){if(e!==null&&(a.dependencies=e.dependencies),rh|=a.lanes,!(o&a.childLanes))return null;if(e!==null&&a.child!==e.child)throw Error(p$1(153));if(a.child!==null){for(e=a.child,o=Pg(e,e.pendingProps),a.child=o,o.return=a;e.sibling!==null;)e=e.sibling,o=o.sibling=Pg(e,e.pendingProps),o.return=a;o.sibling=null}return a.child}function yj(e,a,o){switch(a.tag){case 3:kj(a),Ig();break;case 5:Ah(a);break;case 1:Zf(a.type)&&cg(a);break;case 4:yh(a,a.stateNode.containerInfo);break;case 10:var c=a.type._context,d=a.memoizedProps.value;G(Wg,c._currentValue),c._currentValue=d;break;case 13:if(c=a.memoizedState,c!==null)return c.dehydrated!==null?(G(L,L.current&1),a.flags|=128,null):o&a.child.childLanes?oj(e,a,o):(G(L,L.current&1),e=Zi(e,a,o),e!==null?e.sibling:null);G(L,L.current&1);break;case 19:if(c=(o&a.childLanes)!==0,e.flags&128){if(c)return xj(e,a,o);a.flags|=128}if(d=a.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),G(L,L.current),c)break;return null;case 22:case 23:return a.lanes=0,dj(e,a,o)}return Zi(e,a,o)}var zj,Aj,Bj,Cj;zj=function(e,a){for(var o=a.child;o!==null;){if(o.tag===5||o.tag===6)e.appendChild(o.stateNode);else if(o.tag!==4&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};Aj=function(){};Bj=function(e,a,o,c){var d=e.memoizedProps;if(d!==c){e=a.stateNode,xh(uh.current);var $=null;switch(o){case"input":d=Ya(e,d),c=Ya(e,c),$=[];break;case"select":d=A({},d,{value:void 0}),c=A({},c,{value:void 0}),$=[];break;case"textarea":d=gb(e,d),c=gb(e,c),$=[];break;default:typeof d.onClick!="function"&&typeof c.onClick=="function"&&(e.onclick=Bf)}ub(o,c);var g;o=null;for(j in d)if(!c.hasOwnProperty(j)&&d.hasOwnProperty(j)&&d[j]!=null)if(j==="style"){var b=d[j];for(g in b)b.hasOwnProperty(g)&&(o||(o={}),o[g]="")}else j!=="dangerouslySetInnerHTML"&&j!=="children"&&j!=="suppressContentEditableWarning"&&j!=="suppressHydrationWarning"&&j!=="autoFocus"&&(ea.hasOwnProperty(j)?$||($=[]):($=$||[]).push(j,null));for(j in c){var _=c[j];if(b=d!=null?d[j]:void 0,c.hasOwnProperty(j)&&_!==b&&(_!=null||b!=null))if(j==="style")if(b){for(g in b)!b.hasOwnProperty(g)||_&&_.hasOwnProperty(g)||(o||(o={}),o[g]="");for(g in _)_.hasOwnProperty(g)&&b[g]!==_[g]&&(o||(o={}),o[g]=_[g])}else o||($||($=[]),$.push(j,o)),o=_;else j==="dangerouslySetInnerHTML"?(_=_?_.__html:void 0,b=b?b.__html:void 0,_!=null&&b!==_&&($=$||[]).push(j,_)):j==="children"?typeof _!="string"&&typeof _!="number"||($=$||[]).push(j,""+_):j!=="suppressContentEditableWarning"&&j!=="suppressHydrationWarning"&&(ea.hasOwnProperty(j)?(_!=null&&j==="onScroll"&&D$1("scroll",e),$||b===_||($=[])):($=$||[]).push(j,_))}o&&($=$||[]).push("style",o);var j=$;(a.updateQueue=j)&&(a.flags|=4)}};Cj=function(e,a,o,c){o!==c&&(a.flags|=4)};function Dj(e,a){if(!I)switch(e.tailMode){case"hidden":a=e.tail;for(var o=null;a!==null;)a.alternate!==null&&(o=a),a=a.sibling;o===null?e.tail=null:o.sibling=null;break;case"collapsed":o=e.tail;for(var c=null;o!==null;)o.alternate!==null&&(c=o),o=o.sibling;c===null?a||e.tail===null?e.tail=null:e.tail.sibling=null:c.sibling=null}}function S$1(e){var a=e.alternate!==null&&e.alternate.child===e.child,o=0,c=0;if(a)for(var d=e.child;d!==null;)o|=d.lanes|d.childLanes,c|=d.subtreeFlags&14680064,c|=d.flags&14680064,d.return=e,d=d.sibling;else for(d=e.child;d!==null;)o|=d.lanes|d.childLanes,c|=d.subtreeFlags,c|=d.flags,d.return=e,d=d.sibling;return e.subtreeFlags|=c,e.childLanes=o,a}function Ej(e,a,o){var c=a.pendingProps;switch(wg(a),a.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S$1(a),null;case 1:return Zf(a.type)&&$f(),S$1(a),null;case 3:return c=a.stateNode,zh(),E(Wf),E(H),Eh(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(e===null||e.child===null)&&(Gg(a)?a.flags|=4:e===null||e.memoizedState.isDehydrated&&!(a.flags&256)||(a.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(e,a),S$1(a),null;case 5:Bh(a);var d=xh(wh.current);if(o=a.type,e!==null&&a.stateNode!=null)Bj(e,a,o,c,d),e.ref!==a.ref&&(a.flags|=512,a.flags|=2097152);else{if(!c){if(a.stateNode===null)throw Error(p$1(166));return S$1(a),null}if(e=xh(uh.current),Gg(a)){c=a.stateNode,o=a.type;var $=a.memoizedProps;switch(c[Of]=a,c[Pf]=$,e=(a.mode&1)!==0,o){case"dialog":D$1("cancel",c),D$1("close",c);break;case"iframe":case"object":case"embed":D$1("load",c);break;case"video":case"audio":for(d=0;d<lf.length;d++)D$1(lf[d],c);break;case"source":D$1("error",c);break;case"img":case"image":case"link":D$1("error",c),D$1("load",c);break;case"details":D$1("toggle",c);break;case"input":Za(c,$),D$1("invalid",c);break;case"select":c._wrapperState={wasMultiple:!!$.multiple},D$1("invalid",c);break;case"textarea":hb(c,$),D$1("invalid",c)}ub(o,$),d=null;for(var g in $)if($.hasOwnProperty(g)){var b=$[g];g==="children"?typeof b=="string"?c.textContent!==b&&($.suppressHydrationWarning!==!0&&Af(c.textContent,b,e),d=["children",b]):typeof b=="number"&&c.textContent!==""+b&&($.suppressHydrationWarning!==!0&&Af(c.textContent,b,e),d=["children",""+b]):ea.hasOwnProperty(g)&&b!=null&&g==="onScroll"&&D$1("scroll",c)}switch(o){case"input":Va(c),db(c,$,!0);break;case"textarea":Va(c),jb(c);break;case"select":case"option":break;default:typeof $.onClick=="function"&&(c.onclick=Bf)}c=d,a.updateQueue=c,c!==null&&(a.flags|=4)}else{g=d.nodeType===9?d:d.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=kb(o)),e==="http://www.w3.org/1999/xhtml"?o==="script"?(e=g.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof c.is=="string"?e=g.createElement(o,{is:c.is}):(e=g.createElement(o),o==="select"&&(g=e,c.multiple?g.multiple=!0:c.size&&(g.size=c.size))):e=g.createElementNS(e,o),e[Of]=a,e[Pf]=c,zj(e,a,!1,!1),a.stateNode=e;e:{switch(g=vb(o,c),o){case"dialog":D$1("cancel",e),D$1("close",e),d=c;break;case"iframe":case"object":case"embed":D$1("load",e),d=c;break;case"video":case"audio":for(d=0;d<lf.length;d++)D$1(lf[d],e);d=c;break;case"source":D$1("error",e),d=c;break;case"img":case"image":case"link":D$1("error",e),D$1("load",e),d=c;break;case"details":D$1("toggle",e),d=c;break;case"input":Za(e,c),d=Ya(e,c),D$1("invalid",e);break;case"option":d=c;break;case"select":e._wrapperState={wasMultiple:!!c.multiple},d=A({},c,{value:void 0}),D$1("invalid",e);break;case"textarea":hb(e,c),d=gb(e,c),D$1("invalid",e);break;default:d=c}ub(o,d),b=d;for($ in b)if(b.hasOwnProperty($)){var _=b[$];$==="style"?sb(e,_):$==="dangerouslySetInnerHTML"?(_=_?_.__html:void 0,_!=null&&nb(e,_)):$==="children"?typeof _=="string"?(o!=="textarea"||_!=="")&&ob(e,_):typeof _=="number"&&ob(e,""+_):$!=="suppressContentEditableWarning"&&$!=="suppressHydrationWarning"&&$!=="autoFocus"&&(ea.hasOwnProperty($)?_!=null&&$==="onScroll"&&D$1("scroll",e):_!=null&&ta(e,$,_,g))}switch(o){case"input":Va(e),db(e,c,!1);break;case"textarea":Va(e),jb(e);break;case"option":c.value!=null&&e.setAttribute("value",""+Sa(c.value));break;case"select":e.multiple=!!c.multiple,$=c.value,$!=null?fb(e,!!c.multiple,$,!1):c.defaultValue!=null&&fb(e,!!c.multiple,c.defaultValue,!0);break;default:typeof d.onClick=="function"&&(e.onclick=Bf)}switch(o){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}}c&&(a.flags|=4)}a.ref!==null&&(a.flags|=512,a.flags|=2097152)}return S$1(a),null;case 6:if(e&&a.stateNode!=null)Cj(e,a,e.memoizedProps,c);else{if(typeof c!="string"&&a.stateNode===null)throw Error(p$1(166));if(o=xh(wh.current),xh(uh.current),Gg(a)){if(c=a.stateNode,o=a.memoizedProps,c[Of]=a,($=c.nodeValue!==o)&&(e=xg,e!==null))switch(e.tag){case 3:Af(c.nodeValue,o,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Af(c.nodeValue,o,(e.mode&1)!==0)}$&&(a.flags|=4)}else c=(o.nodeType===9?o:o.ownerDocument).createTextNode(c),c[Of]=a,a.stateNode=c}return S$1(a),null;case 13:if(E(L),c=a.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(I&&yg!==null&&a.mode&1&&!(a.flags&128))Hg(),Ig(),a.flags|=98560,$=!1;else if($=Gg(a),c!==null&&c.dehydrated!==null){if(e===null){if(!$)throw Error(p$1(318));if($=a.memoizedState,$=$!==null?$.dehydrated:null,!$)throw Error(p$1(317));$[Of]=a}else Ig(),!(a.flags&128)&&(a.memoizedState=null),a.flags|=4;S$1(a),$=!1}else zg!==null&&(Fj(zg),zg=null),$=!0;if(!$)return a.flags&65536?a:null}return a.flags&128?(a.lanes=o,a):(c=c!==null,c!==(e!==null&&e.memoizedState!==null)&&c&&(a.child.flags|=8192,a.mode&1&&(e===null||L.current&1?T$1===0&&(T$1=3):tj())),a.updateQueue!==null&&(a.flags|=4),S$1(a),null);case 4:return zh(),Aj(e,a),e===null&&sf(a.stateNode.containerInfo),S$1(a),null;case 10:return ah(a.type._context),S$1(a),null;case 17:return Zf(a.type)&&$f(),S$1(a),null;case 19:if(E(L),$=a.memoizedState,$===null)return S$1(a),null;if(c=(a.flags&128)!==0,g=$.rendering,g===null)if(c)Dj($,!1);else{if(T$1!==0||e!==null&&e.flags&128)for(e=a.child;e!==null;){if(g=Ch(e),g!==null){for(a.flags|=128,Dj($,!1),c=g.updateQueue,c!==null&&(a.updateQueue=c,a.flags|=4),a.subtreeFlags=0,c=o,o=a.child;o!==null;)$=o,e=c,$.flags&=14680066,g=$.alternate,g===null?($.childLanes=0,$.lanes=e,$.child=null,$.subtreeFlags=0,$.memoizedProps=null,$.memoizedState=null,$.updateQueue=null,$.dependencies=null,$.stateNode=null):($.childLanes=g.childLanes,$.lanes=g.lanes,$.child=g.child,$.subtreeFlags=0,$.deletions=null,$.memoizedProps=g.memoizedProps,$.memoizedState=g.memoizedState,$.updateQueue=g.updateQueue,$.type=g.type,e=g.dependencies,$.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),o=o.sibling;return G(L,L.current&1|2),a.child}e=e.sibling}$.tail!==null&&B()>Gj&&(a.flags|=128,c=!0,Dj($,!1),a.lanes=4194304)}else{if(!c)if(e=Ch(g),e!==null){if(a.flags|=128,c=!0,o=e.updateQueue,o!==null&&(a.updateQueue=o,a.flags|=4),Dj($,!0),$.tail===null&&$.tailMode==="hidden"&&!g.alternate&&!I)return S$1(a),null}else 2*B()-$.renderingStartTime>Gj&&o!==1073741824&&(a.flags|=128,c=!0,Dj($,!1),a.lanes=4194304);$.isBackwards?(g.sibling=a.child,a.child=g):(o=$.last,o!==null?o.sibling=g:a.child=g,$.last=g)}return $.tail!==null?(a=$.tail,$.rendering=a,$.tail=a.sibling,$.renderingStartTime=B(),a.sibling=null,o=L.current,G(L,c?o&1|2:o&1),a):(S$1(a),null);case 22:case 23:return Hj(),c=a.memoizedState!==null,e!==null&&e.memoizedState!==null!==c&&(a.flags|=8192),c&&a.mode&1?fj&1073741824&&(S$1(a),a.subtreeFlags&6&&(a.flags|=8192)):S$1(a),null;case 24:return null;case 25:return null}throw Error(p$1(156,a.tag))}function Ij(e,a){switch(wg(a),a.tag){case 1:return Zf(a.type)&&$f(),e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 3:return zh(),E(Wf),E(H),Eh(),e=a.flags,e&65536&&!(e&128)?(a.flags=e&-65537|128,a):null;case 5:return Bh(a),null;case 13:if(E(L),e=a.memoizedState,e!==null&&e.dehydrated!==null){if(a.alternate===null)throw Error(p$1(340));Ig()}return e=a.flags,e&65536?(a.flags=e&-65537|128,a):null;case 19:return E(L),null;case 4:return zh(),null;case 10:return ah(a.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Lj(e,a){var o=e.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(c){W(e,a,c)}else o.current=null}function Mj(e,a,o){try{o()}catch(c){W(e,a,c)}}var Nj=!1;function Oj(e,a){if(Cf=dd,e=Me(),Ne(e)){if("selectionStart"in e)var o={start:e.selectionStart,end:e.selectionEnd};else e:{o=(o=e.ownerDocument)&&o.defaultView||window;var c=o.getSelection&&o.getSelection();if(c&&c.rangeCount!==0){o=c.anchorNode;var d=c.anchorOffset,$=c.focusNode;c=c.focusOffset;try{o.nodeType,$.nodeType}catch{o=null;break e}var g=0,b=-1,_=-1,j=0,_e=0,et=e,tt=null;t:for(;;){for(var nt;et!==o||d!==0&&et.nodeType!==3||(b=g+d),et!==$||c!==0&&et.nodeType!==3||(_=g+c),et.nodeType===3&&(g+=et.nodeValue.length),(nt=et.firstChild)!==null;)tt=et,et=nt;for(;;){if(et===e)break t;if(tt===o&&++j===d&&(b=g),tt===$&&++_e===c&&(_=g),(nt=et.nextSibling)!==null)break;et=tt,tt=et.parentNode}et=nt}o=b===-1||_===-1?null:{start:b,end:_}}else o=null}o=o||{start:0,end:0}}else o=null;for(Df={focusedElem:e,selectionRange:o},dd=!1,V=a;V!==null;)if(a=V,e=a.child,(a.subtreeFlags&1028)!==0&&e!==null)e.return=a,V=e;else for(;V!==null;){a=V;try{var at=a.alternate;if(a.flags&1024)switch(a.tag){case 0:case 11:case 15:break;case 1:if(at!==null){var lt=at.memoizedProps,mt=at.memoizedState,ot=a.stateNode,st=ot.getSnapshotBeforeUpdate(a.elementType===a.type?lt:Ci(a.type,lt),mt);ot.__reactInternalSnapshotBeforeUpdate=st}break;case 3:var ut=a.stateNode.containerInfo;ut.nodeType===1?ut.textContent="":ut.nodeType===9&&ut.documentElement&&ut.removeChild(ut.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p$1(163))}}catch(pt){W(a,a.return,pt)}if(e=a.sibling,e!==null){e.return=a.return,V=e;break}V=a.return}return at=Nj,Nj=!1,at}function Pj(e,a,o){var c=a.updateQueue;if(c=c!==null?c.lastEffect:null,c!==null){var d=c=c.next;do{if((d.tag&e)===e){var $=d.destroy;d.destroy=void 0,$!==void 0&&Mj(a,o,$)}d=d.next}while(d!==c)}}function Qj(e,a){if(a=a.updateQueue,a=a!==null?a.lastEffect:null,a!==null){var o=a=a.next;do{if((o.tag&e)===e){var c=o.create;o.destroy=c()}o=o.next}while(o!==a)}}function Rj(e){var a=e.ref;if(a!==null){var o=e.stateNode;switch(e.tag){case 5:e=o;break;default:e=o}typeof a=="function"?a(e):a.current=e}}function Sj(e){var a=e.alternate;a!==null&&(e.alternate=null,Sj(a)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(a=e.stateNode,a!==null&&(delete a[Of],delete a[Pf],delete a[of],delete a[Qf],delete a[Rf])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Tj(e){return e.tag===5||e.tag===3||e.tag===4}function Uj(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Tj(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Vj(e,a,o){var c=e.tag;if(c===5||c===6)e=e.stateNode,a?o.nodeType===8?o.parentNode.insertBefore(e,a):o.insertBefore(e,a):(o.nodeType===8?(a=o.parentNode,a.insertBefore(e,o)):(a=o,a.appendChild(e)),o=o._reactRootContainer,o!=null||a.onclick!==null||(a.onclick=Bf));else if(c!==4&&(e=e.child,e!==null))for(Vj(e,a,o),e=e.sibling;e!==null;)Vj(e,a,o),e=e.sibling}function Wj(e,a,o){var c=e.tag;if(c===5||c===6)e=e.stateNode,a?o.insertBefore(e,a):o.appendChild(e);else if(c!==4&&(e=e.child,e!==null))for(Wj(e,a,o),e=e.sibling;e!==null;)Wj(e,a,o),e=e.sibling}var X$1=null,Xj=!1;function Yj(e,a,o){for(o=o.child;o!==null;)Zj(e,a,o),o=o.sibling}function Zj(e,a,o){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,o)}catch{}switch(o.tag){case 5:U||Lj(o,a);case 6:var c=X$1,d=Xj;X$1=null,Yj(e,a,o),X$1=c,Xj=d,X$1!==null&&(Xj?(e=X$1,o=o.stateNode,e.nodeType===8?e.parentNode.removeChild(o):e.removeChild(o)):X$1.removeChild(o.stateNode));break;case 18:X$1!==null&&(Xj?(e=X$1,o=o.stateNode,e.nodeType===8?Kf(e.parentNode,o):e.nodeType===1&&Kf(e,o),bd(e)):Kf(X$1,o.stateNode));break;case 4:c=X$1,d=Xj,X$1=o.stateNode.containerInfo,Xj=!0,Yj(e,a,o),X$1=c,Xj=d;break;case 0:case 11:case 14:case 15:if(!U&&(c=o.updateQueue,c!==null&&(c=c.lastEffect,c!==null))){d=c=c.next;do{var $=d,g=$.destroy;$=$.tag,g!==void 0&&($&2||$&4)&&Mj(o,a,g),d=d.next}while(d!==c)}Yj(e,a,o);break;case 1:if(!U&&(Lj(o,a),c=o.stateNode,typeof c.componentWillUnmount=="function"))try{c.props=o.memoizedProps,c.state=o.memoizedState,c.componentWillUnmount()}catch(b){W(o,a,b)}Yj(e,a,o);break;case 21:Yj(e,a,o);break;case 22:o.mode&1?(U=(c=U)||o.memoizedState!==null,Yj(e,a,o),U=c):Yj(e,a,o);break;default:Yj(e,a,o)}}function ak(e){var a=e.updateQueue;if(a!==null){e.updateQueue=null;var o=e.stateNode;o===null&&(o=e.stateNode=new Kj),a.forEach(function(c){var d=bk.bind(null,e,c);o.has(c)||(o.add(c),c.then(d,d))})}}function ck(e,a){var o=a.deletions;if(o!==null)for(var c=0;c<o.length;c++){var d=o[c];try{var $=e,g=a,b=g;e:for(;b!==null;){switch(b.tag){case 5:X$1=b.stateNode,Xj=!1;break e;case 3:X$1=b.stateNode.containerInfo,Xj=!0;break e;case 4:X$1=b.stateNode.containerInfo,Xj=!0;break e}b=b.return}if(X$1===null)throw Error(p$1(160));Zj($,g,d),X$1=null,Xj=!1;var _=d.alternate;_!==null&&(_.return=null),d.return=null}catch(j){W(d,a,j)}}if(a.subtreeFlags&12854)for(a=a.child;a!==null;)dk(a,e),a=a.sibling}function dk(e,a){var o=e.alternate,c=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ck(a,e),ek(e),c&4){try{Pj(3,e,e.return),Qj(3,e)}catch(lt){W(e,e.return,lt)}try{Pj(5,e,e.return)}catch(lt){W(e,e.return,lt)}}break;case 1:ck(a,e),ek(e),c&512&&o!==null&&Lj(o,o.return);break;case 5:if(ck(a,e),ek(e),c&512&&o!==null&&Lj(o,o.return),e.flags&32){var d=e.stateNode;try{ob(d,"")}catch(lt){W(e,e.return,lt)}}if(c&4&&(d=e.stateNode,d!=null)){var $=e.memoizedProps,g=o!==null?o.memoizedProps:$,b=e.type,_=e.updateQueue;if(e.updateQueue=null,_!==null)try{b==="input"&&$.type==="radio"&&$.name!=null&&ab(d,$),vb(b,g);var j=vb(b,$);for(g=0;g<_.length;g+=2){var _e=_[g],et=_[g+1];_e==="style"?sb(d,et):_e==="dangerouslySetInnerHTML"?nb(d,et):_e==="children"?ob(d,et):ta(d,_e,et,j)}switch(b){case"input":bb(d,$);break;case"textarea":ib(d,$);break;case"select":var tt=d._wrapperState.wasMultiple;d._wrapperState.wasMultiple=!!$.multiple;var nt=$.value;nt!=null?fb(d,!!$.multiple,nt,!1):tt!==!!$.multiple&&($.defaultValue!=null?fb(d,!!$.multiple,$.defaultValue,!0):fb(d,!!$.multiple,$.multiple?[]:"",!1))}d[Pf]=$}catch(lt){W(e,e.return,lt)}}break;case 6:if(ck(a,e),ek(e),c&4){if(e.stateNode===null)throw Error(p$1(162));d=e.stateNode,$=e.memoizedProps;try{d.nodeValue=$}catch(lt){W(e,e.return,lt)}}break;case 3:if(ck(a,e),ek(e),c&4&&o!==null&&o.memoizedState.isDehydrated)try{bd(a.containerInfo)}catch(lt){W(e,e.return,lt)}break;case 4:ck(a,e),ek(e);break;case 13:ck(a,e),ek(e),d=e.child,d.flags&8192&&($=d.memoizedState!==null,d.stateNode.isHidden=$,!$||d.alternate!==null&&d.alternate.memoizedState!==null||(fk=B())),c&4&&ak(e);break;case 22:if(_e=o!==null&&o.memoizedState!==null,e.mode&1?(U=(j=U)||_e,ck(a,e),U=j):ck(a,e),ek(e),c&8192){if(j=e.memoizedState!==null,(e.stateNode.isHidden=j)&&!_e&&e.mode&1)for(V=e,_e=e.child;_e!==null;){for(et=V=_e;V!==null;){switch(tt=V,nt=tt.child,tt.tag){case 0:case 11:case 14:case 15:Pj(4,tt,tt.return);break;case 1:Lj(tt,tt.return);var at=tt.stateNode;if(typeof at.componentWillUnmount=="function"){c=tt,o=tt.return;try{a=c,at.props=a.memoizedProps,at.state=a.memoizedState,at.componentWillUnmount()}catch(lt){W(c,o,lt)}}break;case 5:Lj(tt,tt.return);break;case 22:if(tt.memoizedState!==null){gk(et);continue}}nt!==null?(nt.return=tt,V=nt):gk(et)}_e=_e.sibling}e:for(_e=null,et=e;;){if(et.tag===5){if(_e===null){_e=et;try{d=et.stateNode,j?($=d.style,typeof $.setProperty=="function"?$.setProperty("display","none","important"):$.display="none"):(b=et.stateNode,_=et.memoizedProps.style,g=_!=null&&_.hasOwnProperty("display")?_.display:null,b.style.display=rb("display",g))}catch(lt){W(e,e.return,lt)}}}else if(et.tag===6){if(_e===null)try{et.stateNode.nodeValue=j?"":et.memoizedProps}catch(lt){W(e,e.return,lt)}}else if((et.tag!==22&&et.tag!==23||et.memoizedState===null||et===e)&&et.child!==null){et.child.return=et,et=et.child;continue}if(et===e)break e;for(;et.sibling===null;){if(et.return===null||et.return===e)break e;_e===et&&(_e=null),et=et.return}_e===et&&(_e=null),et.sibling.return=et.return,et=et.sibling}}break;case 19:ck(a,e),ek(e),c&4&&ak(e);break;case 21:break;default:ck(a,e),ek(e)}}function ek(e){var a=e.flags;if(a&2){try{e:{for(var o=e.return;o!==null;){if(Tj(o)){var c=o;break e}o=o.return}throw Error(p$1(160))}switch(c.tag){case 5:var d=c.stateNode;c.flags&32&&(ob(d,""),c.flags&=-33);var $=Uj(e);Wj(e,$,d);break;case 3:case 4:var g=c.stateNode.containerInfo,b=Uj(e);Vj(e,b,g);break;default:throw Error(p$1(161))}}catch(_){W(e,e.return,_)}e.flags&=-3}a&4096&&(e.flags&=-4097)}function hk(e,a,o){V=e,ik(e)}function ik(e,a,o){for(var c=(e.mode&1)!==0;V!==null;){var d=V,$=d.child;if(d.tag===22&&c){var g=d.memoizedState!==null||Jj;if(!g){var b=d.alternate,_=b!==null&&b.memoizedState!==null||U;b=Jj;var j=U;if(Jj=g,(U=_)&&!j)for(V=d;V!==null;)g=V,_=g.child,g.tag===22&&g.memoizedState!==null?jk(d):_!==null?(_.return=g,V=_):jk(d);for(;$!==null;)V=$,ik($),$=$.sibling;V=d,Jj=b,U=j}kk(e)}else d.subtreeFlags&8772&&$!==null?($.return=d,V=$):kk(e)}}function kk(e){for(;V!==null;){var a=V;if(a.flags&8772){var o=a.alternate;try{if(a.flags&8772)switch(a.tag){case 0:case 11:case 15:U||Qj(5,a);break;case 1:var c=a.stateNode;if(a.flags&4&&!U)if(o===null)c.componentDidMount();else{var d=a.elementType===a.type?o.memoizedProps:Ci(a.type,o.memoizedProps);c.componentDidUpdate(d,o.memoizedState,c.__reactInternalSnapshotBeforeUpdate)}var $=a.updateQueue;$!==null&&sh(a,$,c);break;case 3:var g=a.updateQueue;if(g!==null){if(o=null,a.child!==null)switch(a.child.tag){case 5:o=a.child.stateNode;break;case 1:o=a.child.stateNode}sh(a,g,o)}break;case 5:var b=a.stateNode;if(o===null&&a.flags&4){o=b;var _=a.memoizedProps;switch(a.type){case"button":case"input":case"select":case"textarea":_.autoFocus&&o.focus();break;case"img":_.src&&(o.src=_.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(a.memoizedState===null){var j=a.alternate;if(j!==null){var _e=j.memoizedState;if(_e!==null){var et=_e.dehydrated;et!==null&&bd(et)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p$1(163))}U||a.flags&512&&Rj(a)}catch(tt){W(a,a.return,tt)}}if(a===e){V=null;break}if(o=a.sibling,o!==null){o.return=a.return,V=o;break}V=a.return}}function gk(e){for(;V!==null;){var a=V;if(a===e){V=null;break}var o=a.sibling;if(o!==null){o.return=a.return,V=o;break}V=a.return}}function jk(e){for(;V!==null;){var a=V;try{switch(a.tag){case 0:case 11:case 15:var o=a.return;try{Qj(4,a)}catch(_){W(a,o,_)}break;case 1:var c=a.stateNode;if(typeof c.componentDidMount=="function"){var d=a.return;try{c.componentDidMount()}catch(_){W(a,d,_)}}var $=a.return;try{Rj(a)}catch(_){W(a,$,_)}break;case 5:var g=a.return;try{Rj(a)}catch(_){W(a,g,_)}}}catch(_){W(a,a.return,_)}if(a===e){V=null;break}var b=a.sibling;if(b!==null){b.return=a.return,V=b;break}V=a.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok$2=ua.ReactCurrentBatchConfig,K=0,Q=null,Y=null,Z=0,fj=0,ej=Uf(0),T$1=0,pk=null,rh=0,qk=0,rk=0,sk=null,tk=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R(){return K&6?B():Ak!==-1?Ak:Ak=B()}function yi(e){return e.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(e=C,e!==0||(e=window.event,e=e===void 0?16:jd(e.type)),e):1}function gi(e,a,o,c){if(50<yk)throw yk=0,zk=null,Error(p$1(185));Ac(e,o,c),(!(K&2)||e!==Q)&&(e===Q&&(!(K&2)&&(qk|=o),T$1===4&&Ck(e,Z)),Dk(e,c),o===1&&K===0&&!(a.mode&1)&&(Gj=B()+500,fg&&jg()))}function Dk(e,a){var o=e.callbackNode;wc(e,a);var c=uc(e,e===Q?Z:0);if(c===0)o!==null&&bc(o),e.callbackNode=null,e.callbackPriority=0;else if(a=c&-c,e.callbackPriority!==a){if(o!=null&&bc(o),a===1)e.tag===0?ig(Ek.bind(null,e)):hg(Ek.bind(null,e)),Jf(function(){!(K&6)&&jg()}),o=null;else{switch(Dc$1(c)){case 1:o=fc;break;case 4:o=gc;break;case 16:o=hc;break;case 536870912:o=jc;break;default:o=hc}o=Fk(o,Gk.bind(null,e))}e.callbackPriority=a,e.callbackNode=o}}function Gk(e,a){if(Ak=-1,Bk=0,K&6)throw Error(p$1(327));var o=e.callbackNode;if(Hk()&&e.callbackNode!==o)return null;var c=uc(e,e===Q?Z:0);if(c===0)return null;if(c&30||c&e.expiredLanes||a)a=Ik(e,c);else{a=c;var d=K;K|=2;var $=Jk();(Q!==e||Z!==a)&&(uk=null,Gj=B()+500,Kk(e,a));do try{Lk();break}catch(b){Mk(e,b)}while(!0);$g(),mk.current=$,K=d,Y!==null?a=0:(Q=null,Z=0,a=T$1)}if(a!==0){if(a===2&&(d=xc(e),d!==0&&(c=d,a=Nk(e,d))),a===1)throw o=pk,Kk(e,0),Ck(e,c),Dk(e,B()),o;if(a===6)Ck(e,c);else{if(d=e.current.alternate,!(c&30)&&!Ok(d)&&(a=Ik(e,c),a===2&&($=xc(e),$!==0&&(c=$,a=Nk(e,$))),a===1))throw o=pk,Kk(e,0),Ck(e,c),Dk(e,B()),o;switch(e.finishedWork=d,e.finishedLanes=c,a){case 0:case 1:throw Error(p$1(345));case 2:Pk(e,tk,uk);break;case 3:if(Ck(e,c),(c&130023424)===c&&(a=fk+500-B(),10<a)){if(uc(e,0)!==0)break;if(d=e.suspendedLanes,(d&c)!==c){R(),e.pingedLanes|=e.suspendedLanes&d;break}e.timeoutHandle=Ff(Pk.bind(null,e,tk,uk),a);break}Pk(e,tk,uk);break;case 4:if(Ck(e,c),(c&4194240)===c)break;for(a=e.eventTimes,d=-1;0<c;){var g=31-oc(c);$=1<<g,g=a[g],g>d&&(d=g),c&=~$}if(c=d,c=B()-c,c=(120>c?120:480>c?480:1080>c?1080:1920>c?1920:3e3>c?3e3:4320>c?4320:1960*lk(c/1960))-c,10<c){e.timeoutHandle=Ff(Pk.bind(null,e,tk,uk),c);break}Pk(e,tk,uk);break;case 5:Pk(e,tk,uk);break;default:throw Error(p$1(329))}}}return Dk(e,B()),e.callbackNode===o?Gk.bind(null,e):null}function Nk(e,a){var o=sk;return e.current.memoizedState.isDehydrated&&(Kk(e,a).flags|=256),e=Ik(e,a),e!==2&&(a=tk,tk=o,a!==null&&Fj(a)),e}function Fj(e){tk===null?tk=e:tk.push.apply(tk,e)}function Ok(e){for(var a=e;;){if(a.flags&16384){var o=a.updateQueue;if(o!==null&&(o=o.stores,o!==null))for(var c=0;c<o.length;c++){var d=o[c],$=d.getSnapshot;d=d.value;try{if(!He($(),d))return!1}catch{return!1}}}if(o=a.child,a.subtreeFlags&16384&&o!==null)o.return=a,a=o;else{if(a===e)break;for(;a.sibling===null;){if(a.return===null||a.return===e)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Ck(e,a){for(a&=~rk,a&=~qk,e.suspendedLanes|=a,e.pingedLanes&=~a,e=e.expirationTimes;0<a;){var o=31-oc(a),c=1<<o;e[o]=-1,a&=~c}}function Ek(e){if(K&6)throw Error(p$1(327));Hk();var a=uc(e,0);if(!(a&1))return Dk(e,B()),null;var o=Ik(e,a);if(e.tag!==0&&o===2){var c=xc(e);c!==0&&(a=c,o=Nk(e,c))}if(o===1)throw o=pk,Kk(e,0),Ck(e,a),Dk(e,B()),o;if(o===6)throw Error(p$1(345));return e.finishedWork=e.current.alternate,e.finishedLanes=a,Pk(e,tk,uk),Dk(e,B()),null}function Qk(e,a){var o=K;K|=1;try{return e(a)}finally{K=o,K===0&&(Gj=B()+500,fg&&jg())}}function Rk(e){wk!==null&&wk.tag===0&&!(K&6)&&Hk();var a=K;K|=1;var o=ok$2.transition,c=C;try{if(ok$2.transition=null,C=1,e)return e()}finally{C=c,ok$2.transition=o,K=a,!(K&6)&&jg()}}function Hj(){fj=ej.current,E(ej)}function Kk(e,a){e.finishedWork=null,e.finishedLanes=0;var o=e.timeoutHandle;if(o!==-1&&(e.timeoutHandle=-1,Gf(o)),Y!==null)for(o=Y.return;o!==null;){var c=o;switch(wg(c),c.tag){case 1:c=c.type.childContextTypes,c!=null&&$f();break;case 3:zh(),E(Wf),E(H),Eh();break;case 5:Bh(c);break;case 4:zh();break;case 13:E(L);break;case 19:E(L);break;case 10:ah(c.type._context);break;case 22:case 23:Hj()}o=o.return}if(Q=e,Y=e=Pg(e.current,null),Z=fj=a,T$1=0,pk=null,rk=qk=rh=0,tk=sk=null,fh!==null){for(a=0;a<fh.length;a++)if(o=fh[a],c=o.interleaved,c!==null){o.interleaved=null;var d=c.next,$=o.pending;if($!==null){var g=$.next;$.next=d,c.next=g}o.pending=c}fh=null}return e}function Mk(e,a){do{var o=Y;try{if($g(),Fh.current=Rh,Ih){for(var c=M.memoizedState;c!==null;){var d=c.queue;d!==null&&(d.pending=null),c=c.next}Ih=!1}if(Hh=0,O=N=M=null,Jh=!1,Kh=0,nk.current=null,o===null||o.return===null){T$1=1,pk=a,Y=null;break}e:{var $=e,g=o.return,b=o,_=a;if(a=Z,b.flags|=32768,_!==null&&typeof _=="object"&&typeof _.then=="function"){var j=_,_e=b,et=_e.tag;if(!(_e.mode&1)&&(et===0||et===11||et===15)){var tt=_e.alternate;tt?(_e.updateQueue=tt.updateQueue,_e.memoizedState=tt.memoizedState,_e.lanes=tt.lanes):(_e.updateQueue=null,_e.memoizedState=null)}var nt=Ui(g);if(nt!==null){nt.flags&=-257,Vi(nt,g,b,$,a),nt.mode&1&&Si($,j,a),a=nt,_=j;var at=a.updateQueue;if(at===null){var lt=new Set;lt.add(_),a.updateQueue=lt}else at.add(_);break e}else{if(!(a&1)){Si($,j,a),tj();break e}_=Error(p$1(426))}}else if(I&&b.mode&1){var mt=Ui(g);if(mt!==null){!(mt.flags&65536)&&(mt.flags|=256),Vi(mt,g,b,$,a),Jg(Ji(_,b));break e}}$=_=Ji(_,b),T$1!==4&&(T$1=2),sk===null?sk=[$]:sk.push($),$=g;do{switch($.tag){case 3:$.flags|=65536,a&=-a,$.lanes|=a;var ot=Ni($,_,a);ph($,ot);break e;case 1:b=_;var st=$.type,ut=$.stateNode;if(!($.flags&128)&&(typeof st.getDerivedStateFromError=="function"||ut!==null&&typeof ut.componentDidCatch=="function"&&(Ri===null||!Ri.has(ut)))){$.flags|=65536,a&=-a,$.lanes|=a;var pt=Qi($,b,a);ph($,pt);break e}}$=$.return}while($!==null)}Sk(o)}catch(gt){a=gt,Y===o&&o!==null&&(Y=o=o.return);continue}break}while(!0)}function Jk(){var e=mk.current;return mk.current=Rh,e===null?Rh:e}function tj(){(T$1===0||T$1===3||T$1===2)&&(T$1=4),Q===null||!(rh&268435455)&&!(qk&268435455)||Ck(Q,Z)}function Ik(e,a){var o=K;K|=2;var c=Jk();(Q!==e||Z!==a)&&(uk=null,Kk(e,a));do try{Tk();break}catch(d){Mk(e,d)}while(!0);if($g(),K=o,mk.current=c,Y!==null)throw Error(p$1(261));return Q=null,Z=0,T$1}function Tk(){for(;Y!==null;)Uk(Y)}function Lk(){for(;Y!==null&&!cc();)Uk(Y)}function Uk(e){var a=Vk(e.alternate,e,fj);e.memoizedProps=e.pendingProps,a===null?Sk(e):Y=a,nk.current=null}function Sk(e){var a=e;do{var o=a.alternate;if(e=a.return,a.flags&32768){if(o=Ij(o,a),o!==null){o.flags&=32767,Y=o;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{T$1=6,Y=null;return}}else if(o=Ej(o,a,fj),o!==null){Y=o;return}if(a=a.sibling,a!==null){Y=a;return}Y=a=e}while(a!==null);T$1===0&&(T$1=5)}function Pk(e,a,o){var c=C,d=ok$2.transition;try{ok$2.transition=null,C=1,Wk(e,a,o,c)}finally{ok$2.transition=d,C=c}return null}function Wk(e,a,o,c){do Hk();while(wk!==null);if(K&6)throw Error(p$1(327));o=e.finishedWork;var d=e.finishedLanes;if(o===null)return null;if(e.finishedWork=null,e.finishedLanes=0,o===e.current)throw Error(p$1(177));e.callbackNode=null,e.callbackPriority=0;var $=o.lanes|o.childLanes;if(Bc(e,$),e===Q&&(Y=Q=null,Z=0),!(o.subtreeFlags&2064)&&!(o.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),$=(o.flags&15990)!==0,o.subtreeFlags&15990||$){$=ok$2.transition,ok$2.transition=null;var g=C;C=1;var b=K;K|=4,nk.current=null,Oj(e,o),dk(o,e),Oe(Df),dd=!!Cf,Df=Cf=null,e.current=o,hk(o),dc(),K=b,C=g,ok$2.transition=$}else e.current=o;if(vk&&(vk=!1,wk=e,xk=d),$=e.pendingLanes,$===0&&(Ri=null),mc(o.stateNode),Dk(e,B()),a!==null)for(c=e.onRecoverableError,o=0;o<a.length;o++)d=a[o],c(d.value,{componentStack:d.stack,digest:d.digest});if(Oi)throw Oi=!1,e=Pi,Pi=null,e;return xk&1&&e.tag!==0&&Hk(),$=e.pendingLanes,$&1?e===zk?yk++:(yk=0,zk=e):yk=0,jg(),null}function Hk(){if(wk!==null){var e=Dc$1(xk),a=ok$2.transition,o=C;try{if(ok$2.transition=null,C=16>e?16:e,wk===null)var c=!1;else{if(e=wk,wk=null,xk=0,K&6)throw Error(p$1(331));var d=K;for(K|=4,V=e.current;V!==null;){var $=V,g=$.child;if(V.flags&16){var b=$.deletions;if(b!==null){for(var _=0;_<b.length;_++){var j=b[_];for(V=j;V!==null;){var _e=V;switch(_e.tag){case 0:case 11:case 15:Pj(8,_e,$)}var et=_e.child;if(et!==null)et.return=_e,V=et;else for(;V!==null;){_e=V;var tt=_e.sibling,nt=_e.return;if(Sj(_e),_e===j){V=null;break}if(tt!==null){tt.return=nt,V=tt;break}V=nt}}}var at=$.alternate;if(at!==null){var lt=at.child;if(lt!==null){at.child=null;do{var mt=lt.sibling;lt.sibling=null,lt=mt}while(lt!==null)}}V=$}}if($.subtreeFlags&2064&&g!==null)g.return=$,V=g;else e:for(;V!==null;){if($=V,$.flags&2048)switch($.tag){case 0:case 11:case 15:Pj(9,$,$.return)}var ot=$.sibling;if(ot!==null){ot.return=$.return,V=ot;break e}V=$.return}}var st=e.current;for(V=st;V!==null;){g=V;var ut=g.child;if(g.subtreeFlags&2064&&ut!==null)ut.return=g,V=ut;else e:for(g=st;V!==null;){if(b=V,b.flags&2048)try{switch(b.tag){case 0:case 11:case 15:Qj(9,b)}}catch(gt){W(b,b.return,gt)}if(b===g){V=null;break e}var pt=b.sibling;if(pt!==null){pt.return=b.return,V=pt;break e}V=b.return}}if(K=d,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,e)}catch{}c=!0}return c}finally{C=o,ok$2.transition=a}}return!1}function Xk(e,a,o){a=Ji(o,a),a=Ni(e,a,1),e=nh(e,a,1),a=R(),e!==null&&(Ac(e,1,a),Dk(e,a))}function W(e,a,o){if(e.tag===3)Xk(e,e,o);else for(;a!==null;){if(a.tag===3){Xk(a,e,o);break}else if(a.tag===1){var c=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(Ri===null||!Ri.has(c))){e=Ji(o,e),e=Qi(a,e,1),a=nh(a,e,1),e=R(),a!==null&&(Ac(a,1,e),Dk(a,e));break}}a=a.return}}function Ti(e,a,o){var c=e.pingCache;c!==null&&c.delete(a),a=R(),e.pingedLanes|=e.suspendedLanes&o,Q===e&&(Z&o)===o&&(T$1===4||T$1===3&&(Z&130023424)===Z&&500>B()-fk?Kk(e,0):rk|=o),Dk(e,a)}function Yk(e,a){a===0&&(e.mode&1?(a=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):a=1);var o=R();e=ih(e,a),e!==null&&(Ac(e,a,o),Dk(e,o))}function uj(e){var a=e.memoizedState,o=0;a!==null&&(o=a.retryLane),Yk(e,o)}function bk(e,a){var o=0;switch(e.tag){case 13:var c=e.stateNode,d=e.memoizedState;d!==null&&(o=d.retryLane);break;case 19:c=e.stateNode;break;default:throw Error(p$1(314))}c!==null&&c.delete(a),Yk(e,o)}var Vk;Vk=function(e,a,o){if(e!==null)if(e.memoizedProps!==a.pendingProps||Wf.current)dh=!0;else{if(!(e.lanes&o)&&!(a.flags&128))return dh=!1,yj(e,a,o);dh=!!(e.flags&131072)}else dh=!1,I&&a.flags&1048576&&ug(a,ng,a.index);switch(a.lanes=0,a.tag){case 2:var c=a.type;ij(e,a),e=a.pendingProps;var d=Yf(a,H.current);ch$1(a,o),d=Nh(null,a,c,e,d,o);var $=Sh();return a.flags|=1,typeof d=="object"&&d!==null&&typeof d.render=="function"&&d.$$typeof===void 0?(a.tag=1,a.memoizedState=null,a.updateQueue=null,Zf(c)?($=!0,cg(a)):$=!1,a.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,kh(a),d.updater=Ei,a.stateNode=d,d._reactInternals=a,Ii(a,c,e,o),a=jj(null,a,c,!0,$,o)):(a.tag=0,I&&$&&vg(a),Xi(null,a,d,o),a=a.child),a;case 16:c=a.elementType;e:{switch(ij(e,a),e=a.pendingProps,d=c._init,c=d(c._payload),a.type=c,d=a.tag=Zk(c),e=Ci(c,e),d){case 0:a=cj(null,a,c,e,o);break e;case 1:a=hj(null,a,c,e,o);break e;case 11:a=Yi(null,a,c,e,o);break e;case 14:a=$i(null,a,c,Ci(c.type,e),o);break e}throw Error(p$1(306,c,""))}return a;case 0:return c=a.type,d=a.pendingProps,d=a.elementType===c?d:Ci(c,d),cj(e,a,c,d,o);case 1:return c=a.type,d=a.pendingProps,d=a.elementType===c?d:Ci(c,d),hj(e,a,c,d,o);case 3:e:{if(kj(a),e===null)throw Error(p$1(387));c=a.pendingProps,$=a.memoizedState,d=$.element,lh(e,a),qh(a,c,null,o);var g=a.memoizedState;if(c=g.element,$.isDehydrated)if($={element:c,isDehydrated:!1,cache:g.cache,pendingSuspenseBoundaries:g.pendingSuspenseBoundaries,transitions:g.transitions},a.updateQueue.baseState=$,a.memoizedState=$,a.flags&256){d=Ji(Error(p$1(423)),a),a=lj(e,a,c,o,d);break e}else if(c!==d){d=Ji(Error(p$1(424)),a),a=lj(e,a,c,o,d);break e}else for(yg=Lf(a.stateNode.containerInfo.firstChild),xg=a,I=!0,zg=null,o=Vg(a,null,c,o),a.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(Ig(),c===d){a=Zi(e,a,o);break e}Xi(e,a,c,o)}a=a.child}return a;case 5:return Ah(a),e===null&&Eg(a),c=a.type,d=a.pendingProps,$=e!==null?e.memoizedProps:null,g=d.children,Ef(c,d)?g=null:$!==null&&Ef(c,$)&&(a.flags|=32),gj(e,a),Xi(e,a,g,o),a.child;case 6:return e===null&&Eg(a),null;case 13:return oj(e,a,o);case 4:return yh(a,a.stateNode.containerInfo),c=a.pendingProps,e===null?a.child=Ug(a,null,c,o):Xi(e,a,c,o),a.child;case 11:return c=a.type,d=a.pendingProps,d=a.elementType===c?d:Ci(c,d),Yi(e,a,c,d,o);case 7:return Xi(e,a,a.pendingProps,o),a.child;case 8:return Xi(e,a,a.pendingProps.children,o),a.child;case 12:return Xi(e,a,a.pendingProps.children,o),a.child;case 10:e:{if(c=a.type._context,d=a.pendingProps,$=a.memoizedProps,g=d.value,G(Wg,c._currentValue),c._currentValue=g,$!==null)if(He($.value,g)){if($.children===d.children&&!Wf.current){a=Zi(e,a,o);break e}}else for($=a.child,$!==null&&($.return=a);$!==null;){var b=$.dependencies;if(b!==null){g=$.child;for(var _=b.firstContext;_!==null;){if(_.context===c){if($.tag===1){_=mh(-1,o&-o),_.tag=2;var j=$.updateQueue;if(j!==null){j=j.shared;var _e=j.pending;_e===null?_.next=_:(_.next=_e.next,_e.next=_),j.pending=_}}$.lanes|=o,_=$.alternate,_!==null&&(_.lanes|=o),bh($.return,o,a),b.lanes|=o;break}_=_.next}}else if($.tag===10)g=$.type===a.type?null:$.child;else if($.tag===18){if(g=$.return,g===null)throw Error(p$1(341));g.lanes|=o,b=g.alternate,b!==null&&(b.lanes|=o),bh(g,o,a),g=$.sibling}else g=$.child;if(g!==null)g.return=$;else for(g=$;g!==null;){if(g===a){g=null;break}if($=g.sibling,$!==null){$.return=g.return,g=$;break}g=g.return}$=g}Xi(e,a,d.children,o),a=a.child}return a;case 9:return d=a.type,c=a.pendingProps.children,ch$1(a,o),d=eh(d),c=c(d),a.flags|=1,Xi(e,a,c,o),a.child;case 14:return c=a.type,d=Ci(c,a.pendingProps),d=Ci(c.type,d),$i(e,a,c,d,o);case 15:return bj(e,a,a.type,a.pendingProps,o);case 17:return c=a.type,d=a.pendingProps,d=a.elementType===c?d:Ci(c,d),ij(e,a),a.tag=1,Zf(c)?(e=!0,cg(a)):e=!1,ch$1(a,o),Gi(a,c,d),Ii(a,c,d,o),jj(null,a,c,!0,e,o);case 19:return xj(e,a,o);case 22:return dj(e,a,o)}throw Error(p$1(156,a.tag))};function Fk(e,a){return ac(e,a)}function $k(e,a,o,c){this.tag=e,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(e,a,o,c){return new $k(e,a,o,c)}function aj(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Zk(e){if(typeof e=="function")return aj(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Da)return 11;if(e===Ga)return 14}return 2}function Pg(e,a){var o=e.alternate;return o===null?(o=Bg(e.tag,a,e.key,e.mode),o.elementType=e.elementType,o.type=e.type,o.stateNode=e.stateNode,o.alternate=e,e.alternate=o):(o.pendingProps=a,o.type=e.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=e.flags&14680064,o.childLanes=e.childLanes,o.lanes=e.lanes,o.child=e.child,o.memoizedProps=e.memoizedProps,o.memoizedState=e.memoizedState,o.updateQueue=e.updateQueue,a=e.dependencies,o.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},o.sibling=e.sibling,o.index=e.index,o.ref=e.ref,o}function Rg(e,a,o,c,d,$){var g=2;if(c=e,typeof e=="function")aj(e)&&(g=1);else if(typeof e=="string")g=5;else e:switch(e){case ya:return Tg(o.children,d,$,a);case za:g=8,d|=8;break;case Aa:return e=Bg(12,o,a,d|2),e.elementType=Aa,e.lanes=$,e;case Ea:return e=Bg(13,o,a,d),e.elementType=Ea,e.lanes=$,e;case Fa:return e=Bg(19,o,a,d),e.elementType=Fa,e.lanes=$,e;case Ia:return pj(o,d,$,a);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Ba:g=10;break e;case Ca:g=9;break e;case Da:g=11;break e;case Ga:g=14;break e;case Ha:g=16,c=null;break e}throw Error(p$1(130,e==null?e:typeof e,""))}return a=Bg(g,o,a,d),a.elementType=e,a.type=c,a.lanes=$,a}function Tg(e,a,o,c){return e=Bg(7,e,c,a),e.lanes=o,e}function pj(e,a,o,c){return e=Bg(22,e,c,a),e.elementType=Ia,e.lanes=o,e.stateNode={isHidden:!1},e}function Qg(e,a,o){return e=Bg(6,e,null,a),e.lanes=o,e}function Sg(e,a,o){return a=Bg(4,e.children!==null?e.children:[],e.key,a),a.lanes=o,a.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},a}function al(e,a,o,c,d){this.tag=a,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=c,this.onRecoverableError=d,this.mutableSourceEagerHydrationData=null}function bl(e,a,o,c,d,$,g,b,_){return e=new al(e,a,o,b,_),a===1?(a=1,$===!0&&(a|=8)):a=0,$=Bg(3,null,null,a),e.current=$,$.stateNode=e,$.memoizedState={element:c,isDehydrated:o,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh($),e}function cl(e,a,o){var c=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:c==null?null:""+c,children:e,containerInfo:a,implementation:o}}function dl(e){if(!e)return Vf;e=e._reactInternals;e:{if(Vb(e)!==e||e.tag!==1)throw Error(p$1(170));var a=e;do{switch(a.tag){case 3:a=a.stateNode.context;break e;case 1:if(Zf(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break e}}a=a.return}while(a!==null);throw Error(p$1(171))}if(e.tag===1){var o=e.type;if(Zf(o))return bg(e,o,a)}return a}function el(e,a,o,c,d,$,g,b,_){return e=bl(o,c,!0,e,d,$,g,b,_),e.context=dl(null),o=e.current,c=R(),d=yi(o),$=mh(c,d),$.callback=a??null,nh(o,$,d),e.current.lanes=d,Ac(e,d,c),Dk(e,c),e}function fl(e,a,o,c){var d=a.current,$=R(),g=yi(d);return o=dl(o),a.context===null?a.context=o:a.pendingContext=o,a=mh($,g),a.payload={element:e},c=c===void 0?null:c,c!==null&&(a.callback=c),e=nh(d,a,g),e!==null&&(gi(e,d,g,$),oh(e,d,g)),g}function gl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function hl(e,a){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var o=e.retryLane;e.retryLane=o!==0&&o<a?o:a}}function il(e,a){hl(e,a),(e=e.alternate)&&hl(e,a)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(e){console.error(e)};function ll(e){this._internalRoot=e}ml.prototype.render=ll.prototype.render=function(e){var a=this._internalRoot;if(a===null)throw Error(p$1(409));fl(e,a,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var a=e.containerInfo;Rk(function(){fl(null,e,null,null)}),a[uf]=null}};function ml(e){this._internalRoot=e}ml.prototype.unstable_scheduleHydration=function(e){if(e){var a=Hc();e={blockedOn:null,target:e,priority:a};for(var o=0;o<Qc.length&&a!==0&&a<Qc[o].priority;o++);Qc.splice(o,0,e),o===0&&Vc(e)}};function nl(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function ol(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(e,a,o,c,d){if(d){if(typeof c=="function"){var $=c;c=function(){var j=gl(g);$.call(j)}}var g=el(a,c,e,0,null,!1,!1,"",pl);return e._reactRootContainer=g,e[uf]=g.current,sf(e.nodeType===8?e.parentNode:e),Rk(),g}for(;d=e.lastChild;)e.removeChild(d);if(typeof c=="function"){var b=c;c=function(){var j=gl(_);b.call(j)}}var _=bl(e,0,!1,null,null,!1,!1,"",pl);return e._reactRootContainer=_,e[uf]=_.current,sf(e.nodeType===8?e.parentNode:e),Rk(function(){fl(a,_,o,c)}),_}function rl(e,a,o,c,d){var $=o._reactRootContainer;if($){var g=$;if(typeof d=="function"){var b=d;d=function(){var _=gl(g);b.call(_)}}fl(a,g,e,d)}else g=ql(o,a,e,d,c);return gl(g)}Ec=function(e){switch(e.tag){case 3:var a=e.stateNode;if(a.current.memoizedState.isDehydrated){var o=tc(a.pendingLanes);o!==0&&(Cc(a,o|1),Dk(a,B()),!(K&6)&&(Gj=B()+500,jg()))}break;case 13:Rk(function(){var c=ih(e,1);if(c!==null){var d=R();gi(c,e,1,d)}}),il(e,1)}};Fc=function(e){if(e.tag===13){var a=ih(e,134217728);if(a!==null){var o=R();gi(a,e,134217728,o)}il(e,134217728)}};Gc=function(e){if(e.tag===13){var a=yi(e),o=ih(e,a);if(o!==null){var c=R();gi(o,e,a,c)}il(e,a)}};Hc=function(){return C};Ic=function(e,a){var o=C;try{return C=e,a()}finally{C=o}};yb=function(e,a,o){switch(a){case"input":if(bb(e,o),a=o.name,o.type==="radio"&&a!=null){for(o=e;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll("input[name="+JSON.stringify(""+a)+'][type="radio"]'),a=0;a<o.length;a++){var c=o[a];if(c!==e&&c.form===e.form){var d=Db(c);if(!d)throw Error(p$1(90));Wa(c),bb(c,d)}}}break;case"textarea":ib(e,o);break;case"select":a=o.value,a!=null&&fb(e,!!o.multiple,a,!1)}};Gb=Qk;Hb=Rk;var sl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Zb(e),e===null?null:e.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl;reactDom_production_min.createPortal=function(e,a){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl(a))throw Error(p$1(200));return cl(e,a,null,o)};reactDom_production_min.createRoot=function(e,a){if(!nl(e))throw Error(p$1(299));var o=!1,c="",d=kl;return a!=null&&(a.unstable_strictMode===!0&&(o=!0),a.identifierPrefix!==void 0&&(c=a.identifierPrefix),a.onRecoverableError!==void 0&&(d=a.onRecoverableError)),a=bl(e,1,!1,null,null,o,!1,c,d),e[uf]=a.current,sf(e.nodeType===8?e.parentNode:e),new ll(a)};reactDom_production_min.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var a=e._reactInternals;if(a===void 0)throw typeof e.render=="function"?Error(p$1(188)):(e=Object.keys(e).join(","),Error(p$1(268,e)));return e=Zb(a),e=e===null?null:e.stateNode,e};reactDom_production_min.flushSync=function(e){return Rk(e)};reactDom_production_min.hydrate=function(e,a,o){if(!ol(a))throw Error(p$1(200));return rl(null,e,a,!0,o)};reactDom_production_min.hydrateRoot=function(e,a,o){if(!nl(e))throw Error(p$1(405));var c=o!=null&&o.hydratedSources||null,d=!1,$="",g=kl;if(o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&($=o.identifierPrefix),o.onRecoverableError!==void 0&&(g=o.onRecoverableError)),a=el(a,null,e,1,o??null,d,!1,$,g),e[uf]=a.current,sf(e),c)for(e=0;e<c.length;e++)o=c[e],d=o._getVersion,d=d(o._source),a.mutableSourceEagerHydrationData==null?a.mutableSourceEagerHydrationData=[o,d]:a.mutableSourceEagerHydrationData.push(o,d);return new ml(a)};reactDom_production_min.render=function(e,a,o){if(!ol(a))throw Error(p$1(200));return rl(null,e,a,!1,o)};reactDom_production_min.unmountComponentAtNode=function(e){if(!ol(e))throw Error(p$1(40));return e._reactRootContainer?(Rk(function(){rl(null,null,e,!1,function(){e._reactRootContainer=null,e[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(e,a,o,c){if(!ol(o))throw Error(p$1(200));if(e==null||e._reactInternals===void 0)throw Error(p$1(38));return rl(e,a,o,!1,c)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(e){console.error(e)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports,m=reactDomExports;client.createRoot=m.createRoot,client.hydrateRoot=m.hydrateRoot;var dist={};Object.defineProperty(dist,"__esModule",{value:!0});dist.parse=parse$5;dist.serialize=serialize$1;const cookieNameRegExp=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,cookieValueRegExp=/^[\u0021-\u003A\u003C-\u007E]*$/,domainValueRegExp=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,pathValueRegExp=/^[\u0020-\u003A\u003D-\u007E]*$/,__toString=Object.prototype.toString,NullObject=(()=>{const e=function(){};return e.prototype=Object.create(null),e})();function parse$5(e,a){const o=new NullObject,c=e.length;if(c<2)return o;const d=(a==null?void 0:a.decode)||decode$1;let $=0;do{const g=e.indexOf("=",$);if(g===-1)break;const b=e.indexOf(";",$),_=b===-1?c:b;if(g>_){$=e.lastIndexOf(";",g-1)+1;continue}const j=startIndex(e,$,g),_e=endIndex(e,g,j),et=e.slice(j,_e);if(o[et]===void 0){let tt=startIndex(e,g+1,_),nt=endIndex(e,_,tt);const at=d(e.slice(tt,nt));o[et]=at}$=_+1}while($<c);return o}function startIndex(e,a,o){do{const c=e.charCodeAt(a);if(c!==32&&c!==9)return a}while(++a<o);return o}function endIndex(e,a,o){for(;a>o;){const c=e.charCodeAt(--a);if(c!==32&&c!==9)return a+1}return o}function serialize$1(e,a,o){const c=(o==null?void 0:o.encode)||encodeURIComponent;if(!cookieNameRegExp.test(e))throw new TypeError(`argument name is invalid: ${e}`);const d=c(a);if(!cookieValueRegExp.test(d))throw new TypeError(`argument val is invalid: ${a}`);let $=e+"="+d;if(!o)return $;if(o.maxAge!==void 0){if(!Number.isInteger(o.maxAge))throw new TypeError(`option maxAge is invalid: ${o.maxAge}`);$+="; Max-Age="+o.maxAge}if(o.domain){if(!domainValueRegExp.test(o.domain))throw new TypeError(`option domain is invalid: ${o.domain}`);$+="; Domain="+o.domain}if(o.path){if(!pathValueRegExp.test(o.path))throw new TypeError(`option path is invalid: ${o.path}`);$+="; Path="+o.path}if(o.expires){if(!isDate$1(o.expires)||!Number.isFinite(o.expires.valueOf()))throw new TypeError(`option expires is invalid: ${o.expires}`);$+="; Expires="+o.expires.toUTCString()}if(o.httpOnly&&($+="; HttpOnly"),o.secure&&($+="; Secure"),o.partitioned&&($+="; Partitioned"),o.priority)switch(typeof o.priority=="string"?o.priority.toLowerCase():void 0){case"low":$+="; Priority=Low";break;case"medium":$+="; Priority=Medium";break;case"high":$+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${o.priority}`)}if(o.sameSite)switch(typeof o.sameSite=="string"?o.sameSite.toLowerCase():o.sameSite){case!0:case"strict":$+="; SameSite=Strict";break;case"lax":$+="; SameSite=Lax";break;case"none":$+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${o.sameSite}`)}return $}function decode$1(e){if(e.indexOf("%")===-1)return e;try{return decodeURIComponent(e)}catch{return e}}function isDate$1(e){return __toString.call(e)==="[object Date]"}var PopStateEventType="popstate";function createHashHistory(e={}){function a(d,$){let{pathname:g="/",search:b="",hash:_=""}=parsePath(d.location.hash.substring(1));return!g.startsWith("/")&&!g.startsWith(".")&&(g="/"+g),createLocation("",{pathname:g,search:b,hash:_},$.state&&$.state.usr||null,$.state&&$.state.key||"default")}function o(d,$){let g=d.document.querySelector("base"),b="";if(g&&g.getAttribute("href")){let _=d.location.href,j=_.indexOf("#");b=j===-1?_:_.slice(0,j)}return b+"#"+(typeof $=="string"?$:createPath($))}function c(d,$){warning(d.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify($)})`)}return getUrlBasedHistory(a,o,c,e)}function invariant$1(e,a){if(e===!1||e===null||typeof e>"u")throw new Error(a)}function warning(e,a){if(!e){typeof console<"u"&&console.warn(a);try{throw new Error(a)}catch{}}}function createKey(){return Math.random().toString(36).substring(2,10)}function getHistoryState(e,a){return{usr:e.state,key:e.key,idx:a}}function createLocation(e,a,o=null,c){return{pathname:typeof e=="string"?e:e.pathname,search:"",hash:"",...typeof a=="string"?parsePath(a):a,state:o,key:a&&a.key||c||createKey()}}function createPath({pathname:e="/",search:a="",hash:o=""}){return a&&a!=="?"&&(e+=a.charAt(0)==="?"?a:"?"+a),o&&o!=="#"&&(e+=o.charAt(0)==="#"?o:"#"+o),e}function parsePath(e){let a={};if(e){let o=e.indexOf("#");o>=0&&(a.hash=e.substring(o),e=e.substring(0,o));let c=e.indexOf("?");c>=0&&(a.search=e.substring(c),e=e.substring(0,c)),e&&(a.pathname=e)}return a}function getUrlBasedHistory(e,a,o,c={}){let{window:d=document.defaultView,v5Compat:$=!1}=c,g=d.history,b="POP",_=null,j=_e();j==null&&(j=0,g.replaceState({...g.state,idx:j},""));function _e(){return(g.state||{idx:null}).idx}function et(){b="POP";let mt=_e(),ot=mt==null?null:mt-j;j=mt,_&&_({action:b,location:lt.location,delta:ot})}function tt(mt,ot){b="PUSH";let st=createLocation(lt.location,mt,ot);o&&o(st,mt),j=_e()+1;let ut=getHistoryState(st,j),pt=lt.createHref(st);try{g.pushState(ut,"",pt)}catch(gt){if(gt instanceof DOMException&&gt.name==="DataCloneError")throw gt;d.location.assign(pt)}$&&_&&_({action:b,location:lt.location,delta:1})}function nt(mt,ot){b="REPLACE";let st=createLocation(lt.location,mt,ot);o&&o(st,mt),j=_e();let ut=getHistoryState(st,j),pt=lt.createHref(st);g.replaceState(ut,"",pt),$&&_&&_({action:b,location:lt.location,delta:0})}function at(mt){let ot=d.location.origin!=="null"?d.location.origin:d.location.href,st=typeof mt=="string"?mt:createPath(mt);return st=st.replace(/ $/,"%20"),invariant$1(ot,`No window.location.(origin|href) available to create URL for href: ${st}`),new URL(st,ot)}let lt={get action(){return b},get location(){return e(d,g)},listen(mt){if(_)throw new Error("A history only accepts one active listener");return d.addEventListener(PopStateEventType,et),_=mt,()=>{d.removeEventListener(PopStateEventType,et),_=null}},createHref(mt){return a(d,mt)},createURL:at,encodeLocation(mt){let ot=at(mt);return{pathname:ot.pathname,search:ot.search,hash:ot.hash}},push:tt,replace:nt,go(mt){return g.go(mt)}};return lt}function matchRoutes(e,a,o="/"){return matchRoutesImpl(e,a,o,!1)}function matchRoutesImpl(e,a,o,c){let d=typeof a=="string"?parsePath(a):a,$=stripBasename(d.pathname||"/",o);if($==null)return null;let g=flattenRoutes(e);rankRouteBranches(g);let b=null;for(let _=0;b==null&&_<g.length;++_){let j=decodePath($);b=matchRouteBranch(g[_],j,c)}return b}function flattenRoutes(e,a=[],o=[],c=""){let d=($,g,b)=>{let _={relativePath:b===void 0?$.path||"":b,caseSensitive:$.caseSensitive===!0,childrenIndex:g,route:$};_.relativePath.startsWith("/")&&(invariant$1(_.relativePath.startsWith(c),`Absolute route path "${_.relativePath}" nested under path "${c}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),_.relativePath=_.relativePath.slice(c.length));let j=joinPaths([c,_.relativePath]),_e=o.concat(_);$.children&&$.children.length>0&&(invariant$1($.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${j}".`),flattenRoutes($.children,a,_e,j)),!($.path==null&&!$.index)&&a.push({path:j,score:computeScore(j,$.index),routesMeta:_e})};return e.forEach(($,g)=>{var b;if($.path===""||!((b=$.path)!=null&&b.includes("?")))d($,g);else for(let _ of explodeOptionalSegments($.path))d($,g,_)}),a}function explodeOptionalSegments(e){let a=e.split("/");if(a.length===0)return[];let[o,...c]=a,d=o.endsWith("?"),$=o.replace(/\?$/,"");if(c.length===0)return d?[$,""]:[$];let g=explodeOptionalSegments(c.join("/")),b=[];return b.push(...g.map(_=>_===""?$:[$,_].join("/"))),d&&b.push(...g),b.map(_=>e.startsWith("/")&&_===""?"/":_)}function rankRouteBranches(e){e.sort((a,o)=>a.score!==o.score?o.score-a.score:compareIndexes(a.routesMeta.map(c=>c.childrenIndex),o.routesMeta.map(c=>c.childrenIndex)))}var paramRe=/^:[\w-]+$/,dynamicSegmentValue=3,indexRouteValue=2,emptySegmentValue=1,staticSegmentValue=10,splatPenalty=-2,isSplat=e=>e==="*";function computeScore(e,a){let o=e.split("/"),c=o.length;return o.some(isSplat)&&(c+=splatPenalty),a&&(c+=indexRouteValue),o.filter(d=>!isSplat(d)).reduce((d,$)=>d+(paramRe.test($)?dynamicSegmentValue:$===""?emptySegmentValue:staticSegmentValue),c)}function compareIndexes(e,a){return e.length===a.length&&e.slice(0,-1).every((c,d)=>c===a[d])?e[e.length-1]-a[a.length-1]:0}function matchRouteBranch(e,a,o=!1){let{routesMeta:c}=e,d={},$="/",g=[];for(let b=0;b<c.length;++b){let _=c[b],j=b===c.length-1,_e=$==="/"?a:a.slice($.length)||"/",et=matchPath({path:_.relativePath,caseSensitive:_.caseSensitive,end:j},_e),tt=_.route;if(!et&&j&&o&&!c[c.length-1].route.index&&(et=matchPath({path:_.relativePath,caseSensitive:_.caseSensitive,end:!1},_e)),!et)return null;Object.assign(d,et.params),g.push({params:d,pathname:joinPaths([$,et.pathname]),pathnameBase:normalizePathname(joinPaths([$,et.pathnameBase])),route:tt}),et.pathnameBase!=="/"&&($=joinPaths([$,et.pathnameBase]))}return g}function matchPath(e,a){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[o,c]=compilePath(e.path,e.caseSensitive,e.end),d=a.match(o);if(!d)return null;let $=d[0],g=$.replace(/(.)\/+$/,"$1"),b=d.slice(1);return{params:c.reduce((j,{paramName:_e,isOptional:et},tt)=>{if(_e==="*"){let at=b[tt]||"";g=$.slice(0,$.length-at.length).replace(/(.)\/+$/,"$1")}const nt=b[tt];return et&&!nt?j[_e]=void 0:j[_e]=(nt||"").replace(/%2F/g,"/"),j},{}),pathname:$,pathnameBase:g,pattern:e}}function compilePath(e,a=!1,o=!0){warning(e==="*"||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let c=[],d="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(g,b,_)=>(c.push({paramName:b,isOptional:_!=null}),_?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(c.push({paramName:"*"}),d+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):o?d+="\\/*$":e!==""&&e!=="/"&&(d+="(?:(?=\\/|$))"),[new RegExp(d,a?void 0:"i"),c]}function decodePath(e){try{return e.split("/").map(a=>decodeURIComponent(a).replace(/\//g,"%2F")).join("/")}catch(a){return warning(!1,`The URL path "${e}" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding (${a}).`),e}}function stripBasename(e,a){if(a==="/")return e;if(!e.toLowerCase().startsWith(a.toLowerCase()))return null;let o=a.endsWith("/")?a.length-1:a.length,c=e.charAt(o);return c&&c!=="/"?null:e.slice(o)||"/"}function resolvePath(e,a="/"){let{pathname:o,search:c="",hash:d=""}=typeof e=="string"?parsePath(e):e;return{pathname:o?o.startsWith("/")?o:resolvePathname(o,a):a,search:normalizeSearch(c),hash:normalizeHash(d)}}function resolvePathname(e,a){let o=a.replace(/\/+$/,"").split("/");return e.split("/").forEach(d=>{d===".."?o.length>1&&o.pop():d!=="."&&o.push(d)}),o.length>1?o.join("/"):"/"}function getInvalidPathError(e,a,o,c){return`Cannot include a '${e}' character in a manually specified \`to.${a}\` field [${JSON.stringify(c)}].  Please separate it out to the \`to.${o}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function getPathContributingMatches(e){return e.filter((a,o)=>o===0||a.route.path&&a.route.path.length>0)}function getResolveToMatches(e){let a=getPathContributingMatches(e);return a.map((o,c)=>c===a.length-1?o.pathname:o.pathnameBase)}function resolveTo(e,a,o,c=!1){let d;typeof e=="string"?d=parsePath(e):(d={...e},invariant$1(!d.pathname||!d.pathname.includes("?"),getInvalidPathError("?","pathname","search",d)),invariant$1(!d.pathname||!d.pathname.includes("#"),getInvalidPathError("#","pathname","hash",d)),invariant$1(!d.search||!d.search.includes("#"),getInvalidPathError("#","search","hash",d)));let $=e===""||d.pathname==="",g=$?"/":d.pathname,b;if(g==null)b=o;else{let et=a.length-1;if(!c&&g.startsWith("..")){let tt=g.split("/");for(;tt[0]==="..";)tt.shift(),et-=1;d.pathname=tt.join("/")}b=et>=0?a[et]:"/"}let _=resolvePath(d,b),j=g&&g!=="/"&&g.endsWith("/"),_e=($||g===".")&&o.endsWith("/");return!_.pathname.endsWith("/")&&(j||_e)&&(_.pathname+="/"),_}var joinPaths=e=>e.join("/").replace(/\/\/+/g,"/"),normalizePathname=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),normalizeSearch=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,normalizeHash=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function isRouteErrorResponse(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}var validMutationMethodsArr=["POST","PUT","PATCH","DELETE"];new Set(validMutationMethodsArr);var validRequestMethodsArr=["GET",...validMutationMethodsArr];new Set(validRequestMethodsArr);var DataRouterContext=reactExports.createContext(null);DataRouterContext.displayName="DataRouter";var DataRouterStateContext=reactExports.createContext(null);DataRouterStateContext.displayName="DataRouterState";var ViewTransitionContext=reactExports.createContext({isTransitioning:!1});ViewTransitionContext.displayName="ViewTransition";var FetchersContext=reactExports.createContext(new Map);FetchersContext.displayName="Fetchers";var AwaitContext=reactExports.createContext(null);AwaitContext.displayName="Await";var NavigationContext=reactExports.createContext(null);NavigationContext.displayName="Navigation";var LocationContext=reactExports.createContext(null);LocationContext.displayName="Location";var RouteContext=reactExports.createContext({outlet:null,matches:[],isDataRoute:!1});RouteContext.displayName="Route";var RouteErrorContext=reactExports.createContext(null);RouteErrorContext.displayName="RouteError";function useHref(e,{relative:a}={}){invariant$1(useInRouterContext(),"useHref() may be used only in the context of a <Router> component.");let{basename:o,navigator:c}=reactExports.useContext(NavigationContext),{hash:d,pathname:$,search:g}=useResolvedPath(e,{relative:a}),b=$;return o!=="/"&&(b=$==="/"?o:joinPaths([o,$])),c.createHref({pathname:b,search:g,hash:d})}function useInRouterContext(){return reactExports.useContext(LocationContext)!=null}function useLocation(){return invariant$1(useInRouterContext(),"useLocation() may be used only in the context of a <Router> component."),reactExports.useContext(LocationContext).location}var navigateEffectWarning="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function useIsomorphicLayoutEffect$1(e){reactExports.useContext(NavigationContext).static||reactExports.useLayoutEffect(e)}function useNavigate(){let{isDataRoute:e}=reactExports.useContext(RouteContext);return e?useNavigateStable():useNavigateUnstable()}function useNavigateUnstable(){invariant$1(useInRouterContext(),"useNavigate() may be used only in the context of a <Router> component.");let e=reactExports.useContext(DataRouterContext),{basename:a,navigator:o}=reactExports.useContext(NavigationContext),{matches:c}=reactExports.useContext(RouteContext),{pathname:d}=useLocation(),$=JSON.stringify(getResolveToMatches(c)),g=reactExports.useRef(!1);return useIsomorphicLayoutEffect$1(()=>{g.current=!0}),reactExports.useCallback((_,j={})=>{if(warning(g.current,navigateEffectWarning),!g.current)return;if(typeof _=="number"){o.go(_);return}let _e=resolveTo(_,JSON.parse($),d,j.relative==="path");e==null&&a!=="/"&&(_e.pathname=_e.pathname==="/"?a:joinPaths([a,_e.pathname])),(j.replace?o.replace:o.push)(_e,j.state,j)},[a,o,$,d,e])}reactExports.createContext(null);function useParams(){let{matches:e}=reactExports.useContext(RouteContext),a=e[e.length-1];return a?a.params:{}}function useResolvedPath(e,{relative:a}={}){let{matches:o}=reactExports.useContext(RouteContext),{pathname:c}=useLocation(),d=JSON.stringify(getResolveToMatches(o));return reactExports.useMemo(()=>resolveTo(e,JSON.parse(d),c,a==="path"),[e,d,c,a])}function useRoutes(e,a){return useRoutesImpl(e,a)}function useRoutesImpl(e,a,o,c){var lt;invariant$1(useInRouterContext(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:d}=reactExports.useContext(NavigationContext),{matches:$}=reactExports.useContext(RouteContext),g=$[$.length-1],b=g?g.params:{};g&&g.pathname;let _=g?g.pathnameBase:"/";g&&g.route;let j=useLocation(),_e;if(a){let mt=typeof a=="string"?parsePath(a):a;invariant$1(_==="/"||((lt=mt.pathname)==null?void 0:lt.startsWith(_)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${_}" but pathname "${mt.pathname}" was given in the \`location\` prop.`),_e=mt}else _e=j;let et=_e.pathname||"/",tt=et;if(_!=="/"){let mt=_.replace(/^\//,"").split("/");tt="/"+et.replace(/^\//,"").split("/").slice(mt.length).join("/")}let nt=matchRoutes(e,{pathname:tt}),at=_renderMatches(nt&&nt.map(mt=>Object.assign({},mt,{params:Object.assign({},b,mt.params),pathname:joinPaths([_,d.encodeLocation?d.encodeLocation(mt.pathname).pathname:mt.pathname]),pathnameBase:mt.pathnameBase==="/"?_:joinPaths([_,d.encodeLocation?d.encodeLocation(mt.pathnameBase).pathname:mt.pathnameBase])})),$,o,c);return a&&at?reactExports.createElement(LocationContext.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",..._e},navigationType:"POP"}},at):at}function DefaultErrorComponent(){let e=useRouteError(),a=isRouteErrorResponse(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),o=e instanceof Error?e.stack:null,d={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("h2",null,"Unexpected Application Error!"),reactExports.createElement("h3",{style:{fontStyle:"italic"}},a),o?reactExports.createElement("pre",{style:d},o):null,null)}var defaultErrorElement=reactExports.createElement(DefaultErrorComponent,null),RenderErrorBoundary=class extends reactExports.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,a){return a.location!==e.location||a.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:a.error,location:a.location,revalidation:e.revalidation||a.revalidation}}componentDidCatch(e,a){console.error("React Router caught the following error during render",e,a)}render(){return this.state.error!==void 0?reactExports.createElement(RouteContext.Provider,{value:this.props.routeContext},reactExports.createElement(RouteErrorContext.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function RenderedRoute({routeContext:e,match:a,children:o}){let c=reactExports.useContext(DataRouterContext);return c&&c.static&&c.staticContext&&(a.route.errorElement||a.route.ErrorBoundary)&&(c.staticContext._deepestRenderedBoundaryId=a.route.id),reactExports.createElement(RouteContext.Provider,{value:e},o)}function _renderMatches(e,a=[],o=null,c=null){if(e==null){if(!o)return null;if(o.errors)e=o.matches;else if(a.length===0&&!o.initialized&&o.matches.length>0)e=o.matches;else return null}let d=e,$=o==null?void 0:o.errors;if($!=null){let _=d.findIndex(j=>j.route.id&&($==null?void 0:$[j.route.id])!==void 0);invariant$1(_>=0,`Could not find a matching route for errors on route IDs: ${Object.keys($).join(",")}`),d=d.slice(0,Math.min(d.length,_+1))}let g=!1,b=-1;if(o)for(let _=0;_<d.length;_++){let j=d[_];if((j.route.HydrateFallback||j.route.hydrateFallbackElement)&&(b=_),j.route.id){let{loaderData:_e,errors:et}=o,tt=j.route.loader&&!_e.hasOwnProperty(j.route.id)&&(!et||et[j.route.id]===void 0);if(j.route.lazy||tt){g=!0,b>=0?d=d.slice(0,b+1):d=[d[0]];break}}}return d.reduceRight((_,j,_e)=>{let et,tt=!1,nt=null,at=null;o&&(et=$&&j.route.id?$[j.route.id]:void 0,nt=j.route.errorElement||defaultErrorElement,g&&(b<0&&_e===0?(warningOnce("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),tt=!0,at=null):b===_e&&(tt=!0,at=j.route.hydrateFallbackElement||null)));let lt=a.concat(d.slice(0,_e+1)),mt=()=>{let ot;return et?ot=nt:tt?ot=at:j.route.Component?ot=reactExports.createElement(j.route.Component,null):j.route.element?ot=j.route.element:ot=_,reactExports.createElement(RenderedRoute,{match:j,routeContext:{outlet:_,matches:lt,isDataRoute:o!=null},children:ot})};return o&&(j.route.ErrorBoundary||j.route.errorElement||_e===0)?reactExports.createElement(RenderErrorBoundary,{location:o.location,revalidation:o.revalidation,component:nt,error:et,children:mt(),routeContext:{outlet:null,matches:lt,isDataRoute:!0}}):mt()},null)}function getDataRouterConsoleError(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function useDataRouterContext(e){let a=reactExports.useContext(DataRouterContext);return invariant$1(a,getDataRouterConsoleError(e)),a}function useDataRouterState(e){let a=reactExports.useContext(DataRouterStateContext);return invariant$1(a,getDataRouterConsoleError(e)),a}function useRouteContext(e){let a=reactExports.useContext(RouteContext);return invariant$1(a,getDataRouterConsoleError(e)),a}function useCurrentRouteId(e){let a=useRouteContext(e),o=a.matches[a.matches.length-1];return invariant$1(o.route.id,`${e} can only be used on routes that contain a unique "id"`),o.route.id}function useRouteId(){return useCurrentRouteId("useRouteId")}function useRouteError(){var c;let e=reactExports.useContext(RouteErrorContext),a=useDataRouterState("useRouteError"),o=useCurrentRouteId("useRouteError");return e!==void 0?e:(c=a.errors)==null?void 0:c[o]}function useNavigateStable(){let{router:e}=useDataRouterContext("useNavigate"),a=useCurrentRouteId("useNavigate"),o=reactExports.useRef(!1);return useIsomorphicLayoutEffect$1(()=>{o.current=!0}),reactExports.useCallback(async(d,$={})=>{warning(o.current,navigateEffectWarning),o.current&&(typeof d=="number"?e.navigate(d):await e.navigate(d,{fromRouteId:a,...$}))},[e,a])}var alreadyWarned={};function warningOnce(e,a,o){alreadyWarned[e]||(alreadyWarned[e]=!0,warning(!1,o))}reactExports.memo(DataRoutes);function DataRoutes({routes:e,future:a,state:o}){return useRoutesImpl(e,void 0,o,a)}function Route(e){invariant$1(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Router({basename:e="/",children:a=null,location:o,navigationType:c="POP",navigator:d,static:$=!1}){invariant$1(!useInRouterContext(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let g=e.replace(/^\/*/,"/"),b=reactExports.useMemo(()=>({basename:g,navigator:d,static:$,future:{}}),[g,d,$]);typeof o=="string"&&(o=parsePath(o));let{pathname:_="/",search:j="",hash:_e="",state:et=null,key:tt="default"}=o,nt=reactExports.useMemo(()=>{let at=stripBasename(_,g);return at==null?null:{location:{pathname:at,search:j,hash:_e,state:et,key:tt},navigationType:c}},[g,_,j,_e,et,tt,c]);return warning(nt!=null,`<Router basename="${g}"> is not able to match the URL "${_}${j}${_e}" because it does not start with the basename, so the <Router> won't render anything.`),nt==null?null:reactExports.createElement(NavigationContext.Provider,{value:b},reactExports.createElement(LocationContext.Provider,{children:a,value:nt}))}function Routes({children:e,location:a}){return useRoutes(createRoutesFromChildren(e),a)}function createRoutesFromChildren(e,a=[]){let o=[];return reactExports.Children.forEach(e,(c,d)=>{if(!reactExports.isValidElement(c))return;let $=[...a,d];if(c.type===reactExports.Fragment){o.push.apply(o,createRoutesFromChildren(c.props.children,$));return}invariant$1(c.type===Route,`[${typeof c.type=="string"?c.type:c.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),invariant$1(!c.props.index||!c.props.children,"An index route cannot have child routes.");let g={id:c.props.id||$.join("-"),caseSensitive:c.props.caseSensitive,element:c.props.element,Component:c.props.Component,index:c.props.index,path:c.props.path,loader:c.props.loader,action:c.props.action,hydrateFallbackElement:c.props.hydrateFallbackElement,HydrateFallback:c.props.HydrateFallback,errorElement:c.props.errorElement,ErrorBoundary:c.props.ErrorBoundary,hasErrorBoundary:c.props.hasErrorBoundary===!0||c.props.ErrorBoundary!=null||c.props.errorElement!=null,shouldRevalidate:c.props.shouldRevalidate,handle:c.props.handle,lazy:c.props.lazy};c.props.children&&(g.children=createRoutesFromChildren(c.props.children,$)),o.push(g)}),o}var defaultMethod="get",defaultEncType="application/x-www-form-urlencoded";function isHtmlElement(e){return e!=null&&typeof e.tagName=="string"}function isButtonElement(e){return isHtmlElement(e)&&e.tagName.toLowerCase()==="button"}function isFormElement(e){return isHtmlElement(e)&&e.tagName.toLowerCase()==="form"}function isInputElement(e){return isHtmlElement(e)&&e.tagName.toLowerCase()==="input"}function isModifiedEvent(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function shouldProcessLinkClick(e,a){return e.button===0&&(!a||a==="_self")&&!isModifiedEvent(e)}var _formDataSupportsSubmitter=null;function isFormDataSubmitterSupported(){if(_formDataSupportsSubmitter===null)try{new FormData(document.createElement("form"),0),_formDataSupportsSubmitter=!1}catch{_formDataSupportsSubmitter=!0}return _formDataSupportsSubmitter}var supportedFormEncTypes=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function getFormEncType(e){return e!=null&&!supportedFormEncTypes.has(e)?(warning(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${defaultEncType}"`),null):e}function getFormSubmissionInfo(e,a){let o,c,d,$,g;if(isFormElement(e)){let b=e.getAttribute("action");c=b?stripBasename(b,a):null,o=e.getAttribute("method")||defaultMethod,d=getFormEncType(e.getAttribute("enctype"))||defaultEncType,$=new FormData(e)}else if(isButtonElement(e)||isInputElement(e)&&(e.type==="submit"||e.type==="image")){let b=e.form;if(b==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let _=e.getAttribute("formaction")||b.getAttribute("action");if(c=_?stripBasename(_,a):null,o=e.getAttribute("formmethod")||b.getAttribute("method")||defaultMethod,d=getFormEncType(e.getAttribute("formenctype"))||getFormEncType(b.getAttribute("enctype"))||defaultEncType,$=new FormData(b,e),!isFormDataSubmitterSupported()){let{name:j,type:_e,value:et}=e;if(_e==="image"){let tt=j?`${j}.`:"";$.append(`${tt}x`,"0"),$.append(`${tt}y`,"0")}else j&&$.append(j,et)}}else{if(isHtmlElement(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');o=defaultMethod,c=null,d=defaultEncType,g=e}return $&&d==="text/plain"&&(g=$,$=void 0),{action:c,method:o.toLowerCase(),encType:d,formData:$,body:g}}function invariant2(e,a){if(e===!1||e===null||typeof e>"u")throw new Error(a)}async function loadRouteModule(e,a){if(e.id in a)return a[e.id];try{let o=await import(e.module);return a[e.id]=o,o}catch(o){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(o),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function isHtmlLinkDescriptor(e){return e==null?!1:e.href==null?e.rel==="preload"&&typeof e.imageSrcSet=="string"&&typeof e.imageSizes=="string":typeof e.rel=="string"&&typeof e.href=="string"}async function getKeyedPrefetchLinks(e,a,o){let c=await Promise.all(e.map(async d=>{let $=a.routes[d.route.id];if($){let g=await loadRouteModule($,o);return g.links?g.links():[]}return[]}));return dedupeLinkDescriptors(c.flat(1).filter(isHtmlLinkDescriptor).filter(d=>d.rel==="stylesheet"||d.rel==="preload").map(d=>d.rel==="stylesheet"?{...d,rel:"prefetch",as:"style"}:{...d,rel:"prefetch"}))}function getNewMatchesForLinks(e,a,o,c,d,$){let g=(_,j)=>o[j]?_.route.id!==o[j].route.id:!0,b=(_,j)=>{var _e;return o[j].pathname!==_.pathname||((_e=o[j].route.path)==null?void 0:_e.endsWith("*"))&&o[j].params["*"]!==_.params["*"]};return $==="assets"?a.filter((_,j)=>g(_,j)||b(_,j)):$==="data"?a.filter((_,j)=>{var et;let _e=c.routes[_.route.id];if(!_e||!_e.hasLoader)return!1;if(g(_,j)||b(_,j))return!0;if(_.route.shouldRevalidate){let tt=_.route.shouldRevalidate({currentUrl:new URL(d.pathname+d.search+d.hash,window.origin),currentParams:((et=o[0])==null?void 0:et.params)||{},nextUrl:new URL(e,window.origin),nextParams:_.params,defaultShouldRevalidate:!0});if(typeof tt=="boolean")return tt}return!0}):[]}function getModuleLinkHrefs(e,a){return dedupeHrefs(e.map(o=>{let c=a.routes[o.route.id];if(!c)return[];let d=[c.module];return c.imports&&(d=d.concat(c.imports)),d}).flat(1))}function dedupeHrefs(e){return[...new Set(e)]}function sortKeys(e){let a={},o=Object.keys(e).sort();for(let c of o)a[c]=e[c];return a}function dedupeLinkDescriptors(e,a){let o=new Set;return new Set(a),e.reduce((c,d)=>{let $=JSON.stringify(sortKeys(d));return o.has($)||(o.add($),c.push({key:$,link:d})),c},[])}function singleFetchUrl(e){let a=typeof e=="string"?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return a.pathname==="/"?a.pathname="_root.data":a.pathname=`${a.pathname.replace(/\/$/,"")}.data`,a}function useDataRouterContext2(){let e=reactExports.useContext(DataRouterContext);return invariant2(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function useDataRouterStateContext(){let e=reactExports.useContext(DataRouterStateContext);return invariant2(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var FrameworkContext=reactExports.createContext(void 0);FrameworkContext.displayName="FrameworkContext";function useFrameworkContext(){let e=reactExports.useContext(FrameworkContext);return invariant2(e,"You must render this element inside a <HydratedRouter> element"),e}function usePrefetchBehavior(e,a){let o=reactExports.useContext(FrameworkContext),[c,d]=reactExports.useState(!1),[$,g]=reactExports.useState(!1),{onFocus:b,onBlur:_,onMouseEnter:j,onMouseLeave:_e,onTouchStart:et}=a,tt=reactExports.useRef(null);reactExports.useEffect(()=>{if(e==="render"&&g(!0),e==="viewport"){let lt=ot=>{ot.forEach(st=>{g(st.isIntersecting)})},mt=new IntersectionObserver(lt,{threshold:.5});return tt.current&&mt.observe(tt.current),()=>{mt.disconnect()}}},[e]),reactExports.useEffect(()=>{if(c){let lt=setTimeout(()=>{g(!0)},100);return()=>{clearTimeout(lt)}}},[c]);let nt=()=>{d(!0)},at=()=>{d(!1),g(!1)};return o?e!=="intent"?[$,tt,{}]:[$,tt,{onFocus:composeEventHandlers$1(b,nt),onBlur:composeEventHandlers$1(_,at),onMouseEnter:composeEventHandlers$1(j,nt),onMouseLeave:composeEventHandlers$1(_e,at),onTouchStart:composeEventHandlers$1(et,nt)}]:[!1,tt,{}]}function composeEventHandlers$1(e,a){return o=>{e&&e(o),o.defaultPrevented||a(o)}}function PrefetchPageLinks({page:e,...a}){let{router:o}=useDataRouterContext2(),c=reactExports.useMemo(()=>matchRoutes(o.routes,e,o.basename),[o.routes,e,o.basename]);return c?reactExports.createElement(PrefetchPageLinksImpl,{page:e,matches:c,...a}):(console.warn(`Tried to prefetch ${e} but no routes matched.`),null)}function useKeyedPrefetchLinks(e){let{manifest:a,routeModules:o}=useFrameworkContext(),[c,d]=reactExports.useState([]);return reactExports.useEffect(()=>{let $=!1;return getKeyedPrefetchLinks(e,a,o).then(g=>{$||d(g)}),()=>{$=!0}},[e,a,o]),c}function PrefetchPageLinksImpl({page:e,matches:a,...o}){let c=useLocation(),{manifest:d,routeModules:$}=useFrameworkContext(),{loaderData:g,matches:b}=useDataRouterStateContext(),_=reactExports.useMemo(()=>getNewMatchesForLinks(e,a,b,d,c,"data"),[e,a,b,d,c]),j=reactExports.useMemo(()=>getNewMatchesForLinks(e,a,b,d,c,"assets"),[e,a,b,d,c]),_e=reactExports.useMemo(()=>{if(e===c.pathname+c.search+c.hash)return[];let nt=new Set,at=!1;if(a.forEach(mt=>{var st;let ot=d.routes[mt.route.id];!ot||!ot.hasLoader||(!_.some(ut=>ut.route.id===mt.route.id)&&mt.route.id in g&&((st=$[mt.route.id])!=null&&st.shouldRevalidate)||ot.hasClientLoader?at=!0:nt.add(mt.route.id))}),nt.size===0)return[];let lt=singleFetchUrl(e);return at&&nt.size>0&&lt.searchParams.set("_routes",a.filter(mt=>nt.has(mt.route.id)).map(mt=>mt.route.id).join(",")),[lt.pathname+lt.search]},[g,c,d,_,a,e,$]),et=reactExports.useMemo(()=>getModuleLinkHrefs(j,d),[j,d]),tt=useKeyedPrefetchLinks(j);return reactExports.createElement(reactExports.Fragment,null,_e.map(nt=>reactExports.createElement("link",{key:nt,rel:"prefetch",as:"fetch",href:nt,...o})),et.map(nt=>reactExports.createElement("link",{key:nt,rel:"modulepreload",href:nt,...o})),tt.map(({key:nt,link:at})=>reactExports.createElement("link",{key:nt,...at})))}function mergeRefs(...e){return a=>{e.forEach(o=>{typeof o=="function"?o(a):o!=null&&(o.current=a)})}}var isBrowser$1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{isBrowser$1&&(window.__reactRouterVersion="7.0.1")}catch{}function HashRouter({basename:e,children:a,window:o}){let c=reactExports.useRef();c.current==null&&(c.current=createHashHistory({window:o,v5Compat:!0}));let d=c.current,[$,g]=reactExports.useState({action:d.action,location:d.location}),b=reactExports.useCallback(_=>{reactExports.startTransition(()=>g(_))},[g]);return reactExports.useLayoutEffect(()=>d.listen(b),[d,b]),reactExports.createElement(Router,{basename:e,children:a,location:$.location,navigationType:$.action,navigator:d})}var ABSOLUTE_URL_REGEX2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Link=reactExports.forwardRef(function({onClick:a,discover:o="render",prefetch:c="none",relative:d,reloadDocument:$,replace:g,state:b,target:_,to:j,preventScrollReset:_e,viewTransition:et,...tt},nt){let{basename:at}=reactExports.useContext(NavigationContext),lt=typeof j=="string"&&ABSOLUTE_URL_REGEX2.test(j),mt,ot=!1;if(typeof j=="string"&&lt&&(mt=j,isBrowser$1))try{let vt=new URL(window.location.href),Pt=j.startsWith("//")?new URL(vt.protocol+j):new URL(j),Tt=stripBasename(Pt.pathname,at);Pt.origin===vt.origin&&Tt!=null?j=Tt+Pt.search+Pt.hash:ot=!0}catch{warning(!1,`<Link to="${j}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let st=useHref(j,{relative:d}),[ut,pt,gt]=usePrefetchBehavior(c,tt),ft=useLinkClickHandler(j,{replace:g,state:b,target:_,preventScrollReset:_e,relative:d,viewTransition:et});function yt(vt){a&&a(vt),vt.defaultPrevented||ft(vt)}let _t=reactExports.createElement("a",{...tt,...gt,href:mt||st,onClick:ot||$?a:yt,ref:mergeRefs(nt,pt),target:_,"data-discover":!lt&&o==="render"?"true":void 0});return ut&&!lt?reactExports.createElement(reactExports.Fragment,null,_t,reactExports.createElement(PrefetchPageLinks,{page:st})):_t});Link.displayName="Link";var NavLink=reactExports.forwardRef(function({"aria-current":a="page",caseSensitive:o=!1,className:c="",end:d=!1,style:$,to:g,viewTransition:b,children:_,...j},_e){let et=useResolvedPath(g,{relative:j.relative}),tt=useLocation(),nt=reactExports.useContext(DataRouterStateContext),{navigator:at,basename:lt}=reactExports.useContext(NavigationContext),mt=nt!=null&&useViewTransitionState(et)&&b===!0,ot=at.encodeLocation?at.encodeLocation(et).pathname:et.pathname,st=tt.pathname,ut=nt&&nt.navigation&&nt.navigation.location?nt.navigation.location.pathname:null;o||(st=st.toLowerCase(),ut=ut?ut.toLowerCase():null,ot=ot.toLowerCase()),ut&&lt&&(ut=stripBasename(ut,lt)||ut);const pt=ot!=="/"&&ot.endsWith("/")?ot.length-1:ot.length;let gt=st===ot||!d&&st.startsWith(ot)&&st.charAt(pt)==="/",ft=ut!=null&&(ut===ot||!d&&ut.startsWith(ot)&&ut.charAt(ot.length)==="/"),yt={isActive:gt,isPending:ft,isTransitioning:mt},_t=gt?a:void 0,vt;typeof c=="function"?vt=c(yt):vt=[c,gt?"active":null,ft?"pending":null,mt?"transitioning":null].filter(Boolean).join(" ");let Pt=typeof $=="function"?$(yt):$;return reactExports.createElement(Link,{...j,"aria-current":_t,className:vt,ref:_e,style:Pt,to:g,viewTransition:b},typeof _=="function"?_(yt):_)});NavLink.displayName="NavLink";var Form=reactExports.forwardRef(({discover:e="render",fetcherKey:a,navigate:o,reloadDocument:c,replace:d,state:$,method:g=defaultMethod,action:b,onSubmit:_,relative:j,preventScrollReset:_e,viewTransition:et,...tt},nt)=>{let at=useSubmit(),lt=useFormAction(b,{relative:j}),mt=g.toLowerCase()==="get"?"get":"post",ot=typeof b=="string"&&ABSOLUTE_URL_REGEX2.test(b),st=ut=>{if(_&&_(ut),ut.defaultPrevented)return;ut.preventDefault();let pt=ut.nativeEvent.submitter,gt=(pt==null?void 0:pt.getAttribute("formmethod"))||g;at(pt||ut.currentTarget,{fetcherKey:a,method:gt,navigate:o,replace:d,state:$,relative:j,preventScrollReset:_e,viewTransition:et})};return reactExports.createElement("form",{ref:nt,method:mt,action:lt,onSubmit:c?_:st,...tt,"data-discover":!ot&&e==="render"?"true":void 0})});Form.displayName="Form";function getDataRouterConsoleError2(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function useDataRouterContext3(e){let a=reactExports.useContext(DataRouterContext);return invariant$1(a,getDataRouterConsoleError2(e)),a}function useLinkClickHandler(e,{target:a,replace:o,state:c,preventScrollReset:d,relative:$,viewTransition:g}={}){let b=useNavigate(),_=useLocation(),j=useResolvedPath(e,{relative:$});return reactExports.useCallback(_e=>{if(shouldProcessLinkClick(_e,a)){_e.preventDefault();let et=o!==void 0?o:createPath(_)===createPath(j);b(e,{replace:et,state:c,preventScrollReset:d,relative:$,viewTransition:g})}},[_,b,j,o,c,a,e,d,$,g])}var fetcherId=0,getUniqueFetcherId=()=>`__${String(++fetcherId)}__`;function useSubmit(){let{router:e}=useDataRouterContext3("useSubmit"),{basename:a}=reactExports.useContext(NavigationContext),o=useRouteId();return reactExports.useCallback(async(c,d={})=>{let{action:$,method:g,encType:b,formData:_,body:j}=getFormSubmissionInfo(c,a);if(d.navigate===!1){let _e=d.fetcherKey||getUniqueFetcherId();await e.fetch(_e,o,d.action||$,{preventScrollReset:d.preventScrollReset,formData:_,body:j,formMethod:d.method||g,formEncType:d.encType||b,flushSync:d.flushSync})}else await e.navigate(d.action||$,{preventScrollReset:d.preventScrollReset,formData:_,body:j,formMethod:d.method||g,formEncType:d.encType||b,replace:d.replace,state:d.state,fromRouteId:o,flushSync:d.flushSync,viewTransition:d.viewTransition})},[e,a,o])}function useFormAction(e,{relative:a}={}){let{basename:o}=reactExports.useContext(NavigationContext),c=reactExports.useContext(RouteContext);invariant$1(c,"useFormAction must be used inside a RouteContext");let[d]=c.matches.slice(-1),$={...useResolvedPath(e||".",{relative:a})},g=useLocation();if(e==null){$.search=g.search;let b=new URLSearchParams($.search),_=b.getAll("index");if(_.some(_e=>_e==="")){b.delete("index"),_.filter(et=>et).forEach(et=>b.append("index",et));let _e=b.toString();$.search=_e?`?${_e}`:""}}return(!e||e===".")&&d.route.index&&($.search=$.search?$.search.replace(/^\?/,"?index&"):"?index"),o!=="/"&&($.pathname=$.pathname==="/"?o:joinPaths([o,$.pathname])),createPath($)}function useViewTransitionState(e,a={}){let o=reactExports.useContext(ViewTransitionContext);invariant$1(o!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:c}=useDataRouterContext3("useViewTransitionState"),d=useResolvedPath(e,{relative:a.relative});if(!o.isTransitioning)return!1;let $=stripBasename(o.currentLocation.pathname,c)||o.currentLocation.pathname,g=stripBasename(o.nextLocation.pathname,c)||o.nextLocation.pathname;return matchPath(d.pathname,g)!=null||matchPath(d.pathname,$)!=null}new TextEncoder;const LayoutGroupContext=reactExports.createContext({});function useConstant(e){const a=reactExports.useRef(null);return a.current===null&&(a.current=e()),a.current}const isBrowser=typeof window<"u",useIsomorphicLayoutEffect=isBrowser?reactExports.useLayoutEffect:reactExports.useEffect,PresenceContext=reactExports.createContext(null);function addUniqueItem(e,a){e.indexOf(a)===-1&&e.push(a)}function removeItem(e,a){const o=e.indexOf(a);o>-1&&e.splice(o,1)}const clamp=(e,a,o)=>o>a?a:o<e?e:o;let invariant=()=>{};const MotionGlobalConfig={},isNumericalString=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function isObject$2(e){return typeof e=="object"&&e!==null}const isZeroValueString=e=>/^0[^.\s]+$/u.test(e);function memo(e){let a;return()=>(a===void 0&&(a=e()),a)}const noop=e=>e,combineFunctions=(e,a)=>o=>a(e(o)),pipe=(...e)=>e.reduce(combineFunctions),progress=(e,a,o)=>{const c=a-e;return c===0?1:(o-e)/c};class SubscriptionManager{constructor(){this.subscriptions=[]}add(a){return addUniqueItem(this.subscriptions,a),()=>removeItem(this.subscriptions,a)}notify(a,o,c){const d=this.subscriptions.length;if(d)if(d===1)this.subscriptions[0](a,o,c);else for(let $=0;$<d;$++){const g=this.subscriptions[$];g&&g(a,o,c)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const secondsToMilliseconds=e=>e*1e3,millisecondsToSeconds=e=>e/1e3;function velocityPerSecond(e,a){return a?e*(1e3/a):0}const calcBezier=(e,a,o)=>(((1-3*o+3*a)*e+(3*o-6*a))*e+3*a)*e,subdivisionPrecision=1e-7,subdivisionMaxIterations=12;function binarySubdivide(e,a,o,c,d){let $,g,b=0;do g=a+(o-a)/2,$=calcBezier(g,c,d)-e,$>0?o=g:a=g;while(Math.abs($)>subdivisionPrecision&&++b<subdivisionMaxIterations);return g}function cubicBezier(e,a,o,c){if(e===a&&o===c)return noop;const d=$=>binarySubdivide($,0,1,e,o);return $=>$===0||$===1?$:calcBezier(d($),a,c)}const mirrorEasing=e=>a=>a<=.5?e(2*a)/2:(2-e(2*(1-a)))/2,reverseEasing=e=>a=>1-e(1-a),backOut=cubicBezier(.33,1.53,.69,.99),backIn=reverseEasing(backOut),backInOut=mirrorEasing(backIn),anticipate=e=>(e*=2)<1?.5*backIn(e):.5*(2-Math.pow(2,-10*(e-1))),circIn=e=>1-Math.sin(Math.acos(e)),circOut=reverseEasing(circIn),circInOut=mirrorEasing(circIn),easeIn=cubicBezier(.42,0,1,1),easeOut=cubicBezier(0,0,.58,1),easeInOut=cubicBezier(.42,0,.58,1),isEasingArray=e=>Array.isArray(e)&&typeof e[0]!="number",isBezierDefinition=e=>Array.isArray(e)&&typeof e[0]=="number",easingLookup={linear:noop,easeIn,easeInOut,easeOut,circIn,circInOut,circOut,backIn,backInOut,backOut,anticipate},isValidEasing=e=>typeof e=="string",easingDefinitionToFunction=e=>{if(isBezierDefinition(e)){invariant(e.length===4);const[a,o,c,d]=e;return cubicBezier(a,o,c,d)}else if(isValidEasing(e))return invariant(easingLookup[e]!==void 0),easingLookup[e];return e},stepsOrder=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],statsBuffer={value:null,addProjectionMetrics:null};function createRenderStep(e,a){let o=new Set,c=new Set,d=!1,$=!1;const g=new WeakSet;let b={delta:0,timestamp:0,isProcessing:!1},_=0;function j(et){g.has(et)&&(_e.schedule(et),e()),_++,et(b)}const _e={schedule:(et,tt=!1,nt=!1)=>{const lt=nt&&d?o:c;return tt&&g.add(et),lt.has(et)||lt.add(et),et},cancel:et=>{c.delete(et),g.delete(et)},process:et=>{if(b=et,d){$=!0;return}d=!0,[o,c]=[c,o],o.forEach(j),a&&statsBuffer.value&&statsBuffer.value.frameloop[a].push(_),_=0,o.clear(),d=!1,$&&($=!1,_e.process(et))}};return _e}const maxElapsed=40;function createRenderBatcher(e,a){let o=!1,c=!0;const d={delta:0,timestamp:0,isProcessing:!1},$=()=>o=!0,g=stepsOrder.reduce((ut,pt)=>(ut[pt]=createRenderStep($,a?pt:void 0),ut),{}),{setup:b,read:_,resolveKeyframes:j,preUpdate:_e,update:et,preRender:tt,render:nt,postRender:at}=g,lt=()=>{const ut=MotionGlobalConfig.useManualTiming?d.timestamp:performance.now();o=!1,MotionGlobalConfig.useManualTiming||(d.delta=c?1e3/60:Math.max(Math.min(ut-d.timestamp,maxElapsed),1)),d.timestamp=ut,d.isProcessing=!0,b.process(d),_.process(d),j.process(d),_e.process(d),et.process(d),tt.process(d),nt.process(d),at.process(d),d.isProcessing=!1,o&&a&&(c=!1,e(lt))},mt=()=>{o=!0,c=!0,d.isProcessing||e(lt)};return{schedule:stepsOrder.reduce((ut,pt)=>{const gt=g[pt];return ut[pt]=(ft,yt=!1,_t=!1)=>(o||mt(),gt.schedule(ft,yt,_t)),ut},{}),cancel:ut=>{for(let pt=0;pt<stepsOrder.length;pt++)g[stepsOrder[pt]].cancel(ut)},state:d,steps:g}}const{schedule:frame,cancel:cancelFrame,state:frameData,steps:frameSteps}=createRenderBatcher(typeof requestAnimationFrame<"u"?requestAnimationFrame:noop,!0);let now;function clearTime(){now=void 0}const time={now:()=>(now===void 0&&time.set(frameData.isProcessing||MotionGlobalConfig.useManualTiming?frameData.timestamp:performance.now()),now),set:e=>{now=e,queueMicrotask(clearTime)}},checkStringStartsWith=e=>a=>typeof a=="string"&&a.startsWith(e),isCSSVariableName=checkStringStartsWith("--"),startsAsVariableToken=checkStringStartsWith("var(--"),isCSSVariableToken=e=>startsAsVariableToken(e)?singleCssVariableRegex.test(e.split("/*")[0].trim()):!1,singleCssVariableRegex=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,number$1={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},alpha={...number$1,transform:e=>clamp(0,1,e)},scale={...number$1,default:1},sanitize=e=>Math.round(e*1e5)/1e5,floatRegex=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function isNullish(e){return e==null}const singleColorRegex=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,isColorString=(e,a)=>o=>!!(typeof o=="string"&&singleColorRegex.test(o)&&o.startsWith(e)||a&&!isNullish(o)&&Object.prototype.hasOwnProperty.call(o,a)),splitColor=(e,a,o)=>c=>{if(typeof c!="string")return c;const[d,$,g,b]=c.match(floatRegex);return{[e]:parseFloat(d),[a]:parseFloat($),[o]:parseFloat(g),alpha:b!==void 0?parseFloat(b):1}},clampRgbUnit=e=>clamp(0,255,e),rgbUnit={...number$1,transform:e=>Math.round(clampRgbUnit(e))},rgba={test:isColorString("rgb","red"),parse:splitColor("red","green","blue"),transform:({red:e,green:a,blue:o,alpha:c=1})=>"rgba("+rgbUnit.transform(e)+", "+rgbUnit.transform(a)+", "+rgbUnit.transform(o)+", "+sanitize(alpha.transform(c))+")"};function parseHex(e){let a="",o="",c="",d="";return e.length>5?(a=e.substring(1,3),o=e.substring(3,5),c=e.substring(5,7),d=e.substring(7,9)):(a=e.substring(1,2),o=e.substring(2,3),c=e.substring(3,4),d=e.substring(4,5),a+=a,o+=o,c+=c,d+=d),{red:parseInt(a,16),green:parseInt(o,16),blue:parseInt(c,16),alpha:d?parseInt(d,16)/255:1}}const hex={test:isColorString("#"),parse:parseHex,transform:rgba.transform},createUnitType=e=>({test:a=>typeof a=="string"&&a.endsWith(e)&&a.split(" ").length===1,parse:parseFloat,transform:a=>`${a}${e}`}),degrees=createUnitType("deg"),percent=createUnitType("%"),px=createUnitType("px"),vh=createUnitType("vh"),vw=createUnitType("vw"),progressPercentage={...percent,parse:e=>percent.parse(e)/100,transform:e=>percent.transform(e*100)},hsla={test:isColorString("hsl","hue"),parse:splitColor("hue","saturation","lightness"),transform:({hue:e,saturation:a,lightness:o,alpha:c=1})=>"hsla("+Math.round(e)+", "+percent.transform(sanitize(a))+", "+percent.transform(sanitize(o))+", "+sanitize(alpha.transform(c))+")"},color$1={test:e=>rgba.test(e)||hex.test(e)||hsla.test(e),parse:e=>rgba.test(e)?rgba.parse(e):hsla.test(e)?hsla.parse(e):hex.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?rgba.transform(e):hsla.transform(e),getAnimatableNone:e=>{const a=color$1.parse(e);return a.alpha=0,color$1.transform(a)}},colorRegex=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function test(e){var a,o;return isNaN(e)&&typeof e=="string"&&(((a=e.match(floatRegex))==null?void 0:a.length)||0)+(((o=e.match(colorRegex))==null?void 0:o.length)||0)>0}const NUMBER_TOKEN="number",COLOR_TOKEN="color",VAR_TOKEN="var",VAR_FUNCTION_TOKEN="var(",SPLIT_TOKEN="${}",complexRegex=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function analyseComplexValue(e){const a=e.toString(),o=[],c={color:[],number:[],var:[]},d=[];let $=0;const b=a.replace(complexRegex,_=>(color$1.test(_)?(c.color.push($),d.push(COLOR_TOKEN),o.push(color$1.parse(_))):_.startsWith(VAR_FUNCTION_TOKEN)?(c.var.push($),d.push(VAR_TOKEN),o.push(_)):(c.number.push($),d.push(NUMBER_TOKEN),o.push(parseFloat(_))),++$,SPLIT_TOKEN)).split(SPLIT_TOKEN);return{values:o,split:b,indexes:c,types:d}}function parseComplexValue(e){return analyseComplexValue(e).values}function createTransformer(e){const{split:a,types:o}=analyseComplexValue(e),c=a.length;return d=>{let $="";for(let g=0;g<c;g++)if($+=a[g],d[g]!==void 0){const b=o[g];b===NUMBER_TOKEN?$+=sanitize(d[g]):b===COLOR_TOKEN?$+=color$1.transform(d[g]):$+=d[g]}return $}}const convertNumbersToZero=e=>typeof e=="number"?0:color$1.test(e)?color$1.getAnimatableNone(e):e;function getAnimatableNone$1(e){const a=parseComplexValue(e);return createTransformer(e)(a.map(convertNumbersToZero))}const complex={test,parse:parseComplexValue,createTransformer,getAnimatableNone:getAnimatableNone$1};function hueToRgb(e,a,o){return o<0&&(o+=1),o>1&&(o-=1),o<1/6?e+(a-e)*6*o:o<1/2?a:o<2/3?e+(a-e)*(2/3-o)*6:e}function hslaToRgba({hue:e,saturation:a,lightness:o,alpha:c}){e/=360,a/=100,o/=100;let d=0,$=0,g=0;if(!a)d=$=g=o;else{const b=o<.5?o*(1+a):o+a-o*a,_=2*o-b;d=hueToRgb(_,b,e+1/3),$=hueToRgb(_,b,e),g=hueToRgb(_,b,e-1/3)}return{red:Math.round(d*255),green:Math.round($*255),blue:Math.round(g*255),alpha:c}}function mixImmediate(e,a){return o=>o>0?a:e}const mixNumber$1=(e,a,o)=>e+(a-e)*o,mixLinearColor=(e,a,o)=>{const c=e*e,d=o*(a*a-c)+c;return d<0?0:Math.sqrt(d)},colorTypes=[hex,rgba,hsla],getColorType=e=>colorTypes.find(a=>a.test(e));function asRGBA(e){const a=getColorType(e);if(!a)return!1;let o=a.parse(e);return a===hsla&&(o=hslaToRgba(o)),o}const mixColor=(e,a)=>{const o=asRGBA(e),c=asRGBA(a);if(!o||!c)return mixImmediate(e,a);const d={...o};return $=>(d.red=mixLinearColor(o.red,c.red,$),d.green=mixLinearColor(o.green,c.green,$),d.blue=mixLinearColor(o.blue,c.blue,$),d.alpha=mixNumber$1(o.alpha,c.alpha,$),rgba.transform(d))},invisibleValues=new Set(["none","hidden"]);function mixVisibility(e,a){return invisibleValues.has(e)?o=>o<=0?e:a:o=>o>=1?a:e}function mixNumber(e,a){return o=>mixNumber$1(e,a,o)}function getMixer(e){return typeof e=="number"?mixNumber:typeof e=="string"?isCSSVariableToken(e)?mixImmediate:color$1.test(e)?mixColor:mixComplex:Array.isArray(e)?mixArray:typeof e=="object"?color$1.test(e)?mixColor:mixObject:mixImmediate}function mixArray(e,a){const o=[...e],c=o.length,d=e.map(($,g)=>getMixer($)($,a[g]));return $=>{for(let g=0;g<c;g++)o[g]=d[g]($);return o}}function mixObject(e,a){const o={...e,...a},c={};for(const d in o)e[d]!==void 0&&a[d]!==void 0&&(c[d]=getMixer(e[d])(e[d],a[d]));return d=>{for(const $ in c)o[$]=c[$](d);return o}}function matchOrder(e,a){const o=[],c={color:0,var:0,number:0};for(let d=0;d<a.values.length;d++){const $=a.types[d],g=e.indexes[$][c[$]],b=e.values[g]??0;o[d]=b,c[$]++}return o}const mixComplex=(e,a)=>{const o=complex.createTransformer(a),c=analyseComplexValue(e),d=analyseComplexValue(a);return c.indexes.var.length===d.indexes.var.length&&c.indexes.color.length===d.indexes.color.length&&c.indexes.number.length>=d.indexes.number.length?invisibleValues.has(e)&&!d.values.length||invisibleValues.has(a)&&!c.values.length?mixVisibility(e,a):pipe(mixArray(matchOrder(c,d),d.values),o):mixImmediate(e,a)};function mix(e,a,o){return typeof e=="number"&&typeof a=="number"&&typeof o=="number"?mixNumber$1(e,a,o):getMixer(e)(e,a)}const frameloopDriver=e=>{const a=({timestamp:o})=>e(o);return{start:(o=!0)=>frame.update(a,o),stop:()=>cancelFrame(a),now:()=>frameData.isProcessing?frameData.timestamp:time.now()}},generateLinearEasing=(e,a,o=10)=>{let c="";const d=Math.max(Math.round(a/o),2);for(let $=0;$<d;$++)c+=Math.round(e($/(d-1))*1e4)/1e4+", ";return`linear(${c.substring(0,c.length-2)})`},maxGeneratorDuration=2e4;function calcGeneratorDuration(e){let a=0;const o=50;let c=e.next(a);for(;!c.done&&a<maxGeneratorDuration;)a+=o,c=e.next(a);return a>=maxGeneratorDuration?1/0:a}function createGeneratorEasing(e,a=100,o){const c=o({...e,keyframes:[0,a]}),d=Math.min(calcGeneratorDuration(c),maxGeneratorDuration);return{type:"keyframes",ease:$=>c.next(d*$).value/a,duration:millisecondsToSeconds(d)}}const velocitySampleDuration=5;function calcGeneratorVelocity(e,a,o){const c=Math.max(a-velocitySampleDuration,0);return velocityPerSecond(o-e(c),a-c)}const springDefaults={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},safeMin=.001;function findSpring({duration:e=springDefaults.duration,bounce:a=springDefaults.bounce,velocity:o=springDefaults.velocity,mass:c=springDefaults.mass}){let d,$,g=1-a;g=clamp(springDefaults.minDamping,springDefaults.maxDamping,g),e=clamp(springDefaults.minDuration,springDefaults.maxDuration,millisecondsToSeconds(e)),g<1?(d=j=>{const _e=j*g,et=_e*e,tt=_e-o,nt=calcAngularFreq(j,g),at=Math.exp(-et);return safeMin-tt/nt*at},$=j=>{const et=j*g*e,tt=et*o+o,nt=Math.pow(g,2)*Math.pow(j,2)*e,at=Math.exp(-et),lt=calcAngularFreq(Math.pow(j,2),g);return(-d(j)+safeMin>0?-1:1)*((tt-nt)*at)/lt}):(d=j=>{const _e=Math.exp(-j*e),et=(j-o)*e+1;return-safeMin+_e*et},$=j=>{const _e=Math.exp(-j*e),et=(o-j)*(e*e);return _e*et});const b=5/e,_=approximateRoot(d,$,b);if(e=secondsToMilliseconds(e),isNaN(_))return{stiffness:springDefaults.stiffness,damping:springDefaults.damping,duration:e};{const j=Math.pow(_,2)*c;return{stiffness:j,damping:g*2*Math.sqrt(c*j),duration:e}}}const rootIterations=12;function approximateRoot(e,a,o){let c=o;for(let d=1;d<rootIterations;d++)c=c-e(c)/a(c);return c}function calcAngularFreq(e,a){return e*Math.sqrt(1-a*a)}const durationKeys=["duration","bounce"],physicsKeys=["stiffness","damping","mass"];function isSpringType(e,a){return a.some(o=>e[o]!==void 0)}function getSpringOptions(e){let a={velocity:springDefaults.velocity,stiffness:springDefaults.stiffness,damping:springDefaults.damping,mass:springDefaults.mass,isResolvedFromDuration:!1,...e};if(!isSpringType(e,physicsKeys)&&isSpringType(e,durationKeys))if(e.visualDuration){const o=e.visualDuration,c=2*Math.PI/(o*1.2),d=c*c,$=2*clamp(.05,1,1-(e.bounce||0))*Math.sqrt(d);a={...a,mass:springDefaults.mass,stiffness:d,damping:$}}else{const o=findSpring(e);a={...a,...o,mass:springDefaults.mass},a.isResolvedFromDuration=!0}return a}function spring(e=springDefaults.visualDuration,a=springDefaults.bounce){const o=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:a}:e;let{restSpeed:c,restDelta:d}=o;const $=o.keyframes[0],g=o.keyframes[o.keyframes.length-1],b={done:!1,value:$},{stiffness:_,damping:j,mass:_e,duration:et,velocity:tt,isResolvedFromDuration:nt}=getSpringOptions({...o,velocity:-millisecondsToSeconds(o.velocity||0)}),at=tt||0,lt=j/(2*Math.sqrt(_*_e)),mt=g-$,ot=millisecondsToSeconds(Math.sqrt(_/_e)),st=Math.abs(mt)<5;c||(c=st?springDefaults.restSpeed.granular:springDefaults.restSpeed.default),d||(d=st?springDefaults.restDelta.granular:springDefaults.restDelta.default);let ut;if(lt<1){const gt=calcAngularFreq(ot,lt);ut=ft=>{const yt=Math.exp(-lt*ot*ft);return g-yt*((at+lt*ot*mt)/gt*Math.sin(gt*ft)+mt*Math.cos(gt*ft))}}else if(lt===1)ut=gt=>g-Math.exp(-ot*gt)*(mt+(at+ot*mt)*gt);else{const gt=ot*Math.sqrt(lt*lt-1);ut=ft=>{const yt=Math.exp(-lt*ot*ft),_t=Math.min(gt*ft,300);return g-yt*((at+lt*ot*mt)*Math.sinh(_t)+gt*mt*Math.cosh(_t))/gt}}const pt={calculatedDuration:nt&&et||null,next:gt=>{const ft=ut(gt);if(nt)b.done=gt>=et;else{let yt=gt===0?at:0;lt<1&&(yt=gt===0?secondsToMilliseconds(at):calcGeneratorVelocity(ut,gt,ft));const _t=Math.abs(yt)<=c,vt=Math.abs(g-ft)<=d;b.done=_t&&vt}return b.value=b.done?g:ft,b},toString:()=>{const gt=Math.min(calcGeneratorDuration(pt),maxGeneratorDuration),ft=generateLinearEasing(yt=>pt.next(gt*yt).value,gt,30);return gt+"ms "+ft},toTransition:()=>{}};return pt}spring.applyToOptions=e=>{const a=createGeneratorEasing(e,100,spring);return e.ease=a.ease,e.duration=secondsToMilliseconds(a.duration),e.type="keyframes",e};function inertia({keyframes:e,velocity:a=0,power:o=.8,timeConstant:c=325,bounceDamping:d=10,bounceStiffness:$=500,modifyTarget:g,min:b,max:_,restDelta:j=.5,restSpeed:_e}){const et=e[0],tt={done:!1,value:et},nt=_t=>b!==void 0&&_t<b||_!==void 0&&_t>_,at=_t=>b===void 0?_:_===void 0||Math.abs(b-_t)<Math.abs(_-_t)?b:_;let lt=o*a;const mt=et+lt,ot=g===void 0?mt:g(mt);ot!==mt&&(lt=ot-et);const st=_t=>-lt*Math.exp(-_t/c),ut=_t=>ot+st(_t),pt=_t=>{const vt=st(_t),Pt=ut(_t);tt.done=Math.abs(vt)<=j,tt.value=tt.done?ot:Pt};let gt,ft;const yt=_t=>{nt(tt.value)&&(gt=_t,ft=spring({keyframes:[tt.value,at(tt.value)],velocity:calcGeneratorVelocity(ut,_t,tt.value),damping:d,stiffness:$,restDelta:j,restSpeed:_e}))};return yt(0),{calculatedDuration:null,next:_t=>{let vt=!1;return!ft&&gt===void 0&&(vt=!0,pt(_t),yt(_t)),gt!==void 0&&_t>=gt?ft.next(_t-gt):(!vt&&pt(_t),tt)}}}function createMixers(e,a,o){const c=[],d=o||MotionGlobalConfig.mix||mix,$=e.length-1;for(let g=0;g<$;g++){let b=d(e[g],e[g+1]);if(a){const _=Array.isArray(a)?a[g]||noop:a;b=pipe(_,b)}c.push(b)}return c}function interpolate(e,a,{clamp:o=!0,ease:c,mixer:d}={}){const $=e.length;if(invariant($===a.length),$===1)return()=>a[0];if($===2&&a[0]===a[1])return()=>a[1];const g=e[0]===e[1];e[0]>e[$-1]&&(e=[...e].reverse(),a=[...a].reverse());const b=createMixers(a,c,d),_=b.length,j=_e=>{if(g&&_e<e[0])return a[0];let et=0;if(_>1)for(;et<e.length-2&&!(_e<e[et+1]);et++);const tt=progress(e[et],e[et+1],_e);return b[et](tt)};return o?_e=>j(clamp(e[0],e[$-1],_e)):j}function fillOffset(e,a){const o=e[e.length-1];for(let c=1;c<=a;c++){const d=progress(0,a,c);e.push(mixNumber$1(o,1,d))}}function defaultOffset(e){const a=[0];return fillOffset(a,e.length-1),a}function convertOffsetToTimes(e,a){return e.map(o=>o*a)}function defaultEasing(e,a){return e.map(()=>a||easeInOut).splice(0,e.length-1)}function keyframes({duration:e=300,keyframes:a,times:o,ease:c="easeInOut"}){const d=isEasingArray(c)?c.map(easingDefinitionToFunction):easingDefinitionToFunction(c),$={done:!1,value:a[0]},g=convertOffsetToTimes(o&&o.length===a.length?o:defaultOffset(a),e),b=interpolate(g,a,{ease:Array.isArray(d)?d:defaultEasing(a,d)});return{calculatedDuration:e,next:_=>($.value=b(_),$.done=_>=e,$)}}const isNotNull$1=e=>e!==null;function getFinalKeyframe$1(e,{repeat:a,repeatType:o="loop"},c,d=1){const $=e.filter(isNotNull$1),b=d<0||a&&o!=="loop"&&a%2===1?0:$.length-1;return!b||c===void 0?$[b]:c}const transitionTypeMap={decay:inertia,inertia,tween:keyframes,keyframes,spring};function replaceTransitionType(e){typeof e.type=="string"&&(e.type=transitionTypeMap[e.type])}class WithPromise{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(a=>{this.resolve=a})}notifyFinished(){this.resolve()}then(a,o){return this.finished.then(a,o)}}const percentToProgress=e=>e/100;class JSAnimation extends WithPromise{constructor(a){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var c,d;const{motionValue:o}=this.options;o&&o.updatedAt!==time.now()&&this.tick(time.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(d=(c=this.options).onStop)==null||d.call(c))},this.options=a,this.initAnimation(),this.play(),a.autoplay===!1&&this.pause()}initAnimation(){const{options:a}=this;replaceTransitionType(a);const{type:o=keyframes,repeat:c=0,repeatDelay:d=0,repeatType:$,velocity:g=0}=a;let{keyframes:b}=a;const _=o||keyframes;_!==keyframes&&typeof b[0]!="number"&&(this.mixKeyframes=pipe(percentToProgress,mix(b[0],b[1])),b=[0,100]);const j=_({...a,keyframes:b});$==="mirror"&&(this.mirroredGenerator=_({...a,keyframes:[...b].reverse(),velocity:-g})),j.calculatedDuration===null&&(j.calculatedDuration=calcGeneratorDuration(j));const{calculatedDuration:_e}=j;this.calculatedDuration=_e,this.resolvedDuration=_e+d,this.totalDuration=this.resolvedDuration*(c+1)-d,this.generator=j}updateTime(a){const o=Math.round(a-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=o}tick(a,o=!1){const{generator:c,totalDuration:d,mixKeyframes:$,mirroredGenerator:g,resolvedDuration:b,calculatedDuration:_}=this;if(this.startTime===null)return c.next(0);const{delay:j=0,keyframes:_e,repeat:et,repeatType:tt,repeatDelay:nt,type:at,onUpdate:lt,finalKeyframe:mt}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,a):this.speed<0&&(this.startTime=Math.min(a-d/this.speed,this.startTime)),o?this.currentTime=a:this.updateTime(a);const ot=this.currentTime-j*(this.playbackSpeed>=0?1:-1),st=this.playbackSpeed>=0?ot<0:ot>d;this.currentTime=Math.max(ot,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=d);let ut=this.currentTime,pt=c;if(et){const _t=Math.min(this.currentTime,d)/b;let vt=Math.floor(_t),Pt=_t%1;!Pt&&_t>=1&&(Pt=1),Pt===1&&vt--,vt=Math.min(vt,et+1),!!(vt%2)&&(tt==="reverse"?(Pt=1-Pt,nt&&(Pt-=nt/b)):tt==="mirror"&&(pt=g)),ut=clamp(0,1,Pt)*b}const gt=st?{done:!1,value:_e[0]}:pt.next(ut);$&&(gt.value=$(gt.value));let{done:ft}=gt;!st&&_!==null&&(ft=this.playbackSpeed>=0?this.currentTime>=d:this.currentTime<=0);const yt=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&ft);return yt&&at!==inertia&&(gt.value=getFinalKeyframe$1(_e,this.options,mt,this.speed)),lt&&lt(gt.value),yt&&this.finish(),gt}then(a,o){return this.finished.then(a,o)}get duration(){return millisecondsToSeconds(this.calculatedDuration)}get time(){return millisecondsToSeconds(this.currentTime)}set time(a){var o;a=secondsToMilliseconds(a),this.currentTime=a,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=a:this.driver&&(this.startTime=this.driver.now()-a/this.playbackSpeed),(o=this.driver)==null||o.start(!1)}get speed(){return this.playbackSpeed}set speed(a){this.updateTime(time.now());const o=this.playbackSpeed!==a;this.playbackSpeed=a,o&&(this.time=millisecondsToSeconds(this.currentTime))}play(){var d,$;if(this.isStopped)return;const{driver:a=frameloopDriver,startTime:o}=this.options;this.driver||(this.driver=a(g=>this.tick(g))),($=(d=this.options).onPlay)==null||$.call(d);const c=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=c):this.holdTime!==null?this.startTime=c-this.holdTime:this.startTime||(this.startTime=o??c),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(time.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var a,o;this.notifyFinished(),this.teardown(),this.state="finished",(o=(a=this.options).onComplete)==null||o.call(a)}cancel(){var a,o;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(o=(a=this.options).onCancel)==null||o.call(a)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(a){return this.startTime=0,this.tick(a,!0)}attachTimeline(a){var o;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(o=this.driver)==null||o.stop(),a.observe(this)}}function fillWildcards(e){for(let a=1;a<e.length;a++)e[a]??(e[a]=e[a-1])}const radToDeg=e=>e*180/Math.PI,rotate=e=>{const a=radToDeg(Math.atan2(e[1],e[0]));return rebaseAngle(a)},matrix2dParsers={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate,rotateZ:rotate,skewX:e=>radToDeg(Math.atan(e[1])),skewY:e=>radToDeg(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},rebaseAngle=e=>(e=e%360,e<0&&(e+=360),e),rotateZ=rotate,scaleX=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),scaleY=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),matrix3dParsers={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX,scaleY,scale:e=>(scaleX(e)+scaleY(e))/2,rotateX:e=>rebaseAngle(radToDeg(Math.atan2(e[6],e[5]))),rotateY:e=>rebaseAngle(radToDeg(Math.atan2(-e[2],e[0]))),rotateZ,rotate:rotateZ,skewX:e=>radToDeg(Math.atan(e[4])),skewY:e=>radToDeg(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function defaultTransformValue(e){return e.includes("scale")?1:0}function parseValueFromTransform(e,a){if(!e||e==="none")return defaultTransformValue(a);const o=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let c,d;if(o)c=matrix3dParsers,d=o;else{const b=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);c=matrix2dParsers,d=b}if(!d)return defaultTransformValue(a);const $=c[a],g=d[1].split(",").map(convertTransformToNumber);return typeof $=="function"?$(g):g[$]}const readTransformValue=(e,a)=>{const{transform:o="none"}=getComputedStyle(e);return parseValueFromTransform(o,a)};function convertTransformToNumber(e){return parseFloat(e.trim())}const transformPropOrder=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],transformProps=new Set(transformPropOrder),isNumOrPxType=e=>e===number$1||e===px,transformKeys=new Set(["x","y","z"]),nonTranslationalTransformKeys=transformPropOrder.filter(e=>!transformKeys.has(e));function removeNonTranslationalTransform(e){const a=[];return nonTranslationalTransformKeys.forEach(o=>{const c=e.getValue(o);c!==void 0&&(a.push([o,c.get()]),c.set(o.startsWith("scale")?1:0))}),a}const positionalValues={width:({x:e},{paddingLeft:a="0",paddingRight:o="0"})=>e.max-e.min-parseFloat(a)-parseFloat(o),height:({y:e},{paddingTop:a="0",paddingBottom:o="0"})=>e.max-e.min-parseFloat(a)-parseFloat(o),top:(e,{top:a})=>parseFloat(a),left:(e,{left:a})=>parseFloat(a),bottom:({y:e},{top:a})=>parseFloat(a)+(e.max-e.min),right:({x:e},{left:a})=>parseFloat(a)+(e.max-e.min),x:(e,{transform:a})=>parseValueFromTransform(a,"x"),y:(e,{transform:a})=>parseValueFromTransform(a,"y")};positionalValues.translateX=positionalValues.x;positionalValues.translateY=positionalValues.y;const toResolve=new Set;let isScheduled=!1,anyNeedsMeasurement=!1,isForced=!1;function measureAllKeyframes(){if(anyNeedsMeasurement){const e=Array.from(toResolve).filter(c=>c.needsMeasurement),a=new Set(e.map(c=>c.element)),o=new Map;a.forEach(c=>{const d=removeNonTranslationalTransform(c);d.length&&(o.set(c,d),c.render())}),e.forEach(c=>c.measureInitialState()),a.forEach(c=>{c.render();const d=o.get(c);d&&d.forEach(([$,g])=>{var b;(b=c.getValue($))==null||b.set(g)})}),e.forEach(c=>c.measureEndState()),e.forEach(c=>{c.suspendedScrollY!==void 0&&window.scrollTo(0,c.suspendedScrollY)})}anyNeedsMeasurement=!1,isScheduled=!1,toResolve.forEach(e=>e.complete(isForced)),toResolve.clear()}function readAllKeyframes(){toResolve.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(anyNeedsMeasurement=!0)})}function flushKeyframeResolvers(){isForced=!0,readAllKeyframes(),measureAllKeyframes(),isForced=!1}class KeyframeResolver{constructor(a,o,c,d,$,g=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...a],this.onComplete=o,this.name=c,this.motionValue=d,this.element=$,this.isAsync=g}scheduleResolve(){this.state="scheduled",this.isAsync?(toResolve.add(this),isScheduled||(isScheduled=!0,frame.read(readAllKeyframes),frame.resolveKeyframes(measureAllKeyframes))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:a,name:o,element:c,motionValue:d}=this;if(a[0]===null){const $=d==null?void 0:d.get(),g=a[a.length-1];if($!==void 0)a[0]=$;else if(c&&o){const b=c.readValue(o,g);b!=null&&(a[0]=b)}a[0]===void 0&&(a[0]=g),d&&$===void 0&&d.set(a[0])}fillWildcards(a)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(a=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,a),toResolve.delete(this)}cancel(){this.state==="scheduled"&&(toResolve.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const isCSSVar=e=>e.startsWith("--");function setStyle(e,a,o){isCSSVar(a)?e.style.setProperty(a,o):e.style[a]=o}const supportsScrollTimeline=memo(()=>window.ScrollTimeline!==void 0),supportsFlags={};function memoSupports(e,a){const o=memo(e);return()=>supportsFlags[a]??o()}const supportsLinearEasing=memoSupports(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),cubicBezierAsString=([e,a,o,c])=>`cubic-bezier(${e}, ${a}, ${o}, ${c})`,supportedWaapiEasing={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:cubicBezierAsString([0,.65,.55,1]),circOut:cubicBezierAsString([.55,0,1,.45]),backIn:cubicBezierAsString([.31,.01,.66,-.59]),backOut:cubicBezierAsString([.33,1.53,.69,.99])};function mapEasingToNativeEasing(e,a){if(e)return typeof e=="function"?supportsLinearEasing()?generateLinearEasing(e,a):"ease-out":isBezierDefinition(e)?cubicBezierAsString(e):Array.isArray(e)?e.map(o=>mapEasingToNativeEasing(o,a)||supportedWaapiEasing.easeOut):supportedWaapiEasing[e]}function startWaapiAnimation(e,a,o,{delay:c=0,duration:d=300,repeat:$=0,repeatType:g="loop",ease:b="easeOut",times:_}={},j=void 0){const _e={[a]:o};_&&(_e.offset=_);const et=mapEasingToNativeEasing(b,d);Array.isArray(et)&&(_e.easing=et);const tt={delay:c,duration:d,easing:Array.isArray(et)?"linear":et,fill:"both",iterations:$+1,direction:g==="reverse"?"alternate":"normal"};return j&&(tt.pseudoElement=j),e.animate(_e,tt)}function isGenerator(e){return typeof e=="function"&&"applyToOptions"in e}function applyGeneratorOptions({type:e,...a}){return isGenerator(e)&&supportsLinearEasing()?e.applyToOptions(a):(a.duration??(a.duration=300),a.ease??(a.ease="easeOut"),a)}class NativeAnimation extends WithPromise{constructor(a){if(super(),this.finishedTime=null,this.isStopped=!1,!a)return;const{element:o,name:c,keyframes:d,pseudoElement:$,allowFlatten:g=!1,finalKeyframe:b,onComplete:_}=a;this.isPseudoElement=!!$,this.allowFlatten=g,this.options=a,invariant(typeof a.type!="string");const j=applyGeneratorOptions(a);this.animation=startWaapiAnimation(o,c,d,j,$),j.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!$){const _e=getFinalKeyframe$1(d,this.options,b,this.speed);this.updateMotionValue?this.updateMotionValue(_e):setStyle(o,c,_e),this.animation.cancel()}_==null||_(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var a,o;(o=(a=this.animation).finish)==null||o.call(a)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:a}=this;a==="idle"||a==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var a,o;this.isPseudoElement||(o=(a=this.animation).commitStyles)==null||o.call(a)}get duration(){var o,c;const a=((c=(o=this.animation.effect)==null?void 0:o.getComputedTiming)==null?void 0:c.call(o).duration)||0;return millisecondsToSeconds(Number(a))}get time(){return millisecondsToSeconds(Number(this.animation.currentTime)||0)}set time(a){this.finishedTime=null,this.animation.currentTime=secondsToMilliseconds(a)}get speed(){return this.animation.playbackRate}set speed(a){a<0&&(this.finishedTime=null),this.animation.playbackRate=a}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(a){this.animation.startTime=a}attachTimeline({timeline:a,observe:o}){var c;return this.allowFlatten&&((c=this.animation.effect)==null||c.updateTiming({easing:"linear"})),this.animation.onfinish=null,a&&supportsScrollTimeline()?(this.animation.timeline=a,noop):o(this)}}const unsupportedEasingFunctions={anticipate,backInOut,circInOut};function isUnsupportedEase(e){return e in unsupportedEasingFunctions}function replaceStringEasing(e){typeof e.ease=="string"&&isUnsupportedEase(e.ease)&&(e.ease=unsupportedEasingFunctions[e.ease])}const sampleDelta=10;class NativeAnimationExtended extends NativeAnimation{constructor(a){replaceStringEasing(a),replaceTransitionType(a),super(a),a.startTime&&(this.startTime=a.startTime),this.options=a}updateMotionValue(a){const{motionValue:o,onUpdate:c,onComplete:d,element:$,...g}=this.options;if(!o)return;if(a!==void 0){o.set(a);return}const b=new JSAnimation({...g,autoplay:!1}),_=secondsToMilliseconds(this.finishedTime??this.time);o.setWithVelocity(b.sample(_-sampleDelta).value,b.sample(_).value,sampleDelta),b.stop()}}const isAnimatable=(e,a)=>a==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(complex.test(e)||e==="0")&&!e.startsWith("url("));function hasKeyframesChanged(e){const a=e[0];if(e.length===1)return!0;for(let o=0;o<e.length;o++)if(e[o]!==a)return!0}function canAnimate(e,a,o,c){const d=e[0];if(d===null)return!1;if(a==="display"||a==="visibility")return!0;const $=e[e.length-1],g=isAnimatable(d,a),b=isAnimatable($,a);return!g||!b?!1:hasKeyframesChanged(e)||(o==="spring"||isGenerator(o))&&c}function makeAnimationInstant(e){e.duration=0,e.type}const acceleratedValues=new Set(["opacity","clipPath","filter","transform"]),supportsWaapi=memo(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function supportsBrowserAnimation(e){var _e;const{motionValue:a,name:o,repeatDelay:c,repeatType:d,damping:$,type:g}=e;if(!(((_e=a==null?void 0:a.owner)==null?void 0:_e.current)instanceof HTMLElement))return!1;const{onUpdate:_,transformTemplate:j}=a.owner.getProps();return supportsWaapi()&&o&&acceleratedValues.has(o)&&(o!=="transform"||!j)&&!_&&!c&&d!=="mirror"&&$!==0&&g!=="inertia"}const MAX_RESOLVE_DELAY=40;class AsyncMotionValueAnimation extends WithPromise{constructor({autoplay:a=!0,delay:o=0,type:c="keyframes",repeat:d=0,repeatDelay:$=0,repeatType:g="loop",keyframes:b,name:_,motionValue:j,element:_e,...et}){var at;super(),this.stop=()=>{var lt,mt;this._animation&&(this._animation.stop(),(lt=this.stopTimeline)==null||lt.call(this)),(mt=this.keyframeResolver)==null||mt.cancel()},this.createdAt=time.now();const tt={autoplay:a,delay:o,type:c,repeat:d,repeatDelay:$,repeatType:g,name:_,motionValue:j,element:_e,...et},nt=(_e==null?void 0:_e.KeyframeResolver)||KeyframeResolver;this.keyframeResolver=new nt(b,(lt,mt,ot)=>this.onKeyframesResolved(lt,mt,tt,!ot),_,j,_e),(at=this.keyframeResolver)==null||at.scheduleResolve()}onKeyframesResolved(a,o,c,d){this.keyframeResolver=void 0;const{name:$,type:g,velocity:b,delay:_,isHandoff:j,onUpdate:_e}=c;this.resolvedAt=time.now(),canAnimate(a,$,g,b)||((MotionGlobalConfig.instantAnimations||!_)&&(_e==null||_e(getFinalKeyframe$1(a,c,o))),a[0]=a[a.length-1],makeAnimationInstant(c),c.repeat=0);const tt={startTime:d?this.resolvedAt?this.resolvedAt-this.createdAt>MAX_RESOLVE_DELAY?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:o,...c,keyframes:a},nt=!j&&supportsBrowserAnimation(tt)?new NativeAnimationExtended({...tt,element:tt.motionValue.owner.current}):new JSAnimation(tt);nt.finished.then(()=>this.notifyFinished()).catch(noop),this.pendingTimeline&&(this.stopTimeline=nt.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=nt}get finished(){return this._animation?this.animation.finished:this._finished}then(a,o){return this.finished.finally(a).then(()=>{})}get animation(){var a;return this._animation||((a=this.keyframeResolver)==null||a.resume(),flushKeyframeResolvers()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(a){this.animation.time=a}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(a){this.animation.speed=a}get startTime(){return this.animation.startTime}attachTimeline(a){return this._animation?this.stopTimeline=this.animation.attachTimeline(a):this.pendingTimeline=a,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var a;this._animation&&this.animation.cancel(),(a=this.keyframeResolver)==null||a.cancel()}}const splitCSSVariableRegex=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function parseCSSVariable(e){const a=splitCSSVariableRegex.exec(e);if(!a)return[,];const[,o,c,d]=a;return[`--${o??c}`,d]}function getVariableValue(e,a,o=1){const[c,d]=parseCSSVariable(e);if(!c)return;const $=window.getComputedStyle(a).getPropertyValue(c);if($){const g=$.trim();return isNumericalString(g)?parseFloat(g):g}return isCSSVariableToken(d)?getVariableValue(d,a,o+1):d}function getValueTransition(e,a){return(e==null?void 0:e[a])??(e==null?void 0:e.default)??e}const positionalKeys=new Set(["width","height","top","left","right","bottom",...transformPropOrder]),auto={test:e=>e==="auto",parse:e=>e},testValueType=e=>a=>a.test(e),dimensionValueTypes=[number$1,px,percent,degrees,vw,vh,auto],findDimensionValueType=e=>dimensionValueTypes.find(testValueType(e));function isNone(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||isZeroValueString(e):!0}const maxDefaults=new Set(["brightness","contrast","saturate","opacity"]);function applyDefaultFilter(e){const[a,o]=e.slice(0,-1).split("(");if(a==="drop-shadow")return e;const[c]=o.match(floatRegex)||[];if(!c)return e;const d=o.replace(c,"");let $=maxDefaults.has(a)?1:0;return c!==o&&($*=100),a+"("+$+d+")"}const functionRegex=/\b([a-z-]*)\(.*?\)/gu,filter={...complex,getAnimatableNone:e=>{const a=e.match(functionRegex);return a?a.map(applyDefaultFilter).join(" "):e}},int$1={...number$1,transform:Math.round},transformValueTypes={rotate:degrees,rotateX:degrees,rotateY:degrees,rotateZ:degrees,scale,scaleX:scale,scaleY:scale,scaleZ:scale,skew:degrees,skewX:degrees,skewY:degrees,distance:px,translateX:px,translateY:px,translateZ:px,x:px,y:px,z:px,perspective:px,transformPerspective:px,opacity:alpha,originX:progressPercentage,originY:progressPercentage,originZ:px},numberValueTypes={borderWidth:px,borderTopWidth:px,borderRightWidth:px,borderBottomWidth:px,borderLeftWidth:px,borderRadius:px,radius:px,borderTopLeftRadius:px,borderTopRightRadius:px,borderBottomRightRadius:px,borderBottomLeftRadius:px,width:px,maxWidth:px,height:px,maxHeight:px,top:px,right:px,bottom:px,left:px,padding:px,paddingTop:px,paddingRight:px,paddingBottom:px,paddingLeft:px,margin:px,marginTop:px,marginRight:px,marginBottom:px,marginLeft:px,backgroundPositionX:px,backgroundPositionY:px,...transformValueTypes,zIndex:int$1,fillOpacity:alpha,strokeOpacity:alpha,numOctaves:int$1},defaultValueTypes={...numberValueTypes,color:color$1,backgroundColor:color$1,outlineColor:color$1,fill:color$1,stroke:color$1,borderColor:color$1,borderTopColor:color$1,borderRightColor:color$1,borderBottomColor:color$1,borderLeftColor:color$1,filter,WebkitFilter:filter},getDefaultValueType=e=>defaultValueTypes[e];function getAnimatableNone(e,a){let o=getDefaultValueType(e);return o!==filter&&(o=complex),o.getAnimatableNone?o.getAnimatableNone(a):void 0}const invalidTemplates=new Set(["auto","none","0"]);function makeNoneKeyframesAnimatable(e,a,o){let c=0,d;for(;c<e.length&&!d;){const $=e[c];typeof $=="string"&&!invalidTemplates.has($)&&analyseComplexValue($).values.length&&(d=e[c]),c++}if(d&&o)for(const $ of a)e[$]=getAnimatableNone(o,d)}class DOMKeyframesResolver extends KeyframeResolver{constructor(a,o,c,d,$){super(a,o,c,d,$,!0)}readKeyframes(){const{unresolvedKeyframes:a,element:o,name:c}=this;if(!o||!o.current)return;super.readKeyframes();for(let _=0;_<a.length;_++){let j=a[_];if(typeof j=="string"&&(j=j.trim(),isCSSVariableToken(j))){const _e=getVariableValue(j,o.current);_e!==void 0&&(a[_]=_e),_===a.length-1&&(this.finalKeyframe=j)}}if(this.resolveNoneKeyframes(),!positionalKeys.has(c)||a.length!==2)return;const[d,$]=a,g=findDimensionValueType(d),b=findDimensionValueType($);if(g!==b)if(isNumOrPxType(g)&&isNumOrPxType(b))for(let _=0;_<a.length;_++){const j=a[_];typeof j=="string"&&(a[_]=parseFloat(j))}else positionalValues[c]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:a,name:o}=this,c=[];for(let d=0;d<a.length;d++)(a[d]===null||isNone(a[d]))&&c.push(d);c.length&&makeNoneKeyframesAnimatable(a,c,o)}measureInitialState(){const{element:a,unresolvedKeyframes:o,name:c}=this;if(!a||!a.current)return;c==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=positionalValues[c](a.measureViewportBox(),window.getComputedStyle(a.current)),o[0]=this.measuredOrigin;const d=o[o.length-1];d!==void 0&&a.getValue(c,d).jump(d,!1)}measureEndState(){var b;const{element:a,name:o,unresolvedKeyframes:c}=this;if(!a||!a.current)return;const d=a.getValue(o);d&&d.jump(this.measuredOrigin,!1);const $=c.length-1,g=c[$];c[$]=positionalValues[o](a.measureViewportBox(),window.getComputedStyle(a.current)),g!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=g),(b=this.removedTransforms)!=null&&b.length&&this.removedTransforms.forEach(([_,j])=>{a.getValue(_).set(j)}),this.resolveNoneKeyframes()}}function resolveElements(e,a,o){if(e instanceof EventTarget)return[e];if(typeof e=="string"){const d=document.querySelectorAll(e);return d?Array.from(d):[]}return Array.from(e)}const getValueAsType=(e,a)=>a&&typeof e=="number"?a.transform(e):e;function isHTMLElement(e){return isObject$2(e)&&"offsetHeight"in e}const MAX_VELOCITY_DELTA=30,isFloat$1=e=>!isNaN(parseFloat(e));class MotionValue{constructor(a,o={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=c=>{var $;const d=time.now();if(this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(c),this.current!==this.prev&&(($=this.events.change)==null||$.notify(this.current),this.dependents))for(const g of this.dependents)g.dirty()},this.hasAnimated=!1,this.setCurrent(a),this.owner=o.owner}setCurrent(a){this.current=a,this.updatedAt=time.now(),this.canTrackVelocity===null&&a!==void 0&&(this.canTrackVelocity=isFloat$1(this.current))}setPrevFrameValue(a=this.current){this.prevFrameValue=a,this.prevUpdatedAt=this.updatedAt}onChange(a){return this.on("change",a)}on(a,o){this.events[a]||(this.events[a]=new SubscriptionManager);const c=this.events[a].add(o);return a==="change"?()=>{c(),frame.read(()=>{this.events.change.getSize()||this.stop()})}:c}clearListeners(){for(const a in this.events)this.events[a].clear()}attach(a,o){this.passiveEffect=a,this.stopPassiveEffect=o}set(a){this.passiveEffect?this.passiveEffect(a,this.updateAndNotify):this.updateAndNotify(a)}setWithVelocity(a,o,c){this.set(o),this.prev=void 0,this.prevFrameValue=a,this.prevUpdatedAt=this.updatedAt-c}jump(a,o=!0){this.updateAndNotify(a),this.prev=a,this.prevUpdatedAt=this.prevFrameValue=void 0,o&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var a;(a=this.events.change)==null||a.notify(this.current)}addDependent(a){this.dependents||(this.dependents=new Set),this.dependents.add(a)}removeDependent(a){this.dependents&&this.dependents.delete(a)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const a=time.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||a-this.updatedAt>MAX_VELOCITY_DELTA)return 0;const o=Math.min(this.updatedAt-this.prevUpdatedAt,MAX_VELOCITY_DELTA);return velocityPerSecond(parseFloat(this.current)-parseFloat(this.prevFrameValue),o)}start(a){return this.stop(),new Promise(o=>{this.hasAnimated=!0,this.animation=a(o),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var a,o;(a=this.dependents)==null||a.clear(),(o=this.events.destroy)==null||o.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function motionValue(e,a){return new MotionValue(e,a)}const{schedule:microtask,cancel:cancelMicrotask}=createRenderBatcher(queueMicrotask,!1),isDragging={x:!1,y:!1};function isDragActive(){return isDragging.x||isDragging.y}function setDragLock(e){return e==="x"||e==="y"?isDragging[e]?null:(isDragging[e]=!0,()=>{isDragging[e]=!1}):isDragging.x||isDragging.y?null:(isDragging.x=isDragging.y=!0,()=>{isDragging.x=isDragging.y=!1})}function setupGesture(e,a){const o=resolveElements(e),c=new AbortController,d={passive:!0,...a,signal:c.signal};return[o,d,()=>c.abort()]}function isValidHover(e){return!(e.pointerType==="touch"||isDragActive())}function hover(e,a,o={}){const[c,d,$]=setupGesture(e,o),g=b=>{if(!isValidHover(b))return;const{target:_}=b,j=a(_,b);if(typeof j!="function"||!_)return;const _e=et=>{isValidHover(et)&&(j(et),_.removeEventListener("pointerleave",_e))};_.addEventListener("pointerleave",_e,d)};return c.forEach(b=>{b.addEventListener("pointerenter",g,d)}),$}const isNodeOrChild=(e,a)=>a?e===a?!0:isNodeOrChild(e,a.parentElement):!1,isPrimaryPointer=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,focusableElements=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function isElementKeyboardAccessible(e){return focusableElements.has(e.tagName)||e.tabIndex!==-1}const isPressing=new WeakSet;function filterEvents(e){return a=>{a.key==="Enter"&&e(a)}}function firePointerEvent(e,a){e.dispatchEvent(new PointerEvent("pointer"+a,{isPrimary:!0,bubbles:!0}))}const enableKeyboardPress=(e,a)=>{const o=e.currentTarget;if(!o)return;const c=filterEvents(()=>{if(isPressing.has(o))return;firePointerEvent(o,"down");const d=filterEvents(()=>{firePointerEvent(o,"up")}),$=()=>firePointerEvent(o,"cancel");o.addEventListener("keyup",d,a),o.addEventListener("blur",$,a)});o.addEventListener("keydown",c,a),o.addEventListener("blur",()=>o.removeEventListener("keydown",c),a)};function isValidPressEvent(e){return isPrimaryPointer(e)&&!isDragActive()}function press(e,a,o={}){const[c,d,$]=setupGesture(e,o),g=b=>{const _=b.currentTarget;if(!isValidPressEvent(b))return;isPressing.add(_);const j=a(_,b),_e=(nt,at)=>{window.removeEventListener("pointerup",et),window.removeEventListener("pointercancel",tt),isPressing.has(_)&&isPressing.delete(_),isValidPressEvent(nt)&&typeof j=="function"&&j(nt,{success:at})},et=nt=>{_e(nt,_===window||_===document||o.useGlobalTarget||isNodeOrChild(_,nt.target))},tt=nt=>{_e(nt,!1)};window.addEventListener("pointerup",et,d),window.addEventListener("pointercancel",tt,d)};return c.forEach(b=>{(o.useGlobalTarget?window:b).addEventListener("pointerdown",g,d),isHTMLElement(b)&&(b.addEventListener("focus",j=>enableKeyboardPress(j,d)),!isElementKeyboardAccessible(b)&&!b.hasAttribute("tabindex")&&(b.tabIndex=0))}),$}function isSVGElement(e){return isObject$2(e)&&"ownerSVGElement"in e}function isSVGSVGElement(e){return isSVGElement(e)&&e.tagName==="svg"}const isMotionValue=e=>!!(e&&e.getVelocity),valueTypes=[...dimensionValueTypes,color$1,complex],findValueType=e=>valueTypes.find(testValueType(e)),MotionConfigContext=reactExports.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class PopChildMeasure extends reactExports.Component{getSnapshotBeforeUpdate(a){const o=this.props.childRef.current;if(o&&a.isPresent&&!this.props.isPresent){const c=o.offsetParent,d=isHTMLElement(c)&&c.offsetWidth||0,$=this.props.sizeRef.current;$.height=o.offsetHeight||0,$.width=o.offsetWidth||0,$.top=o.offsetTop,$.left=o.offsetLeft,$.right=d-$.width-$.left}return null}componentDidUpdate(){}render(){return this.props.children}}function PopChild({children:e,isPresent:a,anchorX:o,root:c}){const d=reactExports.useId(),$=reactExports.useRef(null),g=reactExports.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:b}=reactExports.useContext(MotionConfigContext);return reactExports.useInsertionEffect(()=>{const{width:_,height:j,top:_e,left:et,right:tt}=g.current;if(a||!$.current||!_||!j)return;const nt=o==="left"?`left: ${et}`:`right: ${tt}`;$.current.dataset.motionPopId=d;const at=document.createElement("style");b&&(at.nonce=b);const lt=c??document.head;return lt.appendChild(at),at.sheet&&at.sheet.insertRule(`
          [data-motion-pop-id="${d}"] {
            position: absolute !important;
            width: ${_}px !important;
            height: ${j}px !important;
            ${nt}px !important;
            top: ${_e}px !important;
          }
        `),()=>{lt.contains(at)&&lt.removeChild(at)}},[a]),jsxRuntimeExports.jsx(PopChildMeasure,{isPresent:a,childRef:$,sizeRef:g,children:reactExports.cloneElement(e,{ref:$})})}const PresenceChild=({children:e,initial:a,isPresent:o,onExitComplete:c,custom:d,presenceAffectsLayout:$,mode:g,anchorX:b,root:_})=>{const j=useConstant(newChildrenMap),_e=reactExports.useId();let et=!0,tt=reactExports.useMemo(()=>(et=!1,{id:_e,initial:a,isPresent:o,custom:d,onExitComplete:nt=>{j.set(nt,!0);for(const at of j.values())if(!at)return;c&&c()},register:nt=>(j.set(nt,!1),()=>j.delete(nt))}),[o,j,c]);return $&&et&&(tt={...tt}),reactExports.useMemo(()=>{j.forEach((nt,at)=>j.set(at,!1))},[o]),reactExports.useEffect(()=>{!o&&!j.size&&c&&c()},[o]),g==="popLayout"&&(e=jsxRuntimeExports.jsx(PopChild,{isPresent:o,anchorX:b,root:_,children:e})),jsxRuntimeExports.jsx(PresenceContext.Provider,{value:tt,children:e})};function newChildrenMap(){return new Map}function usePresence(e=!0){const a=reactExports.useContext(PresenceContext);if(a===null)return[!0,null];const{isPresent:o,onExitComplete:c,register:d}=a,$=reactExports.useId();reactExports.useEffect(()=>{if(e)return d($)},[e]);const g=reactExports.useCallback(()=>e&&c&&c($),[$,c,e]);return!o&&c?[!1,g]:[!0]}const getChildKey=e=>e.key||"";function onlyElements(e){const a=[];return reactExports.Children.forEach(e,o=>{reactExports.isValidElement(o)&&a.push(o)}),a}const AnimatePresence=({children:e,custom:a,initial:o=!0,onExitComplete:c,presenceAffectsLayout:d=!0,mode:$="sync",propagate:g=!1,anchorX:b="left",root:_})=>{const[j,_e]=usePresence(g),et=reactExports.useMemo(()=>onlyElements(e),[e]),tt=g&&!j?[]:et.map(getChildKey),nt=reactExports.useRef(!0),at=reactExports.useRef(et),lt=useConstant(()=>new Map),[mt,ot]=reactExports.useState(et),[st,ut]=reactExports.useState(et);useIsomorphicLayoutEffect(()=>{nt.current=!1,at.current=et;for(let ft=0;ft<st.length;ft++){const yt=getChildKey(st[ft]);tt.includes(yt)?lt.delete(yt):lt.get(yt)!==!0&&lt.set(yt,!1)}},[st,tt.length,tt.join("-")]);const pt=[];if(et!==mt){let ft=[...et];for(let yt=0;yt<st.length;yt++){const _t=st[yt],vt=getChildKey(_t);tt.includes(vt)||(ft.splice(yt,0,_t),pt.push(_t))}return $==="wait"&&pt.length&&(ft=pt),ut(onlyElements(ft)),ot(et),null}const{forceRender:gt}=reactExports.useContext(LayoutGroupContext);return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:st.map(ft=>{const yt=getChildKey(ft),_t=g&&!j?!1:et===st||tt.includes(yt),vt=()=>{if(lt.has(yt))lt.set(yt,!0);else return;let Pt=!0;lt.forEach(Tt=>{Tt||(Pt=!1)}),Pt&&(gt==null||gt(),ut(at.current),g&&(_e==null||_e()),c&&c())};return jsxRuntimeExports.jsx(PresenceChild,{isPresent:_t,initial:!nt.current||o?void 0:!1,custom:a,presenceAffectsLayout:d,mode:$,root:_,onExitComplete:_t?void 0:vt,anchorX:b,children:ft},yt)})})},LazyContext=reactExports.createContext({strict:!1}),featureProps={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},featureDefinitions={};for(const e in featureProps)featureDefinitions[e]={isEnabled:a=>featureProps[e].some(o=>!!a[o])};function loadFeatures(e){for(const a in e)featureDefinitions[a]={...featureDefinitions[a],...e[a]}}const validMotionProps=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function isValidMotionProp(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||validMotionProps.has(e)}let shouldForward=e=>!isValidMotionProp(e);function loadExternalIsValidProp(e){typeof e=="function"&&(shouldForward=a=>a.startsWith("on")?!isValidMotionProp(a):e(a))}try{loadExternalIsValidProp(require("@emotion/is-prop-valid").default)}catch{}function filterProps(e,a,o){const c={};for(const d in e)d==="values"&&typeof e.values=="object"||(shouldForward(d)||o===!0&&isValidMotionProp(d)||!a&&!isValidMotionProp(d)||e.draggable&&d.startsWith("onDrag"))&&(c[d]=e[d]);return c}const MotionContext=reactExports.createContext({});function isAnimationControls(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function isVariantLabel(e){return typeof e=="string"||Array.isArray(e)}const variantPriorityOrder=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],variantProps=["initial",...variantPriorityOrder];function isControllingVariants(e){return isAnimationControls(e.animate)||variantProps.some(a=>isVariantLabel(e[a]))}function isVariantNode(e){return!!(isControllingVariants(e)||e.variants)}function getCurrentTreeVariants(e,a){if(isControllingVariants(e)){const{initial:o,animate:c}=e;return{initial:o===!1||isVariantLabel(o)?o:void 0,animate:isVariantLabel(c)?c:void 0}}return e.inherit!==!1?a:{}}function useCreateMotionContext(e){const{initial:a,animate:o}=getCurrentTreeVariants(e,reactExports.useContext(MotionContext));return reactExports.useMemo(()=>({initial:a,animate:o}),[variantLabelsAsDependency(a),variantLabelsAsDependency(o)])}function variantLabelsAsDependency(e){return Array.isArray(e)?e.join(" "):e}const scaleCorrectors={};function addScaleCorrector(e){for(const a in e)scaleCorrectors[a]=e[a],isCSSVariableName(a)&&(scaleCorrectors[a].isCSSVariable=!0)}function isForcedMotionValue(e,{layout:a,layoutId:o}){return transformProps.has(e)||e.startsWith("origin")||(a||o!==void 0)&&(!!scaleCorrectors[e]||e==="opacity")}const translateAlias={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},numTransforms=transformPropOrder.length;function buildTransform(e,a,o){let c="",d=!0;for(let $=0;$<numTransforms;$++){const g=transformPropOrder[$],b=e[g];if(b===void 0)continue;let _=!0;if(typeof b=="number"?_=b===(g.startsWith("scale")?1:0):_=parseFloat(b)===0,!_||o){const j=getValueAsType(b,numberValueTypes[g]);if(!_){d=!1;const _e=translateAlias[g]||g;c+=`${_e}(${j}) `}o&&(a[g]=j)}}return c=c.trim(),o?c=o(a,d?"":c):d&&(c="none"),c}function buildHTMLStyles(e,a,o){const{style:c,vars:d,transformOrigin:$}=e;let g=!1,b=!1;for(const _ in a){const j=a[_];if(transformProps.has(_)){g=!0;continue}else if(isCSSVariableName(_)){d[_]=j;continue}else{const _e=getValueAsType(j,numberValueTypes[_]);_.startsWith("origin")?(b=!0,$[_]=_e):c[_]=_e}}if(a.transform||(g||o?c.transform=buildTransform(a,e.transform,o):c.transform&&(c.transform="none")),b){const{originX:_="50%",originY:j="50%",originZ:_e=0}=$;c.transformOrigin=`${_} ${j} ${_e}`}}const createHtmlRenderState=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function copyRawValuesOnly(e,a,o){for(const c in a)!isMotionValue(a[c])&&!isForcedMotionValue(c,o)&&(e[c]=a[c])}function useInitialMotionValues({transformTemplate:e},a){return reactExports.useMemo(()=>{const o=createHtmlRenderState();return buildHTMLStyles(o,a,e),Object.assign({},o.vars,o.style)},[a])}function useStyle(e,a){const o=e.style||{},c={};return copyRawValuesOnly(c,o,e),Object.assign(c,useInitialMotionValues(e,a)),c}function useHTMLProps(e,a){const o={},c=useStyle(e,a);return e.drag&&e.dragListener!==!1&&(o.draggable=!1,c.userSelect=c.WebkitUserSelect=c.WebkitTouchCallout="none",c.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(o.tabIndex=0),o.style=c,o}const dashKeys={offset:"stroke-dashoffset",array:"stroke-dasharray"},camelKeys={offset:"strokeDashoffset",array:"strokeDasharray"};function buildSVGPath(e,a,o=1,c=0,d=!0){e.pathLength=1;const $=d?dashKeys:camelKeys;e[$.offset]=px.transform(-c);const g=px.transform(a),b=px.transform(o);e[$.array]=`${g} ${b}`}function buildSVGAttrs(e,{attrX:a,attrY:o,attrScale:c,pathLength:d,pathSpacing:$=1,pathOffset:g=0,...b},_,j,_e){if(buildHTMLStyles(e,b,j),_){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:et,style:tt}=e;et.transform&&(tt.transform=et.transform,delete et.transform),(tt.transform||et.transformOrigin)&&(tt.transformOrigin=et.transformOrigin??"50% 50%",delete et.transformOrigin),tt.transform&&(tt.transformBox=(_e==null?void 0:_e.transformBox)??"fill-box",delete et.transformBox),a!==void 0&&(et.x=a),o!==void 0&&(et.y=o),c!==void 0&&(et.scale=c),d!==void 0&&buildSVGPath(et,d,$,g,!1)}const createSvgRenderState=()=>({...createHtmlRenderState(),attrs:{}}),isSVGTag=e=>typeof e=="string"&&e.toLowerCase()==="svg";function useSVGProps(e,a,o,c){const d=reactExports.useMemo(()=>{const $=createSvgRenderState();return buildSVGAttrs($,a,isSVGTag(c),e.transformTemplate,e.style),{...$.attrs,style:{...$.style}}},[a]);if(e.style){const $={};copyRawValuesOnly($,e.style,e),d.style={...$,...d.style}}return d}const lowercaseSVGElements=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function isSVGComponent(e){return typeof e!="string"||e.includes("-")?!1:!!(lowercaseSVGElements.indexOf(e)>-1||/[A-Z]/u.test(e))}function useRender(e,a,o,{latestValues:c},d,$=!1){const b=(isSVGComponent(e)?useSVGProps:useHTMLProps)(a,c,d,e),_=filterProps(a,typeof e=="string",$),j=e!==reactExports.Fragment?{..._,...b,ref:o}:{},{children:_e}=a,et=reactExports.useMemo(()=>isMotionValue(_e)?_e.get():_e,[_e]);return reactExports.createElement(e,{...j,children:et})}function getValueState(e){const a=[{},{}];return e==null||e.values.forEach((o,c)=>{a[0][c]=o.get(),a[1][c]=o.getVelocity()}),a}function resolveVariantFromProps(e,a,o,c){if(typeof a=="function"){const[d,$]=getValueState(c);a=a(o!==void 0?o:e.custom,d,$)}if(typeof a=="string"&&(a=e.variants&&e.variants[a]),typeof a=="function"){const[d,$]=getValueState(c);a=a(o!==void 0?o:e.custom,d,$)}return a}function resolveMotionValue(e){return isMotionValue(e)?e.get():e}function makeState({scrapeMotionValuesFromProps:e,createRenderState:a},o,c,d){return{latestValues:makeLatestValues(o,c,d,e),renderState:a()}}function makeLatestValues(e,a,o,c){const d={},$=c(e,{});for(const tt in $)d[tt]=resolveMotionValue($[tt]);let{initial:g,animate:b}=e;const _=isControllingVariants(e),j=isVariantNode(e);a&&j&&!_&&e.inherit!==!1&&(g===void 0&&(g=a.initial),b===void 0&&(b=a.animate));let _e=o?o.initial===!1:!1;_e=_e||g===!1;const et=_e?b:g;if(et&&typeof et!="boolean"&&!isAnimationControls(et)){const tt=Array.isArray(et)?et:[et];for(let nt=0;nt<tt.length;nt++){const at=resolveVariantFromProps(e,tt[nt]);if(at){const{transitionEnd:lt,transition:mt,...ot}=at;for(const st in ot){let ut=ot[st];if(Array.isArray(ut)){const pt=_e?ut.length-1:0;ut=ut[pt]}ut!==null&&(d[st]=ut)}for(const st in lt)d[st]=lt[st]}}}return d}const makeUseVisualState=e=>(a,o)=>{const c=reactExports.useContext(MotionContext),d=reactExports.useContext(PresenceContext),$=()=>makeState(e,a,c,d);return o?$():useConstant($)};function scrapeMotionValuesFromProps$1(e,a,o){var $;const{style:c}=e,d={};for(const g in c)(isMotionValue(c[g])||a.style&&isMotionValue(a.style[g])||isForcedMotionValue(g,e)||(($=o==null?void 0:o.getValue(g))==null?void 0:$.liveStyle)!==void 0)&&(d[g]=c[g]);return d}const useHTMLVisualState=makeUseVisualState({scrapeMotionValuesFromProps:scrapeMotionValuesFromProps$1,createRenderState:createHtmlRenderState});function scrapeMotionValuesFromProps(e,a,o){const c=scrapeMotionValuesFromProps$1(e,a,o);for(const d in e)if(isMotionValue(e[d])||isMotionValue(a[d])){const $=transformPropOrder.indexOf(d)!==-1?"attr"+d.charAt(0).toUpperCase()+d.substring(1):d;c[$]=e[d]}return c}const useSVGVisualState=makeUseVisualState({scrapeMotionValuesFromProps,createRenderState:createSvgRenderState}),motionComponentSymbol=Symbol.for("motionComponentSymbol");function isRefObject(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function useMotionRef(e,a,o){return reactExports.useCallback(c=>{c&&e.onMount&&e.onMount(c),a&&(c?a.mount(c):a.unmount()),o&&(typeof o=="function"?o(c):isRefObject(o)&&(o.current=c))},[a])}const camelToDash=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),optimizedAppearDataId="framerAppearId",optimizedAppearDataAttribute="data-"+camelToDash(optimizedAppearDataId),SwitchLayoutGroupContext=reactExports.createContext({});function useVisualElement(e,a,o,c,d){var lt,mt;const{visualElement:$}=reactExports.useContext(MotionContext),g=reactExports.useContext(LazyContext),b=reactExports.useContext(PresenceContext),_=reactExports.useContext(MotionConfigContext).reducedMotion,j=reactExports.useRef(null);c=c||g.renderer,!j.current&&c&&(j.current=c(e,{visualState:a,parent:$,props:o,presenceContext:b,blockInitialAnimation:b?b.initial===!1:!1,reducedMotionConfig:_}));const _e=j.current,et=reactExports.useContext(SwitchLayoutGroupContext);_e&&!_e.projection&&d&&(_e.type==="html"||_e.type==="svg")&&createProjectionNode$1(j.current,o,d,et);const tt=reactExports.useRef(!1);reactExports.useInsertionEffect(()=>{_e&&tt.current&&_e.update(o,b)});const nt=o[optimizedAppearDataAttribute],at=reactExports.useRef(!!nt&&!((lt=window.MotionHandoffIsComplete)!=null&&lt.call(window,nt))&&((mt=window.MotionHasOptimisedAnimation)==null?void 0:mt.call(window,nt)));return useIsomorphicLayoutEffect(()=>{_e&&(tt.current=!0,window.MotionIsMounted=!0,_e.updateFeatures(),_e.scheduleRenderMicrotask(),at.current&&_e.animationState&&_e.animationState.animateChanges())}),reactExports.useEffect(()=>{_e&&(!at.current&&_e.animationState&&_e.animationState.animateChanges(),at.current&&(queueMicrotask(()=>{var ot;(ot=window.MotionHandoffMarkAsComplete)==null||ot.call(window,nt)}),at.current=!1),_e.enteringChildren=void 0)}),_e}function createProjectionNode$1(e,a,o,c){const{layoutId:d,layout:$,drag:g,dragConstraints:b,layoutScroll:_,layoutRoot:j,layoutCrossfade:_e}=a;e.projection=new o(e.latestValues,a["data-framer-portal-id"]?void 0:getClosestProjectingNode(e.parent)),e.projection.setOptions({layoutId:d,layout:$,alwaysMeasureLayout:!!g||b&&isRefObject(b),visualElement:e,animationType:typeof $=="string"?$:"both",initialPromotionConfig:c,crossfade:_e,layoutScroll:_,layoutRoot:j})}function getClosestProjectingNode(e){if(e)return e.options.allowProjection!==!1?e.projection:getClosestProjectingNode(e.parent)}function createMotionComponent(e,{forwardMotionProps:a=!1}={},o,c){o&&loadFeatures(o);const d=isSVGComponent(e)?useSVGVisualState:useHTMLVisualState;function $(b,_){let j;const _e={...reactExports.useContext(MotionConfigContext),...b,layoutId:useLayoutId(b)},{isStatic:et}=_e,tt=useCreateMotionContext(b),nt=d(b,et);if(!et&&isBrowser){useStrictMode();const at=getProjectionFunctionality(_e);j=at.MeasureLayout,tt.visualElement=useVisualElement(e,nt,_e,c,at.ProjectionNode)}return jsxRuntimeExports.jsxs(MotionContext.Provider,{value:tt,children:[j&&tt.visualElement?jsxRuntimeExports.jsx(j,{visualElement:tt.visualElement,..._e}):null,useRender(e,b,useMotionRef(nt,tt.visualElement,_),nt,et,a)]})}$.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const g=reactExports.forwardRef($);return g[motionComponentSymbol]=e,g}function useLayoutId({layoutId:e}){const a=reactExports.useContext(LayoutGroupContext).id;return a&&e!==void 0?a+"-"+e:e}function useStrictMode(e,a){reactExports.useContext(LazyContext).strict}function getProjectionFunctionality(e){const{drag:a,layout:o}=featureDefinitions;if(!a&&!o)return{};const c={...a,...o};return{MeasureLayout:a!=null&&a.isEnabled(e)||o!=null&&o.isEnabled(e)?c.MeasureLayout:void 0,ProjectionNode:c.ProjectionNode}}function createMotionProxy(e,a){if(typeof Proxy>"u")return createMotionComponent;const o=new Map,c=($,g)=>createMotionComponent($,g,e,a),d=($,g)=>c($,g);return new Proxy(d,{get:($,g)=>g==="create"?c:(o.has(g)||o.set(g,createMotionComponent(g,void 0,e,a)),o.get(g))})}function convertBoundingBoxToBox({top:e,left:a,right:o,bottom:c}){return{x:{min:a,max:o},y:{min:e,max:c}}}function convertBoxToBoundingBox({x:e,y:a}){return{top:a.min,right:e.max,bottom:a.max,left:e.min}}function transformBoxPoints(e,a){if(!a)return e;const o=a({x:e.left,y:e.top}),c=a({x:e.right,y:e.bottom});return{top:o.y,left:o.x,bottom:c.y,right:c.x}}function isIdentityScale(e){return e===void 0||e===1}function hasScale({scale:e,scaleX:a,scaleY:o}){return!isIdentityScale(e)||!isIdentityScale(a)||!isIdentityScale(o)}function hasTransform(e){return hasScale(e)||has2DTranslate(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function has2DTranslate(e){return is2DTranslate(e.x)||is2DTranslate(e.y)}function is2DTranslate(e){return e&&e!=="0%"}function scalePoint(e,a,o){const c=e-o,d=a*c;return o+d}function applyPointDelta(e,a,o,c,d){return d!==void 0&&(e=scalePoint(e,d,c)),scalePoint(e,o,c)+a}function applyAxisDelta(e,a=0,o=1,c,d){e.min=applyPointDelta(e.min,a,o,c,d),e.max=applyPointDelta(e.max,a,o,c,d)}function applyBoxDelta(e,{x:a,y:o}){applyAxisDelta(e.x,a.translate,a.scale,a.originPoint),applyAxisDelta(e.y,o.translate,o.scale,o.originPoint)}const TREE_SCALE_SNAP_MIN=.999999999999,TREE_SCALE_SNAP_MAX=1.0000000000001;function applyTreeDeltas(e,a,o,c=!1){const d=o.length;if(!d)return;a.x=a.y=1;let $,g;for(let b=0;b<d;b++){$=o[b],g=$.projectionDelta;const{visualElement:_}=$.options;_&&_.props.style&&_.props.style.display==="contents"||(c&&$.options.layoutScroll&&$.scroll&&$!==$.root&&transformBox(e,{x:-$.scroll.offset.x,y:-$.scroll.offset.y}),g&&(a.x*=g.x.scale,a.y*=g.y.scale,applyBoxDelta(e,g)),c&&hasTransform($.latestValues)&&transformBox(e,$.latestValues))}a.x<TREE_SCALE_SNAP_MAX&&a.x>TREE_SCALE_SNAP_MIN&&(a.x=1),a.y<TREE_SCALE_SNAP_MAX&&a.y>TREE_SCALE_SNAP_MIN&&(a.y=1)}function translateAxis(e,a){e.min=e.min+a,e.max=e.max+a}function transformAxis(e,a,o,c,d=.5){const $=mixNumber$1(e.min,e.max,d);applyAxisDelta(e,a,o,$,c)}function transformBox(e,a){transformAxis(e.x,a.x,a.scaleX,a.scale,a.originX),transformAxis(e.y,a.y,a.scaleY,a.scale,a.originY)}function measureViewportBox(e,a){return convertBoundingBoxToBox(transformBoxPoints(e.getBoundingClientRect(),a))}function measurePageBox(e,a,o){const c=measureViewportBox(e,o),{scroll:d}=a;return d&&(translateAxis(c.x,d.offset.x),translateAxis(c.y,d.offset.y)),c}const createAxisDelta=()=>({translate:0,scale:1,origin:0,originPoint:0}),createDelta=()=>({x:createAxisDelta(),y:createAxisDelta()}),createAxis=()=>({min:0,max:0}),createBox=()=>({x:createAxis(),y:createAxis()}),prefersReducedMotion={current:null},hasReducedMotionListener={current:!1};function initPrefersReducedMotion(){if(hasReducedMotionListener.current=!0,!!isBrowser)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),a=()=>prefersReducedMotion.current=e.matches;e.addEventListener("change",a),a()}else prefersReducedMotion.current=!1}const visualElementStore=new WeakMap;function updateMotionValuesFromProps(e,a,o){for(const c in a){const d=a[c],$=o[c];if(isMotionValue(d))e.addValue(c,d);else if(isMotionValue($))e.addValue(c,motionValue(d,{owner:e}));else if($!==d)if(e.hasValue(c)){const g=e.getValue(c);g.liveStyle===!0?g.jump(d):g.hasAnimated||g.set(d)}else{const g=e.getStaticValue(c);e.addValue(c,motionValue(g!==void 0?g:d,{owner:e}))}}for(const c in o)a[c]===void 0&&e.removeValue(c);return a}const propEventHandlers=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class VisualElement{scrapeMotionValuesFromProps(a,o,c){return{}}constructor({parent:a,props:o,presenceContext:c,reducedMotionConfig:d,blockInitialAnimation:$,visualState:g},b={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=KeyframeResolver,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const tt=time.now();this.renderScheduledAt<tt&&(this.renderScheduledAt=tt,frame.render(this.render,!1,!0))};const{latestValues:_,renderState:j}=g;this.latestValues=_,this.baseTarget={..._},this.initialValues=o.initial?{..._}:{},this.renderState=j,this.parent=a,this.props=o,this.presenceContext=c,this.depth=a?a.depth+1:0,this.reducedMotionConfig=d,this.options=b,this.blockInitialAnimation=!!$,this.isControllingVariants=isControllingVariants(o),this.isVariantNode=isVariantNode(o),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(a&&a.current);const{willChange:_e,...et}=this.scrapeMotionValuesFromProps(o,{},this);for(const tt in et){const nt=et[tt];_[tt]!==void 0&&isMotionValue(nt)&&nt.set(_[tt])}}mount(a){var o;this.current=a,visualElementStore.set(a,this),this.projection&&!this.projection.instance&&this.projection.mount(a),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((c,d)=>this.bindToMotionValue(d,c)),hasReducedMotionListener.current||initPrefersReducedMotion(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:prefersReducedMotion.current,(o=this.parent)==null||o.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var a;this.projection&&this.projection.unmount(),cancelFrame(this.notifyUpdate),cancelFrame(this.render),this.valueSubscriptions.forEach(o=>o()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(a=this.parent)==null||a.removeChild(this);for(const o in this.events)this.events[o].clear();for(const o in this.features){const c=this.features[o];c&&(c.unmount(),c.isMounted=!1)}this.current=null}addChild(a){this.children.add(a),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(a)}removeChild(a){this.children.delete(a),this.enteringChildren&&this.enteringChildren.delete(a)}bindToMotionValue(a,o){this.valueSubscriptions.has(a)&&this.valueSubscriptions.get(a)();const c=transformProps.has(a);c&&this.onBindTransform&&this.onBindTransform();const d=o.on("change",g=>{this.latestValues[a]=g,this.props.onUpdate&&frame.preRender(this.notifyUpdate),c&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let $;window.MotionCheckAppearSync&&($=window.MotionCheckAppearSync(this,a,o)),this.valueSubscriptions.set(a,()=>{d(),$&&$(),o.owner&&o.stop()})}sortNodePosition(a){return!this.current||!this.sortInstanceNodePosition||this.type!==a.type?0:this.sortInstanceNodePosition(this.current,a.current)}updateFeatures(){let a="animation";for(a in featureDefinitions){const o=featureDefinitions[a];if(!o)continue;const{isEnabled:c,Feature:d}=o;if(!this.features[a]&&d&&c(this.props)&&(this.features[a]=new d(this)),this.features[a]){const $=this.features[a];$.isMounted?$.update():($.mount(),$.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):createBox()}getStaticValue(a){return this.latestValues[a]}setStaticValue(a,o){this.latestValues[a]=o}update(a,o){(a.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=a,this.prevPresenceContext=this.presenceContext,this.presenceContext=o;for(let c=0;c<propEventHandlers.length;c++){const d=propEventHandlers[c];this.propEventSubscriptions[d]&&(this.propEventSubscriptions[d](),delete this.propEventSubscriptions[d]);const $="on"+d,g=a[$];g&&(this.propEventSubscriptions[d]=this.on(d,g))}this.prevMotionValues=updateMotionValuesFromProps(this,this.scrapeMotionValuesFromProps(a,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(a){return this.props.variants?this.props.variants[a]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(a){const o=this.getClosestVariantNode();if(o)return o.variantChildren&&o.variantChildren.add(a),()=>o.variantChildren.delete(a)}addValue(a,o){const c=this.values.get(a);o!==c&&(c&&this.removeValue(a),this.bindToMotionValue(a,o),this.values.set(a,o),this.latestValues[a]=o.get())}removeValue(a){this.values.delete(a);const o=this.valueSubscriptions.get(a);o&&(o(),this.valueSubscriptions.delete(a)),delete this.latestValues[a],this.removeValueFromRenderState(a,this.renderState)}hasValue(a){return this.values.has(a)}getValue(a,o){if(this.props.values&&this.props.values[a])return this.props.values[a];let c=this.values.get(a);return c===void 0&&o!==void 0&&(c=motionValue(o===null?void 0:o,{owner:this}),this.addValue(a,c)),c}readValue(a,o){let c=this.latestValues[a]!==void 0||!this.current?this.latestValues[a]:this.getBaseTargetFromProps(this.props,a)??this.readValueFromInstance(this.current,a,this.options);return c!=null&&(typeof c=="string"&&(isNumericalString(c)||isZeroValueString(c))?c=parseFloat(c):!findValueType(c)&&complex.test(o)&&(c=getAnimatableNone(a,o)),this.setBaseTarget(a,isMotionValue(c)?c.get():c)),isMotionValue(c)?c.get():c}setBaseTarget(a,o){this.baseTarget[a]=o}getBaseTarget(a){var $;const{initial:o}=this.props;let c;if(typeof o=="string"||typeof o=="object"){const g=resolveVariantFromProps(this.props,o,($=this.presenceContext)==null?void 0:$.custom);g&&(c=g[a])}if(o&&c!==void 0)return c;const d=this.getBaseTargetFromProps(this.props,a);return d!==void 0&&!isMotionValue(d)?d:this.initialValues[a]!==void 0&&c===void 0?void 0:this.baseTarget[a]}on(a,o){return this.events[a]||(this.events[a]=new SubscriptionManager),this.events[a].add(o)}notify(a,...o){this.events[a]&&this.events[a].notify(...o)}scheduleRenderMicrotask(){microtask.render(this.render)}}class DOMVisualElement extends VisualElement{constructor(){super(...arguments),this.KeyframeResolver=DOMKeyframesResolver}sortInstanceNodePosition(a,o){return a.compareDocumentPosition(o)&2?1:-1}getBaseTargetFromProps(a,o){return a.style?a.style[o]:void 0}removeValueFromRenderState(a,{vars:o,style:c}){delete o[a],delete c[a]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:a}=this.props;isMotionValue(a)&&(this.childSubscription=a.on("change",o=>{this.current&&(this.current.textContent=`${o}`)}))}}function renderHTML(e,{style:a,vars:o},c,d){const $=e.style;let g;for(g in a)$[g]=a[g];d==null||d.applyProjectionStyles($,c);for(g in o)$.setProperty(g,o[g])}function getComputedStyle$1(e){return window.getComputedStyle(e)}class HTMLVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="html",this.renderInstance=renderHTML}readValueFromInstance(a,o){var c;if(transformProps.has(o))return(c=this.projection)!=null&&c.isProjecting?defaultTransformValue(o):readTransformValue(a,o);{const d=getComputedStyle$1(a),$=(isCSSVariableName(o)?d.getPropertyValue(o):d[o])||0;return typeof $=="string"?$.trim():$}}measureInstanceViewportBox(a,{transformPagePoint:o}){return measureViewportBox(a,o)}build(a,o,c){buildHTMLStyles(a,o,c.transformTemplate)}scrapeMotionValuesFromProps(a,o,c){return scrapeMotionValuesFromProps$1(a,o,c)}}const camelCaseAttributes=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function renderSVG(e,a,o,c){renderHTML(e,a,void 0,c);for(const d in a.attrs)e.setAttribute(camelCaseAttributes.has(d)?d:camelToDash(d),a.attrs[d])}class SVGVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=createBox}getBaseTargetFromProps(a,o){return a[o]}readValueFromInstance(a,o){if(transformProps.has(o)){const c=getDefaultValueType(o);return c&&c.default||0}return o=camelCaseAttributes.has(o)?o:camelToDash(o),a.getAttribute(o)}scrapeMotionValuesFromProps(a,o,c){return scrapeMotionValuesFromProps(a,o,c)}build(a,o,c){buildSVGAttrs(a,o,this.isSVGTag,c.transformTemplate,c.style)}renderInstance(a,o,c,d){renderSVG(a,o,c,d)}mount(a){this.isSVGTag=isSVGTag(a.tagName),super.mount(a)}}const createDomVisualElement=(e,a)=>isSVGComponent(e)?new SVGVisualElement(a):new HTMLVisualElement(a,{allowProjection:e!==reactExports.Fragment});function resolveVariant(e,a,o){const c=e.getProps();return resolveVariantFromProps(c,a,o!==void 0?o:c.custom,e)}const isKeyframesTarget=e=>Array.isArray(e);function setMotionValue(e,a,o){e.hasValue(a)?e.getValue(a).set(o):e.addValue(a,motionValue(o))}function resolveFinalValueInKeyframes(e){return isKeyframesTarget(e)?e[e.length-1]||0:e}function setTarget(e,a){const o=resolveVariant(e,a);let{transitionEnd:c={},transition:d={},...$}=o||{};$={...$,...c};for(const g in $){const b=resolveFinalValueInKeyframes($[g]);setMotionValue(e,g,b)}}function isWillChangeMotionValue(e){return!!(isMotionValue(e)&&e.add)}function addValueToWillChange(e,a){const o=e.getValue("willChange");if(isWillChangeMotionValue(o))return o.add(a);if(!o&&MotionGlobalConfig.WillChange){const c=new MotionGlobalConfig.WillChange("auto");e.addValue("willChange",c),c.add(a)}}function getOptimisedAppearId(e){return e.props[optimizedAppearDataAttribute]}const isNotNull=e=>e!==null;function getFinalKeyframe(e,{repeat:a,repeatType:o="loop"},c){const d=e.filter(isNotNull),$=a&&o!=="loop"&&a%2===1?0:d.length-1;return!$||c===void 0?d[$]:c}const underDampedSpring={type:"spring",stiffness:500,damping:25,restSpeed:10},criticallyDampedSpring=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),keyframesTransition={type:"keyframes",duration:.8},ease={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},getDefaultTransition=(e,{keyframes:a})=>a.length>2?keyframesTransition:transformProps.has(e)?e.startsWith("scale")?criticallyDampedSpring(a[1]):underDampedSpring:ease;function isTransitionDefined({when:e,delay:a,delayChildren:o,staggerChildren:c,staggerDirection:d,repeat:$,repeatType:g,repeatDelay:b,from:_,elapsed:j,..._e}){return!!Object.keys(_e).length}const animateMotionValue=(e,a,o,c={},d,$)=>g=>{const b=getValueTransition(c,e)||{},_=b.delay||c.delay||0;let{elapsed:j=0}=c;j=j-secondsToMilliseconds(_);const _e={keyframes:Array.isArray(o)?o:[null,o],ease:"easeOut",velocity:a.getVelocity(),...b,delay:-j,onUpdate:tt=>{a.set(tt),b.onUpdate&&b.onUpdate(tt)},onComplete:()=>{g(),b.onComplete&&b.onComplete()},name:e,motionValue:a,element:$?void 0:d};isTransitionDefined(b)||Object.assign(_e,getDefaultTransition(e,_e)),_e.duration&&(_e.duration=secondsToMilliseconds(_e.duration)),_e.repeatDelay&&(_e.repeatDelay=secondsToMilliseconds(_e.repeatDelay)),_e.from!==void 0&&(_e.keyframes[0]=_e.from);let et=!1;if((_e.type===!1||_e.duration===0&&!_e.repeatDelay)&&(makeAnimationInstant(_e),_e.delay===0&&(et=!0)),(MotionGlobalConfig.instantAnimations||MotionGlobalConfig.skipAnimations)&&(et=!0,makeAnimationInstant(_e),_e.delay=0),_e.allowFlatten=!b.type&&!b.ease,et&&!$&&a.get()!==void 0){const tt=getFinalKeyframe(_e.keyframes,b);if(tt!==void 0){frame.update(()=>{_e.onUpdate(tt),_e.onComplete()});return}}return b.isSync?new JSAnimation(_e):new AsyncMotionValueAnimation(_e)};function shouldBlockAnimation({protectedKeys:e,needsAnimating:a},o){const c=e.hasOwnProperty(o)&&a[o]!==!0;return a[o]=!1,c}function animateTarget(e,a,{delay:o=0,transitionOverride:c,type:d}={}){let{transition:$=e.getDefaultTransition(),transitionEnd:g,...b}=a;c&&($=c);const _=[],j=d&&e.animationState&&e.animationState.getState()[d];for(const _e in b){const et=e.getValue(_e,e.latestValues[_e]??null),tt=b[_e];if(tt===void 0||j&&shouldBlockAnimation(j,_e))continue;const nt={delay:o,...getValueTransition($||{},_e)},at=et.get();if(at!==void 0&&!et.isAnimating&&!Array.isArray(tt)&&tt===at&&!nt.velocity)continue;let lt=!1;if(window.MotionHandoffAnimation){const ot=getOptimisedAppearId(e);if(ot){const st=window.MotionHandoffAnimation(ot,_e,frame);st!==null&&(nt.startTime=st,lt=!0)}}addValueToWillChange(e,_e),et.start(animateMotionValue(_e,et,tt,e.shouldReduceMotion&&positionalKeys.has(_e)?{type:!1}:nt,e,lt));const mt=et.animation;mt&&_.push(mt)}return g&&Promise.all(_).then(()=>{frame.update(()=>{g&&setTarget(e,g)})}),_}function calcChildStagger(e,a,o,c=0,d=1){const $=Array.from(e).sort((j,_e)=>j.sortNodePosition(_e)).indexOf(a),g=e.size,b=(g-1)*c;return typeof o=="function"?o($,g):d===1?$*c:b-$*c}function animateVariant(e,a,o={}){var _;const c=resolveVariant(e,a,o.type==="exit"?(_=e.presenceContext)==null?void 0:_.custom:void 0);let{transition:d=e.getDefaultTransition()||{}}=c||{};o.transitionOverride&&(d=o.transitionOverride);const $=c?()=>Promise.all(animateTarget(e,c,o)):()=>Promise.resolve(),g=e.variantChildren&&e.variantChildren.size?(j=0)=>{const{delayChildren:_e=0,staggerChildren:et,staggerDirection:tt}=d;return animateChildren(e,a,j,_e,et,tt,o)}:()=>Promise.resolve(),{when:b}=d;if(b){const[j,_e]=b==="beforeChildren"?[$,g]:[g,$];return j().then(()=>_e())}else return Promise.all([$(),g(o.delay)])}function animateChildren(e,a,o=0,c=0,d=0,$=1,g){const b=[];for(const _ of e.variantChildren)_.notify("AnimationStart",a),b.push(animateVariant(_,a,{...g,delay:o+(typeof c=="function"?0:c)+calcChildStagger(e.variantChildren,_,c,d,$)}).then(()=>_.notify("AnimationComplete",a)));return Promise.all(b)}function animateVisualElement(e,a,o={}){e.notify("AnimationStart",a);let c;if(Array.isArray(a)){const d=a.map($=>animateVariant(e,$,o));c=Promise.all(d)}else if(typeof a=="string")c=animateVariant(e,a,o);else{const d=typeof a=="function"?resolveVariant(e,a,o.custom):a;c=Promise.all(animateTarget(e,d,o))}return c.then(()=>{e.notify("AnimationComplete",a)})}function shallowCompare(e,a){if(!Array.isArray(a))return!1;const o=a.length;if(o!==e.length)return!1;for(let c=0;c<o;c++)if(a[c]!==e[c])return!1;return!0}const numVariantProps=variantProps.length;function getVariantContext(e){if(!e)return;if(!e.isControllingVariants){const o=e.parent?getVariantContext(e.parent)||{}:{};return e.props.initial!==void 0&&(o.initial=e.props.initial),o}const a={};for(let o=0;o<numVariantProps;o++){const c=variantProps[o],d=e.props[c];(isVariantLabel(d)||d===!1)&&(a[c]=d)}return a}const reversePriorityOrder=[...variantPriorityOrder].reverse(),numAnimationTypes=variantPriorityOrder.length;function animateList(e){return a=>Promise.all(a.map(({animation:o,options:c})=>animateVisualElement(e,o,c)))}function createAnimationState(e){let a=animateList(e),o=createState$1(),c=!0;const d=_=>(j,_e)=>{var tt;const et=resolveVariant(e,_e,_==="exit"?(tt=e.presenceContext)==null?void 0:tt.custom:void 0);if(et){const{transition:nt,transitionEnd:at,...lt}=et;j={...j,...lt,...at}}return j};function $(_){a=_(e)}function g(_){const{props:j}=e,_e=getVariantContext(e.parent)||{},et=[],tt=new Set;let nt={},at=1/0;for(let mt=0;mt<numAnimationTypes;mt++){const ot=reversePriorityOrder[mt],st=o[ot],ut=j[ot]!==void 0?j[ot]:_e[ot],pt=isVariantLabel(ut),gt=ot===_?st.isActive:null;gt===!1&&(at=mt);let ft=ut===_e[ot]&&ut!==j[ot]&&pt;if(ft&&c&&e.manuallyAnimateOnMount&&(ft=!1),st.protectedKeys={...nt},!st.isActive&&gt===null||!ut&&!st.prevProp||isAnimationControls(ut)||typeof ut=="boolean")continue;const yt=checkVariantsDidChange(st.prevProp,ut);let _t=yt||ot===_&&st.isActive&&!ft&&pt||mt>at&&pt,vt=!1;const Pt=Array.isArray(ut)?ut:[ut];let Tt=Pt.reduce(d(ot),{});gt===!1&&(Tt={});const{prevResolvedValues:St={}}=st,qt={...St,...Tt},Ft=Nt=>{_t=!0,tt.has(Nt)&&(vt=!0,tt.delete(Nt)),st.needsAnimating[Nt]=!0;const Et=e.getValue(Nt);Et&&(Et.liveStyle=!1)};for(const Nt in qt){const Et=Tt[Nt],At=St[Nt];if(nt.hasOwnProperty(Nt))continue;let dt=!1;isKeyframesTarget(Et)&&isKeyframesTarget(At)?dt=!shallowCompare(Et,At):dt=Et!==At,dt?Et!=null?Ft(Nt):tt.add(Nt):Et!==void 0&&tt.has(Nt)?Ft(Nt):st.protectedKeys[Nt]=!0}st.prevProp=ut,st.prevResolvedValues=Tt,st.isActive&&(nt={...nt,...Tt}),c&&e.blockInitialAnimation&&(_t=!1);const Dt=ft&&yt;_t&&(!Dt||vt)&&et.push(...Pt.map(Nt=>{const Et={type:ot};if(typeof Nt=="string"&&c&&!Dt&&e.manuallyAnimateOnMount&&e.parent){const{parent:At}=e,dt=resolveVariant(At,Nt);if(At.enteringChildren&&dt){const{delayChildren:Mt}=dt.transition||{};Et.delay=calcChildStagger(At.enteringChildren,e,Mt)}}return{animation:Nt,options:Et}}))}if(tt.size){const mt={};if(typeof j.initial!="boolean"){const ot=resolveVariant(e,Array.isArray(j.initial)?j.initial[0]:j.initial);ot&&ot.transition&&(mt.transition=ot.transition)}tt.forEach(ot=>{const st=e.getBaseTarget(ot),ut=e.getValue(ot);ut&&(ut.liveStyle=!0),mt[ot]=st??null}),et.push({animation:mt})}let lt=!!et.length;return c&&(j.initial===!1||j.initial===j.animate)&&!e.manuallyAnimateOnMount&&(lt=!1),c=!1,lt?a(et):Promise.resolve()}function b(_,j){var et;if(o[_].isActive===j)return Promise.resolve();(et=e.variantChildren)==null||et.forEach(tt=>{var nt;return(nt=tt.animationState)==null?void 0:nt.setActive(_,j)}),o[_].isActive=j;const _e=g(_);for(const tt in o)o[tt].protectedKeys={};return _e}return{animateChanges:g,setActive:b,setAnimateFunction:$,getState:()=>o,reset:()=>{o=createState$1(),c=!0}}}function checkVariantsDidChange(e,a){return typeof a=="string"?a!==e:Array.isArray(a)?!shallowCompare(a,e):!1}function createTypeState(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function createState$1(){return{animate:createTypeState(!0),whileInView:createTypeState(),whileHover:createTypeState(),whileTap:createTypeState(),whileDrag:createTypeState(),whileFocus:createTypeState(),exit:createTypeState()}}class Feature{constructor(a){this.isMounted=!1,this.node=a}update(){}}class AnimationFeature extends Feature{constructor(a){super(a),a.animationState||(a.animationState=createAnimationState(a))}updateAnimationControlsSubscription(){const{animate:a}=this.node.getProps();isAnimationControls(a)&&(this.unmountControls=a.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:a}=this.node.getProps(),{animate:o}=this.node.prevProps||{};a!==o&&this.updateAnimationControlsSubscription()}unmount(){var a;this.node.animationState.reset(),(a=this.unmountControls)==null||a.call(this)}}let id$1=0;class ExitAnimationFeature extends Feature{constructor(){super(...arguments),this.id=id$1++}update(){if(!this.node.presenceContext)return;const{isPresent:a,onExitComplete:o}=this.node.presenceContext,{isPresent:c}=this.node.prevPresenceContext||{};if(!this.node.animationState||a===c)return;const d=this.node.animationState.setActive("exit",!a);o&&!a&&d.then(()=>{o(this.id)})}mount(){const{register:a,onExitComplete:o}=this.node.presenceContext||{};o&&o(this.id),a&&(this.unmount=a(this.id))}unmount(){}}const animations={animation:{Feature:AnimationFeature},exit:{Feature:ExitAnimationFeature}};function addDomEvent(e,a,o,c={passive:!0}){return e.addEventListener(a,o,c),()=>e.removeEventListener(a,o)}function extractEventInfo(e){return{point:{x:e.pageX,y:e.pageY}}}const addPointerInfo=e=>a=>isPrimaryPointer(a)&&e(a,extractEventInfo(a));function addPointerEvent(e,a,o,c){return addDomEvent(e,a,addPointerInfo(o),c)}const SCALE_PRECISION=1e-4,SCALE_MIN=1-SCALE_PRECISION,SCALE_MAX=1+SCALE_PRECISION,TRANSLATE_PRECISION=.01,TRANSLATE_MIN=0-TRANSLATE_PRECISION,TRANSLATE_MAX=0+TRANSLATE_PRECISION;function calcLength(e){return e.max-e.min}function isNear(e,a,o){return Math.abs(e-a)<=o}function calcAxisDelta(e,a,o,c=.5){e.origin=c,e.originPoint=mixNumber$1(a.min,a.max,e.origin),e.scale=calcLength(o)/calcLength(a),e.translate=mixNumber$1(o.min,o.max,e.origin)-e.originPoint,(e.scale>=SCALE_MIN&&e.scale<=SCALE_MAX||isNaN(e.scale))&&(e.scale=1),(e.translate>=TRANSLATE_MIN&&e.translate<=TRANSLATE_MAX||isNaN(e.translate))&&(e.translate=0)}function calcBoxDelta(e,a,o,c){calcAxisDelta(e.x,a.x,o.x,c?c.originX:void 0),calcAxisDelta(e.y,a.y,o.y,c?c.originY:void 0)}function calcRelativeAxis(e,a,o){e.min=o.min+a.min,e.max=e.min+calcLength(a)}function calcRelativeBox(e,a,o){calcRelativeAxis(e.x,a.x,o.x),calcRelativeAxis(e.y,a.y,o.y)}function calcRelativeAxisPosition(e,a,o){e.min=a.min-o.min,e.max=e.min+calcLength(a)}function calcRelativePosition(e,a,o){calcRelativeAxisPosition(e.x,a.x,o.x),calcRelativeAxisPosition(e.y,a.y,o.y)}function eachAxis(e){return[e("x"),e("y")]}const getContextWindow=({current:e})=>e?e.ownerDocument.defaultView:null,distance=(e,a)=>Math.abs(e-a);function distance2D(e,a){const o=distance(e.x,a.x),c=distance(e.y,a.y);return Math.sqrt(o**2+c**2)}class PanSession{constructor(a,o,{transformPagePoint:c,contextWindow:d=window,dragSnapToOrigin:$=!1,distanceThreshold:g=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const tt=getPanInfo(this.lastMoveEventInfo,this.history),nt=this.startEvent!==null,at=distance2D(tt.offset,{x:0,y:0})>=this.distanceThreshold;if(!nt&&!at)return;const{point:lt}=tt,{timestamp:mt}=frameData;this.history.push({...lt,timestamp:mt});const{onStart:ot,onMove:st}=this.handlers;nt||(ot&&ot(this.lastMoveEvent,tt),this.startEvent=this.lastMoveEvent),st&&st(this.lastMoveEvent,tt)},this.handlePointerMove=(tt,nt)=>{this.lastMoveEvent=tt,this.lastMoveEventInfo=transformPoint(nt,this.transformPagePoint),frame.update(this.updatePoint,!0)},this.handlePointerUp=(tt,nt)=>{this.end();const{onEnd:at,onSessionEnd:lt,resumeAnimation:mt}=this.handlers;if(this.dragSnapToOrigin&&mt&&mt(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const ot=getPanInfo(tt.type==="pointercancel"?this.lastMoveEventInfo:transformPoint(nt,this.transformPagePoint),this.history);this.startEvent&&at&&at(tt,ot),lt&&lt(tt,ot)},!isPrimaryPointer(a))return;this.dragSnapToOrigin=$,this.handlers=o,this.transformPagePoint=c,this.distanceThreshold=g,this.contextWindow=d||window;const b=extractEventInfo(a),_=transformPoint(b,this.transformPagePoint),{point:j}=_,{timestamp:_e}=frameData;this.history=[{...j,timestamp:_e}];const{onSessionStart:et}=o;et&&et(a,getPanInfo(_,this.history)),this.removeListeners=pipe(addPointerEvent(this.contextWindow,"pointermove",this.handlePointerMove),addPointerEvent(this.contextWindow,"pointerup",this.handlePointerUp),addPointerEvent(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(a){this.handlers=a}end(){this.removeListeners&&this.removeListeners(),cancelFrame(this.updatePoint)}}function transformPoint(e,a){return a?{point:a(e.point)}:e}function subtractPoint(e,a){return{x:e.x-a.x,y:e.y-a.y}}function getPanInfo({point:e},a){return{point:e,delta:subtractPoint(e,lastDevicePoint(a)),offset:subtractPoint(e,startDevicePoint(a)),velocity:getVelocity(a,.1)}}function startDevicePoint(e){return e[0]}function lastDevicePoint(e){return e[e.length-1]}function getVelocity(e,a){if(e.length<2)return{x:0,y:0};let o=e.length-1,c=null;const d=lastDevicePoint(e);for(;o>=0&&(c=e[o],!(d.timestamp-c.timestamp>secondsToMilliseconds(a)));)o--;if(!c)return{x:0,y:0};const $=millisecondsToSeconds(d.timestamp-c.timestamp);if($===0)return{x:0,y:0};const g={x:(d.x-c.x)/$,y:(d.y-c.y)/$};return g.x===1/0&&(g.x=0),g.y===1/0&&(g.y=0),g}function applyConstraints(e,{min:a,max:o},c){return a!==void 0&&e<a?e=c?mixNumber$1(a,e,c.min):Math.max(e,a):o!==void 0&&e>o&&(e=c?mixNumber$1(o,e,c.max):Math.min(e,o)),e}function calcRelativeAxisConstraints(e,a,o){return{min:a!==void 0?e.min+a:void 0,max:o!==void 0?e.max+o-(e.max-e.min):void 0}}function calcRelativeConstraints(e,{top:a,left:o,bottom:c,right:d}){return{x:calcRelativeAxisConstraints(e.x,o,d),y:calcRelativeAxisConstraints(e.y,a,c)}}function calcViewportAxisConstraints(e,a){let o=a.min-e.min,c=a.max-e.max;return a.max-a.min<e.max-e.min&&([o,c]=[c,o]),{min:o,max:c}}function calcViewportConstraints(e,a){return{x:calcViewportAxisConstraints(e.x,a.x),y:calcViewportAxisConstraints(e.y,a.y)}}function calcOrigin(e,a){let o=.5;const c=calcLength(e),d=calcLength(a);return d>c?o=progress(a.min,a.max-c,e.min):c>d&&(o=progress(e.min,e.max-d,a.min)),clamp(0,1,o)}function rebaseAxisConstraints(e,a){const o={};return a.min!==void 0&&(o.min=a.min-e.min),a.max!==void 0&&(o.max=a.max-e.min),o}const defaultElastic=.35;function resolveDragElastic(e=defaultElastic){return e===!1?e=0:e===!0&&(e=defaultElastic),{x:resolveAxisElastic(e,"left","right"),y:resolveAxisElastic(e,"top","bottom")}}function resolveAxisElastic(e,a,o){return{min:resolvePointElastic(e,a),max:resolvePointElastic(e,o)}}function resolvePointElastic(e,a){return typeof e=="number"?e:e[a]||0}const elementDragControls=new WeakMap;class VisualElementDragControls{constructor(a){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=createBox(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=a}start(a,{snapToCursor:o=!1,distanceThreshold:c}={}){const{presenceContext:d}=this.visualElement;if(d&&d.isPresent===!1)return;const $=et=>{const{dragSnapToOrigin:tt}=this.getProps();tt?this.pauseAnimation():this.stopAnimation(),o&&this.snapToCursor(extractEventInfo(et).point)},g=(et,tt)=>{const{drag:nt,dragPropagation:at,onDragStart:lt}=this.getProps();if(nt&&!at&&(this.openDragLock&&this.openDragLock(),this.openDragLock=setDragLock(nt),!this.openDragLock))return;this.latestPointerEvent=et,this.latestPanInfo=tt,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),eachAxis(ot=>{let st=this.getAxisMotionValue(ot).get()||0;if(percent.test(st)){const{projection:ut}=this.visualElement;if(ut&&ut.layout){const pt=ut.layout.layoutBox[ot];pt&&(st=calcLength(pt)*(parseFloat(st)/100))}}this.originPoint[ot]=st}),lt&&frame.postRender(()=>lt(et,tt)),addValueToWillChange(this.visualElement,"transform");const{animationState:mt}=this.visualElement;mt&&mt.setActive("whileDrag",!0)},b=(et,tt)=>{this.latestPointerEvent=et,this.latestPanInfo=tt;const{dragPropagation:nt,dragDirectionLock:at,onDirectionLock:lt,onDrag:mt}=this.getProps();if(!nt&&!this.openDragLock)return;const{offset:ot}=tt;if(at&&this.currentDirection===null){this.currentDirection=getCurrentDirection(ot),this.currentDirection!==null&&lt&&lt(this.currentDirection);return}this.updateAxis("x",tt.point,ot),this.updateAxis("y",tt.point,ot),this.visualElement.render(),mt&&mt(et,tt)},_=(et,tt)=>{this.latestPointerEvent=et,this.latestPanInfo=tt,this.stop(et,tt),this.latestPointerEvent=null,this.latestPanInfo=null},j=()=>eachAxis(et=>{var tt;return this.getAnimationState(et)==="paused"&&((tt=this.getAxisMotionValue(et).animation)==null?void 0:tt.play())}),{dragSnapToOrigin:_e}=this.getProps();this.panSession=new PanSession(a,{onSessionStart:$,onStart:g,onMove:b,onSessionEnd:_,resumeAnimation:j},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:_e,distanceThreshold:c,contextWindow:getContextWindow(this.visualElement)})}stop(a,o){const c=a||this.latestPointerEvent,d=o||this.latestPanInfo,$=this.isDragging;if(this.cancel(),!$||!d||!c)return;const{velocity:g}=d;this.startAnimation(g);const{onDragEnd:b}=this.getProps();b&&frame.postRender(()=>b(c,d))}cancel(){this.isDragging=!1;const{projection:a,animationState:o}=this.visualElement;a&&(a.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:c}=this.getProps();!c&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),o&&o.setActive("whileDrag",!1)}updateAxis(a,o,c){const{drag:d}=this.getProps();if(!c||!shouldDrag(a,d,this.currentDirection))return;const $=this.getAxisMotionValue(a);let g=this.originPoint[a]+c[a];this.constraints&&this.constraints[a]&&(g=applyConstraints(g,this.constraints[a],this.elastic[a])),$.set(g)}resolveConstraints(){var $;const{dragConstraints:a,dragElastic:o}=this.getProps(),c=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):($=this.visualElement.projection)==null?void 0:$.layout,d=this.constraints;a&&isRefObject(a)?this.constraints||(this.constraints=this.resolveRefConstraints()):a&&c?this.constraints=calcRelativeConstraints(c.layoutBox,a):this.constraints=!1,this.elastic=resolveDragElastic(o),d!==this.constraints&&c&&this.constraints&&!this.hasMutatedConstraints&&eachAxis(g=>{this.constraints!==!1&&this.getAxisMotionValue(g)&&(this.constraints[g]=rebaseAxisConstraints(c.layoutBox[g],this.constraints[g]))})}resolveRefConstraints(){const{dragConstraints:a,onMeasureDragConstraints:o}=this.getProps();if(!a||!isRefObject(a))return!1;const c=a.current,{projection:d}=this.visualElement;if(!d||!d.layout)return!1;const $=measurePageBox(c,d.root,this.visualElement.getTransformPagePoint());let g=calcViewportConstraints(d.layout.layoutBox,$);if(o){const b=o(convertBoxToBoundingBox(g));this.hasMutatedConstraints=!!b,b&&(g=convertBoundingBoxToBox(b))}return g}startAnimation(a){const{drag:o,dragMomentum:c,dragElastic:d,dragTransition:$,dragSnapToOrigin:g,onDragTransitionEnd:b}=this.getProps(),_=this.constraints||{},j=eachAxis(_e=>{if(!shouldDrag(_e,o,this.currentDirection))return;let et=_&&_[_e]||{};g&&(et={min:0,max:0});const tt=d?200:1e6,nt=d?40:1e7,at={type:"inertia",velocity:c?a[_e]:0,bounceStiffness:tt,bounceDamping:nt,timeConstant:750,restDelta:1,restSpeed:10,...$,...et};return this.startAxisValueAnimation(_e,at)});return Promise.all(j).then(b)}startAxisValueAnimation(a,o){const c=this.getAxisMotionValue(a);return addValueToWillChange(this.visualElement,a),c.start(animateMotionValue(a,c,0,o,this.visualElement,!1))}stopAnimation(){eachAxis(a=>this.getAxisMotionValue(a).stop())}pauseAnimation(){eachAxis(a=>{var o;return(o=this.getAxisMotionValue(a).animation)==null?void 0:o.pause()})}getAnimationState(a){var o;return(o=this.getAxisMotionValue(a).animation)==null?void 0:o.state}getAxisMotionValue(a){const o=`_drag${a.toUpperCase()}`,c=this.visualElement.getProps(),d=c[o];return d||this.visualElement.getValue(a,(c.initial?c.initial[a]:void 0)||0)}snapToCursor(a){eachAxis(o=>{const{drag:c}=this.getProps();if(!shouldDrag(o,c,this.currentDirection))return;const{projection:d}=this.visualElement,$=this.getAxisMotionValue(o);if(d&&d.layout){const{min:g,max:b}=d.layout.layoutBox[o];$.set(a[o]-mixNumber$1(g,b,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:a,dragConstraints:o}=this.getProps(),{projection:c}=this.visualElement;if(!isRefObject(o)||!c||!this.constraints)return;this.stopAnimation();const d={x:0,y:0};eachAxis(g=>{const b=this.getAxisMotionValue(g);if(b&&this.constraints!==!1){const _=b.get();d[g]=calcOrigin({min:_,max:_},this.constraints[g])}});const{transformTemplate:$}=this.visualElement.getProps();this.visualElement.current.style.transform=$?$({},""):"none",c.root&&c.root.updateScroll(),c.updateLayout(),this.resolveConstraints(),eachAxis(g=>{if(!shouldDrag(g,a,null))return;const b=this.getAxisMotionValue(g),{min:_,max:j}=this.constraints[g];b.set(mixNumber$1(_,j,d[g]))})}addListeners(){if(!this.visualElement.current)return;elementDragControls.set(this.visualElement,this);const a=this.visualElement.current,o=addPointerEvent(a,"pointerdown",_=>{const{drag:j,dragListener:_e=!0}=this.getProps();j&&_e&&this.start(_)}),c=()=>{const{dragConstraints:_}=this.getProps();isRefObject(_)&&_.current&&(this.constraints=this.resolveRefConstraints())},{projection:d}=this.visualElement,$=d.addEventListener("measure",c);d&&!d.layout&&(d.root&&d.root.updateScroll(),d.updateLayout()),frame.read(c);const g=addDomEvent(window,"resize",()=>this.scalePositionWithinConstraints()),b=d.addEventListener("didUpdate",({delta:_,hasLayoutChanged:j})=>{this.isDragging&&j&&(eachAxis(_e=>{const et=this.getAxisMotionValue(_e);et&&(this.originPoint[_e]+=_[_e].translate,et.set(et.get()+_[_e].translate))}),this.visualElement.render())});return()=>{g(),o(),$(),b&&b()}}getProps(){const a=this.visualElement.getProps(),{drag:o=!1,dragDirectionLock:c=!1,dragPropagation:d=!1,dragConstraints:$=!1,dragElastic:g=defaultElastic,dragMomentum:b=!0}=a;return{...a,drag:o,dragDirectionLock:c,dragPropagation:d,dragConstraints:$,dragElastic:g,dragMomentum:b}}}function shouldDrag(e,a,o){return(a===!0||a===e)&&(o===null||o===e)}function getCurrentDirection(e,a=10){let o=null;return Math.abs(e.y)>a?o="y":Math.abs(e.x)>a&&(o="x"),o}class DragGesture extends Feature{constructor(a){super(a),this.removeGroupControls=noop,this.removeListeners=noop,this.controls=new VisualElementDragControls(a)}mount(){const{dragControls:a}=this.node.getProps();a&&(this.removeGroupControls=a.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||noop}unmount(){this.removeGroupControls(),this.removeListeners()}}const asyncHandler=e=>(a,o)=>{e&&frame.postRender(()=>e(a,o))};class PanGesture extends Feature{constructor(){super(...arguments),this.removePointerDownListener=noop}onPointerDown(a){this.session=new PanSession(a,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:getContextWindow(this.node)})}createPanHandlers(){const{onPanSessionStart:a,onPanStart:o,onPan:c,onPanEnd:d}=this.node.getProps();return{onSessionStart:asyncHandler(a),onStart:asyncHandler(o),onMove:c,onEnd:($,g)=>{delete this.session,d&&frame.postRender(()=>d($,g))}}}mount(){this.removePointerDownListener=addPointerEvent(this.node.current,"pointerdown",a=>this.onPointerDown(a))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const globalProjectionState={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function pixelsToPercent(e,a){return a.max===a.min?0:e/(a.max-a.min)*100}const correctBorderRadius={correct:(e,a)=>{if(!a.target)return e;if(typeof e=="string")if(px.test(e))e=parseFloat(e);else return e;const o=pixelsToPercent(e,a.target.x),c=pixelsToPercent(e,a.target.y);return`${o}% ${c}%`}},correctBoxShadow={correct:(e,{treeScale:a,projectionDelta:o})=>{const c=e,d=complex.parse(e);if(d.length>5)return c;const $=complex.createTransformer(e),g=typeof d[0]!="number"?1:0,b=o.x.scale*a.x,_=o.y.scale*a.y;d[0+g]/=b,d[1+g]/=_;const j=mixNumber$1(b,_,.5);return typeof d[2+g]=="number"&&(d[2+g]/=j),typeof d[3+g]=="number"&&(d[3+g]/=j),$(d)}};let hasTakenAnySnapshot=!1;class MeasureLayoutWithContext extends reactExports.Component{componentDidMount(){const{visualElement:a,layoutGroup:o,switchLayoutGroup:c,layoutId:d}=this.props,{projection:$}=a;addScaleCorrector(defaultScaleCorrectors),$&&(o.group&&o.group.add($),c&&c.register&&d&&c.register($),hasTakenAnySnapshot&&$.root.didUpdate(),$.addEventListener("animationComplete",()=>{this.safeToRemove()}),$.setOptions({...$.options,onExitComplete:()=>this.safeToRemove()})),globalProjectionState.hasEverUpdated=!0}getSnapshotBeforeUpdate(a){const{layoutDependency:o,visualElement:c,drag:d,isPresent:$}=this.props,{projection:g}=c;return g&&(g.isPresent=$,hasTakenAnySnapshot=!0,d||a.layoutDependency!==o||o===void 0||a.isPresent!==$?g.willUpdate():this.safeToRemove(),a.isPresent!==$&&($?g.promote():g.relegate()||frame.postRender(()=>{const b=g.getStack();(!b||!b.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:a}=this.props.visualElement;a&&(a.root.didUpdate(),microtask.postRender(()=>{!a.currentAnimation&&a.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:a,layoutGroup:o,switchLayoutGroup:c}=this.props,{projection:d}=a;hasTakenAnySnapshot=!0,d&&(d.scheduleCheckAfterUnmount(),o&&o.group&&o.group.remove(d),c&&c.deregister&&c.deregister(d))}safeToRemove(){const{safeToRemove:a}=this.props;a&&a()}render(){return null}}function MeasureLayout(e){const[a,o]=usePresence(),c=reactExports.useContext(LayoutGroupContext);return jsxRuntimeExports.jsx(MeasureLayoutWithContext,{...e,layoutGroup:c,switchLayoutGroup:reactExports.useContext(SwitchLayoutGroupContext),isPresent:a,safeToRemove:o})}const defaultScaleCorrectors={borderRadius:{...correctBorderRadius,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:correctBorderRadius,borderTopRightRadius:correctBorderRadius,borderBottomLeftRadius:correctBorderRadius,borderBottomRightRadius:correctBorderRadius,boxShadow:correctBoxShadow};function animateSingleValue(e,a,o){const c=isMotionValue(e)?e:motionValue(e);return c.start(animateMotionValue("",c,a,o)),c.animation}const compareByDepth=(e,a)=>e.depth-a.depth;class FlatTree{constructor(){this.children=[],this.isDirty=!1}add(a){addUniqueItem(this.children,a),this.isDirty=!0}remove(a){removeItem(this.children,a),this.isDirty=!0}forEach(a){this.isDirty&&this.children.sort(compareByDepth),this.isDirty=!1,this.children.forEach(a)}}function delay(e,a){const o=time.now(),c=({timestamp:d})=>{const $=d-o;$>=a&&(cancelFrame(c),e($-a))};return frame.setup(c,!0),()=>cancelFrame(c)}const borders=["TopLeft","TopRight","BottomLeft","BottomRight"],numBorders=borders.length,asNumber=e=>typeof e=="string"?parseFloat(e):e,isPx=e=>typeof e=="number"||px.test(e);function mixValues(e,a,o,c,d,$){d?(e.opacity=mixNumber$1(0,o.opacity??1,easeCrossfadeIn(c)),e.opacityExit=mixNumber$1(a.opacity??1,0,easeCrossfadeOut(c))):$&&(e.opacity=mixNumber$1(a.opacity??1,o.opacity??1,c));for(let g=0;g<numBorders;g++){const b=`border${borders[g]}Radius`;let _=getRadius(a,b),j=getRadius(o,b);if(_===void 0&&j===void 0)continue;_||(_=0),j||(j=0),_===0||j===0||isPx(_)===isPx(j)?(e[b]=Math.max(mixNumber$1(asNumber(_),asNumber(j),c),0),(percent.test(j)||percent.test(_))&&(e[b]+="%")):e[b]=j}(a.rotate||o.rotate)&&(e.rotate=mixNumber$1(a.rotate||0,o.rotate||0,c))}function getRadius(e,a){return e[a]!==void 0?e[a]:e.borderRadius}const easeCrossfadeIn=compress(0,.5,circOut),easeCrossfadeOut=compress(.5,.95,noop);function compress(e,a,o){return c=>c<e?0:c>a?1:o(progress(e,a,c))}function copyAxisInto(e,a){e.min=a.min,e.max=a.max}function copyBoxInto(e,a){copyAxisInto(e.x,a.x),copyAxisInto(e.y,a.y)}function copyAxisDeltaInto(e,a){e.translate=a.translate,e.scale=a.scale,e.originPoint=a.originPoint,e.origin=a.origin}function removePointDelta(e,a,o,c,d){return e-=a,e=scalePoint(e,1/o,c),d!==void 0&&(e=scalePoint(e,1/d,c)),e}function removeAxisDelta(e,a=0,o=1,c=.5,d,$=e,g=e){if(percent.test(a)&&(a=parseFloat(a),a=mixNumber$1(g.min,g.max,a/100)-g.min),typeof a!="number")return;let b=mixNumber$1($.min,$.max,c);e===$&&(b-=a),e.min=removePointDelta(e.min,a,o,b,d),e.max=removePointDelta(e.max,a,o,b,d)}function removeAxisTransforms(e,a,[o,c,d],$,g){removeAxisDelta(e,a[o],a[c],a[d],a.scale,$,g)}const xKeys=["x","scaleX","originX"],yKeys=["y","scaleY","originY"];function removeBoxTransforms(e,a,o,c){removeAxisTransforms(e.x,a,xKeys,o?o.x:void 0,c?c.x:void 0),removeAxisTransforms(e.y,a,yKeys,o?o.y:void 0,c?c.y:void 0)}function isAxisDeltaZero(e){return e.translate===0&&e.scale===1}function isDeltaZero(e){return isAxisDeltaZero(e.x)&&isAxisDeltaZero(e.y)}function axisEquals(e,a){return e.min===a.min&&e.max===a.max}function boxEquals(e,a){return axisEquals(e.x,a.x)&&axisEquals(e.y,a.y)}function axisEqualsRounded(e,a){return Math.round(e.min)===Math.round(a.min)&&Math.round(e.max)===Math.round(a.max)}function boxEqualsRounded(e,a){return axisEqualsRounded(e.x,a.x)&&axisEqualsRounded(e.y,a.y)}function aspectRatio(e){return calcLength(e.x)/calcLength(e.y)}function axisDeltaEquals(e,a){return e.translate===a.translate&&e.scale===a.scale&&e.originPoint===a.originPoint}class NodeStack{constructor(){this.members=[]}add(a){addUniqueItem(this.members,a),a.scheduleRender()}remove(a){if(removeItem(this.members,a),a===this.prevLead&&(this.prevLead=void 0),a===this.lead){const o=this.members[this.members.length-1];o&&this.promote(o)}}relegate(a){const o=this.members.findIndex(d=>a===d);if(o===0)return!1;let c;for(let d=o;d>=0;d--){const $=this.members[d];if($.isPresent!==!1){c=$;break}}return c?(this.promote(c),!0):!1}promote(a,o){const c=this.lead;if(a!==c&&(this.prevLead=c,this.lead=a,a.show(),c)){c.instance&&c.scheduleRender(),a.scheduleRender(),a.resumeFrom=c,o&&(a.resumeFrom.preserveOpacity=!0),c.snapshot&&(a.snapshot=c.snapshot,a.snapshot.latestValues=c.animationValues||c.latestValues),a.root&&a.root.isUpdating&&(a.isLayoutDirty=!0);const{crossfade:d}=a.options;d===!1&&c.hide()}}exitAnimationComplete(){this.members.forEach(a=>{const{options:o,resumingFrom:c}=a;o.onExitComplete&&o.onExitComplete(),c&&c.options.onExitComplete&&c.options.onExitComplete()})}scheduleRender(){this.members.forEach(a=>{a.instance&&a.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function buildProjectionTransform(e,a,o){let c="";const d=e.x.translate/a.x,$=e.y.translate/a.y,g=(o==null?void 0:o.z)||0;if((d||$||g)&&(c=`translate3d(${d}px, ${$}px, ${g}px) `),(a.x!==1||a.y!==1)&&(c+=`scale(${1/a.x}, ${1/a.y}) `),o){const{transformPerspective:j,rotate:_e,rotateX:et,rotateY:tt,skewX:nt,skewY:at}=o;j&&(c=`perspective(${j}px) ${c}`),_e&&(c+=`rotate(${_e}deg) `),et&&(c+=`rotateX(${et}deg) `),tt&&(c+=`rotateY(${tt}deg) `),nt&&(c+=`skewX(${nt}deg) `),at&&(c+=`skewY(${at}deg) `)}const b=e.x.scale*a.x,_=e.y.scale*a.y;return(b!==1||_!==1)&&(c+=`scale(${b}, ${_})`),c||"none"}const transformAxes=["","X","Y","Z"],animationTarget=1e3;let id=0;function resetDistortingTransform(e,a,o,c){const{latestValues:d}=a;d[e]&&(o[e]=d[e],a.setStaticValue(e,0),c&&(c[e]=0))}function cancelTreeOptimisedTransformAnimations(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:a}=e.options;if(!a)return;const o=getOptimisedAppearId(a);if(window.MotionHasOptimisedAnimation(o,"transform")){const{layout:d,layoutId:$}=e.options;window.MotionCancelOptimisedAnimation(o,"transform",frame,!(d||$))}const{parent:c}=e;c&&!c.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(c)}function createProjectionNode({attachResizeListener:e,defaultParent:a,measureScroll:o,checkIsScrollRoot:c,resetTransform:d}){return class{constructor(g={},b=a==null?void 0:a()){this.id=id++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(propagateDirtyNodes),this.nodes.forEach(resolveTargetDelta),this.nodes.forEach(calcProjection),this.nodes.forEach(cleanDirtyNodes)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=g,this.root=b?b.root||b:this,this.path=b?[...b.path,b]:[],this.parent=b,this.depth=b?b.depth+1:0;for(let _=0;_<this.path.length;_++)this.path[_].shouldResetTransform=!0;this.root===this&&(this.nodes=new FlatTree)}addEventListener(g,b){return this.eventHandlers.has(g)||this.eventHandlers.set(g,new SubscriptionManager),this.eventHandlers.get(g).add(b)}notifyListeners(g,...b){const _=this.eventHandlers.get(g);_&&_.notify(...b)}hasListeners(g){return this.eventHandlers.has(g)}mount(g){if(this.instance)return;this.isSVG=isSVGElement(g)&&!isSVGSVGElement(g),this.instance=g;const{layoutId:b,layout:_,visualElement:j}=this.options;if(j&&!j.current&&j.mount(g),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(_||b)&&(this.isLayoutDirty=!0),e){let _e,et=0;const tt=()=>this.root.updateBlockedByResize=!1;frame.read(()=>{et=window.innerWidth}),e(g,()=>{const nt=window.innerWidth;nt!==et&&(et=nt,this.root.updateBlockedByResize=!0,_e&&_e(),_e=delay(tt,250),globalProjectionState.hasAnimatedSinceResize&&(globalProjectionState.hasAnimatedSinceResize=!1,this.nodes.forEach(finishAnimation)))})}b&&this.root.registerSharedNode(b,this),this.options.animate!==!1&&j&&(b||_)&&this.addEventListener("didUpdate",({delta:_e,hasLayoutChanged:et,hasRelativeLayoutChanged:tt,layout:nt})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const at=this.options.transition||j.getDefaultTransition()||defaultLayoutTransition,{onLayoutAnimationStart:lt,onLayoutAnimationComplete:mt}=j.getProps(),ot=!this.targetLayout||!boxEqualsRounded(this.targetLayout,nt),st=!et&&tt;if(this.options.layoutRoot||this.resumeFrom||st||et&&(ot||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const ut={...getValueTransition(at,"layout"),onPlay:lt,onComplete:mt};(j.shouldReduceMotion||this.options.layoutRoot)&&(ut.delay=0,ut.type=!1),this.startAnimation(ut),this.setAnimationOrigin(_e,st)}else et||finishAnimation(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=nt})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const g=this.getStack();g&&g.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),cancelFrame(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(resetSkewAndRotation),this.animationId++)}getTransformTemplate(){const{visualElement:g}=this.options;return g&&g.getProps().transformTemplate}willUpdate(g=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let _e=0;_e<this.path.length;_e++){const et=this.path[_e];et.shouldResetTransform=!0,et.updateScroll("snapshot"),et.options.layoutRoot&&et.willUpdate(!1)}const{layoutId:b,layout:_}=this.options;if(b===void 0&&!_)return;const j=this.getTransformTemplate();this.prevTransformTemplateValue=j?j(this.latestValues,""):void 0,this.updateSnapshot(),g&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(clearMeasurements);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(clearIsLayoutDirty);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(resetTransformStyle),this.nodes.forEach(updateLayout),this.nodes.forEach(notifyLayoutUpdate)):this.nodes.forEach(clearIsLayoutDirty),this.clearAllSnapshots();const b=time.now();frameData.delta=clamp(0,1e3/60,b-frameData.timestamp),frameData.timestamp=b,frameData.isProcessing=!0,frameSteps.update.process(frameData),frameSteps.preRender.process(frameData),frameSteps.render.process(frameData),frameData.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,microtask.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(clearSnapshot),this.sharedNodes.forEach(removeLeadSnapshots)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,frame.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){frame.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!calcLength(this.snapshot.measuredBox.x)&&!calcLength(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let _=0;_<this.path.length;_++)this.path[_].updateScroll();const g=this.layout;this.layout=this.measure(!1),this.layoutCorrected=createBox(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:b}=this.options;b&&b.notify("LayoutMeasure",this.layout.layoutBox,g?g.layoutBox:void 0)}updateScroll(g="measure"){let b=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===g&&(b=!1),b&&this.instance){const _=c(this.instance);this.scroll={animationId:this.root.animationId,phase:g,isRoot:_,offset:o(this.instance),wasRoot:this.scroll?this.scroll.isRoot:_}}}resetTransform(){if(!d)return;const g=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,b=this.projectionDelta&&!isDeltaZero(this.projectionDelta),_=this.getTransformTemplate(),j=_?_(this.latestValues,""):void 0,_e=j!==this.prevTransformTemplateValue;g&&this.instance&&(b||hasTransform(this.latestValues)||_e)&&(d(this.instance,j),this.shouldResetTransform=!1,this.scheduleRender())}measure(g=!0){const b=this.measurePageBox();let _=this.removeElementScroll(b);return g&&(_=this.removeTransform(_)),roundBox(_),{animationId:this.root.animationId,measuredBox:b,layoutBox:_,latestValues:{},source:this.id}}measurePageBox(){var j;const{visualElement:g}=this.options;if(!g)return createBox();const b=g.measureViewportBox();if(!(((j=this.scroll)==null?void 0:j.wasRoot)||this.path.some(checkNodeWasScrollRoot))){const{scroll:_e}=this.root;_e&&(translateAxis(b.x,_e.offset.x),translateAxis(b.y,_e.offset.y))}return b}removeElementScroll(g){var _;const b=createBox();if(copyBoxInto(b,g),(_=this.scroll)!=null&&_.wasRoot)return b;for(let j=0;j<this.path.length;j++){const _e=this.path[j],{scroll:et,options:tt}=_e;_e!==this.root&&et&&tt.layoutScroll&&(et.wasRoot&&copyBoxInto(b,g),translateAxis(b.x,et.offset.x),translateAxis(b.y,et.offset.y))}return b}applyTransform(g,b=!1){const _=createBox();copyBoxInto(_,g);for(let j=0;j<this.path.length;j++){const _e=this.path[j];!b&&_e.options.layoutScroll&&_e.scroll&&_e!==_e.root&&transformBox(_,{x:-_e.scroll.offset.x,y:-_e.scroll.offset.y}),hasTransform(_e.latestValues)&&transformBox(_,_e.latestValues)}return hasTransform(this.latestValues)&&transformBox(_,this.latestValues),_}removeTransform(g){const b=createBox();copyBoxInto(b,g);for(let _=0;_<this.path.length;_++){const j=this.path[_];if(!j.instance||!hasTransform(j.latestValues))continue;hasScale(j.latestValues)&&j.updateSnapshot();const _e=createBox(),et=j.measurePageBox();copyBoxInto(_e,et),removeBoxTransforms(b,j.latestValues,j.snapshot?j.snapshot.layoutBox:void 0,_e)}return hasTransform(this.latestValues)&&removeBoxTransforms(b,this.latestValues),b}setTargetDelta(g){this.targetDelta=g,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(g){this.options={...this.options,...g,crossfade:g.crossfade!==void 0?g.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==frameData.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(g=!1){var tt;const b=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=b.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=b.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=b.isSharedProjectionDirty);const _=!!this.resumingFrom||this!==b;if(!(g||_&&this.isSharedProjectionDirty||this.isProjectionDirty||(tt=this.parent)!=null&&tt.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:_e,layoutId:et}=this.options;if(!(!this.layout||!(_e||et))){if(this.resolvedRelativeTargetAt=frameData.timestamp,!this.targetDelta&&!this.relativeTarget){const nt=this.getClosestProjectingParent();nt&&nt.layout&&this.animationProgress!==1?(this.relativeParent=nt,this.forceRelativeParentToResolveTarget(),this.relativeTarget=createBox(),this.relativeTargetOrigin=createBox(),calcRelativePosition(this.relativeTargetOrigin,this.layout.layoutBox,nt.layout.layoutBox),copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=createBox(),this.targetWithTransforms=createBox()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),calcRelativeBox(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):copyBoxInto(this.target,this.layout.layoutBox),applyBoxDelta(this.target,this.targetDelta)):copyBoxInto(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const nt=this.getClosestProjectingParent();nt&&!!nt.resumingFrom==!!this.resumingFrom&&!nt.options.layoutScroll&&nt.target&&this.animationProgress!==1?(this.relativeParent=nt,this.forceRelativeParentToResolveTarget(),this.relativeTarget=createBox(),this.relativeTargetOrigin=createBox(),calcRelativePosition(this.relativeTargetOrigin,this.target,nt.target),copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||hasScale(this.parent.latestValues)||has2DTranslate(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var at;const g=this.getLead(),b=!!this.resumingFrom||this!==g;let _=!0;if((this.isProjectionDirty||(at=this.parent)!=null&&at.isProjectionDirty)&&(_=!1),b&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(_=!1),this.resolvedRelativeTargetAt===frameData.timestamp&&(_=!1),_)return;const{layout:j,layoutId:_e}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(j||_e))return;copyBoxInto(this.layoutCorrected,this.layout.layoutBox);const et=this.treeScale.x,tt=this.treeScale.y;applyTreeDeltas(this.layoutCorrected,this.treeScale,this.path,b),g.layout&&!g.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(g.target=g.layout.layoutBox,g.targetWithTransforms=createBox());const{target:nt}=g;if(!nt){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(copyAxisDeltaInto(this.prevProjectionDelta.x,this.projectionDelta.x),copyAxisDeltaInto(this.prevProjectionDelta.y,this.projectionDelta.y)),calcBoxDelta(this.projectionDelta,this.layoutCorrected,nt,this.latestValues),(this.treeScale.x!==et||this.treeScale.y!==tt||!axisDeltaEquals(this.projectionDelta.x,this.prevProjectionDelta.x)||!axisDeltaEquals(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",nt))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(g=!0){var b;if((b=this.options.visualElement)==null||b.scheduleRender(),g){const _=this.getStack();_&&_.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=createDelta(),this.projectionDelta=createDelta(),this.projectionDeltaWithTransform=createDelta()}setAnimationOrigin(g,b=!1){const _=this.snapshot,j=_?_.latestValues:{},_e={...this.latestValues},et=createDelta();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!b;const tt=createBox(),nt=_?_.source:void 0,at=this.layout?this.layout.source:void 0,lt=nt!==at,mt=this.getStack(),ot=!mt||mt.members.length<=1,st=!!(lt&&!ot&&this.options.crossfade===!0&&!this.path.some(hasOpacityCrossfade));this.animationProgress=0;let ut;this.mixTargetDelta=pt=>{const gt=pt/1e3;mixAxisDelta(et.x,g.x,gt),mixAxisDelta(et.y,g.y,gt),this.setTargetDelta(et),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(calcRelativePosition(tt,this.layout.layoutBox,this.relativeParent.layout.layoutBox),mixBox(this.relativeTarget,this.relativeTargetOrigin,tt,gt),ut&&boxEquals(this.relativeTarget,ut)&&(this.isProjectionDirty=!1),ut||(ut=createBox()),copyBoxInto(ut,this.relativeTarget)),lt&&(this.animationValues=_e,mixValues(_e,j,this.latestValues,gt,st,ot)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=gt},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(g){var b,_,j;this.notifyListeners("animationStart"),(b=this.currentAnimation)==null||b.stop(),(j=(_=this.resumingFrom)==null?void 0:_.currentAnimation)==null||j.stop(),this.pendingAnimation&&(cancelFrame(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=frame.update(()=>{globalProjectionState.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=motionValue(0)),this.currentAnimation=animateSingleValue(this.motionValue,[0,1e3],{...g,velocity:0,isSync:!0,onUpdate:_e=>{this.mixTargetDelta(_e),g.onUpdate&&g.onUpdate(_e)},onStop:()=>{},onComplete:()=>{g.onComplete&&g.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const g=this.getStack();g&&g.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(animationTarget),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const g=this.getLead();let{targetWithTransforms:b,target:_,layout:j,latestValues:_e}=g;if(!(!b||!_||!j)){if(this!==g&&this.layout&&j&&shouldAnimatePositionOnly(this.options.animationType,this.layout.layoutBox,j.layoutBox)){_=this.target||createBox();const et=calcLength(this.layout.layoutBox.x);_.x.min=g.target.x.min,_.x.max=_.x.min+et;const tt=calcLength(this.layout.layoutBox.y);_.y.min=g.target.y.min,_.y.max=_.y.min+tt}copyBoxInto(b,_),transformBox(b,_e),calcBoxDelta(this.projectionDeltaWithTransform,this.layoutCorrected,b,_e)}}registerSharedNode(g,b){this.sharedNodes.has(g)||this.sharedNodes.set(g,new NodeStack),this.sharedNodes.get(g).add(b);const j=b.options.initialPromotionConfig;b.promote({transition:j?j.transition:void 0,preserveFollowOpacity:j&&j.shouldPreserveFollowOpacity?j.shouldPreserveFollowOpacity(b):void 0})}isLead(){const g=this.getStack();return g?g.lead===this:!0}getLead(){var b;const{layoutId:g}=this.options;return g?((b=this.getStack())==null?void 0:b.lead)||this:this}getPrevLead(){var b;const{layoutId:g}=this.options;return g?(b=this.getStack())==null?void 0:b.prevLead:void 0}getStack(){const{layoutId:g}=this.options;if(g)return this.root.sharedNodes.get(g)}promote({needsReset:g,transition:b,preserveFollowOpacity:_}={}){const j=this.getStack();j&&j.promote(this,_),g&&(this.projectionDelta=void 0,this.needsReset=!0),b&&this.setOptions({transition:b})}relegate(){const g=this.getStack();return g?g.relegate(this):!1}resetSkewAndRotation(){const{visualElement:g}=this.options;if(!g)return;let b=!1;const{latestValues:_}=g;if((_.z||_.rotate||_.rotateX||_.rotateY||_.rotateZ||_.skewX||_.skewY)&&(b=!0),!b)return;const j={};_.z&&resetDistortingTransform("z",g,j,this.animationValues);for(let _e=0;_e<transformAxes.length;_e++)resetDistortingTransform(`rotate${transformAxes[_e]}`,g,j,this.animationValues),resetDistortingTransform(`skew${transformAxes[_e]}`,g,j,this.animationValues);g.render();for(const _e in j)g.setStaticValue(_e,j[_e]),this.animationValues&&(this.animationValues[_e]=j[_e]);g.scheduleRender()}applyProjectionStyles(g,b){if(!this.instance||this.isSVG)return;if(!this.isVisible){g.visibility="hidden";return}const _=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,g.visibility="",g.opacity="",g.pointerEvents=resolveMotionValue(b==null?void 0:b.pointerEvents)||"",g.transform=_?_(this.latestValues,""):"none";return}const j=this.getLead();if(!this.projectionDelta||!this.layout||!j.target){this.options.layoutId&&(g.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,g.pointerEvents=resolveMotionValue(b==null?void 0:b.pointerEvents)||""),this.hasProjected&&!hasTransform(this.latestValues)&&(g.transform=_?_({},""):"none",this.hasProjected=!1);return}g.visibility="";const _e=j.animationValues||j.latestValues;this.applyTransformsToTarget();let et=buildProjectionTransform(this.projectionDeltaWithTransform,this.treeScale,_e);_&&(et=_(_e,et)),g.transform=et;const{x:tt,y:nt}=this.projectionDelta;g.transformOrigin=`${tt.origin*100}% ${nt.origin*100}% 0`,j.animationValues?g.opacity=j===this?_e.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:_e.opacityExit:g.opacity=j===this?_e.opacity!==void 0?_e.opacity:"":_e.opacityExit!==void 0?_e.opacityExit:0;for(const at in scaleCorrectors){if(_e[at]===void 0)continue;const{correct:lt,applyTo:mt,isCSSVariable:ot}=scaleCorrectors[at],st=et==="none"?_e[at]:lt(_e[at],j);if(mt){const ut=mt.length;for(let pt=0;pt<ut;pt++)g[mt[pt]]=st}else ot?this.options.visualElement.renderState.vars[at]=st:g[at]=st}this.options.layoutId&&(g.pointerEvents=j===this?resolveMotionValue(b==null?void 0:b.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(g=>{var b;return(b=g.currentAnimation)==null?void 0:b.stop()}),this.root.nodes.forEach(clearMeasurements),this.root.sharedNodes.clear()}}}function updateLayout(e){e.updateLayout()}function notifyLayoutUpdate(e){var o;const a=((o=e.resumeFrom)==null?void 0:o.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&a&&e.hasListeners("didUpdate")){const{layoutBox:c,measuredBox:d}=e.layout,{animationType:$}=e.options,g=a.source!==e.layout.source;$==="size"?eachAxis(et=>{const tt=g?a.measuredBox[et]:a.layoutBox[et],nt=calcLength(tt);tt.min=c[et].min,tt.max=tt.min+nt}):shouldAnimatePositionOnly($,a.layoutBox,c)&&eachAxis(et=>{const tt=g?a.measuredBox[et]:a.layoutBox[et],nt=calcLength(c[et]);tt.max=tt.min+nt,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[et].max=e.relativeTarget[et].min+nt)});const b=createDelta();calcBoxDelta(b,c,a.layoutBox);const _=createDelta();g?calcBoxDelta(_,e.applyTransform(d,!0),a.measuredBox):calcBoxDelta(_,c,a.layoutBox);const j=!isDeltaZero(b);let _e=!1;if(!e.resumeFrom){const et=e.getClosestProjectingParent();if(et&&!et.resumeFrom){const{snapshot:tt,layout:nt}=et;if(tt&&nt){const at=createBox();calcRelativePosition(at,a.layoutBox,tt.layoutBox);const lt=createBox();calcRelativePosition(lt,c,nt.layoutBox),boxEqualsRounded(at,lt)||(_e=!0),et.options.layoutRoot&&(e.relativeTarget=lt,e.relativeTargetOrigin=at,e.relativeParent=et)}}}e.notifyListeners("didUpdate",{layout:c,snapshot:a,delta:_,layoutDelta:b,hasLayoutChanged:j,hasRelativeLayoutChanged:_e})}else if(e.isLead()){const{onExitComplete:c}=e.options;c&&c()}e.options.transition=void 0}function propagateDirtyNodes(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function cleanDirtyNodes(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function clearSnapshot(e){e.clearSnapshot()}function clearMeasurements(e){e.clearMeasurements()}function clearIsLayoutDirty(e){e.isLayoutDirty=!1}function resetTransformStyle(e){const{visualElement:a}=e.options;a&&a.getProps().onBeforeLayoutMeasure&&a.notify("BeforeLayoutMeasure"),e.resetTransform()}function finishAnimation(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function resolveTargetDelta(e){e.resolveTargetDelta()}function calcProjection(e){e.calcProjection()}function resetSkewAndRotation(e){e.resetSkewAndRotation()}function removeLeadSnapshots(e){e.removeLeadSnapshot()}function mixAxisDelta(e,a,o){e.translate=mixNumber$1(a.translate,0,o),e.scale=mixNumber$1(a.scale,1,o),e.origin=a.origin,e.originPoint=a.originPoint}function mixAxis(e,a,o,c){e.min=mixNumber$1(a.min,o.min,c),e.max=mixNumber$1(a.max,o.max,c)}function mixBox(e,a,o,c){mixAxis(e.x,a.x,o.x,c),mixAxis(e.y,a.y,o.y,c)}function hasOpacityCrossfade(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const defaultLayoutTransition={duration:.45,ease:[.4,0,.1,1]},userAgentContains=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),roundPoint=userAgentContains("applewebkit/")&&!userAgentContains("chrome/")?Math.round:noop;function roundAxis(e){e.min=roundPoint(e.min),e.max=roundPoint(e.max)}function roundBox(e){roundAxis(e.x),roundAxis(e.y)}function shouldAnimatePositionOnly(e,a,o){return e==="position"||e==="preserve-aspect"&&!isNear(aspectRatio(a),aspectRatio(o),.2)}function checkNodeWasScrollRoot(e){var a;return e!==e.root&&((a=e.scroll)==null?void 0:a.wasRoot)}const DocumentProjectionNode=createProjectionNode({attachResizeListener:(e,a)=>addDomEvent(e,"resize",a),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),rootProjectionNode={current:void 0},HTMLProjectionNode=createProjectionNode({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!rootProjectionNode.current){const e=new DocumentProjectionNode({});e.mount(window),e.setOptions({layoutScroll:!0}),rootProjectionNode.current=e}return rootProjectionNode.current},resetTransform:(e,a)=>{e.style.transform=a!==void 0?a:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),drag={pan:{Feature:PanGesture},drag:{Feature:DragGesture,ProjectionNode:HTMLProjectionNode,MeasureLayout}};function handleHoverEvent(e,a,o){const{props:c}=e;e.animationState&&c.whileHover&&e.animationState.setActive("whileHover",o==="Start");const d="onHover"+o,$=c[d];$&&frame.postRender(()=>$(a,extractEventInfo(a)))}class HoverGesture extends Feature{mount(){const{current:a}=this.node;a&&(this.unmount=hover(a,(o,c)=>(handleHoverEvent(this.node,c,"Start"),d=>handleHoverEvent(this.node,d,"End"))))}unmount(){}}class FocusGesture extends Feature{constructor(){super(...arguments),this.isActive=!1}onFocus(){let a=!1;try{a=this.node.current.matches(":focus-visible")}catch{a=!0}!a||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=pipe(addDomEvent(this.node.current,"focus",()=>this.onFocus()),addDomEvent(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function handlePressEvent(e,a,o){const{props:c}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&c.whileTap&&e.animationState.setActive("whileTap",o==="Start");const d="onTap"+(o==="End"?"":o),$=c[d];$&&frame.postRender(()=>$(a,extractEventInfo(a)))}class PressGesture extends Feature{mount(){const{current:a}=this.node;a&&(this.unmount=press(a,(o,c)=>(handlePressEvent(this.node,c,"Start"),(d,{success:$})=>handlePressEvent(this.node,d,$?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const observerCallbacks=new WeakMap,observers=new WeakMap,fireObserverCallback=e=>{const a=observerCallbacks.get(e.target);a&&a(e)},fireAllObserverCallbacks=e=>{e.forEach(fireObserverCallback)};function initIntersectionObserver({root:e,...a}){const o=e||document;observers.has(o)||observers.set(o,{});const c=observers.get(o),d=JSON.stringify(a);return c[d]||(c[d]=new IntersectionObserver(fireAllObserverCallbacks,{root:e,...a})),c[d]}function observeIntersection(e,a,o){const c=initIntersectionObserver(a);return observerCallbacks.set(e,o),c.observe(e),()=>{observerCallbacks.delete(e),c.unobserve(e)}}const thresholdNames={some:0,all:1};class InViewFeature extends Feature{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:a={}}=this.node.getProps(),{root:o,margin:c,amount:d="some",once:$}=a,g={root:o?o.current:void 0,rootMargin:c,threshold:typeof d=="number"?d:thresholdNames[d]},b=_=>{const{isIntersecting:j}=_;if(this.isInView===j||(this.isInView=j,$&&!j&&this.hasEnteredView))return;j&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",j);const{onViewportEnter:_e,onViewportLeave:et}=this.node.getProps(),tt=j?_e:et;tt&&tt(_)};return observeIntersection(this.node.current,g,b)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:a,prevProps:o}=this.node;["amount","margin","root"].some(hasViewportOptionChanged(a,o))&&this.startObserver()}unmount(){}}function hasViewportOptionChanged({viewport:e={}},{viewport:a={}}={}){return o=>e[o]!==a[o]}const gestureAnimations={inView:{Feature:InViewFeature},tap:{Feature:PressGesture},focus:{Feature:FocusGesture},hover:{Feature:HoverGesture}},layout={layout:{ProjectionNode:HTMLProjectionNode,MeasureLayout}},featureBundle={...animations,...gestureAnimations,...drag,...layout},motion=createMotionProxy(featureBundle,createDomVisualElement);function stopAnimation(e){e.values.forEach(a=>a.stop())}function setVariants(e,a){[...a].reverse().forEach(c=>{const d=e.getVariant(c);d&&setTarget(e,d),e.variantChildren&&e.variantChildren.forEach($=>{setVariants($,a)})})}function setValues(e,a){if(Array.isArray(a))return setVariants(e,a);if(typeof a=="string")return setVariants(e,[a]);setTarget(e,a)}function animationControls(){const e=new Set,a={subscribe(o){return e.add(o),()=>void e.delete(o)},start(o,c){const d=[];return e.forEach($=>{d.push(animateVisualElement($,o,{transitionOverride:c}))}),Promise.all(d)},set(o){return e.forEach(c=>{setValues(c,o)})},stop(){e.forEach(o=>{stopAnimation(o)})},mount(){return()=>{a.stop()}}};return a}function useAnimationControls(){const e=useConstant(animationControls);return useIsomorphicLayoutEffect(e.mount,[]),e}const useAnimation=useAnimationControls;function composeEventHandlers(e,a,{checkForDefaultPrevented:o=!0}={}){return function(d){if(e==null||e(d),o===!1||!d.defaultPrevented)return a==null?void 0:a(d)}}function setRef$1(e,a){typeof e=="function"?e(a):e!=null&&(e.current=a)}function composeRefs$1(...e){return a=>e.forEach(o=>setRef$1(o,a))}function useComposedRefs(...e){return reactExports.useCallback(composeRefs$1(...e),e)}function createContextScope(e,a=[]){let o=[];function c($,g){const b=reactExports.createContext(g),_=o.length;o=[...o,g];const j=et=>{var ot;const{scope:tt,children:nt,...at}=et,lt=((ot=tt==null?void 0:tt[e])==null?void 0:ot[_])||b,mt=reactExports.useMemo(()=>at,Object.values(at));return jsxRuntimeExports.jsx(lt.Provider,{value:mt,children:nt})};j.displayName=$+"Provider";function _e(et,tt){var lt;const nt=((lt=tt==null?void 0:tt[e])==null?void 0:lt[_])||b,at=reactExports.useContext(nt);if(at)return at;if(g!==void 0)return g;throw new Error(`\`${et}\` must be used within \`${$}\``)}return[j,_e]}const d=()=>{const $=o.map(g=>reactExports.createContext(g));return function(b){const _=(b==null?void 0:b[e])||$;return reactExports.useMemo(()=>({[`__scope${e}`]:{...b,[e]:_}}),[b,_])}};return d.scopeName=e,[c,composeContextScopes(d,...a)]}function composeContextScopes(...e){const a=e[0];if(e.length===1)return a;const o=()=>{const c=e.map(d=>({useScope:d(),scopeName:d.scopeName}));return function($){const g=c.reduce((b,{useScope:_,scopeName:j})=>{const et=_($)[`__scope${j}`];return{...b,...et}},{});return reactExports.useMemo(()=>({[`__scope${a.scopeName}`]:g}),[g])}};return o.scopeName=a.scopeName,o}function useCallbackRef(e){const a=reactExports.useRef(e);return reactExports.useEffect(()=>{a.current=e}),reactExports.useMemo(()=>(...o)=>{var c;return(c=a.current)==null?void 0:c.call(a,...o)},[])}function useControllableState({prop:e,defaultProp:a,onChange:o=()=>{}}){const[c,d]=useUncontrolledState({defaultProp:a,onChange:o}),$=e!==void 0,g=$?e:c,b=useCallbackRef(o),_=reactExports.useCallback(j=>{if($){const et=typeof j=="function"?j(e):j;et!==e&&b(et)}else d(j)},[$,e,d,b]);return[g,_]}function useUncontrolledState({defaultProp:e,onChange:a}){const o=reactExports.useState(e),[c]=o,d=reactExports.useRef(c),$=useCallbackRef(a);return reactExports.useEffect(()=>{d.current!==c&&($(c),d.current=c)},[c,d,$]),o}function usePrevious(e){const a=reactExports.useRef({value:e,previous:e});return reactExports.useMemo(()=>(a.current.value!==e&&(a.current.previous=a.current.value,a.current.value=e),a.current.previous),[e])}var useLayoutEffect2=globalThis!=null&&globalThis.document?reactExports.useLayoutEffect:()=>{};function useSize(e){const[a,o]=reactExports.useState(void 0);return useLayoutEffect2(()=>{if(e){o({width:e.offsetWidth,height:e.offsetHeight});const c=new ResizeObserver(d=>{if(!Array.isArray(d)||!d.length)return;const $=d[0];let g,b;if("borderBoxSize"in $){const _=$.borderBoxSize,j=Array.isArray(_)?_[0]:_;g=j.inlineSize,b=j.blockSize}else g=e.offsetWidth,b=e.offsetHeight;o({width:g,height:b})});return c.observe(e,{box:"border-box"}),()=>c.unobserve(e)}else o(void 0)},[e]),a}var Slot$1=reactExports.forwardRef((e,a)=>{const{children:o,...c}=e,d=reactExports.Children.toArray(o),$=d.find(isSlottable$1);if($){const g=$.props.children,b=d.map(_=>_===$?reactExports.Children.count(g)>1?reactExports.Children.only(null):reactExports.isValidElement(g)?g.props.children:null:_);return jsxRuntimeExports.jsx(SlotClone,{...c,ref:a,children:reactExports.isValidElement(g)?reactExports.cloneElement(g,void 0,b):null})}return jsxRuntimeExports.jsx(SlotClone,{...c,ref:a,children:o})});Slot$1.displayName="Slot";var SlotClone=reactExports.forwardRef((e,a)=>{const{children:o,...c}=e;if(reactExports.isValidElement(o)){const d=getElementRef$1(o);return reactExports.cloneElement(o,{...mergeProps$1(c,o.props),ref:a?composeRefs$1(a,d):d})}return reactExports.Children.count(o)>1?reactExports.Children.only(null):null});SlotClone.displayName="SlotClone";var Slottable=({children:e})=>jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:e});function isSlottable$1(e){return reactExports.isValidElement(e)&&e.type===Slottable}function mergeProps$1(e,a){const o={...a};for(const c in a){const d=e[c],$=a[c];/^on[A-Z]/.test(c)?d&&$?o[c]=(...b)=>{$(...b),d(...b)}:d&&(o[c]=d):c==="style"?o[c]={...d,...$}:c==="className"&&(o[c]=[d,$].filter(Boolean).join(" "))}return{...e,...o}}function getElementRef$1(e){var c,d;let a=(c=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:c.get,o=a&&"isReactWarning"in a&&a.isReactWarning;return o?e.ref:(a=(d=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:d.get,o=a&&"isReactWarning"in a&&a.isReactWarning,o?e.props.ref:e.props.ref||e.ref)}var NODES=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Primitive=NODES.reduce((e,a)=>{const o=reactExports.forwardRef((c,d)=>{const{asChild:$,...g}=c,b=$?Slot$1:a;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),jsxRuntimeExports.jsx(b,{...g,ref:d})});return o.displayName=`Primitive.${a}`,{...e,[a]:o}},{}),SWITCH_NAME="Switch",[createSwitchContext,createSwitchScope]=createContextScope(SWITCH_NAME),[SwitchProvider,useSwitchContext]=createSwitchContext(SWITCH_NAME),Switch$1=reactExports.forwardRef((e,a)=>{const{__scopeSwitch:o,name:c,checked:d,defaultChecked:$,required:g,disabled:b,value:_="on",onCheckedChange:j,form:_e,...et}=e,[tt,nt]=reactExports.useState(null),at=useComposedRefs(a,ut=>nt(ut)),lt=reactExports.useRef(!1),mt=tt?_e||!!tt.closest("form"):!0,[ot=!1,st]=useControllableState({prop:d,defaultProp:$,onChange:j});return jsxRuntimeExports.jsxs(SwitchProvider,{scope:o,checked:ot,disabled:b,children:[jsxRuntimeExports.jsx(Primitive.button,{type:"button",role:"switch","aria-checked":ot,"aria-required":g,"data-state":getState(ot),"data-disabled":b?"":void 0,disabled:b,value:_,...et,ref:at,onClick:composeEventHandlers(e.onClick,ut=>{st(pt=>!pt),mt&&(lt.current=ut.isPropagationStopped(),lt.current||ut.stopPropagation())})}),mt&&jsxRuntimeExports.jsx(BubbleInput,{control:tt,bubbles:!lt.current,name:c,value:_,checked:ot,required:g,disabled:b,form:_e,style:{transform:"translateX(-100%)"}})]})});Switch$1.displayName=SWITCH_NAME;var THUMB_NAME="SwitchThumb",SwitchThumb=reactExports.forwardRef((e,a)=>{const{__scopeSwitch:o,...c}=e,d=useSwitchContext(THUMB_NAME,o);return jsxRuntimeExports.jsx(Primitive.span,{"data-state":getState(d.checked),"data-disabled":d.disabled?"":void 0,...c,ref:a})});SwitchThumb.displayName=THUMB_NAME;var BubbleInput=e=>{const{control:a,checked:o,bubbles:c=!0,...d}=e,$=reactExports.useRef(null),g=usePrevious(o),b=useSize(a);return reactExports.useEffect(()=>{const _=$.current,j=window.HTMLInputElement.prototype,et=Object.getOwnPropertyDescriptor(j,"checked").set;if(g!==o&&et){const tt=new Event("click",{bubbles:c});et.call(_,o),_.dispatchEvent(tt)}},[g,o,c]),jsxRuntimeExports.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:o,...d,tabIndex:-1,ref:$,style:{...e.style,...b,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function getState(e){return e?"checked":"unchecked"}var Root=Switch$1;function r(e){var a,o,c="";if(typeof e=="string"||typeof e=="number")c+=e;else if(typeof e=="object")if(Array.isArray(e)){var d=e.length;for(a=0;a<d;a++)e[a]&&(o=r(e[a]))&&(c&&(c+=" "),c+=o)}else for(o in e)e[o]&&(c&&(c+=" "),c+=o);return c}function clsx(){for(var e,a,o=0,c="",d=arguments.length;o<d;o++)(e=arguments[o])&&(a=r(e))&&(c&&(c+=" "),c+=a);return c}const CLASS_PART_SEPARATOR="-",createClassGroupUtils=e=>{const a=createClassMap(e),{conflictingClassGroups:o,conflictingClassGroupModifiers:c}=e;return{getClassGroupId:g=>{const b=g.split(CLASS_PART_SEPARATOR);return b[0]===""&&b.length!==1&&b.shift(),getGroupRecursive(b,a)||getGroupIdForArbitraryProperty(g)},getConflictingClassGroupIds:(g,b)=>{const _=o[g]||[];return b&&c[g]?[..._,...c[g]]:_}}},getGroupRecursive=(e,a)=>{var g;if(e.length===0)return a.classGroupId;const o=e[0],c=a.nextPart.get(o),d=c?getGroupRecursive(e.slice(1),c):void 0;if(d)return d;if(a.validators.length===0)return;const $=e.join(CLASS_PART_SEPARATOR);return(g=a.validators.find(({validator:b})=>b($)))==null?void 0:g.classGroupId},arbitraryPropertyRegex=/^\[(.+)\]$/,getGroupIdForArbitraryProperty=e=>{if(arbitraryPropertyRegex.test(e)){const a=arbitraryPropertyRegex.exec(e)[1],o=a==null?void 0:a.substring(0,a.indexOf(":"));if(o)return"arbitrary.."+o}},createClassMap=e=>{const{theme:a,prefix:o}=e,c={nextPart:new Map,validators:[]};return getPrefixedClassGroupEntries(Object.entries(e.classGroups),o).forEach(([$,g])=>{processClassesRecursively(g,c,$,a)}),c},processClassesRecursively=(e,a,o,c)=>{e.forEach(d=>{if(typeof d=="string"){const $=d===""?a:getPart(a,d);$.classGroupId=o;return}if(typeof d=="function"){if(isThemeGetter(d)){processClassesRecursively(d(c),a,o,c);return}a.validators.push({validator:d,classGroupId:o});return}Object.entries(d).forEach(([$,g])=>{processClassesRecursively(g,getPart(a,$),o,c)})})},getPart=(e,a)=>{let o=e;return a.split(CLASS_PART_SEPARATOR).forEach(c=>{o.nextPart.has(c)||o.nextPart.set(c,{nextPart:new Map,validators:[]}),o=o.nextPart.get(c)}),o},isThemeGetter=e=>e.isThemeGetter,getPrefixedClassGroupEntries=(e,a)=>a?e.map(([o,c])=>{const d=c.map($=>typeof $=="string"?a+$:typeof $=="object"?Object.fromEntries(Object.entries($).map(([g,b])=>[a+g,b])):$);return[o,d]}):e,createLruCache=e=>{if(e<1)return{get:()=>{},set:()=>{}};let a=0,o=new Map,c=new Map;const d=($,g)=>{o.set($,g),a++,a>e&&(a=0,c=o,o=new Map)};return{get($){let g=o.get($);if(g!==void 0)return g;if((g=c.get($))!==void 0)return d($,g),g},set($,g){o.has($)?o.set($,g):d($,g)}}},IMPORTANT_MODIFIER="!",createParseClassName=e=>{const{separator:a,experimentalParseClassName:o}=e,c=a.length===1,d=a[0],$=a.length,g=b=>{const _=[];let j=0,_e=0,et;for(let mt=0;mt<b.length;mt++){let ot=b[mt];if(j===0){if(ot===d&&(c||b.slice(mt,mt+$)===a)){_.push(b.slice(_e,mt)),_e=mt+$;continue}if(ot==="/"){et=mt;continue}}ot==="["?j++:ot==="]"&&j--}const tt=_.length===0?b:b.substring(_e),nt=tt.startsWith(IMPORTANT_MODIFIER),at=nt?tt.substring(1):tt,lt=et&&et>_e?et-_e:void 0;return{modifiers:_,hasImportantModifier:nt,baseClassName:at,maybePostfixModifierPosition:lt}};return o?b=>o({className:b,parseClassName:g}):g},sortModifiers=e=>{if(e.length<=1)return e;const a=[];let o=[];return e.forEach(c=>{c[0]==="["?(a.push(...o.sort(),c),o=[]):o.push(c)}),a.push(...o.sort()),a},createConfigUtils=e=>({cache:createLruCache(e.cacheSize),parseClassName:createParseClassName(e),...createClassGroupUtils(e)}),SPLIT_CLASSES_REGEX=/\s+/,mergeClassList=(e,a)=>{const{parseClassName:o,getClassGroupId:c,getConflictingClassGroupIds:d}=a,$=[],g=e.trim().split(SPLIT_CLASSES_REGEX);let b="";for(let _=g.length-1;_>=0;_-=1){const j=g[_],{modifiers:_e,hasImportantModifier:et,baseClassName:tt,maybePostfixModifierPosition:nt}=o(j);let at=!!nt,lt=c(at?tt.substring(0,nt):tt);if(!lt){if(!at){b=j+(b.length>0?" "+b:b);continue}if(lt=c(tt),!lt){b=j+(b.length>0?" "+b:b);continue}at=!1}const mt=sortModifiers(_e).join(":"),ot=et?mt+IMPORTANT_MODIFIER:mt,st=ot+lt;if($.includes(st))continue;$.push(st);const ut=d(lt,at);for(let pt=0;pt<ut.length;++pt){const gt=ut[pt];$.push(ot+gt)}b=j+(b.length>0?" "+b:b)}return b};function twJoin(){let e=0,a,o,c="";for(;e<arguments.length;)(a=arguments[e++])&&(o=toValue(a))&&(c&&(c+=" "),c+=o);return c}const toValue=e=>{if(typeof e=="string")return e;let a,o="";for(let c=0;c<e.length;c++)e[c]&&(a=toValue(e[c]))&&(o&&(o+=" "),o+=a);return o};function createTailwindMerge(e,...a){let o,c,d,$=g;function g(_){const j=a.reduce((_e,et)=>et(_e),e());return o=createConfigUtils(j),c=o.cache.get,d=o.cache.set,$=b,b(_)}function b(_){const j=c(_);if(j)return j;const _e=mergeClassList(_,o);return d(_,_e),_e}return function(){return $(twJoin.apply(null,arguments))}}const fromTheme=e=>{const a=o=>o[e]||[];return a.isThemeGetter=!0,a},arbitraryValueRegex=/^\[(?:([a-z-]+):)?(.+)\]$/i,fractionRegex=/^\d+\/\d+$/,stringLengths=new Set(["px","full","screen"]),tshirtUnitRegex=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,lengthUnitRegex=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,colorFunctionRegex=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,shadowRegex=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,imageRegex=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,isLength=e=>isNumber(e)||stringLengths.has(e)||fractionRegex.test(e),isArbitraryLength=e=>getIsArbitraryValue(e,"length",isLengthOnly),isNumber=e=>!!e&&!Number.isNaN(Number(e)),isArbitraryNumber=e=>getIsArbitraryValue(e,"number",isNumber),isInteger$1=e=>!!e&&Number.isInteger(Number(e)),isPercent=e=>e.endsWith("%")&&isNumber(e.slice(0,-1)),isArbitraryValue=e=>arbitraryValueRegex.test(e),isTshirtSize=e=>tshirtUnitRegex.test(e),sizeLabels=new Set(["length","size","percentage"]),isArbitrarySize=e=>getIsArbitraryValue(e,sizeLabels,isNever),isArbitraryPosition=e=>getIsArbitraryValue(e,"position",isNever),imageLabels=new Set(["image","url"]),isArbitraryImage=e=>getIsArbitraryValue(e,imageLabels,isImage),isArbitraryShadow=e=>getIsArbitraryValue(e,"",isShadow),isAny=()=>!0,getIsArbitraryValue=(e,a,o)=>{const c=arbitraryValueRegex.exec(e);return c?c[1]?typeof a=="string"?c[1]===a:a.has(c[1]):o(c[2]):!1},isLengthOnly=e=>lengthUnitRegex.test(e)&&!colorFunctionRegex.test(e),isNever=()=>!1,isShadow=e=>shadowRegex.test(e),isImage=e=>imageRegex.test(e),getDefaultConfig=()=>{const e=fromTheme("colors"),a=fromTheme("spacing"),o=fromTheme("blur"),c=fromTheme("brightness"),d=fromTheme("borderColor"),$=fromTheme("borderRadius"),g=fromTheme("borderSpacing"),b=fromTheme("borderWidth"),_=fromTheme("contrast"),j=fromTheme("grayscale"),_e=fromTheme("hueRotate"),et=fromTheme("invert"),tt=fromTheme("gap"),nt=fromTheme("gradientColorStops"),at=fromTheme("gradientColorStopPositions"),lt=fromTheme("inset"),mt=fromTheme("margin"),ot=fromTheme("opacity"),st=fromTheme("padding"),ut=fromTheme("saturate"),pt=fromTheme("scale"),gt=fromTheme("sepia"),ft=fromTheme("skew"),yt=fromTheme("space"),_t=fromTheme("translate"),vt=()=>["auto","contain","none"],Pt=()=>["auto","hidden","clip","visible","scroll"],Tt=()=>["auto",isArbitraryValue,a],St=()=>[isArbitraryValue,a],qt=()=>["",isLength,isArbitraryLength],Ft=()=>["auto",isNumber,isArbitraryValue],Dt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],zt=()=>["solid","dashed","dotted","double","none"],Nt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Et=()=>["start","end","center","between","around","evenly","stretch"],At=()=>["","0",isArbitraryValue],dt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Mt=()=>[isNumber,isArbitraryValue];return{cacheSize:500,separator:":",theme:{colors:[isAny],spacing:[isLength,isArbitraryLength],blur:["none","",isTshirtSize,isArbitraryValue],brightness:Mt(),borderColor:[e],borderRadius:["none","","full",isTshirtSize,isArbitraryValue],borderSpacing:St(),borderWidth:qt(),contrast:Mt(),grayscale:At(),hueRotate:Mt(),invert:At(),gap:St(),gradientColorStops:[e],gradientColorStopPositions:[isPercent,isArbitraryLength],inset:Tt(),margin:Tt(),opacity:Mt(),padding:St(),saturate:Mt(),scale:Mt(),sepia:At(),skew:Mt(),space:St(),translate:St()},classGroups:{aspect:[{aspect:["auto","square","video",isArbitraryValue]}],container:["container"],columns:[{columns:[isTshirtSize]}],"break-after":[{"break-after":dt()}],"break-before":[{"break-before":dt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Dt(),isArbitraryValue]}],overflow:[{overflow:Pt()}],"overflow-x":[{"overflow-x":Pt()}],"overflow-y":[{"overflow-y":Pt()}],overscroll:[{overscroll:vt()}],"overscroll-x":[{"overscroll-x":vt()}],"overscroll-y":[{"overscroll-y":vt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[lt]}],"inset-x":[{"inset-x":[lt]}],"inset-y":[{"inset-y":[lt]}],start:[{start:[lt]}],end:[{end:[lt]}],top:[{top:[lt]}],right:[{right:[lt]}],bottom:[{bottom:[lt]}],left:[{left:[lt]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",isInteger$1,isArbitraryValue]}],basis:[{basis:Tt()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",isArbitraryValue]}],grow:[{grow:At()}],shrink:[{shrink:At()}],order:[{order:["first","last","none",isInteger$1,isArbitraryValue]}],"grid-cols":[{"grid-cols":[isAny]}],"col-start-end":[{col:["auto",{span:["full",isInteger$1,isArbitraryValue]},isArbitraryValue]}],"col-start":[{"col-start":Ft()}],"col-end":[{"col-end":Ft()}],"grid-rows":[{"grid-rows":[isAny]}],"row-start-end":[{row:["auto",{span:[isInteger$1,isArbitraryValue]},isArbitraryValue]}],"row-start":[{"row-start":Ft()}],"row-end":[{"row-end":Ft()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",isArbitraryValue]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",isArbitraryValue]}],gap:[{gap:[tt]}],"gap-x":[{"gap-x":[tt]}],"gap-y":[{"gap-y":[tt]}],"justify-content":[{justify:["normal",...Et()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Et(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Et(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[st]}],px:[{px:[st]}],py:[{py:[st]}],ps:[{ps:[st]}],pe:[{pe:[st]}],pt:[{pt:[st]}],pr:[{pr:[st]}],pb:[{pb:[st]}],pl:[{pl:[st]}],m:[{m:[mt]}],mx:[{mx:[mt]}],my:[{my:[mt]}],ms:[{ms:[mt]}],me:[{me:[mt]}],mt:[{mt:[mt]}],mr:[{mr:[mt]}],mb:[{mb:[mt]}],ml:[{ml:[mt]}],"space-x":[{"space-x":[yt]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[yt]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",isArbitraryValue,a]}],"min-w":[{"min-w":[isArbitraryValue,a,"min","max","fit"]}],"max-w":[{"max-w":[isArbitraryValue,a,"none","full","min","max","fit","prose",{screen:[isTshirtSize]},isTshirtSize]}],h:[{h:[isArbitraryValue,a,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[isArbitraryValue,a,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[isArbitraryValue,a,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[isArbitraryValue,a,"auto","min","max","fit"]}],"font-size":[{text:["base",isTshirtSize,isArbitraryLength]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",isArbitraryNumber]}],"font-family":[{font:[isAny]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",isArbitraryValue]}],"line-clamp":[{"line-clamp":["none",isNumber,isArbitraryNumber]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",isLength,isArbitraryValue]}],"list-image":[{"list-image":["none",isArbitraryValue]}],"list-style-type":[{list:["none","disc","decimal",isArbitraryValue]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[ot]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[ot]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...zt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",isLength,isArbitraryLength]}],"underline-offset":[{"underline-offset":["auto",isLength,isArbitraryValue]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:St()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",isArbitraryValue]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",isArbitraryValue]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[ot]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Dt(),isArbitraryPosition]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",isArbitrarySize]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},isArbitraryImage]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[at]}],"gradient-via-pos":[{via:[at]}],"gradient-to-pos":[{to:[at]}],"gradient-from":[{from:[nt]}],"gradient-via":[{via:[nt]}],"gradient-to":[{to:[nt]}],rounded:[{rounded:[$]}],"rounded-s":[{"rounded-s":[$]}],"rounded-e":[{"rounded-e":[$]}],"rounded-t":[{"rounded-t":[$]}],"rounded-r":[{"rounded-r":[$]}],"rounded-b":[{"rounded-b":[$]}],"rounded-l":[{"rounded-l":[$]}],"rounded-ss":[{"rounded-ss":[$]}],"rounded-se":[{"rounded-se":[$]}],"rounded-ee":[{"rounded-ee":[$]}],"rounded-es":[{"rounded-es":[$]}],"rounded-tl":[{"rounded-tl":[$]}],"rounded-tr":[{"rounded-tr":[$]}],"rounded-br":[{"rounded-br":[$]}],"rounded-bl":[{"rounded-bl":[$]}],"border-w":[{border:[b]}],"border-w-x":[{"border-x":[b]}],"border-w-y":[{"border-y":[b]}],"border-w-s":[{"border-s":[b]}],"border-w-e":[{"border-e":[b]}],"border-w-t":[{"border-t":[b]}],"border-w-r":[{"border-r":[b]}],"border-w-b":[{"border-b":[b]}],"border-w-l":[{"border-l":[b]}],"border-opacity":[{"border-opacity":[ot]}],"border-style":[{border:[...zt(),"hidden"]}],"divide-x":[{"divide-x":[b]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[b]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[ot]}],"divide-style":[{divide:zt()}],"border-color":[{border:[d]}],"border-color-x":[{"border-x":[d]}],"border-color-y":[{"border-y":[d]}],"border-color-s":[{"border-s":[d]}],"border-color-e":[{"border-e":[d]}],"border-color-t":[{"border-t":[d]}],"border-color-r":[{"border-r":[d]}],"border-color-b":[{"border-b":[d]}],"border-color-l":[{"border-l":[d]}],"divide-color":[{divide:[d]}],"outline-style":[{outline:["",...zt()]}],"outline-offset":[{"outline-offset":[isLength,isArbitraryValue]}],"outline-w":[{outline:[isLength,isArbitraryLength]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:qt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[ot]}],"ring-offset-w":[{"ring-offset":[isLength,isArbitraryLength]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",isTshirtSize,isArbitraryShadow]}],"shadow-color":[{shadow:[isAny]}],opacity:[{opacity:[ot]}],"mix-blend":[{"mix-blend":[...Nt(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Nt()}],filter:[{filter:["","none"]}],blur:[{blur:[o]}],brightness:[{brightness:[c]}],contrast:[{contrast:[_]}],"drop-shadow":[{"drop-shadow":["","none",isTshirtSize,isArbitraryValue]}],grayscale:[{grayscale:[j]}],"hue-rotate":[{"hue-rotate":[_e]}],invert:[{invert:[et]}],saturate:[{saturate:[ut]}],sepia:[{sepia:[gt]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[o]}],"backdrop-brightness":[{"backdrop-brightness":[c]}],"backdrop-contrast":[{"backdrop-contrast":[_]}],"backdrop-grayscale":[{"backdrop-grayscale":[j]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[_e]}],"backdrop-invert":[{"backdrop-invert":[et]}],"backdrop-opacity":[{"backdrop-opacity":[ot]}],"backdrop-saturate":[{"backdrop-saturate":[ut]}],"backdrop-sepia":[{"backdrop-sepia":[gt]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[g]}],"border-spacing-x":[{"border-spacing-x":[g]}],"border-spacing-y":[{"border-spacing-y":[g]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",isArbitraryValue]}],duration:[{duration:Mt()}],ease:[{ease:["linear","in","out","in-out",isArbitraryValue]}],delay:[{delay:Mt()}],animate:[{animate:["none","spin","ping","pulse","bounce",isArbitraryValue]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[pt]}],"scale-x":[{"scale-x":[pt]}],"scale-y":[{"scale-y":[pt]}],rotate:[{rotate:[isInteger$1,isArbitraryValue]}],"translate-x":[{"translate-x":[_t]}],"translate-y":[{"translate-y":[_t]}],"skew-x":[{"skew-x":[ft]}],"skew-y":[{"skew-y":[ft]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",isArbitraryValue]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",isArbitraryValue]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":St()}],"scroll-mx":[{"scroll-mx":St()}],"scroll-my":[{"scroll-my":St()}],"scroll-ms":[{"scroll-ms":St()}],"scroll-me":[{"scroll-me":St()}],"scroll-mt":[{"scroll-mt":St()}],"scroll-mr":[{"scroll-mr":St()}],"scroll-mb":[{"scroll-mb":St()}],"scroll-ml":[{"scroll-ml":St()}],"scroll-p":[{"scroll-p":St()}],"scroll-px":[{"scroll-px":St()}],"scroll-py":[{"scroll-py":St()}],"scroll-ps":[{"scroll-ps":St()}],"scroll-pe":[{"scroll-pe":St()}],"scroll-pt":[{"scroll-pt":St()}],"scroll-pr":[{"scroll-pr":St()}],"scroll-pb":[{"scroll-pb":St()}],"scroll-pl":[{"scroll-pl":St()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",isArbitraryValue]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[isLength,isArbitraryLength,isArbitraryNumber]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},twMerge=createTailwindMerge(getDefaultConfig);function cn(...e){return twMerge(clsx(e))}const Switch=reactExports.forwardRef(({className:e,...a},o)=>jsxRuntimeExports.jsx(Root,{ref:o,className:cn("relative inline-flex h-[24px] w-[44px] cursor-pointer rounded-full transition-colors duration-200 ease-in-out","focus:outline-none focus-visible:ring focus-visible:ring-sky-500 focus-visible:ring-opacity-75","bg-sky-900","data-[state=checked]:bg-sky-600",e),...a}));Switch.displayName=Root.displayName;const FontToggleContext=reactExports.createContext(void 0),FontToggleProvider=({children:e})=>{const[a,o]=reactExports.useState(!1);return jsxRuntimeExports.jsx(FontToggleContext.Provider,{value:{fontToggle:a,setFontToggle:o},children:e})},useFontToggle=()=>{const e=reactExports.useContext(FontToggleContext);if(!e)throw new Error("useFontToggle must be used within a FontToggleProvider");return e},MotionRouterLink=motion(Link),Navbar=()=>{const{fontToggle:e,setFontToggle:a}=useFontToggle(),o=useAnimation(),c={hidden:{opacity:0,scale:.95},visible:{opacity:1,scale:1,transition:{staggerChildren:.1,delayChildren:.2,when:"beforeChildren"}}},d={hidden:{x:-100,opacity:0,scale:.8},visible:{x:0,opacity:1,scale:1,transition:{type:"spring",stiffness:100,damping:10,duration:.5}},hover:{scale:1.05,transition:{duration:.2}}},$={rest:{width:0},hover:{width:"100%",transition:{type:"spring",bounce:.25,stiffness:130,damping:9,duration:.3}}};return React.useEffect(()=>{window.document.documentElement.classList.toggle("alt-font",e),o.start("visible")},[e,o]),jsxRuntimeExports.jsx("nav",{className:"bg-sky-100 shadow-lg",children:jsxRuntimeExports.jsxs("div",{className:"container mx-auto px-4 h-16 flex items-center justify-between",children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:jsxRuntimeExports.jsxs(Link,{to:"/",className:"text-xl font-bold text-sky-900 hover:text-sky-600 relative",children:[jsxRuntimeExports.jsx("span",{className:"relative z-10",children:"Luna"}),jsxRuntimeExports.jsx(motion.span,{className:"absolute bottom-0 left-0 h-full bg-gradient-to-r from-blue-900 to-purple-600 -z-10 rounded-md",initial:{width:0},whileHover:{width:"100%"},transition:{type:"spring",bounce:.25,stiffness:130,damping:9}})]})}),jsxRuntimeExports.jsxs(motion.div,{variants:c,initial:"hidden",animate:o,className:"flex items-center gap-6",children:[jsxRuntimeExports.jsx(motion.div,{whileHover:{scale:1.1},whileTap:{scale:.95},children:jsxRuntimeExports.jsx(Switch,{checked:e,onCheckedChange:a})}),["Warp","World","About"].map(g=>jsxRuntimeExports.jsxs(MotionRouterLink,{to:`/${g.toLowerCase()}`,variants:d,className:"font-semibold text-sky-900 hover:text-sky-600 px-2 py-1 relative overflow-hidden",whileHover:"hover",children:[jsxRuntimeExports.jsx("span",{className:"relative z-10",children:g}),jsxRuntimeExports.jsx(motion.span,{className:"absolute bottom-0 left-0 h-full bg-gradient-to-r from-blue-900/20 to-purple-600/20 -z-10 rounded-md",variants:$,initial:"rest",whileHover:"hover"})]},g))]})]})})},Footer=()=>jsxRuntimeExports.jsx("footer",{className:"bg-sky-100 shadow mt-10",children:jsxRuntimeExports.jsx("div",{className:"container mx-auto px-4 h-16 flex items-center justify-center",children:jsxRuntimeExports.jsx("p",{className:"text-sky-800",children:"All original information in this website follow CC BY-SA 3.0 Unported creative commons license."})})});function setRef(e,a){if(typeof e=="function")return e(a);e!=null&&(e.current=a)}function composeRefs(...e){return a=>{let o=!1;const c=e.map(d=>{const $=setRef(d,a);return!o&&typeof $=="function"&&(o=!0),$});if(o)return()=>{for(let d=0;d<c.length;d++){const $=c[d];typeof $=="function"?$():setRef(e[d],null)}}}}function createSlot(e){const a=createSlotClone(e),o=reactExports.forwardRef((c,d)=>{const{children:$,...g}=c,b=reactExports.Children.toArray($),_=b.find(isSlottable);if(_){const j=_.props.children,_e=b.map(et=>et===_?reactExports.Children.count(j)>1?reactExports.Children.only(null):reactExports.isValidElement(j)?j.props.children:null:et);return jsxRuntimeExports.jsx(a,{...g,ref:d,children:reactExports.isValidElement(j)?reactExports.cloneElement(j,void 0,_e):null})}return jsxRuntimeExports.jsx(a,{...g,ref:d,children:$})});return o.displayName=`${e}.Slot`,o}var Slot=createSlot("Slot");function createSlotClone(e){const a=reactExports.forwardRef((o,c)=>{const{children:d,...$}=o;if(reactExports.isValidElement(d)){const g=getElementRef(d),b=mergeProps($,d.props);return d.type!==reactExports.Fragment&&(b.ref=c?composeRefs(c,g):g),reactExports.cloneElement(d,b)}return reactExports.Children.count(d)>1?reactExports.Children.only(null):null});return a.displayName=`${e}.SlotClone`,a}var SLOTTABLE_IDENTIFIER=Symbol("radix.slottable");function isSlottable(e){return reactExports.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===SLOTTABLE_IDENTIFIER}function mergeProps(e,a){const o={...a};for(const c in a){const d=e[c],$=a[c];/^on[A-Z]/.test(c)?d&&$?o[c]=(...b)=>{const _=$(...b);return d(...b),_}:d&&(o[c]=d):c==="style"?o[c]={...d,...$}:c==="className"&&(o[c]=[d,$].filter(Boolean).join(" "))}return{...e,...o}}function getElementRef(e){var c,d;let a=(c=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:c.get,o=a&&"isReactWarning"in a&&a.isReactWarning;return o?e.ref:(a=(d=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:d.get,o=a&&"isReactWarning"in a&&a.isReactWarning,o?e.props.ref:e.props.ref||e.ref)}const falsyToString=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,cx=clsx,cva=(e,a)=>o=>{var c;if((a==null?void 0:a.variants)==null)return cx(e,o==null?void 0:o.class,o==null?void 0:o.className);const{variants:d,defaultVariants:$}=a,g=Object.keys(d).map(j=>{const _e=o==null?void 0:o[j],et=$==null?void 0:$[j];if(_e===null)return null;const tt=falsyToString(_e)||falsyToString(et);return d[j][tt]}),b=o&&Object.entries(o).reduce((j,_e)=>{let[et,tt]=_e;return tt===void 0||(j[et]=tt),j},{}),_=a==null||(c=a.compoundVariants)===null||c===void 0?void 0:c.reduce((j,_e)=>{let{class:et,className:tt,...nt}=_e;return Object.entries(nt).every(at=>{let[lt,mt]=at;return Array.isArray(mt)?mt.includes({...$,...b}[lt]):{...$,...b}[lt]===mt})?[...j,et,tt]:j},[]);return cx(e,g,_,o==null?void 0:o.class,o==null?void 0:o.className)},buttonVariants=cva("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),Button=reactExports.forwardRef(({className:e,variant:a,size:o,asChild:c=!1,...d},$)=>{const g=c?Slot:"button";return jsxRuntimeExports.jsx(g,{className:cn(buttonVariants({variant:a,size:o,className:e})),ref:$,...d})});Button.displayName="Button";const BlogPost=({post:e})=>jsxRuntimeExports.jsxs("div",{className:"bg-sky-100 rounded-lg shadow p-6 mb-6 mx-16",children:[jsxRuntimeExports.jsx("h2",{className:`font-semibold text-sky-900
      text-xl
      sm:text-xl
      lg:text-2xl
      `,children:e.title}),jsxRuntimeExports.jsxs("div",{className:`text-sky-900 mb-4
      text-xs
      sm:text-xs
      lg:text-sm
      `,children:[e.date," • ",e.author]}),jsxRuntimeExports.jsx("p",{className:`text-sky-900 mb-4
      text-sm
      sm:text-sm
      lg:text-base
      `,children:e.excerpt}),jsxRuntimeExports.jsx(Link,{to:`/posts/${e.contentKey}`,children:jsxRuntimeExports.jsx(Button,{variant:"default",className:`font-semibold bg-sky-900 text-sky-100 hover:bg-sky-600 focus:outline-none
        text-sm
        sm:text-sm
        lg:text-base
        `,children:"Detail"})})]});/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const toKebabCase=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),mergeClasses=(...e)=>e.filter((a,o,c)=>!!a&&a.trim()!==""&&c.indexOf(a)===o).join(" ").trim();/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Icon=reactExports.forwardRef(({color:e="currentColor",size:a=24,strokeWidth:o=2,absoluteStrokeWidth:c,className:d="",children:$,iconNode:g,...b},_)=>reactExports.createElement("svg",{ref:_,...defaultAttributes,width:a,height:a,stroke:e,strokeWidth:c?Number(o)*24/Number(a):o,className:mergeClasses("lucide",d),...b},[...g.map(([j,_e])=>reactExports.createElement(j,_e)),...Array.isArray($)?$:[$]]));/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const createLucideIcon=(e,a)=>{const o=reactExports.forwardRef(({className:c,...d},$)=>reactExports.createElement(Icon,{ref:$,iconNode:a,className:mergeClasses(`lucide-${toKebabCase(e)}`,c),...d}));return o.displayName=`${e}`,o};/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronLeft=createLucideIcon("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronRight=createLucideIcon("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Menu=createLucideIcon("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=createLucideIcon("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Pagination=({className:e,...a})=>jsxRuntimeExports.jsx("nav",{role:"navigation","aria-label":"pagination",className:cn("mx-auto flex w-full justify-center",e),...a});Pagination.displayName="Pagination";const PaginationContent=reactExports.forwardRef(({className:e,...a},o)=>jsxRuntimeExports.jsx("ul",{ref:o,className:cn("flex flex-row items-center gap-1",e),...a}));PaginationContent.displayName="PaginationContent";const PaginationItem=reactExports.forwardRef(({className:e,...a},o)=>jsxRuntimeExports.jsx("li",{ref:o,className:cn("",e),...a}));PaginationItem.displayName="PaginationItem";const PaginationLink=({className:e,isActive:a,size:o="icon",...c})=>jsxRuntimeExports.jsx("a",{"aria-current":a?"page":void 0,className:cn(buttonVariants({variant:a?"outline":"ghost",size:o}),e),...c});PaginationLink.displayName="PaginationLink";const PaginationPrevious=({className:e,...a})=>jsxRuntimeExports.jsxs(PaginationLink,{"aria-label":"Go to previous page",size:"default",className:cn("gap-1 pl-2.5",e),...a,children:[jsxRuntimeExports.jsx(ChevronLeft,{className:"h-4 w-4"}),jsxRuntimeExports.jsx("span",{children:"Previous"})]});PaginationPrevious.displayName="PaginationPrevious";const PaginationNext=({className:e,...a})=>jsxRuntimeExports.jsxs(PaginationLink,{"aria-label":"Go to next page",size:"default",className:cn("gap-1 pr-2.5",e),...a,children:[jsxRuntimeExports.jsx("span",{children:"Next"}),jsxRuntimeExports.jsx(ChevronRight,{className:"h-4 w-4"})]});PaginationNext.displayName="PaginationNext";const BlogList=({posts:e,currentPage:a,totalPages:o,onPageChange:c})=>jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsx("div",{children:e.map(d=>jsxRuntimeExports.jsx(BlogPost,{post:d},d.id))}),jsxRuntimeExports.jsx("div",{className:"flex justify-center mt-8",children:jsxRuntimeExports.jsx(Pagination,{children:jsxRuntimeExports.jsxs(PaginationContent,{className:"gap-2",children:[" ",jsxRuntimeExports.jsx(PaginationItem,{children:jsxRuntimeExports.jsx(PaginationPrevious,{onClick:()=>a>1&&c(a-1),className:cn("select-none","min-w-9 h-9","bg-sky-100 hover:bg-sky-200","text-sky-900","rounded-md","flex items-center justify-center")})}),[...Array(o)].map((d,$)=>jsxRuntimeExports.jsx(PaginationItem,{className:"list-none",children:jsxRuntimeExports.jsx(PaginationLink,{onClick:()=>c($+1),className:cn("select-none","min-w-9 h-9","bg-sky-100 hover:bg-sky-200","text-sky-900","rounded-md","flex items-center justify-center",a===$+1&&"bg-sky-900 text-sky-100 hover:bg-sky-800"),children:$+1})},$+1)),jsxRuntimeExports.jsx(PaginationItem,{children:jsxRuntimeExports.jsx(PaginationNext,{onClick:()=>a<o&&c(a+1),className:cn("select-none","min-w-9 h-9","bg-sky-100 hover:bg-sky-200","text-sky-900","rounded-md","flex items-center justify-center")})})]})})})]}),Sidebar=({categories:e,isExpanded:a,onExpandedChange:o})=>{const c=useNavigate(),d=useLocation();reactExports.useEffect(()=>{localStorage.setItem("sidebarExpanded",JSON.stringify(a))},[a]);const g=new URLSearchParams(d.search).get("category"),b=_=>{c(_==="All"?"/":`/?category=${_}`)};return jsxRuntimeExports.jsxs("div",{className:`
        fixed
        transition-all duration-300 ease-in-out transform
        bg-sky-100 shadow
        overflow-hidden
        ${a?"w-[250px] h-auto p-4 rounded-lg":"w-10 h-10 p-0 rounded-lg"}
      `,children:[jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"icon",onClick:()=>o(!a),className:`
          transition-all duration-300 ease-in-out transform
          font-semibold 
          hover:bg-sky-600 
          focus:outline-none
          text-xs
          sm:text-xs
          lg:text-sm
          bg-sky-100 
          text-sky-900
          ${a?"absolute right-2 top-2 w-8 h-8":"w-full h-full rounded-lg"}
        `,children:a?jsxRuntimeExports.jsx(X,{className:"h-4 w-4 text-sky-900"}):jsxRuntimeExports.jsx(Menu,{className:"h-4 w-4 text-sky-900"})}),jsxRuntimeExports.jsxs("div",{className:`
        transition-all duration-300 ease-in-out transform
        ${a?"opacity-100 mt-8":"opacity-0 invisible h-0"}
      `,children:[jsxRuntimeExports.jsx("h2",{className:`font-semibold text-sky-900 mb-4
        lg:text-xl
        sm:text-base
        `,children:"Categories"}),jsxRuntimeExports.jsxs("ul",{className:"w-full pr-2",children:[jsxRuntimeExports.jsx("li",{className:"mb-2",children:jsxRuntimeExports.jsx(Button,{className:`w-full justify-start font-semibold hover:bg-sky-600 focus:outline-none
              text-xs
              sm:text-xs
              lg:text-sm
              ${g===null?"bg-sky-900 text-sky-100":"bg-sky-100 text-sky-900"}`,onClick:()=>b("All"),children:"All"})}),e.map(_=>jsxRuntimeExports.jsx("li",{className:"mb-2",children:jsxRuntimeExports.jsx(Button,{className:`w-full justify-start font-semibold hover:bg-sky-600 focus:outline-none text-left
                text-xs break-words whitespace-normal
                sm:text-xs sm:break-words sm:whitespace-normal 
                lg:text-sm lg:break-normal lg:whitespace-nowrap 
                ${g===_?"bg-sky-900 text-sky-100":"bg-sky-100 text-sky-900"}`,onClick:()=>b(_),children:_})},_))]})]})]})},SearchModal=({searchTerm:e,onSearchTermChange:a,onClose:o,posts:c})=>{const d=useNavigate(),$=reactExports.useRef(null),g=reactExports.useRef([]),[b,_]=reactExports.useState(-1),j=c.filter(tt=>tt.title.toLowerCase().includes(e.toLowerCase()));reactExports.useEffect(()=>{var tt;(tt=$.current)==null||tt.focus(),g.current=[]},[]),reactExports.useEffect(()=>{_(-1)},[e]);const _e=tt=>{var nt,at,lt,mt,ot;if(tt.key==="Tab"&&j.length>0){tt.preventDefault();const st=j.length-1;if(tt.shiftKey)if(b<=0)(nt=$.current)==null||nt.focus(),_(-1);else{const ut=Math.max(0,b-1);_(ut),(at=g.current[ut])==null||at.focus()}else if(b===-1)_(0),(lt=g.current[0])==null||lt.focus();else if(b<st){const ut=b+1;_(ut),(mt=g.current[ut])==null||mt.focus()}else(ot=$.current)==null||ot.focus(),_(-1)}},et=tt=>{d(`/posts/${tt}`),o()};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center pt-20 z-50",onClick:o,children:jsxRuntimeExports.jsxs("div",{className:"bg-slate-800 p-4 rounded-lg w-full max-w-xl",onClick:tt=>tt.stopPropagation(),children:[jsxRuntimeExports.jsx("input",{ref:$,type:"text",placeholder:"Search posts...",className:"w-full p-2 rounded bg-slate-700 text-sky-100",value:e,onChange:tt=>a(tt.target.value),onKeyDown:_e}),jsxRuntimeExports.jsx("div",{className:"mt-2 max-h-60 overflow-auto",children:j.map((tt,nt)=>jsxRuntimeExports.jsx("div",{ref:at=>g.current[nt]=at,tabIndex:0,className:`p-2 hover:bg-slate-700 rounded cursor-pointer text-sky-100
                ${b===nt?"bg-slate-700 ring-2 ring-sky-400":""}`,onClick:()=>et(tt.id),onKeyDown:at=>{at.key==="Enter"&&et(tt.id)},children:tt.title},tt.id))})]})})},__vite_glob_0_0=`---
title: Algebra Chapter 0 - Week 1
---

# Exercise 1.1

Locate a discussion of Russell's paradox, and understand it.

---

## Answer

Let $R$ be the set of all sets that do not contain themselves.

Paradox.

# Exercise 1.2

Prove that if  $\\sim$  is a relation on a set  $S $,

then the corresponding family  $\\mathscr{P}_{\\sim} $ defined in  $\\S 1.5$

is indeed a partition of  $S$  :

that is, its elements are nonempty, disjoint, and their union is  $S$ . [§1.5]

---

## Proof

Nonempty: for each class, $x\\in\\left[x\\right]$

Disjoint: Suppose $z\\in \\left[x\\right]\\cap\\left[y\\right]$, then we have:

$z\\sim x, z\\sim y\\Rightarrow x\\sim y\\Rightarrow \\left[x\\right] = \\left[y\\right]$

Union: we can know every element is in some equivalence class.

---

# Exercise 1.3

Given a partition  $\\mathscr{P}$  on a set  $S$ ,

show how to define a relation  $\\sim$  on  $S $ such that  

$\\mathscr{P}$  is the corresponding partition. [§1.5]

---

## Answer

$x\\sim y \\Leftrightarrow \\exists P \\in \\mathscr{P} s.t. x\\in P , y\\in P$

---

# Exercise 1.4

How many different equivalence relations may be defined on the set $\\{1,2,3\\}$?

---

## Answer

5, $\\{\\{1,2,3\\}\\},\\{\\{1\\},\\{2,3\\}\\},\\{\\{2\\},\\{1,3\\}\\},\\{\\{3\\},\\{1,2\\}\\},\\{\\{1\\},\\{2\\},\\{3\\}\\}$

---

# Exercise 1.5

Give an example of a relation that is reflexive and symmetric but not transitive.

What happens if you attempt to use this relation to define a partition on the set?

(Hint: Thinking about the second question will help you answer the first one.)

---

## Answer

Let $R=\\{(a,a), (b,b), (c,c), (a,b), (b,a), (b,c), (c,b)\\}$

When we try to form equivalence classes:

$a$ and $c$ are indirectly connected through $b$,

but they are not directly related.

---

# Exercise 1.6

$\\triangleright $ Define a relation $ \\sim $ on the set $ \\mathbb{R} $ of real numbers 

by setting  $a \\sim b \\Longleftrightarrow b-a \\in   \\mathbb{Z} $.

Prove that this is an equivalence relation, 

and find a 'compelling' description for  $\\mathbb{R} / \\sim $. 

Do the same for the relation  $\\approx  $on the plane  $\\mathbb{R} \\times \\mathbb{R}$  defined by declaring  $\\left(a_{1}, a_{2}\\right) \\approx\\left(b_{1}, b_{2}\\right) \\Longleftrightarrow b_{1}-a_{1} \\in \\mathbb{Z}  $and  $b_{2}-a_{2} \\in \\mathbb{Z}$ . [§II.8.1, II.8.10]

---

## Proof

Reflectivity: $a - a = 0 \\in \\mathbb{Z}$

Symmetric: $b - a = c \\in \\mathbb{Z}, -c \\in \\mathbb{Z}, a-b\\in\\mathbb{Z}$

Transitivity: $b-a = x\\in\\mathbb{Z}, c-b = y\\in\\mathbb{Z}, y + x\\in\\mathbb{Z}$

$R/\\sim \\cong [0,1)$
`,__vite_glob_0_1=`---
title: Algebra Chapter 0 - Week 2
---

# Function between sets

function: from $A$ to $B$

graph: $\\Gamma_f := \\{(a,b)\\in A\\times B \\mid b = f(a)\\}\\subseteq A \\times B$

Requirement: $(\\forall a \\in A)(\\exists!b\\in B)\\quad(a,b)\\in\\Gamma_f$

- or: $(\\forall a \\in A)(\\exists!b\\in B)\\quad f(a) = b$

$f$ is a function from a set $A$ to a set $B$: $A \\xrightarrow{f} B $

$f$ on element $a\\in A$: $a\\mapsto f(a)$ 

collection of all functions from a set $A$ to a set $B$: $B^A$

identity function: $\\mathrm{id}_A : A\\rightarrow A$, $(\\forall a\\in A) \\mathrm{id}_A(a) = a$

subset function: $f(S) := \\{ b\\in B \\mid (\\exists a \\in A)b = f(a)\\}$

image: $f(A)$, image of $f$, $\\mathrm{im} f$, largest subset.

restriction: $f|_S := (\\forall s \\in S) : \\quad f|_S(s) = f(s)$

composition of functions: if $f: A\\rightarrow B, g: B\\rightarrow C$, $g\\circ f$:

- $(\\forall a\\in A) (g\\circ f) (a) := g(f(a))$

commute: two ways are same

associative: $h\\circ (g\\circ f) = (h\\circ g)\\circ f$

---

injective: $a' \\ne a''\\Rightarrow f(a')\\ne f(a'')$

- $f$ sends different elements to different elements

surjective: $(\\forall b\\in B)(\\exists a\\in A) b = f(a)$

- $f$ 'covers the whole of B', $\\mathrm{im} f = B$

bijective: both injective and surjective: $f: A \\xrightarrow \\sim B$ or $A\\cong B$

- $A$ and $B$ are ‘isomorphic’ sets
- sets $A$ and $B$ may be 'identified' through $f$

fiber of $f$ over $q$ : $f^{-1}(T)$ if $T = \\{q\\}$

---

monomorphism / monic : $f\\circ \\alpha' = f\\circ \\alpha' \\Rightarrow \\alpha ' = \\alpha''$ for all sets $Z$ and all functions $\\alpha', \\alpha'': Z\\rightarrow A$
`,__vite_glob_0_2=`---
title: Business English - Week 1
category: Notes
---

# Introduction 

## Academic

- academic skills
- academic tasks

## English
- proficiency of using the English language

## Business 
- a specific discipline as the focus 

## Target

> Enhance English proficiency for doing academic tasks in business 

# For who

- Studying Business in English-medium academic settings

# What will you do

Based on the features of studying business 

- Problem-solving
- Decision-making
- Persuasion

Through **ENGLISH**

# Academic skills required 

- the case method
  - actual business situations 
  - apply knowledge to analysis & decision-making 

For example 

  - simulate real-world problems 
  - Give a feel 

- case study 


# Tasks

- case study
- critical thinking
- researching
- presentations
- writing
- `,__vite_glob_0_3=`---
title: Business English - Week 2
category: Notes
---

# Reading Aim

- get useful information 

`,__vite_glob_0_4=`---
title: Business English - Week 6
category: Assignments
---

- Objective:

  - To optimize inventory management and enhance operational efficiency across the shopping mall.
- Why:

  - Shanghai is a competitive retail market where operational excellence is key to profitability. 
  - Predictive Analytics helps reduce costs from overstock and stockouts, ensures product availability to meet customer demand, and supports data-driven decision-making, all of which are critical for a large-scale mall operation.
- How:

  - By collecting and analyzing historical sales data, customer footfall patterns, and external factors (e.g., weather, holidays) using machine learning algorithms to accurately forecast demand. 
  - This system would integrate with existing inventory and sales platforms to provide real-time insights.
- Pros:
  - Improved inventory turnover: Aligns stock levels with actual demand, reducing waste.
  - Reduced holding costs: Minimizes excess inventory storage expenses.
  - Better customer satisfaction: Ensures popular products are always in stock.
  - Data-driven decision-making: Provides actionable insights for purchasing and staffing decisions.
- Cons:
  - Data dependency: Requires high-quality, accurate data for reliable predictions.
  - Complexity: Initial setup and integration with existing systems can be technically challenging.
  - Skill requirement: May need specialized personnel to manage and interpret the analytics.
- Decision:
  - I prioritize Predictive Analytics Algorithms because they offer a direct, measurable impact on operational efficiency and cost savings—key priorities for a mall operations manager. While technologies like AR Virtual Try-On or AI Personalization enhance customer experience, Predictive Analytics addresses the backbone of mall operations (inventory and cost management) in a scalable, behind-the-scenes way. In Shanghai’s tech-savvy yet competitive market, ensuring smooth operations provides a foundation for further customer-facing innovations.

Specialized Terms Used:
- Predictive Analytics
- Inventory Management
- Operational Efficiency
- Data-Driven Decision Making
- Supply Chain Optimization
- ROI (Return on Investment)
- Scalability
- Regulatory Compliance


`,__vite_glob_0_5=`---
title: Business English - Week 8
category: Notes
---

No

- shift
- huge part + e+

20?online? -- like shop --always retail

however: 300 shops + prosper 300 bottom close 5-10 year 300mid exist 

shop - Emmerce? phone price - same immediately online:price 

walmart: order pickup : good innovater 

---

younger retailer: better: mix channel sortment - GAP - 

# Emmerce



# Brick-n-mortar`,__vite_glob_0_6=`---
title: Business English - Week 9
category: Notes
---

# Product-Service System

## User needs

- Limited budgets for purchasing specialized items (e.g., projectors, lab tools).
- Storage constraints in dormitories.

## Solution Components

- Item Inventory: Electronics, sports gear, tools, event-specific items.
- Maintenance System: Partnerships with local vendors for repairs.

## Implementation Steps

- Partner with Fudan University for hub locations (e.g., libraries, dorm zones).
- Pilot with high-demand items (e.g., portable projectors, tools).

## Benefits

- Profit: Earn rental from students.
- Cost Savings: Students avoid purchasing expensive, rarely used items.
- Community Building: Encourages resource-sharing culture.

# Specialized terms

- Specialized item
- Maintenance system 
- Pilot 
- Resource-sharing 
`,__vite_glob_0_7=`---
title: Business English - Cheatsheet
category: Cheatsheets
---

# Unit 1

$$
\\begin{array}{|l|l|l|}
\\hline
\\text {economic system} & \\text {the system of production, distribution and consumption} & \\text {经济体制} \\\\ 
\\hline
\\text {private enterprise} & \\text {industry and businesses owned by ordinary people, not by the government} & 私营企业 \\\\ 
\\hline
\\text {business system} & \\text {a network of interconnected forces that make business possible} & \\text {商业体系} \\\\ 
\\hline
\\text {management functions} & \\text {actions and activities assigned to or expected of a manager or a group of managers} & \\text {管理职能} \\\\
\\hline
\\text {undercapitalization} & \\text {the state of not having enough money to operate a business effectively} & \\text {资本不足} \\\\ 
\\hline
\\text {customer service} & \\text {the provision of service to customers before, during and after a purchase} & \\text {客户服务} \\\\ 
\\hline
\\text {business plan} & \\text {a formal statement of a set of business goals, the reasons why they are believed attainable, and proposed activities to reach those goals} & \\text {经营规划} \\\\ 
\\hline
\\text {marginal cost} & \\text {the additional cost of producing an additional unit of output or the reduction in total cost from producing one unit less.} & \\text {边际成本} \\\\ 
\\hline
\\text {profit opportunity} & \\text {opportunity to make money or other gains} & \\text {赢利机会} \\\\  
\\hline
\\end{array}
$$

# Unit 2

$$
\\begin{array}{|l|l|l|}
\\hline 
\\text {target market} & \\text {a group of individuals or organizations, or both, for which a company develops and maintains a marketing mix suitable for their specific needs and preferences} & \\text {目标市场} \\\\ 
\\hline 
\\text {marketing communication} & \\text {the means adopted by companies to convey messages about the products and the brands they sell, either directly or indirectly to customers with the intention to persuaade them to purchase} & \\text {营销传播} \\\\ 
\\hline 
\\text {public relation} & \\text {the business of giving the public information about a particular organization or person in order to create a good impression} & \\text {公关} \\\\ 
\\hline 
\\text {event marketing} & \\text {a significant situation or promotional happening that has a central focus and captures the attention and involvement of the target audience} & \\text {事件营销} \\\\ 
\\hline 
\\text {dot-com bubble} & \\text {a speculative bubble covering roughly 1995-2000 during which stock markets in industrialized nations saw their equity value rise rapidly from growth in the Internet sector and related fields} & \\text {互联网泡沫} \\\\ 
\\hline 
\\end{array}
$$

# Unit 3

$$
\\begin{array}{|l|l|l|}
\\hline 
\\text {New Retail} & \\text {a term originated by Jack Ma, founder of Alibaba Group. It refers to a transformative retail model that combines online and offline commerce} & 新零售 \\\\ 
\\hline 
\\text {High Street} & \\text {a metonym for the generic name of the primary business street of towns or cities especially in the UK} & \\text {主要商业街道} \\\\ 
\\hline 
\\text {smart store} & \\text {a retail store that combines both online and offline channels to provide more personalized and interactive shopping experiences to customers} & 智能商店 \\\\ 
\\hline 
\\text {pop-up store} & \\text {a store that opens suddenly and usually exists for a short time} & 快闪店 \\\\ 
\\hline 
\\text {augmented reality technology} & \\text {the technology that adds information to a view of a real-world environment} & \\text {扩增实境技术} \\\\ 
\\hline 
\\text {home delivery} & \\text {the service of transporting goods from stores to customers' home} & \\text {送货上门服务} \\\\ 
\\hline 
\\text {store pickup} & \\text {the service that customers collect goods from a store} & 店内提货服务，到店取货服务 \\\\ 
\\hline 
\\text {free return} & \\text {the act of returning a product without extra charge} &  免费退货 \\\\ 
\\hline
\\text {the millennials} & \\text {the generation born between the 1980s and the early 1990s, generally characterized by an increased use of and familiarity with communications, media, and digital technologies} \\\\ 
\\hline 
\\text {baby boomer} & \\text {somebody born during a period when a lot of babies were born, especially between 1946 and 1964 in the US} & 生育高峰期出生的人 \\\\ 
\\hline 
\\end{array}
$$

# Unit 4 

$$
\\begin{array}{|l|l|l|}
\\hline 
\\text {sharing economy} & \\text {an economic system in which assets or services are shared between private individuals, either free or for a fee, typically by means of the Internet} & 共享经济 \\\\ 
\\hline 
\\text {artificial advantage} & \\text {advantage that is not happpening naturally, but as a result of human efforts} & 人为优势 \\\\ 
\\hline 
\\text {business model} & \\text {a configuration of the elements of a business, how they work together, and how they produce profits} & 商业模型 \\\\ 
\\hline 
\\text {competitive advantage} & \\text {the factor which enables a firm to compete successfully with competitors on a sustained basis, particularly to satisfy consumer needs and wants} & 竞争优势 \\\\ 
\\text {contract worker} & \\text {a worker employed by a business on a contract for a fixed period of time. Different from permanent employees, contract workers are usually employed for a relatively short period and provided no employee benefits, such as medical insurance and social security} & 合同工 \\\\ 
\\hline 
\\text {on-demand service} & \\text {service provided whenever required} & 按需服务 \\\\ 
\\hline 
\\text{labour force} & \\text {all the people who work for a company or in a country} & 劳动力 \\\\ 
\\hline  
\\text {black cab} & \\text {a traditional type if taxi in London and some other British citirs. Its drivers are licensed by the city to stop and pick up passengers in the street} & 黑色出租车 \\\\ 
\\hline 
\\end{array}
$$

# Unit 5 

$$
\\begin{array}{|l|l|l|}
\\hline 
\\text {omnichannel marketing strategy} & \\text {a multichannel approach to marketing that seeks to provide customers with a seamless shopping experience, whether they are shopping online from a desktop or mobile device, by telephone, or in a brick-and-mortar store. There is integration between distribution, promotion and communication channels on the back end} & 全渠道整合营销策略 \\\\ 
\\hline 
\\end{array}
$$

# Unit 8 

$$
\\begin{array}{|l|l|l|}
\\hline 
\\text {brand experience} & \\text {a term used to describe the total impression of a potential consumer of a brand. The total experience of the brand may come from advertisements, actual use, reporting, or other interactions with the brand} & 品牌体验 \\\\ 
\\hline 
\\text {consumer bank} & \\text {a bank whose primary focus is accepting deposits from and making loans to individuals} & 零售银行 \\\\ 
\\hline 
\\text {brand loyalty} & \\text {the support that people give to a particular brand of product by continuing to buy it rather than changing to other brands} & \\text{品牌忠诚度} \\\\ 
\\hline
\\end{array}
$$

--- 

# Unit 1

$$
\\begin{array}{|l|l|}
\\hline 
\\text {segment} & 段 \\\\ 
\\text {preceding} & 前述的 \\\\ 
\\text {cosmetic} & 化妆的 \\\\ 
\\text {cosmetologist} & 美容师 \\\\
\\text {adversity} & 不幸 \\\\ 
\\text {compelling} & 令人信服的 \\\\ 
\\text {array} & 大量 \\\\ 
\\text {stockholder} & 股东 \\\\ 
\\text {workplace} & 工作场所 \\\\ 
\\text {diversity} & 多样性 \\\\ 
\\text {ethnicity} & 种族特点 \\\\ 
\\text {prospective} & 可能的 \\\\ 
 \\text {integrity} & 正直 \\\\ 
\\text {dependability} & 可靠性 \\\\ 
\\text {professsionalism} & 专业素质 \\\\ 
\\text {workload} & 工作量 \\\\ 
\\text {downsizing} & 精简 \\\\ 
\\text {quest} & 追求  \\\\ 
\\text {interpersonal} & 人际关系的 \\\\ 
\\text {analytic} & 分析的 \\\\ 
\\text {CEO} & 首席执行官 \\\\ 
\\text {sensation} & 轰动 \\\\ 
\\text {approximately} & 大约 \\\\
\\text {unqualified} & 不合格的 \\\\ 
\\text {untrained} & 未训练的 \\\\ 
\\text {fraud} & 诈骗 \\\\ 
\\text {investor} & 投资者 \\\\ 
\\text {Hispanic} & 讲西班牙语的 \\\\ 
\\text {stockbroker} & 股票经纪人 \\\\ 
\\text {facet} & 一个方面 \\\\ 
\\text {opportunity cost} & 机会成本 \\\\
\\text {marginalism} & 边际主义 \\\\ 
\\text {efficient market} & 有效市场 \\\\ 
\\text {societal} & 社会的 \\\\ 
\\text {trade-off} & 权衡 \\\\ 
\\text {recur} & 重现 \\\\ 
\\text {forgo} & 放弃 \\\\
\\text {constraint} & 约束 \\\\ 
\\text {hockey} & 曲棍球 \\\\ 
\\text {varsity} & 校队 \\\\ 
\\text {essentially} & 本质上 \\\\
\\text {checkout} & 收银台 \\\\ 
\\text {equalize} & 使相等 \\\\ 
\\text {loosely} & 宽泛地 \\\\ 
\\text {instantaneously} & 立即地 \\\\ 
\\text {scepticism} & 怀疑 \\\\ 
\\text {well-being} & 幸福 \\\\ 
\\text {blink} & 眨眼 \\\\ 
\\text {recession} & 衰退期 \\\\ 
\\text {positive economics} & 实证经济学 \\\\ 
\\text {normative economics} & 规范经济学 \\\\ 
\\text {rule of thumb} & 经验法则 \\\\ 
\\text {econometrics} & 计量经济学 \\\\ 
\\text {criminologist} & 犯罪学家 \\\\ 
\\text {anthropologist} & 人类学家 \\\\ 
\\text {neuroscientist} & 神经科学家 \\\\ 
\\hline
\\end{array}
$$

# Unit 2

$$
\\begin{array}{|l|l|}
\\hline 
\\text {business philosophy} & 经营理念 \\\\ 
\\text {marketing} & 市场营销 \\\\ 
\\text {marketer} & 营销人员 \\\\ 
\\text {stakeholder} & 股东 \\\\ 
\\text {commonality} & 共性 \\\\ 
\\text {manipulation} & 操控 \\\\ 
\\text {charged} & 紧张的 \\\\ 
\\text {maximize} & 最大化 \\\\
\\text {entice} & 诱惑 \\\\ 
\\text {nutritious} & 营养的 \\\\ 
\\text {sociological} & 社会学的 \\\\ 
\\text {scent} & 气味 \\\\ 
\\text {underway} & 在进行中的 \\\\ 
\\text {tangible} & 可触知的 \\\\ 
\\text {intangible} & 触摸不到的 \\\\ 
\\text {segment} & 分割 \\\\ 
\\text {boutique} & 时装店 \\\\ 
\\text {superstore} & 大型超市 \\\\ 
\\text {lifeblood} & 命脉 \\\\ 
\\text {capitalism} & 资本主义 \\\\ 
\\text {profitability} & 获利 \\\\ 
\\text {prominent} & 重要的 \\\\ 
\\text {stupidity} & 愚蠢 \\\\ 
\\text {unlimited} & 无限量的 \\\\ 
\\text {robust} & 强健的 \\\\ 
\\text {icon} & 象征 \\\\ 
\\text {senseless} & 无道理的 \\\\ 
\\text {accessory} & 装饰物 \\\\ 
\\text {in hindsight} & 事后聪明 \\\\ 
\\text {excrement} & 粪便 \\\\ 
\\text {Dane} & 丹麦人 \\\\ 
\\text {have come a long way} & 极大地改进 \\\\ 
\\text {superiority} & 优势 \\\\ 
\\text {shed} & 摆脱 \\\\ 
\\text {iconic} & 著名且有象征意义的 \\\\ 
\\text {shampoo} & 洗发剂 \\\\ 
\\text{ retailer} & 零售商 \\\\ 
\\text {disposable} & 一次性的 \\\\ 
\\text {diaper} & 尿布 \\\\ 
\\text {spur} & 促进 \\\\ 
\\text {offshore} & 国外的 \\\\ 
\\text {controversial} & 有争议的 \\\\ 
\\text {to say the least} & 最起码 \\\\ 
\\text {stunningly} & 极有魅力地 \\\\ 
\\text {tampon} & 月经棉条 \\\\ 
\\text {immoral} & 不道德的 \\\\ 
\\text {taboo} & 禁忌 \\\\ 
\\text {sinful} & 有罪过的 \\\\ 
\\text {normalization} & 正常化 \\\\ 
\\text {billboard} & 广告牌 \\\\ 
\\text {automotive} & 汽车的 \\\\ 
\\text {overly} & 过度地 \\\\ 
\\text {automobile} & 汽车 \\\\ 
\\text {over-brand} & 品牌建设过度 \\\\ 
\\text {portfolio} & 业务或投资组合 \\\\ 
\\text {momentum} & 动量 \\\\ 
\\text {photon} & 光子 \\\\ 
\\hline
\\end{array}
$$

# Unit 3 

$$
\\begin{array}{|l|l|}
\\hline
\\text {See Now, Buy Now} & 即看即买 \\\\ 
\\text {rife} & 普遍的 \\\\ 
\\text {exclusively} & 仅仅 \\\\ 
\\text {seamless} & 流畅的 \\\\ 
\\text {margin} & 利润 \\\\ 
\\text {revenue} & 收入 \\\\ 
\\text {crucially} & 至关重要的 \\\\ 
\\text {immersive} & 沉浸式的 \\\\ 
\\text {burgeoning} & 急速增长的 \\\\ 
\\text {lipstick} & 口红 \\\\ 
\\text {despondent} & 沮丧的 \\\\ 
\\text {mind-boggling} & 令人难以置信的 \\\\ 
\\text {underpin} & 巩固 \\\\ 
\\text {redefine} & 重新界定 \\\\ 
\\text {tailored} & 专门的 \\\\ 
\\text {bespoke} & 定制的 \\\\ 
\\text {curate} & 管理 \\\\ 
\\text {personalised} & 个性化的 \\\\ 
\\text {adjacent} & 邻近的 \\\\ 
\\text {conventionally} & 传统地 \\\\ 
\\text {augmented} & 加强的 \\\\ 
\\text {test out} & 试验 \\\\ 
\\text {does what it says on the tin} & 说到做到 \\\\ 
\\text {outfit} & 全套服装 \\\\ 
\\text {hassle} & 麻烦 \\\\ 
\\text {emcompass} & 包含 \\\\ 
\\text {leverage} & 充分利用 \\\\ 
\\text {kick off} & 开始 \\\\ 
\\text {cat walk} & 走T台 \\\\ 
\\text {convert} & 转换 \\\\ 
\\text {gamification} & 游戏化 \\\\ 
\\text {buzzword} & 时髦术语 \\\\ 
\\text {voucher} & 打折优惠券 \\\\ 
\\text {customise} & 定制 \\\\ 
\\text {brick-and-mortar store} & 实体店 \\\\ 
\\text {aggregate} & 总计的 \\\\ 
\\text {plight} & 困境 \\\\ 
\\text {intersection} & 十字路口 \\\\ 
\\text {clutter} & 乱堆放 \\\\ 
\\text {vie} & 激烈争夺 \\\\ 
\\text {take a back seat} & 居于次要位置 \\\\ 
\\text {mortar} & 灰浆 \\\\ 
\\text {throw in the towel} & 认输 \\\\ 
\\text {remake} & 修改 \\\\ 
\\text {call it quits} & 决定停止 \\\\ 
\\text {embrace} & 欣然接受 \\\\ 
\\text {showdown} & 最后的较量 \\\\ 
\\text {personalize} & 为个人特制 \\\\ 
\\text {neighborhood} & 街区 \\\\ 
\\text {intersperse} & 散布 \\\\ 
\\text {venue} & 活动场地 \\\\ 
\\text {futurist} & 未来学家 \\\\ 
\\text {ironic} & 奇怪的 \\\\ 
\\text {viable} & 切实可行的 \\\\ 
\\text {virtualization} & 虚拟化 \\\\ 
\\text {heavyweight} & 有影响力的人 \\\\ 
\\text {upstart} & 突然发迹的 \\\\ 
\\text {evolve} & 逐渐形成 \\\\ 
\\text {soar} & 急升 \\\\ 
\\text {aggregation} & 汇集 \\\\ 
\\text {glimpse} & 短暂的感受 \\\\ 
\\text {spontaneity} & 自发性 \\\\ 
\\text {celebrity} & 名人 \\\\ 
\\text {apparel} & 衣服 \\\\ 
\\text {garment} & 衣服 \\\\ 
\\hline 
\\end{array}
$$

# Unit 4 

$$
\\begin{array}{|l|l|}
\\hline 
\\text {ad hoc} & 特别的 \\\\ 
\\text {arbitrage} & 套利 \\\\ 
\\text {evasion} & 逃避 \\\\ 
\\text {disruptive} & 扰乱性的 \\\\ 
\\text {unleash} & 突然释放 \\\\ 
\\text {underused} & 未充分利用的 \\\\ 
\\text {courier} & 信使 \\\\ 
\\text {deflationary} & 通货紧缩的 \\\\ 
\\text {detriment} & 伤害 \\\\ 
\\text {bout} & 一阵 \\\\ 
\\text {growing pains} & 发展初期的困难 \\\\ 
\\text {converge} & 趋同 \\\\ 
\\text {detention} & 拘留 \\\\ 
\\text {to the fore} & 处于重要的地位 \\\\ 
\\text {a spate of sth.} & 一连串 \\\\ 
\\text {confrontational} & 对抗性的 \\\\ 
\\text {put a brave faace on sth.} & 佯装不满 \\\\ 
\\text {supervise} & 监督 \\\\ 
\\text {evaporate} & 消失 \\\\ 
\\text {streamline} & 效率更高 \\\\ 
\\text {money-spinner} & 摇钱树 \\\\ 
\\text {uniformly} & 一致地 \\\\ 
\\text {tap into} & 开发 \\\\ 
\\text {untapped} & 未开发的 \\\\ 
\\text {undiminished} & 未减少的 \\\\ 
\\text {hurdle} & 障碍 \\\\ 
\\text {get sb.'s head around sth.} & 能够理解 \\\\ 
\\text {pitfall} & 隐患 \\\\ 
\\text {navigate} & 正确处理 \\\\ 
\\text {reliant} & 依赖的 \\\\ 
\\text {housekeeping} & 料理家务 \\\\ 
\\text {step in} & 插手 \\\\ 
\\text {correlation} & 联系 \\\\ 
\\text {subsequently} & 随后 \\\\ 
\\text {regorous} & 严格的 \\\\ 
\\text {utopian} & 乌托邦的 \\\\ 
\\text {abuse} & 滥用 \\\\ 
\\text {crack down} & 严厉打击 \\\\ 
\\text {outright} & 全部地 \\\\ 
\\text {self-confessed} & 自己承认的 \\\\ 
\\text {staggering} & 令人难以相信的 \\\\ 
\\text {clunky} & 笨重的 \\\\ 
\\text {trump} & 胜过 \\\\ 
\\text {dematerialize} & 消失 \\\\ 
\\text {blurry} & 模糊不清的 \\\\ 
\\text {cornerstone} & 基础 \\\\ 
\\text {humongous} & 巨大的 \\\\ 
\\text {seismic} & 影响深远的 \\\\ 
\\hline 
\\end{array}
$$

# Unit 5 

$$
\\begin{array}{|l|l|}
\\hline 
\\text {start-up} & 创业公司 \\\\ 
\\text {summon} & 召唤 \\\\ 
\\text {fury} & 狂怒 \\\\ 
\\text {valuation} & 估价 \\\\ 
\\text {shake up} & 彻底改组 \\\\ 
\\text {have one's eye on sth.} & 想得到 \\\\ 
\\text {trillion} & 一万亿 \\\\ 
\\text {autonomous} & 自主的 \\\\ 
\\text {incumbent} & 占市场份额大的 \\\\ 
\\text {epic} & 漫长且艰难的 \\\\ 
\\text {loom} & 似将发生 \\\\ 
\\text {profoundly} & 深刻地 \\\\ 
\\text {pole position} & 主导地位 \\\\ 
\\text {chauffeured} & 有专职司机驾驶的 \\\\ 
\\text {blur} & 使变得模糊不清 \\\\ 
\\text {urbanite} & 城市居民 \\\\ 
\\text {hit the road} & 出发 \\\\ 
\\text {existential} & 存在的 \\\\ 
\\text {haulage} & 运输 \\\\ 
\\text {on top} & 领先 \\\\ 
\\text {recipe} & 促成因素 \\\\ 
\\text {imperfect} & 不完美的 \\\\ 
\\text {lucrative} & 生利的 \\\\ 
\\text {the lion's share} & 最大的一份 \\\\ 
\\text {integral} & 必需的 \\\\ 
\\text {infrastructure} & 基础设施 \\\\ 
\\text {disrupter} & 颠覆者 \\\\ 
\\text {legacy} & 老式的 \\\\ 
\\text {plausible} & 似乎有道理的 \\\\ 
\\text {foray} & 短暂但勇敢的尝试 \\\\ 
\\text {revolutionize} & 使发生革命性的巨变 \\\\ 
\\text {kingpin} & 最重要的人 \\\\ 
\\text {kiosk} & 小亭 \\\\ 
\\text {inventory} & 存货 \\\\ 
\\text {notable} & 显著的 \\\\ 
\\text {drone} & 无人驾驶飞机 \\\\ 
\\text {subscriber} & 付费用户 \\\\ 
\\text {understandably} & 可以理解地 \\\\ 
\\text {refund} & 退款 \\\\ 
\\text {inverse} & 相反的 \\\\ 
\\text {at the cost of} & 以...为代价 \\\\ 
\\text {modicum} & 少量 \\\\ 
\\text {incentive} & 刺激 \\\\ 
\\text {complementary} & 互补的 \\\\ 
\\text {mechanism} & 方法 \\\\ 
\\text {broker} & 经纪人 \\\\ 
\\text {turnover} & 营业额 \\\\ 
\\text {ardent} & 热情的 \\\\ 
\\text {apostle} & 倡导者 \\\\ 
\\text {juxtaposition} & 并列的 \\\\ 
\\hline
\\end{array}
$$

# Unit 8

$$
\\begin{array}{|l|l|}
\\hline  
\\text {branded product} & 品牌产品 \\\\ 
\\text {touch point} & 客户接触点 \\\\ 
\\text {premium} & 溢价 \\\\ 
\\text {generic} & 无厂家商标的 \\\\ 
\\text {branding} & 品牌创建 \\\\ 
\\text {differentiate} & 区别 \\\\ 
\\text {attribute} & 属性 \\\\ 
\\text {constituent} & 成分 \\\\ 
\\text {funder} & 资金赞助者 \\\\ 
\\text {go awry} & 出岔子 \\\\ 
\\text {position} & 定位 \\\\ 
\\text {homey} & 舒适自在的 \\\\ 
\\text {retro} & 怀旧的 \\\\ 
\\text {typestyle} & 字体 \\\\ 
\\text {grainy} & 有颗粒的 \\\\ 
\\text {chrome} & 铬合金 \\\\ 
\\text {blond} & 轻漂染成浅色的 \\\\ 
\\text {aggregate} & 合计 \\\\ 
\\text {cement} & 加强 \\\\ 
\\text {conversely} & 相反地 \\\\ 
\\text {incongruent} & 不一致的 \\\\ 
\\text {unravel} & 毁坏 \\\\ 
\\text {anomaly} & 异常 \\\\ 
\\text {differentiation} & 差异 \\\\ 
\\text {evangelism} & 极大的热忱 \\\\ 
\\text {strategist} & 战略家 \\\\ 
\\text {probe} & 探究 \\\\ 
\\text {relate to} & 理解 \\\\ 
\\text {frequent} & 常去 \\\\ 
\\text {merchandise} & 商品 \\\\
\\text {intuition} & 直觉 \\\\ 
\\text {heredity} & 遗传 \\\\ 
\\text {admixture} & 混合物 \\\\ 
\\text {physiology} & 生理机能 \\\\ 
\\text {tagline} & 品牌口号 \\\\ 
\\text {toothpaste} & 牙膏 \\\\ 
\\text {imagery} & 意象 \\\\ 
\\text {deodorant} & 除臭的 \\\\ 
\\text {niche} & 用户群 \\\\ 
\\text {conjure} & 使...浮现于脑海 \\\\ 
\\text {esthetics} & 美学 \\\\ 
\\text {directory} & 电话号码簿 \\\\ 
\\text {embody} & 体现 \\\\ 
\\text {inherent} & 内在的 \\\\ 
\\text {simultaneously} & 同时地 \\\\ 
\\text {legion} & 众多 \\\\ 
\\text {etch} & 铭记 \\\\ 
\\text {indelibly} & 难以消除地 \\\\ 
\\text {testimony} & 证明 \\\\ 
\\text {exceptionally} & 非常 \\\\ 
\\text {mar} & 玷污 \\\\ 
\\text {pompous} & 自命不凡的 \\\\ 
\\text {Terracotta} & 兵马俑 \\\\ 
\\hline  
\\end{array}
$$




`,__vite_glob_0_8=`---
title: Business Paper - Week 9
---

# Advance Admission Scheduling via Resource Satisficing

#### Table 1 Summary of notations

$
\\begin{array}{|l|l|}
\\hline
\\text{Symbol} & \\text{Description} \\\\
\\hline
\\mathcal{A} & \\text{Set of requesting patients} \\\\
T & \\text{Length of the horizon} \\\\
I & \\text{Number of potential patients} \\\\
R & \\text{Number of patient types} \\\\
K & \\text{Number of resources} \\\\
\\tilde{\\nu}_{tk} & \\text{Random usage of the } k\\text{-th resource on day } t \\\\
\\Gamma_{tk} & \\text{Capacity of the } k\\text{-th resource on day } t \\\\
\\tilde{w}_{tk} & \\text{Random usage of the } k\\text{-th resource on day } t \\text{ by admitted and emergency patients} \\\\
\\tilde{s}_{\\ell k}^d & \\text{Random usage of the } k\\text{-th resource by the } \\ell\\text{-th patient, } d \\text{ days after admission} \\\\
\\tilde{u}_{ikr}^d & 
  \\begin{array}{}
  \\text{Random usage of the } k\\text{-th resource by the } i\\text{-th potential patient,} \\\\
  d \\text{ days after admission, if type is } r \\\\
  \\end{array} \\\\
x_{\\ell t} & \\text{Admission decision of the } \\ell\\text{-th requesting patient on day } t \\\\
y_{itr} & 
  \\begin{array}{}
  \\text{Admission decision of the } i\\text{-th potential patient on day } t \\\\
  \\text{if type is } r \\\\
  \\end{array} \\\\
\\phi_k & \\text{Capacity-related parameter for the } k\\text{-th resource} \\\\
\\hline
\\end{array}
$






# Advance Admission Scheduling 

$\\mathcal A$: requesting patients

$T$: days 

$K$ type of resources 

$\\tilde s^d_{lk}$: usage of $k$-th resource, $d$ days after $l$-th patient 

$\\tilde{w_{tk}}$: random usage of $k$-th resource at day $t$ by scheduled and emergency patients 

#### (1)

$ \\tilde{w}_{t k}=\\sum_{\\tau=t-\\bar{d}}^{t} \\sum_{\\ell \\in \\mathcal{D}_{\\tau}} \\tilde{s}_{\\ell k}^{t-\\tau}+\\sum_{\\tau=1}^{t} \\sum_{j=1}^{\\tilde{n}_{\\tau}} \\tilde{v}_{j k}^{t-\\tau} $
- $\\forall t \\in [T], k\\in[k]$
- $\\tilde n_r $: random number of emergency arrivals on day $\\tau $
- $\\tilde v_{jk}^{t-r} $: usage of $k $-th resource by $j $-th patient after admitted $t-\\tau  $ days 


$R$: total numbers of possible patientis' types 

$\\tilde{r_i}$: discrete random variable on support $[R]$: random type of the $i$-th potential patient for $i\\in[I]$ and $r\\in[R]$

$\\tilde u_{ikr}^d$: random usage of $k$-th resource by $i $-th potential patient, $d $days agter scheduled admission if type is $r $

$\\mathcal G $: possible probability distributions 

### Assumption 1

> For any distribution in $ \\mathcal{G} $ associated with the system's random parameters, we assume that the random variables $ \\tilde{r}_{1}, \\ldots, \\tilde{r}_{I} $ are independent and identically distributed. In addition, the random variables associated with the usage of resource $ k $ at time period $ t $ are independently distributed for different patients and that their moment generation functions exist.

## Partially adaptive scheduling policy 

Two sets of decision variables:

$ \\boldsymbol{x} \\in\\{0,1\\}^{|\\mathcal{A}| \\times T} $: here-and-now decision 
- for $\\mathcal A $
- $x_{\\ell t} = 1$ if $i$-th patient to day $t\\in[T]$

$ \\bar{y}_{i t}:[R]^{i} \\rightarrow\\{0,1\\}, \\forall  i \\in[I], t \\in[T] $: wait-and-see policy 

To avoid curse of dimensionality:

$ \\hat{y}_{i t}:[R] \\rightarrow\\{0,1\\} \\forall i \\in[I], t \\in[T] $
- $=1 $ if $i $-th patient to day $t $ when type is $r$

$ \\boldsymbol{y} \\in\\{0,1\\}^{I \\times T \\times R} $

$ \\hat{y}_{i t}\\left(\\tilde{r}_{i}\\right)=\\sum_{r \\in[R]} y_{i t r} \\mathbb{1}\\left(\\tilde{r}_{i}=r\\right) $

- $y_{itr} = 1 $ if $i $-th patient to day $t\\in[T]$ if type is $r$

#### (2)

$ \\tilde{\\nu}_{t k}=\\tilde{w}_{t k}+\\sum_{\\tau \\in[t]} \\sum_{\\ell \\in \\mathcal{A}} \\tilde{s}_{\\ell k}^{t-\\tau} x_{\\ell \\tau}+\\sum_{\\tau \\in[t]} \\sum_{i \\in[I]} \\sum_{r \\in[R]} \\tilde{u}_{i k r}^{t-\\tau} y_{i \\tau r} \\mathbb{1}\\left(\\tilde{r}_{i}=r\\right) \\quad \\forall k \\in[K], \\forall t \\in[T] $.

- total random usage $\\tilde \\nu_{tk}$ of resource $k $ on day $t$
- $\\Gamma_{tk}$: capacity of resource $k\\in [K]$ for day $t\\in[T]$
- overutilization: $\\tilde \\nu_{tk}$ exceeds $\\Gamma_{tk}$ in day $t $for resource $k$

# Resource Satisficing Index

$\\mathcal Z$: all random usages 
- defined on $\\Omega$

$ \\rho: \\mathcal{Z} \\times \\mathbb{R}_{+} \\rightarrow \\mathbb{R} $

$ \\rho(\\tilde{\\nu}, \\Gamma) $: overutilization risk associated with random usages ($\\tilde \\mu$) in exceeding capacity ($\\Gamma$)

### Definition 1 (Riskiness index)

> The Aumann and Serrano riskiness index $ \\varphi[\\tilde{\\xi}] $ of a random variable $ \\tilde{\\xi} $ representing an uncertain monetary loss of a gamble is the reciprocal of the absolute risk aversion (ARA) of an individual with constant ARA who is indifferent to taking that gamble. By extending their definition to incorporate ambiguity aversion, we define the riskiness index as:
> 
> $\\varphi[\\tilde{\\xi}]=\\inf \\left\\{\\alpha \\geq 0: C_{\\alpha}[\\tilde{\\xi}] \\leq 0\\right\\}$
> 
> where
> 
> $C_{\\alpha}[\\tilde{\\xi}] \\triangleq\\left\\{\\begin{array}{ll}\\inf \\{u \\mid \\tilde{\\xi} \\leq u\\} & \\text { if } \\alpha=0 \\\\\\alpha \\log \\left(\\sup _{\\mathbb{P} \\in \\mathcal{G}} \\mathbb{E}_{\\mathbb{P}}[\\exp (\\tilde{\\xi} / \\alpha)]\\right) & \\text { if } \\alpha \\in(0, \\infty) \\\\\\sup _{\\mathbb{P} \\in \\mathcal{G}} \\mathbb{E}_{\\mathbb{P}}[\\tilde{\\xi}] & \\text { if } \\alpha=\\infty\\end{array}\\right.$
> 
> denotes the worst-case certainty equivalent under an exponential utility function with risk tolerance parameter $ \\alpha \\in \\mathbb{R} \\cup\\{\\infty\\} $.

---

### Definition 2 (Resource Satisficing Index) 

> Given a random usage, $ \\tilde{\\nu} \\in \\mathcal{Z} $ and capacity $ \\Gamma>0 $. For a given calibration function $ \\Phi_{\\Gamma}:[0, \\infty] \\mapsto[0,1] $, parameterized by $ \\Gamma $ and satisfies 
> 
> 1. $ \\Phi_{\\Gamma}(0)=0 $, 
> 
> 2. $ \\Phi_{\\Gamma}(\\infty)=1 $, and 
> 
> 3. $ \\Phi_{\\Gamma}(\\alpha) $ is continuous and increasing in $ \\alpha \\in[0, \\infty] $, 
> 
> the resource satisficing index $ (\\mathrm{RSI}) \\rho: \\mathcal{Z} \\times \\mathbb{R}_{+} \\rightarrow \\mathbb{R} $, is defined as 
> 
> $ \\rho(\\tilde{\\nu}, \\Gamma) \\triangleq\\left\\{\\begin{array}{ll} \\Phi_{\\Gamma}(\\varphi[\\tilde{\\nu}-\\Gamma]) & \\text { if } \\sup _{\\mathbb{P} \\in \\mathcal{G}} \\mathbb{E}_{\\mathbb{P}}[\\tilde{\\nu}] \\leq \\Gamma \\\\ \\sup _{\\mathbb{P} \\in \\mathcal{G}} \\mathbb{E}_{\\mathbb{P}}[\\tilde{\\nu} / \\Gamma] & \\text { otherwise } \\end{array}\\right. $

### Theorem 1

> For a given type of resource with capacity $ \\Gamma $, let $ \\tilde{\\nu}_{\\mu} $ represent a non-negative random resource usage, whose distribution belongs to a family of probability distributions parameterized by $ \\mu $ such that 
> 
> 1. $ C_{\\infty}\\left[\\tilde{\\nu}_{\\mu}\\right]=\\mu $,
>
> 2. $ C_{0}\\left[\\tilde{\\nu}_{\\mu}\\right]>\\Gamma $ for all $ \\mu>0 $, and
> 
> 3. $ C_{\\alpha}\\left[\\tilde{\\nu}_{\\mu}\\right] $ is increasing in $ \\mu $ for given $ \\alpha \\in(0, \\infty) $.
> Define
> 
> $g_{\\alpha}(\\mu) \\triangleq C_{\\alpha}\\left[\\tilde{\\nu}_{\\mu}\\right]$
> 
> Then, the calibration function $ \\Phi_{\\Gamma}:[0, \\infty] \\mapsto[0,1] $,
> $\\Phi_{\\Gamma}(\\alpha) \\triangleq\\left\\{\\begin{array}{ll}0 & \\text { if } \\alpha=0 \\\\g_{\\alpha}^{-1}(\\Gamma) / \\Gamma & \\text { if } \\alpha \\in(0, \\infty) \\\\1 & \\text { if } \\alpha=\\infty\\end{array}\\right.$
> 
> is continuous and increasing in $ \\alpha \\in[0, \\infty] $. Moreover,
> 
> $\\rho\\left(\\tilde{\\nu}_{\\mu}, \\Gamma\\right)=\\sup _{\\mathbb{P} \\in \\mathcal{G}} \\mathbb{E}_{\\mathbb{P}}\\left[\\tilde{\\nu}_{\\mu} / \\Gamma\\right] .$

### Theorem 2

> Theorem 2. The RSI is a lower semi-continuous measure that has the following properties. For any $ \\Gamma>0 $, and random usages, $ \\tilde{\\nu}, \\tilde{\\nu}_{1}, \\tilde{\\nu}_{2} $, we have
> 
> 1. Monotonicity: $ \\rho\\left(\\tilde{\\nu}_{1}, \\Gamma\\right) \\geq \\rho\\left(\\tilde{\\nu}_{2}, \\Gamma\\right) $ if $ \\tilde{\\nu}_{1} \\geq \\tilde{\\nu}_{2} $.
> 
> 2. Quasi-convexity: $ \\rho\\left(\\lambda \\tilde{\\nu}_{1}+(1-\\lambda) \\tilde{\\nu}_{2}, \\Gamma\\right) \\leq \\max \\left\\{\\rho\\left(\\tilde{\\nu}_{1}, \\Gamma\\right), \\rho\\left(\\tilde{\\nu}_{2}, \\Gamma\\right)\\right\\} $.
> 
> 3. Excess utilization: if $ \\sup _{\\mathbb{P} \\in \\mathcal{G}} \\mathbb{E}_{\\mathbb{P}}[\\tilde{\\nu}]>\\Gamma $, then $ \\rho(\\tilde{\\nu}, \\Gamma)=\\sup _{\\mathbb{P} \\in \\mathcal{G}} \\mathbb{E}_{\\mathbb{P}}[\\tilde{\\nu} / \\Gamma]>1 $.
> 
> 4. Risk-free: if $ \\tilde{\\nu} \\leq \\Gamma $, then $ \\rho(\\tilde{\\nu}, \\Gamma)=0 $.

# Resource Satisficing Optimizing Problem 

### MIP formulation, bisection search and Benders’ decomposition

Resource satisficing advance admission scheduling problem:

#### (4)

$ \\begin{aligned} \\beta^{*}=\\min & \\beta \\\\ \\text { s.t. } & \\rho_{k}\\left(\\tilde{\\nu}_{t k}, \\Gamma_{t k}\\right) \\leq \\beta \\phi_{k} \\quad \\forall t \\in[T], \\forall k \\in[K], \\\\ & (\\boldsymbol{x}, \\boldsymbol{y}) \\in \\mathcal{X},\\end{aligned} $

where:

$ \\mathcal{X}=\\left\\{\\begin{array}{l|l}(\\boldsymbol{x}, \\boldsymbol{y}) & \\begin{array}{l}\\sum_{t \\in[T]} x_{\\ell t}=1 \\forall \\ell \\in \\mathcal{A}, \\\\ x_{\\ell t} \\in\\{0,1\\} \\forall \\ell \\in \\mathcal{A}, \\forall t \\in[T], \\\\ \\sum_{t \\in[T]} y_{i t r}=1 \\forall i \\in[I], \\forall r \\in[R], \\\\ y_{i t r} \\in\\{0,1\\} \\forall i \\in[I], \\forall t \\in[T], \\forall r \\in[R], \\\\ \\text { other mixed-integer constraints on } \\boldsymbol{x}, \\boldsymbol{y}\\end{array}\\end{array}\\right\\} $

### Theorem 3

> There exists some feasible solution $ (\\boldsymbol{x}, \\boldsymbol{y}) \\in \\mathcal{X} $ to Problem (4) for a fixed $ \\beta $ if and only if the optimal solution $ \\gamma^{*} $ to Problem (5) satisfies $ \\gamma^{*} \\leq 0 $. 
> 
> #### (5)
> 
> $ \\begin{array}{ll} \\min & \\gamma \\\\ \\text { s.t. } & w_{t k}(\\infty)+\\sum_{\\ell \\in \\mathcal{A}} \\sum_{\\tau \\in[t]} x_{\\ell \\tau} s_{\\ell k}^{t-\\tau}(\\infty)+\\sum_{i \\in[I]} \\sum_{\\tau \\in[t]} \\sum_{r \\in[R]} y_{i \\tau r} u_{i t r k}^{t-\\tau}(\\infty)-\\Gamma_{t k} \\beta \\phi_{k} \\leq \\gamma \\quad \\forall k \\in \\mathcal{K}_{1}, t \\in[T], \\\\ & w_{t k}\\left(\\alpha_{t k}\\right)+\\sum_{\\ell \\in \\mathcal{A}} \\sum_{\\tau \\in[t]} x_{\\ell \\tau} s_{\\ell k}^{t-\\tau}\\left(\\alpha_{t k}\\right)+\\sum_{i \\in[I]} f_{i t k}\\left(\\alpha_{t k}, \\boldsymbol{y}_{i}\\right)-\\Gamma_{t k} \\leq \\gamma \\quad \\forall k \\in \\mathcal{K}_{2}, t \\in[T] \\\\ & (\\boldsymbol{x}, \\boldsymbol{y}) \\in \\mathcal{X} \\end{array} $ 
> 
> where 
> 
> $ \\mathcal{K}_{1}=\\left\\{k: \\beta \\phi_{k} \\geq 1\\right\\}, \\mathcal{K}_{2}=\\left\\{k: \\beta \\phi_{k}<1\\right\\}, \\boldsymbol{y}_{i}=\\left(y_{i 11}, \\ldots, y_{i T R}\\right)^{\\prime} ; $ 
> 
> in addition, 
> 
> $ \\alpha_{t k} \\triangleq \\Phi_{\\Gamma_{t k}}^{-1}\\left(\\beta \\phi_{k}\\right), w_{t k}(\\alpha) \\triangleq C_{\\alpha}\\left[\\tilde{w}_{t k}\\right], s_{\\ell k}^{d}(\\alpha) \\triangleq C_{\\alpha}\\left[\\tilde{s}_{\\ell t k}^{d}\\right], u_{i t r k}^{d}(\\alpha) \\triangleq C_{\\alpha}\\left[\\tilde{u}_{i k r}^{d}\\right] $ 
> 
> and 
> 
> $ f_{i t k}\\left(\\alpha, \\boldsymbol{y}_{i}\\right) \\triangleq \\alpha \\log \\left(\\sum_{r \\in[R]} p_{r} \\exp \\left(\\sum_{\\tau \\in[t]} y_{i \\tau r} \\frac{u_{i t r}^{t-\\tau}(\\alpha)}{\\alpha}\\right)\\right) $

### Proposition 1

> For any $ \\boldsymbol{y} \\in \\mathbb{R}^{T \\times R} $,
>
> #### (6)
> 
> $f_{i t k}(\\alpha, \\boldsymbol{y})=\\max _{\\boldsymbol{v} \\in \\mathbb{R} T \\times R}\\left\\{f_{i t k}(\\alpha, \\boldsymbol{v})+\\sum_{r \\in[R]} \\sum_{\\tau \\in[t]} g_{i t r k}^{\\tau}(\\alpha, \\boldsymbol{v})\\left(y_{\\tau r}-v_{\\tau r}\\right)\\right\\}$
>
> where
> 
> $g_{i t r k}^{\\tau}(\\alpha, \\boldsymbol{v})=\\frac{p_{r} u_{i t r k}^{t-\\tau}(\\alpha) \\exp \\left(\\sum_{\\tau_{1} \\in[t]} v_{\\tau_{1} r} u_{i t r k}^{t-\\tau_{1}}(\\alpha) / \\alpha\\right)}{\\sum_{m \\in[R]} p_{m} \\exp \\left(\\sum_{\\tau_{2} \\in[t]} v_{\\tau_{2} m} u_{i t m k}^{t-\\tau_{2}}(\\alpha) / \\alpha\\right)}$
> 
> is the first order derivative of $ f_{i t k}(\\alpha, \\boldsymbol{v}) $ with respect to $ v_{\\tau r} $. The worst-case of Problem (6) occurs when $ \\boldsymbol{v}=\\boldsymbol{y} $.

### BD Algorithm

1. Initialize $ \\mathcal{Y}=\\emptyset $ and input fixed $ \\beta $.

2. Solve the following subproblem:
$
\\begin{array}{l}
\\text { min } \\gamma \\\\
\\text { s.t. } w_{t k}(\\infty)+\\sum_{\\ell \\in \\mathcal{A}} \\sum_{\\tau \\in[t]} x_{\\ell \\tau} s_{\\ell k}^{t-\\tau}(\\infty)+\\sum_{i \\in[I]} \\sum_{\\tau \\in[t]} \\sum_{r \\in[R]} y_{i \\tau r} u_{i t r k}^{t-\\tau}(\\infty)-\\Gamma_{t k} \\beta \\phi_{k} \\leq \\gamma \\quad \\forall k \\in \\mathcal{K}_{1}, t \\in[T], \\\\
w_{t k}\\left(\\alpha_{t k}\\right)+ \\\\
\\sum_{\\ell \\in \\mathcal{A}} \\sum_{\\tau \\in[t]} x_{\\ell \\tau} s_{\\ell k}^{t-\\tau}\\left(\\alpha_{t k}\\right)+\\sum_{i \\in[I]} f_{i t k}\\left(\\alpha_{t k}, \\boldsymbol{v}_{i}\\right) \\\\
\\\\
+\\sum_{i \\in[I]} \\sum_{\\tau \\in[t]} \\sum_{r \\in[R]} g_{i t r k}^{\\tau}\\left(\\alpha_{k}, \\boldsymbol{v}_{i}\\right)\\left(y_{i \\tau r}-v_{i \\tau r}\\right)-\\Gamma_{t k} \\leq \\gamma \\quad \\forall k \\in \\mathcal{K}_{2}, t \\in[T], \\boldsymbol{v} \\in \\mathcal{Y}, \\\\
(\\boldsymbol{x}, \\boldsymbol{y}) \\in \\mathcal{X} .
\\end{array}
$

If $ \\gamma^{*} \\leq 0 $, then record the optimal decisions $ \\left(\\boldsymbol{x}^{*}, \\boldsymbol{y}^{*}\\right) $ and go to the next step. Otherwise, we can conclude that $ \\beta<\\beta^{*} $, and we terminate this Benders decomposition procedure.

3. Check if
$
w_{t k}\\left(\\alpha_{k}\\right)+\\sum_{\\ell \\in \\mathcal{A}} \\sum_{\\tau \\in[t]} x_{\\ell \\tau}^{*} s_{\\ell k}^{t-\\tau}\\left(\\alpha_{k}\\right)+\\sum_{i \\in[I]} f_{i t k}\\left(\\alpha_{k}, \\boldsymbol{y}_{i}^{*}\\right)-\\Gamma_{t k} \\leq 0 \\quad \\forall k \\in \\mathcal{K}_{2}, t \\in[T] .
$

If it is true, go to the next step. Otherwise, include $ \\boldsymbol{y}^{*} $ in $ \\mathcal{Y} $ and return to step 2.

4. We conclude that $ \\beta \\geq \\beta^{*} $ and terminate this procedure.



当然，我可以根据您提供的查询和(4)式子，举一个完全符合的例子来说明资源满足优化问题在提前入院调度中的应用。以下是一个简化的医院资源调度场景，逐步展示如何构建并求解这个问题。

---

### 场景描述

假设一家医院需要为患者安排入院时间，考虑两种资源：**床位**（资源1）和**手术室**（资源2）。医院需要调度已知的需求患者（$\\mathcal{A}$）和潜在的未来患者（$[I]$），同时考虑患者类型（$[R]$）和资源容量限制。以下是具体参数：

- **时间范围**：$T = 3$ 天（即调度3天的入院计划）。
- **资源类型**：$K = 2$（床位和手术室）。
- **需求患者**：$\\mathcal{A} = \\{1, 2\\}$（两个已知患者）。
- **潜在患者**：$I = 2$（两个潜在未来患者）。
- **患者类型**：$R = 2$（例如，类型1为非手术患者，类型2为手术患者）。

#### 资源容量
- 床位容量：$\\Gamma_{t1} = 10$（每天10张床位），对于所有 $t \\in [3]$。
- 手术室容量：$\\Gamma_{t2} = 5$（每天5个手术室），对于所有 $t \\in [3]$。
- 容量相关参数：$\\phi_1 = 1$（床位），$\\phi_2 = 1$（手术室）。

---

### 决策变量

我们需要决定每个患者的入院时间：

1. **需求患者调度**：
   - $x_{\\ell t}$：对于每个需求患者 $\\ell \\in \\mathcal{A}$ 和每一天 $t \\in [T]$，$x_{\\ell t} = 1$ 表示患者 $\\ell$ 在第 $t$ 天入院，否则为 0。

2. **潜在患者调度**：
   - $y_{itr}$：对于每个潜在患者 $i \\in [I]$，每一天 $t \\in [T]$，和每种类型 $r \\in [R]$，$y_{itr} = 1$ 表示如果潜在患者 $i$ 是类型 $r$，则在第 $t$ 天入院，否则为 0。

---

### 假设的资源使用量

为了简化示例，假设所有随机变量（如资源使用量）是确定的（即没有不确定性），这样 $\\tilde{\\nu}_{tk}$ 变为确定的 $\\nu_{tk}$。以下是患者对资源的使用：

#### 需求患者（$\\mathcal{A}$）
- **患者1**：
  - 入院当天（$d=0$）：使用2张床位，0个手术室。
  - 入院次日（$d=1$）：使用1张床位，0个手术室。
- **患者2**：
  - 入院当天（$d=0$）：使用1张床位，1个手术室。
  - 入院次日（$d=1$）：使用1张床位，0个手术室。

#### 潜在患者（$[I]$）
- **潜在患者1和2**（取决于类型 $r$）：
  - 类型1（非手术患者，$r=1$）：
    - 入院当天（$d=0$）：使用1张床位，0个手术室。
  - 类型2（手术患者，$r=2$）：
    - 入院当天（$d=0$）：使用1张床位，1个手术室。

#### 紧急患者
- 假设紧急患者的资源使用为0（简化假设），即 $\\tilde{w}_{tk} = 0$。

---

### 约束条件

根据(4)式子和 $\\mathcal{X}$ 的定义，约束如下：

1. **需求患者入院约束**：
   $$
   \\sum_{t \\in [T]} x_{\\ell t} = 1 \\quad \\forall \\ell \\in \\mathcal{A}
   $$
   每个需求患者必须且仅在某一天入院。例如：
   - $x_{11} + x_{12} + x_{13} = 1$（患者1）。
   - $x_{21} + x_{22} + x_{23} = 1$（患者2）。

2. **潜在患者入院约束**：
   $$
   \\sum_{t \\in [T]} y_{itr} = 1 \\quad \\forall i \\in [I], \\forall r \\in [R]
   $$
   对于每种类型，每个潜在患者必须在某一天入院。例如：
   - $y_{111} + y_{121} + y_{131} = 1$（潜在患者1，类型1）。
   - $y_{112} + y_{122} + y_{132} = 1$（潜在患者1，类型2）。

3. **资源使用量**：
   根据公式(2)：
   $$
   \\tilde{\\nu}_{tk} = \\tilde{w}_{tk} + \\sum_{\\tau \\in [t]} \\sum_{\\ell \\in \\mathcal{A}} \\tilde{s}_{\\ell k}^{t-\\tau} x_{\\ell \\tau} + \\sum_{\\tau \\in [t]} \\sum_{i \\in [I]} \\sum_{r \\in [R]} \\tilde{u}_{ikr}^{t-\\tau} y_{i\\tau r} \\mathbb{1}(\\tilde{r}_i = r)
   $$
   因为假设 $\\tilde{w}_{tk} = 0$ 且无随机性，$\\tilde{\\nu}_{tk}$ 简化为确定的 $\\nu_{tk}$。例如：
   - **第1天床位使用**（$t=1, k=1$）：
     $$
     \\nu_{11} = 2 x_{11} + 1 x_{21} + 1 y_{111} \\mathbb{1}(\\tilde{r}_1 = 1) + 1 y_{112} \\mathbb{1}(\\tilde{r}_1 = 2) + 1 y_{211} \\mathbb{1}(\\tilde{r}_2 = 1) + 1 y_{212} \\mathbb{1}(\\tilde{r}_2 = 2)
     $$
   - **第1天手术室使用**（$t=1, k=2$）：
     $$
     \\nu_{12} = 1 x_{21} + 1 y_{112} \\mathbb{1}(\\tilde{r}_1 = 2) + 1 y_{212} \\mathbb{1}(\\tilde{r}_2 = 2)
     $$

4. **资源满足约束**：
   $$
   \\rho_k(\\tilde{\\nu}_{tk}, \\Gamma_{tk}) \\leq \\beta \\phi_k \\quad \\forall t \\in [T], \\forall k \\in [K]
   $$
   由于资源使用是确定的，$\\rho_k(\\nu_{tk}, \\Gamma_{tk})$ 定义如下：
   - 若 $\\nu_{tk} \\leq \\Gamma_{tk}$，则 $\\rho_k(\\nu_{tk}, \\Gamma_{tk}) = 0$。
   - 若 $\\nu_{tk} > \\Gamma_{tk}$，则 $\\rho_k(\\nu_{tk}, \\Gamma_{tk}) = \\nu_{tk} / \\Gamma_{tk}$。

   因此，约束变为：
   - $\\nu_{t1} \\leq 10 \\beta$（床位）。
   - $\\nu_{t2} \\leq 5 \\beta$（手术室）。

---

### 目标

根据(4)式子，目标是最小化 $\\beta$：
$$
\\beta^* = \\min \\beta
$$
使得所有资源在所有天数的资源满足指数不超过 $\\beta \\phi_k$。

---

### 具体调度示例

让我们尝试一个可行调度，并计算 $\\beta$：

#### 调度方案
- **需求患者**：
  - 患者1在第1天入院：$x_{11} = 1$，$x_{12} = x_{13} = 0$。
  - 患者2在第2天入院：$x_{22} = 1$，$x_{21} = x_{23} = 0$。
- **潜在患者**（假设最坏情况，即资源使用最大化）：
  - 潜在患者1：
    - 类型1：第1天入院（$y_{111} = 1$）。
    - 类型2：第1天入院（$y_{112} = 1$）。
  - 潜在患者2：
    - 类型1：第2天入院（$y_{221} = 1$）。
    - 类型2：第2天入院（$y_{222} = 1$）。

#### 计算资源使用
- **第1天**：
  - 床位：$\\nu_{11} = 2 x_{11} + 1 y_{111} + 1 y_{112} = 2 + 1 + 1 = 4$。
  - 手术室：$\\nu_{12} = 1 y_{112} = 1$。
- **第2天**：
  - 床位：$\\nu_{21} = 1 x_{11} + 1 x_{22} + 1 y_{221} + 1 y_{222} = 1 + 1 + 1 + 1 = 4$。
  - 手术室：$\\nu_{22} = 1 x_{22} + 1 y_{222} = 1 + 1 = 2$。
- **第3天**：
  - 床位：$\\nu_{31} = 1 x_{22} = 1$。
  - 手术室：$\\nu_{32} = 0$。

#### 检查约束
- 床位：$\\nu_{11} = 4 \\leq 10\\beta$，$\\nu_{21} = 4 \\leq 10\\beta$，$\\nu_{31} = 1 \\leq 10\\beta$。
- 手术室：$\\nu_{12} = 1 \\leq 5\\beta$，$\\nu_{22} = 2 \\leq 5\\beta$，$\\nu_{32} = 0 \\leq 5\\beta$。

所有使用量均小于容量，$\\rho_k = 0$，但我们需要 $\\beta$ 尽量小。最大使用率为：
- 床位：$4 / 10 = 0.4$。
- 手术室：$2 / 5 = 0.4$。

因此，$\\beta \\geq 0.4$ 是可行的最小值。

---

### 求解结果

通过优化(4)式子，最优 $\\beta^* = 0.4$，表示资源满足指数的最大值为0.4，确保所有资源在所有天数上都不会超载。这个例子展示了如何将资源满足优化问题应用于医院调度，平衡已知和潜在患者的需求。`,__vite_glob_0_9=`---
title: Business Paper - Week 1
---


# 2 Environment

Product: unknown to both side

Rating system:

- Collect from previous customers
- provide a rating
- new customers observe it
- purchase with ex ante type
- ex post preference

## 2.1 Customers' Problem, Rating System

$Q\\in\\{0, 1\\}$: True quality of the product

$t\\in\\mathbb{N}$: new customerm arrive time

$u_t = \\theta_t + \\zeta_t + Q - p\\quad (1)$: **material utility** of customer $t$

- $\\theta_t$: ex ante type of the customer
  - independently continuous $F_\\theta$
- $\\zeta_t$: ex post idiosyncratic preference term
  - independently continuous $F_\\zeta$
  - sometimes combined $F_{\\theta, \\zeta}$
- $p$: price of the product
- $\\theta_t, \\zeta_t$: customer private info

Procedure:

- $t$ observe rating and $\\theta_t$
- whether to by
- if buy: experience **material utility**
- $r_t$: review
  - $-\\underline{K},\\dots,\\overline{K}$: reviews
  - $\\mathcal{R} = \\{-\\underline{K},\\dots,\\overline K \\}$
  - $\\overline K$: like, $-\\underline K $ : dislike
- $b_t$: purchase decision
- $r_t$: review decision
- $a_t\\in \\mathcal{R}\\cup \\{ N \\}$: action
  - $a_t = N$: no purchase ($b_t$ = 0)
- $\\mathcal A = \\mathcal R \\cup \\{ N \\}$: set of actions
- $h_t = \\{ a_1,\\dots,a_{t-1}\\}$: history ($h_1 = \\oslash$)
- $\\mathbf\\Omega$: rating system
  - $\\Omega_t$: rating avaliable to $t$

---

### Purchase decision

- $t$ observe $\\Omega_t$
- $B_t :\\Omega_t\\times\\mathbb R^3\\rightarrow\\{0, 1\\}$: purchase decision
  - rating system & ex ante type $\\theta_t$ & ex post idiosyncratic preference $\\zeta_t$ & price $p$
- $\\mathbf B = \\{ B_t\\} ^ \\infty_{t = 1}$: collection of purchase decision strategies
  - $B_t(\\Omega_t, \\theta_t) = 1\\quad$if and only if$\\quad \\theta_t + \\mathbb E \\left[\\zeta_t\\right] + q_t - p \\ge 0$: Bayes-Nash equilibrium
  - $q_t = \\mathbb P _{\\{(\\theta_S, \\zeta_S\\}_{S=1}^{t-1}}\\left[Q=1\\mid\\Omega_t\\right] \\quad$ <p id = "2">(2)</p>: the belief of $t$

## 2.2 Review decision

$\\lambda_{-\\underline K }\\le \\dots\\le \\lambda_{-1}\\le \\lambda_1\\le\\dots\\le\\lambda_{\\overline K} \\in \\mathbb R$: threshold

$$
r_{t}=\\left\\{\\begin{array}{ll}
-\\underline{K} & \\text { if } u_{t}<\\lambda_{-\\underline{K}}, \\\\
i & \\text { if } \\lambda_{i-1} \\leq u_{t}<\\lambda_{i}, -\\underline{K} < i < 0, \\\\
0 & \\text { if } \\lambda_{-1} \\leq u_{t}<\\lambda_{1}, \\\\
i & \\text { if } \\lambda_{i} \\leq u_{t}<\\lambda_{i+1}, 0 < i < \\overline{K}, \\\\
\\bar{K} & \\text { if } u_{t} \\geq \\lambda_{\\bar{K}} .
\\end{array}\\right.\\quad (3)
$$

---

#### Assumption 1 - Richness

$\\theta, \\zeta$, random variable, drawn from $\\left[\\underline \\theta, \\overline\\theta\\right], \\left[\\underline \\zeta, \\overline\\zeta\\right]$, so that

- $\\overline\\zeta + \\overline\\theta - p > \\lambda\\_{\\overline K}, $
- $\\underline\\zeta+\\overline\\theta - p + 1 < \\lambda_{-\\underline K}$

why $\\overline\\theta$ ?

- lower may not purchase
- $Q = 0$ for most favorable review, $Q = 1$ for least favorable review , these are not fully revealing ablout the quality

#### Remark 1

---

# 3 Full history

- $\\Omega_t = h_t$

## 3.1 Learning Dynamics

[(2)](#2) becomes:

$q_t = \\mathbb P _{\\{(\\theta_S, \\zeta_S\\}_{S=1}^{t-1}}\\left[Q=1\\mid h_t\\right]$

$l_t = \\dfrac{q_t}{1-q_t} = \\dfrac{\\mathbb P_{\\{(\\theta_S,\\zeta_S)\\}_{S=1}^{t-1}}[Q=1\\mid h_t]}{\\mathbb P_{\\{(\\theta_S,\\zeta_S)\\}^{t-1}_{S=1}}[Q=0\\mid h_t]}$ <p id = "4">(4)</p> : associated likelihood ratio

$\\pi(a;F_{\\theta,\\zeta},Q,q)$: probability of action $a\\in \\mathcal A$,

- given joint distribution of $\\theta, \\zeta$
- price $p$
- thesholds when true quality is $Q$, belief is $q$

$$
\\begin{array}{l}
\\pi\\left(a ; F_{\\theta, \\zeta}, Q, q\\right) \\\\
\\quad=\\left\\{\\begin{array}{ll}
\\mathbb{P}_{\\theta, \\zeta}[q+\\theta+\\mathbb{E}[\\zeta]-p<0], & \\text { for } a=N, \\\\
\\mathbb{P}_{\\theta, \\zeta}\\left[q+\\theta+\\mathbb{E}[\\zeta]-p \\geq 0, \\theta+\\zeta+Q-p<\\lambda_{-\\underline{K}}\\right], & \\text { for } a=-\\underline{K}, \\\\
\\mathbb{P}_{\\theta, \\zeta}\\left[q+\\theta+\\mathbb{E}[\\zeta]-p \\geq 0, \\lambda_{a-1} \\leq \\theta+\\zeta+Q-p<\\lambda_{a}\\right], & \\text { for }-\\underline{K} < a < 0, \\\\
\\mathbb{P}_{\\theta, \\zeta}\\left[q+\\theta+\\mathbb{E}[\\zeta]-p \\geq 0, \\lambda_{-1} \\leq \\theta+\\zeta+Q-p<\\lambda_{1}\\right], & \\text { for } a=0, \\\\
\\mathbb{P}_{\\theta, \\zeta}\\left[q+\\theta+\\mathbb{E}[\\zeta]-p \\geq 0, \\lambda_{a} \\leq \\theta+\\zeta+Q-p<\\lambda_{a+1}\\right], & \\text { for } 0 < a < \\bar{K}, \\\\
\\mathbb{P}_{\\theta, \\zeta}\\left[q+\\theta+\\mathbb{E}[\\zeta]-p \\geq 0, \\theta+\\zeta+Q-p \\geq \\lambda_{\\bar{K}}\\right], & \\text { for } a=\\bar{K} .
\\end{array}\\right.
\\end{array}
$$

$\\mathbf \\pi (F_{\\theta,\\zeta},Q,q) = (\\pi(a;F_{\\theta,\\zeta},Q,q): a\\in\\mathcal A)$: vector of probabilities

$$
\\begin{aligned}
l_{t} & =\\frac{q_{t}}{1-q_{t}}=\\frac{\\mathbb{P}_{\\left\\{\\left(\\theta_{s}, \\zeta_{s}\\right)\\right\\}_{s=1}^{t-1}}\\left[Q=1 \\mid h_{t}\\right]}{\\mathbb{P}_{\\left\\{\\left(\\theta_{s}, \\zeta_{s}\\right)\\right\\}_{s=1}^{t-1}}^{t-1}\\left[Q=0 \\mid h_{t}\\right]}=\\frac{\\mathbb{P}_{\\left\\{\\left(\\theta_{s}, \\zeta_{s}\\right) \\zeta_{s=1}^{t-1}\\right.}\\left[h_{t} \\mid Q=1\\right]}{\\mathbb{P}_{\\left\\{\\left(\\theta_{s}, \\zeta_{s}\\right)\\right\\}_{s=1}^{t-1}}^{t h}\\left[h_{t} \\mid Q=0\\right]} \\\\
& =\\prod_{s=1}^{t-1} \\frac{\\pi\\left(a_{s} ; F_{\\theta, \\zeta}, Q=1, q_{s}\\right)}{\\pi\\left(a_{s} ; F_{\\theta, \\zeta}, Q=0, q_{s}\\right)}
\\end{aligned}
$$

<p id = "5">(5)</p>

#### More detailed on (5)

$\\dfrac{\\mathbb P [Q=1\\mid h_t]}{\\mathbb P [Q=0 \\mid h_t]} = \\dfrac{\\mathbb P [h_t \\mid Q = 1]\\mathbb P [Q=1]}{\\mathbb P [h_t \\mid Q = 0]\\mathbb P [Q = 0]}$

using that $\\mathbb P [Q=  1] = \\mathbb P [Q = 0]$ we get the third equation

$\\mathbb P[h_t \\mid Q ] = \\prod_{s = 1}^{t -1} \\mathbb P [a_s \\mid Q ] $, notice that $h_t$ is composed from $a_s$,

$\\mathbb P [a_s \\mid Q ] = \\pi (a_s; F_{\\theta,\\zeta}, Q, q_s)$ with this we get the fourth equation.

---

$l_{t+1} = l_t \\times \\dfrac{\\pi(a_t; F_{\\theta, \\zeta}, Q = 1, q_t)}{\\pi (a_t; F_{\\theta, \\zeta}, Q = 0, q_t )}$

$l_{t+1} = l_t \\times \\dfrac{\\pi(a_t; F_{\\theta, \\zeta}, Q = 1, q_t)}{\\pi (a_t; F_{\\theta, \\zeta}, Q = 0, q_t )}, \\quad \\text{w.p. } \\pi(a_t; F_{\\theta,\\zeta}, Q, q_t), a\\in \\mathcal A \\text { for } t \\ge 1$

## 3.2 Complete learning

### Theorem 1:

If $\\overline\\theta + \\mathbb E [\\zeta] - p \\ge 0, q_1 \\in(0, 1)$, then $q_t\\rightarrow Q$ almost surely

Proof

$Z(a_t | l_t ) = \\dfrac{\\pi (a_t ; F_{\\theta, \\zeta}, Q = 1, q = q_t ) }{ \\pi ( a*t ; F*{\\theta, \\zeta}, Q = 0, q = q_t)}, \\forall a_t \\in \\mathcal A, $<p id = "A-1">(A-1)</p>

: likelihood ratio

#### Part 1 : when $\\overline \\theta + \\mathbb E [\\zeta] - p > 0$

$$
\\begin{aligned}
& \\mathbb{E}_{a \\sim \\pi\\left(F_{\\theta, \\zeta}, Q=0, q=q_{t}\\right)}\\left[Z\\left(a \\mid l_{t}\\right) \\mid h_{t}\\right] \\\\
& =\\mathbb{E}_{a \\sim \\pi\\left(F_{\\theta, \\zeta}, Q=0, q=q_{t}\\right)}\\left[\\frac{\\pi\\left(a ; F_{\\theta, \\zeta}, Q=1, q=q_{t}\\right)}{\\pi\\left(a ; F_{\\theta, \\zeta}, Q=0, q=q_{t}\\right)}\\right] \\\\
& =\\sum_{a \\in \\mathcal A }\\pi(F_{\\theta,\\zeta}, Q = 0, q = q_t)\\left[\\frac{\\pi\\left(a ; F_{\\theta, \\zeta}, Q=1, q=q_{t}\\right)}{\\pi\\left(a ; F_{\\theta, \\zeta}, Q=0, q=q_{t}\\right)}\\right] \\\\
& =\\sum_{a \\in \\mathcal{A}} \\pi\\left(a ; F_{\\theta, \\zeta}, Q=1, q=q_{t}\\right)\\\\
& =1 .
\\end{aligned}
$$

$$
\\begin{aligned}
&\\mathbb E [l_{t + 1} \\mid\\mathcal F_t]\\\\
&= \\mathbb E [l_t \\times Z(a_t\\mid l_t)\\mid \\mathcal F_t]\\\\
&=\\mathbb E[l_t \\mid \\mathcal F_t ] = l_t\\\\
&\\Rightarrow l_t\\text{ forms a martingale}
\\end{aligned}
$$

$l_t = \\dfrac{q_t}{1-q_t} < \\infty, l_t \\ge 0$

---

#### Martingale convergence theorem

**Statement:**

$\\{X_n\\}_{n=1}^\\infty$ is a submartingale (or martingale, or supermartingale) with respect to a filtration $\\{\\mathcal{F}_n\\}$.

Suppose one of the following conditions holds:

1. $\\{X_n\\}$ is bounded in $L^1$, i.e., $\\sup_n \\mathbb{E}[|X_n|] < \\infty$.

2. $\\{X_n\\}$ is bounded almost surely, i.e., there exists a constant $K$ such that $|X_n| \\leq K$ almost surely for all $n$.

3. $\\{X_n\\}$ is a non-negative supermartingale, i.e., $X_n \\geq 0$ almost surely for all $n$.

Then, $\\{X_n\\}$ converges almost surely (a.s.) to a limit $X_\\infty$ as $n \\to \\infty$.

If, in addition, $\\{X_n\\}$ is uniformly integrable, then $X_\\infty$ is integrable, and
$
\\lim_{n \\to \\infty} \\mathbb{E}[|X_n - X_\\infty|] = 0.
$

---

$l_t \\rightarrow l_\\infty$ almost surely

$$
\\begin{aligned}
& Z\\left(a=\\bar{K} \\mid l_{t}\\right) \\\\
& =\\frac{\\pi\\left(a=\\bar{K} ; F_{\\theta, \\zeta}, Q=1, q=q_{t}\\right)}{\\pi\\left(a=\\bar{K} ; F_{\\theta, \\zeta}, Q=0, q=q_{t}\\right)} \\\\
& =\\frac{\\mathbb{P}_{\\theta, \\zeta}\\left[q_{t}+\\theta+\\mathbb{E}[\\zeta]-p \\geq 0, \\theta+\\zeta+1-p \\geq \\lambda_{\\bar{K}}\\right]}{\\mathbb{P}_{\\theta, \\zeta}\\left[q_{t}+\\theta+\\mathbb{E}[\\zeta]-p \\geq 0, \\theta+\\zeta-p \\geq \\lambda_{\\bar{K}}\\right]} \\\\
& \\text{notice the over part is >= -1 and the below part is >= 0} \\\\
& =1+\\frac{\\mathbb{P}_{\\theta, \\zeta}\\left[q_{t}+\\theta+\\mathbb{E}[\\zeta]-p \\geq 0, \\theta+\\zeta-p-\\lambda_{\\bar{K}} \\in[-1,0)\\right]}{\\mathbb{P}_{\\theta, \\zeta}\\left[q_{t}+\\theta+\\mathbb{E}[\\zeta]-p \\geq 0, \\theta+\\zeta-p-\\lambda_{\\bar{K}} \\geq 0\\right]} \\\\
& \\text{let over part q is 0, below part q is 1}\\\\
& \\geq 1+\\frac{\\mathbb{P}_{\\theta, \\zeta}\\left[\\theta+\\mathbb{E}[\\zeta]-p \\geq 0, \\theta+\\zeta-p-\\lambda_{\\bar{K}} \\in[-1,0)\\right]}{\\mathbb{P}_{\\theta, \\zeta}\\left[1+\\theta+\\mathbb{E}[\\zeta]-p \\geq 0, \\theta+\\zeta-p-\\lambda_{\\bar{K}} \\geq 0\\right]},
\\end{aligned}
$$

Prove the upper part > 0 :

Let $\\Delta_1 = \\min \\{ 1, \\overline \\theta + \\mathbb E [\\zeta] - p\\} > 0$

$$
\\begin{array}{l}
\\mathbb{P}_{\\theta, \\zeta}\\left[\\theta+\\mathbb{E}[\\zeta]-p \\geq 0, \\theta+\\zeta-p-\\lambda_{\\bar{K}} \\in[-1,0)\\right] \\\\
\\quad \\stackrel{(a)}{\\geq} \\mathbb{P}_{\\theta, \\zeta}\\left[\\theta \\geq \\bar{\\theta}-\\Delta_{1}, p+\\lambda_{\\bar{K}}-\\theta-1 \\leq \\zeta \\leq p+\\lambda_{\\bar{K}}-\\theta\\right] \\\\
\\quad \\stackrel{(\\text { b) }}{>} 0,
\\end{array}
$$

<p id = "(A-2)">(A-2)</p>

for detailed (b), we have:

$$
\\begin{aligned}
&p+\\lambda_{\\overline K} - \\theta - 1 \\\\
&\\le p + \\lambda_{\\overline K} - \\overline \\theta + \\Delta_1 - 1\\\\
&\\le p + \\lambda_{\\overline K} - \\overline \\theta < \\overline \\zeta\\\\
\\\\
&p+\\lambda_{\\overline K} - \\theta - 1 \\\\
&\\ge p + \\lambda _{-\\underline K} - \\overline \\theta - 1 \\\\
&> \\underline \\zeta
\\end{aligned}
$$

(refer to [Assumption 1](#assumption-1---richness))

$\\min_l Z(a = \\overline K \\mid l) - 1 \\ge \\epsilon > 0$

$$
\\begin{aligned}
&\\mathbb P _{a\\sim \\mathbf \\pi (F_{\\theta,\\zeta}, Q = 0, q = q_t)}[|Z(a\\mid l_t )- 1 | \\ge \\epsilon \\mid l_t]\\\\
&\\ge \\pi ( a = \\overline K; F_{\\theta, \\zeta}, Q = 0, q = q_t)\\\\
&\\ge \\mathbb P_{\\theta, \\zeta}[q_t + \\theta + \\mathbb E[\\zeta] - p \\ge 0, \\theta + \\zeta - p \\ge \\lambda_{\\underline K }]\\\\
&\\ge \\mathbb P_{\\theta, \\zeta } [\\theta + \\mathbb [\\zeta] - p \\ge 0 , \\theta + \\zeta - p \\ge \\lambda_{\\overline K }]\\\\
&\\ge \\mathbb P_{\\theta, \\zeta } \\left[\\theta\\ge\\overline\\theta - \\dfrac{\\Delta _2}{2}, \\zeta\\ge \\overline\\zeta - \\dfrac{\\Delta_2}{2}\\right]\\\\
&> 0
\\end{aligned}
$$

where $\\Delta_2 = \\min\\{\\overline\\theta + \\mathbb E [\\zeta] - p,\\overline\\theta + \\overline\\zeta - p - \\lambda_{\\overline K }\\} > 0$

<p id = "(A-3)">(A-3)</p>

with [(A-2)](#(A-2)), [(A-3)](#(A-3)):
$$
\\begin{aligned}
&\\mathbb P_{\\{(\\theta_s,\\zeta_s)\\}^t_{s = 1}}[|l_{t+1} - l_t|\\ge\\delta\\epsilon]\\\\
&\\text{with } l_{t+1} = l_t\\cdot Z(\\cdot \\mid l_t)\\\\
& = \\mathbb E_{\\{(\\theta_s,\\zeta_s)\\}^t_{s = 1}}[\\mathbf 1\\{|l_t(Z(\\cdot\\mid l_t ) - 1)|\\ge \\delta\\epsilon\\}] \\\\
&\\ge  \\mathbb E_{\\{(\\theta_s,\\zeta_s)\\}^t_{s = 1}}[\\mathbf 1\\{l_t\\ge\\delta\\}\\mathbf 1 \\{|(Z(\\cdot\\mid l_t ) - 1)|\\ge \\epsilon\\}] \\\\
&=  \\mathbb E_{\\{(\\theta_s,\\zeta_s)\\}^t_{s = 1}}[\\mathbf 1\\{l_t\\ge\\delta\\}\\mathbb P_{\\theta, \\zeta } [\\mathbf |(Z(\\cdot\\mid l_t ) - 1)|\\ge \\epsilon \\mid l_t ]] \\\\
&\\ge\\eta\\mathbb E_{\\{(\\theta_s,\\zeta_s)\\}^t_{s = 1}} [ \\mathbf 1 \\{ l_t\\ge\\delta\\}] \\\\
&= \\eta\\mathbb E_{\\{(\\theta_s,\\zeta_s)\\}^t_{s = 1}} [l_t> \\delta]\\\\
\\end{aligned}
$$

$l_t\\rightarrow l_\\infty$ almost surely ( martingale convergence theorem ) $\\Rightarrow P_{\\{(\\theta_s,\\zeta_s)\\}^t_{s = 1}}[|l_{t+1} - l_t|\\ge\\delta\\epsilon]\\rightarrow 0 $

$\\Rightarrow P_{\\{(\\theta_s,\\zeta_s)\\}^t_{s = 1}}[|l_{t} > \\delta ]\\rightarrow 0$

$\\Rightarrow  l_t\\rightarrow 0 $ in probability

with $l_t\\rightarrow l_\\infty$ almost surely

$\\Rightarrow \\mathbb P[l_\\infty = 0] = 1$

notice $l_t = \\dfrac{q_t}{1 - q_t} \\Rightarrow q_t \\rightarrow 0$ almost surely $\\square$

this ends the part 1 proof

[return to part 1](#part-1--when-overline-theta--mathbb-e-zeta---p--0)

#### Part 2: when $\\overline\\theta + \\mathbb E[\\zeta] - p < 0$

Let $\\Delta = -(\\overline\\theta + \\mathbb E [\\zeta] - p) > 0$

notice $\\Delta > 1 \\Leftrightarrow \\overline + \\mathbb E[\\zeta] - p + q \\le -\\Delta + 1 < 0$, no purchase happen

$\\forall q \\ge \\Delta$, with [Assumption 1](#assumption-1---richness) and similar to [(A-2)](#(A-2))

$\\theta\\ge\\overline\\theta - ( 1 - \\Delta)$

$\\Rightarrow \\underline\\zeta < \\lambda_{-\\underline K} + p - \\overline\\theta - 1 \\le \\lambda_{-\\underline K } + p - \\theta - 1 \\le \\lambda_{\\overline K } + p - (\\overline\\theta - (1 - \\Delta)) - 1 < \\overline \\zeta$

$\\Rightarrow \\max _{q \\in[\\Delta, 1]} \\frac{\\mathbb{P}_{\\theta, \\zeta}\\left[\\theta+\\mathbb{E}[\\zeta]+q-p \\geq 0, \\theta+\\zeta+1-p \\leq \\lambda_{-\\underline{K}}\\right]}{\\mathbb{P}_{\\theta, \\zeta}\\left[\\theta+\\mathbb{E}[\\zeta]+q-p \\geq 0, \\theta+\\zeta-p \\leq \\lambda_{-\\underline{K}}\\right]}<1$

the over part and below part difference is bounded by:

$ \\mathbb{P}_{\\theta, \\zeta}\\left[\\theta \\geq \\bar{\\theta}-(1-\\Delta), \\lambda_{-\\underline{K}}+p-\\theta-1 \\leq \\zeta \\leq \\lambda_{-\\underline{K}}+p-\\theta\\right]>0 $

--- 

Theorem shows: 

- $ \\bar{\\theta}+\\mathbb{E}[\\zeta]-p \\geq 0 $ is sufficient for complete learning 
  - starting from any initial belief 
- when not hold:
  - for sufficiently pessimistic beliefs about $Q$(quality of product)
    - all customers stop buying it 

Notice:
- most positive assessment of expected utility: 
  - hightest ex ante valuation $\\bar \\theta $
  - $ \\bar{\\theta}+\\mathbb{E}[\\zeta]+q-p $
    - $ q $ is the public belief at the time of purchase

when: $ \\bar{\\theta}+\\mathbb{E}[\\zeta]-p<0 $

- notice whole will $<0$
  - once belief reach pessimistic level:
    - the most positive valuation stop purchasing
    - consequently beliefs remain stuck at $q$

#### Assumption 2: $ \\bar{\\theta}+\\mathbb{E}[\\zeta]-p>0 $ 

## 3.3 Speed of learning 

Characterize the speed of learning under full history 

Introduce KL(Kullback-Leibler) divergence 

#### Definition 1 : KL Divergence 

> $ D(\\boldsymbol{\\mu} \\| \\boldsymbol{\\nu})=\\sum_{i=1}^{m} \\mu_{i} \\log \\left(\\frac{\\mu_{i}}{\\nu_{i}}\\right) $

> - two strictly positive distributions :
>   - $ \\boldsymbol{\\mu}=\\left(\\mu_{1}, \\ldots\\right. $, $ \\left.\\mu_{m}\\right) $ 
>   - $ \\nu=\\left(\\nu_{1}, \\ldots, \\nu_{m}\\right) $
> - defined on a finite set $ \\{1, \\ldots, m\\}, \\mathrm{KL} $

#### Definition 2 : Speed of learning 

> For a rating system with exponentially fast (complete) learning:
> - $ \\lim _{t \\rightarrow \\infty} \\frac{1}{t} \\log q_{t} $ : the speed of learning 
>   - when $ Q=0 $
> - $ \\lim _{t \\rightarrow \\infty} \\frac{1}{t} \\log (1- q_{t} )$
>   - when $ Q=1 $
> -  a rating system has faster learning than another one :
>   - speed of learning is greater for both $Q = 0$ and $Q = 1$

#### Theorem 2: 

> Suppose:
> -  Assumptions 1 and 2 hold 
> - Then : learning is exponentially fast
>   - that is: $ q_{t} $ almost surely converges exponentially to $ Q $
> 
> For $Q = 0$: almost sure have:
> - $ \\lim _{t \\rightarrow \\infty} \\frac{1}{t} \\log q_{t}=-D\\left(\\pi\\left(F_{\\theta, \\zeta}, Q=0, q=0\\right) \\| \\boldsymbol{\\pi}\\left(F_{\\theta, \\zeta}, Q=1, q=0\\right)\\right) $
> For $Q = 1$: almost sure have:
> $ \\lim _{t \\rightarrow \\infty} \\frac{1}{t} \\log \\left(1-q_{t}\\right)=-D\\left(\\pi\\left(F_{\\theta, \\zeta}, Q=1, q=1\\right) \\| \\pi\\left(F_{\\theta, \\zeta}, Q=0, q=1\\right)\\right) $

Tell us:

Learning under full history:

- exponentially fast 
- is governed by the **KL** divergence between:
  - probability distribution of possible actions (i.e., $ a \\in \\mathcal{A} $ )
    - when the underlying quality is $ Q $
    - public belief is $q = Q $
  - and the probability distribution
    - when underlying quality is $1-Q $
    - still $q=Q$

Three components to intuition:

-  the ability of users to overcome the selection effect and combine (the independent components of) past reviews
   -  can achieve because: they know the distribution of
past reviews and can draw the correct inferences from them
- the speed of learning is given by KL divergence is intuitive as well
  - think of distinguishing $ Q=0 $ from $ Q=1 $ as a binary hypothesis testing problem 
  -  The best error exponent for a binary hypothesis testing problem from independently-drawn samples is given: 
     -  by the KL divergence between the probability distributions of these samples conditional on the two hypotheses
- both probability distributions in the KL divergence condition on $q=Q$
   -  because: under full history, each customer correctly reasons about previous users’ beliefs, which are converging to $Q$
   -  enables the effective filtering out of selection effect


## 3.4 The Selection Effect 

Because : 

the composition of customers purchasing the product :
-  influenced by information at time $t$ (summarized by $q_t$)

Then :

the distribution of reviews depends on this information. 

For example:

with full history, when the public belief $q_t $ is very low:
- only customers with very high $\\theta $ purchase
- these customers are much more likely to enjoy a high material utility 
-  leave a positive review than the
average customer

### Example 1 : 

> A rating system : 
>
> $ p=0, \\zeta=0, \\theta \\sim \\mathcal{U}[-1,1] , Q=0 $
> 
> When $ Q+\\theta \\geq 0 $
> - leave a positive review ("like")
> 
> Suppose:
> - $ q \\approx 1 $
>
> then all customers purchase 
> - because: $ \\theta+q \\approx \\theta+1 $ greater than zero 
>
> Then :
>
>  ex ante valuation of customers who have purchased the product : 
> - uniformaly distributed over $[-1, 1]$
> - half is positive 
>
> In contrast : 
>
> $ q \\approx 0 $
>
> - only customers with positive $\\theta $ purchase the product
> - conditional distribution of ex ante valuations is uniform over $[0, 1]$ 
> - all reviews will be positive

Selection effect impact the speed of learning:

Suppose:

that customer $ t $ (in addition to $ h_{t} $ ) observes the ex ante valuation of previous customers :

- $ \\theta_{s} $ for $ s=1, \\ldots, t-1 $

In this setting:

- extra information remove selection effect 
  - because: current customers can condition on past customers' valuation 
  - learning is faster 
  - extra information regarding distribution of previous customers' preferences increases the speed of learning 

# 4 Summary statistics 

Characterize the conditions for:
- complete learning
- speed for more realistic rating system 
  - where platform provides summary statistics of reviews
  - by past customers

## 4.1 Learning Dynamics 

Summary statistics will not see full history 

- only observe a vector of statistics $\\mathbb S $ 
  - include the fraction of review in a subset of all review 

Formally:

$T$ : a nonempty subset

- of all possible actions $\\mathcal A $

a partition of $T $: A rating system $ \\left\\{T_{1}, \\ldots, T_{m}\\right\\} $

- i.e. $ T=\\bigcup_{i=1}^{m} T_{i} $ and $ T_{i} \\cap T_{j}=\\emptyset, i \\neq j \\in[m] $

- such that:
  - for any $i>j $:
  - reviews in $ T_{i} $ are more positive than the reviews in the set $ T_{j} $

$\\tau $: the times $ t $ at which an action in $ T $ occurs

- $\\tau $ will be the number of reviews left so far 

So:

-  customers observe the number of actions in the
set $T $
- know their own $\\tau $
- for user $\\tau $:
  - rating system takes the form: $ \\Omega_{\\tau}=\\mathbf{S}_{\\tau-1} $
  - report information from the first $\\tau - 1 $ reviews

A summary statistic: $ \\mathbf{S}_{\\tau} \\in \\mathbb{R}^{m} $ with its $ i $ th entry representing fraction of past reviews in $ T_{i} $

that is :

$ \\mathbf{S}_{\\tau}(i)=\\frac{1}{\\tau} \\sum_{s=1}^{\\tau} \\mathbf{1}\\left\\{a_{s} \\in T_{i}\\right\\}, \\quad i \\in[m] $

Examples: 

- The fractions of each one of $ \\underline{K}+\\bar{K} $ reviews are reported.
  -  $ \\mathbf{S}_{\\tau} \\in \\mathbb{R}^{m} $ where $ m=\\underline{K}+\\bar{K} $
  -  $ T=\\mathcal{R} \\backslash\\{{0\\}}$,
  -  $ T_{1}=\\{-\\underline{K}\\}, \\ldots, T_{\\underline{K}}=\\{-1\\}$,
  -  $ T_{\\underline{K}+1}=\\{1\\}, \\ldots, T_{\\underline{K}+K}= $ $ \\{\\bar{K}\\} $.
-  Averages of the scores of past reviews
-  rating system reports only the fraction of reviews that give the highest score: 
   -  $ a=\\bar{K} $
   -   out of the available $ \\underline{K}+\\bar{K} $ options. 
   -   In this case, $ T=\\mathcal{R} \\backslash\\{0\\}$
   -   $ T_{2}=\\{\\bar{K}\\}$,
   -   $ T_{1}=T \\backslash T_{2} $ 
   -   the rating system is represented by: $ \\mathbf{S}_{\\tau} \\in \\mathbb{R}^{2} $ 
       -   $ \\mathbf{S}_{\\tau}(2)=\\frac{1}{\\tau} \\sum_{s=1}^{\\tau} \\mathbf{1}\\left\\{a_{s}=\\bar{K}\\right\\}, \\quad $
       -   $ \\quad \\mathbf{S}_{\\tau}(1)=1-\\mathbf{S}_{\\tau}(2)$


Key object: expectation of qality $Q$

- conditional on the information avaliable from the rating system at time $t$ : $q_t$

the relevant information is summarized by : vector $ \\mathbf{S}_{\\tau} $ after $ \\tau $ purchases
- written as: $ q_{\\tau}=\\mathbb{P}_{\\left\\{\\left(\\theta_{s}, \\zeta_{s}\\right)\\right\\}_{s=1}^{\\tau -1}}\\left[Q=1 \\mid \\mathbf{S}_{\\tau}\\right] $

In contrast to full history case:

$q_\\tau $ is not public belief because :

- $ \\mathbf{S}_{\\tau} $ is only observed by the customer making the $ \\tau $ th purchase

The likelihood ratio implied by belief $q_\\tau$ takes an analogous form to [(4)](#4) :

#### (7)

$ l_{\\tau}=\\frac{q_{\\tau}}{1-q_{\\tau}}=\\frac{\\mathbb{P}_{\\left\\{\\left(\\theta_{s}, \\zeta_{s}\\right)\\right\\}_{s=1}^{\\tau-1}}\\left[Q=1 \\mid \\mathbf{S}_{\\tau}\\right]}{\\mathbb{P}_{\\left\\{\\left(\\theta_{s}, \\zeta_{s}\\right)\\right\\}_{s=1}^{\\tau-1}}\\left[Q=0 \\mid \\mathbf{S}_{\\tau}\\right]}=\\frac{\\mathbb{P}_{\\left\\{\\left(\\theta_{s}, \\zeta_{s}\\right)\\right)_{s=1}^{\\tau_{-1}-1}}\\left[\\mathbf{S}_{\\tau} \\mid Q=1\\right]}{\\mathbb{P}_{\\left\\{\\left(\\theta_{s}, \\zeta_{s}\\right)\\right\\}_{s=1}^{\\tau-1}}\\left[\\mathbf{S}_{\\tau} \\mid Q=0\\right]} $.

Because :

- future customers do not observe $ \\mathbf{S}_{\\tau} $ 
- cannot compute $ q_{\\tau} $ 

So:

the likelihood ratio $ l_{\\tau} $ is no longer a martingale

Then: 

we develop a different approach to study its asymptotic properties.


$ \\pi\\left(i ; F_{\\theta, \\zeta}, Q, q, T\\right)=\\mathbb{P}_{\\theta, \\zeta}\\left[a \\in T_{i} \\mid a \\in T, q, Q\\right], \\quad \\forall i \\in[m] $.

- the probability 
  - of observing an action profile $ a $ 
  - in the set $ T_{i} $ 
  - conditional on the action profile being in $ T $ 


#### (8)

$ \\mathbf{S}_{\\tau+1}=\\frac{\\tau}{\\tau+1} \\mathbf{S}_{\\tau}+\\frac{1}{\\tau+1} \\mathbf{Y}_{\\tau+1}, \\quad \\forall \\tau \\geq 0 $

- The governing stochastic process 
  - for $ \\mathbf{S}_{\\tau} $ 
  - given the true quality $ Q $
- $ \\mathbf{Y}_{\\tau+1} \\in \\mathbb{R}^{m} $
  - $ \\mathbf{Y}_{\\tau+1}=\\mathbf{e}_{i}, \\quad $ w.p. $ \\pi\\left(i ; F_{\\theta, \\zeta}, Q, q_{\\tau+1}, T\\right) $
    - $ \\mathbf{e}_{i} \\in \\mathbb{R}^{m} $ 
    - is the $ i $ th canonical basis vector, $ \\mathbf{e}_{i}=(0, \\ldots, 0,1,0, \\ldots, 0) $

In computing [(7)](#7) :

- agents know  there may be unobserved actions
- but : because 
  - the information observed by agent who did not leave a review
  - is the same as the information available to the next agent
- Bayesian customers can consistently compute posterior probabilities

## 4.2 Negative and Positive Selection

Intuitively:

- negative selection corresponds to the case
  - belief $ q_{t} $ becomes more favorable to $ Q=1 $
  - reviews become less likely to be positive
  - "negative selected"
- Positive selection
  - as belief $ q_{t} $ becomes more favorable to $ Q=1 $
  - reviews are more likely to be
positive

### Definition 3:

> Consider a rating system with $ m $ review options:
> 
>  $ T_{1}, \\ldots, T_{m} $ such that
> 
> - for any $ i^{\\prime}<i$
> - $\\mathbb{P}\\left[a \\in \\bigcup_{j=i}^{m} T_{j} \\mid a \\in \\bigcup_{j=i^{\\prime}}^{m} T_{j}, q, Q=1\\right]> $ $ \\mathbb{P}\\left[a \\in \\bigcup_{j=i}^{m} T_{j} \\mid a \\in \\bigcup_{j=i^{\\prime}}^{m} T_{j}, q, Q=0\\right] .{ }^{12} $
> 
> The rating system has negative selection if
> - for any $ i^{\\prime}<i$, 
> - $ \\mathbb{P}\\left[a \\in \\bigcup_{j=i}^{m} T_{j} \\mid a \\in\\right. $ $ \\left.\\bigcup_{j=i^{\\prime}}^{m} T_{j}, q, Q\\right] $ is decreasing in $ q $
>   - that is, if the probability of more favorable reviews is decreasing in belief $ q $.
> The rating system has positive selection if
> - for any $ i^{\\prime}<i$,
> - $ \\mathbb{P}\\left[a \\in \\bigcup_{j=i}^{m} T_{j} \\mid a \\in\\right. $ $ \\left.\\bigcup_{j=i^{\\prime}}^{m} T_{j}, q, Q\\right] $ is increasing in $ q $
>   - that is, if the probability of more favorable reviews is increasing in belief $ q $.

In both:

as $q_t $ becomes more favorable:

-  customers with
lower ex ante valuations (lower $\\theta $) 
- more likely to purchase the product.

With negative selection:

-  these additional purchases decrease the likelihood of favorable reviews
  
With potsitive selection: 

- they increase the likelihood of favorable reviews

Negative or positive?

- depends on:
  - review options available to customers
  - the distribution of the random variables $\\theta  \\zeta$

Next proposition:

- present simple sufficient conditions for selection 
  -  in terms of the primitives of the model
  -  given a rating system with $ m=\\stackrel{\\rightharpoonup}{K}-\\ell+1 \\geq 2 $ review options 
     -  that reporting the fraction of all reviews
        -  reviews that are more favorable than $\\ell $
        -  for some $ \\ell \\in\\{-\\underline{K}+1, \\ldots, \\bar{K}-1\\} $
        -  i.e., the set $ T $ is $ \\{\\ell, \\ldots, \\bar{K}\\} $ and we have $ T_{1}=\\{\\ell\\}, \\ldots, T_{m}= $ $ \\{\\bar{K}\\}) 

### Proposition 1 : 


> For any $ \\ell \\in\\{-\\underline{K}+1, \\ldots, \\bar{K}-1\\} $
> 
>  consider a rating system that : 
> - reports the fraction of all reviews 
>   - are more favorable than $ \\ell $
> 
> If :
> 
> - $ \\theta $ has a uniform distribution 
> - and $ \\bar{\\theta} \\geq \\max \\left\\{p-\\mathbb{E}[\\zeta], \\lambda_{\\bar{K}}-\\underline{\\zeta}+p\\right\\} $, 
> 
> then :
> 
> for any $ i^{\\prime}<i,$
> 
> $ \\mathbb{P}\\left[a \\in \\bigcup_{j=i}^{m} T_{j} \\mid a \\in \\bigcup_{j=i^{\\prime}}^{m} T_{j}, q, Q=1\\right]> $ $ \\mathbb{P}\\left[a \\in \\bigcup_{j=i}^{m} T_{j} \\mid a \\in \\bigcup_{j=i^{\\prime}}^{m} \\bar{T}_{j}, q, Q=0\\right] $, 
> 
> and we have:

> 1. If the hazard rate $ \\frac{f_{\\zeta}(x)}{1-F_{\\zeta}(x)} $ is decreasing in $ x $,
> 
>  then :
> 
>  this rating system features negative selection.

> 2. If the hazard rate $ \\frac{f_{\\xi}(x)}{1-F_{\\xi}(x)} $ is increasing in $ x $
> 
>  then :
> 
>  this rating system features positive selection.

Example: 

### Example 2

> Negative Selection: 
> 
> Consider a rating system with : 
> 
> two review options 
> - reporting the fraction of the most favorable review: 
>   - $ \\bar{K} $ (i.e., $ T=\\{\\bar{K}-1, \\bar{K}\\}, T_{1}=\\{\\bar{K}-1\\} $, $ T_{2}=\\{\\bar{K}\\} $ with $ \\bar{K} \\geq 2 $ ).
> 
>  This rating system features negative selection when :
> 
> -  $ \\zeta $ has decreasing hazard rate (e.g., when the distribution of $ \\zeta $ is Pareto) 
> - $ \\theta $ is uniform with $ \\bar{\\theta} \\geq \\max \\left\\{p-\\mathbb{E}[\\zeta], \\lambda_{K}-\\underline{\\zeta}+p\\right\\} $.
> 
> Positive Selection: Consider the same rating system, but now suppose that :
> 
> - $ \\zeta $ has increasing hazard rate (e.g., when the distribution of $ \\zeta $ is uniform) 
> -  $ \\theta $ is again uniform with $ \\bar{\\theta} \\geq \\max \\left\\{p-\\mathbb{E}[\\zeta], \\lambda_{\\bar{K}}-\\zeta+p\\right\\} $.
> 
> A simpler, even if less realistic, example of positive selection :
> 
>  rating system with  two review options 
> - reports the fraction of "likes" among all customers 
> - that is
>   - $ T= $ $ \\{-1,0,1\\} \\cup\\{N\\} $ 
>   - $ T_{1}=\\{-1,0\\} \\cup\\{N\\}
>   -  T_{2}=\\{1\\} $ with any distribution of $ \\theta $ and $ \\zeta $

The selection effect is more pronounced when :

-  customers have access to sum-
mary statistics (rather than the full history as in the previous section)
  - because:  customers do not know the exact belief with which the previous actions were taken
- when there is negative selection
  - suppose the rating system exhibits negative selection and $Q=0$
  - as $q_t $ approaches 0:
    -  only customers with very high $\\theta $ purchase the product
    -  tend to leave more positive reviews
 -  makes it more difficult for $q_t $ to converge to 0 
 -  also explains:
    -  with positive selection: 
       -  the selection effect will be less burdensome for learning
       -  less harmful to the speed of learning
    -  because as $q_t $ approaches 0:
       -   more favorable reviews become less likely
       -   helps faster convergence to 0

## 4.3 Complete Learning

Define **separation**:

- it enables customers to filter out the selection effect for rating systems
  - with summary statistics

Intuitively: 

- requires : 
  - the distribution of at least one review option under $Q = 1$ :
    - to be nonoverlapping with its distribution under $Q=0 $

Formally:

### Definition 4-Saparation 

> A rating  system $ \\left(T_{1}, \\ldots, T_{m}\\right) $ satisfies the weak separation condition if :
> 
> - there exists a subset of reviews $ \\mathcal{S} \\subseteq[m] $ such that : 
>   - the range of functions $ \\sum_{i \\in \\mathcal{S}} \\pi\\left(i ; F_{\\theta, \\zeta}, Q=0, q, T\\right) $ and $ \\sum_{i \\in \\mathcal{S}} \\pi\\left(i ; F_{\\theta, \\zeta}, Q=1, q, T\\right) $ (as functions of $ q $ ) are weakly separate 
>
> formally either or:
> 
> - $ \\min _{q \\in[0,1]} \\sum_{i \\in \\mathcal{S}} \\pi\\left(i ; F_{\\theta, \\zeta}, Q=0, q, T\\right) \\geq \\max _{q \\in[0,1]} \\sum_{i \\in \\mathcal{S}} \\pi\\left(i ; F_{\\theta, \\zeta}, Q=1, q, T\\right) $
> - $ \\min _{q \\in[0,1]} \\sum_{i \\in \\mathcal{S}} \\pi\\left(i ; F_{\\theta, \\zeta}, Q=1, q, T\\right) \\geq \\max _{q \\in[0,1]} \\sum_{i \\in \\mathcal{S}} \\pi\\left(i ; F_{\\theta, \\zeta}, Q=0, q, T\\right) $

Strict separation condition if above inequalities strict 

### Theorem 3 : 

> Suppose Assumptions 1 and 2 hold,
>  consider a rating system with summary statistics.

> - The strict separation condition is sufficient for complete learning
> - For $m = 2$ reviews and negative selection:
>   - the weak separation condition is necessary and sufficient for complete learning

First part of theorem: 

- with summary statistics, the strict separation is sufficient for complete learning

Second part :

- establishes a partial converse to this result: 
  -  for rating systems with $m = 2$ reviews and negative selection
     -  the weak separation condition is necessary 
     -  being sufficient for complete learning

if [Assumption 2](#assumption-2--barthetamathbbezeta-p0-) did not hold

- purchases would stop with positive probability
- there would be no complete learning

We have a example:

- absence of weak separation 
  - will lead to failure of complete learning 
    - with negative Selection
  - but not necessarily with positive selection 

### Example 3

> Consider a rating system with two review options 
> 
> "like" and "dislike" denoted by $ \\bar{K} $ and $ -\\underline{K} $.
> 
>  Suppose : 
> - $ p=0 $ 
> -  a customer leaves review $ \\bar{K} $ when her material utility is positive. 
> 
> let the distribution of $ \\theta $ be close to : 
> -  a distribution with two equally likely point masses at $ -7 / 8 $ and $ 1 / 2 $
> 
>  the distribution of $ \\zeta $ 
> - close to four equally likely point masses at $ -7 / 4,-1 / 4,1 / 4 $, and $ 7 / 4 $ 

![Figure 1](EC_1/image.png)

for (a):

- presence of negative selection:
  - curves are downward sloping
- no weak separation :
  - the ranges of $ \\pi\\left(\\bar{K} ; F_{\\theta, \\zeta}, Q=0, q\\right) $ and $ \\pi\\left(\\bar{K} ; F_{\\theta, \\zeta}, Q=1, q\\right) $ being overlapping

for (b) :

- distribution of the number of “likes” among 1000 reviews for both $ Q=1 $ and $ Q=0 $
- complete learning fails
  - beliefs in the overlapping range customers cannot identify the underlying quality

If (in contrast) :

- rating system reports fraction of “likes” among all (potential) customers

Then : 

![Figure 2](EC_1/image_2.png)

- upward sloping
  -  positive selection
-  Even though weak separation again fails
   -  (the ranges of $ \\pi\\left(\\bar{K} ; F_{\\theta, \\zeta}, Q=0, q\\right) $ and $ \\pi\\left(\\bar{K} ; F_{\\theta, \\zeta}, Q=1, q\\right) $ are overlapping )
   -   the distributions of the number of “likes” among 1000 customers for$ Q = 1$ and $Q = 0$ are distinct 
       -   ensure complete learning 

The separation condition is stated :

- about $ \\pi\\left(i ; F_{\\theta, \\zeta}, Q=0, q, T\\right) $
  - probabilities of realization of different review combinations 

Next lemma:

- simple property of distribution of ex ante valuation 
  - sufficient for this condition to be satisfied 

### Lemma 1 : 

> Consider a rating system :
> 
>  reports the fraction of each review among all reviews
> 
>  that is : 
> 
> $ T=\\mathcal{R} $ 
> 
>  $ T_{1}=\\{-\\underline{K}\\}, \\ldots, T_{m}=\\{\\bar{K}\\} $ 
> 
> - $ m=\\bar{K}+\\underline{K}+1 $
> 
> For any distribution on $ \\zeta $ :
> 
>  if the hazard rate $ \\frac{f_{\\theta}(x)}{1-F_{\\theta}(x)} $ is monotonically increasing in $ x $ :
> 
> - then the strict separation condition holds.

A consequence :

for a rating system :
- reports the fraction of each review among all reviews 

strict separation is satisfied 

- for a wide range of distributions of $\\theta $
- including uniform and normal

## 4.4 Speed of Learning 

conditional on complete learning:

the speed of learning 

- under summary statistics

is governed by a KL divergence measure 

- closely related to the full history case

### Theorem 4:

> For a given rating system $ \\left(T_{1}, \\ldots, T_{m}\\right) $ : 
> 
> suppose Assumptions 1 and 2 and the strict separation condition hold.
> 
> Then learning is exponentially fast 
> 
> in particular :
> 
> for $ Q=0 $, we almost surely have :
>
> - $ \\lim _{\\tau \\rightarrow \\infty} \\frac{1}{\\tau} \\log q_{\\tau}=-D\\left(\\pi\\left(F_{\\theta, \\zeta}, Q=0, q=0, T\\right) \\| \\pi\\left(F_{\\theta, \\zeta}, Q=1, q=1, T\\right)\\right) $
>
> for $ Q=1 $, we almost surely have :
>
> - $ \\lim _{\\tau \\rightarrow \\infty} \\frac{1}{\\tau} \\log \\left(1-q_{\\tau}\\right)=-D\\left(\\pi\\left(F_{\\theta, \\zeta}, Q=1, q=1, T\\right) \\| \\pi\\left(F_{\\theta, \\zeta}, Q=0, q=0, T\\right)\\right) $

Intuition on KL divergence determines the speed of learning :

- similar to the full history case 

Difference :

- consider $Q=0$
- with full history :
  - the probability distribution under the alternative hypothesis was still conditioned on $q = 0$
  - now conditioned on $q=1$
- Difference is a consequence of the selection effect
- Under full history :
  -  when drawing inferences from past reviews
     -  customers know the public belief at each point
     -  correct for the selection effect
        -  by conditioning on the public belief
        -   at the time the review was left
 -   not possible with summary statistics :
   - forces a user into the following inference :
     - if $Q = 1$ : 
       -  the belief of all other customers (which she does not observe) is very likely to have also converged to $q=1$.


Specifically:

- consider customer $t$’s learning problem for some large $t$ :
- both full history and summary statistics settings :
- customer $t$ is facing a binary hypothesis testing problem 
- About the belief of customer $t$ regarding previous customers’ beliefs:
  - With full history:
    - observes their public beliefs and conditions on them
  - With summary statistics :
    -  does not observe their beliefs
    -  draws inferences about their belief
       -  conditioning on her expectation
       -  $q$ is converging to $Q$
    -  that is :
       -  $ q \\approx 0 $ under the null hypothesis 
       -  $ q \\approx 1 $ under the alternative hypothesis 
 
 This explains :

 - in [Theorem 4](#theorem-4) : 
   - the distributions being compared have $q = 0$ and $q = 1$
 - in [Theorem 2](#theorem-2) :
   - under full history, these distributions both condition on the same $q$ 

We will investigate :

- the implication of this difference 
- on the speed of learning 
- under full history and summary statistics 

in Section 5

### Remark 5

> Notice: 
> 
> the results in [Theorems 3](#theorem-3-) and [4](#theorem-4) apply 
> - even we consider more general summary statistics. 
> 
> In particular:
> 
>  a general summary statistics can be represented 
> 
> - by a mapping :
>   - from the fraction of each of the $ k=\\underline{K}+\\bar{K}+ 1$  reviews 
>   - among previous customers
> - that is:
> 
> - $ f: \\Delta^{k} \\rightarrow \\mathbb{R}^{m} $, 
>   - $ \\Delta^{k}=\\left\\{\\left(x_{1}, \\ldots, x_{k}\\right) \\in\\right. $ $ \\left.[0,1]^{k}: \\sum_{i=1}^{k} x_{i}=1\\right\\} $

# 5 Comparison of rating systems 

- start with a comparison of full history and summary statistics
- move to a characterization of :
  - different review options affect the speed of learning
- provide examples of fast and slow learning 
  - as the rating system is modified

## 5.1 Full history v.s. Summary Statistics 


Natural conjecture:

- full history  lead to faster learning

We show:

- when negative selection :
  - learning is indeed faster under full history
- when positive selection
  - in fact slower

### Proposition 2

> Consider a rating system with summary statistics : 
> 
> - reports the fraction of reviews in sets $ T_{1}, \\ldots, T_{m} $ 
>   - $ T=\\bigcup_{i=1}^{m} T_{i} $ 
> - that is, $ \\mathbf{S}_{\\tau}(i)=\\frac{1}{\\tau} \\sum_{s=1}^{\\tau} \\mathbf{1}\\left\\{a_{s} \\in T_{i}\\right\\} $ 
>   - $ \\tau $ is the number of reviews in $ T $ (i.e., $ \\tau=\\#\\{a \\in T\\}) $, 
> 
>  a rating system with full history : 
> 
>  reports the sequence of reviews in the sets $ T_{1}, \\ldots, T_{m} $. 
> 
> Suppose that [Assumptions 1](#assumption-1---richness) and [2](#assumption-2--barthetamathbbezeta-p0-) and the strict separation condition hold (so that there is complete learning under both full history and summary statistics).
> 
>  Then: 
> 
> 1. If the rating system has negative selection: 
> 
> - the speed of learning under full history is greater than under summary statistics.

> 2. If the rating system has positive selection
> 
> - the speed of learning under summary statistics is greater than under full history.

Intuition:

- the speed of learning is determined
  - by the problem of distinguishing :
  - the distribution of reviews under the true state
    - $Q = 1$
  - and their distribution under the alternative state
    - $Q = 0$
- As discussion in [Theorem 2](#theorem-2) and [4](#theorem-4)
  - under full history:
    - users observe the public belief
    - $q=1$
  - with summary statistics:
    - users infer that when $ Q=1 $, we must have $ q=1 $
    -  when $ Q=0 $, then we must have $q=0 $
-  Then :
   -  under full history:
      -  distinguish $ (Q=1, q=1) $ from $ (Q=0, q=1) $
   -  under summary statistics:
      -  distinguish $ (Q=1, q=1) $ from $ (Q=0, q=0) $
   -   exacerbates the selection effect, leading to slower learning
- Because :
-  under negative selection
   -  false favorable reviews are quite likely when $ q=0 $
      -  even if $ Q=0 $
      -   making the task of distinguishing the two distributions more difficult
-  under positive selection:
   -  the combination $ (Q=0, q=1) $ generates more false favorable reviews than $ (Q=0, q=  0 )$, 
      -  because: by the definition of positive selection
      -  favorable reviews are less likely
          -  when $q=0$
   -  consequently :
   -  distinguishing $ (Q=1, q=1) $ and $ (Q= $ $ 0, q=0) $ is easier than distinguishing $ (Q=1, q=1) $ from $ (Q=0, q=1) $
   -  leading to faster learning under summary statistics than full history.

This example illustrate the results of Proposition 2:

> EXAMPLE 4: Consider a rating system with two review options 
> 
> - $ T=\\{\\bar{K}-1, \\bar{K}\\} $
> - $ T_{1}=\\{\\bar{K}-1\\}, T_{2}=\\{\\bar{K}\\} $ 
>   - they reports the fraction of the most favorable review among the most favorable two review options
> - that is : $ S_{\\tau}(2)=\\frac{1}{\\tau} \\sum_{s=1}^{\\tau} \\mathbf{1}\\left\\{a_{s}=\\bar{K}\\right\\} $ 
>   - $ \\tau $ is the number of reviews in the set $ \\{\\bar{K}-1, \\bar{K}\\} $. 
> 
> Suppose :
> 
> - the distribution of $ \\theta $ is uniform 
> - $ \\bar{\\theta} \\geq \\max \\left\\{p-\\mathbb{E}[\\zeta], \\lambda_{\\bar{K}}-\\underline{\\zeta}+p\\right\\} $ 
> - the distribution of $ \\zeta $ is Pareto
> 
> so that : 
> 
> this rating system features negative selection (as in [Example 2](#example-2)). 
> 
> Suppose that:
> 
>  the conditions in Theorem 3 are satisfied 
> 
> so that :
> 
> there is complete learning under both full history and summary statistics. 
> 
> Then :
> 
>  the speed of learning under full history is greater than under summary statistics.
> 
>  However , with the same rating system but now $ \\zeta $ having a uniform distribution :
> 
>  there is positive selection
> 
>  the speed of learning under summary statistics is greater than full history.

## 5.2 Learning from refined rating systems 

Show **more refined** rating systems:

- faster learning 
  - both full history and under summary statistics

Consider :

- a rating system $ \\boldsymbol{\\Omega} $ 
- review options $ \\mathcal{R}=\\{-\\underline{K}, \\ldots, \\bar{K}\\} $ 
- thresholds $ \\Lambda=\\left\\{\\lambda_{-\\underline{K}}, \\ldots, \\lambda_{\\bar{K}}\\right\\} $

We say : $ \\boldsymbol{\\Omega}^{\\prime} $ is "coarser" than $ \\boldsymbol{\\Omega} $

If:

- the review options in $ \\boldsymbol{\\Omega}^{\\prime} $ are fewer 
- have thresholds $ \\Lambda^{\\prime}=\\left\\{\\lambda_{i_{1}}, \\ldots, \\lambda_{i_{m}}\\right\\} $ 
  -  $ i_{1}<\\cdots<i_{m} $ 
  -  $ i_{j} \\in \\mathcal{R} $ for $ j=1, \\ldots, m $.

### Proposition 3:

> Consider a rating system with either full history or summary statistics
>
> suppose Assumptions 1 and 2 and the strict separation condition hold (so that there is complete learning).
> 
>  Then : 
> 
> the speed of learning is always faster under a more refined rating
system.

Intuition:

- the more refined rating system $ \\boldsymbol{\\Omega} $:
  - provides strictly more information 
    - about the utility of previous users (and, therefore, their preferences) 
  - than the less refined $ \\boldsymbol{\\Omega}^{\\prime} $, 
  - thus makes it easier for customers to distinguish between : 
    - the probability distributions of reviews induced under the true state of nature 
    - and the alternative.


### Remark 3: 

> we extend [Proposition 3](#proposition-3) to rating systems :
> 
> - with general summary statistics (as mentioned in [Remark 2](#remark-2)). 
> 
> In particular:
> 
> for a general summary statistic $ f: \\Delta^{k} \\rightarrow \\mathbb{R}^{m} $ 
> 
> and a noninjective function $ g: \\mathbb{R}^{m} \\rightarrow \\mathbb{R}^{m^{\\prime}}$,
> 
> $ h=g \\circ f $ will represent a coarser summary statistic
> 
> Proposition B-5 shows that this general form of coarsening always reduces the speed of learning.

Application of [Proposition 3](#proposition-3) :


rating systems :

- report an average score of past
reviews 
- rather than reporting detailed fractions of reviews
  -  that fall in different categories.

When review thresholds remain unchanged:

- a rating system reporting average scores is less refined 
  -  than a rating system reporting detailed fractions

- and from [Proposition 3](#proposition-3):
  - leads to slower learning 

Another application  :

to rating systems that have "targeted information." 

In particular:

platforms such as Amazon offer information about:

- the reviews of groups of customers with certain characteristics. 

For instance:

for a book at the intersection of climate science and economics:

- Amazon separately depicts:
  -  reviews among customers who are interested in economics 
  - as well as reviews among customers who are interested in climate science.

Providing information on reviews by groups of customers is a form of refinement

we make this intuition precise in Appendix B.3.7

- establishes that this type of targeting always leads to faster learning.

Notice:

when the platform alters the review options:

- users’ thresholds might also change
-  reducing the informativeness of their reviews. 

For example:

- when the review options are noncomparable between two rating systems 

- or when additional options change the users’ review thresholds. 

The next example shows that:

- a greater number of review options may lead to slower learning.

### EXAMPLE 5: 

> Assume : 
> 
> - $ \\zeta $ is uniform over $ [-2,2]$, 
> - $ \\theta $ is uniform over $ [-1,1] $
> - $ p=0 $. 
> 
> Consider the following two rating systems: 
> 
> - (i) there are two review options $ \\{-1,1\\} $, with threshold 0
>   - that is: the review is 1 if and only if the utility is nonnegative
> - (ii) there are three review options $ \\{-2,-1,1\\} $, with thresholds $ -1 / 2 $ and $ 1 / 2 $
>   - that is: 
>      - the customer chooses -2 if her utility is below $ -1 / 2 $;
>      - $-1 $ if her utility is between $ -1 / 2 $ and $ 1 / 2 $; 
>      - 1 if her utility is above $ 1 / 2 $. 
> 
> It can be verified that :
> 
> - even though the second rating system has more review options
> 
> - it leads to slower learning.

## 5.3 Fast and Slow Learning from reviews 

we provide several examples illustrating :

how 

- different aspects of the rating system 
-  the extent of heterogeneity among customers 

affect the speed of
learning. 

Example B-1 illustrates:

how a small refinement of a rating system can lead to a very large change in the speed of learning 

- because the refinement provides a review option 
  -  has a much higher likelihood ratio when $Q = 1$ than when $Q = 0$

Examples B-2 and B-3 show that: 

an increase in ex post heterogeneity (a wider support or greater variance of $ \\zeta $ ):

- reduces the speed of learning 

because: reviews become less informative about the underlying quality of the product.

In particular: 

in Example B-3 we consider a setting 

-  both $ \\theta $ and $ \\zeta $ are normally distributed (with $ \\mathbb{E}[\\zeta]=0 $ and $ \\operatorname{var}(\\theta)=1 $ )
-  and then study :
   -  how the speed of learning changes 
   -  as a function of $ \\operatorname{var}(\\zeta) $ and $ \\mathbb{E}[\\theta] $. 
- The speed of learning: 
  -  is decreasing in $ \\operatorname{var}(\\zeta) $ 
  -  and increasing in $ \\mathbb{E}[\\theta] $. 

The intuition for the former result is that: 

- more disperse ex post preferences make reviews less informative. 

The intuition for the latter result is that:  

- higher $ \\mathbb{E}[\\theta] $ implies that:
  -  customers who purchase the product 
     -  are more likely to have a positive experience
  -  exacerbating the selection effect 
  -  slowing down learning.

# 6 Conclusion 

For interesting directions: 

- it is important to study how platform decisions, 
  - including:
    - design of rating systems and pricing
    - interact with user learning. 
  - We take a first step in this direction in Appendix B. 
  - In Appendix B.3.8, we show that:
    - if the platform would like to maximize participation by users, 
    - then it will always choose a rating system that:
      -  maximizes the speed of learning.
  -  In Appendix B.3.9, we show that:
     - our learning and speed of learning results generalize to some environments 
       - where the platform also chooses an endogenous sequence of prices 
       - to maximize revenue. 
- another interesting direction is to introduce more strategic interactions between users 
  - (our analysis of review decisions intended to influence future purchasing behavior in Appendix A.2.2 is one step in this direction). 
- it is important to:
  -  move beyond Bayesian learning 
  -  investigate what types of rating systems robustly aggregate information 
     -  when agents use simple learning rules. 
- a fruitful area for future research would be: 
  - to close the gap between :
    - theoretical models of learning 
    - and the burgeoning empirical literature 
      - on behavior in online markets
    - which highlights :
      - both the role of selection effects 
      - and user incentives.

`,__vite_glob_0_10=`---
title: Business Paper - Week 2
---

# Model

$1$: consumers totalling mass

$E, NE$: Experts, Non-Experts

$\\psi\\in(0,1)$: the share of Experts

$1 - \\psi$: thetshare of Non-Experts

$q\\in [0, 1]$ product quality

$0$ prices normalized to 0

$F_E(q)$: Experts choose, a continuous, smooth cumulative distribution

$f_E(q)$ density

$F_{NE}(q), f_{NE}(q)$: Non-Experts

### Assumption 1 (Expertise and Choice)

> $F_E(q)\\le F_{NE}(q), \\forall q\\in [0, 1]$: On average, Experts identify and purchase better products.
> $\\dfrac{\\partial \\left(\\frac{f_E(q)}{f_{NE}(q)}\\right)}{\\partial q} > 0$: MLRP property
> MLRP: Monotone Likelihood Ratio Property, the better will be better.

**Assumption 1** gives us:
- Experts experience higher quality on average
- the higher the product’s quality, the higher the share of its buyers that are Experts.

$r_E := \\int_{0}^{1}q\\mathrm d F_E(q), \\quad r_{NE}:= \\int_{0}^{1}q\\mathrm d F_{NE}(q)$: Choice Procedure (Also means Expectation)

$r_E > r_{NE}$

- We denote this gap by $ \\Delta(r):=r_{E}-r_{N E}>0 $.
-  In our empirical analysis, we find a substantial $ \\Delta(r) $ on both IMDb and MovieLens.

### Assumption 2 (Reference-Dependence)

>  For every $ q \\in[0,1] $ and consumer type $ i=E, N E $, we have:
>
> #### (1)
>
> $ U_{i}(q)=u(q)+\\mu\\left(u(q)-u\\left(r_{i}\\right)\\right) $
> - $ u(\\cdot) $ satisfying the standard assumptions $ u^{\\prime}(\\cdot)>0 $ and $ u^{\\prime \\prime}(\\cdot)<0 $
> - $ \\mu>0 $.

From [Equation 1](#1):
- standards enter utility negatively
- $\\mu$ quantify their impace 

This leads Experts to be less satisfied than Non-Experts

For any level of $q$:

$ \\begin{aligned} r_{E}>r_{N E} & \\Rightarrow U_{E}(q)-U_{N E}(q) \\\\ & =\\left(u(q)+\\mu\\left(u(q)-u\\left(r_{E}\\right)\\right)\\right)-\\left(u(q)+\\mu\\left(u(q)-u\\left(r_{N E}\\right)\\right)\\right) \\\\ & =\\mu \\cdot\\left(u\\left(r_{N E}\\right)-u\\left(r_{E}\\right)\\right) \\\\ & <0 \\quad \\forall q \\geq 0\\end{aligned} $

- the inequality follows from $ \\mu>0, u^{\\prime}(\\cdot)>0 $ and $ r_{E}>r_{N E} $

### Assumption 3 ((Subjectively) Honest Ratings)

> For every $ q \\in[0,1] $, and $ i=E, N E $, ratings reflect subjective satisfaction:
> $ \\mathcal{R}_{i}(q)=U_{i}(q) $

Without loss of generality, given Experts' higher stringency:

we can normalize utilities so that 
- $ \\mathcal{R}_{E}(0)=0 $ 
- $ \\mathcal{R}_{N E}(1)=1 $. 

This ensures all ratings lie within this interval

---

We first consider the case:

the average ratings displayed by the platform are the average of individual opinions. 

That is, given a share $ \\psi $ of Experts, choice densities $ f_{E}(\\cdot) $ and $ f_{N E}(\\cdot) $, and ratings $ R_{E}(\\cdot) $ and $ R_{N E}(\\cdot) $, 

we have:

$ \\begin{aligned} \\mathcal{R}(q) & =\\frac{\\psi f_{E}(q) \\mathcal{R}_{E}(q)+(1-\\psi) f_{N E}(q) \\mathcal{R}_{N E}(q)}{\\psi f_{E}(q)+(1-\\psi) f_{N E}(q)} \\\\ & =\\frac{\\psi f_{E}(q) U_{E}(q)+(1-\\psi) f_{N E}(q) U_{N E}(q)}{\\psi f_{E}(q)+(1-\\psi) f_{N E}(q)} \\\\ & =: \\omega_{E}(q, \\psi) U_{E}(q)+\\left(1-\\omega_{E}(q, \\psi)\\right) U_{N E}(q) \\\\ & =(1+\\mu) u(q)-\\mu\\left(\\omega_{E}(q, \\psi) r_{E}+\\left(1-\\omega_{E}(q, \\psi)\\right) r_{N E}\\right)\\end{aligned} $

- $ \\omega_{E}(q, \\psi):=\\frac{\\psi f_{E}(q)}{\\psi f_{E}(q)+(1-\\psi) f_{N E}(q)} $
  - represents the share of buyers who are Experts, 
  - as a function of product quality $ q $, their baseline share $ \\psi $, and choice densities $ f_{E}(\\cdot) $ and $ f_{N E}(\\cdot) $.

We will relax assumption and consider slightly more general aggregation rules, such as:

- prioritize more expert consumers
- prioritize products with a larger number of ratings

### Proposition 1

> Quality-based self-selection causes ratings to underestimate quality differences. 
> 
> Moreover, ratings can be non-monotonic in quality. 
> 
> In particular, $ \\mathcal{R}^{\\prime}(q)>0 $ if and only if the following condition is satisfied:

> #### (2)
>
> $ u^{\\prime}(q) \\geq \\frac{\\partial \\omega_{E}(q, \\psi)}{\\partial q} \\cdot \\Delta(r) \\cdot \\frac{\\mu}{1+\\mu} $

First result follows:
- higher quality products are purchased by a higher share of Experts

Thus:

they face a higher “burden of proof”, 
- which implies their relative ratings are penalized compared to those of their lower quality alternatives.

Second result admits a intuition, we list the terms of [Equation 2](#2):

$ \\underbrace{u^{\\prime}(q)}_{\\text {Gains in individual satisfaction }} \\geq \\underbrace{\\frac{\\partial \\omega_{E}(q, \\psi)}{\\partial q}}_{\\text {Increase in } \\% \\text { of } \\mathrm{E} \\text { buyers }} \\cdot \\underbrace{\\Delta(r)}_{\\text {Difference in standards }} \\cdot \\underbrace{\\frac{\\mu}{1+\\mu}}_{\\text {Importance of reference-dependence }} $

- the LHS quantifies the gains in ratings from improved quality:
  - each individual consumer is more satisfied, as measured by $ u^{\\prime}(q) $. 
- The RHS quantifies its costs, driven by self-selection: 
  - the first term represents choice heterogeneity, 
  - and the second and third rating heterogeneity. 
    - In particular, $ \\frac{\\partial \\omega_{E}(q, \\psi)}{\\partial q} $ represents negative self-selection, 
      - or the increase in the share of Experts buyers as $ q $ increases; 
    - $ \\Delta(r) $ represents the difference in standards between Experts and Non-Experts; 
    - $ \\frac{\\mu}{1+\\mu} $ measures the relative weight of referencedependence in shaping total individual utility.

Note that:
 
when either $ \\frac{\\partial \\omega_{E}(q, \\psi)}{\\partial q}, \\Delta(r) $ or $ \\mu $ go to zero,
- ratings are guaranteed to be increasing,
- since $ u^{\\prime}(\\cdot)>0 $. 

It is straightforward to see why: 
- the first case corresponds to a lack of self-selection, 
- the second to equal standards (and thus ratings) for the two types of consumers,
- and the third to reference-independent 

and, thus, homogenous across consumers - utility.

In Section 4.4,:

we propose a fixed-point algorithm to back out individual stringency for each user, 
- which allows us to correct for it
- and thus obtain new ratings reflecting $ \\Delta(r)=0 $, thus eliminating the bias.

## 3.1 Platform Design 

Consider two commonly observed real world practices. 
- First, a vast majority of platforms overweight the opinions of their most expert reviewers. 
- While there are obvious rationales for doing so 
  - for instance, more expert consumers might be less likely to post fake ratings,
  - or more thorough in their quality evaluations 

the following Corollary shows that this can have perverse effect in our context

### Corollary 1 

> When the percentage of Experts, $ \\psi $, is low, >
> 
> overweighting their opinions by a factor $ \\gamma>1 $ worsens the bias, 
> 
> further contracting ratings and thus making it more likely for the monotonicity between ratings and quality to be broken.

Observation:

the bias gets worse when the crowd of buyers is more heterogeneous: 

- If $ 90 \\% $ of buyers were Experts, 
  - then overweighting their opinions bring aggregate ratings closer to essentially only reflecting the (homogeneous) opinions of Experts, 
  - yielding monotonicity: $ \\mathcal{R}^{\\prime}(q) \\approx(1+ $ $ \\mu) u^{\\prime}(q)>0 $. 
- Conversely, if - say - only $ 10 \\% $ were Experts (which we believe to be the far more likely scenario empirically), increasing their share worsens the bias


the number of buyers for a given product is proportional to the share of Experts buyers: 
- while everybody responds to quality, Experts do so more than Non-Experts. 

Therefore, more popular products are effectively facing a higher burden of proof. 

We thus provide an additional rationale for the platform rewarding products receiving more ratings, even in a setting in which a greater number of reviews does not bring more accuracy or credibility per se.

### Corollary 2

> Denote by $ \\mathcal{N}(q):=\\psi f_{E}(q)+(1-\\psi) f_{N E}(q) $ the number of ratings for product $ q $,
> 
> and by $ \\beta(\\cdot) $ a reward function, with $ \\beta(\\cdot), \\beta^{\\prime}(\\cdot)>0 $. 
> 
> Then, substituting average ratings $ \\mathcal{R}(q) $ with mass inflated ratings $ \\beta(\\mathcal{N}(q)) \\cdot \\mathcal{R}(q) $ reduces ratings' contraction and improves monotonicity.


A very stylized relationship between quality and number of ratings:
- higher quality products are on average more popular than their lower quality alternatives.
-  While fairly natural, this relationship need not always hold empirically. 
-  In particular, one can think of products of mediocre quality but huge mass appeal, and viceversa, high quality and niche appeal. 
-  In those situations, the impact of inflating the ratings of popular products would be reversed.

In Section 4.4 : 

we propose a complementary design remedy that:
- is both new (to the best of our knowledge)
- and conceptually orthogonal to those highlighted in Corollaries 1 and 2. 

Unlike in Corollary 1, our algorithm counts all ratings equally, 

and thus does not require us to take a stance on which opinions are credible or not; 

it also requires less knowledge of the proportion of Experts (even more: it does not require us to take a stance on who is an expert in the first place). 

Moreover, unlike in Corollary 2, our algorithm is agnostic as to the predictive power of the number of ratings on ratings' stringency, and correct for the bias in either of the two cases highlighted here.

# 4 Data and Empirical Strategy

We now provide empirical support for the role of consumer expertise on:

both choice and rating behavior as described in Section 3, and study its consequences for movie ratings.

We start by presenting the dataset in Section 4.1. 

Our dataset is obtained by combining data from two online platforms: MovieLens and IMDb. 

In particular,
- we carefully explain how we proxy movies' quality with festival and industry awards,
-  and users' stringency with the number of ratings posted on the platforms. 

Then, in Subsections 4.2 and 4.3, we provide empirical evidence for our two main assumptions. 

In particular, we will center our analysis on the following two empirical counterparts of Assumptions 1 and 2 in Section 3:

### Choice heterogeneity

> Experts watch and rate higher-quality movies than Non-Experts 

### Rating heterogeneity

> For a given movie, Experts post lower rating than Non-Experts 

After providing support for these two facts, 

in Subsection 4.4 we provide a fixed-point algorithm to remove the self-selection of stringent, expert reviewers into high quality movies 

Allow us to compute new, normalized ratings, and provide convincing evidence for the main proposition of the model: 

average ratings understate differences in quality, thus unfaitly penalizing high quality movies compared to their inferior alternatives 

## 4.1 The Database

$$
\\begin{array}{|c|c|c|c|c|c|}
\\hline
 & \\text{Mean} & \\text{SD} & \\text{N} & \\text{Min} & \\text{Max} \\\\
\\hline
\\text{Year of Production} & 2007 & 6.81 & 9426 & 1995 & 2019 \\\\
\\hline
\\text{Movie Runtime} & 104.1 & 28.9 & 9426 & 2 & 629 \\\\
\\hline
\\text{Genre: Action (\\%)} & 17 & - & 9426 & - & - \\\\
\\hline
\\text{Genre: Comedy (\\%)} & 26 & - & 9426 & - & - \\\\
\\hline
\\text{Genre: Drama (\\%)} & 26 & - & 9426 & - & - \\\\
\\hline
\\text{Nominated or Awarded (\\%)} & 58 & - & 9426 & - & - \\\\
\\hline
\\text{Nominated or Awarded (Excluding Academy) (\\%)} & 48 & - & 9426 & - & - \\\\
\\hline
\\text{IMDb Ratings: } \\bar{r}_{i}^{I M D b} & 6.5 & 0.979 & 9426 & 1.4 & 9.5 \\\\
\\hline
\\text{IMDb Number of Users: } n_{i}^{I M D b}(\\times 1000) & 69 & 148 & 9426 & 0.05 & 2588 \\\\
\\hline
\\text{IMDb Top1000 Ratings: } \\bar{r}_{i}^{\\text{Top } 1000} & 6 & 0.864 & 9426 & 1 & 9 \\\\
\\hline
\\text{IMDb Number of Top1000 Users: } n_{i}^{\\text{Top1000 }} & 260.3 & 191 & 9426 & 2 & 928 \\\\
\\hline
\\text{MovieLens Ratings: } \\bar{r}_{i}^{\\text{Movielens }} & 3.2 & 0.459 & 9426 & 0.8548 & 4.483 \\\\
\\hline
\\text{MovieLens Number of Users: } n_{i}^{\\text{Movielens }}(\\times 1000) & 1.6 & 4.36 & 9426 & 0.031 & 72.67 \\\\
\\hline
\\text{Have Critics Reviews: } \\operatorname{Meta}_{i}(\\%) & 72 & - & 9426 & - & - \\\\
\\hline
\\text{Have Positive Critics Reviews: } M e t a_{i}^{>60} (\\%) & 32 & - & 9426 & - & - \\\\
\\hline
\\text{Share 18-29 Users: } p_{i}^{18-29} (\\%) & 13 & - & 9426 & - & - \\\\
\\hline
\\text{Share 30-44 Users: } p_{i}^{30-44} (\\%) & 60 & - & 9426 & - & - \\\\
\\hline
\\text{Share Over 45 Users: } p_{i}^{45} (\\%) & 26 & - & 9426 & - & - \\\\
\\hline
\\text{Share Female Users: } p_{i}^{\\text{female }} (\\%) & 21 & - & 9426 & - & - \\\\
\\hline
\\text{Share US Users: } p_{i}^{U S}(\\%) & 30 & - & 9426 & - & - \\\\
\\hline
\\end{array}
$$

![Figure 1](image.png)

Figure 1: Distribution of the number of ratings posted by Top 1000 users.

## 4.2 Choice Heterogeneity 

Experts differ from Non-Experts since:
- they are more capable of choosing high quality products. 

Thus, we expect Top1000 users to watch and rate more high quality movies. 

The main estimating equation to study this assumption is the following:

### (3)

$ n_{i}^{\\text {Top } 1000}=\\alpha+\\beta_{1} q_{i}+\\beta_{2} X_{i}+\\epsilon_{i} $,

- $ n_{i}^{\\text {Top } 1000} $ is the total number of ratings by Top 1000 users for movie $ i $; 

Figure 1 shows the distribution of $ n_{i}^{\\text {Top } 1000} $ for all movies in our sample. 

No movies are rated by all 1000 Top1000 users. 

Accordingly, issues related to censoring bias are not relevant in our analysis. 

- $ q_{i} $ is the unobserved quality of movie $ i ; 
- X_{i} $ is a set of controls related to movie characteristics and its audience; 
- and $ \\epsilon_{i} $ is an error term. 

Movie quality is not perfectly observable. 

In our preferred specifications, we proxy quality using three measures that do not depend on platforms' feedback. 

- In particular, we use one dummy variable that equals 1 if a movie has received at least one nomination or award to one of the major festival or industry awards around the world. 

- A second dummy variable that equals 1 if a movie has received at least one nomination or award excluding the Academy awards. 

We exclude the Academy awards since previous research has shown that:
- the relevance of the Oscars is such that it may move users' reference point, and affect selection of users who watch the nominated and awarded movies (Rossi, 2021). 

Finally, we use a third dummy variable that equals 1 if a movie has received a Metacritic Metascore greater than 60 .

Quality and popularity are correlated positively.

## Rating Heterogeneity 

Experts have higher standards than Non-Experts.

## 4.4 Debiasing the Ratings 

Of course, individual stringency and ratings are intertwined: updating one implies updating the other. 

Thus, we iterate this process until it converges. 

More formally, for each MovieLens user $ j $, defined as $ \\mathcal{I}_{j} $ the set of movies she has watched. 

Moreover, define by $ n_{j} $ the cardinality of $ \\mathcal{I}_{j} $, or user expertise. 

Then, for each movie $ i \\in \\mathcal{I}_{j} $, compute the movie-user specific stringency as the average movie rating, $ \\bar{r}_{i} $, minus the rating posted by the user, $ r_{i j} $. 

Then, we define the user's stringency as the average of movie-user specific stringency over the set $ \\mathcal{I}_{j} $ :

### (4)

$ s_{j}:=\\frac{\\sum_{i \\in \\mathcal{I}_{j}}\\left(\\bar{r}_{i}-r_{i j}\\right)}{n_{j}} $

Then, we compute new movie ratings 
- which take into account - and correct for - how stringent their watchers are. 

Define by $ \\mathcal{J}_{i} $ the set of all users who have watched movie $ i $, 

and by $ n_{i} $ its cardinality. 

Then, we update, or normalize, movie $ i $ 's rating $ \\bar{r}_{i} $ to:

### (5)

$ \\bar{r}_{i}^{\\text {norm }}:=\\frac{\\sum_{j \\in \\mathcal{J}_{i}}\\left(r_{i j}+s_{j}\\right)}{n_{i}}=\\bar{r}_{i}+\\frac{\\sum_{j \\in \\mathcal{J}_{i}} s_{j}}{n_{i}} $.

Notice:

-  it weights all opinions equally
-   it does not require us to make assumptions about the rating and choice processes for each category of consumers.







placeholder


placeholder


placeholder


placeholder


placeholder


`,__vite_glob_0_11=`---
title: Business Paper - Week 3
---

# Model Evaluation Framework

## OT-based stability evaluation criterion

### Definition 1 (OT discrepancy with moment constraints)

If:

$\\mathcal Z \\subseteq \\mathbb R^d, \\mathcal  W\\subseteq  \\mathbb R_+$: convex, closed sets, 

$c: (\\mathcal Z \\times \\mathcal  W )^2 \\rightarrow  \\mathbb R_+$: lower semicontinuous function,

$\\mathbb Q, \\mathbb  P \\in \\mathcal  P (\\mathcal Z\\times \\mathcal W) $


Then:

$\\mathrm M_c: \\mathcal P(\\mathcal  Z \\times \\mathcal  W )^2 \\rightarrow  \\mathbb R_+$ is a function, defined through

$$
\\mathrm{M}_{c}(\\mathbb{Q}, \\mathbb{P})=\\left\\{\\begin{array}{ll}
\\inf & \\mathbb{E}_{\\pi}[c((Z, W),(\\hat{Z}, \\hat{W}))] \\\\
\\text { s.t. } & \\pi \\in \\mathcal{P}\\left((\\mathcal{Z} \\times \\mathcal{W})^{2}\\right) \\\\
& \\pi_{(Z, W)}=\\mathbb{Q}, \\pi_{(\\hat{Z}, \\hat{W})}=\\mathbb{P} \\\\
& \\mathbb{E}_{\\pi}[W]=1 \\quad \\pi \\text {-a.s }
\\end{array}\\right.
$$

is called OT discrepancy wth moment constraints induced by $c, \\mathbb  Q, \\mathbb P$

$f_\\beta$ : given learning model, trained on the distribution:

$\\mathbb P_0 \\in \\mathcal P (\\mathcal  Z)$, we have:

#### Problem P
$$
\\mathfrak{R}(\\beta, r)=\\left\\{\\begin{array}{cl}
\\inf _{\\mathbb{Q} \\in \\mathcal{P}(\\mathcal{Z} \\times \\mathcal{W})} & \\mathrm{M}_{c}(\\mathbb{Q}, \\hat{\\mathbb{P}}) \\\\
\\text { s.t. } & \\mathbb{E}_{\\mathbb{Q}}[W \\cdot \\ell(\\beta, Z)] \\geq r
\\end{array}\\right.
$$

- $\\hat {\\mathbb  P}$ is selected as $\\mathbb  P_ 0 \\otimes \\delta _1$
  - $\\delta _1 $ : Dirac delta function
  - $\\mathrm M_c (\\mathbb Q, \\hat {\\mathbb P} )$: OT discrepancy with moment constraints between the projected distribution $\\mathbb Q$ and the reference distribution $\\hat{\\mathbb P}$
  - $l(\\beta ,z)$ : prediction risk of model $f_\\beta $ on sample $z$
  - $r > 0$ : pre-defined risk threshold

example c:

##### formula 1

$c((z,w), (\\hat z, \\hat w )) = \\theta _1 \\cdot w \\cdot d(z, \\hat z) +\\theta _2 \\cdot (\\phi  (w) - \\phi (\\hat{w}))_+$

- $d(z,\\hat z) = \\| x - \\hat x \\|^2_2 + \\infty \\cdot | y - \\hat y|$: cost with different $z, \\hat z$

- $(\\phi(w) - \\phi (\\hat w))_+$ : cost related to differences in probability mass.

  - $\\phi : \\mathbb  R_+ \\rightarrow  \\mathbb  R_+$ : convex function, where:
  - $\\phi(1) = 0$
- $\\theta _1, \\theta _2 \\ge 0$ : hyperparameters, where:
  - $\\dfrac{1}{\\theta _1} + \\dfrac{1}{\\theta _2}=C $ for some constant $C$

--- 

## Dual reformulation and its interpretation

### Theorem 1 (Strong duality for problem for problem [(P)](#problem-p))

Suppose:

- $\\mathcal Z \\times \\mathcal  W$ is compact.

- $l(\\beta ,\\cdot )$ is upper semicontinuous for all $\\beta $ 

- $c:(\\mathcal Z\\times\\mathcal W)^2\\rightarrow \\mathbb R_+$ is continuous
- $r<\\bar r := \\max_{z\\in\\mathcal Z}l(\\beta ,z)$

Then:


#### Function D
$\\mathfrak{R}(\\beta, r)=\\sup _{h \\in \\mathbb{R}_{+}, \\alpha \\in \\mathbb{R}} h r+\\alpha+\\mathbb{E}_{\\hat{\\mathbb{P}}}\\left[\\tilde{\\ell}_{c}^{\\alpha, h}(\\beta,(\\hat{Z}, \\hat{W}))\\right]$

- $\\tilde{\\ell}_{c}^{\\alpha, h}(\\beta,(\\hat{Z}, \\hat{W}))$ : surrogate function
  - it equals to : $\\min_{(z,w)\\in\\mathcal Z\\times\\mathcal W}c((z,w),(\\hat z,\\hat w)) + \\alpha w - h\\cdot w \\cdot l(\\beta ,z)$, for all $\\hat z \\in \\mathcal Z, \\hat w \\in \\mathcal W$.

( is it $+aw$ ? in the proof it's $-aw$)

[Skip the proof](#end-proof-for-function-d)

##### Proof for Function D

Reformulate Problem [(P)](#problem-p) into a infinite-dimension linear program:

###### Formula Primal
$$
\\begin{array}{cl}
\\inf _{\\pi} & \\mathbb{E}_{\\pi}[c((Z, W),(\\hat{Z}, \\hat{W}))] \\\\
\\text { s.t. } & \\pi \\in \\mathcal{P}\\left((\\mathcal{Z} \\times \\mathcal{W})^{2}\\right) \\\\
& r-\\mathbb{E}_{\\pi}[W \\cdot \\ell(\\beta, Z)] \\leq 0 \\\\
& \\mathbb{E}_{\\pi}[W]=1 \\\\
& \\pi_{(\\hat{Z}, \\hat{W})}=\\hat{\\mathbb{P}} .
\\end{array}
$$

We get the Lagrangian function

$L(\\pi ; h, \\alpha)=h r+\\alpha+\\mathbb{E}_{\\pi}[c((Z, W),(\\hat{Z}, \\hat{W}))-h \\cdot W \\cdot \\ell(\\beta, Z)-\\alpha \\cdot W]$,

where $h\\in\\mathbb R_+,\\alpha \\in\\mathbb R,\\pi$ belongs to :
- $\\Pi_{\\hat {\\mathbb P}} = \\left\\{  \\pi\\in\\mathcal P((\\mathcal Z\\times\\mathcal W)^2) : \\pi_{(\\hat{Z},\\hat W)} = \\hat{\\mathbb P}\\right\\}$

$\\mathcal Z\\times W$ is compact 

$\\Rightarrow \\mathcal P(\\mathcal  Z\\times\\mathcal W) $ is tight.

$\\Rightarrow \\Pi_{\\hat{\\mathbb P }}$ is tight

$\\Rightarrow  \\Pi_{\\hat{\\mathbb P }}$ has a compact closure (Prokhorov's theorem)

$\\Pi_{\\hat{\\mathbb P }}$ is weakly closed

$\\Rightarrow \\Pi_{\\hat{\\mathbb P }} is compact$ (tight + close)

$\\Pi_{\\hat{\\mathbb P }}$ is convex

###### Prove $L(\\pi; h ,\\alpha)$ is lower semicontinuous in $\\pi $ under the weak topology

Suppose:

$\\pi_n$ converges weakly to $\\pi $

$\\Rightarrow \\liminf_{n\\rightarrow +\\infty}\\int g\\mathrm d \\pi_n \\ge \\int g\\mathrm d  \\pi$, for any lower semicontinuous function $g$ that is bounded below (Portmanteau theorem)

$l(\\beta,\\cdot)$ is upper semicontinuous for all $\\beta $, 

and $w,h\\ge 0 $,

$\\Rightarrow  h\\cdot w \\cdot l(\\beta ,z)$ is upper semicontinuous, w.r.t $(z,w)$

$c((z,w),(\\hat z, \\hat w))$ is lower semicontinuous

$\\Rightarrow c((z,w),(\\hat z, \\hat w)) - h\\cdot w \\cdot l (\\beta,z) - \\alpha\\cdot w $ is lower semicontinuous w.r.t $(z,w)$ for any $(\\hat z,\\hat w) \\in \\mathcal  Z\\times \\mathcal W$

$\\mathcal  Z\\times\\mathcal W$ is compact

$\\Rightarrow $ the function is bounded below

$\\Rightarrow \\liminf_{n\\rightarrow +\\infty}L(\\pi_n;h,\\alpha )\\ge L(\\pi;h,\\alpha )$

$\\Rightarrow L(\\pi;h,\\alpha )$ is lower semicontinuous in $\\pi$ under the weak topology

###### Prove continuous in $(h,\\alpha)$ under the uniform topology in $\\mathbb{R}_+ \\times \\mathbb R$

Suppose:

$\\lim_{n\\to+\\infty}h_n = h$ in Euclidean topology, $\\lim_{n\\to\\infty}|\\alpha _n|<\\bar\\alpha $ in Euclidean topology

Exists:

$\\bar h\\in\\mathbb R_+, \\bar\\alpha \\in\\mathbb R $, with $\\sum_{n\\to\\infty}|h_n|\\le\\bar h, \\sup_{n\\to\\infty }|\\alpha _n|<\\bar\\alpha $, for all $n\\ge 1$

$\\Rightarrow  \\lim_{n\\to+\\infty}L(\\pi;h_n,\\alpha _n) = L(\\pi;h,\\alpha )$ ( dominated convergence theorem)

$\\Rightarrow  L(\\pi;h,\\alpha )$ is continuous in  $(h,\\alpha )$ under the Ecludiean topology in  $\\mathbb R_+ \\times \\mathbb  R$

###### Formula 5

$\\Rightarrow \\inf_{\\pi\\in\\Pi_{\\hat{\\mathbb P }}}\\sup_{h\\in\\mathbb R_+,\\alpha \\in\\mathbb R }L(\\pi;h,\\alpha ) = \\sup_{h\\in\\mathbb R_+,\\alpha \\in\\mathbb R }\\inf_{\\pi\\in\\Pi_{\\hat{\\mathbb P }}}L(\\pi;h,\\alpha )$ (Sion's minmax theorem)

Rewrite:

$L(\\pi ; h, \\alpha)=\\mathbb{E}_{\\pi}\\left[c((Z, W),(\\hat{Z}, \\hat{W}))\\right]+h\\left(r-\\mathbb{E}_{\\pi}[W \\cdot \\ell(\\beta, Z)]\\right)+\\alpha\\left(1-\\mathbb{E}_{\\pi}[W]\\right)$ (The original paper lost a close bracket)

$\\Rightarrow \\inf_{\\pi\\in\\Pi_{\\hat{\\mathbb P }}}\\sup_{h\\in\\mathbb R_+,\\alpha \\in\\mathbb R }L(\\pi;h,\\alpha ) $ is bounded above

We construct:

$\\mathbb Q_0 = \\delta _{(z^*,1)}$

- $z^* = \\argmax_{z\\in\\mathcal Z }l(\\beta ,z)$

Then:

$$
\\begin{aligned}
&\\inf _{\\pi \\in \\Pi_{\\mathbb{P}}} \\sup _{h \\in \\mathbb{R}_{+}, \\alpha \\in \\mathbb{R}} L(\\pi ; h, \\alpha) \\\\
& \\leq \\sup _{h \\in \\mathbb{R}_{+}, \\alpha \\in \\mathbb{R}} L\\left(\\mathbb{Q}_{0} \\otimes \\hat{\\mathbb{P}} ; h, \\alpha\\right) \\\\
& =\\mathbb{E}_{\\mathbb{Q}_{0} \\otimes \\hat{\\mathbb{P}}}[c((Z, W),(\\hat{Z}, \\hat{W}))]+\\sup _{h \\in \\mathbb{R}_{+}} h(r-\\bar{r}) \\quad (E_\\pi[W] = 1)\\\\
& <+\\infty
\\end{aligned}
$$

- $\\bar r = \\mathbb E_{\\mathbb  Q_0 }[l(\\beta ,Z)]$ (Notice $W$ is independent with it) $ = \\max_{z\\in Z }l(\\beta ,Z)$
- combined $c$ is continuous, it's bounded on a compact domain $Z\\times W$ (The suppose)
$$
\\begin{aligned}
\\Rightarrow & r - \\mathbb E_\\pi [W\\cdot l(\\beta ,Z)] \\le 0 \\\\ 
& \\mathbb E_\\pi [W] = 1
\\end{aligned}
$$

Then: for [(5)](#formula-5) right hand side:

$$
\\begin{aligned}
& \\sup _{h \\in \\mathbb{R}_{+}, \\alpha \\in \\mathbb{R}} \\inf _{\\pi \\in \\Pi_{\\mathrm{P}}} L(\\pi ; h, \\alpha) . \\\\
= & \\sup _{h \\in \\mathbb{R}_{+}, \\alpha \\in \\mathbb{R}} h r+\\alpha+\\inf _{\\pi \\in \\Pi_{\\mathbb{®}}} \\mathbb{E}_{\\pi}[c((Z, W),(\\hat{Z}, \\hat{W}))-h \\cdot W \\cdot \\ell(\\beta, Z)-\\alpha \\cdot W] .
\\end{aligned}
$$

Notice:

$$
\\begin{aligned}
& \\inf _{\\pi \\in \\Pi_{\\mathfrak{R}}} \\mathbb{E}_{\\pi}[c((Z, W),(\\hat{Z}, \\hat{W}))-h \\cdot W \\cdot \\ell(\\beta, Z)-\\alpha \\cdot W] \\\\
= & \\mathbb{E}_{\\hat{\\mathbb{P}}}\\left[\\min _{(z, w) \\in \\mathcal{Z} \\times \\mathcal{W}} c((z, w),(\\hat{Z}, \\hat{W}))-h \\cdot w \\cdot \\ell(\\beta, z)-\\alpha \\cdot w\\right],
\\end{aligned}
$$

##### End Proof for Function D

We explore [(1)](#formula-1) with:

- $\\phi (t) = t\\log t - t + 1$, Kullback-Leibler divergence

- $\\phi (t) = (t-1)^2$ , $\\chi^2$-divergence

---

### Proposition 1 (Dual reformulations)

Suppose:

$\\mathcal  W = \\mathbb  R_+$

(i) If:

$\\phi (t) = t\\log t - t + 1$, [(D)](#function-d) admits:

#### function 2

$\\sup_{h\\ge0 }hr - \\theta _2\\log \\mathbb E_{\\mathbb P_0 }\\left[\\exp\\left(\\dfrac{l_{h,\\theta _1 }(\\hat Z)}{\\theta _2 }\\right)\\right]$

(ii) If:

$\\phi(t) = (t-1)^2 $, [(D)](#function-d) admits:

#### function 3

$\\sup _{h \\geq 0, \\alpha \\in \\mathbb{R}} h r+\\alpha+\\theta_{2}-\\theta_{2} \\mathbb{E}_{\\mathbb{P}_{0}}\\left[\\left(\\frac{\\ell_{h, \\theta_{1}}(\\hat{Z})+\\alpha}{2 \\theta_{2}}+1\\right)_{+}^{2}\\right]$


- $l_{h,\\theta _1 }(\\hat z ):=\\max_{z\\in\\mathcal Z }h\\cdot l(\\beta ,z)-\\theta _1 \\cdot d(z,\\hat z)$ : the d-trasform of $h\\cdot l(\\beta, \\cdot)$ with the step size $\\theta_1$

[Skip the Proof](#end-proof-for-proposition-1)

#### Proof for proposition 1

$$
\\begin{aligned}
&\\tilde{\\ell}_{c}^{\\alpha, h}(\\beta,(\\hat{z}, \\hat{w})) \\\\ 
& =\\min _{(z, w) \\in \\mathcal{Z} \\times \\mathcal{W}} \\theta_{1} \\cdot w \\cdot d(z, \\hat{z})+\\theta_{2}(\\phi(w)-\\phi(\\hat{w}))_{+}-\\alpha w-h \\cdot w \\cdot \\ell(\\beta, z) \\\\
& =\\min _{z \\in \\mathcal{Z}} \\theta_{2} \\cdot \\min _{w \\in \\mathbb{R}}-w \\frac{h \\cdot \\ell(\\beta, z)-\\theta_{1} \\cdot d(z, \\hat{z})+\\alpha}{\\theta_{2}}+\\phi(w)+\\mathbb{I}_{\\mathcal{W}}(w) \\text{ // Notice } \\hat W = 1 \\text{ almost surely, and } \\phi(1) = 0\\\\
& =\\min _{z \\in \\mathcal{Z}}-\\theta_{2} \\cdot\\left(\\phi+\\mathbb{I}_{\\mathcal{W}}\\right)^{*}\\left(\\frac{h \\cdot \\ell(\\beta, z)-\\theta_{1} \\cdot d(z, \\hat{z})+\\alpha}{\\theta_{2}}\\right) . \\text{ Convex conjugate}
\\end{aligned}
$$

- $\\mathbb I_{\\mathcal W }(w) = \\begin{cases}
0& \\text{if } w\\in \\mathcal W\\\\
+\\infty &\\text{if }w\\notin \\mathcal W
\\end{cases}
$

- Convex conjugate: $\\min_x\\{-(x,y) + f(x)\\} = -f^* (y)$

(i) When $\\mathcal W = \\mathbb R_+, \\phi (t) = t\\log t -t + 1$:

$(\\phi + \\mathbb I_{\\mathbb R_+})^*(\\cdot) = \\exp(\\cdot) - 1$

- 
$$
\\begin{cases}
&(\\phi + \\mathbb I_{\\mathbb R_+})^*(y) \\\\
&= \\sup_{x\\ge0}\\{xy - (x\\log x-x+1)\\}\\\\
&(Derive) = y - \\log x - 1 + 1 = 0\\\\
&\\Rightarrow x = e^y\\\\
&\\Rightarrow (\\phi + \\mathbb I_{\\mathbb R_+})^*(y)  = ye^y - ye^y + e^y - 1 = e^y - 1
\\end{cases}
$$

Continue:

$$
\\begin{aligned} 
&\\tilde{\\ell}_{c}^{\\alpha, h}(\\beta,(\\hat{z}, \\hat{w})) \\\\ 
& =\\min _{z \\in \\mathcal{Z}}-\\theta_{2} \\cdot \\exp \\left(\\frac{h \\cdot \\ell(\\beta, z)-\\theta_{1} \\cdot d(z, \\hat{z})+\\alpha}{\\theta_{2}}\\right)+\\theta_{2} \\\\ & =-\\theta_{2} \\cdot \\exp \\left(\\frac{\\max _{z \\in \\mathcal{Z}} h \\cdot \\ell(\\beta, z)-\\theta_{1} \\cdot d(z, \\hat{z})+\\alpha}{\\theta_{2}}\\right)+\\theta_{2} \\\\ & =-\\theta_{2} \\cdot \\exp \\left(\\frac{\\ell_{h, \\theta_{1}}(\\hat{z})+\\alpha}{\\theta_{2}}\\right)+\\theta_{2} \\end{aligned} 
$$

Then we reformulate the [(D)](#function-d) :

$\\mathfrak{R}(\\beta, r)=\\sup _{h \\in \\mathbb{R}_{+}, \\alpha \\in \\mathbb{R}} h r+\\alpha-\\theta_{2} \\mathbb{E}_{\\mathbb{P}_{0}}\\left[\\exp \\left(\\frac{\\ell_{h, \\theta_{1}}(\\hat{Z})+\\alpha}{\\theta_{2}}\\right)\\right]+\\theta_{2} $

Derive the $\\alpha  $:

$1-\\exp \\left(\\frac{\\alpha}{\\theta_{2}}\\right) \\mathbb{E}_{\\mathbb{P}_{0}}\\left[\\exp \\left(\\frac{\\ell_{h, \\theta_{1}}(\\hat{Z})}{\\theta_{2}}\\right)\\right]=0$

Solve this and get the $\\alpha  $:

$\\alpha^{\\star}=-\\theta_{2} \\log \\left(\\mathbb{E}_{\\mathbb{P}_{0}}\\left[\\frac{\\ell_{h, \\theta_{1}}(\\hat{z})}{\\theta_{2}}\\right]\\right) $

Put it back:

$\\mathfrak R(\\beta, r)=\\sup _{h \\in \\mathbb{R}_{+}} h r-\\theta_{2} \\log \\left(\\mathbb{E}_{\\mathbb{P}_{0}}\\left[\\exp \\left(\\frac{\\ell_{h, \\theta_{1}}(\\hat{Z})}{\\theta_{2}}\\right)\\right]\\right)$

(ii)

When $ \\mathcal{W}=\\mathbb{R}+ $ and $ \\phi(t)=(t-1)^{2} $

$\\left(\\phi+\\mathbb{I}_{\\mathbb{R}_{+}}\\right)^{*}(\\cdot)=\\left(\\frac{\\cdot}{2}+1\\right)_{+}^{2}-1 $

- 
$$
\\begin{cases}
\\left(\\phi+\\mathbb{I}_{\\mathbb{R}_{+}}\\right)^{*}(y) \\\\
=\\sup_{x\\ge0}xy - (x-1)^2\\\\ 
(Derive) y - 2x + 2 = 0 \\\\ 
x = \\dfrac{y}{2} + 1\\\\
\\left(\\phi+\\mathbb{I}_{\\mathbb{R}_{+}}\\right)^{*}(y) =\\dfrac{y^2}{2} + y - \\dfrac{y^2}{4} \\\\
= (\\dfrac{y}{2} + 1)^2 - 1 
\\end{cases}
$$

Then:

$$
\\begin{aligned} 
&\\tilde{\\ell}_{c}^{\\alpha, h}(\\beta,(\\hat{z}, \\hat{w}))\\\\ 
& =\\min _{z \\in \\mathbb{Z}}-\\theta_{2} \\cdot\\left(\\phi+\\mathbb{I}_{\\mathcal{W}}\\right)^{*}\\left(\\frac{h \\cdot \\ell(\\beta, z)-\\theta_{1} \\cdot d(z, \\hat{z})+\\alpha}{\\theta_{2}}\\right) \\\\ 
& =\\min _{z \\in \\mathcal{Z}}-\\theta_{2} \\cdot\\left(\\frac{h \\cdot \\ell(\\beta, z)-\\theta_{1} \\cdot d(z, \\hat{z})+\\alpha}{2 \\theta_{2}}+1\\right)_{+}^{2}+\\theta_{2} \\\\
& =-\\theta_{2} \\cdot\\left(\\frac{\\ell_{h, \\theta_{1}}(\\hat{z})+\\alpha}{2 \\theta_{2}}+1\\right)_{+}^{2}+\\theta_{2}
\\end{aligned}
$$

Then we reformulate the [(D)](#function-d) :

$\\sup _{h \\geq 0, \\alpha \\in \\mathbb{R}} h r+\\alpha+\\theta_{2}-\\theta_{2} \\mathbb{E}_{\\mathbb{P}_{0}}\\left[\\left(\\frac{\\ell_{h, \\theta_{1}}(\\hat{Z})+\\alpha}{2 \\theta_{2}}+1\\right)_{+}^{2}\\right]$

We can't continue, because it's a piecewise linear equation.

#### End proof for proposition 1

---

### Remark 4 (Structure of the most sensitive distribution)

$\\mathbb  Q^* = \\dfrac{1}{n}\\sum_{n}^{i=1 }\\delta _{(z^*_i,w^*_i)}, (z^*_i, w^*_8)\\in \\mathcal Z \\times \\mathbb R_+$

- $z_{i}^{\\star}=\\underset{z \\in \\mathcal{Z}}{\\arg \\max } h^{\\star} \\ell(\\beta ; z)-\\theta_{1} \\cdot d\\left(z, \\hat{z}_{i}\\right), \\quad \\forall i \\in[n]$

---

## Computation

Address [(2)](#function-2), [(3)](#function-3) with different loss functions.

### Convex piecewise linear loss functions

[(2)](#function-2) admits a tractable finite convex program

### Theorem 2 (KL divergence)

Suppose:

$\\mathcal Z = \\mathbb R^d \\times \\{+1, -1\\},$

$ l(\\{(a_k,b_k)\\}_{k\\in[K]},z)=\\max_{k\\in[K]}y\\cdot a_k^T + b_k$

The negative optimal value of problem [(2)](#function-2) is equivalent to :

$$
\\begin{array}{ll}
\\min & -h r+t \\\\ 
\\text { s.t. } & \\lambda \\in \\mathbb{R}_{+}, t \\in \\mathbb{R}, \\eta \\in \\mathbb{R}_{+}^{n}, p \\in \\mathbb{R}^{n} \\\\ 
& \\left(\\eta_{i}, \\theta_{2}, p_{i}-t\\right) \\in \\mathcal{K}_{\\exp } \\\\ 
& \\frac{\\left\\|a_{k}\\right\\|_{2}^{2}}{4\\theta _1} h^{2}+\\hat{y}_{i} \\cdot a_{k}^{T} \\hat{x}_{i} \\cdot h+b_{k} \\leq p_{i} \\\\ 
& \\frac{1}{n} \\sum_{i=1}^{n} \\eta_{i} \\leq \\theta_{2},\\end{array}
$$

- $\\mathcal K_{\\exp}$ is exponential cone 

- $\\mathcal K_{\\exp }=\\left\\{(z, y, x) \\in \\mathbb{R}^{3}: y>0, y e^{x / y} \\leq z\\right\\} \\cup\\{(z, 0, x): x \\leq 0, z \\geq 0\\}$

[Skip the proof](#end-proof-for-theorem-2)

#### Proof for Theorem 2

Start from [(2)](#function-2):

$$
\\begin{array}{l}
\\sup_{h\\ge0 }hr - \\theta _2\\log \\mathbb E_{\\mathbb P_0 }\\left[\\exp\\left(\\dfrac{l_{h,\\theta _1 }(\\hat Z)}{\\theta _2 }\\right)\\right]\\\\ 
=\\min _{h \\geq 0}-h r+\\theta_{2} \\log \\mathbb{E}_{\\mathbb{P}_{0}}\\left[\\exp \\left(\\dfrac{\\ell_{h, \\theta_{1}}(\\hat{Z})}{\\theta_{2}}\\right)\\right] \\\\
=\\left\\{\\begin{array}{ll}
\\min & -h r+t \\\\
\\text { s.t. } & h \\in \\mathbb{R}_{+}, t \\in \\mathbb{R} \\\\
& \\theta_{2} \\log \\mathbb{E}_{\\mathbb{P}_{0}}\\left[\\exp \\left(\\frac{\\ell_{h, \\theta_{1}}(\\hat{Z})}{\\theta_{2}}\\right)\\right] \\leq t
\\end{array}\\right. \\\\
=\\left\\{\\begin{array}{ll}
\\min & -h r+t \\\\
\\text { s.t. } & \\lambda \\in \\mathbb{R}_{+}, t \\in \\mathbb{R}, \\eta \\in \\mathbb{R}_{+}^{n} \\\\
& \\left(\\eta_{i}, \\theta_{2}, \\ell_{h, \\theta_{1}}\\left(\\hat{z}_{i}\\right)-t\\right) \\in \\mathcal{K}_{\\exp } \\quad \\forall i \\in[n] \\\\
& \\frac{1}{n} \\sum_{i=1}^{n} \\eta_{i} \\leq \\theta_{2}
\\end{array}\\right. \\\\
=\\left\\{\\begin{array}{lll}
\\min & -h r+t & \\\\
\\text { s.t. } & \\lambda \\in \\mathbb{R}_{+}, t \\in \\mathbb{R}, \\eta \\in \\mathbb{R}_{+}^{n}, p \\in \\mathbb{R}_{n} & \\\\
& \\left(\\eta_{i}, \\theta_{2}, p_{i}-t\\right) \\in \\mathcal{K}_{\\exp } & \\forall i \\in[n] \\\\
& \\ell_{h, \\theta_{1}}\\left(\\hat{z}_{i}\\right) \\leq p_{i} & \\forall i \\in[n] \\\\
& \\frac{1}{n} \\sum_{i=1}^{n} \\eta_{i} \\leq \\theta_{2} . &
\\end{array}\\right.
\\end{array}
$$

- To get second euqality, notice :
$$
\\begin{aligned}
& \\theta_{2} \\log \\mathbb{E}_{\\mathbb{P}_{0}}\\left[\\exp \\left(\\frac{\\ell_{h, \\theta_{1}}(\\hat{Z})}{\\theta_{2}}\\right)\\right] \\leq t \\\\ 
& \\Leftrightarrow \\mathbb{E}_{\\mathbb{P}_{0}}\\left[\\exp \\left(\\frac{\\ell_{h, \\theta_{1}}(\\hat{Z})-t}{\\theta_{2}}\\right)\\right] \\leq 1 \\\\ 
&\\lrArr  \\frac{1}{n} \\sum_{i=1}^{n} \\exp \\left(\\frac{\\ell_{h, \\theta_{1}}\\left(\\hat{z}_{i}\\right)-t}{\\theta_{2}}\\right) \\leq 1
\\end{aligned}
$$

- We introduce $\\eta \\in \\mathbb R_+^n$, then decomposed to :

$$
\\left\\{\\begin{array}{l}
\\frac{1}{n} \\sum_{i=1}^{n} \\eta_{i} \\leq \\theta_{2} \\\\ 
\\theta_{2} \\exp \\left(\\frac{\\ell_{h, \\theta_{1}}\\left(\\hat{z}_{i}\\right)-t}{\\theta_{2}}\\right) \\leq \\eta_{i}, \\quad \\forall i \\in[n]\\end{array}\\right.
$$

- The second ineuqality is decomposed by definition of exponential cone
- We introduce $p_i$ to get the last equality

Then: 

##### Formlua 10

$$
\\begin{aligned} 
& \\ell_{h, \\theta_{1}}\\left(\\hat{z}_{i}\\right) \\leq p_{i} \\\\ \\Longleftrightarrow & \\sup _{z \\in \\mathcal{Z}}\\left\\{h \\cdot \\max _{k \\in[K]} y \\cdot a_{k}^{\\top} x+b_{k}-\\theta_{1} d\\left(z, \\hat{z}_{i}\\right)\\right\\} \\leq p_{i} \\\\ \\Longleftrightarrow & \\sup _{z \\in \\mathcal{Z}}\\left\\{h \\cdot y \\cdot a_{k}^{\\top} x+b_{k}-\\theta_{1} d\\left(z, \\hat{z}_{i}\\right)\\right\\} \\leq p_{i} \\forall k \\in[K] \\\\ \\Longleftrightarrow & \\sup _{x \\in \\mathbb{R}^{d}}\\left\\{h \\cdot \\hat{y}_{i} \\cdot a_{k}^{\\top} x+b_{k}-\\theta_{1}\\left\\|x-\\hat{x}_{i}\\right\\|_{2}^{2}\\right\\} \\leq p_{i} \\forall k \\in[K] \\\\ \\Longleftrightarrow & \\frac{\\left\\|a_{k}\\right\\|_{2}^{2}}{4 \\theta_{1}} \\cdot h^{2}+\\hat{y}_{i} \\cdot a_{k}^{T} \\hat{x}_{i} \\cdot h+b_{k} \\leq p_{i}, \\forall k \\in[K]
\\end{aligned}
$$

- Refer to [(2)](#function-2) for first equivalent
- Refer to [(1)](#formula-1) for $d(z,\\hat z_i)$ for third equivalent
- Simple derivation for fourth equivalent

Put everything together:

$$
\\begin{array}{lll}\\min & -h r+t & \\\\ \\text { s.t. } & \\lambda \\in \\mathbb{R}_{+}, t \\in \\mathbb{R}, \\eta \\in \\mathbb{R}_{+}^{n}, p \\in \\mathbb{R}^{n} & \\\\ & \\left(\\eta_{i}, \\theta_{2}, p_{i}-t\\right) \\in \\mathcal{K}_{\\exp } & \\forall i \\in[n] \\\\ & \\frac{\\left\\|a_{k}\\right\\|_{2}^{2}}{4 \\theta_{1}} \\cdot h^{2}+\\hat{y}_{i} \\cdot a_{k}^{T} \\hat{x}_{i} \\cdot h+b_{k} \\leq p_{i}, & \\forall k \\in[K], \\forall i \\in[n] \\\\ & \\frac{1}{n} \\sum_{i=1}^{n} \\eta_{i} \\leq \\theta_{2} . & \\end{array}
$$

#### End proof for Theorem 2

--- 

### Theorem 3 ($\\chi^2$ Divergence)

Suppose:

$\\mathcal Z = \\mathbb R^d\\times {+1,-1}$


$ l(\\{(a_k,b_k)\\}_{k\\in[K]},z)=\\max_{k\\in[K]}y\\cdot a_k^T + b_k$


The negative optimal value of problem [(2)](#function-2) is equivalent to :

$$
\\begin{array}{ll}
\\min & -h r+t \\\\ 
\\text { s.t. } & h \\in \\mathbb{R}_{+}, \\alpha \\in \\mathbb{R}, t \\in \\mathbb{R}, \\eta \\in \\mathbb{R}_{+}^{n} \\\\ 
& \\frac{\\left\\|a_{k}\\right\\|_{2}^{2}}{4 \\theta_{1} \\cdot} \\cdot h^{2}+\\hat{y}_{i} \\cdot a_{k}^{T} \\hat{x}_{i} \\cdot h+b_{k}+ \\alpha+2 \\theta_{2} \\leq 2 \\theta_{2} \\eta_{i} \\\\ 
& \\frac{\\theta_{2}}{n} \\sum_{i=1}^{n} \\eta_{i}^{2} \\leq t
\\end{array}
$$

#### Note for theorem 3

It should be $\\alpha$ instead of $2\\theta_1 \\alpha$, the paper made a mistake here.

[Skip the proof](#end-proof-for-theorem-3)

#### Proof for Theorem 3

Start from [(3)](#function-3) :

$$
\\begin{array}{l}
\\sup _{h \\geq 0, \\alpha \\in \\mathbb{R}} h r+\\alpha+\\theta_{2}-\\theta_{2} \\mathbb{E}_{\\mathbb{P}_{0}}\\left[\\left(\\frac{\\ell_{h, \\theta_{1}}(\\hat{Z})+\\alpha}{2 \\theta_{2}}+1\\right)_{+}^{2}\\right]\\\\ 
=\\min _{h \\geq 0, \\alpha \\in \\mathbb{R}}-h r-\\alpha+\\theta_{2}+\\theta_{2} \\mathbb{E}_{\\mathbb{P}_{0}}\\left[\\left(\\frac{\\ell_{h, \\theta_{1}}(\\hat{Z})+\\alpha}{2 \\theta_{2}}+1\\right)_{+}^{2}\\right] \\\\
=\\left\\{\\begin{array}{ll}
\\min & -h r-\\alpha+t \\\\
\\text { s.t. } & h \\in \\mathbb{R}_{+}, \\alpha \\in \\mathbb{R}, t \\in \\mathbb{R} \\\\
& \\theta_{2} \\mathbb{E}_{\\mathbb{P}_{0}}\\left[\\left(\\frac{\\ell_{h, \\theta_{1}}(\\hat{Z})+\\alpha}{2 \\theta_{2}}+1\\right)_{+}^{2}\\right] \\leq t
\\end{array}\\right. \\\\
=\\left\\{\\begin{array}{ll}
\\min & -h r+t \\\\
\\text { s.t. } & h \\in \\mathbb{R}_{+}, \\alpha \\in \\mathbb{R}, t \\in \\mathbb{R}, \\eta \\in \\mathbb{R}_{+}^{n} \\\\
& \\ell_{h, \\theta_{1}}(\\hat{z})+\\alpha+2 \\theta_{2} \\leq 2 \\theta_{2} \\eta_{i} \\quad \\forall i \\in[n] \\\\
& \\frac{\\theta_{2}}{n} \\sum_{i=1}^{n} \\eta_{i}^{2} \\leq t
\\end{array}\\right. \\\\
=\\left\\{\\begin{array}{ll}
\\min & -h r+t \\\\
\\text { s.t. } & h \\in \\mathbb{R}_{+}, \\alpha \\in \\mathbb{R}, t \\in \\mathbb{R}, \\eta \\in \\mathbb{R}_{+}^{n} \\\\
& \\frac{\\left\\|a_{k}\\right\\|_{2}^{2}}{4 \\theta_{1}} \\cdot h^{2}+\\hat{y}_{i} \\cdot a_{k}^{T} \\hat{x}_{i} \\cdot h+b_{k}+\\alpha+2 \\theta_{2} \\leq 2 \\theta_{2} \\eta_{i} \\quad \\forall k \\in[K], \\forall i \\in[n] \\\\
& \\frac{\\theta_{2}}{n} \\sum_{i=1}^{n} \\eta_{i}^{2} \\leq t
\\end{array}\\right.
\\end{array}
$$

- Reformulate the first equivalent into:
$$
\\left\\{\\begin{array}{l}\\frac{\\theta_{2}}{n} \\sum_{i=1}^{n} \\eta_{i}^{2} \\leq t \\\\ \\ell_{h, \\theta_{1}}(\\hat{z})+2 \\theta_{2} \\alpha+2 \\theta_{2} \\leq 2 \\theta_{2} \\eta_{i}, \\eta_{i} \\in \\mathbb{R}_{+}\\end{array}\\right.
$$
to get the second equivalent 
- Refer to [(10)](#formlua-10) for the last equivalent

#### End proof for Theorem 3

--- 

### 0/1 loss function

$r$: risk level, error rate

$\\ell(\\beta,(x, y))=\\mathbb{I}_{y \\neq f_{\\beta}(x)}$ : loss function 

- $\\beta $ : trained model
- $(x,y) $ : sample
- $\\mathbb{I}_{y \\neq f_{\\beta}(x)} = 1 $ if $y \\ne f_\\beta  (x)$, $0$ otherwise

### Nonlinear loss function

Gradient ascent

---

## Feature stability analysis

For machine learning: 

Modify function $d $:

$d(z, \\hat{z})=\\left\\|z_{(i)}-\\hat{z}_{(i)}\\right\\|_{2}^{2}+\\infty \\cdot\\left\\|z_{(,-i)}-\\hat{z}_{(,-i)}\\right\\|_{2}^{2}$

- $z_{(i)}$ : $i$-th feature of $z$
- $z_{(,-i)} = z\\backslash z_{(i)}$ : all variables in $z $ except for $i$-th

Then the $\\mathfrak R_i(\\beta ,r)$ indicates the stability

---

# Visualizations on stylized / toy examples

Visualize the most sensitive distribution $\\mathbb  Q^*$ based on
[Remark 4](#remark-4-structure-of-the-most-sensitive-distribution)

2d binary classifaction:

$$
\\begin{cases}
100 \\text{ samples} \\\\ 
Y = 0\\\\ 
\\mathcal  N([2,2]^T, I_2)
\\end{cases}
$$


$$
\\begin{cases}
100 \\text{ samples} \\\\ 
Y = 1\\\\ 
\\mathcal  N([-1,-1]^T, I_2)
\\end{cases}
$$

$f_\\beta (\\cdot)$ : Logistic regression

$\\dfrac{1}{\\theta_1} + \\dfrac{1}{\\theta_2} = 5$

risk : $0.5$

then solve $(2)$


placeholder

placeholder

placeholder

placeholder

placeholder

placeholder`,__vite_glob_0_12=`---
title: Business Paper - Week 4
---

# Preliminaries

## Problem setup

### Data generation

#### (1)

$\\mathbf{F O}(\\boldsymbol{\\theta}, \\mathbf{u}): \\min_{\\mathbf x\\in\\mathcal X(\\mathbb u)} f(\\boldsymbol{\\theta}, \\mathbf{x})$

- $\\mathbb x\\in\\mathbb R^n$
- $\\mathcal X(\\mathbf u)$ : feasible region
- $\\mathbf u\\in\\mathbb R^m $ : exogenous parameters
- $f : \\mathbb R^{n\\times d }\\to\\mathbb R $ : objective function
- $\\mathbf u $ distributed according to $\\mathbb P_{\\mathbf  u }$ supported on $\\mathcal  U $

**There exists:**

$\\boldsymbol \\theta ^*$ unknown to the DM(Decision maker)

**DM obtains:**

$\\hat{\\mathbb  x}$ : decision
- by solving: $\\mathbf{F O}(\\hat {\\boldsymbol{\\theta}}, \\mathbf{u})$
- $\\hat{\\boldsymbol \\theta }$: noisy perception of $\\boldsymbol \\theta ^*$
  - $\\mathbb P_{\\boldsymbol \\theta }$ : the distribution of of $\\hat{\\boldsymbol \\theta }$ : unknown
  - $\\boldsymbol \\Theta \\subset \\mathbb R^d$: support set of $\\mathbb P_{\\boldsymbol \\theta }$, bounded
    - $\\boldsymbol \\theta ^*\\in\\boldsymbol \\Theta $
  - $\\mathbb P_{(\\boldsymbol \\theta ,\\mathbf u)}$: joint distribution of $\\hat{\\boldsymbol \\theta} ,\\mathbf u $ 
- $\\tilde {\\mathbf x} : \\boldsymbol \\Theta \\times\\mathcal U \\to\\mathbb R^n $
: oracle, returns an optimal solution to $\\mathbf  {FO}$
  - $\\mathcal X^{\\text{OPT}}(\\boldsymbol \\theta ,\\mathbf u):=\\argmin \\{f(\\boldsymbol \\theta ,\\mathbf x)\\mid \\mathbf x\\in\\mathcal X(\\mathbb u)\\}$ : solutions drawn uniformly from

### Objective function

$f$ is linear in $\\boldsymbol \\theta  $ and convec in $\\mathbf x $

$f(\\boldsymbol \\theta ,\\mathbf x) = \\sum_{i\\in[d]}\\theta _i f_i (\\mathbb x)$
- $f_i : \\mathbb R^n \\to\\mathbb R$ for all $i\\in[d]$ : convex basis functions
  - i.e.: $f(\\boldsymbol{\\theta}, \\mathbf{x})=\\boldsymbol{\\theta}^{\\top} \\mathbf{x}$
- $\\mathbf {FO}$ with it -> multi-objective optimization model

### Learning task

$\\mathcal  D = \\{\\hat{\\mathbf x_k},\\mathbf u_k\\}^N_{k=1}$ : decision-exogenous parameter pairs
- $N$: number

Aim: find

$\\bar{\\mathbf x}: \\mathcal U\\to\\mathbb R^n$: decision policy, to suggest future $\\mathbf u$
- $\\bar{\\mathbf x}(\\mathbb u) \\in\\mathcal X(\\mathbf u)$ for any $\\mathbf u\\in\\mathcal U$: require

### Assumptions

#### Assumption 1 (I.I.D. Samples)

> The dataset $\\mathcal  D$ is generated using : 
> $\\hat{\\mathbf x_k} := \\tilde {\\mathbf x}(\\hat{\\boldsymbol \\theta _k},\\mathbf u_k)$ 
> - $(\\hat{\\boldsymbol \\theta _k}, \\mathbf u_k)$ : i.i.d. samples from $\\mathbb P _{(\\boldsymbol \\theta , \\mathbf u)}$ for all $k\\in[N]$ 




#### Assumption 2 (Bounded Inverse Feasible Set)

#### (2)
> There exists a constant $ \\eta \\in \\mathbb{R}_{+} $ such that, for any $ \\boldsymbol{\\theta}, \\boldsymbol{\\theta}^{\\prime} \\in \\boldsymbol{\\Theta}^{\\mathrm{OPT}}(\\hat{\\mathbf{x}}, \\mathbf{u}) $, for some $ \\hat{\\mathbf{x}} \\in \\mathcal{X}(\\mathbf{u}) $ and $ \\mathbf{u} \\in \\mathcal{U} $: 
>  $ \\left\\|\\boldsymbol{\\theta}-\\boldsymbol{\\theta}^{\\prime}\\right\\|_{2} \\leq \\eta $,
> -  $\\Theta^{\\mathrm{OPT}}(\\mathbf{x}, \\mathbf{u}):=\\left\\{\\boldsymbol{\\theta} \\in \\mathbb{R}^{d} \\mid \\mathbf{x} \\in \\mathcal{X}^{\\mathrm{OPT}}(\\boldsymbol{\\theta}, \\mathbf{u}),\\|\\boldsymbol{\\theta}\\|_{2}=1\\right\\}$

#### Assumption 3 (Bounded Divergence)

> There exists a constant $ \\sigma \\in \\mathbb{R}_{+} $such that :
> $ \\left\\|\\mathbb{E}(\\hat{\\boldsymbol{\\theta}})-\\boldsymbol{\\theta}^{*}\\right\\|_{2} \\leq \\sigma $.

### Evaluation Metrics

#### Definition 1

#### (3)

>  $$ \\operatorname{AOG}(\\overline{\\mathbf{x}}):=\\mathbb{E}\\left[f\\left(\\boldsymbol{\\theta}^{*}, \\overline{\\mathbf{x}}(\\mathbf{u})\\right)-f\\left(\\boldsymbol{\\theta}^{*}, \\tilde{\\mathbf{x}}\\left(\\boldsymbol{\\theta}^{*}, \\mathbf{u}\\right)\\right)\\right] $$ : The actual optimality gap $ (A O G) $ of a decision policy $ \\overline{\\mathbf{x}} $
> - $\\mathbf u, \\bar{\\mathbf x}$ is random
>
> 

#### Definition 2

#### (4)

> $$\\operatorname{POG}(\\overline{\\mathbf{x}}):=\\mathbb{E}[f(\\hat{\\boldsymbol{\\theta}}, \\overline{\\mathbf{x}}(\\mathbf{u}))-f(\\hat{\\boldsymbol{\\theta}}, \\tilde{\\mathbf{x}}(\\hat{\\boldsymbol{\\theta}}, \\mathbf{u}))]$$ : The perceived optimality gap $ (P O G) $ of a decision policy $ \\overline{\\mathbf{x}} $
> - $\\hat{\\boldsymbol \\theta }, \\mathbf u, \\bar{\\mathbf x}$ is random

## Note 1

**An Example for Model, Assumption, Defninition:**

> A investment is needed, allocate money between $n$ assets.

- $\\mathbf x\\in\\mathbb R^n$ : weight for $n$ portfolio
- $\\mathbf u \\in\\mathbb R^m$: market condition (inflation, interest, etc.)
- $\\boldsymbol{\\theta}^*$: true assets return 
- $\\hat{\\boldsymbol{\\theta}}$: estimated assets return 
- $f(\\boldsymbol{\\theta}, \\mathbf{x})$ the return with the given weight and return (e.g.$\\boldsymbol \\theta ^T \\mathbb x$)
- $\\mathcal{X}(\\mathbf{u})$ the feasible weight under the given market condition

> To get the data, every month:

- $\\mathbf{u}_k$: observe the market
- $\\hat{\\boldsymbol{\\theta}}_k$: estimate the return 
- $\\hat{\\mathbf{x}}_k$: make the decision

> Assumptions

- 1: Every month is i.i.d.
- 2: If $\\mathbf x$(weight) is observed, the difference between the $\\boldsymbol \\theta $(return) is not big 
- 3: the average $\\hat{\\boldsymbol \\theta }$ (estimated return) is not far from $\\boldsymbol \\theta ^*$(real return)

> Definitions

- 1: AOG: Real return under current decision - real return under best decision
- 2: POG: Estimated return under current decision - estimated return under best decision

## An Inverse Optimization Pipeline

Finding $\\bar{\\mathbf x}$ is challenging because:

- $\\bar{\\mathbf x}(\\mathbf u)$ to be feasible to $\\mathbf {FO}$, involve more constraints, we can't use supervised learning that predict $\\hat{\\mathbf x}$ on $\\mathbf u $
- We do not observe $\\boldsymbol \\theta ^*$ or $\\hat {\\boldsymbol \\theta }$, we cant use classic ML technique.
- AOG and POG may not connected.

Classic IO pipeline:

Obtain:

$\\bar{\\boldsymbol \\theta }$: point decision 

Employ:

$\\bar{\\mathbf x_{IO}} (\\mathbf u):= \\tilde {\\mathbf x}(\\bar{\\boldsymbol \\theta },\\mathbb u)$ 

We can solve:

#### (5)

$ \\mathbf{I O}(\\mathcal{D}): \\underset{\\boldsymbol{\\theta} \\in \\boldsymbol{\\Theta}}{\\operatorname{min}} \\dfrac{1}{N} \\sum_{k \\in[N]} \\ell\\left(\\hat{\\mathbf{x}}_{k}, \\mathcal{X}^{\\mathrm{OPT}}\\left(\\boldsymbol{\\theta}, \\mathbf{u}_{k}\\right)\\right) $
- $\\ell $: non-negative loss function
  - return $0$ when $\\hat{\\mathbf x_k} \\in\\mathcal X^{OPT }(\\boldsymbol \\theta ,\\mathbf u_k ) $

### Definition 3

#### (6)

> The sub-optimality loss of $ \\boldsymbol{\\theta} $ is given by
$$
\\ell_{S}\\left(\\hat{\\mathbf{x}}, \\mathcal{X}^{O P T}(\\boldsymbol{\\theta}, \\mathbf{u})\\right):=\\max _{\\mathbf{x} \\in \\mathcal{X}^{OPT}(\\boldsymbol \\theta, \\mathbf{u})} f(\\boldsymbol{\\theta}, \\hat{\\mathbf{x}})-f(\\boldsymbol{\\theta}, \\mathbf{x})
$$

**However, it can't be used here, because it will cause arbitrarily large AOG and POG**

### Example 1

Let : 

$\\mathbf {FO}(\\theta, u)$ be: 

#### (7)

$$
\\begin{aligned} 
\\text{min } & \\theta_{1} x_{1}+\\theta_{2} x_{2} \\\\ 
\\text { s.t. } & x_{1}+u x_{2} \\geq u \\\\ 
& 0 \\leq x_{1} \\leq u \\\\ 
& 0 \\leq x_{2} \\leq 2
\\end{aligned}
$$

- $\\boldsymbol \\theta ^* = (\\cos\\dfrac{\\pi}{4},\\sin\\dfrac{\\pi}{4})$
- $\\mathcal U = \\{u\\}$
  - $u > 1$, real constant
- $\\mathcal D = \\{\\hat{\\mathbf x_k}, u\\}^N_{k=1} $
  - $\\hat{\\mathbf x_k} = \\tilde {\\mathbf x}(\\hat{\\boldsymbol \\theta _k},u)$
    - $\\hat{\\boldsymbol \\theta _k}$ uniformly, independently drawn from $\\boldsymbol \\Theta = \\{(\\cos\\delta ,\\sin\\delta )\\mid \\delta \\in(0,\\dfrac{\\pi}{2})\\}$ for all $k\\in[N]$

### Lemma 1
> $ \\overline{\\boldsymbol{\\theta}}_{N} $ : an optimal solution to $ \\mathbf{I O}(\\mathcal{D}) $ with the sub-optimality loss [(6)](#6), we have:
>  $ \\mathbb{P}\\left(\\overline{\\boldsymbol{\\theta}}_{N}=\\boldsymbol{\\theta}_{u}\\right) \\rightarrow $ $ as $ N \\rightarrow \\infty $
> - $ \\boldsymbol{\\theta}_{u}:=\\left(1 / \\sqrt{1+u^{2}}, u / \\sqrt{1+u^{2}}\\right) $.

[Skip the proof](#end-proof-of-lemma-1)

#### Proof of Lemma 1

Let : $\\delta_u := \\arccos(\\dfrac{1}{\\sqrt{1+u^2}})$
- $\\cos\\delta_u = \\dfrac{1}{\\sqrt{1+u^2}}, \\sin\\delta_u = \\dfrac{u}{\\sqrt{1+u^2}}$ 
  - when $ \\hat{\\boldsymbol{\\theta}}_{k} \\in \\boldsymbol{\\Theta}_{1}:= $ $ \\left\\{(\\cos \\delta, \\sin \\delta) \\mid \\delta \\in\\left(0, \\delta_{u}\\right]\\right\\} $, $ \\hat{\\mathbf{x}}_{k}=\\tilde{\\mathbf{x}}\\left(\\hat{\\boldsymbol{\\theta}}_{k}, u\\right)=(0,1) $ almost surely. (Notice the slope)
  - When $ \\hat{\\boldsymbol{\\theta}}_{k} \\in \\boldsymbol{\\Theta}_{2}:= $ $ \\left\\{(\\cos \\delta, \\sin \\delta) \\mid \\delta \\in\\left(\\delta_{u}, \\pi / 2\\right)\\right\\} $, $ \\hat{\\mathbf{x}}_{k}=\\tilde{\\mathbf{x}}\\left(\\hat{\\boldsymbol{\\theta}}_{k}, u\\right)=(u, 0) $ almost surely. (Notice the slope)

Notice:

$\\hat{\\boldsymbol{\\theta}} \\in \\boldsymbol{\\Theta}=\\boldsymbol{\\Theta}_{1} \\cup \\boldsymbol{\\Theta}_{2}$

Then:

##### ($5)

$ \\hat{\\mathbf{x}}_{k}=\\left\\{\\begin{array}{l}(0,1), \\text { w.p. } 2 \\delta_{u} / \\pi \\\\ (u, 0), \\text { w.p. }\\left(\\pi-2 \\delta_{u}\\right) / \\pi\\end{array}\\right. $

$N_1$ : the numbers of $(0,1)$ in $\\mathcal D$

$N_1$ : the numbers of $(u,0)$ in $\\mathcal D$
- $\\mathcal D = \\{\\mathbf u_k,\\hat{\\mathbb x_k}\\}_{k\\in[N]}$

For $\\mathbf {IO}(\\mathcal D)$ :

##### (16)

$ \\overline{\\boldsymbol{\\theta}}_{N}:=\\underset{\\boldsymbol{\\theta} \\in \\boldsymbol{\\Theta}}{\\operatorname{argmin}} \\frac{N_{1}}{N} l_{1}(\\boldsymbol{\\theta})+\\frac{N_{2}}{N} l_{2}(\\boldsymbol{\\theta}) $


##### (17)
- $ l_{1}(\\boldsymbol{\\theta})=\\left\\{\\begin{array}{ll}0, & \\text { if } \\boldsymbol{\\theta} \\in \\boldsymbol{\\Theta}_{1} \\\\ \\theta_{2}-u \\theta_{1}, & \\text { if } \\boldsymbol{\\theta} \\in \\boldsymbol{\\Theta}_{2}\\end{array}\\right. $

##### (18)
- $ l_{2}(\\boldsymbol{\\theta})=\\left\\{\\begin{array}{ll}u \\theta_{1}-\\theta_{2}, & \\text { if } \\boldsymbol{\\theta} \\in \\boldsymbol{\\Theta}_{1}, \\\\ 0, & \\text { if } \\boldsymbol{\\theta} \\in \\boldsymbol{\\Theta}_{2} .\\end{array}\\right. $

Now discuss:

- When $N_1 > 0, N_2 > 0$ The minimum is $0$, occurs at $\\boldsymbol \\theta = (\\cos\\theta_u,\\sin\\delta_u)$
- $N_2 = 0$ : The minimum is $0$, occurs at $\\boldsymbol \\theta\\in\\boldsymbol \\Theta _1$
- $N_1 = 0$ : The minimum is $0$, occurs at $\\boldsymbol \\theta \\in\\boldsymbol \\Theta _2$

Then :


##### ($9)

$ \\mathbb{P}\\left(N_{1} N_{2}>0\\right) \\leq \\mathbb{P}\\left(\\overline{\\boldsymbol{\\theta}}_{N}=\\left(\\cos \\delta_{u}, \\sin \\delta_{u}\\right)\\right) \\leq 1 $

With the probability distribution in [(15)](#15), and $\\mathcal D$ is generated i.i.d. from $\\mathbb P_\\theta $:

##### (20)

$ \\mathbb{P}\\left(N_{1} N_{2}>0\\right)=1-\\left(\\dfrac{2 \\delta_{u}}{\\pi}\\right)^{N}-\\left(1-\\dfrac{2 \\delta_{u}}{\\pi}\\right)^{N} $

it converges to $1$ as $N$ goes to infinity

So $ \\mathbb{P}\\left(\\overline{\\boldsymbol{\\theta}}_{N}=\\left(\\cos \\delta_{u}, \\sin \\delta_{u}\\right)\\right) $ converges to 1 as $N $ goes to infinity (Squeeze Theorem)

#### End Proof of Lemma 1

Notice $\\boldsymbol \\theta ^* \\ne \\boldsymbol \\theta _u$, then AOG and PGO can be arbitrarily large

### Proposition 1

> In Example 1, Let: 
> $ \\overline{\\mathbf{x}}_{\\mathrm{IO}}(u)=\\tilde{\\mathbf{x}}\\left(\\boldsymbol{\\theta}_{u}, u\\right) $. 
> Then:
> For any $ v \\in \\mathbb{R}_{+} $there exists some $ \\bar{u}>1 $ such that: 
> $ \\mathrm{AOG}\\left(\\overline{\\mathrm{x}}_{\\mathrm{IO}}\\right)>v $ and $ \\mathrm{POG}\\left(\\overline{\\mathrm{x}}_{\\mathrm{IO}}\\right)>v $ for any $ u>\\bar{u} $

[Skip the proof](#end-proof-for-proposition-1)



#### Proof for Proposition 1

##### Lemma 4

> In Example 1, Let: 
> $ \\overline{\\mathbf{x}}_{\\mathrm{IO}}(u)=\\tilde{\\mathbf{x}}\\left(\\boldsymbol{\\theta}_{u}, u\\right) $. 
> For any $ v \\in \\mathbb{R}_{+} $there exists some $ \\bar{u}>1 $, such that: 
> $ \\operatorname{AOG}\\left(\\overline{\\mathrm{x}}_{\\mathrm{IO}}\\right)>v $ for any $ u>\\bar{u}_{A O G} $.

###### Proof for lemma 4

According to the definition of $\\bar{\\mathbf  x}$, we know that:

$\\bar{\\mathbf x_{IO}}(u)$ is uniformly drawn from:

###### (21)

$ \\mathcal{X}^{\\mathrm{OPT}}\\left(\\boldsymbol{\\theta}_{u}, u\\right)=\\left\\{\\left.\\left(\\frac{u t}{\\sqrt{u^{2}+1}}, 1-\\frac{t}{\\sqrt{u^{2}+1}}\\right) \\right\\rvert\\, t \\in\\left[0, \\sqrt{u^{2}+1}\\right]\\right\\} $

Since:

$\\boldsymbol \\theta ^* = (\\cos\\dfrac{\\pi}{4},\\sin\\dfrac{\\pi}{4})$ : ground-truth
$\\mathbf x^* = (0,1)$: true optimal solution

$\\tilde f(\\boldsymbol \\theta ^*,u) = \\dfrac{\\sqrt 2}{2}$

Then :

###### (22)

$$
\\begin{aligned}
&\\operatorname{AOG}\\left(\\overline{\\mathrm{x}}_{\\mathrm{IO}}\\right)\\\\ 
&=  \\mathbb{E}\\left[f\\left(\\boldsymbol{\\theta}^{*}, \\overline{\\mathbf{x}}_{\\mathrm{IO}}(\\mathbf{u})\\right)-f\\left(\\boldsymbol{\\theta}^{*}, \\tilde{\\mathbf{x}}\\left(\\boldsymbol{\\theta}^{*}, \\mathbf{u}\\right)\\right)\\right]  \\\\
&=\\int_{0}^{\\sqrt{u^{2}+1}} \\frac{\\sqrt{2}}{2 \\sqrt{u^{2}+1}}\\left(\\frac{u t}{\\sqrt{u^{2}+1}} + 1-\\frac{t}{\\sqrt{u^{2}+1}}\\right) d t-\\frac{\\sqrt{2}}{2}\\\\ 
&=\\frac{\\sqrt{2}(u-1)}{4}
\\end{aligned}
$$

Therefore:

For any $v\\in\\mathbb R_+$, exists:

$\\bar{u}_{\\mathrm{AOG}} = 2\\sqrt 2v + 1$, s.t.:

$\\mathrm{AOG} (\\bar{\\mathbf x}_{\\mathrm{IO}}) > v1, for any 1u > \\bar{u}_{\\mathrm{AOG}}$


###### End proof for lemma 4

##### Lemma 5

> In Example 1, let:  
> $ \\overline{\\mathbf{x}}_{\\mathrm{IO}}(u)=\\tilde{\\mathbf{x}}\\left(\\boldsymbol{\\theta}_{u}, u\\right) $. 
> for any $ v \\in \\mathbb{R}_{+} $there exists some $ \\bar{u}_{P O G}>1 $ such that :
> $ \\mathrm{POG}\\left(\\overline{\\mathrm{x}}_{\\mathrm{IO}}\\right)>v $ for any $ u>\\bar{u}_{\\text {POG }} $.

[Skip the proof](#end-proof-for-lemma-5)

###### Proof for lemma 5

According to the definition of $\\tilde {\\mathbf x}$, $\\bar{\\mathbf x}_{\\mathrm{IO}(u)}$ is uniformly drawn from:

###### (23)

$\\mathcal{X}^{\\mathrm{OPT}}\\left(\\boldsymbol{\\theta}_{u}, u\\right)=\\left\\{\\left.\\left(\\frac{u t}{\\sqrt{u^{2}+1}}, 1-\\frac{t}{\\sqrt{u^{2}+1}}\\right) \\right \\rvert\\, t \\in\\left[0, \\sqrt{u^{2}+1}\\right]\\right\\} $

Similarly, we have:

When $\\hat{\\boldsymbol{\\theta}} \\in \\boldsymbol{\\Theta}_{1}:=\\left\\{(\\cos \\delta, \\sin \\delta) \\mid \\delta \\in\\left(0, \\delta_{u}\\right]\\right\\}$, we have: 

$\\hat{\\mathbf{x}}_{k}=\\tilde{\\mathbf{x}}(\\hat{\\boldsymbol{\\theta}}, u)=(0,1)$,  with $\\tilde{f}(\\hat{\\boldsymbol{\\theta}}, u)=\\hat{\\theta}_{2}$ almost surely; 

When $\\hat{\\boldsymbol{\\theta}} \\in \\Theta_{2}:=\\left\\{(\\cos \\delta, \\sin \\delta) \\mid \\delta \\in\\left(\\delta_{u}, \\pi / 2\\right\\}\\right.$, we have : 

$\\hat{\\mathbf{x}}_{k}=\\tilde{\\mathbf{x}}(\\hat{\\boldsymbol{\\theta}}, u)=(u, 0)$ with $\\tilde{f}(\\hat{\\boldsymbol{\\theta}}, u)=u \\hat{\\theta}_{1}$ almost surely. 

Since the optimal solution drawn from $\\mathcal{X}^{\\mathrm{OPT}}\\left(\\boldsymbol{\\theta}_{u}, u\\right)$ is independent of the DM's perception $\\hat{\\boldsymbol{\\theta}}$, we have:

$$
\\begin{aligned}
&\\operatorname{POG}(\\overline{\\mathbf{x}}_{\\mathrm{IO}})\\\\ 
&=\\mathbb{E}[f(\\hat{\\boldsymbol{\\theta}}, \\overline{\\mathbf{x}}_{\\mathrm{IO}}(\\mathbf{u}))-f(\\hat{\\boldsymbol{\\theta}}, \\tilde{\\mathbf{x}}(\\hat{\\boldsymbol{\\theta}}, \\mathbf{u}))]\\\\ 
&= \\int_{0}^{\\delta_{u}} \\int_{0}^{\\sqrt{u^{2}+1}} \\frac{1}{\\sqrt{u^{2}+1}}\\left[\\frac{u t}{\\sqrt{u^{2}+1}} \\cos \\delta+\\left(1-\\frac{t}{\\sqrt{u^{2}+1}}\\right) \\sin \\delta-\\sin \\delta\\right] d t d \\delta \\\\ 
& +\\int_{\\delta_{u}}^{\\pi / 2} \\int_{0}^{\\sqrt{u^{2}+1}} \\frac{1}{\\sqrt{u^{2}+1}}\\left[\\frac{u t}{\\sqrt{u^{2}+1}} \\cos \\delta+\\left(1-\\frac{t}{\\sqrt{u^{2}+1}}\\right) \\sin \\delta-u \\cos \\delta\\right] d t d \\delta \\\\ 
&= \\frac{1}{2} \\int_{0}^{\\delta_{u}}(u \\cos \\delta-\\sin \\delta) d \\delta+\\frac{1}{2} \\int_{\\delta_{u}}^{\\pi / 2}(-u \\cos \\delta+\\sin \\delta) d \\delta \\\\ 
&= \\sqrt{1+u^{2}}-\\frac{u+1}{2} . \\\\ 
&> \\frac{u-1}{2} \\text{ (notice: } \\sqrt{1+u^2}>u\\text{)}
\\end{aligned}
$$

Therefore, for any $\\in\\mathbb R_+$, exists:

$\\bar{u}_{\\mathrm{POG}}=2 v+1$, such that : 

$\\operatorname{POG}\\left(\\overline{\\mathbf{x}}_{\\mathrm{IO}}\\right)>v$ , for any $u>\\bar{u}_{\\mathrm{POG}}$.

###### End proof for lemma 5

#### End proof for proposition 1

## Robustify the Inverse Optimization Pipeline 

- not solve $\\mathbf{FO}$ with some estimated parameters $\\bar{\\boldsymbol \\theta}$ 

- solve **robust forward optimization problem** with an uncertainty set around $\\bar{\\boldsymbol \\theta }$ :

#### (8)

$\\boldsymbol{\\mathbf  { R F O }}(\\mathcal{C}(\\overline{\\boldsymbol{\\theta}}, \\boldsymbol{\\alpha}), \\mathbf{u}): \\underset{\\mathbf{x} \\in \\mathcal{X}(\\mathbf{u})}{\\operatorname{min}} \\underset{\\boldsymbol{\\theta} \\in \\mathcal{C}(\\overline{\\boldsymbol{\\theta}}, \\boldsymbol{\\alpha})}{\\operatorname{max}} f(\\boldsymbol{\\theta}, \\mathbf{x})$
- $\\mathcal C $: uncertainty set
  - $\\bar{\\boldsymbol \\theta }$: center
  - $\\boldsymbol \\alpha $ : parameters that control the shape / size
- Since $f$ is linear in $\\boldsymbol \\theta $, then:

#### (9)
- $\\mathcal{C}(\\overline{\\boldsymbol{\\theta}}, \\alpha):=\\left\\{\\boldsymbol{\\theta} \\in \\mathbb{R}^{d} \\mid\\|\\boldsymbol{\\theta}\\|_{2}=1, \\boldsymbol{\\theta}^{\\top} \\overline{\\boldsymbol{\\theta}} \\geq \\cos \\alpha\\right\\}$
  - $\\alpha\\in(0,\\pi)$

### Remark 1

TODO

### Lemma 2

> In Example 1, let:  
> $\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(u)$ be an optimal solution to $\\mathbf{R F O}\\left(\\mathcal{C}\\left(\\overline{\\boldsymbol{\\theta}}_{N}, \\alpha\\right)\\right. , u)$
> - $\\overline{\\boldsymbol{\\theta}}_{N}$ is an optimal solution to $\\mathbf{I O}(\\mathcal{D})$ with the sub-optimality loss [(6)](#6).
> 
> When $\\alpha \\in(0, \\pi / 2)$, we have :
> $\\mathbb{P}\\left[\\mathrm{AOG}\\left(\\mathbf{x}_{\\mathrm{CIO}}\\right)=0\\right] \\rightarrow 1$ and $\\mathbb{P}\\left[\\mathrm{POG}\\left(\\overline{\\mathbf{x}}_{\\mathrm{CIO}}\\right)<\\pi / 2 \\sqrt{2}\\right] \\rightarrow 1$ as $N \\rightarrow \\infty$.

#### Proof of lemma 2

TODO

# Conformal Inverse Optimization

## Learning an Uncertainty Set

### Data split

Split $\\mathcal D$ into:

$\\mathcal D_{\\text{train}}, \\mathcal D _{\\text{val}}$, 

Let :

$\\mathcal{K}_{\\text {train }}$ and $\\mathcal{K}_{\\text {val }}$ index $\\mathcal{D}_{\\text {train }}$ and $\\mathcal{D}_{\\text {val }}$,

 $N_{\\text {train }}=\\left|\\mathcal{D}_{\\text {train }}\\right|$ and $N_{\\text {val }}=\\left|\\mathcal{D}_{\\text {val }}\\right|$.

### Point estimation 

Given training set $\\mathcal D_{\\text{train}}$, we obtain a **point estimation** $\\bar{\\boldsymbol \\theta } $ of the unknown parameters

### Uncertainty set calibration

Given a point estimation $\\bar{\\boldsymbol \\theta } $, we solve the following **calibration problem **

#### (10)

$\\begin{aligned} \\mathbf{C P}\\left(\\overline{\\boldsymbol{\\theta}}, \\mathcal{D}_{\\text {val }}, \\gamma\\right): \\underset{\\alpha,\\left\\{\\boldsymbol{\\theta}_{k}\\right\\}_{k \\in \\mathcal{K}_{\\text {val }}}}{\\operatorname{min}} & \\alpha \\\\ \\text { s.t. } & \\hat{\\mathbf{x}}_{k} \\in \\mathcal{X}^{\\mathrm{OPT}}\\left(\\boldsymbol{\\theta}_{k}, \\mathbf{u}_{k}\\right), \\forall k \\in \\mathcal{K}_{\\text {val }} \\\\ & \\sum_{k \\in \\mathcal{K}_{\\text {val }}} \\mathbb{1}\\left[\\boldsymbol{\\theta}_{k} \\in \\mathcal{C}(\\overline{\\boldsymbol{\\theta}}, \\alpha)\\right] \\geq \\gamma\\left(N_{\\text {val }}+1\\right) \\\\ & \\left\\|\\boldsymbol{\\theta}_{k}\\right\\|_{2}=1, \\forall k \\in \\mathcal{K}_{\\text {val }} \\\\ & 0 \\leq \\alpha \\leq \\pi,\\end{aligned}$

- $\\alpha$ controls the size of the uncertainty set 
- $\\boldsymbol \\theta _k $ represent a possible parameter vecto
r associated with $k\\in\\mathcal K_\\text{val}$
- $\\gamma \\in[0,1]$ is a DM-specefied confidence level

How to decompose:

### Theorem 1

>Let: 
> $\\mathcal{D}_{\\mathrm{val}}$ be a dataset, $\\gamma \\in[0,1], \\overline{\\boldsymbol{\\theta}} \\in \\mathbb{R}^{d}, \\tau=\\left\\lceil\\gamma\\left(N_{\\mathrm{val}}+1\\right)\\right\\rceil$ , $\\Gamma_{\\tau}$ be an operator that returns the $\\tau^{\\text {th }}$ largest value in a set. 
> The optimal solution to $\\mathbf{C P}\\left(\\overline{\\boldsymbol{\\theta}}, \\mathcal{D}_{\\text {val }}, \\gamma\\right)$ is: 
> $\\alpha_{\\gamma}:=\\arccos \\left(\\Gamma_{\\tau}\\left(\\left\\{c_{k}\\right\\}_{k \\in \\mathcal{K}_{\\text {vel }}}\\right)\\right)$ 
> - $c_{k}:=\\max _{\\boldsymbol{\\theta}_{k}}\\left\\{\\boldsymbol{\\theta}_{k}^{\\top} \\overline{\\boldsymbol{\\theta}} \\mid \\hat{\\mathbf{x}}_{k} \\in \\mathcal{X}^{\\mathrm{OPT}}\\left(\\boldsymbol{\\theta}_{k}, \\mathbf{u}_{k}\\right),\\left\\|\\boldsymbol{\\theta}_{k}\\right\\|_{2} \\leq 1\\right\\}$.

[Skip the proof](#end-proof-of-theorem-1)

#### Proof of Theorem 1

Define:

$\\hat{\\boldsymbol{\\Theta}}_{k}:=\\boldsymbol{\\Theta}^{\\mathrm{OPT}}\\left(\\mathbf{u}_{k}, \\hat{\\mathbf{x}}_{k}\\right)$ for any $k \\in[N]$

we can optimize:

$c:=\\cos \\alpha $, with $-1\\le c \\le 1$

Introduce:

$y_k\\in\\{0,1\\}$ that :
- $\\hat{\\boldsymbol{\\Theta}}_{k}$intersect learned uncertainty set ( $=1$)
- not intersect : ($=0$)
  - for any $k\\in\\mathcal K_{\\text{val}}$

We rewrite [(10)](#10):

##### (39)

$\\begin{aligned} \\max_{c,\\{\\boldsymbol \\theta _k\\}_{k\\in\\mathcal K_{\\text{val}}},\\{y_k\\}_{k\\in\\mathcal K_{\\text{val}}}}& c \\\\ \\text { s.t. } & \\hat{\\mathbf{x}}_{k} \\in \\mathcal{X}^{\\mathrm{OPT}}\\left(\\boldsymbol{\\theta}_{k}, \\mathbf{u}_{k}\\right), \\quad \\forall k \\in \\mathcal{K}_{\\text {val }} \\\\ & \\boldsymbol{\\theta}_{k}^{\\top} \\overline{\\boldsymbol{\\theta}} \\geq c+2\\left(y_{k}-1\\right), \\quad \\forall k \\in \\mathcal{K}_{\\text {val }} \\\\ & \\sum_{k \\in \\mathcal{K}_{\\text {val }}} y_{k} \\geq\\left\\lceil\\gamma\\left(N_{\\text {val }}+1\\right)\\right\\rceil \\\\ & \\left\\|\\boldsymbol{\\theta}_{k}\\right\\|_{2}=1, \\quad \\forall k \\in \\mathcal{K}_{\\text {val }} \\\\ & -1 \\leq c \\leq 1 \\\\ & y_{k} \\in\\{0,1\\}, \\quad \\forall k \\in \\mathcal{K}_{\\text {val }} .\\end{aligned}$

Notice decision variables $\\boldsymbol \\theta _k$ only interact in secont constraint, we can rewrite:

##### (40)

$\\begin{array}{ll}\\operatorname{max} & c \\\\ \\text { s.t. } & c \\leq c_{k}-2\\left(y_{k}-1\\right), \\quad \\forall k \\in \\mathcal{K}_{\\text {val }} \\\\ & \\sum_{k \\in \\mathcal{K}_{\\text {val }}} y_{k} \\geq\\left\\lceil\\gamma\\left(N_{\\text {val }}+1\\right)\\right\\rceil \\\\ & -1 \\leq c \\leq 1 \\\\ & y_{k} \\in\\{0,1\\}, \\quad \\forall k \\in \\mathcal{K}_{\\text {val }},\\end{array}$

where:


##### (41)

$\\begin{aligned} c_{k}:=\\underset{\\boldsymbol{\\theta}_{k}}{\\max } & \\boldsymbol{\\theta}_{k}^{\\top} \\overline{\\boldsymbol{\\theta}} \\\\ \\text { s.t. } & \\hat{\\mathbf{x}}_{k} \\in \\mathcal{X}^{\\mathrm{OPT}}\\left(\\boldsymbol{\\theta}_{k}, \\mathbf{u}_{k}\\right) \\\\ & \\left\\|\\boldsymbol{\\theta}_{k}\\right\\|_{2} \\leq 1\\end{aligned}$

Notice: optimal solution for [(40)](#40) is:

- $y_k = 1$, for all $k$ s.t. $c_{k} \\geq \\Gamma_{\\tau}\\left(\\left\\{c_{k}\\right\\}_{k \\in \\mathcal{K}_{\\text {val }}}\\right)$
- $y_k = 0$, otherwise
  - $\\tau = \\dfrac{\\gamma (N_{\\text{val}}+1)}{N_{\\text{val}}}$
  - $\\gamma _{\\tau}(\\{c_k\\})$: quantile function

Therefore : 

Optimal objective value of [(40)](#40) is :

$c=\\Gamma_{\\tau}\\left(\\left\\{c_{k}\\right\\}_{k \\in \\mathcal{K}_{\\mathrm{val}}}\\right)$

That is :

$\\alpha_{\\gamma}=\\arccos \\Gamma_{\\tau}\\left(\\left\\{c_{k}\\right\\}_{k \\in \\mathcal{K}_{\\mathrm{val}}}\\right)$

#### End proof of theorem 1

## Properties of Conformal IO

### Theorem 2 (Uncertainty Set Validity)

> Let: 
> $\\mathcal{D}_{\\text {val }}$ : a dataset that satisfies Assumption 1, 
> $(\\hat{\\boldsymbol{\\theta}}, \\mathbf{u})$ : a new i.i.d. sample from $\\mathbb{P}_{(\\boldsymbol{\\theta}, \\mathbf{u})}$,
> $\\hat{\\mathbf{x}}=\\tilde{\\mathbf{x}}(\\hat{\\boldsymbol{\\theta}}, \\mathbf{u})$, 
> $\\hat{\\boldsymbol{\\Theta}}:=\\boldsymbol{\\Theta}^{\\mathrm{OPT}}(\\hat{\\mathbf{x}}, \\mathbf{u})$, 
>  $\\alpha_{\\gamma}$ be an optimal solution to : 
> $\\mathbf{C P}\\left(\\overline{\\boldsymbol{\\theta}}, \\mathcal{D}_{\\text {val }}, \\gamma\\right)$ 
> - $\\overline{\\boldsymbol{\\theta}} \\in \\mathbb{R}^{d}$
> We have:
> #### (11)
> $\\mathbb{P}\\left(\\hat{\\boldsymbol{\\Theta}} \\cap \\mathcal{C}\\left(\\overline{\\boldsymbol{\\theta}}, \\alpha_{\\gamma}\\right) \\neq \\varnothing\\right) \\geq \\gamma$
> - for any $\\gamma \\in\\left[0, N_{\\text {val }} /\\left(N_{\\text {val }}+1\\right)\\right]$
> #### (12)
> $\\left|\\mathbb{P}\\left(\\hat{\\boldsymbol{\\Theta}} \\cap \\mathcal{C}\\left(\\overline{\\boldsymbol{\\theta}}, \\alpha_{\\gamma}\\right) \\neq \\varnothing\\right)-\\gamma\\right| \\leq \\sqrt{\\frac{8 \\log \\left(N_{v a l}+1\\right)+2 \\log N_{v a l}}{N_{v a l}}}+\\frac{2}{N_{v a l}}$
> - with probability at least $1-\\dfrac 1 N_{\\text {val }}$
> for any $\\gamma \\in[0,1 ]$

[Skip the proof](#proof-of-theorem-2)

#### Proof of Theorem 2

We define:

##### (42)
 
$ \\begin{aligned} A_{\\overline{\\boldsymbol{\\theta}}}(\\hat{\\mathbf{x}}, \\mathbf{u}):=\\underset{\\boldsymbol{\\theta}}{\\operatorname{max }} & \\boldsymbol{\\theta}^{\\mathrm{\\top}} \\overline{\\boldsymbol{\\theta}} \\\\ \\text { s.t.  } & \\boldsymbol{\\theta} \\in \\boldsymbol{\\Theta}^{\\mathrm{OPT}}(\\hat{\\mathbf{x}}, \\mathbf{u}) \\\\ & \\|\\boldsymbol{\\theta}\\|_{2} \\leq 1 .\\end{aligned} $

Notice:

$ c_{k}=A_{\\overline{\\boldsymbol{\\theta}}}\\left(\\hat{\\mathbf{x}}_{k}, \\mathbf{u}_{k}\\right) $ for any $ k \\in \\mathcal{K}_{\\text {val }} $
- $c_k$ is defined in [Theorem 1](#theorem-1)

Let:


$\\tau = [\\gamma (N_{\\text{val }}+1)]$

$ \\mathcal{A}:=\\left\\{A_{\\overline{\\boldsymbol{\\theta}}}\\left(\\hat{\\mathbf{x}}_{k}, \\mathbf{u}_{k}\\right)\\right\\}_{k \\in \\mathcal{K}_{\\mathrm{val}}} $

Then: 

##### (43)

$ \\mathbb{P}\\left(\\boldsymbol{\\Theta}^{\\mathrm{OPT}}(\\hat{\\mathbf{x}}, \\mathbf{u}) \\cap \\mathcal{C}(\\overline{\\boldsymbol{\\theta}}, \\alpha) \\neq \\varnothing\\right)=\\mathbb{P}\\left(A_{\\overline{\\boldsymbol{\\theta}}}(\\hat{\\mathbf{x}}, \\mathbf{u}) \\geq \\Gamma^{\\tau}(\\mathcal{A})\\right) $

Let : 

$ \\mathcal{D}^{\\prime}=\\mathcal{D}_{\\text {val }} \\cup\\{(\\hat{\\mathbf{x}}, \\mathbf{u})\\} $

$ \\mathcal{A}^{\\prime}=\\mathcal{A} \\cup\\left\\{A_{\\overline{\\boldsymbol{\\theta}}}(\\hat{\\mathbf{x}}, \\mathbf{u})\\right\\} $

Then : 

$ \\begin{aligned} \\gamma & \\leq \\mathbb{P}\\left\\{A_{\\overline{\\boldsymbol{\\theta}}}(\\hat{\\mathbf{x}}, \\mathbf{u}) \\geq \\Gamma^{\\tau}\\left(\\mathcal{A}^{\\prime}\\right)\\right\\} \\\\ & =1-\\mathbb{P}\\left\\{A_{\\overline{\\boldsymbol{\\theta}}}(\\hat{\\mathbf{x}}, \\mathbf{u})<\\Gamma^{\\tau}\\left(\\mathcal{A}^{\\prime}\\right)\\right\\} \\\\ & =1-\\mathbb{P}\\left\\{A_{\\overline{\\boldsymbol{\\theta}}}(\\hat{\\mathbf{x}}, \\mathbf{u})<\\Gamma^{\\tau}(\\mathcal{A})\\right\\} \\\\ & =\\mathbb{P}\\left\\{A_{\\overline{\\boldsymbol{\\theta}}}(\\hat{\\mathbf{x}}, \\mathbf{u}) \\geq \\Gamma^{\\tau}(\\mathcal{A})\\right\\} \\\\ & =\\mathbb{P}\\left\\{\\boldsymbol{\\Theta}^{\\mathrm{OPT}}(\\hat{\\mathbf{x}}, \\mathbf{u}) \\cap \\mathcal{C}(\\overline{\\boldsymbol{\\theta}}, \\alpha) \\neq \\varnothing\\right\\}\\end{aligned} $


Next, Let:

$ z_{k}:=\\left(\\mathbf{u}_{k}, \\hat{\\mathbf{x}}_{k}\\right), \\mathcal{Z}:= $ $ \\left\\{z_{k}\\right\\}_{k \\in \\mathcal{K}_{\\text {val }}} $

Define:

##### (44)

$ \\mathcal{H}=\\left\\{h(z, \\alpha)=\\mathbb{1}\\left[\\boldsymbol{\\Theta}^{\\mathrm{OPT}}(\\hat{\\mathbf{x}}, \\mathbf{u}) \\cap \\mathcal{C}(\\overline{\\boldsymbol{\\theta}}, \\alpha)\\right] \\mid \\alpha \\in(0, \\pi)\\right\\} $

##### (36)

$ \\Pi_{\\mathcal{H}}(N):=\\max _{\\left(Z_{1}, Z_{2}, \\ldots, Z_{N}\\right) \\in \\mathcal{Z}^{N}}\\left|\\left\\{\\left(h\\left(Z_{1}\\right), h\\left(Z_{2}\\right), \\ldots, h\\left(Z_{N}\\right)\\right) \\mid h \\in \\mathcal{H}\\right\\}\\right| $

We can see:

##### (45)

$ \\Pi_{\\mathcal{H}}\\left(N_{\\mathrm{val}}\\right)=N_{\\mathrm{val}}+1 $

##### Lemma 9

> Let $ \\mathcal{H} $ be a class of functions taking values in $ \\{1,-1\\} $, 
> Then, for any integer $ N \\geq 1 $, the following holds
> $
\\Re_{N}(\\mathcal{H}) \\leq \\sqrt{\\frac{2 \\log \\Pi_{\\mathcal{H}}(N)}{N}} .
$
##### (35)

> - $
\\mathfrak{R}_{N}(\\mathcal{F}):=\\mathbb{E}_{\\mathcal{D} \\sim \\mathbb{P}^{N}}\\left[\\hat{\\mathfrak{R}}_{\\mathcal{D}}(\\mathcal{F})\\right]
$

Then : 

$ \\gamma \\leq \\frac{1}{N_{\\text {val }}} \\sum_{k \\in \\mathcal{K}_{\\text {val }}} h\\left(z_{k}, \\alpha\\right) \\leq \\gamma+\\frac{2}{N_{\\text {val }}} $.

##### (46)

$ \\Re_{N_{\\mathrm{val}}}(\\mathcal{H}) \\leq \\sqrt{\\dfrac{2 \\log \\left(N_{\\mathrm{val}}+1\\right)}{N_{\\mathrm{val}}}} $

Notice, $\\alpha$ is the smallest value that:

##### (47)

$ \\dfrac{1}{N_{\\text {val }}} \\sum_{k \\in \\mathcal{K}_{\\text {val }}} h\\left(z_{k}, \\alpha\\right)=\\dfrac{1}{N_{\\text {val }}} \\sum_{k \\in \\mathcal{K}_{\\text {val }}} \\mathbb{1}\\left[\\boldsymbol{\\Theta}^{\\mathrm{OPT}}\\left(\\hat{\\mathbf{x}}_{k}, \\mathbf{u}_{k}\\right) \\cap \\mathcal{C}(\\overline{\\boldsymbol{\\theta}}, \\alpha)\\right]=\\dfrac{\\left\\lceil\\gamma\\left(N_{\\text {val }}+1\\right)\\right\\rceil}{N_{\\text {val }}} $

So:

$ \\gamma \\leq \\dfrac{1}{N_{\\text {val }}} \\sum_{k \\in \\mathcal{K}_{\\text {val }}} h\\left(z_{k}, \\alpha\\right) \\leq \\gamma+\\dfrac{2}{N_{\\text {val }}} $.

##### Lemma 10

> For any b-uniformly bounded class of functions $ \\mathcal{F} $, any positive integer $ N \\geq 1 $, and any scalar $ \\delta \\geq 0 $, 
> with probability at least:  
> $ 1-\\exp \\left(-N \\delta^{2} /\\left(2 b^{2}\\right)\\right) $, 
> we have : 
> $\\sup _{f \\in \\mathcal{F}}\\left|\\frac{1}{N} \\sum_{i \\in[N]} f\\left(X_{i}\\right)-\\mathbb{E}\\left[f\\left(X_{i}\\right)\\right]\\right| \\leq 2 \\mathfrak{R}_{N}(\\mathcal{F})+\\delta$  
> - $ \\mathfrak{R}(\\mathcal{F}) $ denotes the Rademacher complexity of the function class $ \\mathcal{F} $.

Then with probability at least $\\delta = 1 - \\dfrac{1}{N_\\text{val}}$ :

##### (50)

$ \\left|\\dfrac{1}{N_{\\text {val }}} \\sum_{k \\in \\mathcal{K}_{\\text {val }}} h\\left(z_{k}, \\alpha\\right)-\\mathbb{E}[h(z, \\alpha)]\\right| \\leq 2 \\mathfrak{R}_{N_{\\text {val }}}(\\mathcal{H})+\\sqrt{\\dfrac{2 \\log N_{\\text {val }}}{N_{\\text {val }}}} $

Combine [(46)](#46) - [(50)](#50) is all

#### End proof of Theorem 2

### Lemma 3

> For any : 
> $ \\hat{\\mathbf{x}} \\in \\tilde{\\mathbf{x}}(\\hat{\\boldsymbol{\\theta}}, \\mathbf{u}) $ and $ (\\hat{\\boldsymbol{\\theta}}, \\mathbf{u}) \\in \\boldsymbol{\\Theta} \\times \\mathcal{U} $, 
> there exists a constant : 
> $ \\nu(\\hat{\\mathbf{x}}) \\in \\mathbb{R}_{+} $ 
> such that, for any : 
> $ \\boldsymbol{\\theta}, \\boldsymbol{\\theta}^{\\prime} \\in \\boldsymbol{\\Theta} $, 
> we have : 
> $ f(\\boldsymbol{\\theta}, \\hat{\\mathbf{x}})-f\\left(\\boldsymbol{\\theta}^{\\prime}, \\hat{\\mathbf{x}}\\right) \\leq \\nu(\\hat{\\mathbf{x}})\\left\\|\\boldsymbol{\\theta}-\\boldsymbol{\\theta}^{\\prime}\\right\\|_{2} $

[Skip the proof](#end-proof-for-lemma-3)

#### Proof of Lemma 3

For any fixed $\\mathbb x$, we have:

$ \\begin{aligned} f(\\boldsymbol{\\theta}, \\hat{\\mathbf{x}})-f\\left(\\boldsymbol{\\theta}^{\\prime}, \\hat{\\mathbf{x}}\\right) & =\\sum_{i \\in[d]}\\left(\\theta_{i}-\\theta_{i}^{\\prime}\\right) f_{i}(\\hat{\\mathbf{x}}) \\\\ & \\leq \\sqrt{\\sum_{i \\in[d]} f_{i}^{2}(\\hat{\\mathbf{x}})} \\sqrt{\\sum_{i \\in[d]}\\left(\\theta_{i}-\\theta_{i}^{\\prime}\\right)^{2}} \\\\ & =\\nu(\\hat{\\mathbf{x}})\\left\\|\\boldsymbol{\\theta}-\\boldsymbol{\\theta}^{\\prime}\\right\\|_{2}\\end{aligned} $
- $ \\nu(\\hat{\\mathbf{x}}):=\\sqrt{\\sum_{i \\in[d]} f_{i}^{2}(\\hat{\\mathbf{x}})} $

#### End proof of lemma 3

### Theorem 3 (POG Bound)

> Let $ \\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u}) $ be an optimal solution to $ \\mathbf{R F O}\\left(\\mathcal{C}\\left(\\overline{\\boldsymbol{\\theta}}, \\alpha_{1}\\right), \\mathbf{u}\\right) $ for any $ \\mathbf{u} \\in \\mathcal{U} $ 
> - $ \\overline{\\boldsymbol{\\theta}} \\in \\mathbb{R}^{d} $ and $ \\alpha_{1} $ are chosen such that : 
>   - for a new sample : $ \\left(\\boldsymbol{\\theta}^{\\prime}, \\mathbf{u}^{\\prime}\\right) $ from $ \\mathbb{P}_{(\\boldsymbol{\\theta}, \\mathbf{u})} $ and $ \\mathbf{x}^{\\prime}=\\tilde{\\mathbf{x}}\\left(\\boldsymbol{\\theta}^{\\prime}, \\mathbf{u}^{\\prime}\\right) $, $ \\mathbb{P}\\left(\\mathcal{C}\\left(\\overline{\\boldsymbol{\\theta}}, \\alpha_{1}\\right) \\cap \\Theta^{\\mathrm{OPT}}\\left(\\mathbf{u}^{\\prime}, \\mathbf{x}^{\\prime}\\right) \\neq \\varnothing\\right)=1 $. 
> 
> If Assumptions [2](#assumption-2-bounded-inverse-feasible-set)-[3](#assumption-3-bounded-divergence) hold, then :
> $\\operatorname{POG}\\left(\\overline{\\mathbf{x}}_{\\mathrm{CIO}}\\right) \\leq\\left(\\eta-2 \\cos 2 \\alpha_{1}+2\\right) \\mu+\\eta \\mu_{\\mathrm{CIO}}$ 
> and 
> $\\mathrm{AOG}\\left(\\overline{\\mathbf{x}}_{\\mathrm{CIO}}\\right) \\leq\\left(2-2 \\cos 2 \\alpha_{1}+\\eta+\\sigma\\right) \\mu^{*}+(\\eta+\\sigma) \\mu_{\\mathrm{CIO}}$
> - $ \\mu:=\\mathbb{E}[\\nu(\\tilde{\\mathbf{x}}(\\hat{\\boldsymbol{\\theta}}, \\mathbf{u}))]$
> - $ \\mu_{\\mathrm{CIO}}:=\\mathbb{E}\\left(\\nu\\left[\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right]\\right) $ 
> - $ \\mu^{*}:=\\mathbb{E}\\left(\\nu\\left[\\tilde{\\mathbf{x}}\\left(\\boldsymbol{\\theta}^{*}, \\mathbf{u}\\right)\\right]\\right) $.


#### Proof of Theorem 3

#### Proposition 2 (Conformal IO Achieves Bounded POG). 

> Let : 
> $ \\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u}) $ be an optimal solution to $ \\operatorname{RFO}\\left(\\mathcal{C}\\left(\\overline{\\boldsymbol{\\theta}}, \\alpha_{1}\\right), \\mathbf{u}\\right) $ for any $ \\mathbf{u} \\in \\mathcal{U} $ 
> - $ \\overline{\\boldsymbol{\\theta}} \\in \\mathbb{R}^{d} $ and $ \\alpha_{1} $ are chosen such that : 
>   - for a new sample $ \\left(\\boldsymbol{\\theta}^{\\prime}, \\mathbf{u}^{\\prime}\\right) $ from $ \\mathbb{P}_{(\\boldsymbol{\\theta}, \\mathbf{u})} $ and $ \\mathbf{x}^{\\prime}=\\tilde{\\mathbf{x}}\\left(\\boldsymbol{\\theta}^{\\prime}, \\mathbf{u}^{\\prime}\\right), \\mathbb{P}\\left(\\mathcal{C}\\left(\\overline{\\boldsymbol{\\theta}}, \\alpha_{1}\\right) \\cap \\boldsymbol{\\Theta}^{\\mathrm{OPT}}\\left(\\mathbf{u}^{\\prime}, \\mathbf{x}^{\\prime}\\right) \\neq \\varnothing\\right)=1 $. 
> 
> If Assumptions [2](#assumption-2-bounded-inverse-feasible-set)-[3](#assumption-3-bounded-divergence) hold, then: 
> $\\operatorname{POG}\\left(\\overline{\\mathbf{x}}_{\\mathrm{CIO}}\\right) \\leq\\left(\\eta-2 \\cos 2 \\alpha_{1}+2\\right) \\mu+\\eta \\mu_{\\mathrm{CIO}}$
> - $ \\mu:=\\mathbb{E}[\\nu(\\tilde{\\mathbf{x}}(\\hat{\\boldsymbol{\\theta}}, \\mathbf{u}))] $ 
> - $ \\mu_{\\mathrm{CIO}}:=\\mathbb{E}\\left(\\nu\\left[\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right]\\right) $.

[Skip the proof](#end-proof-of-proposition-2)

##### Proof of Proposition 2

Let :  

$ (\\hat{\\boldsymbol{\\theta}}, \\mathbf{u}) $ be a sample from : 

$ \\mathbb{P}_{(\\boldsymbol{\\theta}, \\mathbf{u})}, \\hat{\\mathbf{x}}=\\tilde{\\mathbf{x}}(\\hat{\\boldsymbol{\\theta}}, \\mathbf{u}), $ 

$\\hat{\\boldsymbol{\\theta}}_{\\mathrm{CIO}}(\\mathbf{u}) $ be the optimal solution to the inner maximization problem in $ \\mathbf{R F O}\\left(\\mathcal{C}\\left(\\overline{\\boldsymbol{\\theta}}, \\alpha_{1}\\right), \\mathbf{u}\\right) $ 
- the outer decision variable is set to $ \\hat{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbb u)$

If : 

$ \\Theta^{\\mathrm{OPT}}(\\hat{\\mathbf{x}}, \\mathbf{u}) \\cap \\mathcal{C}\\left(\\overline{\\boldsymbol{\\theta}}, \\alpha_{1}\\right) \\neq \\varnothing $, 

let : 

$ \\tilde{\\boldsymbol{\\theta}} $ be an element of $ \\boldsymbol{\\Theta}^{\\mathrm{OPT}}(\\hat{\\mathbf{x}}, \\mathbf{u}) \\cap \\mathcal{C}\\left(\\overline{\\boldsymbol{\\theta}}, \\alpha_{1}\\right) $

We have:

$ \\begin{aligned} & f\\left(\\hat{\\boldsymbol{\\theta}}, \\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right)-f(\\hat{\\boldsymbol{\\theta}}, \\hat{\\mathbf{x}}) \\\\ \\leq & f\\left(\\tilde{\\boldsymbol{\\theta}}, \\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right)-f(\\tilde{\\boldsymbol{\\theta}}, \\hat{\\mathbf{x}})+\\left[\\nu(\\hat{\\mathbf{x}})+\\nu\\left(\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right)\\right]\\|\\hat{\\boldsymbol{\\theta}}-\\tilde{\\boldsymbol{\\theta}}\\|_{2} \\\\ \\leq & f\\left(\\tilde{\\boldsymbol{\\theta}}, \\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right)-f(\\tilde{\\boldsymbol{\\theta}}, \\hat{\\mathbf{x}})+\\eta\\left[\\nu(\\hat{\\mathbf{x}})+\\nu\\left(\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right)\\right] \\\\ \\leq & f\\left(\\overline{\\boldsymbol{\\theta}}_{\\mathrm{CIO}}(\\mathbf{u}), \\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right)-f(\\tilde{\\boldsymbol{\\theta}}, \\hat{\\mathbf{x}})+\\eta\\left[\\nu(\\hat{\\mathbf{x}})+\\nu\\left(\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right)\\right] \\\\ \\leq & f\\left(\\hat{\\boldsymbol{\\theta}}_{\\mathrm{CIO}}(\\mathbf{u}), \\hat{\\mathbf{x}}\\right)-f(\\tilde{\\boldsymbol{\\theta}}, \\hat{\\mathbf{x}})+\\eta\\left[\\nu(\\hat{\\mathbf{x}})+\\nu\\left(\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right)\\right] \\\\ \\leq & \\nu(\\hat{\\mathbf{x}})\\left\\|\\hat{\\boldsymbol{\\theta}}_{\\mathrm{CIO}}(\\mathbf{u})-\\tilde{\\boldsymbol{\\theta}}\\right\\|_{2}+\\eta\\left[\\nu(\\hat{\\mathbf{x}})+\\nu\\left(\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right)\\right] \\\\ \\leq & 2 \\nu(\\hat{\\mathbf{x}})\\left(1-\\cos 2 \\alpha_{1}\\right)+\\eta\\left(\\nu(\\hat{\\mathbf{x}})+\\nu\\left[\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right]\\right) \\\\ = & \\nu(\\hat{\\mathbf{x}})\\left(\\eta-2 \\cos 2 \\alpha_{1}+2\\right)+\\eta \\nu\\left[\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right] .\\end{aligned} $

First line : [Lemma 3](#lemma-3)

Second line : [Assumption 2](#assumption-2-bounded-inverse-feasible-set)

Third line : Definition

Fourth line : $ \\left(\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u}), \\overline{\\boldsymbol{\\theta}}_{\\mathrm{CIO}}(\\mathbf{u})\\right) $ is an optimal solution to $ \\boldsymbol{\\operatorname { R F O }}\\left(\\mathcal{C}\\left(\\overline{\\boldsymbol{\\theta}}, \\alpha_{1}\\right), \\mathbf{u}\\right) $

Fifth line : [Lemma 3](#lemma-3)

Sixth line : both $ \\hat{\\boldsymbol{\\theta}}_{\\mathrm{CIO}}(\\mathbf{u}) $ and $ \\tilde{\\boldsymbol{\\theta}} $ are in $ \\mathcal{C}\\left(\\overline{\\boldsymbol{\\theta}}, \\alpha_{1}\\right) $ so the angle between them is no larger than $ 2 \\alpha_{1} $. the $ L_{2} $ distance between them are bounded by $ 2\\left(1-\\cos 2 \\alpha_{1}\\right) $

Since $ \\alpha_{1} $ is chosen such that $ \\mathbb{P}\\left(\\boldsymbol{\\Theta}^{\\mathrm{OPT}}(\\hat{\\mathbf{x}}, \\mathbf{u}) \\cap \\mathcal{C}\\left(\\overline{\\boldsymbol{\\theta}}, \\alpha_{1}\\right)\\right)=1 $, we have ： 

$ \\begin{aligned} \\operatorname{POG}\\left(\\overline{\\mathbf{x}}_{\\mathrm{CIO}}\\right) & =\\mathbb{E}\\left[f\\left(\\hat{\\boldsymbol{\\theta}}, \\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right)-f(\\hat{\\boldsymbol{\\theta}}, \\hat{\\mathbf{x}})\\right] \\\\ & \\leq \\mathbb{E}\\left\\{\\nu(\\hat{\\mathbf{x}})\\left(\\eta-2 \\cos 2 \\alpha_{1}+2\\right)+\\eta \\nu\\left[\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right]\\right\\} \\\\ & =\\mu\\left(\\eta-2 \\cos 2 \\alpha_{1}+2\\right)+\\eta \\mu_{\\mathrm{CIO}}\\end{aligned} $

- $ \\mu:=\\mathbb{E}[\\nu(\\hat{\\mathbf{x}})] $ 
- $ \\mu_{\\mathrm{CIO}}:=\\mathbb{E}\\left(\\nu\\left[\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right]\\right) $

##### End Proof of Proposition 2

#### Proposition 3 (Conformal IO Achieves Bounded AOG). 

Let :

$ \\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u}) $ 

be an optimal solution to : 

$ \\operatorname{RFO}\\left(\\mathcal{C}\\left(\\overline{\\boldsymbol{\\theta}}, \\alpha_{1}\\right), \\mathbf{u}\\right) $ for any $ \\mathbf{u} \\in \\mathcal{U} $ 

- $ \\overline{\\boldsymbol{\\theta}} \\in \\mathbb{R}^{d} $ and $ \\alpha_{1} $ are chosen such that : 
  - for a new sample $ \\left(\\boldsymbol{\\theta}^{\\prime}, \\mathbf{u}^{\\prime}\\right) $ from $ \\mathbb{P}_{(\\boldsymbol{\\theta}, \\mathbf{u})} $ and $ \\mathbf{x}^{\\prime}=\\tilde{\\mathbf{x}}\\left(\\boldsymbol{\\theta}^{\\prime}, \\mathbf{u}^{\\prime}\\right), \\mathbb{P}\\left(\\mathcal{C}\\left(\\overline{\\boldsymbol{\\theta}}, \\alpha_{1}\\right) \\cap \\boldsymbol{\\Theta}^{\\mathrm{OPT}}\\left(\\mathbf{u}^{\\prime}, \\mathbf{x}^{\\prime}\\right) \\neq \\varnothing\\right)=1 $. 
  
If Assumptions [2](#assumption-2-bounded-inverse-feasible-set)-[3](#assumption-3-bounded-divergence) hold, then

$
\\operatorname{AOG}\\left(\\overline{\\mathbf{x}}_{\\mathrm{CIO}}\\right) \\leq\\left(2-2 \\cos 2 \\alpha_{1}+\\eta+\\sigma\\right) \\mu^{*}+(\\eta+\\sigma) \\mu_{\\mathrm{CIO}}
$
-  $ \\mu^{*}:=\\mathbb{E}\\left(\\nu\\left[\\tilde{\\mathbf{x}}\\left(\\boldsymbol{\\theta}^{*}, \\mathbf{u}\\right)\\right]\\right) $.

[Skip the proof](#end-proof-of-proposition-3)

##### Proof of Proposition 3


Let : 

$ (\\hat{\\boldsymbol{\\theta}}, \\mathbf{u}) $ be a sample from $ \\mathbb{P}_{(\\boldsymbol{\\theta}, \\mathbf{u})}, \\hat{\\mathbf{x}}=\\tilde{\\mathbf{x}}(\\hat{\\boldsymbol{\\theta}}, \\mathbf{u}) $, 

$ \\tilde{\\boldsymbol{\\theta}} $ be an element of $ \\boldsymbol{\\Theta}^{\\mathrm{OPT}}(\\hat{\\mathbf{x}}, \\mathbf{u}) \\cap \\mathcal{C}\\left(\\overline{\\boldsymbol{\\theta}}, \\alpha_{1}\\right) $ 

-  is non-empty almost surely because $ \\alpha_{1} $ is chosen such that : 
  -  $ \\mathbb{P}\\left(\\boldsymbol{\\Theta}^{\\mathrm{OPT}}(\\hat{\\mathbf{x}}, \\mathbf{u}) \\cap \\mathcal{C}\\left(\\overline{\\boldsymbol{\\theta}}, \\alpha_{1}\\right)\\right)=1 $. 
  
Let : 

$ \\overline{\\boldsymbol{\\theta}}_{\\mathrm{CIO}}(\\mathbf{u}) $ denote the optimal solution to the inner maximization problem in : 

$ \\operatorname{RFO}\\left(\\mathcal{C}\\left(\\overline{\\boldsymbol{\\theta}}, \\alpha_{1}\\right), \\mathbf{u}\\right) $ 

- when the outer decision variable is set to $ \\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u}) $. 

For any $ \\mathbf{u} \\in \\mathcal{U} $, let : 

$ \\mathbf{x}^{*}(\\mathbf{u}):=\\tilde{\\mathbf{x}}\\left(\\boldsymbol{\\theta}^{*}, \\mathbf{u}\\right) $ 

$ \\boldsymbol{\\theta}_{\\mathrm{CIO}}^{*}(\\mathbf{u}) $ denote the optimal solution to the inner maximization problem in : 

$ \\operatorname{RFO}\\left(\\mathcal{C}\\left(\\overline{\\boldsymbol{\\theta}}, \\alpha_{1}\\right), \\mathbf{u}\\right) $ 

- when the outer decision variable is set to $ \\mathbf{x}^{*}(\\mathbf{u}) $


Now, we have : 

$ \\begin{aligned} & f\\left(\\boldsymbol{\\theta}^{*}, \\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right)-f\\left(\\boldsymbol{\\theta}^{*}, \\mathbf{x}^{*}(\\mathbf{u})\\right) \\\\ \\leq & f\\left(\\mathbb{E}(\\hat{\\boldsymbol{\\theta}}), \\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right)-f\\left(\\mathbb{E}(\\hat{\\boldsymbol{\\theta}}), \\mathbf{x}^{*}(\\mathbf{u})\\right)+\\left(\\nu\\left[\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right]+\\nu\\left[\\mathbf{x}^{*}(\\mathbf{u})\\right]\\right)\\left\\|\\boldsymbol{\\theta}^{*}-\\mathbb{E}(\\hat{\\boldsymbol{\\theta}})\\right\\|_{2} \\\\ \\leq & f\\left(\\mathbb{E}(\\hat{\\boldsymbol{\\theta}}), \\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right)-f\\left(\\mathbb{E}(\\hat{\\boldsymbol{\\theta}}), \\mathbf{x}^{*}(\\mathbf{u})\\right)+\\sigma\\left(\\nu\\left[\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right]+\\nu\\left[\\mathbf{x}^{*}(\\mathbf{u})\\right]\\right) \\\\ = & \\mathbb{E}\\left[f\\left(\\hat{\\boldsymbol{\\theta}}, \\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right)-f\\left(\\hat{\\boldsymbol{\\theta}}, \\mathbf{x}^{*}(\\mathbf{u})\\right)\\right]+\\sigma\\left(\\nu\\left[\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right]+\\nu\\left(\\mathbf{x}^{*}(\\mathbf{u})\\right)\\right) \\\\ \\leq & \\mathbb{E}\\left[f\\left(\\tilde{\\boldsymbol{\\theta}}, \\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right)-f\\left(\\tilde{\\boldsymbol{\\theta}}, \\mathbf{x}^{*}(\\mathbf{u})\\right)+\\left(\\nu\\left[\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right]+\\nu[\\hat{\\mathbf{x}}]\\right)\\|\\hat{\\boldsymbol{\\theta}}-\\tilde{\\boldsymbol{\\theta}}\\|_{2}\\right] \\\\ & +\\sigma\\left(\\nu\\left[\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right]+\\nu\\left(\\mathbf{x}^{*}(\\mathbf{u})\\right)\\right) \\\\ \\leq & \\mathbb{E}\\left[f\\left(\\tilde{\\boldsymbol{\\theta}}, \\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right)-f\\left(\\tilde{\\boldsymbol{\\theta}}, \\mathbf{x}^{*}(\\mathbf{u})\\right)+\\left(\\nu\\left[\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right]+\\nu[\\hat{\\mathbf{x}}]\\right) \\eta\\right] \\\\ & +\\sigma\\left(\\nu\\left[\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right]+\\nu\\left(\\mathbf{x}^{*}(\\mathbf{u})\\right)\\right) \\\\ \\leq & \\mathbb{E}\\left[f\\left(\\overline{\\boldsymbol{\\theta}}_{\\mathrm{CIO}}(\\mathbf{u}), \\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right)-f\\left(\\tilde{\\boldsymbol{\\theta}}, \\mathbf{x}^{*}(\\mathbf{u})\\right)\\right]+(\\eta+\\sigma)\\left(\\nu\\left[\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right]+\\nu\\left(\\mathbf{x}^{*}(\\mathbf{u})\\right)\\right) \\\\ \\leq & \\mathbb{E}\\left[f\\left(\\boldsymbol{\\theta}_{\\mathrm{CIO}}^{*}(\\mathbf{u}), \\mathbf{x}^{*}(\\mathbf{u})\\right)-f\\left(\\tilde{\\boldsymbol{\\theta}}, \\mathbf{x}^{*}(\\mathbf{u})\\right)\\right]+(\\eta+\\sigma)\\left(\\nu\\left[\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right]+\\nu\\left(\\mathbf{x}^{*}(\\mathbf{u})\\right)\\right) \\\\ \\leq & \\mathbb{E}\\left[\\nu\\left(\\mathbf{x}^{*}(\\mathbf{u})\\right)\\left\\|\\boldsymbol{\\theta}_{\\mathrm{CIO}}^{*}(\\mathbf{u})-\\tilde{\\boldsymbol{\\theta}}\\right\\|_{2}\\right]+(\\eta+\\sigma)\\left(\\nu\\left[\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right]+\\nu\\left(\\mathbf{x}^{*}(\\mathbf{u})\\right)\\right) \\\\ \\leq & 2 \\nu\\left(\\mathbf{x}^{*}(\\mathbf{u})\\right)\\left(1-\\cos 2 \\alpha_{1}\\right)+(\\eta+\\sigma)\\left(\\nu\\left[\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right]+\\nu\\left(\\mathbf{x}^{*}(\\mathbf{u})\\right)\\right) \\\\ \\leq & \\left(2-2 \\cos 2 \\alpha_{1}+\\eta+\\sigma\\right) \\nu\\left(\\mathbf{x}^{*}(\\mathbf{u})\\right)+(\\eta+\\sigma) \\nu\\left[\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right]\\end{aligned} $

Line 1: [Lemma 3](#lemma-3)

Line 2: [Assumption 3](#assumption-3-bounded-divergence)

Line 3: $f $ is linear in $\\boldsymbol \\theta $

Line 4: [Lemma 3](#lemma-3)

Line 5: [Assumption 2](#assumption-2-bounded-inverse-feasible-set)

Line 6: the definition of $ \\overline{\\boldsymbol{\\theta}}_{\\mathrm{CIO}}(\\mathbf{u}) $

Line 7: $ \\left(\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u}), \\overline{\\boldsymbol{\\theta}}_{\\mathrm{CIO}}(\\mathbf{u})\\right) $ is an optimal solution to $ \\mathbf{R F O}\\left(\\mathcal{C}\\left(\\overline{\\boldsymbol{\\theta}}, \\alpha_{1}\\right), \\mathbf{u}\\right) $.

Line 8: [Lemma 3](#lemma-3)

Line 9: both $ \\boldsymbol{\\theta}_{\\mathrm{CIO}}^{*}(\\mathbf{u}) $ and $ \\tilde{\\boldsymbol{\\theta}} $ are on the unit sphere and the angle between them is no greater than $ 2 \\alpha_{1} $, then the $ L_{2} $ distance between them is upper bounded by $ 2\\left(1-\\cos 2 \\alpha_{1}\\right) $.

Then : 

$ \\begin{aligned} \\operatorname{AOG}\\left(\\overline{\\mathbf{x}}_{\\mathrm{CIO}}\\right) & =\\mathbb{E}\\left[f\\left(\\boldsymbol{\\theta}^{*}, \\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right)-f\\left(\\boldsymbol{\\theta}^{*}, \\mathbf{x}^{*}(\\mathbf{u})\\right)\\right] \\\\ & \\leq \\mathbb{E}\\left[\\left(2-2 \\cos 2 \\alpha_{1}+\\eta+\\sigma\\right) \\nu\\left(\\mathbf{x}^{*}(\\mathbf{u})\\right)+(\\eta+\\sigma) \\nu\\left[\\overline{\\mathbf{x}}_{\\mathrm{CIO}}(\\mathbf{u})\\right]\\right] \\\\ & =\\left(2-2 \\cos 2 \\alpha_{1}+\\eta+\\sigma\\right) \\mu^{*}+(\\eta+\\sigma) \\mu_{\\mathrm{CIO}}\\end{aligned} $

- $ \\mu^{*}:=\\mathbb{E}\\left(\\nu\\left[\\mathbf{x}^{*}(\\mathbf{u})\\right]\\right) $.

##### End Proof of Proposition 3

#### End Proof of Theorem 3

`,__vite_glob_0_13=`---
title: Business Paper - Week 5
---

# 1. Examples & Glossary

$$
\\begin{array}{|c|c|l|}
\\hline
\\text{Domain} & \\text{Description} \\\\
\\hline
\\mathbb{P} & \\mathcal{M}(\\mathcal{X} \\times \\mathcal{Y}) & \\text{True (unknown) joint distribution of } (\\boldsymbol{x}, \\boldsymbol{y}) \\\\
\\hat{\\mathbb{P}}_{N} & \\mathcal{M}(\\mathcal{X} \\times \\mathcal{Y}) & \\text{Joint empirical distribution of } (\\boldsymbol{x}, \\boldsymbol{y}) \\\\
\\delta_{y} & \\mathcal{M}(\\mathcal{Y}) & \\text{Dirac distribution that puts all of its weight on } \\boldsymbol{y} \\\\
\\boldsymbol{x} & \\mathcal{X} \\subseteq \\mathbb{R}^{d_{\\boldsymbol{x}}} & \\text{Contextual information} \\\\
\\boldsymbol{y} & Y \\subseteq \\mathbb{R}^{d_{\\boldsymbol{y}}} & \\text{Uncertain parameters} \\\\
\\boldsymbol{z} & \\mathcal{Z} \\subseteq \\mathbb{R}^{d_{\\boldsymbol{z}}} & \\text{A feasible action} \\\\
\\boldsymbol{\\theta} & \\Theta & \\text{Parameters of a prediction model} \\\\
\\hat{\\boldsymbol{\\theta}} & \\Theta & \\text{Optimal parameter value that minimizes the estimation error} \\\\
c(\\boldsymbol{z}, \\boldsymbol{y}) & \\mathbb{R} & \\text{Cost of an action } \\boldsymbol{z} \\text{ under } \\boldsymbol{y} \\\\
h\\left(\\boldsymbol{z}, \\mathbb{Q}_{\\xi}\\right) & \\mathbb{R} & \\text{Expected cost of an action } \\boldsymbol{z} \\text{ under } \\mathbb{Q}_{\\xi} \\text{ (a distribution over } \\boldsymbol{y}) \\\\
H(\\pi, \\mathbb{Q}) & \\mathbb{R} & \\text{Expected cost of a policy } \\pi \\text{ under } \\mathbb{Q} \\text{ (a distribution over } (\\boldsymbol{x}, \\boldsymbol{y})) \\\\
f_{\\boldsymbol{\\theta}}(\\boldsymbol{x}) & \\mathcal{M}(\\mathcal{Y}) & \\text{Estimate of the conditional distribution of } \\boldsymbol{y} \\text{ given } \\boldsymbol{x} \\\\
g_{\\boldsymbol{\\theta}}(\\boldsymbol{x}) & \\mathbb{R} \\boldsymbol{R}_{\\boldsymbol{y}} & \\text{Estimate of the conditional expectation of } \\boldsymbol{y} \\text{ given } \\boldsymbol{x} \\\\
\\pi^{*}(\\boldsymbol{x}) & \\mathcal{Z} & \\text{Optimal solution of CSO under true conditional distribution } \\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x}) \\\\
\\pi_{\\boldsymbol{\\theta}}(\\boldsymbol{x}) & \\mathcal{Z} & \\text{Action prescribed by a policy parameterized by } \\boldsymbol{\\theta} \\text{ for context } \\boldsymbol{x} \\\\
z^{*}(\\boldsymbol{x}) & \\mathcal{Z} & \\text{Optimal solution to the CSO problem under the true conditional distribution } \\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x}) \\\\
z^{*}\\left(\\boldsymbol{x}, f_{\\boldsymbol{\\theta}}\\right) & \\mathcal{Z} & \\text{Optimal solution to the CSO problem under the conditional distribution } f_{\\boldsymbol{\\theta}}(\\boldsymbol{x}) \\\\
z^{*}\\left(\\boldsymbol{x}, g_{\\boldsymbol{\\theta}}\\right) & \\mathcal{Z} & \\text{Optimal solution to the CSO problem under the Dirac distribution } \\delta_{g \\boldsymbol{\\theta}}(\\boldsymbol{x}) \\\\
\\rho\\left(\\boldsymbol{f}_{\\boldsymbol{\\theta}}, \\hat{\\mathbb{P}}_{N}\\right) & \\mathbb{R} & \\text{Expected prediction error for distribution model } f_{\\boldsymbol{\\theta}} \\text{ based on empirical distribution } \\hat{\\mathbb{P}}_{N} \\\\
\\rho\\left(g_{\\boldsymbol{\\theta}}, \\hat{\\mathbb{P}}_{N}\\right) & \\mathbb{R} & \\text{Expected prediction error for point prediction model } g_{\\boldsymbol{\\theta}} \\text{ based on empirical distribution } \\hat{\\mathbb{P}}_{N} \\\\
\\hline
\\end{array}
$$

$$
\\begin{array}{|c|c|c|c|c|c|c|c|c|c|c|c|}
\\hline
\\text{Reference} & \\text{rcso} & \\text{wSAA} & \\text{EVB} & \\text{Reg. CSO} & \\text{DRO} & \\text{General} & \\text{Linear} & \\text{Kernel} & \\text{kNN} & \\text{DT} & \\text{RF} \\\\
\\hline
\\text{Hannah et al. (2010)} & \\times & \\checkmark & \\times & \\times & \\times & \\times & \\times & \\checkmark & \\times & \\times & \\times \\\\
\\hline
\\text{Ferreira et al. (2016)} & \\times & \\times & \\checkmark & \\times & \\times & \\times & \\times & \\times & \\times & \\checkmark & \\times \\\\
\\hline
\\text{Ban et al. (2019)} & \\checkmark & \\times & \\times & \\times & \\times & \\times & \\checkmark & \\times & \\times & \\times & \\times \\\\
\\hline
\\text{Chen and Paschalidis (2019)} & \\times & \\checkmark & \\times & \\times & \\checkmark & \\times & \\times & \\times & \\checkmark & \\times & \\times \\\\
\\hline
\\text{Bertsimas and Kallus (2020)} & \\times & \\checkmark & \\times & \\times & \\times & \\times & \\checkmark & \\times & \\checkmark & \\checkmark & \\checkmark \\\\
\\hline
\\text{Kannan et al. (2020)} & \\checkmark & \\times & \\times & \\times & \\times & \\checkmark & \\checkmark & \\checkmark & \\checkmark & \\checkmark & \\checkmark \\\\
\\hline
\\text{Kannan et al. (2021)} & \\checkmark & \\times & \\times & \\times & \\checkmark & \\checkmark & \\checkmark & \\checkmark & \\checkmark & \\checkmark & \\checkmark \\\\
\\hline
\\text{Liu et al. (2021)} & \\times & \\times & \\checkmark & \\times & \\times & \\times & \\checkmark & \\times & \\times & \\checkmark & \\times \\\\
\\hline
\\text{Srivastava et al. (2021)} & \\times & \\checkmark & \\times & \\checkmark & \\times & \\times & \\times & \\checkmark & \\times & \\times & \\times \\\\
\\hline
\\text{Wang et al. (2021)} & \\times & \\checkmark & \\times & \\times & \\checkmark & \\times & \\times & \\checkmark & \\times & \\times & \\times \\\\
\\hline
\\text{Bertsimas and Van Parys (2022)} & \\times & \\checkmark & \\times & \\times & \\checkmark & \\times & \\times & \\checkmark & \\checkmark & \\times & \\times \\\\
\\hline
\\text{Deng and Sen (2022)} & \\checkmark & \\times & \\times & \\times & \\times & \\checkmark & \\checkmark & \\checkmark & \\checkmark & \\checkmark & \\checkmark \\\\
\\hline
\\text{Esteban-Pérez and Morales (2022)} & \\times & \\checkmark & \\times & \\times & \\checkmark & \\times & \\times & \\checkmark & \\checkmark & \\times & \\times \\\\
\\hline
\\text{Kannan et al. (2022)} & \\checkmark & \\times & \\times & \\times & \\checkmark & \\checkmark & \\checkmark & \\checkmark & \\checkmark & \\checkmark & \\checkmark \\\\
\\hline
\\text{Lin et al. (2022)} & \\times & \\checkmark & \\times & \\checkmark & \\times & \\times & \\times & \\times & \\checkmark & \\checkmark & \\checkmark \\\\
\\hline
\\text{Nguyen et al. (2021)} & \\times & \\checkmark & \\times & \\times & \\checkmark & \\times & \\times & \\times & \\checkmark & \\times & \\times \\\\
\\hline
\\text{Notz and Pibernik (2022)} & \\times & \\checkmark & \\times & \\times & \\times & \\times & \\times & \\checkmark & \\times & \\checkmark & \\times \\\\
\\hline
\\text{Zhu et al. (2022)} & \\times & \\times & \\checkmark & \\times & \\checkmark & \\checkmark & \\checkmark & \\checkmark & \\checkmark & \\checkmark & \\checkmark \\\\
\\hline
\\text{Perakis et al. (2023)} & \\checkmark & \\times & \\times & \\times & \\checkmark & \\times & \\checkmark & \\times & \\times & \\times & \\times \\\\
\\hline
\\end{array}
$$


$$
\\begin{array}{|c|c|c|c|c|c|c|c|c|c|}
\\hline 
& \\text{LP} & \\text{QP} & \\text{Convex} & \\text{Non convex} & \\text{Integer} & \\text{Uncertain} & \\text{Implicit diff.} & \\substack{\\text{Surr.} \\\\ \\text{loss}} & \\text{Surr. optim.} \\\\
\\hline
\\text{Amos and Kolter (2017)} & \\times & \\checkmark & \\times & \\times & \\times & \\checkmark & \\checkmark & \\times & \\checkmark \\\\
\\hline
\\text{Donti et al. (2017)} & \\times & \\checkmark & \\checkmark & \\times & \\times & \\checkmark & \\checkmark & \\times & \\times \\\\
\\hline
\\text{Agrawal et al. (2019)} & \\times & \\checkmark & \\checkmark & \\times & \\times & \\checkmark & \\checkmark & \\times & \\checkmark \\\\
\\hline
\\text{Vlastelica et al. (2019)} & \\checkmark & \\times & \\times & \\times & \\checkmark & \\times & \\times & \\checkmark & \\times \\\\
\\hline
\\text{Wilder et al. (2019a)} & \\checkmark & \\times & \\times & \\times & \\checkmark & \\times & \\checkmark & \\times & \\times \\\\
\\hline
\\text{Wilder et al. (2019b)} & \\times & \\checkmark & \\times & \\times & \\checkmark & \\times & \\times & \\checkmark & \\times \\\\
\\hline
\\text{Berthet et al. (2020)} & \\checkmark & \\times & \\times & \\times & \\checkmark & \\times & \\times & \\times & \\checkmark \\\\
\\hline
\\text{Elmachtoub et al. (2020)} & \\checkmark & \\times & \\times & \\times & \\times & \\times & \\times & \\checkmark & \\times \\\\
\\hline
\\text{Ferber et al. (2020)} & \\checkmark & \\times & \\times & \\times & \\checkmark & \\times & \\checkmark & \\times & \\times \\\\
\\hline
\\text{Mandi and Guns (2020)} & \\checkmark & \\times & \\times & \\times & \\checkmark & \\times & \\checkmark & \\times & \\times \\\\
\\hline
\\text{Mandi et al. (2020)} & \\checkmark & \\times & \\times & \\times & \\checkmark & \\times & \\times & \\checkmark & \\times \\\\
\\hline
\\text{Grigas et al. (2021)} & \\times & \\times & \\checkmark & \\times & \\times & \\times & \\times & \\times & \\checkmark \\\\
\\hline
\\text{Mulamba et al. (2021)} & \\checkmark & \\times & \\times & \\times & \\checkmark & \\times & \\times & \\times & \\checkmark \\\\
\\hline
\\text{Chung et al. (2022)} & \\times & \\times & \\checkmark & \\times & \\checkmark & \\times & \\times & \\checkmark & \\times \\\\
\\hline
\\text{Cristian et al. (2022)} & \\times & \\times & \\checkmark & \\times & \\times & \\times & \\times & \\times & \\checkmark \\\\
\\hline
\\text{Dalle et al. (2022)} & \\checkmark & \\times & \\times & \\times & \\checkmark & \\times & \\times & \\times & \\checkmark \\\\
\\hline
\\text{Elmachtoub and Grigas (2022)} & \\checkmark & \\times & \\times & \\times & \\checkmark & \\times & \\times & \\checkmark & \\times \\\\
\\hline
\\text{Jeong et al. (2022)} & \\checkmark & \\times & \\times & \\times & \\checkmark & \\times & \\times & \\checkmark & \\times \\\\
\\hline
\\text{Kallus and Mao (2022)} & \\times & \\times & \\checkmark & \\times & \\times & \\times & \\times & \\checkmark & \\times \\\\
\\hline
\\text{Kong et al. (2022)} & \\times & \\checkmark & \\checkmark & \\checkmark & \\checkmark & \\times & \\times & \\times & \\checkmark \\\\
\\hline
\\text{Lawless and Zhou (2022)} & \\checkmark & \\times & \\times & \\times & \\checkmark & \\times & \\times & \\checkmark & \\times \\\\
\\hline
\\text{Loke et al. (2022)} & \\checkmark & \\times & \\times & \\times & \\times & \\times & \\times & \\checkmark & \\times \\\\
\\hline
\\text{Mandi et al. (2022)} & \\checkmark & \\times & \\times & \\times & \\checkmark & \\times & \\times & \\times & \\checkmark \\\\
\\hline
\\text{Muñoz et al. (2022)} & \\checkmark & \\times & \\times & \\times & \\times & \\times & \\times & \\checkmark & \\times \\\\
\\hline
\\text{Shah et al. (2022)} & \\checkmark & \\checkmark & \\checkmark & \\checkmark & \\checkmark & \\times & \\times & \\times & \\checkmark \\\\
\\hline
\\text{Butler and Kwon (2023a)} & \\times & \\checkmark & \\times & \\times & \\times & \\times & \\checkmark & \\times & \\times \\\\
\\hline
\\text{Costa and Iyengar (2023)} & \\times & \\checkmark & \\checkmark & \\times & \\times & \\checkmark & \\checkmark & \\checkmark & \\times \\\\
\\hline
\\text{Estes and Richard (2023)} & \\checkmark & \\times & \\checkmark & \\times & \\times & \\times & \\times & \\checkmark & \\times \\\\
\\hline
\\text{Kotary et al. (2023)} & \\checkmark & \\checkmark & \\checkmark & \\checkmark & \\times & \\times & \\checkmark & \\times & \\times \\\\
\\hline
\\text{McKenzie et al. (2023)} & \\checkmark & \\times & \\times & \\times & \\times & \\times & \\checkmark & \\times & \\times \\\\
\\hline
\\text{Sun et al. (2023a)} & \\checkmark & \\times & \\times & \\times & \\times & \\times & \\times & \\checkmark & \\times \\\\
\\hline
\\text{Sun et al. (2023b)} & \\times & \\checkmark & \\times & \\checkmark & \\times & \\times & \\checkmark & \\times & \\times \\\\
\\hline
\\end{array}
$$

$$
\\begin{array}{|l|l|}
\\hline
\\text{Abbreviation} & \\text{Description} \\\\
\\hline
\\text{ADMM} & \\text{alternating direction method of multipliers} \\\\
\\text{CSO} & \\text{contextual stochastic optimization} \\\\
\\text{CVaR} & \\text{conditional value at risk} \\\\
\\text{DRO} & \\text{distributionally robust optimization} \\\\
\\text{DNN} & \\text{deep neural network} \\\\
\\text{ERM} & \\text{empirical risk minimization} \\\\
\\text{FP} & \\text{fixed point} \\\\
\\text{ILO} & \\text{integrated learning and optimization} \\\\
\\text{IFT} & \\text{implicit function theorem} \\\\
\\text{kNN} & k\\text{-nearest neighbor} \\\\
\\text{KKT} & \\text{Karush-Kuhn-Tucker} \\\\
\\text{KL} & \\text{Kullback-Leibler} \\\\
\\text{LDR} & \\text{linear decision rule} \\\\
\\text{LP} & \\text{linear program} \\\\
\\text{MDP} & \\text{Markov decision process} \\\\
\\text{ML} & \\text{machine learning} \\\\
\\text{MLE} & \\text{maximum likelihood estimation} \\\\
\\text{MILP} & \\text{mixed-integer linear program} \\\\
\\text{NW} & \\text{Nadaraya-Watson} \\\\
\\text{RKHS} & \\text{reproducing kernel Hilbert space} \\\\
\\text{SAA} & \\text{sample average approximation} \\\\
\\text{SLO} & \\text{sequential learning and optimization} \\\\
\\text{QP} & \\text{quadratic program} \\\\
\\hline
\\end{array}
$$


2. Contextual Optimization

$\\boldsymbol  z$ : decision: The order for today inventory

$\\mathcal Z\\subseteq \\mathbb R^{d_{\\boldsymbol  z}}$ : feasible set for orders

- e.g. $ \\mathcal{Z}=\\{z \\in \\mathbb{R} \\mid z \\geq 0\\} $

$ c(\\boldsymbol{z}, \\boldsymbol{y}) $ : cost function

- e.g. $ c(z, y)=h(z-y)^{+}+b(y-z)^{+} $ (h for over inventory, b for not enough inventory)

$ \\boldsymbol{y} \\in \\mathcal{Y} \\subseteq \\mathbb{R}^{d_{y}} $ : uncertain parameters : the everyday real need 

$ \\boldsymbol{x} \\in \\mathcal{X} \\subseteq \\mathbb{R}^{d_{x}} $ : a vector of relevant covariates : the history data 



$\\mathbb  P $: the joint distribution of :
- the covariates in $\\mathcal  X$
- the uncertain parameters in $\\mathcal  Y $
- e.g.: the distribution of data and real need 






# 2. Contextual Optimization : An overview

$\\boldsymbol  z$ : decision

$\\mathcal Z\\subseteq \\mathbb R^{d_{\\boldsymbol  z}}$ : feasible set 

$ c(\\boldsymbol{z}, \\boldsymbol{y}) $ : cost function

$ \\boldsymbol{y} \\in \\mathcal{Y} \\subseteq \\mathbb{R}^{d_{y}} $ : uncertain parameters

The uncertain parameters are unknown when making the decision.

$ \\boldsymbol{x} \\in \\mathcal{X} \\subseteq \\mathbb{R}^{d_{x}} $ : a vector of relevant covariates :
- correlated with the uncertain parameters $\\mathbb  y $
- we know it before choosing $\\mathbb  z $

$\\mathbb  P $: the joint distribution of :
- the covariates in $\\mathcal  X$
- the uncertain parameters in $\\mathcal  Y $

## 2.1 Contexual problem and policy

### CSO problem

Given:

- $\\boldsymbol  x$ : a vector of covariates
- $\\mathbb  P $ : joint distribution

Target:

- Find $z^*(\\boldsymbol  x)\\in\\mathcal Z $ : an optimal action
- minimize the expected costs on the covariate $\\boldsymbol x $

Formally:

#### (1)

$ z^{*}(\\boldsymbol{x}) \\in \\underset{\\boldsymbol{z} \\in \\mathcal{Z}}{\\operatorname{argmin}} \\mathbb{E}_{\\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x})}[c(\\boldsymbol{z}, \\boldsymbol{y})] $
- $ \\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x}) $ : the conditional distribution of $\\boldsymbol  y $ given the covariate $\\boldsymbol  x $
- A minimizer exists
  - e.g.: $\\mathcal Z $ is compact, $ \\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x}) $ has bounded support, $ c(\\boldsymbol{z}, \\boldsymbol{y}) $ is continuous in $ \\boldsymbol{z} $ almost surely.

[(1)](#1) can be written using the expected cost operator $h(\\cdot,\\cdot)$ : 
- first argument: an action
- second argument: distribution

#### (2)

$ z^{*}(\\boldsymbol{x}) \\in \\underset{\\boldsymbol{z} \\in \\mathcal{Z}}{\\operatorname{argmin}} h(\\boldsymbol{z}, \\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x})):=\\mathbb{E}_{\\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x})}[c(\\boldsymbol{z}, \\boldsymbol{y})] $

### Optimal policy

Target: find the policy, provides the lowest long-term expected cost 

$ z^{*}(\\boldsymbol{x}) \\in \\underset{\\boldsymbol{z} \\in \\mathcal{Z}}{\\operatorname{argmin}} h(\\boldsymbol{z}, \\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x})):=\\mathbb{E}_{\\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x})}[c(\\boldsymbol{z}, \\boldsymbol{y})] $

- $ \\Pi:=\\{\\pi: \\mathcal{X} \\rightarrow \\mathcal{Z}\\} $

Solving [(1)](#1) naturally gives an optimal policy:

$ \\bar{\\pi}(\\boldsymbol{x}) \\in \\underset{\\boldsymbol{z} \\in \\mathcal{Z}}{\\operatorname{argmin}} h(\\boldsymbol{z}, \\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x})) $ a.s. $ \\Leftrightarrow \\mathbb{E}_{\\mathbb{P}}[h(\\bar{\\pi}(\\boldsymbol{x}), \\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x}))]=\\min _{\\pi \\in \\Pi} \\mathbb{E}_{\\mathbb{P}}[h(\\pi(\\boldsymbol{x}), \\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x}))] $

- If a minimizer of $ h(\\boldsymbol{z}, \\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x})) $ exists almost surely

We can see $\\pi^*, z^*(\\cdot)$ coincide

## 2.2 Mapping covariate to actions in a data-driven environment

Challenge: the joint distribution $\\mathbb P $ is generally unknown

Reality: we have historical data:

$ \\mathcal{D}_{N}=\\left\\{\\left(\\boldsymbol{x}_{i}, \\boldsymbol{y}_{i}\\right)\\right\\}_{i=1}^{N} $

assumed to be made of independent and identically distributed realizations of $ (\\boldsymbol{x}, \\boldsymbol{y}) \\in \\mathcal{X} \\times \\mathcal{Y} $

Aim: find a policy
that approximates well the optimal policy given by [(3)](#3)

Three main frameworks:

- decision rule optimization
- sequential learning and optimization
- integrated learning and optimization

### 2.2.1 Decision rule optimization 

There's a hypothesis class:

$ \\Pi^{\\theta}:=\\left\\{\\pi_{\\boldsymbol{\\theta}}\\right\\}_{\\boldsymbol{\\theta} \\in \\Theta} \\subseteq \\Pi $

- $ \\Pi^{\\theta}:=\\left\\{\\pi_{\\boldsymbol{\\theta}}\\right\\}_{\\boldsymbol{\\theta} \\in \\Theta} \\subseteq \\Pi $

$ \\hat{\\mathbb{P}}_{N} $ : the empirical distribution of $ (\\boldsymbol{x}, \\boldsymbol{y}) $ given historical data $ \\mathcal{D}_{N} $

Get the "best" parameter in $ \\Pi^{\\theta} $ by solving ERM (empirical risk minimization) :

#### (4)

$ \\quad \\boldsymbol{\\theta}^{*} \\in \\underset{\\boldsymbol{\\theta}}{\\operatorname{argmin}} H\\left(\\pi_{\\boldsymbol{\\theta}}, \\hat{\\mathbb{P}}_{N}\\right):=\\mathbb{E}_{\\hat{\\mathbb{P}}_{N}}\\left[c\\left(\\pi_{\\boldsymbol{\\theta}}(\\boldsymbol{x}), \\boldsymbol{y}\\right)\\right] $

Then:

Find the policy $  \\pi_{\\theta^{*}} \\in \\Pi^{\\theta} $ that minimizes the expected costs over the training data.

Approximations:

- The hypothesis class $\\Pi^{\\theta} $ may not contain the true optimal policy 
- The long-term expected costs are calculated over the $ \\hat{\\mathbb{P}}_{N} $ (empirical distribution) instead of the $\\mathbb P$, the true distribution

Disadvantage:

- Focus overall performance (the expectation), not robust
  - e.g. perform better on some sample, worse on some other sample

### 2.2.2 Learning and optimization 

**Predictive & Optimization**

**Predictive:**

$f_{\\boldsymbol \\theta }$ : general model 
- parameterized by $\\boldsymbol \\theta $
- provide the input of the optimization component 

$ f_{\\boldsymbol{\\theta}}(\\boldsymbol{x}) $ : predicted distribution 
- for any covariate $\\boldsymbol{x} $ 
- a predicted distribution
  - approximate the true conditional distribution $ \\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x}) $ 
- learned from historical data

Decision:

Solve the CSO problem under $ f_{\\boldsymbol{\\theta}}(\\boldsymbol{x}) $ :

#### (5)

$ z^{*}\\left(\\boldsymbol{x}, f_{\\boldsymbol{\\theta}}\\right) \\in \\underset{\\boldsymbol{z} \\in \\mathcal{Z}}{\\operatorname{argmin}} h\\left(\\boldsymbol{z}, f_{\\boldsymbol{\\theta}}(\\boldsymbol{x})\\right) $

The only approximation:

- $ f_{\\boldsymbol{\\theta}} $ is an approximation of $ \\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x}) $

**SLO(Sequential learning and optimization) :**

$\\rho$ : estimation error
- minimize it to obtain the contextual predictor
- between conditional distribution given by $ f_{\\boldsymbol{\\theta}}(\\boldsymbol{x}) $ and the true conditional distribution of $ \\boldsymbol{y} $ given $ \\boldsymbol{x} $ 

Solve:

#### (6)

$ \\min _{\\boldsymbol{\\theta}} \\rho\\left(f_{\\boldsymbol{\\theta}}, \\hat{\\mathbb{P}}_{N}\\right)+\\Omega(\\boldsymbol{\\theta}) $ 

- $ \\rho\\left(f_{\\boldsymbol{\\theta}}, \\hat{\\mathbb{P}}_{N}\\right):=\\mathbb{E}_{\\hat{\\mathbb{P}}_{N}}\\left[\\mathfrak{D}\\left(f_{\\boldsymbol{\\theta}}(\\boldsymbol{x}), \\boldsymbol{y}\\right)\\right] $

- $ \\mathfrak{D} $ is a divergence function
  - negative log-likelihood & regularization term $ \\Omega(\\boldsymbol{\\theta}) $ controls the complexity of $ f_{\\theta} $

#### Definition 1 (Expected value-based model)

cost function $ c(\\boldsymbol{x}, \\boldsymbol{y}) $ of the decision model is linear in $ \\boldsymbol{y} $ 

Now: 

estimating a conditional distribution $\\to$ find the expected value of the uncertain parameter given the covariates

- Because : $ h(\\boldsymbol{z}, \\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x}))= $ $ \\mathbb{E}_{\\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x})}[c(\\boldsymbol{z}, \\boldsymbol{y})]=c\\left(\\boldsymbol{z}, \\mathbb{E}_{\\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x})}[\\boldsymbol{y}]\\right) $ 

training the contextual predictor $\\to $ mean regression problem over a parameterized function $ g_{\\boldsymbol{\\theta}}(\\boldsymbol{x}) $

$ \\min _{\\boldsymbol{\\theta}} \\rho\\left(g_{\\boldsymbol{\\theta}}, \\hat{\\mathbb{P}}_{N}\\right)+\\Omega(\\boldsymbol{\\theta}) $ 

- $ \\rho\\left(g_{\\boldsymbol{\\theta}}, \\hat{\\mathbb{P}}_{N}\\right):=\\mathbb{E}_{\\hat{\\mathbb{P}}_{N}}\\left[d\\left(g_{\\boldsymbol{\\theta}}(\\boldsymbol{x}), \\boldsymbol{y}\\right)\\right] $

- for some distance metric $ d $, usually the mean squared errors

MSE (mean squared error):

$ g_{\\hat{\\boldsymbol{\\theta}}}(\\boldsymbol{x})=\\mathbb{E}_{\\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x})}[\\boldsymbol{y}] $ 

 - as $ N \\rightarrow \\infty $



Obtain an action: 

$ z^{*}\\left(\\boldsymbol{x}, g_{\\boldsymbol{\\theta}}\\right) \\in \\underset{\\boldsymbol{z} \\in \\mathcal{Z}}{\\operatorname{argmin}} h\\left(\\boldsymbol{z}, \\delta_{g_{\\boldsymbol{\\theta}(\\boldsymbol{x})}}\\right)=\\underset{\\boldsymbol{z} \\in \\mathcal{Z}}{\\operatorname{argmin}} c\\left(\\boldsymbol{z}, g_{\\boldsymbol{\\theta}}(\\boldsymbol{x})\\right) $,

- For any new covariate $\\boldsymbol x$
- $z^*$ : an estimator of the mean of the conditional distribution
- $ \\delta_{y} $ : Dirac distribution (all mass at $\\boldsymbol y$)

These models: expected value-based models 

More general: conditional distribution-based models

Disadvantage:

-  ignore the mismatch between the
prediction divergence $ \\mathfrak{D} $ and the cost function $ c(\\boldsymbol{x}, \\boldsymbol{y}) $

- a small prediction error about $ \\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x}) $ may have a large impact on the prescription

**Integrated learning and optimization**

Goal:

maximize the prescriptive performance of the induced policy
- train the predictive component to minimize the task loss (as in [(3)](#3))
- higher MSE but nearly-optimal 

We have:

#### (9)

$ \\min _{\\boldsymbol{\\theta}} H\\left(z^{*}\\left(\\cdot, f_{\\boldsymbol{\\theta}}\\right), \\hat{\\mathbb{P}}_{N}\\right)=\\min _{\\boldsymbol{\\theta}} \\mathbb{E}_{\\hat{\\mathbb{P}}_{N}}\\left[c\\left(z^{*}\\left(\\boldsymbol{x}, f_{\\boldsymbol{\\theta}}\\right), \\boldsymbol{y}\\right)\\right] $
- Finding the best parameterization of a contextual predictor
  - minimizes the downstream
expected costs of the CSO solution


- minimizes the expected cost of the policy over the empirical distribution

## Summary

Design choices:

- type of loss function during training
  - e.g. decision rule/sequential/integrated paradigm
- class of predictive model
  - e.g. linear/neural network/random forest

# 3 Dicision rule optimization 

Decision rules:
- obtained by solving ERM in Problem [(4)](#4)
- minimize the cost of a policy on the task
  - that is, downstream optimization problem 

Advantage:
- once trained, no optimization problem needs

Define decision rule approach as:

employing a parameterized mapping $ \\pi_{\\boldsymbol{\\theta}}(\\boldsymbol{x}) $

- e.g.: linear/neural network


## 3.1 Linear decision rules

1: SAA(sample-average approximation)

for a newsvendor problem:

Use LDRs(linear decision rules)

Two variants with and without regularization:

$ \\min _{\\pi: \\exists \\boldsymbol{\\theta} \\in \\mathbb{R}^{d} \\boldsymbol{x}, \\pi(\\boldsymbol{x})=\\boldsymbol{\\theta}^{\\top} \\boldsymbol{x}, \\forall \\boldsymbol{x}} H\\left(\\pi, \\hat{\\mathbb{P}}_{N}\\right)+\\Omega(\\pi)=\\min _{\\boldsymbol{\\theta}} \\frac{1}{N} \\sum_{i=1}^{N} u\\left(y_{i}-\\boldsymbol{\\theta}^{\\top} \\boldsymbol{x}_{i}\\right)^{+}+o\\left(\\boldsymbol{\\theta}^{\\top} \\boldsymbol{x}_{i}-y_{i}\\right)^{+}+\\lambda\\|\\boldsymbol{\\theta}\\|_{k}^{2} $

- $u$: per unit backordering (underage) cost 
- $o$: per unit holding (overage) cost 

2: For linear demand model:

Generalization error for ERM model scales as :

- $ \\mathrm{O}\\left(d_{x} / \\sqrt{N}\\right) $ , when there is no regularization
- $ \\mathrm{O}\\left(d_{\\boldsymbol{x}} /(\\sqrt{N} \\lambda)\\right) $, with regularization

Need balance (to get optimal performance):

- generalization error
- regularization bias

Consider unconstrained problems because:
- difficult to ensure the feasibility of policies 
- maintain computational tractability

3. General theory for generalization

- Based on Rademacher complexity
- beyond LDR

LDRs may not be asymptotically optimal in general 

To generalize LDRs:

- decision rules that linear in transformations of the covariate vector 
- lift covariate vector to RKHS(reproducing kernel Hilbert space)

## 3.2 RKHS-based decision rules

To:

Obtain decision rules: more flexible than linear ones with respect to $\\boldsymbol x$:

lift the covariate vector to RKHS

- LDRs might achieve better performance 

Let:

$ K: \\mathcal{X} \\times \\mathcal{X} \\rightarrow \\mathbb{R} $: symmetric positive definite kernel 
- associated with the chosen RKHS 
  - e.g.: $ K\\left(\\boldsymbol{x}_{1}, \\boldsymbol{x}_{2}\\right):=\\exp \\left(-\\left\\|\\boldsymbol{x}_{1}-\\boldsymbol{x}_{2}\\right\\|^{2} /\\left(2 \\sigma^{2}\\right)\\right) $

$ \\left\\{\\varphi: \\mathcal{X} \\rightarrow \\mathbb{R} \\mid \\exists L \\in \\mathbb{N}, \\boldsymbol{v}_{1}, \\boldsymbol{v}_{2}, \\cdots, \\boldsymbol{v}_{L} \\in \\mathcal{X}, \\varphi(\\boldsymbol{x})=\\sum_{l=1}^{L} a_{l} K\\left(\\boldsymbol{v}_{l}, \\boldsymbol{x}\\right), \\forall \\boldsymbol{x} \\in \\mathcal{X}\\right\\} $

- the RKHS $\\mathcal H_K$
- Given $K$
- the closure of a set functions
- $ \\varphi_{1}(\\boldsymbol{x})=\\sum_{i=1}^{L_{1}} a_{1}^{i} K\\left(\\boldsymbol{v}_{1}^{i}, \\boldsymbol{x}\\right) $
- $ \\varphi_{2}(\\boldsymbol{x})=\\sum_{j=1}^{L_{2}} a_{2}^{j} K\\left(\\boldsymbol{v}_{2}^{j}, \\boldsymbol{x}\\right) $
- $ \\left\\langle\\varphi_{1}, \\varphi_{2}\\right\\rangle=\\sum_{i=1}^{L_{1}} \\sum_{j=1}^{L_{2}} a_{1}^{i} a_{2}^{j} K\\left(\\boldsymbol{v}_{1}^{i}, \\boldsymbol{v}_{2}^{j}\\right) $: inner product

1: approximate the optimal policy:
- with a linear policy in the RKHS
  - $ \\pi_{\\varphi}(\\boldsymbol{x}):=\\langle\\varphi, K(\\boldsymbol{x}, \\cdot)\\rangle $ when $ d_{\\boldsymbol{z}}=1 $

using the representer theorem, the solution of :

$ \\min _{\\varphi \\in \\mathcal{H}_{K}} H\\left(\\pi_{\\varphi}, \\hat{\\mathbb{P}}_{N}\\right)+\\lambda\\|\\varphi\\|_{2}^{2} $

- regularized problem 

takes the form $ \\pi^{*}(\\boldsymbol{x})=\\sum_{i=1}^{N} K\\left(\\boldsymbol{x}_{i}, \\boldsymbol{x}\\right) a_{i}^{*} $

reduce the decision rule problem to:

$ \\min _{\\boldsymbol{a} \\in \\mathbb{R}^{N}} H\\left(\\sum_{i=1}^{N} K\\left(\\boldsymbol{x}_{i}, \\cdot\\right) a_{i}, \\hat{\\mathbb{P}}_{N}\\right)+\\lambda \\sum_{i=1}^{N} \\sum_{j=1}^{N} K\\left(\\boldsymbol{x}_{i}, \\boldsymbol{x}_{j}\\right) a_{i} a_{j} $

can be extended to $ d_{z}>1 $ by employing one RKHS for each $ z_{i} $

Some applications:

- Data-driven single item newsvendor
- single risky asset portfolio problems 
  - establish bounds on the out-of-sample performance 
- asymptotic optimality of RKHS-based policies 
- two-stage capacity planning problem 
  - multivariate demand 
  - vector-valued capacity decisions 
    - the underlying demand distribution is difficult to estimate in practice
- optimize over policies that are linear in the RKHS 
  - associatied with Gaussain kernerl
  - identify generalization error bounds 
  - for large dimension problems:
    - slow convergence rate 
    - propose instead using a data-dependent random forest kerenl

## 3.3 Non-linear decision rules

1: value of training a DNN

- learn the ordering policy of a newsvendor problem 

**neural networks**

- universal approximation property
  - approximate any continuous function arbitrarily well 
- For constrained problem:
  - softmax as final layer to ensure decisions lies in a simplex
    - 2: portfolio optimization problem 
- in general, not land in feasible space. to circumvent:
  - 3: application-specific differentiable repair layer
    - project the solution back to feasibility 
  - 4: obtained by SGD(stochastic gradient descent) approximately minimize the Bayesian posterior loss

Optimal solution of a newsvendor problem is a quantile of demand distribution:

- 5: train an additive ensemble of decision trees using quantile regression
  - produce thr ordering decision  
  - Test the algorithms on a real-world dataset from a large German bakery chain 
- 6: optimize decision tree-based decision rules 
  - address the multi-item newsvendor, treatment planning, optimal stopping problems 
- 7: tutorial on DNN-based decision rule optimization 

8: piecewise-affine decision rules 

- provice non-asymptotic and asymptotic consistency results
  - for unconstrained and constrained problems 
- learn policy through: stochastic majorization-minimization algorithm
- experiment on constrained newsvendor problem 
  - piecewise-affine decision rules outperform RKHS-based policies 

## 3.4 Distributionally robust decision rules 

Assume parammetric form $ \\Pi^{\\theta} $ for the policy, but:

1: distributionally robust contextual newsvendor problem 

- under type-1 Wasserstein ambiguity set
- without assuming an explicit structure on the policy class 

$ W_{p}\\left(\\mathbb{P}_{1}, \\mathbb{P}_{2}\\right)=\\inf _{\\gamma \\in \\mathcal{M}\\left(\\mathcal{Y}^{2}\\right)}\\left(\\int_{\\mathcal{Y} \\times \\mathcal{Y}}\\left\\|y_{1}-y_{2}\\right\\|^{p} \\gamma\\left(d y_{1}, d y_{2}\\right)\\right)^{\\frac{1}{p}} $

- type-$p$ Wasserstein distance between $ \\mathbb{P}_{1} $ and $ \\mathbb{P}_{2} $
- $ \\gamma $ is a joint distribution of $ y_{1} $ and $ y_{2} $ 
  - with marginals $ \\mathbb{P}_{1} $ and $ \\mathbb{P}_{2} $

2: avoids the degeneracies of ERM
- for generic $\\Pi  $
- by define an optimal "Shapley" extension 
  - to the scenario-based optimal policy

That is:

$ \\min _{\\pi \\in \\Pi} \\sup _{\\mathbb{Q} \\in \\mathcal{M}(\\mathcal{X} \\times \\mathcal{Y})}\\left\\{H(\\pi, \\mathbb{Q}): \\mathcal{W}\\left(\\mathbb{Q}, \\hat{\\mathbb{P}}_{N}\\right) \\leq r\\right\\} \\equiv \\min _{\\pi: \\hat{\\mathcal{X}} \\rightarrow \\mathcal{Z} }\\sup _{\\mathbb  Q\\in \\mathcal M ({\\mathcal { \\hat X }} \\times \\mathcal{Y})}\\left\\{H(\\pi, \\mathbb{Q}): \\mathcal{W}\\left(\\mathbb{Q}, \\hat{\\mathbb{P}}_{N}\\right) \\leq r\\right\\} $

- $ \\hat{\\mathcal{X}}:=\\cup_{i=1}^{N}\\left\\{\\boldsymbol{x}_{i}\\right\\} $ 
- $ \\mathcal{M}(\\hat{\\mathcal{X}} \\times \\mathcal{Y}) $ is the set of all distribution supported on $ \\hat{\\mathcal{X}} \\times \\mathcal{Y} $.

3: in non-contextual setting

4: use LDRs to solve dynamic optimization problems with side information

5: pertubed distributions in Wasserstein ambiguity set:
- have a different conditional information structure 
  - than estimated conditional distribution 
- DRO(distributionally robust optimization) with causal transport metric 
  - place an additional causality constraint on transport plan
  - compare to Wasserstein metric 

6: Bayesian interpretation of decision rule optimization 
- using SGD 
- provide an unbaised estimate of worst-case objective function of a DRO problem 
  - as long as a uniqueness condition is satisfied 
- Wasserstein ambiguity set violates this condition 
- use KL(Kullback-Leibler) divergence to train models 

# 4 SLO(Sequential learning and optimization )

- a more traditional setting 
  - sconditional distribution is learned from data 
  - used directlly in optimization model 
- attempt to produce disicions:
  - robust to model misspecification 

## 4.1 Learning conditional distribution 

employed discrete models for $ f_{\\boldsymbol{\\theta}}(\\boldsymbol{x}) $

- motivatied from computational perspective
  - CSO problem [(5)](#5) is easier to solve 

CSO under continuous distribution:
- needs to be first replaced by SAA to be solved

Difficult: assess probability of outcomes:
- that not present in the dataset 
- justifying fixing the support of $\\boldsymbol y $ to its observed values

### 4.1.1 Residual-based distribution 

1: use the errors of a trained regression model 
- construct conditional distributions 

Let: 

- $ g_{\\hat{\\theta}} $ be a regression model trained to predict
  - the response $ \\boldsymbol{y} $ 
  - from the covariate $ \\boldsymbol{x} $

minimizing an estimation error $ \\rho $ as in [(7)](#7)

$ \\boldsymbol{\\epsilon}_{i}=\\boldsymbol{y}_{i}-g_{\\hat{\\boldsymbol{\\theta}}}\\left(\\boldsymbol{x}_{i}\\right) $: residual error of sample $i $

$ \\left\\{\\boldsymbol{\\epsilon}_{i}\\right\\}_{i=1}^{N} $: set of residuals measured on the historical data 

- used to form the conditional distribution 

$ f_{\\boldsymbol{\\theta}}(\\boldsymbol{x})=\\mathbb{P}^{\\mathrm{ER}}(\\boldsymbol{x}):=\\frac{1}{N} \\sum_{i=1}^{N} \\delta_{\\operatorname{proj}_{\\mathcal{Y}}\\left(\\mathrm{g}_{\\hat{\\boldsymbol{\\theta}}}(\\boldsymbol{x})+\\boldsymbol{\\epsilon}_{\\mathrm{i}}\\right)} $: the conditional distribution 
- $ \\operatorname{proj}_{y} $ the projection on the support $ \\mathcal{Y} $

the rCSO(residual-based CSO):

#### 10

$ (\\mathbf{r C S O}) \\min _{\\boldsymbol{z} \\in \\mathcal{Z}} h\\left(\\boldsymbol{z}, \\mathbb{P}^{\\mathrm{ER}}(\\boldsymbol{x})\\right) $


Advantage:

- can be applied in conjunction with any trained regression model 

2: conditional distribution for two-stage and multi-stage CSO 
- use the residual obtained from parametric regression on historical data

Notice: historical data is used twice 

- train the regression model $g_{\\boldsymbol \\theta } $
- measure the residuals $\\boldsymbol \\varepsilon _i $

Lead to: underestimation of distribution of the residual error

To remove bias:

3: a leave-one-out model (jackknife)

- measure the residuals as: $ \\tilde{\\boldsymbol{\\epsilon}}_{i}=\\boldsymbol{y}_{i}-g_{\\hat{\\boldsymbol{\\theta}}_{-i}}\\left(\\boldsymbol{x}_{i}\\right) $ 
  -  $ \\hat{\\boldsymbol{\\theta}}_{-i} $ is trained using all except the $i $-th sample $ \\left(\\boldsymbol{x}_{i}, \\boldsymbol{y}_{i}\\right) $
- can be applied to heteroskedastic case in 3 
  - obtain this conditional distribution :
  - $ f_{\\boldsymbol{\\theta}}(\\boldsymbol{x}):=\\frac{1}{N} \\sum_{i=1}^{N} \\delta_{\\operatorname{proj}}^{\\mathcal{Y}}\\left(\\mathrm{g}_{\\hat{\\boldsymbol{\\theta}}}(\\boldsymbol{x})+\\hat{\\mathrm{Q}}(\\boldsymbol{x}) \\hat{\\boldsymbol{\\epsilon}}_{\\mathrm{i}}\\right) $
    - by first estimating the conditional covariance matrix $ \\hat{Q}(\\boldsymbol{x}) $
    - form the residuals:  $ \\hat{\\boldsymbol{\\epsilon}}_{i}=\\left[\\hat{Q}\\left(\\boldsymbol{x}_{i}\\right)\\right]^{-1}\\left(\\boldsymbol{y}_{i}-g_{\\hat{\\boldsymbol{\\theta}}}\\left(\\boldsymbol{x}_{i}\\right)\\right) $

### 4.1.2 Weight-based distribution 

A typical approach for formulating the CSO problem:

assign weights to observations of the uncertain parameters in the historical data 
- solve wSAA(weighted SAA problem) given by:

#### (11)

$ (\\mathbf{w S A A}) \\min _{z \\in \\mathcal{Z}} h\\left(\\boldsymbol{z}, \\sum_{i=1}^{N} w_{i}(\\boldsymbol{x}) \\delta_{\\boldsymbol{y}_{i}}\\right) $

- $ f_{\\boldsymbol{\\theta}}(\\boldsymbol{x})=\\sum_{i=1}^{N} w_{i}(\\boldsymbol{x}) \\delta_{\\boldsymbol{y}_{i}} $: conditional distribution 

  - fully determined by the function used to assign a weight to historical samples 


Different approaches be proposed 
- to determine the sample weights with ML method 

**Weights based on proximity**

Sample weights can be assigned based on the distance between:

- covariate $\\boldsymbol x $
- each historical sample $\\boldsymbol x_i$ 

Instance: (kNN)$k$-nearest neighbor estimation 

- gives equal weight to $k $ closest samples 
- 0 weight for all other samples 
- $ w_{i}^{\\mathrm{kNN}}(\\boldsymbol{x}):=(1 / k) \\mathbb{1}\\left[\\boldsymbol{x}_{i} \\in \\mathcal{N}_{k}(\\boldsymbol{x})\\right] $
  - $ \\mathcal{N}_{k}(\\boldsymbol{x}) $ the set of $ k $ nearest neighbors of $\\boldsymbol  x$
  - $ \\mathbb{1}[\\cdot] $ : the indicator function.

Though: simple

Benefit: asymptotic consistency
- guarantee prescriptive performance 

Another way: kernel density estimators 

NW(Nadaraya-Watson) kernel estimator employ a weight function:

$ w_{i}^{\\mathrm{KDE}}(\\boldsymbol{x}):=\\frac{K\\left(\\left(\\boldsymbol{x}-\\boldsymbol{x}_{i}\\right) / \\boldsymbol{\\theta}\\right)}{\\sum_{j=1}^{N} K\\left(\\left(\\boldsymbol{x}-\\boldsymbol{x}_{j}\\right) / \\boldsymbol{\\theta}\\right)} $

- $ K $ : kernel function 
- $ \\boldsymbol{\\theta} $ : its bandwidth parameter
- Can use different kernel function 
  - e.g. Gaussian kernel: $ K(\\boldsymbol{\\Delta}) \\propto \\exp \\left(-\\|\\boldsymbol{\\Delta}\\|^{2}\\right) $

Also: bayesian approach that :
- exploits the Dirichlet process mixture 
  - to assign sample weights

  **Weights based on random forest**

  Weights can be designed 
  - based on random forest regressors

  Simplest setting:
  - weight function of a decision tree regressor is given by:

  $ w_{i}^{t}(\\boldsymbol{x}):=\\frac{\\mathbb{1}\\left[\\mathcal{R}_{t}(\\boldsymbol{x})=\\mathcal{R}_{t}\\left(\\boldsymbol{x}_{i}\\right)\\right]}{\\sum_{j=1}^{N} \\mathbb{1}\\left[\\mathcal{R}_{t}(\\boldsymbol{x})=\\mathcal{R}_{t}\\left(\\boldsymbol{x}_{j}\\right)\\right]} $

  - $ \\mathcal{R}_{t}(\\boldsymbol{x}) $ : the terminal node of tree $ t $ 
    -  contains covariate $ \\boldsymbol{x} $

  A decision tree:
  - assign equal weights to all historical sample 
    - that end in the same leaf node as $\\boldsymbol  x $

  Random forest weight function:
  - generalize this idea 
  - over many random decision trees 

  Weight function is defined as:

  $ w_{i}^{\\mathrm{RF}}(\\boldsymbol{x}):=\\frac{1}{T} \\sum_{t=1}^{T} w_{i}^{t}(\\boldsymbol{x}) $

  - $ w_{i}^{t} $ the weight function of tree $ t $

  Random forests are trained for:

  - perform an inference task
    - e.g. regression, classification
  - also used and interpreted as:
  - nonparametric conditional density estimators

  1: conditions for the asymptotic optimality and consistency of prescriptions 
  - obtained by solving problem [(11)](#11)
  - with weights functions given by kNN, NW kernel estimator, local linear regression 

### 4.1.3 Expected value-based models 

When cost function is linear:

training pipeline of SLO:

reduces to conditional mean estimation 

1: train regression trees 
- forecast daily expected sales 
  - for different product categories
- inventory and pricing peoblem

May attempt to approximate the doncitional density $ f_{\\boldsymbol{\\theta}}(\\boldsymbol{x}) $ using a point prediction $ g_{\\boldsymbol{\\theta}}(\\boldsymbol{x}) $

2: a last-mile delivery problem 
- customer orders are assigned to drivers 
- replace conditional distribution of stochastic travel time 
  - with point predictor 
  - accounts for the number of stops, total distance of the trip 

## 4.2 Regularization and distributionally robust optimization 

Non-parametric conditional density estimation method benefit from asymptotic consistency, but:

- produce overly optimistic policies 
  - when size of covariate vector is large 

To circumvent this issue:

- regularize the CSO problem
- cast it as a DRO problem 
  - attempts to minimize the worst-case expected cost 
  - over the set of distributions $ \\mathcal{B}_{r}\\left(f_{\\boldsymbol{\\theta}}(\\boldsymbol{x})\\right) $
    - lie at a distance $r$
    - from the estimated distribution 
- $ f_{\\boldsymbol{\\theta}}(\\boldsymbol{x}) $

1: generate bootstrap data 
- from training set 
- use as prxy for "out-of-sample disappointment"
  - of action $\\boldsymbol z $
  - resulting from out-of-sample cost
    - exceeding the budget 
    - given by $ \\sup _{\\mathbb{Q}_{y} \\in \\mathcal{B}_{r}\\left(f_{\\theta}(\\boldsymbol{x})\\right)} h\\left(\\boldsymbol{z}, \\mathbb{Q}_{y}\\right) $
- for NW kernel estimator and KNN estimator:
  - DRO under a range of ambiguity set 
  - can be reformulated as convex optimization problem 
- Use KL divergence
  - measure distance between :
    - probability distributions 
  - obtain:
    - guarantees with respect to estimate-then-optimize model 
    - taking bootstrap data as proxy 
    - for out-of-sample data 

2: Taking center of Wasserstein ambiguity set:
- be NW kernel estimator 

Show that: 

- distributionally robust newsvendor and CVaR(conditional value at risk) portfolio optimization problems 
  - can be reformulated as convex program
- provide conditions to obtain:
  - asymptotic convergence 
  - out-of-sample guarantees on the solutions of DRO model 

3: study distributionally robust kNN regression problem 
- by combining point estimation of outcome
  - with DRO model over Wasserstein ambiguity set 
- use kNN predict the outcome 
  - based on weighted distance metric 
    - constructed from the estimate 

4: study a distributionally robust contextual portfolio allocation problem 
- worst-case conditional return-risk tradeoff is computed
  - over an optimal transport ambiguity set 
    - consisting of pertubations of joint distributions of covariates and returns 

- generalize the mean-variance and mean-CVaR model 
  - distributionally robust models are equivalent to 
    - semi-definite 
    - second-order cone representable program 

5: solve a DRO problem with novel ambiguity set 
- based on trimming the empirical conditional distribution 
  - i.e. reducing the weights over the support points 
- show thelink between trimming a distribution and partial mass transportation problem 
- 6: application in the optimal power flow problem 

7: Distributionally robust extension of rCSO model 
- hedges against all distributions 
  - lie in $r$ radius of (Wasserstein) ambiguity ball 
    - centered at the estimated distribution $\\mathbb  P ^{ER }(\\boldsymbol  x )$

8: a DRO model to solve two-stage multi-item joint production and pricing problem 
- with a partitioned-moment-based ambiguity set 
- constructed by clustering the residual 
  - estimated from an additive demand model 

9: an expected value-based model 
- suggest an ambiguity set that is informed by the estimation metric 
  - used to train $ g_{\\hat{\\theta}} $.
- that is:

$ \\min _{\\boldsymbol{z} \\in \\mathcal{Z}} \\sup _{\\boldsymbol{\\theta} \\in \\mathcal{U}(\\hat{\\boldsymbol{\\theta}}, r)} c\\left(\\boldsymbol{z}, g_{\\boldsymbol{\\theta}}(\\boldsymbol{x})\\right) $

- $ \\mathcal{U}(\\hat{\\boldsymbol{\\theta}}, r):=\\left\\{\\boldsymbol{\\theta} \\in \\boldsymbol{\\theta} \\mid \\rho\\left(g_{\\boldsymbol{\\theta}}, \\hat{\\mathbb{P}}_{N}\\right) \\leq \\rho\\left(g_{\\hat{\\boldsymbol{\\theta}}}, \\hat{\\mathbb{P}}_{N}\\right)+r\\right\\} $
- finite-dimensional convex reformulations can be obtained 
  - when $ g_{\\boldsymbol{\\theta}}(\\boldsymbol{x}):=\\boldsymbol{\\theta}^{T} \\boldsymbol{x} $
- promote the use of "robustness optimization" form 

# 5 Integrated learning and optimization 


ILO is an end-to-end framework that :

includes three components in the training pipeline: 

- (i) a prediction model that:
  -  maps the covariate to a predicted distribution (or possibly a point prediction), 
- (ii) an optimization model that:
  -  takes as input a prediction and returns a decision,
- (iii) a task-based loss function that :
  -  captures the downstream optimization problem.

The parameters of the prediction model are trained to : 

- maximize the prescriptive performance of the policy,
  -  i.e., it is trained on the task loss incurred by this induced policy 
  -  rather than the estimation loss.

Next:

we discuss several methods for implementing the ILO approach

- describing the different models that are used in ILO([Section 5.1]()) 
- present the algorithms used
to perform the training
- divide the algorithms into four categories :
  - unrolling([Section 5.2]())
  - implicit differentiation([Section 5.3]())
  - a surrogate differentiable loss function([Section 5.4]())
  - a differentiable optimizer([Section 5.5]())


## 5.1 Models

1: Train a prediction model 

- using a loss that:
  - influenced by performance of an action 
    - prescribed by conditional expected value-based decision rule
- in a protfolio management context 

More recent 
- integrate full optimization model into pipeline 

We next:
- summarize how ILO is applied to 2 contextual optimization model 
- introduce 2 additional popular task models 

### Expected value-based model 

Most literature:
- perform ILO on expected value-based optimization model 

Following the notation in [Definition 1](#definition-1-expected-value-based-model) :

$ \\mathcal{L}(\\boldsymbol{\\theta}):=H\\left(z^{*}\\left(\\cdot, g_{\\boldsymbol{\\theta}}\\right), \\hat{\\mathbb{P}}_{N}\\right)= $ $ \\mathbb{E}_{\\mathfrak{P}_{N}}\\left[c\\left(z^{*}\\left(\\boldsymbol{x}, g_{\\boldsymbol{\\theta}}\\right), \\boldsymbol{y}\\right)\\right] $
- loss, training pipeline interested in.

$ g_{\\boldsymbol{\\theta}}(\\boldsymbol{x}) $ 
- a point predictor for $ \\boldsymbol{y} $, 
-  we interpret as a prediction of $ \\mathbb{E}[\\boldsymbol{y} \\mid \\boldsymbol{x}] $.

This already raises challenges related to:
- the non-convexity of the integrated loss function $ \\mathcal{L}(\\boldsymbol{\\theta}) $ 
-  its differentiation with respect to $ \\boldsymbol{\\theta} $ :

$ \\begin{aligned} \\nabla_{\\boldsymbol{\\theta}} \\mathcal{L}(\\boldsymbol{\\theta}) & =\\frac{1}{N} \\sum_{i=1}^{N} \\nabla_{\\boldsymbol{\\theta}} c\\left(z^{*}\\left(\\boldsymbol{x}_{i}, g_{\\boldsymbol{\\theta}}\\right), \\boldsymbol{y}_{i}\\right) \\\\ & =\\left.\\frac{1}{N} \\sum_{i=1}^{N} \\sum_{j=1}^{d_{z}} \\sum_{k=1}^{d_{\\boldsymbol{y}}} \\frac{\\partial c\\left(z^{*}\\left(\\boldsymbol{x}_{i}, g_{\\boldsymbol{\\theta}}\\right), \\boldsymbol{y}_{i}\\right)}{\\partial z_{j}} \\frac{\\partial z_{j}^{*}\\left(\\boldsymbol{x}_{i}, \\hat{\\boldsymbol{y}}\\right)}{\\partial \\hat{y}_{k}}\\right|_{\\hat{\\boldsymbol{y}}=g_{\\theta}\\left(\\boldsymbol{x}_{i}\\right)} \\nabla_{\\boldsymbol{\\theta}}\\left[g_{\\boldsymbol{\\theta}}\\left(\\boldsymbol{x}_{i}\\right)\\right]_{k}\\end{aligned} $

- $ \\frac{\\partial z_{j}^{*}\\left(\\boldsymbol{x}_{i}, \\hat{\\boldsymbol{y}}\\right)}{\\partial \\hat{y}_{k}} $ : the most problematic evaluation
  - e.g.:  when $ z^{*}\\left(\\boldsymbol{x}_{i}, g_{\\boldsymbol{\\theta}}\\right) $ is the solution of a LP(Linear program) 
    - its gradient is either null or non-existent

### Conditional distribution-based model 

In the context of :

learning a conditional distribution model : $ f_{\\theta}(\\boldsymbol{x}) $

1: First study ILO problem 

- model distribution of uncertain parameter 
  - using parametric distribution 
- for newsvendor problem:
  - ILO outperform :
    - DRO with neural networks
    - SLO with MLE(maximum likelihood estimation)
  - when there is model misspecification 

Since then:

- formulate CSO problem as weighted SAA model (refer to [Section 4.1.2](#412-weight-based-distribution))

- prediction model amounts to identify vector of weights to assign to each historical sample 

Taken by 2:
- train random forest regressor in integrated fashion to assign weights 

by 3:
- how to train general differentiable models 
  - to predict probabilities of uncertain parameter $\\boldsymbol y$ with finite support 

### Regret minimization task

tackle ILO problem from regret 

1: contextual point predictor $ g_{\\boldsymbol{\\theta}}(\\boldsymbol{x}) $ is learned by:

- minimizing regret associated with implementing the prescribed action 
  - based on mean estimator $ g_{\\boldsymbol{\\theta}}(\\boldsymbol{x}) $ 
  - instead of based on the realized parameters $ \\boldsymbol{y} $
  - a.k.a: optimal hindsight or wait-and-see decision 

Value of an expected value-based policy  $ \\pi_{\\boldsymbol{\\theta}}(\\boldsymbol{x}):=  z^{*}\\left(\\boldsymbol{x}, g_{\\boldsymbol{\\theta}}\\right) $ is measured as the expected regret defined as:

#### (13)

$ H_{\\text {Regret }}\\left(\\pi_{\\boldsymbol{\\theta}}, \\mathbb{P}\\right):=\\mathbb{E}_{\\mathbb{P}}\\left[c\\left(\\pi_{\\boldsymbol{\\theta}}(\\boldsymbol{x}), \\boldsymbol{y}\\right)-c\\left(z^{*}(\\boldsymbol{x}, \\boldsymbol{y}), \\boldsymbol{y}\\right)\\right] $

Minimizing the expected regret: 
- returns the same optimal parameter vector $ \\boldsymbol{\\theta} $ as the [ILO problem (9)](#9). 

Because:

$ H_{\\text {Regret }}\\left(\\pi, \\hat{\\mathbb{P}}_{N}\\right)=\\mathbb{E}_{\\hat{\\mathbb{P}}_{N}}\\left[c(\\pi(\\boldsymbol{x}), \\boldsymbol{y})-c\\left(z^{*}(\\boldsymbol{x}, \\boldsymbol{y}), \\boldsymbol{y}\\right)\\right]=H\\left(\\pi, \\hat{\\mathbb{P}}_{N}\\right)-\\mathbb{E}_{\\hat{\\mathbb{P}}_{N}}\\left[c\\left(z^{*}(\\boldsymbol{x}, \\boldsymbol{y}), \\boldsymbol{y}\\right)\\right] $

- both $ H_{\\text {Regret }}\\left(\\pi, \\hat{\\mathbb{P}}_{N}\\right) $ and $ H\\left(\\pi, \\hat{\\mathbb{P}}_{N}\\right) $ have the same set of minimizers

### Optimal action imitation task 

ILO has some connections to inverse optimization :

- learning the parameters of an optimization model 
  - given data about its optimal solution

one can :

replace the original objective of ILO 
- with an objective that seeks 
- to produce a $ z^{*}\\left(\\boldsymbol{x}, f_{\\boldsymbol{\\theta}}\\right) $ 
  - that is as close as possible to the optimal hindsight action 
  - and, therefore, closer to the regret objective. 

Specifically, to learn a policy that "imitates" the optimal hindsight action: 

one can first augment the data set 
- with $ \\boldsymbol{z}_{i}^{*}:=z^{*}\\left(\\boldsymbol{x}_{i}, \\boldsymbol{y}_{i}\\right) $ to get $ \\left\\{\\left(\\boldsymbol{x}_{i}, \\boldsymbol{y}_{i}, \\boldsymbol{z}_{i}^{*}\\right)\\right\\}_{i=1}^{N} $. 

Thereafter:

a prediction model $ f_{\\boldsymbol{\\theta}}(\\boldsymbol{x}) $ is learned in a way : 
- that the action $ z^{*}\\left(\\boldsymbol{x}_{i}, f_{\\boldsymbol{\\theta}}\\right) $ is as close as possible to $ \\boldsymbol{z}_{i}^{*} $
  -  for all samples in the training set:

#### (14)

$ H_{\\text {Imitation }}\\left(\\pi, \\hat{\\mathbb{P}}_{N}^{\\prime}\\right):=\\mathbb{E}_{\\hat{\\mathbb{P}}_{N}^{\\prime}}\\left[d\\left(\\pi(\\boldsymbol{x}), \\boldsymbol{z}^{*}\\right)\\right]=\\mathbb{E}_{\\hat{\\mathbb{P}}_{N}}\\left[d\\left(\\pi(\\boldsymbol{x}), z^{*}(\\boldsymbol{x}, \\boldsymbol{y})\\right)\\right] $


- $ \\hat{\\mathbb{P}}_{N}^{\\prime} $ : the empirical distribution 
  - on the lifted tuple $ \\left(\\boldsymbol{x}, \\boldsymbol{y}, z^{*}(\\boldsymbol{x}, \\boldsymbol{y})\\right) $ 
  - based on the augmented data set 
  - and a distance function $ d\\left(\\boldsymbol{z}, \\boldsymbol{z}^{*}\\right) $. 

Note that:

there is no reason to believe that: 

the best imitator under a general distance function, 
- e.g., $ \\left\\|\\boldsymbol{z}-\\boldsymbol{z}^{*}\\right\\|_{2} $, 

performs well under our original metric $ H\\left(\\pi, \\hat{\\mathbb{P}}_{N}\\right) $.

One exception:

For $ d\\left(\\boldsymbol{z}, \\boldsymbol{z}^{*}\\right):=c(\\boldsymbol{z}, \\boldsymbol{y})-c\\left(\\boldsymbol{z}^{*}, \\boldsymbol{y}\\right) $, 
- where we allow the distance to also depend on $ \\boldsymbol{y} $, 
- for which we recover the regret minimization approach
- therefore the same solution as with $ H\\left(\\pi, \\hat{\\mathbb{P}}_{N}\\right) $. 

## 5.2 Training by unrolling 

An approach to obtain Jacobian matrix $ \\boldsymbol{\\kappa} \\frac{\\partial z^{*}(\\boldsymbol{x}, \\hat{\\boldsymbol{y}})}{\\partial \\hat{\\boldsymbol{y}}} $ : unrolling 

it involves:

- approximating the optimization problem with an iterative solver
  - e.g.:  first-order gradient-based method 

Each operation is stored on the computational graph, 
- then allows, in principle, for computing gradients through classical back-propagation methods. 

Unfortunately: this approach requires extensive amounts of memory. 

Besides this: 

the large size of the computational graph 
- exacerbates the vanishing and exploding gradient problems 
  - typically associated with training neural networks

## Training using implicit differentiation 

Implicit differentiation allows:
- a memory-efficient backpropagation 
- as opposed to unrolling 
  - (we refer to Bai et al. 2019, for discussion on training constant memory implicit models using a fixed-point - FP - equation and feedforward networks of infinite depths).

1: appear to be the first to have employed implicit differentiation methods to train an ILO model
- which they refer to as OptNet. 

They consider expected value-based optimization models 
- take the form of constrained quadratic programs (QP) with equality and inequality constraints. 

They show how the implicit function theorem (IFT - Halkin 1974) can be used to differentiate $ z^{*}\\left(\\boldsymbol{x}, g_{\\boldsymbol{\\theta}}\\right) $ with respect to $ \\boldsymbol{\\theta} $
- using the Karush-Kuhn-Tucker (KKT) conditions 
  -  are satisfied at optimality. 

Further:

they provide a custom solver based on a primal-dual interior method

- to simultaneously solve multiple QPs on GPUs in batch form, 
- permitting 100-times speedups compared to Gurobi and CPLEX. 

This approach is extended to conditional stochastic and strongly convex optimization models in Donti et al. (2017): 

They use sequential quadratic programming (SQP) to obtain quadratic approximations of the objective functions of the convex program at each iteration 

- until convergence to the solution and then differentiate the last iteration of SQP to obtain the Jacobian. 

For a broader view of implicit differentiation: we refer to the surveys by Duvenaud et al. (2020) and Blondel et al. (2022).

To solve large-scale QPs with linear equality and box inequality constraints:

2 Butler and Kwon (2023a) use the ADMM algorithm to decouple the differentiation procedure for primal and dual variables

thereby:
- decomposing the large problem into smaller subproblems. 

Their procedure relies on: 
- implicit differentiation of the FP equations of the alternating direction method of multipliers (ADMM) algorithm (ADMM-FP). 

They show that: 
- unrolling the iterations of the ADMM algorithm on the computational graph (Sun et al. 2016, Xie et al. 2019) results in higher computation time than ADMM-FP. 

Their empirical results on a portfolio optimization problem with 254 assets suggest that : 

computational time can be reduced by a factor of almost five 
- by using ADMM-FP compared to OptNet, 

mostly due to the use of the ADMM algorithm in the forward pass. 

Note that the experiments in Butler and Kwon (2023a) were conducted on a
CPU.

To extend OptNet to a broader class of problems:

3 introduce cvxpylayers that 
- relies on converting disciplined convex programs in the domain-specific language 
  - used by CVXPY into conic programs. 

They implicitly differentiate the residual map of the homogeneous self-dual embedding associated with the conic program.

4: note that using KKT conditions for constrained optimization problems with DNN-based policies"
- is computationally costly 
  - as "cvxpylayers struggles with solving problems containing more than 100 variables" (see also Butler and Kwon 2023a).
-  An alternative is to use projected gradient descent (PGD) 
   - where DNN-based policies are updated using an iterative solver 
   - and projected onto the constraint set $ \\mathcal{Z} $ at each iteration 
   - and the associated FP system (Donti et al. 2021, Chen et al. 2021, Blondel et al. 2022) is used to obtain the Jacobian.
 - Since a closed-form solution for the projection onto $ \\mathcal{Z} $ is unavailable in many cases, 
   - the projection step may be costly, 
   - and in some cases, PGD may not even converge to a feasible point (Rychener et al. 2023). 

To avoid computing the projection in the forward pass, 5 solve the expected value-based CSO problem using: 
- Davis-Yin operator splitting (Davis and Yin 2017) 
- while the backward pass uses the Jacobian-free backpropagation (Fung et al. 2022) 
  - in which the Jacobian matrix is replaced with an identity matrix (see also Sahoo et al. 2023, where a similar approach is used for expected value-based models).

To mitigate the issues with unrolling: 6 propose FP folding (fold-opt) that:
- allows analytically differentiating the FP system of general iterative solvers, 
  - e.g., ADMM, SQP, and PGD. 

By unfolding (i.e., partial unrolling), some of the steps of unrolling are grouped in analytically differentiable update function $ \\mathcal{T}: \\mathbb{R}^{d_{y}} \\rightarrow \\mathbb{R}^{d_{y}} $ :

$ z_{k+1}(\\boldsymbol{x}, \\hat{\\boldsymbol{y}})=\\mathcal{T}\\left(z_{k}(\\boldsymbol{x}, \\hat{\\boldsymbol{y}}), \\hat{\\boldsymbol{y}}\\right) $

Realizing that $ z^{*}(\\boldsymbol{x}, \\hat{\\boldsymbol{y}}) $ is the FP of the above system:
- they use the IFT to obtain a linear system (a differential FP condition) 
  - that can be solved to obtain the Jacobian. 

This effectively decouples the forward and backward pass enabling 
- the use of black box solvers like Gurobi for the forward pass 
- while cvxpylayers is restricted to operator splitting solvers like ADMM. 


An added benefit of using fold-opt is that: 

it can solve non-convex problems. 

In the case of portfolio optimization, the authors note that :

- the superior performance of their model with respect to cvxpylayers can be explained by the precise calculations made in the forward pass by Gurobi.



While speedups can be obtained for sparse problems, Sun et al. (2023b) remark that:
- the complexity associated with differentiating the KKT conditions is cubic in the total number of decision variables and constraints in general. 

They propose an alternating differentiation framework (called Alt-Diff) to:
- solve parameterized convex optimization problems 
- with polyhedral constraints using ADMM 
  - that decouples the objective and constraints. 

This procedure results in:

a smaller Jacobian matrix 
- when there are many constraints 
- since the gradient computations for primal, dual, and slack variables are done alternatingly. 

The gradients are shown to converge to those obtained by differentiating the KKT conditions. 

The authors employ truncation of iterations to compensate for the slow convergence of ADMM when compared to interior-point methods 

and provide theoretical upper bounds on the error in the resulting gradients. 

Alt-Diff is shown to achieve the same accuracy with truncation and lower computational time when compared to cvxpylayers:
- for an energy generation scheduling problem.

Motivated by OptNet, several extensions have been proposed to solve linear and combinatorial problems. 

7 solve LP-representable combinatorial optimization problems and LP relaxations of combinatorial problems during the training phase. 

Their model, referred to as QPTL (Quadratic Programming Task Loss):

- adds a quadratic penalty term to the objective function of the linear problem. 

This has two advantages: 
- it recovers a differentiable linear-quadratic program, and the added term acts as a regularizer, 
- which might avoid overfitting. 

To solve a general mixed-integer LP (MILP), 8 develop a cutting plane method MIPaal,
- which adds a given number of cutting planes in the form of constraints $ S \\boldsymbol{z} \\leq \\boldsymbol{s} $ to the LP relaxation of the MILP.

Instead of adding a quadratic term, 9 propose Intopt based on the interior point method to solve LPs
- that adds a log barrier term to the objective function and differentiates the homogeneous self-dual formulation of the LP. 

Their experimental analyses show that: 
- this approach performs better on energy cost-aware scheduling problems than QPTL using the data from Ifrim et al. (2012).

10 introduce an ILO framework with the weighted average of Sharpe ratio and MSE loss as a task loss and replace the optimization problem with a surrogate DRO problem. 

By using convex duality:

they reformulate the minimax problem as a minimization problem and learn the parameters (e.g., size of ambiguity set) using implicit differentiation instead of cross-validation (CV). 

More specifically, the DRO model uses a deviation risk measure (e.g., variance) to control variability in the portfolio returns associated with the prediction errors $ \\boldsymbol{\\epsilon}_{i}= $ $ \\boldsymbol{y}_{i}-g_{\\theta}\\left(\\boldsymbol{x}_{i}\\right): $

$ \\underset{\\boldsymbol{z}}{\\operatorname{argmin}} \\max _{\\mathbb{Q} \\in \\mathcal{B}_{r}^{\\phi}\\left(\\hat{\\mathbb{P}}_{N}\\right)} \\mathbb{E}_{\\mathbb{Q}}\\left[\\left(\\boldsymbol{\\epsilon}^{\\top} \\boldsymbol{z}-\\mathbb{E}_{\\mathbb{Q}}\\left[\\boldsymbol{\\epsilon}^{\\top} \\boldsymbol{z}\\right]\\right)^{2}\\right] $

- the distribution of errors lies in $ \\phi $-divergence (e.g., Hellinger distance) based ambiguity set $ \\mathcal{B}_{r}^{\\phi}\\left(\\hat{\\mathbb{P}}_{N}\\right)=\\left\\{\\mathbb{Q}: \\mathbb{E}_{\\hat{\\mathbb{P}}}[\\phi(\\mathbb{Q} / \\hat{\\mathbb{P}})] \\leq r\\right\\} $ centered at $ \\hat{\\mathbb{P}}_{N}=\\frac{1}{N} \\sum_{i=1}^{N} \\delta_{\\epsilon_{i}} $.

For convex problems, the optimality conditions are given by KKT conditions, 

can be represented as $ F(\\boldsymbol{\\theta}, \\boldsymbol{z})=0 $ 
- $ F: \\mathbb{R}^{d_{\\boldsymbol{x}}} \\times \\mathbb{R}^{d_{\\boldsymbol{z}}} \\rightarrow \\mathbb{R}^{m} $, 
  - $ m $ is proportional to the number of constraints that define $ \\mathcal{Z} $. 

From the classical IFT (Dontchev et al. 2009), we know that: 

if $ F $ is continuously differentiable and the Jacobian matrix with respect to $ \\boldsymbol{z} $, 
- denoted by $ \\nabla_{\\boldsymbol{z}} F(\\boldsymbol{\\theta}, \\boldsymbol{z}(\\boldsymbol{\\theta})) $, 

is non-singular at the point $ (\\overline{\\boldsymbol{\\theta}}, \\overline{\\boldsymbol{z}}) $, 

then:

there exists a neighborhood around $ \\overline{\\boldsymbol{\\theta}} $ 
- for which the gradient of the optimal solution with respect to the parameters is given by:

$ \\frac{\\partial \\boldsymbol{z}^{*}(\\boldsymbol{\\theta})}{\\partial \\boldsymbol{\\theta}}=-\\left(\\nabla_{\\boldsymbol{z}} F(\\boldsymbol{\\theta}, \\boldsymbol{z}(\\boldsymbol{\\theta}))\\right)^{-1} \\nabla_{\\boldsymbol{\\theta}} F(\\boldsymbol{\\theta}, \\boldsymbol{z}(\\boldsymbol{\\theta})) $

When the Jacobian matrix $ \\nabla_{\\boldsymbol{z}} F(\\boldsymbol{\\theta}, \\boldsymbol{z}(\\boldsymbol{\\theta})) $ is singular, classical IFT cannot be applied. 

This occurs in linear programs and can also arise in smooth QPs as shown in 11

11 obtain a generalization of IFT to non-smooth functions:
- using conservative Jacobians that generalize Clarke Jacobians (Clarke 1990) for locally Lipschitz function $ F $. 

They also derive conservative Jacobians for conic optimization layers (Agrawal et al. 2019).

Further, 12 illustrate using cvxpylayers that in a bilevel program 

- which is a composition of a quadratic function 
  - with the solution map of a linear program, 

gradient descent does not converge but gets stuck in a "limit cycle of non-critical points" even though invertibility condition does not hold only on a set of measure 0 (defined by a line) 
- where the solution map moves from extreme point to another. 

As this example illustrates, the convergence of gradient methods based on IFT can be impacted by the non-invertibility of the Jacobian matrix and nonsmoothness 
- which is difficult to verify a priori. 

As a result, research efforts have been directed toward designing surrogate loss functions and perturbation-based models for CSO problems that could circumvent the need to use the IFT.

## 5.4  Training using a surrogate differentiable loss function

As discussed in Section 5.1, 

minimizing directly the task loss in [(9)](#9) or the regret in [(13)](#13) is computationally difficult in most cases. 

For instance: 

the loss may be piecewise-constant as a function of the parameters of a prediction model and, 
- thus, may have no informative gradient. 

To address this issue, several surrogate loss functions with good properties, 
- e.g., differentiability and convexity,

have been proposed to train ILO models.

### 5.4.1 SPO+

In CSO problems, 1 first tackle the potential nonuniqueness of $ z^{*}\\left(\\boldsymbol{x}, g_{\\boldsymbol{\\theta}}\\right) $ by introducing a Smart "Predict, then Optimize" (SPO) model 
- where the decision-maker chooses to minimize the empirical average of the regret 
  - under the worst-case optimal solution as defined below:

#### (15)

$ \\begin{aligned} \\text { (SPO) } \\quad \\min _{\\boldsymbol{\\theta}} \\max _{\\pi} & H_{\\text {Regret }}\\left(\\pi, \\hat{\\mathbb{P}}_{N}\\right), \\\\ & \\text { s.t. } \\pi(\\boldsymbol{x}) \\in \\underset{\\boldsymbol{z} \\in \\mathcal{Z}}{\\operatorname{argmin}} c\\left(\\boldsymbol{z}, g_{\\boldsymbol{\\theta}}(\\boldsymbol{x})\\right), \\forall \\boldsymbol{x} .\\end{aligned} $

In the expected value-based model, they show that the SPO objective reduces to training the prediction model according to the ERM problem:

$ \\boldsymbol{\\theta}^{\\star} \\in \\underset{\\boldsymbol{\\theta}}{\\operatorname{argmin}} \\rho_{\\text {SPO }}\\left(g_{\\boldsymbol{\\theta}}, \\hat{\\mathbb{P}}_{N}\\right):=\\mathbb{E}_{\\hat{\\mathbb{P}}_{N}}\\left[\\ell_{\\text {SPO }}\\left(g_{\\boldsymbol{\\theta}}(\\boldsymbol{x}), \\boldsymbol{y}\\right)\\right] $

- $ \\ell_{\\mathrm{SPO}}(\\hat{\\boldsymbol{y}}, \\boldsymbol{y}):=\\sup _{\\overline{\\boldsymbol{z}} \\in \\operatorname{argmin}_{\\boldsymbol{z} \\in \\mathcal{Z}} c(\\boldsymbol{z}, \\hat{\\boldsymbol{y}})} c(\\overline{\\boldsymbol{z}}, \\boldsymbol{y})-c\\left(z^{*}(\\boldsymbol{x}, \\boldsymbol{y}), \\boldsymbol{y}\\right) $

Since the SPO loss function is nonconvex and discontinuous in $ \\hat{\\boldsymbol{y}} $ (Ho-Nguyen and Kılıç-Karzan 2022, Lemma 1), Elmachtoub and Grigas (2022) focus on the linear objective $ c(\\boldsymbol{z}, \\boldsymbol{y}):=\\boldsymbol{y}^{T} \\boldsymbol{z} $ and replace the SPO loss with a convex upper bound called SPO+:

$ \\ell_{\\text {SPO }+}(\\hat{\\boldsymbol{y}}, \\boldsymbol{y}):=\\sup _{\\boldsymbol{z} \\in \\mathcal{Z}}(\\boldsymbol{y}-2 \\hat{\\boldsymbol{y}})^{T} \\boldsymbol{z}+2 \\hat{\\boldsymbol{y}}^{T} z^{*}(\\boldsymbol{x}, \\boldsymbol{y})-\\boldsymbol{y}^{T} z^{*}(\\boldsymbol{x}, \\boldsymbol{y}) $

 has a closed-form expression for its subgradient:

#### (16)

$ 2\\left(z^{*}(\\boldsymbol{x}, \\boldsymbol{y})-z^{*}(\\boldsymbol{x}, 2 \\hat{\\boldsymbol{y}}-\\boldsymbol{y})\\right) \\in \\nabla_{\\hat{\\boldsymbol{y}}} \\ell_{\\mathbf{s P O}+}(\\hat{\\boldsymbol{y}}, \\boldsymbol{y}) $

Loke et al. (2022) propose a decision-driven regularization model (DDR) 
- that combines prediction accuracy - and decision quality 
in a single optimization problem with loss function as follows:

$ \\ell_{\\mathrm{DDR}}(\\hat{\\boldsymbol{y}}, \\boldsymbol{y})=d(\\hat{\\boldsymbol{y}}, \\boldsymbol{y})-\\lambda \\min _{\\boldsymbol{z} \\in \\mathcal{Z}}\\left\\{\\mu \\boldsymbol{y}^{\\top} \\boldsymbol{z}+(1-\\mu) \\hat{\\boldsymbol{y}}^{\\top} \\boldsymbol{z}\\right\\} $

and SPO+ being a special case with $ \\mu=-1, \\lambda=1 $, and $ d(\\hat{\\boldsymbol{y}}, \\boldsymbol{y})=2 \\hat{\\boldsymbol{y}}^{\\top} z^{*}(\\boldsymbol{x}, \\boldsymbol{y})-\\boldsymbol{y}^{T} z^{*}(\\boldsymbol{x}, \\boldsymbol{y}) $.

#### SPO+ for combinatorial problems

Evaluating the gradient of $ S P O+l o s s $ in [(16)](#16) requires solving the optimization problem [(8)](#8) to obtain $ z^{*}(\\boldsymbol{x}, 2 \\hat{\\boldsymbol{y}}-\\boldsymbol{y}) $ for each data point. 

This can be computationally demanding when the optimization model in [(8)](#8) is an NP-hard problem. 

1 propose a SPO-relax approach that : 

- computes the gradient of SPO+ loss by solving instead a continuous relaxation when [(8)](#8) is a MILP. 

They also suggest: 
- speeding up the resolution using a warm-start for learning with a pre-trained model that:
  -  uses MSE as the loss function. 
- Another way proposed to speed up the computation is: warm-starting the solver. 
  - For example, $ z^{*}(\\boldsymbol{x}, \\boldsymbol{y}) $ can be used as a starting point for MILP solvers or to cut away a large part of the feasible space.

Mandi et al. (2020) show that:
- for weighted and unweighted knapsack problems as well as energycost aware scheduling problems (CSPLib, Problem 059, Simonis et al. 2014), SPO-relax results in:
- faster convergence and similar performance compared to SPO+ loss. 

Also, SPO-relax provides low regret solutions and faster convergence compared to QPTL 
- in the aforementioned three problems, 
- except in the weighted knapsack problem with low capacity.

With a focus on exact solution approaches, Jeong et al. (2022) study the problem of:

minimizing the regret in [(13)](#13) assuming a linear prediction model $ g_{\\boldsymbol{\\theta}}(\\boldsymbol{x})=\\boldsymbol{\\theta} \\boldsymbol{x} $ with $ \\boldsymbol{\\theta} \\in \\mathbb{R}^{d_{\\boldsymbol{z}} \\times d_{\\boldsymbol{x}}} $. 

Under the assumption that : 

$ z^{*}\\left(\\boldsymbol{x}, g_{\\boldsymbol{\\theta}}\\right) $ is unique for all $ \\boldsymbol{\\theta} $ and $ \\boldsymbol{x} $, 

the authors reformulate the bilevel SPO problem as a single-level MILP using symbolic variable elimination. 

They show that:
- their model can achieve up to two orders of magnitude improvement in expected regret compared to SPO+ on the training set.

Muñoz et al. (2022) applies a similar idea of representing the set of optimal solutions with a MILP. 

They rely on the KKT conditions of the problem defining $ z^{*}\\left(\\boldsymbol{x}, g_{\\boldsymbol{\\theta}}\\right) $
- to transform the bilevel integrated problem into a single-level MILP. 

Finally, Estes and Richard (2023) use the SPO loss function
- to solve a two-stage LP with right-hand side uncertainty. 

They propose a lexicographical ordering rule to select the minimal solution 
- when there are multiple optima and approximate the resulting piecewise-linear loss function, lex-SPO, by a convex surrogate to find the point predictor.

#### SPO Trees. 

Elmachtoub et al. (2020) propose a model (SPOT) to construct decision trees that:

- segment the covariates based on the SPO loss function
-  while retaining the interpretability in the end-to-end learning framework.

Their model outperforms classification and regression trees (CART) in the numerical experiments 

on a news recommendation problem using a real-world dataset 

and on the shortest path problem with synthetic data (also used in Elmachtoub and Grigas (2022)).

Guarantees. Elmachtoub and Grigas (2022) show that: 

under certain conditions, the minimizers of the SPO loss, SPO+ loss and MSE loss are almost always equal to $ \\mathbb{E}_{\\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x})}[\\boldsymbol{y}] $
- given that $ \\mathbb{E}_{\\mathbb{P}(\\boldsymbol{y} \\mid \\boldsymbol{x})}[\\boldsymbol{y}] \\in \\mathcal{H} $. 

Thus, $ \\mathbf{S P O}+ $ is Fisher consistent (see Definition 4 in Appendix A) with respect to the SPO loss. 

This means that: 
- minimizing the surrogate loss also minimizes the true loss function. 

Ho-Nguyen and Kılınç-Karzan (2022) show that: 

for some examples of a multiclass classification problem, SPO+ is Fisher inconsistent, 
- while MSE loss is consistent. 

However, complete knowledge of the distribution is a limitation in practice
- where the decision-maker has access to only the samples from the distribution.

As a result, Ho-Nguyen and Kılınç-Karzan (2022) and Liu and Grigas (2021) provide calibration bounds:
- that hold for a class of distributions $ \\mathcal{D} $ on $ \\mathcal{X} \\times \\mathcal{Y} $ and ensure that:
- a lower excess risk of predictor for MSE and SPO+, respectively, translates to lower excess SPO risk (see Definition 5 in Appendix A).

In many ML applications, one seeks to derive finite-sample guarantees, 
- which are given in the form of a generalization bound,
  - i.e., an upper bound on the difference between the true risk of a loss function and its empirical risk estimate for a given sample size $ N $. 
A generalization bound for the SPO loss function is given in El Balghiti et al. (2022) (extension of El Balghiti et al. 2019) based on Rademacher complexity (see Definition 6 in Appendix A) of the SPO loss composed with the prediction functions $ g_{\\boldsymbol{\\theta}} \\in \\mathcal{H} $. 

More specifically, the bound achieved in El Balghiti et al. (2019) is $ \\mathrm{O}\\left(\\sqrt{\\frac{\\log (N)}{N}}\\right) $, and tighter bounds with respect to action and feature dimension are obtained using SPO function's structure 

and if $ \\mathcal{Z} $ satisfies a "strength" property. 


Hu et al. (2022) show that for linear CSO problems, the generalization bound for MSE loss and SPO loss is $ \\mathrm{O}\\left(\\sqrt{\\frac{1}{N}}\\right) $ 

while faster convergence rates for the SLO model compared to ILO model are obtained under certain low-noise assumptions. 

Elmachtoub et al. (2023) show that :

for non-linear optimization problems, SLO models stochastically dominate ILO in terms of their asymptotic optimality gaps
- when the hypothesis class covers the true distribution.

When the model is misspecified, they show that:

ILO outperforms SLO asymptotically in a general nonlinear setting.

### 5.4.2 Surrogate loss for a stochastic forest.

Kallus and Mao (2022) propose an algorithm called StochOptForest, 
- which generalizes the random-forest based local parameter estimation procedure in Athey et al. (2019). 

A second-order perturbation analysis of stochastic optimization problems allows them to scale to larger CSO problems 

since they can avoid solving an optimization problem at each candidate split. 

The policies obtained using their model are shown to be asymptotically consistent, 

and the benefit of ILO is illustrated by comparing their approach to the random forests of Bertsimas and Kallus (2020)
- on a set of problems with synthetic and real-world data.

### 5.4.3. Other surrogates. 

Wilder et al. (2019b) introduce ClusterNet to solve hard combinatorial graph optimization problems:
- by learning incomplete graphs. The model combines graph convolution networks
- to embed the graphs in a continuous space
- and uses a soft version of k-means clustering to obtain a differential proxy for the combinatorial problems,
  - e.g., community detection and facility location.

Numerical experiments on a synthetic data set show that:
- ClusterNet outperforms the two-stage SLO approach of first learning the graph and then optimizing, 
- as well as other baselines used in community detection and facility location.

Focusing on combinatorial problems, Vlastelica et al. (2019) propose a differentiable black-box (DBB) approach to tackle the issue that : 

the Jacobian of $ z^{*}\\left(\\boldsymbol{x}, g_{\\boldsymbol{\\theta}}\\right) $ is zero almost everywhere 

by approximating the true loss function 
- using an interpolation controlled in a way that
  -  balances between "informativeness of the gradient" and "faithfulness to the original function".

Algorithmically, this is done by perturbing the prediction $ g_{\\boldsymbol{\\theta}}(\\boldsymbol{x}) $ in the direction $ \\nabla_{\\boldsymbol{z}} c\\left(z^{*}\\left(\\boldsymbol{x}, g_{\\boldsymbol{\\theta}}\\right), \\boldsymbol{y}\\right) $ and obtaining a gradient of the surrogate loss based on the effect of this perturbation on the resulting perturbed action.

Chung et al. (2022) introduce a computationally tractable ILO model : 

to solve non-linear CSO problems. 

Using the first-order Taylor expansion of the task loss around the prediction, 

they introduce a reweighted MSE loss function 

- where weights are determined by taking the gradient of task loss with respect to the prediction. 

To solve a large-scale multi-facility inventory allocation problem 
- with few samples for each facility, 

they use a single random forest that:

can predict the demand across facilities and products.

Assuming that each tree in the random forest provides an independent and identically distributed realization of the uncertain parameter, 

they obtain the conditional distribution of uncertain parameter, $ f_{\\theta_{0}}=\\frac{1}{T} \\sum_{t=1}^{T} \\delta_{\\hat{\\boldsymbol{y}}^{t}} $, 
- where $ \\hat{\\boldsymbol{y}}^{t} $ is the prediction of tree $ t $.

For each feature $ \\boldsymbol{x}_{i} $ and conditional distribution $ f_{\\boldsymbol{\\theta}_{0}} $, 

they obtain an optimal allocation, $ z_{i}^{j}= $ $ z^{*}\\left(\\boldsymbol{x}, f_{\\boldsymbol{\\theta}_{0}}\\right) $ for facility $ j $ 
- that minimizes the average unmet demand. In the last step, they retrain the random forest to minimize the reweighted MSE loss function:

#### (17)

$ \\underset{\\boldsymbol{\\theta}}{\\operatorname{argmin}} \\sum_{i=1}^{N} \\sum_{j=1}^{M} \\sum_{t=1}^{T} \\mathbb{1}\\left[\\hat{y}_{i}^{t, j} \\geq s_{i}^{j}+z_{i}^{j}\\right]\\left|f_{\\boldsymbol{\\theta}}\\left(\\boldsymbol{x}_{i}\\right)-\\hat{y}_{i}^{t, j}\\right| $

- $ M $ is the number of facilities, 
- $ \\hat{y}_{i}^{t, j} $ and $ s_{i}^{j} $ denote the demand and inventory levels, respectively, at facility $ j $. 

The above model [(17)](#17) solves the optimization problem once during training, 

and is shown to be scalable for a medical allocation problem in Sierra Leone when compared to Kallus and Mao (2022)
- where splitting of the feature space is done based on the task loss.

Lawless and Zhou (2022) introduce a loss function similar to Chung et al. (2022) that:

weighs the prediction error with a regret term as follows:

#### (18)

$ d\\left(g_{\\boldsymbol{\\theta}}(\\boldsymbol{x}), \\boldsymbol{y}\\right)=\\left[c\\left(z^{*}\\left(\\boldsymbol{x}, g_{\\boldsymbol{\\theta}}\\right), \\boldsymbol{y}\\right)-c\\left(z^{*}(\\boldsymbol{x}, \\boldsymbol{y}), \\boldsymbol{y}\\right)\\right]\\left(\\boldsymbol{y}-g_{\\boldsymbol{\\theta}}(\\boldsymbol{x})\\right)^{2} $

Learning optimal $ \\boldsymbol{\\theta} $ from the above formulation involves an $ \\operatorname{argmin} $ differentiation. 

So, the authors provide a two-step polynomial time algorithm to approximately solve the above problem:

It first computes a pilot estimator $ g_{\\boldsymbol{\\theta}_{0}} $
- by solving [(7)](#7) with $ d\\left(g_{\\boldsymbol{\\theta}}(\\boldsymbol{x}), \\boldsymbol{y}\\right)=\\left(g_{\\boldsymbol{\\theta}}(\\boldsymbol{x})-\\boldsymbol{y}\\right)^{2} $ 

and then solving [(7)](#7) with the distance function in [(18)](#18) where:
-  $ c\\left(z^{*}\\left(\\boldsymbol{x}, g_{\\boldsymbol{\\theta}}\\right), \\boldsymbol{y}\\right) $ is substituted with $ c\\left(z^{*}\\left(\\boldsymbol{x}, g_{\\boldsymbol{\\theta}_{0}}\\right), \\boldsymbol{y}\\right) $. 

The authors show that their simple algorithm performs comparably to SPO+.

We conclude this subsection on surrogate loss functions by : mentioning the efforts in Sun et al. (2023a) to learn a cost point estimator (in an expected value-based model)
- to imitate the hindsight optimal solution.

This is done by designing a surrogate loss function that:
- penalizes how much the optimal basis optimality conditions are violated. 

They derive generalization error bounds for this new loss function and employ them to provide a bound on the sub-optimality of the minimal $ \\theta $.

## 5.5  Training using a surrogate differentiable optimizer

### 5.5.1  Differentiable perturbed optimizer

One way of obtaining a differentiable optimizer is:
- to apply a stochastic perturbation to the parameters predicted by the ML model. 

Taking the case of expected value-based models as an example:

the key idea is that:
- although the gradient of the solution of the contextual problem with respect to the predicted parameters $ \\hat{\\boldsymbol{y}}:=g_{\\boldsymbol{\\theta}}(\\boldsymbol{x}) $ is zero almost everywhere
- if we perturb the predictor using a noise with differentiable density
- then the expectation of the solution of the perturbed contextual problem:

$ \\bar{z}^{\\varepsilon}\\left(\\boldsymbol{x}, g_{\\boldsymbol{\\theta}}\\right)=\\mathbb{E}_{\\Psi}\\left[\\tilde{z}^{\\varepsilon}\\left(\\boldsymbol{x}, g_{\\boldsymbol{\\theta}}, \\Psi\\right)\\right] $ with $ \\tilde{z}^{\\varepsilon}\\left(\\boldsymbol{x}, g_{\\boldsymbol{\\theta}}, \\Psi\\right):=\\underset{\\boldsymbol{z} \\in \\mathcal{Z}}{\\operatorname{argmin}} c\\left(\\boldsymbol{z}, g_{\\boldsymbol{\\theta}}(\\boldsymbol{x})+\\varepsilon \\Psi\\right) $

- where $ \\varepsilon>0 $ controls the amount of perturbation

and more generally of the expected cost of the associated random policy $ \\mathbb{E}_{\\Psi}\\left[H\\left(\\tilde{z}^{\\varepsilon}\\left(\\cdot, g_{\\boldsymbol{\\theta}}, \\Psi\\right), \\hat{\\mathbb{P}}_{N}\\right)\\right] $ can be shown to be smooth and differentiable. 

This idea is proposed and exploited in Berthet et al. (2020), which:
- focus on a bi-linear cost $ c(\\boldsymbol{z}, \\boldsymbol{y}):=\\boldsymbol{y}^{T} \\boldsymbol{z} $ thus simplifying $ \\mathbb{E}_{\\Psi}\\left[H\\left(\\tilde{z}^{\\varepsilon}\\left(\\cdot, g_{\\boldsymbol{\\theta}}, \\Psi\\right), \\hat{\\mathbb{P}}_{N}\\right)\\right]=H\\left(\\bar{z}^{\\varepsilon}\\left(\\cdot, g_{\\boldsymbol{\\theta}}\\right), \\hat{\\mathbb{P}}_{N}\\right) $. 

Further, they show that:

when an imitation ILO model is used 
- with a special form of Bregman divergence 

to capture the difference between $ z^{*}(\\boldsymbol{x}, \\boldsymbol{y}) $ and $ \\tilde{z}^{\\varepsilon}(\\boldsymbol{x}, \\hat{\\boldsymbol{y}}, \\Psi) $, 

the gradient of $ H_{\\text {Imitation }}\\left(\\tilde{z}^{\\varepsilon}\\left(\\cdot, g_{\\boldsymbol{\\theta}}, \\Psi\\right), \\hat{\\mathbb{P}}_{N}^{\\prime}\\right) $ can be computed directly without needing to determine the Jacobian of $ \\bar{z}^{\\varepsilon}\\left(\\boldsymbol{x}, g_{\\boldsymbol{\\theta}}\\right) $ (Blondel et al. 2020):

$ H_{\\text {Imitation }}\\left(\\tilde{z}^{\\varepsilon}\\left(\\cdot, g_{\\boldsymbol{\\theta}}, \\Psi\\right), \\hat{\\mathbb{P}}_{N}^{\\prime}\\right):=\\mathbb{E}_{\\hat{\\mathbb{P}}_{N}}\\left[\\ell_{\\mathrm{PFYL}}\\left(g_{\\boldsymbol{\\theta}}(\\boldsymbol{x}), \\boldsymbol{y}\\right)\\right] $

- $ \\ell_{\\text {PFYI }} $ is a perturbed Fenchel-Young loss (PFYL) given by:

- $ \\ell_{\\mathrm{PFYL}}(\\hat{\\boldsymbol{y}}, \\boldsymbol{y}):=\\hat{\\boldsymbol{y}}^{T} z^{*}(\\boldsymbol{x}, \\boldsymbol{y})-\\mathbb{E}_{\\Psi}\\left[(\\hat{\\boldsymbol{y}}+\\varepsilon \\Psi)^{T} \\tilde{\\boldsymbol{z}}^{\\varepsilon}(\\boldsymbol{x}, \\hat{\\boldsymbol{y}}, \\Psi)\\right]+\\varepsilon \\Omega_{\\mathrm{PFYL}}\\left(z^{*}(\\boldsymbol{x}, \\boldsymbol{y})\\right) $

- $ \\Omega_{\\mathrm{PFYL}}(\\boldsymbol{z}) $ is the Fenchel dual of $ F(\\boldsymbol{y}):=-\\mathbb{E}_{\\Psi}\\left[(\\boldsymbol{y}+\\Psi)^{T} \\tilde{z}^{\\varepsilon}(\\boldsymbol{x}, \\boldsymbol{y}, \\Psi)\\right] $. 
- The gradient of the FenchelYoung loss with respect to the model prediction is given by:
  - $ \\nabla_{\\hat{\\boldsymbol{y}}} \\ell_{\\mathrm{PFYL}}(\\hat{\\boldsymbol{y}}, \\boldsymbol{y})=z^{*}(\\boldsymbol{x}, \\boldsymbol{y})-\\overline{\\boldsymbol{z}}^{\\varepsilon}(\\boldsymbol{x}, \\hat{\\boldsymbol{y}}) $


Evaluating this gradient can be done through:

Monte Carlo evaluations by sampling perturbations and solving the corresponding perturbed problems.

Dalle et al. (2022) introduce a multiplicative perturbation: 

with the advantage that:

it preserves the sign of $ g_{\\theta}(\\boldsymbol{x}) $ without adding any bias:

$ \\tilde{\\boldsymbol{z}}^{\\varepsilon}\\left(\\boldsymbol{x}, g_{\\boldsymbol{\\theta}}, \\Psi\\right):=\\underset{\\boldsymbol{z} \\in \\mathcal{Z}}{\\operatorname{argmin}} c\\left(\\boldsymbol{z}, g_{\\boldsymbol{\\theta}}(\\boldsymbol{x}) \\odot \\exp \\left(\\varepsilon \\Psi-\\varepsilon^{2} / 2\\right)\\right) $

- $ \\odot $ is the Hadamard dot-product and the exponential is taken elementwise. 

Dalle et al. (2022) and Sun et al. (2023c) also show that: 

there is a one-to-one equivalence between the:
- perturbed optimizer approach
- and using a regularized randomized version of the CSO problem for combinatorial problems with linear objective functions. 


Finally, Dalle et al. (2022) show an intimate connection between:
- the perturbed minimizer approach proposed by Berthet et al. (2020) 
- and surrogate loss functions approaches

such as SPO+ by casting them as special cases of a more general surrogate loss formulation.

Mulamba et al. (2021) and Kong et al. (2022) consider an "energy-based" perturbed optimizer defined by its density of the form:

#### (19)

$ \\tilde{\\boldsymbol{z}}^{\\varepsilon}\\left(\\boldsymbol{x}, f_{\\boldsymbol{\\theta}}\\right) \\sim \\frac{\\exp \\left(-h\\left(\\boldsymbol{z}, f_{\\boldsymbol{\\theta}}(\\boldsymbol{x})\\right) / \\varepsilon\\right)}{\\int \\exp \\left(-h\\left(\\boldsymbol{z}^{\\prime}, f_{\\boldsymbol{\\theta}}(\\boldsymbol{x})\\right) / \\varepsilon\\right) d \\boldsymbol{z}^{\\prime}} $,

- $\\varepsilon  = 1$

This general form of perturbed optimizer:
- captures a varying amount of perturbation 
  - through $ \\varepsilon $, 
  - with $ \\tilde{\\boldsymbol{z}}^{\\varepsilon}\\left(\\boldsymbol{x}, f_{\\boldsymbol{\\theta}}\\right) $ converging in distribution to $ z^{*}\\left(\\boldsymbol{x}, f_{\\boldsymbol{\\theta}}\\right) $ as $ \\varepsilon $ goes to zero. 

They employ the negative log-likelihood to measure the divergence between:
- $ \\tilde{\\boldsymbol{z}}^{\\varepsilon}\\left(\\boldsymbol{x}, f_{\\boldsymbol{\\theta}}\\right) $
-  and the hindsight optimal solution $ z^{*}(\\boldsymbol{x}, \\boldsymbol{y}) $. 

Given the difficulties associated with calculating the partition function in the denominator of [(19)](#19), Mulamba et al. (2021) devise a surrogate loss function:
- based on noise-contrastive estimation,
-  which replaces likelihood with relative likelihood
-   when compared to a set of sampled suboptimal solutions.

This scheme is shown to improve the performance over SPO+ and DBB
- in terms of expected regret performance for linear combinatorial CSO.
- 
Based on the noise contrastive estimation approach of Mulamba et al. (2021), Mandi et al. (2022) note that:
- ILO for combinatorial problems can be viewed as a learning-to-rank problem. 

They propose surrogate loss functions,
- with closed-form expressions for gradients,
  -  that are used to train to rank feasible points in terms of performance on the downstream optimization problem. 

Unlike Mulamba et al. (2021), Kong et al. (2022) tackles the partition function challenge
- by employing a self-normalized importance sampler
  - that provides a discrete approximation. 

To avoid overfitting, the authors also introduce a regularization that :

penalizes the KL divergence between 
- the perturbed optimizer distribution 
- and a subjective posterior distribution over perturbed optimal hindsight actions $ \\mathbb{P}\\left(\\tilde{\\boldsymbol{z}}^{\\varepsilon}(\\boldsymbol{x}, \\boldsymbol{y}) \\mid \\boldsymbol{y}\\right) $ :

$ \\begin{array}{l}H_{\\text {Imitation }}\\left(\\tilde{\\boldsymbol{z}}^{\\varepsilon}\\left(\\cdot, f_{\\boldsymbol{\\theta}}\\right), \\hat{\\mathbb{P}}_{N}^{\\prime}\\right):= \\\\ \\\\ \\quad-\\mathbb{E}_{\\hat{\\mathbb{P}}_{N}}\\left[\\log \\left(\\mathbb{P}\\left(\\tilde{\\boldsymbol{z}}^{\\varepsilon}\\left(\\boldsymbol{x}, f_{\\boldsymbol{\\theta}}\\right)=z^{*}(\\boldsymbol{x}, \\boldsymbol{y})\\right) \\mid \\boldsymbol{x}, \\boldsymbol{y}\\right)\\right]+\\lambda \\mathbb{E}_{\\hat{\\mathbb{P}}_{N}}\\left[\\operatorname{KL}\\left(\\mathbb{P}\\left(\\tilde{\\boldsymbol{z}}^{\\varepsilon}(\\boldsymbol{x}, \\boldsymbol{y}) \\mid \\boldsymbol{y}\\right) \\| \\tilde{\\boldsymbol{z}}^{\\varepsilon}\\left(\\boldsymbol{x}, f_{\\boldsymbol{\\theta}}\\right) \\mid \\boldsymbol{x}, \\boldsymbol{y}\\right)\\right]\\end{array} $

The authors show that: 

their model outperforms ILO trained using SQP and cvxpylayers
- in terms of computational time

and gives lower task loss than sequential models trained using MLE and policy learning with neural networks.

### 5.5.2 Supervised learning 

Grigas et al. (2021) solve a CSO problem with a convex and nonnegative decision regularizer $ \\Omega(\\boldsymbol{z}) $ assuming that:

the uncertain parameter $ \\boldsymbol{y} $ has discrete support. 

Their model, called ICEO- $ \\lambda $, is thus trained by solving:

#### (20)

$ \\begin{array}{rll}\\text { (ICEO- } \\lambda) & \\min _{\\boldsymbol{\\theta}} & H\\left(z_{\\lambda}^{*}\\left(\\cdot, f_{\\boldsymbol{\\theta}}\\right), \\hat{\\mathbb{P}}_{N}\\right)+\\lambda \\mathbb{E}_{\\hat{\\mathbb{P}}_{N}}\\left[\\Omega\\left(z_{\\lambda}^{*}\\left(\\boldsymbol{x}, f_{\\boldsymbol{\\theta}}\\right)\\right)\\right] \\\\ & \\text { s.t. } & z_{\\lambda}^{*}\\left(\\boldsymbol{x}, f_{\\boldsymbol{\\theta}}\\right)=\\underset{\\boldsymbol{z}}{\\operatorname{argmin}} c\\left(\\boldsymbol{z}, f_{\\boldsymbol{\\theta}}(\\boldsymbol{x})\\right)+\\lambda \\Omega(\\boldsymbol{z}), \\forall \\boldsymbol{x} .\\end{array} $

The regularization:
- ensures uniqueness and Lipschitz property of $ z_{\\lambda}^{*}\\left(\\boldsymbol{x}, f_{\\boldsymbol{\\theta}}\\right) $ with respect to $ f_{\\theta} $ 
- leads to finite-sample guarantees. 

To circumvent the challenge associated with nondifferentiability of $ z_{\\lambda}^{*}\\left(\\boldsymbol{x}, f_{\\boldsymbol{\\theta}}\\right) $ with respect to $ \\boldsymbol{\\theta} $:
- they replace $ z_{\\lambda}^{*}\\left(\\boldsymbol{x}, f_{\\boldsymbol{\\theta}}\\right) $ with a smooth approximation $ \\tilde{z}_{\\lambda}\\left(\\boldsymbol{x}, f_{\\boldsymbol{\\theta}}\\right) $
  - that is learned using a random data set $ \\left(\\boldsymbol{p}_{i}, \\boldsymbol{z}_{i}\\right) $ generated by sampling $ \\boldsymbol{p}_{i} $ from the probability simplex over the discrete support 
- and then finding the optimal solution $ \\boldsymbol{z}_{i} $. 

They show asymptotic optimality and consistency of their solutions:

- when the hypothesis class is wellspecified. 

They compare their approach to other ILO pipelines and to the SLO approach that estimates the conditional distribution using cross-entropy.

Cristian et al. (2022) introduce the ProjectNet model:
- to solve uncertain constrained linear programs in an end-to-end framework
- by training an optimal policy network,
- which employs a differentiable approximation of the step of projection to feasibility.



Another approach, related to Berthet et al. (2020), that generalizes beyond LPs is given in Shah et al. (2022) that:
- constructs locally optimized decision losses (LODL)
- with supervised learning 
- to directly evaluate the performance of the predictors on the downstream optimization task. 

To learn a convex LODL for each data point:

this approach first generates labels in the neighborhood of label $ \\boldsymbol{y}_{i} $ in the training set, 
- e.g., by adding Gaussian noise, 
  
and then chooses the parameter that:
- minimizes the MSE between LODL and the downstream task loss. 

The LODL is used in place of the task-specific surrogate optimization layers 

and outperforms SLO on three resource allocation problems (linear top-1 item selection problem, web advertising, and portfolio optimization). 

The numerical experiments indicate that:
- handcrafted surrogate functions only perform better for the web advertising problem.

## 5.6 Applications 

Tian et al. (2023a) and Tian et al. (2023b) use SPOT and noise-contrastive estimation method (Mulamba et al. 2021), respectively, 

to solve the maritime transportation problem. 

A comprehensive tutorial on prescriptive analytics methods for logistics is given in Tian et al. (2023c). 

SPO has been used in solving last-mile delivery (Chu et al. 2023) and ship inspection problems (Yan et al. 2020, 2021, 2023). 

Demirović et al. (2019) and Demirović et al. (2020) minimize the same expected regret as SPO for specific applications related to ranking optimization and dynamic programming problems, respectively.


Perrault et al. (2020) solve a Stackelberg security game with the ILO framework by:
- learning the attack probability distribution over a discrete set of targets
- to maximize a surrogate for the defender's expected utility. 

They show that: their model results in higher expected utility for the defender on synthetic and human subjects data than the sequential models that learn the attack probability by minimizing the cross entropy loss. 

Wang et al. (2020) replace the large-scale optimization problem with a low dimensional surrogate by reparameterizing the feasible space of decisions. 

They observe significant performance improvements for non-convex problems compared to the strongly convex case.

Stratigakos et al. (2022) solve an integrated forecasting and optimization model
- for trading in renewable energy 

that: trains an ensemble of prescriptive trees
- by randomly splitting the feature space $ \\mathcal{X} $ based on the task-specific cost function. 

Sang et al. (2022) introduce an ILO framework for electricity price prediction for energy storage system arbitrage. 

They present a hybrid loss function 

- to measure prediction and decision errors 

and a hybrid stochastic gradient descent learning method. 

Sang et al. (2023) solve a voltage regulation problem using:
- a similar hybrid loss function, 

and backpropagation is done by 
- implicitly differentiating the optimality conditions of a secondorder cone program.

Liu et al. (2023b) use a DNN to : 
- model the routing behavior of users in a transportation network 
- and learn the parameters by minimizing the mismatch between:
  - the flow prescribed by the variational inequality
  - and the observed flow. 

The backward pass is obtained by:
- applying the IFT to the variational inequality. 

Wahdany et al. (2023) propose an integrated model for wind-power forecasting that:
- learns the parameters of a neural network to optimize the energy system costs under the system constraints.

Vohra et al. (2023) apply similar ideas to:
- develop end-to-end renewable energy generation forecasts, 

using multiple contextual sources such as satellite images and meteorological time series.

Butler and Kwon (2023b) solves the contextual mean-variance portfolio (MVP) optimization problem by:
- learning the parameters of the linear prediction model using the ILO framework. 

The covariance matrix is estimated using:
- the exponentially weighted moving average model.

They provide analytical solutions to :
- unconstrained and equality-constrained MVP optimization problems

and show that:
- they outperform SLO models based on ordinary least squares regression. 

These analytical solutions lead to lower variance when:

compared with the exact solutions of the corresponding inequality-constrained MVP optimization problem.

# 6 Active research directions

## Uncertainty in constraints. 

Most studies on contextual optimization assume that:

- there is no uncertainty in the constraints. 

If constraints are also uncertain, the SAA solutions that ignore the covariates information might not be feasible (Rahimian and Pagnoncelli 2022). 

Bertsimas and Kallus (2020) have highlighted the challenges in using ERM in a constrained CSO problem. 

Rahimian and Pagnoncelli (2022) solve a conditional chance-constrained program that :
- ensures with a high probability that the solution remains feasible under the conditional distribution 
- given the realized covariates. 

Although they do not focus on contextual optimization, interesting links can be found with the literature on constraint learning (Fajemisin et al. 2023) and inverse optimization (Chan et al. 2021).


## Risk aversion. 

There has been a growing interest in studying contextual optimization in the risk-averse setting.

Specifically, one can consider replacing the risk-neutral expectation from [(1)](#1) with a risk measure such as value-at-risk.

By doing so, one would expect, with a high probability, that:
- a decision-maker's loss is lower than a particular threshold. 

One can easily represent such a risk measure using an uncertainty set which represents the set of all possible outcomes that may occur in the future. 

The resulting uncertainty set should be carefully chosen:
- It should capture the most relevant scenarios to balance the trade-off between avoiding risks and obtaining returns. 

The recently proposed Conditional Robust Optimization (CRO) paradigm by Chenreddy et al. (2022) (see also Ohmori 2021, Sun et al. 2023b, Peršak and Anjos 2023) consists in learning a conditional set $ \\mathcal{U}(\\boldsymbol{x}) $ to solve the following problem:

### (21)

(CRO) $ \\min _{\\boldsymbol{z} \\in \\mathcal{Z}} \\max _{\\boldsymbol{y} \\in \\mathcal{U}(\\boldsymbol{x})} c(\\boldsymbol{z}, \\boldsymbol{y}) $

- where $ \\mathcal{U}(\\boldsymbol{x}) $ is an uncertainty set designed to contain with high probability the realization of $ \\boldsymbol{y} $ conditionally on observing $ x $.

Their approach solves the CRO problem sequentially where:
- $ \\mathcal{U}(\\boldsymbol{x}) $ is learned first
-  and is subsequently used to solve the downstream RO problem. 

A challenging problem is to learn the uncertainty set to minimize the downstream cost function.

## Toolboxes and benchmarking. 

Several toolboxes and packages have been proposed recently to train decision pipelines. 

Agrawal et al. (2019) provide the cvxpylayers library, which includes a subclass of convex optimization problems as differentiable layers in auto-differentiation libraries in PyTorch, TensorFlow, and JAX. 

Other libraries for differentiating non-linear optimization problems for end-to-end learning include:

higher (Grefenstette et al. 2019), JAXopt (Blondel et al. 2022), TorchOpt (Ren et al. 2022), and Theseus (Pineda et al. 2022). 

Tang and Khalil (2022) introduce an open-source software package called PyEPO (Pytorch-based End-to-End Predict-then-Optimize) implemented in Python for ILO of problems that are linear in uncertain parameters. They implement various existing methods, such as SPO+, DBB, and PFYL. 

They also include new benchmarks and comprehensive experiments highlighting the advantages of integrated learning. 

Dalle et al. (2022) provide similar tools for combinatorial problems in Julia.

Comparisons of existing approaches in fixed simulation settings are scarce, especially with realworld data. 

Buttler et al. (2022) provide a meta-analysis of selected methods on an unconstrained newsvendor problem on four data sets from the retail and food sectors. 

They highlight that there is no single method that clearly outperforms all the others on the four data sets. Mandi et al. (2023) carried out a comprehensive benchmarking of ILO frameworks tailored for expected value-based models on seven distinct problems using public datasets.

## Endogenous uncertainty. 

While there has been some progress in studying problems where the decision affects the uncertain parameters (Basciftci et al. 2021, Liu et al. 2022), the literature on decision-dependent uncertainty with covariates is sparse (Bertsimas and Kallus 2020, Bertsimas and Koduri 2022). 

An example could be:
- a facility location problem where demand changes once a facility is located in a region
- or a price-setting newsvendor problem whose demand depends on the price (Liu and Zhang 2023). 

In these problems, the causal relationship between demand and prices is unknown. 

These examples offer interesting parallels with the research on heterogeneous treatment effects
- such as Wager and Athey (2018), 
  - which introduce causal forests for estimating treatment effects and provide asymptotic consistency results. 
- Alley et al. (2023) study a price-setting problem and provide a new loss function to isolate the causal effects of price on demand from the conditional effects due to other covariates.

## Data privacy. 

Another issue is that:

- the data might come from multiple sources and contain sensitive private information, so it cannot be directly provided in its original form to the system operator. 

Differential privacy techniques (see, e.g., Abadi et al. 2016) can be used to obfuscate data but may impact predictive and prescriptive performance. 

Mieth et al. (2023) determine the data quality after obfuscation in an optimal power flow problem with a Wasserstein ambiguity set and use a DRO model to determine the data value for decision-making.

## Interpretability & explainability. 

Decision pipelines must be trusted to be implemented. 

This is evident from the European Union legislation "General Data Protection Regulation" that requires entities using automated systems to provide "meaningful information about the logic involved" in making decisions, known popularly as the "right to explanation" (Doshi-Velez and Kim 2017, Kaminski 2019). 

For instance, a citizen has the right to ask a bank for an explanation in the case of loan denial. 

While interpretability has received much attention in predictive ML applications (Rudin 2019), it remains largely unexplored in a contextual optimization, 
- i.e., prescriptive context. 

Interpretability requires transparent decision pipelines that are intelligible to users,
- e.g., built over simple models such as decision trees or rule lists. 

In contrast, explainability may be achieved with an additional algorithm on top of a black box or complex model. 

Feature importance has been analyzed in a prescriptive context by Serrano et al. (2022): 

They introduce an integrated approach that solves a bilevel program with an integer master problem optimizing (cross-)validation accuracy. 

To achieve explainability, Forel et al. (2023) adapt the concept of counterfactual explanations to explain a given data-driven decision through differences of context that make this decision optimal, or better suited than a given expert decision. 

Having identified these differences, it becomes possible to correct or complete the contextual information, if necessary, or otherwise to give explanative elements supporting different decisions. 

Another research direction could be to train tree-based models (such as optimal classification trees) to approximate the policy of a complex learning-and-optimization pipeline. 

This has interesting connections with model distillation,
- i.e., the idea in the ML community of approximating a large model by a smaller one,

and the work of Bertsimas and Stellato (2021), which learns the mapping from the problem parameters to optimal decisions through interpretable models.

## Fairness. Applying decisions based on contextual information can raise fairness issues when the context is made of protected attributes. 

This has been studied especially in pricing problems, to ensure that:
- different customers or groups of customers are proposed prices that don't differ significantly(Cohen et al. 2021, 2022).

## Finite sample guarantees for ILO. 

In Grigas et al. (2021), the authors derive finite-sample guarantees for ILO under the assumption of discrete support for the uncertain parameter. 

An open problem is to derive generalization bounds on the performance of ILO models for non-linear problems where the uncertain parameters have continuous support.

## Correcting for in-sample bias of data-driven optimization. 

When devising an optimal policy based on a finite number of samples, it is desired that low in-sample risk translates to low out-of-sample risk. 

However, decision rule optimization in [(4)](#4) or learning and optimization model in [(5)](#5) are known to produce optimistically biased estimates of the true expected cost of the prescribed policy (Ban and Rudin 2019, Costa and Iyengar 2023, Gupta et al. 2022). 

While one can replace this estimation with an unbiased one
- if data was reserved for this purpose,

this is usually considered a wasteful use of data
- given that it could instead have been used to obtain a better-performing policy. 

Recent research has identified ways of circumventing this issue by estimating and correcting for the in-sample bias in contextual (Gupta et al. 2022) and non-contextual (Ito et al. 2018, Gupta and Rusmevichientong 2021, Iyengar et al. 2023) stochastic optimization problems
- under the assumption that errors in the estimation of uncertain parameters are normally distributed. 

In addition to correcting the bias using Stein's lemma, Gupta and Rusmevichientong (2021) show that :

- certain "Bayes-inspired" and regularized policies achieve the same performance as optimal in-sample policy in small-data large-scale regimes.

A promising future research direction could be:

to build a general framework to learn the insample policies that :

- directly minimize the debiased objective functions. 

In this regard, one might find inspiration from the work of Gupta and Rusmevichientong (2021) addressing a similar issue in the non-contextual setting.

## Multi-agent decision-making. 

A multi-agent perspective becomes necessary in transportation and operations management problems, - where different agents have access to different sources of information (i.e. covariates). 

In this regard, some recent work by Heaton et al. (2022) identifies the Nash equilibrium of contextual games using implicit differentiation of variational inequalities and jacobian-free backpropagation.

## Costly label acquisition. 

In many applications, it is costly to gather observations of uncertain vectors and covariate pairs. 

For instance, in personalized pricing, surveys can be sent to customers to obtain information on the sensitivity of purchasing an item with respect to its price. 

However, creating, sending, and collecting the surveys may have a cost. 

Liu et al. (2023a) develop an active learning approach to obtain labels to solve the SPO problem, 
- while the more general case of developing active learning methods for non-linear contextual optimization is an interesting future direction. 

Besbes et al. (2023) provide theoretical results on the trade-off between the quality and quantity of data in a newsvendor problem, thus guiding decision-makers on how to invest in data acquisition strategies.

## Multi-stage contextual optimization. 

Most works on contextual optimization focus on single and two-stage problems. 

Ban et al. (2019) and Rios et al. (2015) use the residuals of the regression model to build multi-stage scenario trees and solve multi-stage CSO problems. 

Bertsimas et al. (2023) generalize the weighted SAA model for multi-stage problems. 

Qi et al. (2023) propose an end-to-end learning framework to solve a real-world multistage inventory replenishment problem.

## sequential decision-making with uncertainty. 

Inverse reinforcement learning (Ng et al. 2000) focuses on learning rewards that are consistent with observed trajectories. 

In the econometrics literature on dynamic discrete choice modeling the focus lies more broadly on estimating structural parameters of Markov decision processes (MDPs) (Rust 1988, Aguirregabiria and Mira 2010) including rewards, transition functions and discount factors. 

On both topics, estimates are typically obtained through MLE employing a soft version of the Bellman operator (e.g., Rust 1987, Ziebart et al. 2008).

In the context of model-based reinforcement learning, so-called decision awareness 
- (i.e. explicitly training components of a reinforcement learning system to help the agent improve the total amount of collected reward, Nikishin et al. 2022b) 
is receiving increasing attention (e.g., Joseph et al. 2013, Farahmand et al. 2017, Farahmand 2018, Grimm et al. 2020). 

For example, Nikishin et al. (2022a) introduce an approach that combines learning and planning to optimize expected returns for both tabular and non-tabular MDPs. 

They employ the soft version of the Bellman operator for efficient parameter learning using the IFT and show that:
- their state-action value function has a lower approximation error than that of MLE in tabular MDPs.

---

Another interesting research direction is to challenge the assumption that: 

the joint distribution of the covariate and uncertain parameters is stationary. 

Neghab et al. (2022) study a newsvendor model with a hidden Markov model underlying the distribution of the covariates and demand.

---

Finally, an area that requires attention is the deployment of models for real-world applications 

- by tackling computational hurdles associated with decision-aware learning in MDPs, 

- such as large state-action pairs and high-dimensional policy spaces (Wang et al. 2023). 

An example is a service call scheduling problem 
- that is formulated as a restless multi-armed bandit (RMAB) problem in Mate et al. (2022) 
- to improve maternal and child health in a non-profit organization. 

They model each beneficiary as an arm, apply a clustering method to learn the dynamics, 

and then use the Whittle Index policy to solve the RMAB. 

Wang et al. (2023) use decision-focused learning to solve RMAB,
- where the computational difficulty in differentiating the Whittle index policy of selecting the top-k arms, 
- is mitigated by making a soft-top-k selection of arms which is an optimal transport problem (Xie et al. 2020).



placeholder

placeholder

placeholder

placeholder

placeholder

`,__vite_glob_0_14=`---
title: Business Paper - Week 6
---

# Crowdsourcing Exploration 

Suppose in market:

$A, B$: Two providers

$S = \\{A,B\\}$

$p_i,i\\in S$: provider's service quality 

$
\\begin{cases}
1, &w.p.\\quad p_i \\\\ 
0, &w.p.\\quad 1-p_i 
\\end{cases}
$: consumer receive reward

$p_i$ is known to designer and consumers
- a common prior belief
- $\\text{Beta}\\{s_1^i,f_1^i\\}, s_1^i,f_1^i\\in \\mathbb Z_+$

--- 

Progress:

1. at beginning of $t\\in T, T= \\{ 1, 2, \\dots\\}$: consumer visit the platform, observe information pretaining to experience of past consumers, choose provider 

2. Complete service, before the end of $t$, report positive or negative 

$x_t = \\{x_t^A,x_t^B\\}$: information state
- $ x_{t}^{i}=\\left\\{s_{t}^{i}, f_{t}^{i}\\right\\} $
- $s_t^i$: accumulated number of successful service outcomes for provider $i$ up to period $t$ 

$Beta(s_t^i,f_t^i)$:Bayesian posterior belief when system state is $x_t$

$ r\\left(x_{t}, i\\right)=\\frac{s_{t}^{i}}{s_{t}^{i}+f_{t}^{i}} $ :  the expected reward of the next customer to use provider $i$

---

History: not observable
- "message policy"

Designer's objective:
- maximize the expected sum of consumers’ discounted rewards over an infinite horizon
- applying a discount factor of $\\delta\\in [0,1)$

# 4. Analysis Preliminaries

## Equilibrium and Model Dynamics

Two main feature
- messaging policy
- choice strategy

$X\\in\\mathbb Z_+^4$: possible states of platform 
- s.t. $x_t\\in X, \\forall t\\in T$

$M$: feasible message in period $t$

$g(\\cdot)$: messaging policy, $X\\to M$

$\\mathcal G$: possible polices 

$c_t(\\cdot)$: period-$t$ consumer's choice strategy 
- $M\\to S$

$S$: service 

$\\mathcal C_t$: possible strategies for period-$t$ consumer 

$c(\\cdot) :=[c_1(\\cdot),c_2(\\cdot),\\dots]$

--- 

Controlled Markov chain: $g, c$
- $\\{(x_t,y_t);t\\in T\\}$: state-action pair 

$y_t = c_t(g(x_t))$

$r(x_t,i) = \\dfrac{s_t^i}{s_t^i+f_t^i}$: reward 

The state in period $t+1$:

$ x_{t+1}^{i}=x_{t}^{i} $ for $ i \\neq y_{t}, \\quad x_{t+1}^{i}=\\left\\{\\begin{array}{l}\\left\\{s_{t}^{i}+1, f_{t}^{i}\\right\\} \\text { w.p. } r\\left(x_{t}, i\\right) \\\\ \\left\\{s_{t}^{i}, f_{t}^{i}+1\\right\\} \\text { w.p. } 1-r\\left(x_{t}, i\\right)\\end{array} \\quad\\right. $ for $ i=y_{t} $.

--- 

Sequence:

2. Consumer observe policy, choose strategy $c_t$ to maximize reward 

period-$t$ to message $m$, $c_t^*(m)$ maximize:

$ E_{x_{t}}\\left[r\\left(x_{t}, c_{t}\\right) \\mid g\\left(x_{t}\\right)=m\\right] $
 

1. At beginning, designer commit policy that maximize dscounted rewards. $g^(x_t)$ maximizes:

$ E\\left[\\sum_{t \\in T} \\delta^{t-1} r\\left(x_{t}, y_{t}\\right)\\right] $, for $ y_{t}=c_{t}^{*}\\left(g\\left(x_{t}\\right)\\right) $

## Incentive-Compatible Recommendation Policies

### Definition 1 (ICRP: Incentive-Compatible Recommendation Policy) 

> A recommendation policy:
>
> #### (1)
>
> $ g\\left(x_{t}\\right)=\\left\\{\\begin{array}{ll}A & \\text { w.p. } \\quad q_{x_{t}} \\\\ B & \\text { w.p. } 1-q_{x_{t}}\\end{array}\\right. $
>
> - $q_{x_t}\\in[0,1],\\forall x_t\\in X$
> - It's incentive-compatible, if:
>   - $c_t^*(g(x_t))=g(x_t),\\forall x_t\\in X, t\\in T$


### Lemma 1

> For any arbitrary messaging policy $g$, there exists an $ICRP$ $g'$ which induces a $DOE$ equilibrium in the game between the designer and the consumers.

---

Examples:

## First Best 

The Gittins index for service $ i $ when in state $ z^{i} $ is denoted by $ G_{i}\\left(z^{i}\\right) $ and given by

#### (2)

$
G_{i}\\left(z^{i}\\right)=\\sup _{\\tau>0} \\frac{E\\left[\\sum_{t=0}^{\\tau-1} \\delta^{t} r\\left(x_{t}^{i}, i\\right) \\mid x_{0}^{i}=z^{i}\\right]}{E\\left[\\sum_{t=0}^{\\tau-1} \\delta^{t} \\mid x_{0}^{i}=z^{i}\\right]},
$

- $\\tau$: past-measurable stopping time 
- $r(x_t^i,i)$: instantaneous expected reward of provider $i$ in state $x_t^i$

# 5 Simple Case: Incumbent Provider $B$

Setting:

$A$ quality is ex ante unknown 

$B$ is known 

$Beta(s_1^A,f_1^A)$: $A$'s service 

$r(x_t,A)=\\dfrac{s_t^A}{s_t^A+f_t^A}$: reward on sercive $A$ in period $t$

$r_B = r(x_t,B) = p_B$

## 5.1 First Best 

$B$ has constant Gittins index:

$G_B := G_B(x_t) = r_B$

For $A$:

### Lemma 2

> System-optimal provider choices are characterized as follows:
>
> (i) If $ G_{A}\\left(x_{1}\\right) \\leq G_{B} $, then any experimentation with service $ A $ is suboptimal; 
> that is, it is systemoptimal to use service $ B $ in all periods $ t \\in T $.
>  
> (ii) If $ G_{A}\\left(x_{1}\\right)>G_{B} $, then it is system-optimal to experiment with service $ A $ at least once in period $ t=1 $. In any period $ t>1 $, there exists an integer $ s^{*}(t) $ such that if $ s_{t}^{A} \\geq s^{*}(t) $ it is system-optimal to continue experimentation with service $ A $ in period $ t $, while if $ s_{t}^{A}<s^{*}(t) $ it is system-optimal to choose service $ B $ in period $ t $ and forever after. The period-t threshold $ s^{*}(t) $ is uniquely defined by:
>
> $ s^{*}(t)=\\left\\{\\min s_{t}^{A}: s_{t}^{A}, f_{t}^{A} \\in \\mathbb{Z}_{+}^{2},\\left(s_{t}^{A}-s_{1}^{A}\\right)+\\left(f_{t}^{A}-f_{1}^{A}\\right)=t-1, G_{A}\\left(x_{t}\\right)>G_{B}\\right\\} $

## 5.2 The Two Extreme Modes of Information Provision 

- NI: No information 
- FI: Full information 

### Lemma 3

> Consumers' choice under FI:
>
> (i) If $ r\\left(x_{1}, A\\right) \\leq r_{B} $, then consumers choose service $ B $ in all periods $ t \\in T $.
> 
> (ii) If $ r\\left(x_{1}, A\\right)>r_{B} $, then the period-1 consumer chooses service $ A $. In any period $ t>1 $, there exists an integer $ \\bar{s}(t) $ such that if $ s_{t}^{A} \\geq \\bar{s}(t) $ the period- $ t $ consumer chooses service $ A $, while if $ s_{t}^{A}<\\bar{s}(t) $ service $ B $ is chosen in period $ t $ and forever after. The period-t threshold $ \\bar{s}(t) $ is uniquely defined by
> 
> $\\bar{s}(t)=\\left\\{\\min s_{t}^{A}: s_{t}^{A}, f_{t}^{A} \\in \\mathbb{Z}_{+}^{2},\\left(s_{t}^{A}-s_{1}^{A}\\right)+\\left(f_{t}^{A}-f_{1}^{A}\\right)=t-1, r\\left(x_{t}, A\\right)>r_{B}\\right\\}$

### Lemma 4

> The thresholds $ s^{*}(t) $ and $ \\bar{s}(t) $ satisfy $ s^{*}(t) \\leq \\bar{s}(t) $

### Example 1

> Assume $A$ is $Beta(1,1)$
> $B$ is $0.27$
> $\\delta = 0.9$
> After $2$ negative in $A$, everyone choose $B$

---

### Proposition 1

> Denote by $ \\pi^{N I} $ and $ \\pi^{F I} $ the platform's expected payoff under policies belonging to the NI and FI regimes, respectively. Then
>
> $\\pi^{N I} \\leq \\pi^{F I} \\leq \\pi^{*}$
>
> where $ \\pi^{*} $ denotes the platform's first-best expected payoff.

## 5.3 Strategic Information Provision

### Proposition 2

> For initial system state $ x_{1} $, let $ g^{*} $ be an optimal messaging policy and denote by $ \\pi\\left(g^{*}\\right) $ the platform's expected payoff under policy $ g^{*} $. Then $ \\pi\\left(g^{*}\\right)=\\pi^{*} $, unless both $ r\\left(x_{1}, A\\right) \\leq r_{B} $ and $ G_{A}\\left(x_{1}\\right)>G_{B} $ hold.

Table 1
$
\\begin{array}{cccc}
x_{4}^{A}=\\left(s_{4}^{A}, f_{4}^{A}\\right) & P\\left(x_{4}^{A}\\right) & \\text{consumer prefers} & \\text{designer prefers} \\\\
\\hline \\hline
(4,1) & 0.25 & \\mathrm{A}\\left(r_{A}=0.8\\right) & \\mathrm{A}\\left(G_{A}=0.87\\right) \\\\
(3,2) & 0.25 & \\mathrm{A}\\left(r_{A}=0.6\\right) & \\mathrm{A}\\left(G_{A}=0.71\\right) \\\\
(2,3) & 0.25 & \\mathrm{A}\\left(r_{A}=0.4\\right) & \\mathrm{A}\\left(G_{A}=0.52\\right) \\\\
(1,4) & 0.25 & \\mathrm{B}\\left(r_{A}=0.2\\right) & \\mathrm{A}\\left(G_{A}=0.30\\right)
\\end{array}
$

How to make $(1,4)$ customer choose $A$?

$
(4,1)\\} m_{1} \\\\ (3,2)\\} m_{2}
$

$ \\left.\\begin{array}{l} (2,3) \\\\ (1,4)\\end{array}\\right\\} m_{3} 
$

Then for $m_3$, $r = \\dfrac{1}{2}\\cdot 0.4 + \\dfrac{1}{2}\\cdot 0.2 =0.3 > 0.27$ 

## 5.4 Comments 

### Commitment vs. Cheap Talk 

When talk with period-$t$ customer:

- if recommend $B$:
  - $G_B>G_A$
  - $r_B>r_A$

### Information vs. Payments

Sometimes only information can't achieve **First Best **

# 6 General Case 

Both is ex ante unknown 

$r(x_1, A)\\ge r(x_1, B)$

### Proposition 3

> For initial system state $ x_{1} $, let $ g^{*} $ be an optimal messaging policy. Then $ \\pi\\left(g^{*}\\right)= $ $ \\pi^{*} $ if and only if there exists an ICRP which recommends service $ B $ whenever $ G_{B}\\left(x_{t}\\right)>G_{A}\\left(x_{t}\\right) $.

### Example 2

> $A$: $Beta(10,2)$
> $B$: $Beta(2,2)$
> $\\delta = 0.99$
>
> Notice: if $A$ fails in $t = 1 $ to $t=4$, consumer will still choose $A$, even if $B$ may be better

## 6.1 Optimal ICRPs

We need to choose best $q_{x_t}$ such that:


$ g\\left(x_{t}\\right)=\\left\\{\\begin{array}{ll}A & \\text { w.p. } \\quad q_{x_{t}} \\\\ B & \\text { w.p. } 1-q_{x_{t}}\\end{array}\\right. $

Then we need:

#### (4)

$ \\begin{array}{r}\\qquad \\max _{g\\left(x_{t}\\right)} E\\left[\\sum_{t \\in T} \\delta^{t-1} r\\left(x_{t}, g\\left(x_{t}\\right)\\right)\\right] \\\\ \\text { s.t. } E_{x_{t}}\\left[r\\left(x_{t}, A\\right) \\mid g\\left(x_{t}\\right)=A\\right] \\geq E_{x_{t}}\\left[r\\left(x_{t}, B\\right) \\mid g\\left(x_{t}\\right)=A\\right], \\quad \\forall t \\in T, \\\\ E_{x_{t}}\\left[r\\left(x_{t}, B\\right) \\mid g\\left(x_{t}\\right)=B\\right] \\geq E_{x_{t}}\\left[r\\left(x_{t}, A\\right) \\mid g\\left(x_{t}\\right)=B\\right], \\quad \\forall t \\in T,\\end{array} $

- every $t$ is IC 

We introduce some notation to deal with it:

$X_t$:  the set of states that are reachable from the initial state $x_1$ in period $t$

$ X=\\bigcup_{t \\in T} X_{t} $: total state space 

$\\mathcal P_{kiz}$: transition probability from $k$ through $i$ to $z$

$\\Delta_a$: Dirac delta function concentrated at $a$

### Proposition 4

> The optimal ICRP is given by:
>
> $ q_{k}^{*}=\\frac{\\rho(k, A)}{\\sum_{i \\in S} \\rho(k, i)} $
>
> where $\\rho(k,i)$ solves:
>
> $ \\begin{array}{rlr}\\max _{\\rho} & \\sum_{k \\in X} \\sum_{i \\in S} \\rho(k, i) r(k, i) & \\\\ \\text { s.t. } & \\sum_{k \\in X_{t}} \\rho(k, B)[r(k, B)-r(k, A)] \\geq 0, & \\forall t \\in T, \\\\ & \\sum_{k \\in X} \\sum_{i \\in S} \\rho(k, i)\\left(\\Delta_{z}(k)-\\delta \\mathcal{P}_{k i z}\\right)=\\Delta_{x_{1}}(z), & \\forall z \\in X, \\\\ & \\rho(k, i) \\geq 0, & \\forall k \\in X, i \\in S .\\end{array} $

Note:

- $\\rho$: the flow weight
  - constrain 1: make sure when recommend $B$, it's better 
  - constrain 2: make sure the flow is balance 
  - constrain 3: the flow is non-negative 

## 6.2 The Value of Information Obfuscation

$p_{x_t}$: the probability that state in period $t$ is $x_t$

First, we solve period-$t$ LP:

#### (6)

$ \\begin{array}{rlr}\\max _{\\rho} & \\sum_{k \\in X} \\sum_{i \\in S} \\rho(k, i) r(k, i) & \\\\ \\text { s.t. } & \\sum_{k \\in X_{t}} \\rho(k, B)[r(k, B)-r(k, A)] \\geq 0, & \\forall t \\in T, \\\\ & \\sum_{k \\in X} \\sum_{i \\in S} \\rho(k, i)\\left(\\Delta_{z}(k)-\\delta \\mathcal{P}_{k i z}\\right)=\\Delta_{x_{1}}(z), & \\forall z \\in X, \\\\ & \\rho(k, i) \\geq 0, & \\forall k \\in X, i \\in S .\\end{array} $

Then, store $q_{x_t}$
- designer’s recommendation policy for period $t$

Then, use $p_{x_t}$ to calculate $p_{x_{t+1}}$

Until: $t=K$ is reached 

# 7 Extensions 

## 7.1 Imperfect Knowledge of Consumers' Arrival Times 

### Proposition 5

> Let $g\\ g(^*)$  denote an ICRP (the optimal ICRP) when consumers have perfect knowledge of their arrival times. Then:
>
> (i) $ g $ remains an ICRP under any arbitrary belief held by consumers over their arrival times.
> 
> (ii) If $ v^{*} $ is an optimal ICRP under a specific set of consumer beliefs, we have $ \\pi\\left(v^{*}\\right) \\geq \\pi\\left(g^{*}\\right) $.

## 7.2 Combining Information with Monetary Subsidies

The designer can choose for each message $ m \\in M $ used in period $ t $ an accompanying subsidy plan $ \\left\\{\\kappa_{t}^{i}(m)\\right\\}_{i \\in S} $, where the subsidy $ \\kappa_{t}^{i}(m) \\geq 0 $ can be claimed by the consumer if she chooses to use provider $ i $.

### Definition 2 (ICRSP: Incentive-Compatible Recommendation-with-Subsidies Policy)

> A recommendation-with-subsidies policy is a messaging-with-subsidies policy defined as:
> 
> #### (7)
> 
> $ v\\left(x_{t}\\right)=\\left\\{\\begin{array}{ll}A,\\left\\{\\kappa_{t}^{i}(A)\\right\\}_{i \\in S} & \\text { w.p. } \\quad q_{x_{t}} \\\\ B,\\left\\{\\kappa_{t}^{i}(B)\\right\\}_{i \\in S} & \\text { w.p. } 1-q_{x_{t}}\\end{array}\\right. $
>
> where $ q_{x_{t}} \\in[0,1] $ for all $ x_{t} \\in X $, and $ \\kappa_{t}^{i}(j)=0 $ for all $ i, j \\in S, i \\neq j $. A recommendation-withsubsidies policy is said to be incentive-compatible if for all $ x_{t} \\in X $, each period- $ t $ consumer follows the recommendation she receives.

#### Proposition 6

> For any arbitrary messaging-with-subsidies policy $ v $, there exists an ICRSP $ v^{\\prime} $ which achieves a (weakly) higher expected platform payoff.

### Example 3

> $ A $ is $ \\operatorname{Beta}(5,5) $
> $ B $ has a known quality of $ r_{B}=0.53 $ 
> 
> the ex ante preferable provider for the consumers is $ B $. 
> 
> Consider the minimum total subsidies required to induce exploration of provider $ A $ in the first two periods under a FI policy versus under an ICRSP. 
> 
> In the first period, for the customer to choose provider $ A $, both policies must offer a minimum subsidy of $ \\kappa_{1}^{A}=p_{B}-r\\left(x_{1}, A\\right)=0.53-0.5=0.03 $ (i.e., assuming $ \\kappa_{1}^{B}=0 $ ). 
> 
> However, in the second-period: 
> 
> (i) Under FI, the state $ x_{2} $ is disclosed to the period- 2 consumer and a minimum subsidy $ \\kappa_{2}^{A}\\left(x_{2}\\right)= $ $ \\max \\left\\{p_{B}-r\\left(x_{2}, A\\right), 0\\right\\} $ must be offered in order for the consumer to choose provider $ A $. 
> 
> If the period- 1 trial was successful (occurs w.p. 0.5 ), then $ \\kappa_{2}^{A}=\\max \\{0.53-0.55,0\\}=0 $. If the period-1 trial was unsuccessful (occurs w.p. 0.5), then $ \\kappa_{2}^{A}=\\max \\{0.53-0.45,0\\}=0.08 $. 
> 
> Thus, the ex ante expected period- 2 subsidy is $ E\\left[\\kappa_{2}^{A}\\left(x_{2}\\right)\\right]=0.5 \\times 0.08=0.04 $. 
> 
> (ii) Under an ICRSP, the designer in period 2 recommends provider $ A $ irrespective of the period-1 outcome. 
> 
> For this recommendation to be incentive-compatible, it must be accompanied by a subsidy of $ \\kappa_{2}^{A}(A)=\\max \\left\\{p_{B}-E\\left[r\\left(x_{2}, A\\right)\\right], 0\\right\\}=\\max \\{0.53-(0.5 \\times 0.55+0.5 \\times 0.45), 0\\}=0.03 $. 
> 
> Thus, in the above example, the ICRSP achieves the same consumer actions in the first and second periods as a FI-with-subsidies policy, but at a $ 25 \\% $ lower subsidy cost.

`,__vite_glob_0_15=`---
title: Business Paper - Week 7
---

$x$: Covariates 

$y$: Walk-in 

$z$: time period opened 

---

The helper function:

$D\\left( (x,z), (x^i,z^i) \\right) = \\alpha_1 \\cdot d_{\\text{time}}(x,x^i) + \\alpha_2 \\cdot \\frac{|z - z^i|}{z_{\\text{max}}}$
- $(x,z)$: the "covariate, decision" pair 
- $(x^i, z^i)$: the $i$-th data 
- $d_{\\text{time}}: $ the distance between $x$

To simulate the distribution of $y$:

$\\hat{Y}(z|x) = \\sum_{i=1}^N w_i(x,z) \\cdot y^i$

Where:

$w_i(x,z) = \\frac{1}{D\\left( (x,z), (x^i,z^i) \\right) + \\epsilon} \\cdot \\mathbb{I}\\left[ (x^i,z^i) \\in \\text{TopK}(D) \\right]$

- $\\epsilon$: in case the denominator is $0$


---

Service speed:

$v(Y) = v_0 + \\gamma Y$

Wait cost:

$W(Y) = \\dfrac{Y}{v(Y)} = \\dfrac{Y}{v_0+\\gamma Y}$

Cost function:

$c(z,Y(z)) = C_1\\cdot W(\\hat{Y}(z|x) ) + C_2 z $
$c(z,Y(z)) = C_1\\cdot W(\\hat{Y}(z|x) ) + C_2 z $



Get distribution:

$\\argmin_{w_i}c(z,Y(z))$

Get decision:

$z^*(x) = \\argmin_{z\\in\\mathcal Z}\\mathbb E[c(z;Y(z))\\mid X=x]$

`,__vite_glob_0_16=`---
title: Business Paper - Week 8
---

# 3 Predicting Delivery Time 

#### (1)

$DeliveryTime  _{i}=  Distance  _{i}+\\epsilon_{i}$


#### (2)

$DeliveryTime  _{i}=  Workload  _{i}+  Workload  _{i}^{1 / 2}+  Distance  _{i}+\\epsilon_{i}$

#### (3)

$DeliveryTime  _{i k}=\\eta_{k}+  Workload  _{i k}+  Workload  _{i}^{1 / 2}+  Distance  _{i k}+\\epsilon_{i k} $

# 4 Courier Assigned Location Mismatch (CALM) Metric

$M$: territories 

$d_{ij}$: distance 

$\\boldsymbol \\zeta\\in\\mathbb R_+^M$: current assigned location vector

$\\zeta_i$: number of customers in $i$

$\\boldsymbol \\xi\\in\\Delta^M$: prior assigned location vector 
- $\\Delta^M:=\\{\\boldsymbol \\xi\\in\\mathbb R_+^M:\\boldsymbol 1^\\top\\boldsymbol \\xi = 1\\}$

$\\xi_j$: proportion of past assignments to zone $j$

- $\\boldsymbol  \\xi=\\boldsymbol{\\zeta} / \\mathbf{1}^{\\top} \\boldsymbol{\\zeta} $: assigned location = past assignments

### Definition 1 (Creterion of Courier Assigned Location Mismatch Metric)

> $ \\rho(\\boldsymbol{\\zeta}, \\boldsymbol{\\xi}): \\mathbb{R}_{+}^{M} \\times \\Delta^{M} \\rightarrow \\mathbf R_+$
>
> It satisfies:
>
> (a) **Matched Assignment**
>
> For any $ \\boldsymbol{\\zeta} \\in \\mathbb{R}_{+}^{M}, \\boldsymbol{\\xi} \\in \\Delta^{M} $ : 
> 
> $ \\rho(\\boldsymbol{\\zeta}, \\boldsymbol{\\xi})=\\mathbf{0} $ if and only if $ \\boldsymbol{\\zeta}=\\boldsymbol{\\xi} \\cdot \\mathbf{1}^{\\top} \\boldsymbol{\\zeta} $
>
> (b) **Basic Location Mismatch**
>
> For any $ i, j \\in[M] $ : 
>
> $\\rho\\left(\\boldsymbol{e}_{i}, \\boldsymbol{e}_{j}\\right)=d_{i j}$
>
> (c) **Positive Homogeneous**
>
> For any $ \\boldsymbol{\\zeta} \\in \\mathbb{R}_{+}^{M}, \\boldsymbol{\\xi} \\in \\Delta^{M}, \\alpha>0 $ :
>
> $\\rho(\\alpha \\boldsymbol{\\zeta}, \\boldsymbol{\\xi})=\\alpha \\rho(\\boldsymbol{\\zeta}, \\boldsymbol{\\xi}) .$
>
> (d) **Sub-additive**
>
> For any $ \\boldsymbol{\\zeta}_{1}, \\boldsymbol{\\zeta}_{2} \\in \\mathbb{R}_{+}^{M}, \\boldsymbol{\\xi} \\in \\Delta^{M} $ : 
>
> $\\rho\\left(\\boldsymbol{\\zeta}_{1}+\\boldsymbol{\\zeta}_{2}, \\boldsymbol{\\xi}\\right) \\leq \\rho\\left(\\boldsymbol{\\zeta}_{1}, \\boldsymbol{\\xi}\\right)+\\rho\\left(\\boldsymbol{\\zeta}_{2}, \\boldsymbol{\\xi}\\right) $

### Definition 2(The $\\ell_p$-Based CALM Metric)

> For given $ p \\in[1, \\infty) $, we define the $ \\ell_{p} $-based CALM metric as the following function $ \\rho(\\boldsymbol{\\zeta}, \\boldsymbol{\\xi}): \\mathbb{R}_{+}^{M} \\times \\Delta^{M} \\rightarrow \\mathbb{R}_{+} $,
>
> #### (4)
>
> $\\begin{array}{rlr} \\rho(\\boldsymbol{\\zeta}, \\boldsymbol{\\xi})=\\min & \\left(\\sum_{i \\in[M] j} \\sum_{j \\in[M]}\\left(d_{i j} s_{i j}\\right)^{p}\\right)^{1 / p} & \\\\ \\text { s.t. } & \\sum_{i \\in[M]} s_{i j}=\\xi_{j} \\mathbf{1}^{\\top} \\boldsymbol{\\zeta} & \\forall j \\in[M] \\\\ & \\sum_{j \\in[M]} s_{i j}=\\zeta_{i} & \\forall i \\in[M] \\\\ & \\boldsymbol{s} \\geq \\mathbf{0} . & \\end{array}$

### Theorem 1

> The $ \\ell_{p} $-based CALM metric satisfies the properties of the assigned location mismatch metric for all $ p \\in[1, \\infty] $

# 5 The Service Oriented Routing (SOR) Model 


$ \\mathcal{G}=(\\{0\\} \\cup[N], \\mathcal{A}) $: a completed directed graph 
- node 0 represents the depot 
- $ \\mathcal{A}=\\{(i, j) \\mid i, j \\in\\{0\\} \\cup[N], i \\neq j\\} $ is the arc set. 

$ n $: Each customer node 

$ q_{n} $: demand  

$ c_{a} $: travel distance. each arc $ a \\in A $ has a travel distance . 

$ Q $: Capacity. Each courier has a capacity. 

For a subset $ \\mathcal{S} \\subseteq[N] $, 

$ \\mathcal{A}^{+}(\\mathcal{S})=\\{(i, j) \\in \\mathcal{A} \\mid i \\in \\mathcal{S}, j \\notin \\mathcal{S}\\} $ 

$ \\mathcal{A}^{-}(\\mathcal{S})=\\{(i, j) \\in \\mathcal{A} \\mid i \\notin \\mathcal{S}, j \\in \\mathcal{S}\\} $. 

$ \\boldsymbol{x}_{k}=\\left(x_{k 1}, \\cdots, x_{k N}\\right) \\in\\{0,1\\}^{N} $: the assignment of customer nodes to courier $ k $, 

- $ x_{k n}=1 $ if node $ n $ is served by courier $ k $ 
- $ x_{k n}=0 $ otherwise. 

For each $ k \\in[K] $: 

$ \\boldsymbol{y}_{k}=\\left(y_{k a}\\right)_{a \\in \\mathcal{A}} \\in\\{0,1\\}^{|\\mathcal{A}|} $, 
- $ y_{k a}=1 $ if courier $ k $ travels from along arc $a$
- $y_{ka} = 0$ otherwise 

The constraint for the routing problem is defined by:

$ \\mathcal{X}=\\left\\{\\begin{array}{l|ll}\\left(\\boldsymbol{x}_{k}, \\boldsymbol{y}_{k}\\right)_{k \\in[K]} & \\begin{array}{ll}\\sum_{k \\in[K]} x_{k n}=1 & \\forall n \\in[N] \\\\ \\sum_{\\left.a \\in \\mathcal{A}^{+}+\\{0\\}\\right)} y_{k a}=\\sum_{a \\in \\mathcal{A}^{-}(\\{0\\})} y_{k a}=1 & \\forall k \\in[K] \\\\ \\sum_{a \\in \\mathcal{A}^{+}(\\{n\\})} y_{k a}=\\sum_{a \\in \\mathcal{A}^{-}(\\{n\\})} y_{k a}=x_{k n} & \\forall n \\in[N], k \\in[K] \\\\ \\sum_{a \\in \\mathcal{A}^{+}(\\mathcal{S})} y_{k a} \\geq x_{k n} & \\forall n \\in \\mathcal{S}, \\mathcal{S} \\subseteq[N], k \\in[K] \\\\ \\sum_{n \\in[N]} q_{n} x_{k n} \\leq Q & \\forall k \\in[K] \\\\ \\boldsymbol{x}_{k} \\in\\{0,1\\}^{N}, \\boldsymbol{y}_{k} \\in\\{0,1\\}^{|\\mathcal{A}|} & \\forall k \\in[K]\\end{array}\\end{array}\\right\\} $

- all the nodes are served
- every courier is used 
- whether a node is served by a particular courier
- subtour elimination
-  capacity constraints of the couriers

$ \\mu\\left(\\boldsymbol{y}_{k}\\right) $ to denote the routing distance for courier $k$

$ \\mu\\left(\\boldsymbol{y}_{k}\\right)=\\sum_{a \\in \\mathcal{A}} c_{a} y_{k a} $

- $ c_{a} $ is the travel distance along arc $ a \\in \\mathcal{A} $.

---

$N$: customers

$\\boldsymbol x\\in\\{0,1\\}^N$: decision variable

- $n$ is selected if $x_n = 1$

$ \\mathbf{1}^{\\top} \\boldsymbol{x} \\in\\{0,1, \\cdots, L-1\\} $,: Total workload 
- $L-1$: maximum workload 

$ g\\left(\\boldsymbol{w}_{L}, \\boldsymbol{x}\\right):=\\sum_{\\ell \\in[L]} w_{\\ell} \\delta_{\\ell}(\\boldsymbol{x}) $: generic workload dependency function 

- $ \\boldsymbol{w}_{L}:=\\left(w_{1}, \\ldots, w_{L}\\right) $
- #### (7)
- $ \\delta_{\\ell}(\\boldsymbol{x}):=\\left\\{\\begin{array}{l}1 \\text { if } \\mathbf{1}^{\\top} \\boldsymbol{x}=\\ell-1 \\\\ 0 \\text { otherwise }\\end{array}, \\quad \\forall \\ell \\in[L]\\right. $

$ \\hat{\\beta}_{1}+\\hat{\\beta}_{2}\\left(\\mathbf{1}^{\\top} \\boldsymbol{x}\\right)+\\hat{\\beta}_{3}\\left(\\mathbf{1}^{\\top} \\boldsymbol{x}\\right)^{1 / 2} $: Workload function 

Then: 

$ \\hat{w}_{\\ell}=\\hat{\\beta}_{1}+\\hat{\\beta}_{2}(\\ell-1)+\\hat{\\beta}_{3}(\\ell-1)^{1 / 2} \\quad \\forall \\ell \\in[L] $.

$\\boldsymbol h_m \\in\\{0,1\\}^N,\\forall m\\in[M]$:
- $h_{mn}=1$ if customer $n$ is in zone $m$

- $\\boldsymbol  h_m^\\top\\boldsymbol  x_k$: number of customer nodes 

Then SOR model:

#### (8)

$ \\begin{array}{rlr}\\hat{Z}=\\min & \\sum_{k \\in[K]} \\mu\\left(\\boldsymbol{y}_{k}\\right) & \\\\ \\text { s.t. } & g\\left(\\hat{\\boldsymbol{w}}_{L}, \\boldsymbol{x}_{k}\\right)+\\hat{w}_{L+1} \\mu\\left(\\boldsymbol{y}_{k}\\right)+\\hat{w}_{L+2} \\lambda_{k} \\leq T_{k} & \\forall k \\in[K] \\\\ & \\rho\\left(\\boldsymbol{H} \\boldsymbol{x}_{k}, \\hat{\\boldsymbol{\\xi}}_{k}\\right) \\leq \\lambda_{k} & \\forall k \\in[K] \\\\ & \\left(\\boldsymbol{x}_{k}, \\boldsymbol{y}_{k}\\right)_{k \\in[K]} \\in \\mathcal{X}, \\boldsymbol{\\lambda} \\in \\mathbb{R}^{K}, & \\end{array} $

- $ T_{k} $ :the predetermined delivery time deadline for courier $ k$,
- $ \\hat{w}_{L+1}, \\hat{w}_{L+2} $: the corresponding estimated weights for travel distance and the CALM metric 
- $ \\hat{\\boldsymbol{\\xi}}_{k} $  the prior assigned location vector of courier $ k $ determined from historical data.

### Theorem 2

> The SOR model as presented in Problem (8) is equivalent to the following mixed integer linear optimization problem:
>
> #### (9)
>
> $ \\begin{array}{rlr}\\hat{Z}=\\min & \\sum_{k \\in[K]} \\sum_{a \\in \\mathcal{A}} c_{a} y_{k a} & \\\\ \\text { s.t. } & \\sum_{\\ell \\in[L]} \\hat{w}_{\\ell} z_{k \\ell}+\\hat{w}_{L+1} \\sum_{a \\in \\mathcal{A}} c_{a} y_{k a}+\\hat{w}_{L+2} \\lambda_{k} \\leq T_{k} & \\forall k \\in[K] \\\\ & \\rho_{k}\\left(\\boldsymbol{x}_{k}\\right) \\leq \\lambda_{k} & \\forall k \\in[K] \\\\ & \\mathbf{1}^{\\top} \\boldsymbol{x}_{k}=\\sum_{\\ell \\in[L]}(\\ell-1) z_{k \\ell} & \\forall k \\in[K] \\\\ & \\mathbf{1}^{\\top} \\boldsymbol{z}_{k}=1 & \\forall k \\in[K] \\\\ & \\boldsymbol{z}_{k} \\in\\{0,1\\}^{L} & \\forall k \\in[K] \\\\ & \\left(\\boldsymbol{x}_{k}, \\boldsymbol{y}_{k}\\right)_{k \\in[K]} \\in \\mathcal{X}, \\boldsymbol{\\lambda} \\in \\mathbb{R}^{K}, & \\end{array} $
>
> Where:
>
> #### (10)
>
> $ \\rho_{k}\\left(\\boldsymbol{x}_{k}\\right)=\\left\\{\\begin{array}{ll}\\min & \\sum_{i, j \\in[M]} d_{i j} s_{i j} \\\\ \\text { s.t. } & \\sum_{i \\in[M]} s_{i j}=\\hat{\\xi}_{k j} \\mathbf{1}^{\\top} \\boldsymbol{x}_{k} \\forall j \\in[M] \\\\ \\sum_{j \\in[M]} s_{i j}=\\boldsymbol{h}_{i}^{\\top} \\boldsymbol{x}_{k} \\quad \\forall i \\in[M] \\\\ \\boldsymbol{s} \\geq \\mathbf{0} \\\\ & =\\left\\{\\begin{array}{ll}\\max & \\sum_{i \\in[M]} u_{i} \\boldsymbol{h}_{i}^{\\top} \\boldsymbol{x}_{k}+\\sum_{j \\in[M]} v_{j} \\hat{\\xi}_{k j} \\mathbf{1}^{\\top} \\boldsymbol{x}_{k} \\\\ \\text { s.t. } & u_{i}+v_{j} \\leq d_{i j} \\\\ \\boldsymbol{u}, \\boldsymbol{v} \\in \\mathbb{R}^{M} .\\end{array} \\quad \\forall i, j \\in[M]\\right.\\end{array}\\right. $







placeholder

placeholder

placeholder

placeholder

placeholder

placeholder

placeholder





Idea 

- residual with z 
`,__vite_glob_0_17=`---
title: Cure Dolly - Week 1
---

# Quick review

が is the heart of the Japanese, every sentence has a が.

Sometimes が is invisible, it's called *zero particle*.


が marks the **subject** of the sentence. e.g.: I, She, He.

---

# よろしくお願いします

Directly translation: I beg your favor.

Actually: lower yourself and raise the person whom you are talking.

---

# を に と

## mutuality

を has the most non-mutuality, と has the most mutuality.

---

# Verb conjugation

一段動詞 always delete る

## i-stem

五段動詞 u -> i

＋ます formal version

＋たい want

＋そう 

＋noun -> new noun

## a-stem

五段動詞 u -> a (exception: かう -> かわ)

＋ない not

＋れる( られる for ichidan ) receptive (受身形) e.g. get bought, get heard

＋せる( させる for ichidan ) causative (使役形) allow/make someone to do something

## e-stem

五段動詞 u -> e

＋る( られる for ichidan ) potential (可能形) e.g. can hear, can speak

くる -> こられる

する -> できる

## o-stem

五段動詞 u -> o

＋う( よう for ichidan ) volitional (意向形) e.g. let's eat, let's hear

---

# ている vs てある

ている : cont present form / **did X and still be in state of X** (Being in state X of itself)

- ていた : cont past form
- ていない : cont negative present form
- ていなかった : cont negative past form

てある : (Being in state X because someone put it that way and left it so)

## ていく・てくる

ていく : go / take
てくる : come(back) / bring


`,__vite_glob_0_18=`---
title: Cure Dolly - Week 2
---

# い and な adjectives

## Fact 1: na adjectives are nouns

## Fact 2: i adjectives are close cousins to verbs

## Fact 3: i adjectives contains the da/desu ( = ) function

花があかい　・　花があかいです

花がきれいだ　・　花がきれいです

## Fact 4: な＝だ, な is connective form of the だ

---

小さくてかわいい

きれいで有名だ

---

# だ　です

COUPLER: A,Bだ / A,Bです => A = B

A, B: two nouns.

---

# のです

母が来るのです

-> 0 が　母が来る　の　です

母が来るの　= mother's coming

0 = it

-> mother's coming is it. / it is that mother is coming.

## usage

to answer question that not be asked

to ask question that imply the context

to reveal something unexpected

to command (it's time to XXX)---

# のに　なのに

のに : contrastive conjunction, imply an **unsatisfactory** reason

なのに : turn だ into な, then のに

---

## ender:　ね　よ　な　かな

ね : shared information, already known

よ : sharing information, not known, friendly

よね : sharing and then treating as shared

な : "sharing" feeling with self

かな : I wonder (か for question and な for self)

の : casual sentence ender

なの : だ can't be connected with の, な is connective form of だ

`,__vite_glob_0_19=`---
title: Cure Dolly - Week 3
---

# も

も : adjective particle, including particle / as much as / even

誰も / 何も : not even anyone / anything -> nobody / nothing

誰でも / 何でも : で is だ・です, couple the 誰 and **zero noun** -> even it's anyone / anything

かもしれません : か question marker + も even　+ しれ potential form + ません negative

---

# ない, adjective conjugation

verb negative : u -> a + ない

i adjective negative: i -> ku + ない　( Remember i adjectives has だ form inside, so it has the て form)

i adjective past ( remember だ form inside, so it contains past form ) i ->かった

adjective to adverb : i -> ku

noun to adverb : + に

---

# に

i-stem of verb on its own is **noun**, can be the target of the に

i-stem of verb on its own can also connect with another verb

---

# compound noun

rendaku happens when two noun connected to make a compound-noun

---

# transitivity

自動詞 : self-move, e.g. 出る 負ける ある be

a-stem + る is 自動詞

他動詞 : other-move, e.g. 出す 負かす する do

す・せる ending is 他動詞

める・べる・てる ending is 他動詞

- e-stem + る flips the meaning 従う(shitagau): follow / 従える:  be accompanied by
`,__vite_glob_0_20=`---
title: Cure Dolly - Week 4
---

# あいだ

verb woking as adjective for あいだ : 落ちる間に

# てみる

do it and **see**

there's no doubt we can do it

we don't know the result

# ます

ます is a verb in itself, a helper verb

i-stem + ます

past : ました

negative ません

past negative ませんでした

# volitional 

だろう probably

でしょう probably

# と

しようとする we don't know whether we can do it, try to do it.

として : と + して

という : と + 言う

# causative / receptive

れる : helper verb, has different subject

水が犬に飲まれた

せる : helper verb, has different subject

犬を食べさせた

# place

これ : れ related to ある, a thing

この : の is class-marking の, something

こんな : な descriptive of a thing's quality, like this

こう : manner of being / doing, the way like this




`,__vite_glob_0_21=`---
title: Cure Dolly - Week 5
---

### te iru/te aru

`,__vite_glob_0_22=`---
title: Econometrics - Week 1
category: Notes
---

# 1 复习

## 1.1 条件期望

条件密度函数：$p(y|x) = \\dfrac{p(y, x)}{p(x)} = \\dfrac{p(y,x)}{\\int p(y, x)\\mathrm dy}$

条件期望：$E[Y|X=x] = \\int yp(y|x) \\mathrm dy$

可以定义： $\\varphi (x) = E[Y|X = x]$

条件期望： $E[Y|X] = \\phi (X)$

### 1.1.1 推论

1. $E[h(X) Y|X] = h(X) E[Y|X]$
2. $E[Y] = E[E[Y|X]]$
3. $E[E[Y|X_1,X_2]|X_1] = E(E[Y|X_1]|X_1,X_2) = E[Y|X_1]$
4. $E[Y|X] = \\argmin E[(Y-f(X))^2]$

## 1.2 相关系数 

$\\rho_{X, Y } = \\dfrac{\\sum_{i=1 }^{n }(X_i - \\bar{X })(Y_i - \\bar{Y }) }{\\sqrt{\\sum_{i=1 }^{n }(X_i - \\bar X) ^2 }\\sqrt{\\sum_{i=1 }^{n }(Y_i  - \\bar{Y })^2 }} $

## 1.3 回归分析

统计模型： 关于总体分布的某种特征的假定

$Z = (Y, \\vec{X })$

- $\\vec{X } = (X_1,\\dots, X_k)$: 解释变量
- $Y $： 目标变量

线性回归模型： $E[Y|X] = \\beta_0 + \\beta _1X_1 + \\cdots + \\beta _k X_k $

- $\\beta _0, \\beta _1,\\dots,\\beta _k $: 未知参数

对于样本： $E[Y_i|\\vec{X_i}] = \\beta _0 +\\beta _1X_{i1 }+ \\cdots + \\beta _k X_{ik }$

### 1.3.1 简单线性回归模型

$E[Y|X] = \\beta_0 + \\beta _1X $

如果定义： $u = Y - \\beta _0 - \\beta _1 X $ why?

可证： $E[u|X] = 0$

可以得到线性回归模型等价形式：

$\\begin{cases}
Y = \\beta _0 + \\beta _1X + u \\\\ 
E[u|X] = 0
\\end{cases}
$

对于样本 $Z_i=(Y_i, X_i)$:

$\\begin{cases}
Y_i = \\beta _0 + \\beta _1 X_i + u_i \\\\ 
E[u_i|X_i] = 0  
\\end{cases}
$

### 1.3.2 假设1

$u $关于 $X $的条件期望为零： $E[u|X] = 0 $

- $Cov (h(u), X) = 0 $,  $h(\\cdot ) $为任意线性 \\ 非线性函数

## 1.4 参数估计

### 1.4.1 方法1: 矩估计

构建矩条件：

1. $E[u_i] = 0$
2. $E[u_i|X_i] = 0 \\Rightarrow E[X_iu_i] = 0$

$ E\\left[\\begin{array}{c}Y_{i}-\\beta_{0}-\\beta_{1} X_{i} \\\\ X_{i}\\left(Y_{i}-\\beta_{0}-\\beta_{1} X_{i}\\right)\\end{array}\\right]=0 $

可得：

$ \\tilde{\\beta}_{0}=\\bar{Y}-\\tilde{\\beta}_{1} \\bar{X}, \\quad \\tilde{\\beta}_{1}=\\dfrac{\\sum_{i=1}^{n}\\left(X_{i}-\\bar{X}\\right)\\left(Y_{i}-\\bar{Y}\\right)}{\\sum_{i=1}^{n}\\left(X_{i}-\\bar{X}\\right)^{2}} $

### 1.4.2 方法2: 最小二乘法

最小化这个函数： $ S\\left(\\beta_{0}, \\beta_{1}\\right)=\\sum_{i=1}^{n}\\left(Y_{i}-\\beta_{0}-\\beta_{1} X_{i}\\right)^{2} $

可得相同结果

## 1.5 样本方差、样本协方差、相关系数

给定数据： $ \\left\\{\\left(X_{i}, Y_{i}\\right), i=1, \\ldots, n\\right\\} $

有 $X, Y $的样本方差：

$ s_{X}^{2}=\\dfrac{\\sum_{i=1}^{n}\\left(X_{i}-\\bar{X}\\right)^{2}}{n-1}, s_{Y}^{2}=\\dfrac{\\sum_{i=1}^{n}\\left(Y_{i}-\\bar{Y}\\right)^{2}}{n-1} $

样本协方差：

$ s_{X Y}=\\dfrac{\\sum_{i=1}^{n}\\left(X_{i}-\\bar{X}\\right)\\left(Y_{i}-\\bar{Y}\\right)}{n-1} $

相关系数：

$ r_{X Y}=\\dfrac{\\sum_{i=1}^{n}\\left(X_{i}-\\bar{X}\\right)\\left(Y_{i}-\\bar{Y}\\right)}{\\sqrt{\\sum_{i=1}^{n}\\left(X_{i}-\\bar{X}\\right)^{2}} \\sqrt{\\sum_{i=1}^{n}\\left(Y_{i}-\\bar{Y}\\right)^{2}}}=\\dfrac{s_{X Y}}{s_{X} s_{Y}} $

## 1.6 最小二乘法估计量解释

$ \\hat{\\beta}_{1}=\\frac{s_{X Y}}{s_{X}^{2}}=\\frac{s_{Y}}{s_{X}} r_{X Y} $

### 1.6.1 样本回归直线

- $y = \\hat \\beta _0 + \\hat \\beta _1 x$： 样本回归直线
- $\\hat Y_i = \\hat \\beta _0 + \\hat \\beta _1 X_i $: 拟合值
- $\\hat u_i = Y_i - \\hat Y_i $: 残差

### 1.6.2 最小二乘法性质

1. $ \\sum_{i=1}^{n} \\hat{u}_{i}=0 $
2. $ \\sum_{i=1}^{n} X_{i} \\hat{u}_{i}=0 $
3. $ \\sum_{i=1}^{n} \\hat{Y}_{i} \\hat{u}_{i}=0 $

### 1.6.3 SST, SSE, SSR

SS: Sum of Squares

SST: Total

SSE: Explained

SSR: Residual

$ \\begin{aligned} S S T & =\\sum_{i=1}^{n}\\left(Y_{i}-\\bar{Y}\\right)^{2} \\\\ S S E & =\\sum_{i=1}^{n}\\left(\\hat{Y}_{i}-\\bar{Y}\\right)^{2} \\\\ S S R & =\\sum_{i=1}^{n} \\hat{u}_{i}^{2}\\end{aligned} $

注意到： $SST=SSE+SSR $

### 1.6.4 $R^2 $


$R^2 = \\dfrac{SSE}{SST} = \\dfrac{s^2_{\\bar{Y}}}{s^2_Y}$

#### $R^2$ 与 相关系数

$ r_{\\hat{Y} Y}=\\frac{\\sum_{i=1}^{n}\\left(\\hat{Y}_{i}-\\overline{\\hat{Y}}\\right)\\left(Y_{i}-\\bar{Y}\\right)}{\\sqrt{\\sum_{i=1}^{n}\\left(\\hat{Y}_{i}-\\overline{\\hat{Y}}\\right)^{2}} \\sqrt{\\sum_{i=1}^{n}\\left(Y_{i}-\\bar{Y}\\right)^{2}}} $

有： $ R^{2}=r_{\\hat{Y} Y}^{2} $


如果 $X$ 为一维，还有： $ R^{2}=r_{\\hat{Y} Y}^{2}=r_{X Y}^{2} $







placeholder

placeholder

placeholder

placeholder

placeholder

placeholder`,__vite_glob_0_23=`# 1.1.1 推论证明

## $E[Y|X] = \\argmin E[(Y-f(X))^2]$

证明：

 $\\begin{aligned} \\mathcal{L}(f) & =E\\left[(Y-f(X))^{2}\\right] \\\\ & =E\\left[(E[Y \\mid X]+\\varepsilon-f(X))^{2}\\right] \\\\ & =E\\left[((E[Y \\mid X]-f(X))+\\varepsilon)^{2}\\right] \\\\ & =E\\left[(E[Y \\mid X]-f(X))^{2}+2(E[Y \\mid X]-f(X)) \\varepsilon+\\varepsilon^{2}\\right] \\\\ & =E\\left[(E[Y \\mid X]-f(X))^{2}\\right]+2 E[(E[Y \\mid X]-f(X)) \\varepsilon]+E\\left[\\varepsilon^{2}\\right]\\end{aligned} $

- $\\varepsilon = Y - E[Y\\mid X]$

注意到 $ E[\\varepsilon \\mid X]=0 \\Rightarrow E[(E[Y \\mid X]-f(X)) \\varepsilon]=0 $

- $ E[g(X) \\cdot \\varepsilon]=E[E[g(X) \\cdot \\varepsilon \\mid X]] = E[g(X)\\cdot E[\\varepsilon \\mid X]] $

可得： $\\mathcal {L}(f) = E\\left[(E[Y \\mid X]-f(X))^{2}\\right] + E[\\varepsilon^2]$

# 1.3.1

$u$: 残差，预测值和实际值的差距

# 矩估计

通过构造 $E[g_i (X,\\theta )] = 0 $ 来通过样本估计参数

## 1.4.1 矩估计 证明

$
\\left\\{\\begin{array}{l}
\\frac{1}{n} \\sum_{i=1}^{n}\\left(Y_{i}-\\beta_{0}-\\beta_{1} X_{i}\\right)=0 \\\\
\\frac{1}{n} \\sum_{i=1}^{n} X_{i}\\left(Y_{i}-\\beta_{0}-\\beta_{1} X_{i}\\right)=0
\\end{array}\\right.
$

化简得到：

$
\\begin{array}{l}
\\bar{Y}-\\beta_{0}-\\beta_{1} \\bar{X}=0 \\\\
\\overline{X Y}-\\beta_{0} \\bar{X}-\\beta_{1} \\overline{X^{2}}=0
\\end{array}
$

代入：

$
\\beta_{0}=\\bar{Y}-\\beta_{1} \\bar{X}
$

得到：

$
\\begin{array}{l}
\\overline{X Y}-\\left(\\bar{Y}-\\beta_{1} \\bar{X}\\right) \\bar{X}-\\beta_{1} \\overline{X^{2}}=0 \\\\
\\overline{X Y}-\\bar{Y} \\bar{X}+\\beta_{1} \\bar{X}^{2}-\\beta_{1} \\overline{X^{2}}=0 \\\\
\\overline{X Y}-\\bar{Y} \\bar{X}=\\beta_{1}\\left(\\overline{X^{2}}-\\bar{X}^{2}\\right)
\\end{array}
$

可得：

$
\\hat{\\beta}_{1}=\\frac{\\overline{X Y}-\\bar{X} \\bar{Y}}{\\overline{X^{2}}-\\bar{X}^{2}}
$



$
\\hat{\\beta}_{0}=\\bar{Y}-\\hat{\\beta}_{1} \\bar{X}
$

最终结果：

$
\\begin{array}{l}
\\hat{\\beta}_{1}=\\frac{\\sum_{i=1}^{n}\\left(X_{i}-\\bar{X}\\right)\\left(Y_{i}-\\bar{Y}\\right)}{\\sum_{i=1}^{n}\\left(X_{i}-\\bar{X}\\right)^{2}} \\\\
\\hat{\\beta}_{0}=\\bar{Y}-\\hat{\\beta}_{1} \\bar{X}
\\end{array}
$

## 1.4.2 最小二乘法 证明

求偏导有：

$
\\begin{array}{c}
\\frac{\\partial S}{\\partial \\beta_{0}}=-2 \\sum_{i=1}^{n}\\left(Y_{i}-\\beta_{0}-\\beta_{1} X_{i}\\right)=0 \\\\
\\frac{\\partial S}{\\partial \\beta_{1}}=-2 \\sum_{i=1}^{n} X_{i}\\left(Y_{i}-\\beta_{0}-\\beta_{1} X_{i}\\right)=0
\\end{array}
$

可得：

$
\\begin{aligned}
\\sum_{i=1}^{n}\\left(Y_{i}-\\beta_{0}-\\beta_{1} X_{i}\\right) & =0 \\\\
\\sum_{i=1}^{n} X_{i}\\left(Y_{i}-\\beta_{0}-\\beta_{1} X_{i}\\right) & =0
\\end{aligned}
$

下同

## 1.5 无偏估计

对于样本方差：

$ \\begin{array}{l}s_{X}^{2}=\\frac{1}{n-1} \\sum_{i=1}^{n}\\left(X_{i}-\\bar{X}\\right)^{2} \\\\ \\sum_{i=1}^{n}\\left(X_{i}-\\bar{X}\\right)^{2}=\\sum_{i=1}^{n} X_{i}^{2}-n \\bar{X}^{2} \\\\ s_{X}^{2}=\\frac{1}{n-1}\\left(\\sum_{i=1}^{n} X_{i}^{2}-n \\bar{X}^{2}\\right) \\\\ \\mathbb{E}\\left[s_{X}^{2}\\right]=\\frac{1}{n-1}\\left(\\mathbb{E}\\left[\\sum_{i=1}^{n} X_{i}^{2}\\right]-n \\mathbb{E}\\left[\\bar{X}^{2}\\right]\\right) \\\\ \\mathbb{E}\\left[X_{i}^{2}\\right]=\\sigma^{2}+\\mu^{2} \\\\ \\mathbb{E}\\left[\\sum_{i=1}^{n} X_{i}^{2}\\right]=n\\left(\\sigma^{2}+\\mu^{2}\\right) \\\\ \\mathbb{E}\\left[\\bar{X}^{2}\\right]=\\frac{\\sigma^{2}}{n}+\\mu^{2} \\\\ n \\mathbb{E}\\left[\\bar{X}^{2}\\right]=\\sigma^{2}+n \\mu^{2} \\\\ \\mathbb{E}\\left[s_{X}^{2}\\right]=\\frac{1}{n-1}\\left(n\\left(\\sigma^{2}+\\mu^{2}\\right)-\\left(\\sigma^{2}+n \\mu^{2}\\right)\\right) \\\\ =\\frac{1}{n-1}\\left(n \\sigma^{2}+n \\mu^{2}-\\sigma^{2}-n \\mu^{2}\\right) \\\\ =\\frac{1}{n-1}(n-1) \\sigma^{2} \\\\ \\mathbb{E}\\left[s_{X}^{2}\\right]=\\sigma^{2}\\end{array} $

对于样本协方差：

$ \\begin{array}{l}s_{X Y}=\\frac{1}{n-1} \\sum_{i=1}^{n}\\left(X_{i}-\\bar{X}\\right)\\left(Y_{i}-\\bar{Y}\\right) \\\\ \\sum_{i=1}^{n}\\left(X_{i}-\\bar{X}\\right)\\left(Y_{i}-\\bar{Y}\\right)=\\sum_{i=1}^{n} X_{i} Y_{i}-n \\bar{X} \\bar{Y} \\\\ s_{X Y}=\\frac{1}{n-1}\\left(\\sum_{i=1}^{n} X_{i} Y_{i}-n \\bar{X} \\bar{Y}\\right) \\\\ \\mathbb{E}\\left[s_{X Y}\\right]=\\frac{1}{n-1}\\left(\\mathbb{E}\\left[\\sum_{i=1}^{n} X_{i} Y_{i}\\right]-n \\mathbb{E}[\\bar{X} \\bar{Y}]\\right) \\\\ \\mathbb{E}\\left[X_{i} Y_{i}\\right]=\\operatorname{Cov}\\left(X_{i}, Y_{i}\\right)+\\mu_{X} \\mu_{Y}=\\sigma_{X Y}+\\mu_{X} \\mu_{Y} \\\\ \\mathbb{E}\\left[\\sum_{i=1}^{n} X_{i} Y_{i}\\right]=n\\left(\\sigma_{X Y}+\\mu_{X} \\mu_{Y}\\right) \\\\ \\mathbb{E}[\\bar{X} \\bar{Y}]=\\operatorname{Cov}(\\bar{X}, \\bar{Y})+\\mu_{X} \\mu_{Y}=\\frac{\\sigma_{X Y}}{n}+\\mu_{X} \\mu_{Y} \\\\ n \\mathbb{E}[\\bar{X} \\bar{Y}]=\\sigma_{X Y}+n \\mu_{X} \\mu_{Y} \\\\ \\mathbb{E}\\left[s_{X Y}\\right]=\\frac{1}{n-1}\\left(n\\left(\\sigma_{X Y}+\\mu_{X} \\mu_{Y}\\right)-\\left(\\sigma_{X Y}+n \\mu_{X} \\mu_{Y}\\right)\\right) \\\\ =\\frac{1}{n-1}\\left(n \\sigma_{X Y}+n \\mu_{X} \\mu_{Y}-\\sigma_{X Y}-n \\mu_{X} \\mu_{Y}\\right) \\\\ =\\frac{1}{n-1}(n-1) \\sigma_{X Y} \\\\ \\mathbb{E}\\left[s_{X Y}\\right]=\\sigma_{X Y}\\end{array} $




placeholder

placeholder

placeholder

placeholder

placeholder

placeholder


`,__vite_glob_0_24=`---
title: Financial Engineer - Week 2
category: Notes
---

# 投资收益分析

## 金融投资市值分析

$C_t$: 时刻 t 的收入现金流

$ P V_{0}=\\sum_{h=0}^{\\infty} \\frac{C_{h}}{1+R_{0, h}} $

- $R_{t,t+h}$: $t+h$ 时刻向时刻 t 的折现率

$ P V_{t}=\\sum_{h=0}^{\\infty} \\frac{C_{t+h}}{1+R_{t, t+h}} $

- $C_{t+h}$固定：债券（固定收益）
- 反之：股票（浮动收益）

-

$C_{t+h}$: 由产品决定，与市场无关

$R_{t,t+h}$: 租金价格，取决于供求关系，不确定性风险是所有产品的系统性风险

---

收入现金流 + 利率（资金租金价格）

-> 产品市场价值 

-> 产品市场价格

-> 收益率（投资收益水平）

## 利率 

年化利率：资金租用价格

### 储蓄利率

无风险投资

$Ark$: 到期收益
- $r$: 年化利率 
- $k$: 年期
- $A$: 本金

$A(1+rk)$: 到期账户金额

单利

---

自动转存：

$A(1+rk)^n$: 账户金额

复利

$k$: 计息周期

--- 

没有流动性

不能反映金融市场中资金的租金价格

为金融产品提供一种计息规范

### 同业拆借利率

银行之间的短期资金借贷利率

- 拆进利率（Bid Rate）: 银行愿意借入的利率
- 拆出利率（Offered Rate）: 银行愿意借出的利率

拆进利率小于拆出利率

差额为银行的收益

--- 

市场利率由供求关系决定：

- 资金紧张 - 利率上升
- 资金宽松 - 利率下降

利率促进资金供求平衡：

- 利率下降 - 供给减少 需求增加
- 利率上升 - 供给增加 需求减少

### LIBOR

LIBOR: 伦敦同业拆借利率

国际金融市场贷款的参考利率

我国对外筹资成本：6个月LIBOR + 0.5% p.a. (per annum)

实际天数对 360 天报价

#### 例子：

设6个月期LIBOR为 $8%$

实际利息率：

$181 / 360 \\times 8\\% = 4.0222\\%$

---

可以影响整个金融市场的风险因子

LIBOR 值是如何变动的

### 无风险利率 

国债 - 有固定未来现金流

短期国债，流动性强

短期国债：贴现国债

$S = 100 - P\\dfrac{T}{360}$

- $P$: 报价
- $100$: 面值
- $S$: 现金价格
- $T$: 交易日 - 到期日

#### 国债例子

60天到期， 报价4.0

$S = 100 - 4 \\dfrac{60}{360}$ = 99.33

$R_t = \\dfrac{100-S}{S}\\dfrac{360}{T}$: 年化利率

即期利率：$R_{0,t}$：计算未来 t 时刻现金流现值的折现率 

远期利率：在未来 s 时刻至未来 t 时刻的利率

$ \\begin{aligned} & \\left(1+s \\cdot R_{s}\\right)\\left(1+(t-s) \\cdot R_{s, t}\\right)=1+t \\cdot R_{t} \\\\ \\Rightarrow & R_{s, t}=\\frac{1}{t-s} \\cdot\\left(\\frac{1+t \\cdot R_{t}}{1+s \\cdot R_{s}}-1\\right)=4.6084 \\%\\end{aligned} $

### 利率期限结构

$R_T $关于 $T$ 的函数

估计利率：

#### 插值估计

线性估计：

$ \\frac{R_{\\tau}-R_{T_{1}}}{\\tau-T_{1}}=\\frac{R_{T_{2}}-R_{T_{1}}}{T_{2}-T_{1}} \\Rightarrow R_{\\tau}=R_{T_{1}}+\\left(\\tau-T_{1}\\right) \\cdot \\frac{R_{T_{2}}-R_{T_{1}}}{T_{2}-T_{1}} $

远期利率插值：

$ \\begin{array}{l}\\frac{T_{2} \\cdot R_{T_{2}}-T_{1} \\cdot R_{T_{1}}}{\\left(T_{2}-T_{1}\\right)\\left(1+T_{1} \\cdot R_{T_{1}}\\right)}=R_{T_{1}, T_{2}}=R_{T_{1}, \\tau}=\\frac{\\tau \\cdot R_{\\tau}-T_{1} \\cdot R_{T_{1}}}{\\left(\\tau-T_{1}\\right)\\left(1+T_{1} \\cdot R_{T_{1}}\\right)} \\\\ \\Rightarrow R_{\\tau}=\\left(T_{1} \\cdot R_{T_{1}}+\\frac{\\tau-T_{1}}{T_{2}-T_{1}} \\cdot\\left(T_{2} \\cdot R_{T_{2}}-T_{1} \\cdot R_{T_{1}}\\right) / \\tau\\right.\\end{array} $   




`,__vite_glob_0_25=`---
title: Financial Engineer - Week 2
category: Assignments
---

# 问题

设当前日期 2025－02－01 的利率期限结构如下：
$
\\begin{array}{|c|c|}
\\hline
\\text{到期日} & \\text{即期利率} \\\\
\\hline
2025/3/1 & 1.631 \\\\
\\hline
2025/5/1 & 1.645 \\\\
\\hline
2025/8/1 & 1.656 \\\\
\\hline
2025/11/1 & 1.666 \\\\
\\hline
2026/2/1 & 1.674 \\\\
\\hline
\\end{array}
$

表1利率期限结构表

请据此估算到期日为 2025－6－30 的即期利率。

# 解答

使用线性插值：

$\\dfrac{R-1.645}{90-60} = \\dfrac{1.656-1.645}{120-60}$

得到：

$R = 1.6505$

使用远期利率插值：

$
\\dfrac{120 \\cdot 1.656 - 60 \\cdot 1.645}{(120-60)(1+60\\cdot 1.645)}
=\\dfrac{90R - 60\\cdot 1.645}{(90 - 60)(1 + 60\\cdot 1.645)}
$

得到：

$R = 1.6523$

`,__vite_glob_0_26=`---
title: Financial Engineer - Week 4
category: Notes
---

# Model 

Consider $[t, t+\\Delta t]$ return:


$R_{t,t+\\Delta t} = \\dfrac{S(t+\\Delta t) / S(t) - 1}{\\Delta t}$

$\\Rightarrow S(t+\\Delta t) = S(t)(1+\\Delta t \\cdot R_{t,t+\\Delta t})$

复利：

$S(t+\\Delta t) = S(t) + (1 + \\dfrac{\\Delta t}{m}R^{t,t+\\Delta t})^m$

得到：

$S(t+\\Delta t) = S(t)e^{\\Delta t \\cdot \\bar R_{t, t+\\Delta t}}$

--- 

# 布朗运动

$\\Delta x = x(t+\\Delta t) - x(t)$

$E(\\Delta x) = 0$

$Var(\\Delta x) = \\sigma^2 (\\Delta t)$

Then:

$\\Delta x \\sim N(0, \\sigma^2(\\Delta t))$

## 维纳过程

$\\Delta x = \\varepsilon \\sqrt{\\Delta t}, \\varepsilon \\sim N(0, 1)$

# 股价行为

$S(t)$: $t$时刻的股价

$R_{t, t+ \\Delta t} = (\\dfrac{S(t+\\Delta t)}{S(t)} - 1)\\cdot\\dfrac{1}{\\Delta  t}$

$\\Rightarrow S(t+\\Delta t) = S(t) (1+\\Delta t \\cdot R_{t, t + \\Delta t})$

$\\Rightarrow S(t+\\Delta t) = S(t) (1+\\dfrac{\\Delta t}{m} \\cdot \\bar R_{t, t + \\Delta t})^m$

$= S(t)e^{\\Delta t \\cdot\\bar R_{t,t+\\Delta t}} $

Then:

$\\ln S(t+\\Delta t ) - \\ln S(t) = \\Delta t \\cdot \\bar R_{t, t+\\Delta t}$

$G(t) := \\ln (S_t)$

$\\Delta G \\sim N(\\bar \\mu \\cdot\\Delta t,\\sigma^2 \\cdot \\Delta t)$

Then:

$\\Delta G = \\bar \\mu \\cdot \\Delta t + \\sigma\\cdot \\Delta x$
- $\\Delta x$是维纳过程
- 称为广义维纳过程

--- 

$S = e^G$ ： 股票价格

$ \\Delta S=\\frac{\\partial S}{\\partial G} \\Delta G+\\frac{1}{2!} \\frac{\\partial^{2} S}{\\partial G^{2}} \\Delta G^{2} $

代入 $ \\Delta G=\\bar{\\mu} \\cdot \\Delta t+\\sigma \\cdot \\varepsilon \\sqrt{\\Delta t} $

$ \\Delta S=\\left(\\frac{\\partial S}{\\partial G} \\cdot \\bar{\\mu}+\\frac{1}{2} \\frac{\\partial^{2} S}{\\partial G^{2}} \\cdot \\sigma^{2} \\varepsilon^{2}\\right) \\Delta t+\\frac{\\partial S}{\\partial G} \\cdot \\sigma \\varepsilon \\sqrt{\\Delta t}+o(\\Delta t) $

$ \\begin{aligned} d S & =\\left(\\frac{\\partial S}{\\partial G} \\cdot \\bar{\\mu}+\\frac{1}{2} \\frac{\\partial^{2} S}{\\partial G^{2}} \\cdot \\sigma^{2}\\right) d t+\\frac{\\partial S}{\\partial G} \\cdot \\sigma \\varepsilon \\sqrt{d t} \\\\ & =\\left(e^{G} \\cdot \\bar{\\mu}+\\frac{1}{2} e^{G} \\cdot \\sigma^{2}\\right) d t+e^{G} \\cdot \\sigma \\varepsilon \\sqrt{d t} \\\\ & =S \\cdot\\left(\\bar{\\mu}+\\sigma^{2} / 2\\right) d t+S \\cdot \\sigma d x\\end{aligned} $

- 几何布朗运动

令 $ \\mu \\triangleq \\bar{\\mu}+\\sigma^{2} / 2 $ ，几何布朗运动表示如下：

$
d S=S \\cdot \\mu d t+S \\cdot \\sigma d x
$

--- 

## 股票价格分布

- 考虑在投资期 $ [0, t] $ 内股票价格的分布函数。
- 由
$
\\begin{aligned}
\\ln \\left(S_{t} / S_{0}\\right) & =\\ln S_{t}-\\ln S_{0} \\\\
& =G_{t}-G_{0} \\\\
& =\\bar{\\mu} t+\\sigma \\cdot \\varepsilon \\cdot \\sqrt{t}
\\end{aligned}
$
－得股票价格对数服从正态分布：
$
\\ln \\left(S_{t} / S_{0}\\right) \\sim N\\left(\\bar{\\mu} \\cdot t, \\sigma^{2} \\cdot t\\right)
$

---

## 期望收益率

$ \\left.\\begin{array}{l}E\\left(S_{t}\\right)=S_{0} e^{\\mu t} \\\\ E\\left(R_{t}\\right)=\\left(E\\left(S_{t}\\right) / S_{0}-1\\right) / t\\end{array}\\right\\} \\Rightarrow \\mu=\\frac{\\ln \\left(1+t \\cdot E\\left(R_{t}\\right)\\right)}{t} $

---

估计 $\\bar \\mu$:

$ \\begin{aligned} \\bar{\\mu} & =\\frac{1}{\\Delta t} E\\left(\\ln \\left(S_{t+\\Delta t} / S_{t}\\right)\\right) \\\\ & \\approx \\frac{1}{\\Delta t} \\cdot \\frac{1}{n} \\sum_{t=1}^{n} \\ln \\left(1+y_{t}\\right) \\\\ & \\approx \\frac{1}{\\Delta t} \\cdot \\ln \\left(\\sqrt[n]{\\prod_{t=1}^{n}\\left(1+y_{t}\\right)}\\right)\\end{aligned} $

---

估计$ \\mu $

$ \\begin{aligned} \\mu & =\\frac{1}{\\Delta t} \\ln \\left(E\\left(S_{t+\\Delta t}\\right) / S_{t}\\right) \\\\ & \\approx \\frac{1}{\\Delta t} \\cdot \\ln \\left(\\frac{1}{n} \\sum_{t=1}^{n}\\left(1+y_{t}\\right)\\right) \\\\ & \\approx \\frac{1}{\\Delta t} \\cdot \\ln \\left(1+\\frac{1}{n} \\sum_{t=1}^{n} y_{t}\\right)\\\\ 
&= \\approx \\frac{1}{\\Delta t} \\cdot \\frac{1}{n} \\sum_{t=1}^{n} y_{t}\\end{aligned} $


---

估计方差

$ \\begin{aligned} \\operatorname{Var}\\left(S_{t}\\right) & =E\\left(S_{t}^{2}\\right)-\\left(E S_{t}\\right)^{2} \\\\ & =S_{0}^{2} e^{\\left(2 \\mu+\\sigma^{2}\\right) t}-S_{0}^{2} e^{2 \\mu t} \\\\ & =S_{0}^{2} e^{2 \\mu t}\\left(e^{\\sigma^{2} t}-1\\right)\\end{aligned} $

---






`,__vite_glob_0_27=`---
title: Financial Engineer - Week 5
category: Notes
---

# 期望效用准则

## 公理假设

- 金融产品有可比性 (定义 $>$ 为优于 )
- $A>B, B>C \\to A>C$
- $U(r)$连续
- $u,L$单调
- 期望效用有相同偏好

## 圣彼得堡游戏

伯努利解释：

$U(x) = b\\log \\dfrac{x}{a}$

## 风险厌恶

$\\pi := r - r_c$
- $U(r_c) = \\dfrac{U(r+\\Delta r)+U(r- \\Delta r)}{2}$

$\\pi > 0$: 风险规避

---

$$
\\begin{array}{l}
U(r_c) \\\\ 
= \\dfrac{U(r+\\Delta r)+U(r- \\Delta r)}{2}\\\\ 
= U(r) + \\dfrac{U''(r)\\Delta r^2}{2}\\\\ 
\\end{array}
$$

$$
\\begin{array}{l }
U(r_c)\\\\ 
= U(r - \\pi)\\\\ 
= U(r) + U'(r)(r-\\pi -r)\\\\ 
= U(r) - U'(r)\\pi 
\\end{array}
$$

$$
\\begin{array}{l }
\\Rightarrow U(r) - U'(r)\\pi = U(r) + \\dfrac{U''(r)\\Delta r^2}{2}\\\\ 
\\pi = -\\dfrac{\\Delta r^2}{2}\\dfrac{U''(r)}{U'(r)}\\\\ 
\\Rightarrow A(r) = -\\dfrac{U''(r)}{U'(r)}
\\end{array}
$$

$A(r)>0 \\Lrarr U''(r)<0$: 风险规避



`,__vite_glob_0_28=`---
title: Financial Engineer - Week 1
category: Notes
---

# 两个基本问题

- 资本定价问题
- 风险管理问题

---

注意到：

$P_0 \\equiv \\sum_{t=1}^{2n}\\dfrac{P_0\\cdot\\dfrac{i}{2}}{(1+\\dfrac{i}{2})^t} + \\dfrac{P_0}{(1+\\dfrac{i}{2})^{2n}}$

$$
\\begin{aligned}
&RHS\\\\ 
&=P_0 (\\dfrac{i}{2} ( \\sum_{t=1}^{2n}\\dfrac{1}{(1+\\dfrac{i}{2})^t}) + \\dfrac{1}{(1+\\dfrac{i}{2})^{2n}})\\\\ 
&=P_0(\\dfrac{i}{2}\\cdot \\dfrac{1}{1+\\dfrac{i}{2}}(\\dfrac{1-(1+\\dfrac{i}{2})^{-2n}}{1-(1+\\dfrac{i}{2})^{-1}}) + \\dfrac{1}{(1+\\dfrac{i}{2})^{2n}})\\\\ 
&= P_0 (1- (1+\\dfrac{i}{2})^{-2n} + (1+\\dfrac{i}{2})^{-2n})\\\\
&= P_0 
\\end{aligned}
$$

美国买家 瑞士卖家 外汇市场 期货市场

## 内容安排

投资收益分析：
- 风险管理问题 
  - 战略手段
    - 投资风险决策分析
    - 投资组合理论分析
  - 技术手段
    - 期货套期保值分析
    - 期权套期保值分析
    - 期权风险套利分析
- 资本定价问题
  - 战术手段
    - 资本资产定价模型
    - 套利定价模型
  - 技术手段
    - 期货定价模型
    - 期权定价模型
  
  假设：
  - 风险是金融产品的固有属性，不受市场影响
  - 金融市场为弱有效市场，本质是风险和收益的交易场所
  - 期望效用最大的决策准测，在风险和收益中权衡




placeholder


placeholder

placeholder

placeholder

placeholder

`,__vite_glob_0_29=`---
title: Financial Engineer - Week 9
category: Notes
---

FE_9.md

now: experience model store future

DOing:

- evlotuion 

Large open cultivate not online 

tracking move

40thousand store - restaurant 

temporary space 

space 

instagram-like can check out 

same as online 

gaurantee 

touch n \`\`\`python
camera - interact 

gender 

brands 

feedback how frequent - new product and feedback 

nto a big deal 


\`\`\``,__vite_glob_0_30=`---
title: Financial Engineer - Cheatsheet
category: Cheatsheets
---

# 01 绪论


02投资收益分析


资本定价问题


风险管理问题


- 筹集资金，确保利润


## 例子


本金 $P_0$, 年利率 $i$, $n$年期，半年付息


需要满足：


$P_0 = \\sum_{t=1}^{2n}\\dfrac{P_0 \\frac{i}{2}}{(1+\\frac{i}{2})^t} + \\dfrac{P_0}{(1+\\frac{i}{2})^{2n}}$


- $i$过高，企业承担债务- 反之低于国债


套期保值


# 02 投资收益分析


## 金融投资市值分析


现在为0时刻，$C_t$: 在时刻 $t$ 的现金流， $R_{t,t+h}$: 时刻 $t+h$向 $t$ 的折现率


$PV_0 = \\sum_{h=0}^\\infty\\dfrac{C_h}{1+R_{0,h}}$： 市场价值


$PV_t = \\sum_{h=0}^\\infty\\dfrac{C_{t+h}}{1+R_{t,t+h}}$


## 利率


### 储蓄利率


单利 / 复利


无论是银行储蓄，还是银行贷款，均不能自由转让，并受制于银行的诸多约束条件和要求，未能满足金融产品的流动性要求，因而，以银行作为唯一中介机构，来满足资金提供方和需求方的融资需求，还不能构成一个可以进行自由交易（融资）的金融市场。


储蓄利率不能反映金融市场中资金的租金价格


### 市场利率 - 同业拆借利率


银行对利率是最敏感的，特别体现在银行同业之间的短期资金借贷利率，称为 同业拆借利率


同业拆借利率是市场资金借贷成本的真实反映，普遍作为金融市场中浮动利率的基础利率


市场利率是由资金市场上供求关系决定的利率：资金紧张，使利率上升；资金宽松，使利率下降。• 反过来，利率又促进资金供求趋向平衡。 利率下降，一方面将促使一部分原打算投向资金市场的货币转用于其他方面，使市场资金的供给量减少；另一方面，减轻企业从市场筹集资金的利息负担，增加筹资者的资金需求，从而使资金供求趋于平衡。 利率上涨，一方面吸纳其它资金流入资金市场；另一方面，因提高了筹资成本，减少企业从市场筹集资金的需求，从而使资金供不应求的紧张状况缓和下来。


LIBOR 经常作为国际金融市场贷款的参考利率 以“实际天数对 360 天”的方式报价


#### 例子


以 2021 年上半年为例，设 6 个月期 LIBOR 为 8%。


6 个月的实际利息率为 181 / 360×8% = 4.0222%而不是 0.5×8% = 4%！


--- 


由 LIBOR 代表的市场利率，只是银行之间的拆借利率，反映的是银行之间资金的租金价格。• 对于普通投资者或投资机构而言，这样的利率是不能通过在金融市场进行金融投资，而成为他们的投资回报率。• 但这并不能表明 LIBOR 对我们普通投资者没有用。实际上，从利率风险的角度来看，LIBOR 作为一种反映资金供求状况的市场指数，是一个可以影响整个金融市场的风险因子。因此，在某个时刻的 LIBOR 值可能对我们没有意义，但“LIBOR 值是如何变动的”则对我们至关重要，甚至可以通过金融产品的创新来实现利率风险的规避。


### 无风险利率


无风险利率，是能够在金融市场通过金融投资而确定获取的利息率，具体指一个投资期内，期初一次性投入资金，期末一次性获得固定收益的利息率。• 如果说市场利率反映的是资金供求状况的资金租金价格，无风险利率则反映的是可在金融市场中进行普通交易的资金租金价格。• 鉴于国债是政府发行的债券，具有固定未来现金流，且无违约风险，因而普遍成为提供无风险利率的金融产品。• 特别是短期国债，其流动性强，其市场价格能够充分地反映出资金的供求关系。


$S - 100 - P\\dfrac{T}{360}$


$P$: 报价， $T$: 到期日与交易日之差， $S$: 购买价格，到期获得100


年化利率：$R_t = \\dfrac{100-S}{S}\\dfrac{360}{T}$


远期利率：$R_{s,t} = \\dfrac{1}{t-s}(\\dfrac{1+tR_t}{1+sRs}-1)$


插值：


$R_\\tau = R_{T_1}+(\\tau - T_1)\\dfrac{R_{T_2}-R_{T_1}}{T_2-T_1}$


$R_\\tau = (T_1R_{T_1}+\\dfrac{\\tau - T_1}{T_2-T_1}(T_2R_{T_2}-T_1R_{T_1}))/\\tau$


## 市值 价格 报价


短期国债 


市场价值 $PV = \\dfrac{100}{1+TR_T}$


现金价格 $S=PV=\\dfrac{100}{1+TR_T}$


报价 $P=\\dfrac{100-S}{T}=\\dfrac{100R_T}{1+TR_T}$


中长期


$PV = \\sum_{h=1}^n\\dfrac{C_{T_h}}{1+T_hR_{T_h}}+\\dfrac{100}{1+T_nR_{T_n}}$


- $T_n = T$, $R_{T_h}$即期利率， $C_{T_1}=  C\\dfrac{d_2}{d_1+d_2}$, $C_{T_h} = C, h = 2, 3, \\dots, n$


美国报价： $P=PV$, 净价报价


$S=PV+C\\dfrac{d_1}{d_1+d_2}$ 


$P=S$ 中国报价：全价报价


### 股票


$PV = \\sum_{h=1}^n \\dfrac{C_{T_h}}{1+T_hR_{T_h}}$


不同于国债，股票的未来现金流为不确定量，一方面体现了股票自身的风险性，另一方面体现了股票投资风险的客观性。


对于股票未来现金流的不可见部分，股票的投资收益可表示为基于市场的综合预期而形成的股票价差收益。• 这种基于市场预期的价格波动，短期来看，容易受到各种人为、社会因素的影响（例如不同程度的市场操纵、各类消息的过度反应）；长期来看，由于股票投资收益最终来源于上市公司的利润分红，在健康的股票市场中，在统计意义上股价必然沿着价值回归的趋势发展。• 因此，关于股票的市场价值分析，较大程度上可反映在基于股票价格的投资收益分析。


• 对于未来现金流的可见部分，股票的（净价）价格是对股票的市场报价（收盘价）进行除权除息后的价格：除权除息价 = （股权登记日的收盘价 – 每股所分红利现金额 +配股价 * 每股配股数）/ （1 + 每股送红股数 + 每股配股数）• 需要指出，基于股票价格的投资收益分析，其目的并不是关于股票价格的预测分析，而是从较长一段时期内去挖掘出在统计意义上具有稳定性的有关数量分析。


市场利率与股票价格的关系是反方向的，即市场利率下降，将引起股票价格上涨；市场利率上升，将引起股票价格下跌。• 以市场利率上升为例，它将在以下几个方面引起股票价格下跌： 生产规模方面。利率的上升，不仅会增加公司的借款成本，还会使公司难以获得必需的资金，这样，公司就不得不消减生产规模，其结果势必会减少公司的未来利润，引起股票价格下跌。 折现率方面。利率上升，投资者据以评估股票价值所在的折现率也会上升，使得股票价值下降，引起股票价格下跌。 股票需求方面。利率上升，使得股市中的一部分资金流向银行储蓄和债券市场，从而减少市场上的股票需求，引起股票价格下跌。


# 投资收益的度量


$R_{s,t}$收益率 = 净收益/投资


$R_{s,t} = \\dfrac{S_t-S_s}{S_s}\\dfrac{1}{t-s}$


- $S_s$为期初现金流， $S_t$为期末现金流, $t-s$为相隔年数


在投资期内所产生的利息收入，将按远期利率添加到期末现金流。 在投资期内需追加投资的支出，将按远期利率从期末现金流中予以扣除。




算例：


期初现金流 $S_{t_0}$


期末现金流


1 发行方的利息收入 $(C_n + \\sum_{t=1}^{n-1}C_t(1+R_{t,n}))(1+R_{n,n+1}\\dfrac{d_1}{d_1+d_2})$


2 期末买方垫付累计利息 $C_{n+1}\\dfrac{d_1}{d_1+d_2}$


3 期末买方按净价报价支付的出售收入 $P_{t_1}$


$S_{t_1} = (C_n+\\sum_{t=1}^{n-1}C_t(1+R_{t,n}))(1+R_{n,n+1}\\dfrac{d_1}{d_1+d_2})+(C_{n+1}\\dfrac{d_1}{d_1+d_2})+P_{t_1}$


年化收益率 $R_{t_0, t_1} = \\dfrac{S_{t_1} - S_{t_0}}{S_{t_0}}\\dfrac{1}{T(t_0,t_1)}$


由此可见，收益率和利率之间具有可比性，它们都表达了由本金投入所带来的回报率。• 特别地，如果投资短期国债并持有至到期日，所获得的收益率就是相应期限的即期利率


但是，收益率和利率是两个不同的概念！• 收益率表示投资回报率，是一个事后的概念，在投资结束期前都可能是一个随机量，只有在投资结束时才能够最终确定，并且完全可能为负收益率。• 利率表示资金的租用价格，是一个事前的概念，它跟普通的租赁一样，在一开始就已确定，并且几乎不可能有负利率。


# 03 股票价格行为特征模型


## 布朗运动 


微颗粒从某一位置开始的位移，与之前所在位置无关


微颗粒从某一位置开始的位移，与其所在位置无关


通过适当定义时间单位后，时间间隔即为微粒的位移方差


### 维纳过程


$\\Delta x = \\varepsilon\\sqrt {\\Delta t}, \\varepsilon \\sim N(0， 1)$


$\\Delta x$独立


## 股票价格行为


### 市场有效性假说


在股票市场上，连续随机出现的信息导致股价的随机波动。• 信息能否迅速而准确地影响价格，取决于市场的有效性。• 在有效市场中，投资者不可能利用已知信息来获取超额收益。


---


三个层次：


历史信息 - 公开信息 - 内幕信息


即股票过去的价格、收益率和成交量等


即当前所有公布于众的信息，如公司盈利及财务状况、利润分配方案等


即为内幕人士所知悉，尚未公开而且可能影响股票价格的信息


有效性：


弱有效市场 - 半强式有效市场 - 强有效市场


股票现在的价格完全反映了过去的 价格、成交量等历史信息，投资者不可能利用历史信息来获取超额收益


股票现在的价格完全反映了所有的公开信息，投资者不可能利用历史信息和公开信息来获取超额收益。


股票现在的价格完全反映了所有可能影响其价格的信息，投资者不可能利用任何信息来获取超额收益


**在实际的股票市场中，市场弱有效性假设近似成立**


## 股价行为




弱有效性市场中，由于不可能利用历史信息来获取超额收益，表明股票过去的历史价格信息将完全反映在股票现在的价格中。• 股票未来的价格，如果不仅与股票现在的价格有关，还与过去的历史价格信息有关，则历史价格数据中存在影响着未来价格的信息，而这部分信息并没有反映在股票现在的价格中。这意味着投资者可能利用历史信息来获取超额收益，表明不是弱有效性市场。


**弱有效性市场中，股票未来的价格，只与股票现在的价格有关，而与过去的历史价格信息，以及从过去到现在的价格演变方式均无关。**


---


**股票市场是随机波动的，随机波动是股票市场的常态**


导致股票价格随机波动的直接原因，是连续随机出现的信息对价格的影响。• 在个别试验中其结果呈现出不确定性；在大量重复试验中其结果又具有统计规律性的现象，有规律可循。• 过去数据不构成对未来数据的预测基础；同时不会出现惊人相似的反复，难以预测。


---


。股价事实上反映了市场投资者对投资回报率及其不确定性的综合诉求。连续随机出现的信息，将直接影响到投资者对股票未来现金流及其不确定性的预期，出现与投资者的诉求不相匹配，从而导致股票价格的随机波动。如果股票在不同价位下受到相同信息的影响，则基于投资者对于投资回报率的诉求，将导致不同的价格变动。这一点与布朗运动不同，因此不能用股价的变化 ∆S 来对应表示微颗粒的位移。


$G(t) :=\\ln S_t$


$E(\\Delta G) = \\bar \\mu \\Delta t$


- $\\bar\\mu$: 以连续复利表示收益率的数学期望 


$Var(\\Delta G) = \\sigma^2 \\Delta t$


- $\\sigma$: 单位时间的收益率标准差 $\\Delta G \\sim N(\\bar\\mu \\Delta t,\\sigma^2\\Delta t)$


$\\Delta G = \\bar\\mu \\Delta t + \\sigma\\Delta x$, $\\Delta x$是维纳过程


当$\\Delta t\\to 0, dS = S(\\bar \\mu + \\sigma^2/2)dt + S\\sigma dx$ 几何布朗运动


$\\mu := \\bar\\mu+\\sigma^2/2$


$dS = S\\mu dt + S\\sigma dx$


$\\Delta S / S = \\mu\\Delta t + \\sigma \\Delta x$


在时间上，它只取决于$\\Delta t$的大小，而与时间 t 无关。这表明，股票投资的收益率水平和风险水平将取决 $\\mu , \\sigma$ 这两个参数。由此得出如下结论：


弱有效性股票市场中的投资决策，可归结为由 $\\mu, \\sigma$ 表示的收益率和风险之间进行权衡的风险决策。


## 股票价格分布


$\\ln(S_t/S_0) \\sim N(\\bar\\mu t ,\\sigma^2t)$


$R_t = (S_t / S_0 - 1)/t$


期望收益率：


$E(S_t) = S_0 e^{\\mu t}, E(R_t) = (E(S_t)/(S_0) - 1) / t$


$\\mu = \\dfrac{\\ln (1+ t E(R_t))}{t}$


$y_t = \\dfrac{S_t-S_{t-1}}{S_{t-1}}$


为该期望收益率的连续复利表示形式，通常也用于表示期望收益率。


$\\bar\\mu = \\dfrac{1}{\\Delta t}\\ln (\\sqrt[n]{\\prod_{t=1}^n(1+y_t)})$


几何平均收益率的连续复利表示形式。


$\\mu = \\dfrac{1}{\\Delta t} \\ln (1+\\dfrac{1}{n}\\sum_{t=1}^n y_t)$


算术平均收益率的连续复利表示形式。


$\\sigma^2 = \\dfrac{1}{\\Delta t}\\dfrac{1}{n}\\sum_{t=1}^n (y_t-\\bar y)^2$


$Var(S_t) = S_0^2e^{2\\mu t}(e^{\\sigma^2t}-1)$


为历史价格数据的统计分析，提供理论依据，包括收益率水平和标准差的样本估计。• 为未来价格的模拟分析，提供理论模型（即几何布朗运动），为股票期权的定价分析奠定理论基础


# 04 投资风险偏好分析


金融投资规划的基本特征，是基于不确定情景的最优化决策。– 对于确定型的最优化问题，模型参数都是确定的，所得到的最优方案也是明确无误地去达到目标的最优。– 而在不确定情景下做决策，对于什么是最优方案可能都难以讲清楚，例如，在某种情景下的最佳方案，在另外一种随机情景下可能就是一个糟糕的方案。


• 金融投资，是以牺牲消费和承担风险的代价换取收益的行为，其本质是一种风险投资。• 金融投资规划的关键，是对各项风险投资的优劣做出评判，进而做出选择。


## 期望效用准则 


从概念来看，金融投资收益的风险性和不确定性是有所不同的。前者已知各种可能性下的收益率及其发生概率；后者则只知道收益率的可能变化范围，但不知其发生的概率。• 实际中，关于概率的表达一直都呈现出主观色彩；通过引入主观概率，将不再对风险性和不确定性加以区别。


---


1. 可比性 2. 传递性3. 连续性4. 单调性5. 独立性假设：具有相同偏好的（无）风险投资之间，彼此可以替代。








A 优于 B 的充要条件是 A 的期望效用大于 B


## 风险厌恶分析


一方面，按期望收益准则，不论游戏价格是多少，游戏玩家一定会去玩的。因为玩一次游戏的期望收入为正无穷大！而游戏价格再高也不过是一个有限值。• 另一方面，经调查发现，当游戏价格超过 8 元时，没有学生愿意玩此游戏；多数学生愿意接受的价格为 2 至 3 元。• 这表明，游戏玩家的决策准则并不是期望收益最大准则。


从投资者的角度看，伯努里实际上是采用期望效用准则，将关于收益（奖金收入）的偏好与关于风险的偏好联系起来。• 在伯努里的解释中，采用对数形式的效用函数，可以验证该函数满足边际效用递减性质，接下来的部分将指出该性质实际上是对风险厌恶的一种表达。• 圣·彼得堡悖论所揭示的现象也表明，人们或多或少具有厌恶风险的行为习惯。


$\\Delta U = 0.5 U(r+\\Delta r) + 0.5 U(r-\\Delta r) - U(r)$


< 0，表明投资者不接受这样的净增风险，是厌恶风险的，称投资者在 r 处为 风险规避者。


越大，风险厌恶程度越高；


$\\pi := r - r_c$, 来度量风险厌恶的程度 $-\\Delta U$


$\\pi = -\\dfrac{\\Delta r^2}{2}\\dfrac{U''(r)}{U'(r)}$$A(r) = -\\dfrac{U''(r)}{U'(r)}$, $A(r)\\ge 0 \\Lrarr U''(r)\\le 0$


投资风险偏好的背后，是关于具有不确定性的投资收益的偏好。• 期望效用准则，将投资收益的偏好与投资风险的偏好联系起来。


• 非确定性投资环境中，收益率可以为负。• 效用值严格递增。• 边际效用可以是递减、递增、或不增不减，也可以是局部递增、局部递减、局部不增不减。


在进行金融投资规划时，一般会设定一个目标收益率。• 如果某项投资的期望收益率，正好就是投资者希望实现的目标收益率，它自然希望该项投资的风险水平越低越好。这是因为风险越小，他的目标实现的可靠性就越高。• 因此，在期望收益率接近其目标收益率的多个投资选项中，他自然选择风险水平最低的选项，即他是厌恶风险的


如果某项投资的期望收益率，显著高于投资者希望实现的目标收益率，那他是否一定会选择呢？回答是未必。– 当投资风险较低时，对他而言当然是有利的，因此会选。– 当投资风险较高时，他就需要评估对实现目标收益率的影响有多大，如果不大，他也会选；如果较大，就不选。这时，他可能就不怎么厌恶风险，反而可能会偏爱这样的风险，因为，这蕴含了更高收益的机会。


如果某项投资的期望收益率，显著低于投资者希望实现的目标收益率，那他是否一定不会选择呢？回答也是未必。– 当投资风险较低时，对他而言意味着几乎没有实现目标收益率的可能，例如收益率较低的无风险投资，因此不选。– 当投资风险较高时，他就需要评估对实现目标收益率的作用有多大，如果大，他也会选；如果不大，就不选。这时，他可能会偏爱这样的风险，因为，这增加了实现目标收益率的机会。


• 通过前面的分析，基于金融投资规划所设定的目标收益率，我们可以做出如下判断：– 在不同的期望收益率水平下，投资者持有的风险态度可能是不同的。– 在某个期望收益率水平 r 的附近，投资者的风险厌恶情况是比较稳定的，不会有大的变化，其效用特征表现为效用函数的四阶以上的高阶导数值几乎为零


面对金融产品未来现金流的不确定性，该如何做出金融投资决策？首先要看投资者对这种不确定性或风险性的态度，即在同等收益率水平下，投资者究竟是偏好高风险，还是厌恶高风险。• 为此，我们在给定的收益率水平下，用一个零风险的投资选项作为参照，并给出一个带净增风险的投资选项，根据投资者的最终选择，区分出投资者的风险厌恶类别，即风险规避型、风险中立型、风险偏好型。


• 进一步，给出风险厌恶程度的度量 A(r)，用效用函数U(r)的一、二、三阶导数来表达风险厌恶程度的大小及其变化趋势。• 以上关于风险厌恶分析的背后逻辑是，投资者遵循期望效用准则，而期望收益率准则只是其中的一个特例，即风险中立者的期望效用准则。• 所给出的五个公理假设，为期望效用准则的底层逻辑，既是期望效用准则的充分条件，也是风险厌恶分析的前提条件。

## 风险偏好的市场影响机制分析

金融产品的市场价值是形成其市场价格的主要依据，其 t 时刻的值为：

$PV_t = \\sum_{h=0}^\\infty \\dfrac{C_{t+h}}{1+R_{t,t+g}}$ 

$R$: 系统性风险 

$C$: 自身风险

因此，在同一金融市场中，未来现金流是形成金融产品具有不同市场价格的主要依据。• 影响金融产品价格的另一因素是投资者关于未来现金流的风险偏好，结果如下


 由风险规避者主导的市场价格低于 $E(PV_t)$


由此可见，在影响金融产品价格的因素中，既包括市场价值的客观因素，也包括风险偏好的主观因素。不同风险偏好的投资者对市场价格的作用如下：


 风险规避者，将拉低金融产品的市场价格。 风险偏好者，将抬高金融产品的市场价格。 风险中立者，将使市场价格沿着价值回归的趋势发展。


对于特定的投资者，所谓投资期 [ 0, t ]，是指他在现在时刻买进，并在未来 t 时刻抛出的投资计划。• 基于 St 的预期，投资者是否执行该计划，取决于现在时刻的价格 P0 ：价格越高，收益率越低；价格越低，收益率越高。


相对于他愿意接受的价格，如果前一天的价格 P-1 较高，他的报价将低于 P-1；当这样的投资者足够多时，将造成金融产品在价位 P-1 的购买力不足，从而形成一股价格打压的势力，使价格下跌（这样的结果正如他所愿），导致收益率上升。• 相对于他愿意接受的价格，如果前一天的价格 P-1 较低，他显然愿意接受；当这样的投资者足够多时，将造成金融产品在价位 P-1 的购买力过剩，从而形成一股价格拉动的势力，使价格上涨，导致收益率下降。


相同风险水平下，风险规避者将拉低金融产品的市场价位，提高投资收益率水平。• 相同风险水平下，风险偏好者将抬高金融产品的市场价位，降低投资收益率水平。• 只有风险中立者，才会使市场价格和投资收益率沿着市值回归的趋势发展。**• 因此在金融市场中，无论价格，还是收益率，均受到市场投资者风险偏好的影响。**


## “收益-风险” 组合效用分析


• 金融市场中，投资者一定是会去关注风险和收益的。如果对于风险和收益，你均不关注，那说明你不是投资者。• 风险中立者，只关注收益，不关注风险；风险规避者，更多关注风险；风险偏好者，更多关注收益。• 这一部分，将在效用准则的决策框架下，构建一个关于收益和风险的效用函数。


在金融投资规划的决策中，投资者效用函数的高阶导数值近似为零，因此，可得期望效用的近似估计如下：


$E[U(R)] = U(R) + \\dfrac{U''(r)}{2!}\\sigma^2 := U(r,\\sigma)$由此得到一个关于收益率水平和标准差的函数。

$\\dfrac{\\partial U(r,\\sigma)}{\\partial \\delta} < 0 \\Lrarr U''(r) < 0$

• 这表明，标准差可作为风险的一种度量。• 因此，基于期望效用准则的决策，其实质是关于收益与风险之间进行权衡的过程


# 投资组合理论


• 金融投资规划的基本目标，是按可靠性最高的要求来实现预定的目标收益率。• 统计上，我们可采用标准差来度量可靠性程度，即标准差越小，可靠性越高。• 因此，满足这一要求的具体实现方式如下：首先，将目标收益率设为期望收益率；然后，按收益率标准差最小的目标，优选出一个投资组合。


## 投资组合的数学模型

① 单期投资组合决策② 不考虑交易费和税收③ 证券的交易量无限可分④ 投资者为价格接受者，不会影响市场价格⑤ 投资者为风险规避者，表示对目标收益率的可靠性要求。

最小方差组合的求解模型如下：

$ \\begin{array}{r}\\sigma_{P}^{2}\\left(r_{P}\\right)=\\operatorname{Min} \\quad x^{T} Q x \\\\ \\text { s.t. } \\quad \\mathbf{r}^{T} x=r_{P} \\\\ \\mathbf{1}^{T} x=1\\end{array} $




（唯一）最优解： $ \\bar{x}=Q^{-1}\\left(\\lambda_{1} \\cdot \\mathbf{1}+\\lambda_{2} \\cdot \\mathbf{r}\\right) $最优值：$ \\sigma_{P}^{2}\\left(r_{P}\\right)=\\lambda_{1}+\\lambda_{2} r_{P} $其中，$\\begin{array}{c}\\lambda_{1}=\\frac{c r_{P}-b}{c^{2}-a b} \\quad \\lambda_{2}=\\frac{c-a r_{P}}{c^{2}-a b} \\\\a=\\mathbf{1}^{T} Q^{-1} \\mathbf{1}, b=\\mathbf{r}^{T} Q^{-1} \\mathbf{r}, c=\\mathbf{r}^{T} Q^{-1} \\mathbf{1}\\end{array}$


任取 $ r_{S} 、 r_{T}\\left(r_{S} \\neq r_{T}\\right) $ ，由模型（5－1）得到组合 $ S, T $ ：$R_{S}=\\mathbf{R}^{T} \\bar{x}_{S} \\quad R_{T}=\\mathbf{R}^{T} \\bar{x}_{T}$

其中，$\\begin{array}{ll}\\bar{x}_{S}=Q^{-1}\\left(\\lambda_{S, 1} \\cdot \\mathbf{1}+\\lambda_{S, 2} \\cdot \\mathbf{r}\\right) & \\bar{x}_{T}=Q^{-1}\\left(\\lambda_{T, 1} \\cdot \\mathbf{1}+\\lambda_{T, 2} \\cdot \\mathbf{r}\\right) \\\\\\lambda_{S, 1}=\\frac{c r_{S}-b}{c^{2}-a b} & \\lambda_{T, 1}=\\frac{c r_{T}-b}{c^{2}-a b} \\\\\\lambda_{S, 2}=\\frac{c-a r_{S}}{c^{2}-a b} & \\lambda_{T, 2}=\\frac{c-a r_{T}}{c^{2}-a b}\\end{array}$


则对于任意的 $ r_{P} $ ，取$w=\\frac{r_{P}-r_{T}}{r_{S}-r_{T}}$

得模型（5－1）的解如下：$\\begin{array}{ll}R_{P}=w R_{S}+(1-w) R_{T} & \\sigma_{P}^{2}\\left(r_{P}\\right)=\\lambda_{P, 1}+\\lambda_{P, 2} r_{P} \\\\r_{P}=w r_{S}+(1-w) r_{T} & \\lambda_{P, 1}=w \\lambda_{S, 1}+(1-w) \\lambda_{T, 1} \\\\\\bar{x}_{P}=w \\bar{x}_{S}+(1-w) \\bar{x}_{T} & \\lambda_{P, 2}=w \\lambda_{S, 2}+(1-w) \\lambda_{T, 2}\\end{array}$


**两基金分离定理：模型（5-1）的解中，可由两个基金组合，通过线性组合的方式得到其他所有组合。**

由于金融投资规划是一个长期投资的过程，而做空只是一种短期行为，所以，在规划阶段所考虑的投资组合问题，是不允许做空的。因此，关于金融投资规划的投资组合最优化模型如下：

(MV模型)

$ \\begin{aligned} \\sigma_{P}^{2}\\left(r_{P}\\right)= & \\operatorname{Min} \\quad x^{T} Q x \\\\ \\text { s.t. } & \\mathbf{r}^{T} x=r_{P} \\\\ & \\mathbf{1}^{T} x=1 \\\\ & x \\geq 0\\end{aligned} $

## 投资组合的有效前沿

• MV 模型表达了在金融投资规划中，给定目标收益率下的最优投资组合问题。• 接下来，将考虑金融投资规划的另一个问题，即目标收益率的设定问题。

－在不同的目标收益率 $ r_{P} $ 下，投资（规划）者总是去关注可实现的最小标准差 $ \\sigma_{P} $ 。－因此，目标收益率的设定问题，实际上就是在关于 $ r_{P} $ 的曲线函数 $ \\sigma_{P}\\left(r_{P}\\right) $ 中，选择一个（ $ \\sigma_{P}, r_{P} $ ）组合的问题。

－有效前沿的计算模型任给 $ r_{\\text {min }} \\leq r_{P} \\leq r_{\\text {max }} $ ，求解$\\begin{array}{c}\\sigma_{P}^{2}\\left(r_{P}\\right)=\\operatorname{Min} x^{T} Q x \\\\\\text { s.t. } \\mathbf{r}^{T} x=r_{P} \\\\\\mathbf{1}^{T} x=1 \\\\x \\geq 0\\end{array}$

其中，$ r_{\\text {min }}={\\underset{j=1,2, \\ldots, n}{\\text { Min }}}_{n} r_{j}, r_{\\text {max }}={\\underset{j=1,2, \\ldots, n}{\\text { Max }}}_{\\text {max }} r_{j} $


注意到：当 $ r_{p} \\rightarrow r_{\\text {min }} $ 时,$ r_{P}=\\sum_{r_{j} \\leq r_{P}} x_{j} r_{j}+\\sum_{r_{j}>r_{P}} x_{j} r_{j} \\rightarrow \\sum_{r_{j} \\leq r_{P}} x_{j} r_{j} $当 $ r_{P} \\rightarrow r_{\\text {max }} $ 时,$ r_{P}=\\sum_{r_{j}<r_{P}} x_{j} r_{j}+\\sum_{r_{j} \\geq r_{P}} x_{j} r_{j} \\rightarrow \\sum_{r_{j} \\geq r_{P}} x_{j} r_{j} $由此得到曲线 $ \\sigma_{P}\\left(r_{P}\\right) $ 的几何特征如下：－随着 $ r_{P} $ 从 $ r_{\\text {min }} $ 开始递增，模型的求解空间逐渐变大，此时，$ \\sigma_{P} $ 随 $ r_{P} $ 递减；－随着 $ r_{P} $ 从 $ r_{\\text {max }} $ 开始递减，模型的求解空间逐渐变大，此时，$ \\sigma_{P} $ 随 $ r_{P} $ 递增；－在拐点处，$ \\sigma_{P} $ 达到最小。

曲线函数 $ \\sigma\\left(r_{P}\\right) $ 表示了由 $ n $ 只股票提供的（风险，收益）组合的边界。

其上半部分表现为“高风险-高收益”，反映了每减少（或增加）一单位风险所减少（或增加）的收益数量，称为 有效前沿。

• 对于风险规避者而言，他更多关注风险，将在给定收益率水平下，选择风险水平最低的投资组合。因此，他所选择的（风险，收益）组合必将落在有效前沿上。


对于风险偏好者而言，他更多关注收益，将在给定风险水平下，选择收益率水平最高的投资组合。因此，如果不是极端偏好风险，他所选择的（风险，收益）组合也将落在有效前沿上。

## 投资组合的最优选择


目标收益率的设定问题，可归结为在有效前沿中，关于＂收益－标准差＂组合的效用决策问题，即$\\underset{r_{\\min } \\leq r_{p} \\leq r_{\\max }}{\\operatorname{Max}} \\quad U\\left(r_{P}, \\sigma_{P}\\left(r_{P}\\right)\\right)$

根据第 04 讲关于投资期望效用的近似估计，有$\\underset{r_{\\min } \\leq r_{P} \\leq r_{\\max }}{\\operatorname{Max}} U\\left(r_{P}, \\sigma_{P}\\left(r_{P}\\right)\\right)=\\underset{r_{\\min } \\leq r_{P} \\leq r_{\\max }}{\\operatorname{Max}} U\\left(r_{P}\\right)+\\frac{U^{\\prime \\prime}\\left(r_{P}\\right)}{2} \\sigma_{P}^{2}\\left(r_{P}\\right)$




无差异曲线反映了投资者为减少一单位风险所愿意放弃的收益的数量，或要多承担一单位风险所要求得到的收益补偿的数量


无差异曲线方程： $U(r,\\theta) = u$

### 资本资产线

考虑在投资组合选择中，新增一种无风险资产（例如，相同期限的国债），其收益率为 rf ，收益率方差为 0。

经过点（0, rf） 做一条关于有效前沿的切线 ，切点为 Q。

注意到这条切线位于有效前沿上方。• 对于风险规避者，这条切线上的（风险，收益）组合，为给定收益率水平下风险水平最低的投资组合。• 对于风险偏好者，这条切线上的（风险，收益）组合，为给定风险水平下收益率水平最高的投资组合。• 因此，在允许做空的市场中，无论风险规避者，还是风险偏好者，都将在这条切线上选择一个（风险，收益）组合。




这条适用于各种风险偏好者的切线，表达了投资者在风险资本证券组合与无风险资产之间的资金分配，因此，称为资本资产线 (Capital Asset Line, CAL)


$ r=r_{f}+\\sigma \\cdot \\frac{r_{Q}-r_{f}}{\\sigma_{Q}} $


基于资本资产线，投资者可以独立进行风险投资决策与无风险资产融资决策，即 投融资分离原理： 在风险证券投资决策上，对于给定的 n 只股票，所有投资者将得到完全相同的有效前沿，并一致选择风险证券组合 Q（与投资者偏好无关）。 在无风险资产融资决策上，投资者根据自己的偏好，在 CAL 上选择一个关于 Q 与无风险证券的投资组合（与投资者偏好有关） 。

## 投资组合的风险分散效应


• 投资风险管理经常会用到两种策略：风险分散和风险对冲。• 风险分散是利用证券间不相关的部分，以及组合中证券的数量优势，来降低波动性风险的一种风险管理策略。特别地，当证券间呈弱相关时，风险分散的效果最为明显。• 风险对冲则是利用证券间相关的关系，来冲销波动性风险的一种风险管理策略。特别地，当证券间呈显著负相关，或者在允许做空的前提下当证券间呈显著正相关时，风险对冲的效果最为明显。


• 在一个投资组合中，可能既有风险分散的考量，又有风险对冲的考量。二者的区分主要体现在证券的选取上。• 风险对冲要求所选取的证券之间呈强相关，其中，正相关的两只证券可通过做空来实现风险对冲，因此适用模型为模型（5-1）。• 风险分散要求所选取的证券之间呈弱相关，并且要求组合的证券数量要达到一定规模。由于风险分散的目标并不是通过做空来实现的，因此适用模型为模型（5-2）。


通过两只股票的组合分析，了解风险对冲与风险分散的区分$\\begin{array}{l}R_{P}=w R_{1}+(1-w) R_{2} \\\\\\sigma_{P}^{2}=w^{2} \\sigma_{1}^{2}+(1-w)^{2} \\sigma_{2}^{2}+2 w(1-w) \\rho \\sigma_{1} \\sigma_{2} \\\\=\\left(\\sigma_{1}^{2}+\\sigma_{2}^{2}-2 \\rho \\sigma_{1} \\sigma_{2}\\right)\\left(w-\\frac{\\sigma_{2}^{2}-\\rho \\sigma_{1} \\sigma_{2}}{\\sigma_{1}^{2}+\\sigma_{2}^{2}-2 \\rho \\sigma_{1} \\sigma_{2}}\\right)^{2} \\\\+\\frac{\\sigma_{1}^{2} \\sigma_{2}^{2}\\left(1-\\rho^{2}\\right)}{\\sigma_{1}^{2}+\\sigma_{2}^{2}-2 \\rho \\sigma_{1} \\sigma_{2}}\\end{array}$

不妨设 $ \\sigma_{1} \\leq \\sigma_{2} $


利用证券间不相关的部分，能够通过组合来分散风险，以及随着组合中证券数量的增加，风险分散的效果将得以增强的这一事实，称为投资组合的风险分散效应。

首先考虑股票之间互不相关的情形，得 $ Q $ 为对角阵：$Q=\\operatorname{diag}\\left(\\sigma_{1}^{2}, \\sigma_{2}^{2}, \\ldots, \\sigma_{n}^{2}\\right)$

则使收益率方差达到最小的组合 $ P $ 为：$\\begin{array}{l}\\sigma_{P}^{2}=\\left(\\sum_{j=1}^{n} 1 / \\sigma_{j}^{2}\\right)^{-1} \\\\\\bar{x}_{j}=\\frac{\\sigma_{P}^{2}}{\\sigma_{j}^{2}}>0 \\quad j=1,2, . ., n\\end{array}$


设$\\sigma_{j}^{2}<c \\quad j=1,2, \\ldots, n$

则有$\\sigma_{P}^{2}<\\left(\\sum_{j=1}^{n} 1 / c\\right)^{-1}=\\frac{c}{n} \\rightarrow 0 \\quad(n \\rightarrow \\infty)$

可见，当 $ n $ 足够大时，可使组合 $ P $ 的收益率方差趋于零。




• 由此可见，当股票的收益率互不相关时，股票组合中包含的股票个数越多，组合收益率方差越小，并且趋于零。• 这也揭示出通过构建股票组合来实现风险分散的一个基本途径，即：从相关性较小的股票中寻找分散风险机会。


实际中，这 $ n $ 只股票的收益率都具有一定的相关性，这时，组合 $ P $ 的收益率方差为：$\\sigma_{P}^{2}=\\sum_{i=1}^{n} \\sum_{j=1}^{n} \\sigma_{i j} / n^{2}=\\sum_{j=1}^{n} \\sigma_{j}^{2} / n^{2}+2 \\sum_{i=1}^{n} \\sum_{j=i+1}^{n} \\sigma_{i j} / n^{2}$

定义平均协方差： $ \\bar{Q}=\\frac{\\sum_{i=1}^{n} \\sum_{j=i+1}^{n} \\sigma_{i j}}{(n-1) n / 2} $ ，则有$\\sigma_{P}^{2}=\\frac{1}{n} \\cdot \\bar{\\sigma}^{2}+\\frac{n-1}{n} \\cdot \\bar{Q} \\Rightarrow \\lim _{n \\rightarrow \\infty} \\sigma_{P}^{2}=\\bar{Q}$


• 由此可见，在实际的股票市场中，由于股票的收益率之间具有不同程度的相关性，所构建的股票组合收益率方差，不会随股票个数的增加而趋于零，而是趋于一个反映股票市场整体相关性程度的平均协方差。• 由平均协方差所表示的风险为不可分散风险

• 之所以可以分散风险，是由于股票之间存在不相关的部分。• 之所以存在不可分散的风险，是由于股票之间存在相关的部分。


# 资本资产定价模型

考虑由股市中所有证券构成的证券组合，其有效前沿如下

假设存在一种无风险资产，其收益率为 rf ，收益率方差为 0，投资者可以不受头寸限制地持有其多头或空头。

经过点（0, rf ） 做一条关于有效前沿的切线 ，切点为 M。

这自然也是一条 CAL 线，在允许做空的市场中，所有投资者将在这条切线上选择一个（风险，收益）组合。

由于所有投资者所面临的实际情况是相同的，他们用于分析各只证券的收益和风险状况的历史资料和现实资料是相同的，我们可以假设他们对证券市场中所有证券的收益和风险状况的判断基本上是相同的。这就是所谓的一致性预期假设（Homogeneous expectations）。

**根据一致性预期假设，所有投资者将构造出完全相同的有效前沿，且选择相同的组合 M，并将投资资金在无风险证券与组合 M 之间做适当的分配。**

• 进一步根据一致性预期假设，市场将达到这样的均衡状态： 均衡状态下，点 M 对应的证券组合中将包含所有证券。（假如某证券不包括在组合 M 之列，意味着投资者都不会持有它，这只证券的价格自然就会下跌，通过提高它的期望收益率，直到它变得具有足够吸引力，以致包括在组合 M 之中为止。反之，假如组合M 中的某证券期望收益率过高，则形成供不应求的局面，这只证券的价格自然就会上涨，从而降低它的期望收益率。） 均衡状态下，点 M 对应的证券组合中，各证券的持有比例为其总市值在所有证券的总市值之和中所占的比例。（这是因为所有投资者投资于该证券的资金即为该证券的总市值）


• 当市场达到均衡状态时，所有投资者共同持有的组合 M，称为 **市场组合，**显然，M 为有效组合。• 因此，实际中，常用市场指数（如股指）作为市场组合的代表。

• 根据一致性预期假设，当市场达到均衡状态时，所有投资者都以市场组合作为自己的风险资产投资，并选择由市场组合 M 与无风险资产构成的组合，作为自己的最佳投资组合。• 这条适用于市场中所有投资者的切线，称为 资本市场线(Capital Market Line, CML)

$ r=r_{f}+\\sigma \\cdot \\frac{r_{M}-r_{f}}{\\sigma_{M}} $


- $ C M L $ 的斜率为：$ \\frac{\\partial r}{\\partial \\sigma}=\\frac{r_{M}-r_{f}}{\\sigma_{M}} $- 表明每个投资者都一致地使用相同的风险与收益的边际替代率来确定自己的投资组合。－可见，$ \\left(r_{M}-r_{f}\\right) / \\sigma_{M} $ 实际上就是风险的市场均衡价格，即在市场均衡时，投资者每增加（或减少）一单位的风险，就要增加（或减少）收益 $ \\left(r_{M}-r_{f}\\right) / \\sigma_{M} $ 作为补偿（或代价）。－因此，称之为风险价格。

－$ C M L $ 在纵轴上的截距为 $ r_{f} $ ，反映了资金的时间价值，即投资者愿意推迟消费而得到确定的未来收益的补偿。－因此，由 $ C M L $ 所代表的有效前沿上，各投资组合的收益水平，可表示为由如下两部分构成：\\begin{tabular}{|l|l|l|l|l|}\\hline \\multicolumn{5}{|c|}{收益水平 $ = $ 时间价值 + 风险数量 $ \\times $ 风险价格} \\\\\\hline $ \\uparrow $ & $ \\uparrow $ & & $ \\uparrow $ & \\multirow{2}{*}{$ \\binom{\\uparrow}{\\left(r_{M}-r_{f}\\right) / \\sigma_{M}} $} \\\\\\hline $ r $ & $ r_{f} $ & & $ \\sigma $ & \\\\\\hline\\end{tabular}－由此可见，CML 揭示出资本市场具有风险配置的功能

－由$\\sigma_{M}^{2}=\\sum_{j=1}^{N} \\bar{x}_{j} \\sigma_{j M}$－可见（1）市场组合的风险仅取决于它与单个证券的收益率协方差。（2）$ \\sigma_{j M} $ 则表示证券 $ j $ 对市场组合风险的贡献度。

－在市场达到均衡状态时，风险价格$\\frac{r_{M}-r_{f}}{\\sigma_{M}}$

表达了投资者关于单位风险的收益诉求。

－综合下面的（1）和（2）：$\\begin{array}{r}r_{M}-r_{f}=\\sum_{j=1}^{N} \\bar{x}_{j} \\cdot\\left(r_{j}-r_{f}\\right) \\\\\\sigma_{M}^{2}=\\sum_{j=1}^{N} \\bar{x}_{j} \\sigma_{j M} \\Rightarrow 1=\\sum_{j=1}^{N} \\bar{x}_{j} \\cdot \\frac{\\sigma_{j M}}{\\sigma_{M}^{2}}\\end{array}$

可见，投资者的这种诉求，同时也表达了投资者关于证券 $ j $ 对组合风险有贡献的部分的收益诉求。

－在市场达到均衡时，有：$r_{j}-r_{f}=\\frac{\\sigma_{j M}}{\\sigma_{M}^{2}} \\cdot\\left(r_{M}-r_{f}\\right)=\\beta_{j} \\cdot\\left(r_{M}-r_{f}\\right)$

其中，$ \\beta_{j}=\\frac{\\sigma_{i M}}{\\sigma_{M}^{2}} $ 称为证券 $ j $ 的 $ \\beta $ 系数上式便是著名的资本资产定价模型 （ Capital Asset Pricing Model，CAPM）

### 系统风险度量

－对于市场组合 $ M:\\left(\\bar{x}_{1}, \\bar{x}_{2}, \\ldots, \\bar{x}_{N}\\right), \\sigma_{M}^{2} $ 是全部系统风险的表现，由 $ \\sigma_{M}^{2}=\\sum_{j=1}^{N} \\bar{x}_{j} \\sigma_{j M} $ 可知，$ \\sigma_{j M} $ 是证券 $ j $ 对系统风险的贡献－根据 CAPM 模型，可以用 $ \\sigma_{M}^{2} $ 为单位来衡量证券（组合）$ j $的系统风险的大小，即 $ \\beta_{j}=\\sigma_{j M} / \\sigma_{M}^{2} $ 。特别地，市场组合 $ M $ 的系统风险为 $ \\beta_{M}=\\sigma_{M M} / \\sigma_{M}^{2}=1 $ 。－因此，CAPM 模型是以市场组合 $ M $ 的风险作为系统风险的标准，其他各证券（组合）的系统风险均可用其相对于这一标准的大小 $ \\beta $ 来衡量。


－当市场达到均衡状态时，根据 CAPM 模型，证券 $ j $ 的实际收益率，为市场根据其 $ \\beta $ 值所表示的系统风险的大小，所给予的风险补偿，即：$ r_{j}=r_{f}+\\beta_{j} \\cdot\\left(r_{M}-r_{f}\\right) $ 。－另一方面，当市场达到均衡状态时，证券 $ j $ 的非系统风险部分，在市场中呈现出来的实际收益率则为零，因此，为证券 $ j $ 的净增风险。

－关于证券 $ j $ 的总风险 $ \\sigma_{j} $ ，有$\\begin{aligned}\\sigma_{j} & =\\rho_{j M} \\sigma_{j}+\\left(1-\\rho_{j M}\\right) \\sigma_{j} \\\\& =\\frac{\\sigma_{j M}}{\\sigma_{M}}+\\left(1-\\rho_{j M}\\right) \\sigma_{j}\\end{aligned}$

系统风险部分 非系统风险部分（在市场达达到均衡时，非系统风险为净增风险）

## 证券市场线

CAPM 模型表达了市场根据证券对市场组合风险的贡献程度，所给予的风险补偿，即 $ r_{i}=r_{f}+\\left(r_{M}-r_{f}\\right) \\beta_{i} $ 。

这是一个直线方程，称为证券市场线（Security Market Line，SML），它在＂$ \\beta-r $＂坐标系 下表示如下：

$r_{i}=r_{f}+\\left(r_{M}-r_{f}\\right) \\beta_{i}$－SML 表达了市场对于单个证券或证券组合，基于 $ \\beta $ 系数的一种风险补偿方式：$ \\beta $ 越大，所获得的风险补偿越多，这也意味着与市场有关的风险越高。－可见，$ \\beta $ 也可用来度量风险。具体来说，$ \\beta $ 可用来度量与市场有关的那部分风险，在这个市场中，这部分风险是不可分散的，我们称为市场风险或系统风险。

$r_{i}=r_{f}+\\left(r_{M}-r_{f}\\right) \\beta_{i}$$ \\beta $ 系数也反映了证券对市场波动的敏感性：※若 $ \\beta $ 系数大于 1 ，则证券将在牛市时比市场更牛，而在熊市时比市场更熊，称为进取型证券。※ 若 $ \\beta $ 系数小于 1 ，则无论是牛市还是熊市，证券的表现都要比市场温和，称为防守型证券。

－通过 CAPM 模型得出 $ \\beta_{i} $ 的估计值，可能不等于那一时期存在的真实值，即存在估计误差。- 这一过程因为 $ \\beta_{i} $ 随时间变化而更加复杂。- 检验 $ \\beta_{i} $ 估计的准确性，常用的方法是：查看某一期 $ \\beta $与其相邻时期 $ \\beta $ 的正相关性。相关性越强，则准确性越高。

## 小结

• 一致性预期假设下，演绎出市场均衡、市场组合及市场风险的概念。• 市场达到均衡时， 投资者只关注市场组合的整体风险，以及证券的收益率均值。 证券的波动性风险中，客观上存在与市场无关的部分。然而，无论它有多高或多低，由于它没有影响到市场组合的整体风险，因而不会被投资者关注，投资者自然也不会对这部分风险提出补偿要求。 因此，证券的收益率均值，完全等于与它对市场组合风险的贡献度相称的风险补偿。

• 市场均衡状态是市场这只无形的手所指向的趋势方向。• 实际中的市场永远是在走向均衡的路上！• 市场组合，是将所有证券纳入进来，并被所有投资者一致认同的证券组合，能够全权代表整个市场。• 之所以选用市场指数（如股指）作为市场组合的代表，主要是因为它与市场组合在结构上基本一致，总体上可以反映市场的整体情况，其变化趋势可以反映市场的发展趋势

• CAPM 模型的实际意义在于，能够对证券的市场风险部分做出识别和度量。• 实际中，在市场走向均衡的路上，我们可以合理利用证券与市场指数的相关关系，来对其市场风险部分做出近似的识别和度量。• 这时，证券的收益率均值，不再严格等于其市场风险部分的风险补偿。

## 证券特征线

统计上，证券（组合）$ j $ 的 $ \\beta $ 值为如下回归模型中的斜率：$R_{j}-r_{f}=\\alpha_{j}+\\beta_{j} \\cdot\\left(R_{M}-r_{f}\\right)+e_{j}$- $ \\alpha_{j} $ 为常数项，表示非市场因素的期望收益率；- $ \\beta_{j} \\cdot\\left(R_{M}-r_{f}\\right) $ 表示市场因素；$ >e_{j} $ 表示非市场因素的随机性，$ E\\left(e_{j}\\right)=0 $ ；$ >\\operatorname{COV}\\left(R_{M}, e_{j}\\right)=0 $ 。


称这条回归直线为证券 $ j $ 的证券特征线（Security Characteristic Line，SCL）$\\left(\\hat{R}_{j}-r_{f}\\right)=\\alpha_{j}+\\beta_{j} \\cdot\\left(R_{M}-r_{f}\\right)$

其中，当常数项非零时，表示证券 $ j $ 的表现不同于市场的差异部分，长期来看，在市场均衡的趋势作用下，这是不可持续的，因此，称为证券 $ j $ 的错误定价：$ * \\alpha_{j}>0 $ 表示证券j被低估$ * \\alpha_{j}<0 $ 表示证券 $ j $ 被高估$ \\star \\alpha_{j}=0 $ 表示证券 j 被正确定价

## 评估

• 证券组合业绩评估的基本思路： 考察证券组合的单位风险收益率 考察经风险调整之后的收益率• 证券组合业绩评价的风险指标： 总风险，通常用收益率标准差来度量 系统风险，通常用贝塔系数来度量

夏普（Sharpe）比率法是指用证券组合的风险收益率 （均收益率－无风险利率）除以这个时期的风险值（收益率标准差），表示在评估期内获得的单位风险报酬

夏普比率：$ P I_{S}=\\frac{r_{P}-r_{f}}{\\sigma_{P}} $$ r_{P} $ ——均收益率$ r_{f} $ ——无风险利率$ \\sigma_{P} $ ——收益率标准差


特雷诺（Treynor）比率法指因承担系统风险而得到的收益，是一种基于证券市场线的业绩评估方法。

特雷诺比率：$ P I_{T}=\\frac{r_{P}-r_{f}}{\\beta_{P}} $$r_{P} \\approx r_{f}+\\left(r_{M}-r_{f}\\right) \\beta_{P} \\Rightarrow \\frac{r_{P}-r_{f}}{\\beta_{P}} \\approx r_{M}-r_{f}$


为了提供对所有组合进行评价的基准，夏普提出了一个以市场组合（资本市场线）为基准的评价方法。－首先，根据 CAPM 理论，资本市场线反映了证券组合在各风险水平下的＂正常＂收益率。根据证券组合的风险水平，可以在资本市场线上找到一个＂应得收益率＂。－然后，比较证券组合的实际均收益率与＂应得收益率＂：$\\left\\{r_{P}\\right\\} v s \\quad\\left\\{r_{f}+\\sigma_{P} \\cdot \\frac{r_{M}-r_{f}}{\\sigma_{M}}\\right\\}$

实际均收益率 大于＂应得收益率＂：表明组合业绩好于市场指数业绩实际均收益率 等于＂应得收益率＂：表明组合业绩相当于市场指数业绩实际均收益率 小于＂应得收益率＂：表明组合业绩劣于市场指数业绩

－詹森（Jensen）以评估期内的证券市场线为基准，通过考察证券组合收益率与在相同系统风险水平下市场组合收益率的差异来进行业绩评估。

詹森业绩指数：$ P I_{J}=\\hat{\\alpha}_{P}: R_{P t}-r_{f}=\\hat{\\alpha}_{P}+\\hat{\\beta}_{P}\\left(R_{M t}-r_{f}\\right)+e_{P t} $$ P I_{J}>0 $ ：表明基金投资业绩好于市场指数业绩$ P I_{J}=0 $ ：表明基金投资业绩相当于市场指数业绩$ P I_{J}<0 $ ：表明基金投资业绩劣于市场指数业绩

－ $ \\mathrm{M}^{2} $ 测度法由李•莫迪格里亚尼（Leah Modigliani）与她的祖父弗兰克•莫迪格里亚尼（Franco Modigliani）共同提出，其基本思想是：－利用证券组合 P 与无风险资产构建一个与市场组合有相同收益率标准差的组合 Q ；－然后，将 Q 的收益率与市场组合的收益率进行比较，两者之差 （即 $ \\mathrm{M}^{2} $ ）则表示证券组合 P 比市场组合优劣的程度。－ $ \\mathrm{M}^{2}>0 $ 表示证券组合 P 的业绩优于市场指数的业绩。

# 套利定价理论 无套利均衡

• 上一讲根据一致性预期假设，通过市场达到均衡状态时的演绎分析，提出市场组合的概念，进而得到资本市场线和证券市场线（即 CAPM 模型），从理论上给出市场给予证券的风险补偿，将市场这只无形的手展示出来。• 然而，从理论到实际，将面临这样的尴尬境地：实际中并没有一套可信的方法，来证实其理论假设的成立！而证实理论假设不成立的方法倒是不少。


• 这一讲，将从实际出发，利用资本证券不同于普通商品的特征，通过归纳分析，揭示出市场给予证券的风险补偿。• 其基本逻辑是：由于资本市场中可以很快发现套利的空间，因此，市场中具有同样风险性质的两只证券，应当提供相同的回报；在这样的市场中，就应该可以建立起证券与市场指数的关系模型，即定价模型。

## 一价定律

两件完全一样的商品只能按照一个价格交易

• 在完善的金融市场中，同一产品应只有一个价格。如果同一只债券在安徽和上海均可交易，则这两个地域的市场为统一的一个市场，不存在所谓的细分市场。• 这与普通商品市场不同。在普通商品市场中，由于存在物流成本、消费群体差异等因素，同一商品在各个细分市场中具有不同的价格是完全可能的。

• 无论是投资者，还是套利者，其中任何一股力量都可使这两只债券的价格趋于一致。因此，基于市场允许做空这一假设的无套利均衡定价分析不失一般性。


• 套利与投资这两种行为既有联系也有区别。• 投资组合中，即使有做空，也一定是需要投资资金的。因此，才有组合收益率的概念。• 套利策略，则是由一个投资组合的多头，与另一个对等的投资组合空头构成，几乎是零资金投入。因此，没有收益率的概念。• 经常会有将套利策略称为套利组合的提法，容易引起理解上的混乱，本讲暂不采用这种提法。


## 套利机会与策略分析


• 在成熟的金融市场中，几乎不会有明显的套利机会。• 一般可采用市值分析的方式，通过模型计算来发现套利机会：如果通过计算得到组合 A 和 B 在未来 T 时刻的市值具有确定的大小关系，而在现在 t 时刻的市值具有不一致的大小关系，则表明这是一个套利机会。• 在构建套利策略之后，可采用现金流分析的方式，分析其收入情况。


• 一般的市场中，如果不存在零投资、零风险、正现金流的套利机会，则称为 无套利均衡市场。• 特别地，在资本市场中，如果不存在零风险，且收益率不同于无风险利率的证券组合，或者说当所有零风险组合的收益率均等于无风险利率时，则为无套利均衡市场。


－下面的结论表明，风险证券市场中，一般不存在零风险组合。

风险证券市场中，不存在零风险组合的等价表述有：（1）对于任意的组合 $ P $ ，均有 $ \\sigma_{P}^{2}>0 $（2）协方差矩阵 $ Q $ 为正定阵（3）对于任意两个不同的组合 $ S $ 和 $ T $ ，均有 $ \\left|\\rho_{S, T}\\right| \\neq 1 $


实际中，如果一个证券组合 $ P $ 的收益率标准差足够小（例如，小于预先设置的阈值 $ \\delta $ ，即 $ \\left.\\sigma_{P} \\leq \\delta\\right) $ ，且收益率均值与无风险利率的绝对偏差足够大（例如，大于预先设置的阈值 $ \\varepsilon $ ，即 $ \\left.\\left|r_{P}-r_{f}\\right|>\\varepsilon\\right) $ ，则可进行近似于零风险的套利如下：－当 $ r_{P}>r_{f}+\\varepsilon $ 时，持有组合 $ P $ 的多头，以及无风险证券空头，获得套利收入 $ r_{P}-r_{f} $ 。－当 $ r_{P}<r_{f}-\\varepsilon $ 时，持有组合 $ P $ 的空头，以及无风险证券多头，获得套利收入 $ r_{f}-r_{P} $ 。

于是，对于风险证券市场，设 $ \\delta $ 和 $ \\varepsilon $ 为预先设置的阈值，给出无套利均衡市场的定义如下：

如果市场中任何满足 $ \\sigma_{P} \\leq \\delta $ 的证券组合 $ P $ ，均有 $ \\left|r_{P}-r_{f}\\right| \\leq \\varepsilon $ ，则称为 无套利均衡市场。

考虑任意证券（或组合）$ j $ 与无风险证券构成的组合 $ P $ ：$$R_{P}=w R_{j}+(1-w) R_{f} \\quad w \\geq 0$$

当取 $ w=\\delta / \\sigma_{j} $ 时，有 $ \\sigma_{P}=\\delta $ 。在无套利均衡市场中，则有$$\\left|r_{P}-r_{f}\\right| \\leq \\varepsilon \\Rightarrow w\\left|r_{j}-r_{f}\\right| \\leq \\varepsilon \\Rightarrow \\frac{\\left|r_{j}-r_{f}\\right|}{\\sigma_{j}} \\leq \\frac{\\varepsilon}{\\delta}$$

表明市场沿无套利均衡方向发展的趋势，决定了所有证券收益基于自身风险，朝着 $ \\varepsilon / \\delta $ 设定的区间变化的趋势。

在无套利均衡市场中，- 当 $ \\sigma_{j} \\leq \\delta $ 时，必有 $ \\left|r_{j}-r_{f}\\right| \\leq \\varepsilon $ 。- 当 $ \\sigma_{j}>\\delta $ 时，则可能有 $ \\left|r_{j}-r_{f}\\right|>\\varepsilon $ 。这样的证券个数可能是少数，也可能是多数。

注：由于无套利均衡市场只涉及风险套利分析，未涉及风险投资分析，因而不需要对风险偏好做限制，因此同时满足 $ \\sigma_{j}>\\delta $ 和 $ r_{j}<r_{f}-\\varepsilon $ 的证券是存在的。

－在无套利均衡市场中，如果多数证券满足$$\\sigma_{j}>\\delta \\text { 且 }\\left|r_{j}-r_{f}\\right|>\\varepsilon$$

将在接下来的分析指出，这是由于具有这些证券共同面临的系统性风险所致。

# 充分分散组合

• 证券市场中，之所以存在不可分散的风险，是由于证券之间存在相关的部分，反映了证券共同面临的系统性风险。• 总体来看，若系统性风险能够用风险指数的形式来表示，则在无套利均衡市场中，我们将得到：证券的风险收益部分可表示为风险指数提供的风险补偿，称之为指数模型。• 关于风险指数的选取，可以不要求它影响到市场中所有的证券，但要求它应能够影响到市场中足够多的证券。


• 首先，通过证券组合的充分分散分析，明确“足够多证券”的数量要求。• 然后，利用投资组合的风险分散效应，给出无套利均衡定价的初步分析，即：当不存在风险指数时的定价分析。

－考虑由 $ n $ 只证券按等比例构成的组合 $ P $（为了区别于其他组合，称这样的组合为 I 类组合）：$$R_{P}=\\sum_{j=1}^{n} R_{j} / n$$－得$$\\sigma_{P}^{2}=\\frac{1}{n} \\cdot \\frac{\\sum_{j=1}^{n} \\sigma_{j}^{2}}{n}+\\frac{n-1}{n} \\cdot \\frac{\\sum_{i=1}^{n} \\sum_{j=i+1}^{n} \\sigma_{i j}}{n(n-1) / 2}$$

• 上式的求和项中，当 n 足够大，使得第一项接近于零时，便可以得到第二项就是一个不可分散风险（当不接近于零时），表示这 n 只证券共同面临的风险。• 可见，组合的充分分散程度体现在上式求和项中的第一项。

－如果 $ n $ 的大小满足：

市场中任意 $ n $ 只证券，均有$$\\frac{1}{n} \\cdot \\frac{\\sum_{j=1}^{n} \\sigma_{j}^{2}}{n} \\leq \\delta^{2}$$－则可以明确：由任意 $ n $ 只证券构成的 I 类组合都是充分分散的。

于是，将市场中所有 n 只以上（含 n ）证券构成的 I 类组合，称为 I 类充分分散组合。


－进一步，再明确：在不允许做空的条件下，由 I 类充分分散组合构成的组合也是充分分散的。－而当允许做空时，明确：市场中所有不少于 $ n $ 的 $ N $ 只证券与无风险证券，构成如下形式的组合 $ P $ ，都是充分分散的，并称为 II 类充分分散组合：$$R_{P}=-\\frac{1}{N} \\sum_{j=1}^{m} R_{j}+\\frac{1}{N} \\sum_{j=m+1}^{N} R_{j}+\\frac{2 m}{N} \\cdot r_{f}$$

－需要指出，由 II 类充分分散组合构成的组合，不能视为充分分散组合。－例如，由下列组合 $ S $ 和 $ T $ 按等比例构成的组合 $ P $ ，显然不能说是充分分散组合。$$\\begin{array}{l}R_{S}=-\\frac{1}{N} \\sum_{j=1}^{N-1} R_{j}+\\frac{1}{N} R_{N}+\\frac{2(N-1)}{N} \\cdot r_{f} \\\\R_{T}=\\frac{1}{N} \\sum_{j=1}^{N-1} R_{j}-\\frac{1}{N} R_{N+1}+\\frac{2}{N} \\cdot r_{f} \\\\R_{P}=\\frac{1}{2} R_{S}+\\frac{1}{2} R_{T}=\\frac{1}{2 N} R_{N}-\\frac{1}{2 N} R_{N+1}+r_{f}\\end{array}$$

• 综上，本讲所指的充分分散组合，包括以下三类组合： I 类充分分散组合； 在不允许做空的条件下，由 I 类充分分散组合构成的组合； II 类充分分散组合。

－如果市场中所有充分分散组合 $ P $ ，均满足 $ \\sigma_{P} \\leq \\delta $ ，则表明不存在能够影响到市场中足够多证券的风险指数。- 此时，在无套利均衡市场中，将得到以下结论：- 所有充分分散组合 $ P $ ，均满足 $ \\left|r_{P}-r_{f}\\right| \\leq \\varepsilon $ ；- 除了不足 $ n $ 个证券以外的其他所有证券 $ j $ ，均满足 $ \\left|r_{j}-r_{f}\\right| \\leq \\varepsilon $ 。

# 单指数定价模型

• 实际中，为了充分表达不可分散的风险，通常需要使用多个风险指数。• 为了加深理解起见，我们先考虑只有一个风险指数 I（称为市场指数）的情形，相应的模型称为单指数模型

－对任意的充分分散组合 $ P $ ，由（式 2）可得：$$\\sigma_{P}^{2}=\\beta_{P}^{2} \\cdot \\sigma_{I}^{2}+\\sigma_{e_{P}}^{2}$$－可见，组合 $ P $ 的总风险包括两个部分：第一部分是与市场指数相关的部分，第二部分是与市场指数不相关的部分。－单指数模型要求不可分散的风险部分应全部反映第一部分 （否则，就需要考虑多指数），于是提出第一个假设：

【假设 1】对于所有充分分散组合 $ P $ ，均满足 $ \\sigma_{e_{P}} \\leq \\delta $

－如果所有 I 类充分分散组合 $ P $ ，均有 $ \\beta_{P}=0 $ ，表明风险指数 $ I $ 能够影响到的证券个数达不到足够多的 $ n $个，则该指数也就没有存在的意义了。－于是，提出第二个假设：

【假设 2】存在一个 I 类充分分散组合 $ P $ ，满足 $ \\beta_{P} \\neq 0 $ 。


现任取一个 $ \\beta_{P} \\neq 0 $ 的 I 类充分分散组合 $ P $ ，考虑由 $ P $ 和无风险证券构成的证券组合 $ M $（显然 $ M $ 也是充分分散组合）：$$R_{M}=r_{f}+\\frac{1}{\\beta_{P}}\\left(R_{P}-r_{f}\\right)$$

得$$r_{M}=r_{f}+\\frac{1}{\\beta_{P}}\\left(r_{P}-r_{f}\\right)$$

将上面两个式子相减，并将（式 2）代入，在假设 1 下有$$R_{M}-r_{M} \\approx I$$

称 组合 $ M $ 为复制市场指数 $ I $ 的组合，显然 $ \\beta_{M}=1 $ 。

在满足假设 1 和 2 的无套利均衡市场中，除了不足 $ n $ 个证券以外的其他所有证券，以及所有充分分散组合 $ j $ ，均有$$r_{j}-r_{f} \\approx \\beta_{j} \\cdot \\lambda$$

其中，$ \\beta_{j}=\\frac{\\sigma_{j, I}}{\\sigma_{I}^{2}} $ 称为证券（组合）$ j $ 的 $ \\beta $ 系数 $ \\lambda=r_{M}-r_{f}, M $ 为复制 $ I $ 的证券组合


# 多指数定价模型

－单指数模型中，如果存在一个充分分散组合 $ P $ ，其收益率方差$$\\sigma_{P}^{2}=\\beta_{P}^{2} \\cdot \\sigma_{I}^{2}+\\sigma_{e_{P}}^{2}$$

不满足 $ \\sigma_{e_{P}} \\leq \\delta $ 。－则表明用单风险指数来表达不可分散的风险部分是不充分的。这时，便需要考虑多个风险指数。


正交性假设$$\\operatorname{COV}\\left(I_{l}, I_{k}\\right)=0 \\quad l \\neq k$$

注：实际中正交性假设不失一般性，这是因为可通过指数正交化变换而得到满足。


－对任意的充分分散组合 $ P $ ，由（式 2）可得：$$\\sigma_{P}^{2}=\\sum_{l=1}^{L} \\beta_{P l}^{2} \\cdot \\sigma_{I_{l}}^{2}+\\sigma_{e_{P}}^{2}$$－可见，组合 $ P $ 的总风险包括两个部分：第一部分是与指数相关的部分，第二部分是与指数不相关的部分。－指数模型要求不可分散的风险部分应全部反映于第一部分中 （否则，就需要考虑更多的指数），于是提出充足性假设：

对于所有充分分散组合 $ P $ ，均满足 $ \\sigma_{e_{P}} \\leq \\delta $




－考虑所有 I 类充分分散组合（设共有 $ K $ 个），记为 $ P_{1} $ ， $ P_{2}, \\ldots, P_{K} $ ，由（式2）得$$\\left(\\begin{array}{c}R_{P_{1}}-r_{P_{1}} \\\\R_{P_{2}}-r_{P_{2}} \\\\\\quad \\vdots \\\\R_{P_{K}}-r_{P_{K}}\\end{array}\\right)=\\left(\\begin{array}{cccc}\\beta_{P_{1}, 1} & \\beta_{P_{1}, 2} & \\cdots & \\beta_{P_{1}, L} \\\\\\beta_{P_{2}, 1} & \\beta_{P_{2}, 2} & \\cdots & \\beta_{P_{2}, L} \\\\\\vdots & \\vdots & \\ddots & \\vdots \\\\\\beta_{P_{K}, 1} & \\beta_{P_{K}, 2} & \\cdots & \\beta_{P_{K}, L}\\end{array}\\right)\\left(\\begin{array}{c}I_{1} \\\\I_{2} \\\\\\vdots \\\\I_{L}\\end{array}\\right)+\\left(\\begin{array}{c}e_{P_{1}} \\\\e_{P_{1}} \\\\\\vdots \\\\e_{P_{1}}\\end{array}\\right)$$


－记 $ B_{K}=\\left(\\begin{array}{cccc}\\beta_{P_{1,1}} & \\beta_{P_{1,2}} & \\cdots & \\beta_{P_{1, L}} \\\\ \\beta_{P_{2,1}} & \\beta_{P_{2,2}} & \\cdots & \\beta_{P_{2, L}} \\\\ \\vdots & \\vdots & \\ddots & \\vdots \\\\ \\beta_{P_{K}, 1} & \\beta_{P_{K}, 2} & \\cdots & \\beta_{P_{K}, L}\\end{array}\\right) $紧凑性假设$$\\operatorname{rank}\\left(B_{K}\\right)=L$$

注：实际中紧凑性假设也不失一般性，这是因为当 $ \\operatorname{rank}\\left(B_{K}\\right)<L $时，可将这 $ L $ 个指数组合为 $ \\operatorname{rank}\\left(B_{K}\\right) $ 个指数来等价表示。


再由（式 2），在充足性假设下，有$$\\left(\\begin{array}{c}R_{M_{1}}-r_{M_{1}} \\\\R_{M_{2}}-r_{M_{2}} \\\\\\quad \\vdots \\\\R_{M_{L}}-r_{M_{L}}\\end{array}\\right)=B_{L}^{-1} \\cdot\\left(\\begin{array}{c}R_{P_{1}}-r_{P_{1}} \\\\R_{P_{2}}-r_{P_{2}} \\\\\\vdots \\\\R_{P_{L}}-r_{P_{L}}\\end{array}\\right) \\approx\\left(\\begin{array}{c}I_{1} \\\\I_{2} \\\\\\vdots \\\\I_{L}\\end{array}\\right) \\text { (式 5) }$$

称组合 $ M_{1}, M_{2}, \\ldots, M_{L} $ 为复制指数 $ I_{1}, I_{2}, \\ldots, I_{L} $ 的组合。

在满足正交性、充足性、紧凑性假设的无套利均衡市场中，除了不足 $ n $ 个证券以外的其他所有证券，以及所有充分分散组合 $ j $ ，均有$$r_{j}-r_{f}=\\sum_{l=1}^{L} \\beta_{j l} \\cdot \\lambda_{l}$$

其中，$ \\beta_{j l}=\\frac{\\sigma_{j, M_{l}}}{\\sigma_{M_{l}}^{2}} $ 称为证券（组合）$ j $ 的 $ \\beta $ 系数 $ \\lambda_{l}=r_{M_{l}}-r_{f}, M_{l} $ 为复制 $ I_{l} $ 的证券组合

－如果向量组 $ \\alpha_{l}, \\alpha_{2}, \\ldots, \\alpha_{L} $ 线性相关，表明存在一些序列可以由其他序列线性表示，显然这些序列对应的指数是冗余的，应予以删除。－在正交化变换过程中，可以得到这些序列所对应的 $ \\gamma $ 向量将为零向量，可直接删除，同时删减相应的指数（该指数为冗余指数）。

思考：不存在冗余指数是否表明紧凑性假设成立？


# 金融期货与期权定价理论与方法


## 期货与期权合约

• 期货与期权是关于某种“货物”的“订单”合同。• 合同也称为合约，其基本构成要素有： 货物名称 —— 称为 合约标的 货物数量 —— 称为 合约规模 交割价格（报价方式） 交割日期 —— 称为 到期日 交割方式 —— 现金交割 或 实物交割

• 在金融市场中，将分别提供期货与期权的合同书模板，称为标准化合约，使得在签订合约时，合约中的某种价格成为模板中唯一可变的量，是市场中唯一的变量。• 每个合同书模板称为一个金融产品。4 合约本身来看，一旦签订，其中约定的所有条款（包括价格）都是不可改变的。 同一个合同书模板下，在不同时间签订的某一种价格是可变的。

• 期货合约中，双方的关系如下： 标的的购买方，称为多头方（Long Position） 标的的出售方，称为空头方（ Short Position） 期货合约规定了在到期日双方必须履行的交割义务 由于标的的（现货）市场价格上涨对多头方有利，而对空头方不利；反之，标的的市场价格下跌对空头方有利，而对多头方不利。因此，又称多头方为看涨的一方，空头方为看跌的一方。

• 期权合约中，双方的关系如下： 期权的持有方，称为多头方（Long Position） 期权的发行方，称为空头方（ Short Position） 期权合约规定了多头方执行选择权的权利，以及当多头方行权时空头方必须履行的交割义务 对于多头方而言，当期权类型为购买选择权时，标的的（现货）市场价格上涨是有利的，因此称这类期权为看涨期权；当期权类型为出售选择权时，标的的市场价格下跌是有利的，因此称这类期权为看跌期权。

• 在期货合约中，多头方为即将获得标的的一方，空头方为即将失去标的的一方。他们分别是看涨的一方和看跌的一方。• 在期权合约中，多头方为拥有选择权的一方，空头方为履行义务的一方。这项选择权为看涨期权和看跌期权中的一种。


• 无论多头方还是空头方，他们都可以一次性签订多份同样的合约，其份数的多少称为持仓量，并称多头方处于多头仓位，空头方处于空头仓位。• 一个投资者可以签订多份相同或不同的合约，他在这些合约中，可以是一部分为多头方，另一部分为空头方。• 通常，对于投资者签约的情况，用多头仓位的持仓量和空头仓位的持仓量来表达比较方便。

对于一个期货或期权产品，投资者可以改变自己的持仓量： 投资者在持仓量为零时的签约，称为 建仓； 当持仓量不为零时，投资者的签约使得持仓量增加，称为 增仓； 当持仓量不为零时，投资者的签约（反向对冲交易）使得持仓量减少，称为 减仓； 当持仓量不为零时，投资者反向对冲交易的签约使得持仓量为零，称为 平仓。

• 期货或期权合约双方的签约，为一次交易。• 期货与期权的交易在交易所内集中进行，交易双方由清算机构作为中介，进行背靠背的交易，双方不直接接触。• 对于多头方，清算机构充当空头方，与其签订合约；对于空头方，清算机构充当多头方，与其签订合约。• 从而间接实现了市场中的多头方与空头方之间的签约。


• 以清算机构为中介的交易方式，有三点是非常重要的。• 一是可以促进合约交易的快速达成。• 二是清算机构扮演着交易双方的保证人，将违约风险集中到由清算机构来承担，通过盯市结算制度和强制平仓措施来解决交易双方的违约风险问题。• 三是交易开始之前，可能违约的一方或双方须存入初始保证金；在每日盯市结算过程中，如果保证金账户的余额低于维持保证金水平，交易者必须把保证金水平补足到初始保证金水平，否则就会被强制平仓。

## 期货与期权套期保值功能

• 金融期货具有规避风险的功能。• 利用金融期货进行套期保值，是把未来不确定的市场价格加以锁定，以避免由于市场价格的不利变动而造成的损失。• 当然，其代价是放弃可能取得的额外收益。

• 金融期权具有转移风险功能。• 利用金融期权进行套期保值，可将价格变动的方向控制在对自己有利的一面。• 其代价是支付一笔期权费。期权的套期保值注：也可组合利用期权，将未来不确定的市场价格加以锁定，实现期货的套期保值功能。

- 某投资者计划在 $ T $ 时刻购买某股票，希望以低于 $ \\$ 46 $ 的价格买进。- 该投资者可持有以该股票为标的物的看涨期权多头，来进行套期保值。其中有一份看涨期权合约的报价信息如下：- 期权价格为 $ f=\\$ 6 $- 交割价格为 $ X=\\$ 40 $- 到期日：$ T $- 该投资者在到期日（用 $ S_{T} $ 表示到期日股票价格）的结果分析：- 若 $ S_{T}>40 $ ，则执行期权，即：以 $ \\$ 40 $ 的价格购买股票，加上期权费 \\＄6，实际以\\＄46的价格买进；－若 $ S_{T}<40 $ ，则放弃执行期权，实际以低于 $ \\$ 46 $ 的成本买进股票。

## 期货定价理论


- 期货价格 $ F_{t} $ ，是指 $ t $ 时刻签约时合约中约定的交割价格。- 以股票为标的为例：- 对于合约的多头方，可以在 $ t $ 时刻＂借入＂一只股票，将出售所得收入 $ S_{t} $ 用来购买无风险资产（净现金流为 0 ），然后在到期日 $ T $ ，出售无风险资产得到收入 $ S_{t} e^{r(T-t)} $ ，并按交割价格 $ F_{t} $＂偿还＂这只股票（净现金流为 $ S_{t} e^{r(T-t)}-F_{t} $ ）。

对于合约的空头方，可以在 $ t $ 时刻＂借入＂无风险资产，将出售所得收入 $ S_{t} $ 用来购买一只股票（净现金流为 0 ），然后在到期日 $ T $ ，按交割价格 $ F_{t} $ 出售这只股票，并偿还无风险资产 $ S_{t} e^{r(T-t)} $（净现金流为 $ F_{t}-S_{t} e^{r(T-t)} $ ）。

－可见，在无套利均衡市场中，有$$F_{t}=S_{t} e^{r(T-t)}$$

注：这里假定在股票持有期间，股票本身不提供任何收益。

## 期权定价理论

• 期权价格 ft，是关于交割价格 X 在签约时刻 t 的期权费。• 对于看涨期权，价格变动对多头方有利的方向是价格上涨• 对于看跌期权，价格变动对多头方有利的方向是价格下跌• 因此，看涨期权和看跌期权具有不同的期权价格。• 下面，用标的为股票的例子，讨论期权价格的情况。

－对于看涨期权的多头方，他在 $ t $ 时刻支付一笔期权费 $ f_{1} $ 后，可以＂借入＂一只股票，将出售所得收入 $ S_{t} $ 用来购买无风险资产（净现金流为 $ -f_{t} $ ）；- 然后在到期日 $ T $ ，出售无风险资产得到收入 $ S_{t} e^{r(T-t)} $ ，- 当 $ S_{T} \\geq X $ 时，选择行权，按交割价格 $ X $＂偿还＂这只股票 （净现金流为 $ S_{t} e^{r(T-t)}-X $ ）－当 $ S_{T}<X $ 时，放弃行权，按市场价格 $ S_{T} $＂偿还＂这只股票 （净现金流为 $ S_{t} e^{r(T-t)}-S_{T} $ ）－得 $ T $ 时刻的净现金流为 $ S_{t} e^{r(T-t)}-\\min \\left\\{S_{T}, X\\right\\} $ 。

－对于看涨期权的空头方，他在 $ t $ 时刻获得一笔期权费 $ f_{t} $ 后，可以＂借入＂无风险资产，将出售所得收入 $ S_{t} $ 用来购买一只股票（净现金流为 $ f_{t} $ ）；－然后在到期日 $ T $ ，用现金 $ S_{t} e^{r(T-t)} $ 偿还无风险资产，$ > $ 当 $ S_{T} \\geq X $ 时，因对方行权，按交割价格 $ X $ 出售这只股票 （净现金流为 $ X-S_{t} e^{r(T-t)} $ ）$ > $ 当 $ S_{T}<X $ 时，因对方弃权，按市场价格 $ S_{T} $ 出售这只股票 （净现金流为 $ S_{T}-S_{t} e^{r(T-t)} $ ）－得 $ T $ 时刻的净现金流为 min $ \\left\\{S_{T}, X\\right\\}-S_{t} e^{r(T-t)} $ 。

－由此可见，看涨期权的期权价格 $ f_{t} $ 是指：$ > $ 对于多头方，针对 $ T $ 时刻的净现金流$$S_{t} e^{r(T-t)}-\\min \\left\\{S_{T}, X\\right\\}$$$ f_{t} $ 是他愿意支付的价格。- 对于空头方，针对 $ T $ 时刻的净现金流$$\\min \\left\\{S_{T}, X\\right\\}-S_{t} e^{r(T-t)}$$$ f_{t} $ 是他愿意接受的价格。－因此，$ f_{t} $ 是关于 $ T-t 、 S_{t} 、 r 、 X 、 S_{T} $ 的函数，记作$$f_{t}=f\\left(T-t, S_{t}, r, X, S_{T}\\right)$$

－由此可见，看涨期权的期权价格 $ f_{t} $ 是指：$ > $ 对于多头方，针对 $ T $ 时刻的净现金流$$S_{t} e^{r(T-t)}-\\min \\left\\{S_{T}, X\\right\\}$$$ f_{t} $ 是他愿意支付的价格。- 对于空头方，针对 $ T $ 时刻的净现金流$$\\min \\left\\{S_{T}, X\\right\\}-S_{t} e^{r(T-t)}$$$ f_{t} $ 是他愿意接受的价格。－因此，$ f_{t} $ 是关于 $ T-t 、 S_{t} 、 r 、 X 、 S_{T} $ 的函数，记作$$f_{t}=f\\left(T-t, S_{t}, r, X, S_{T}\\right)$$


－对于看跌期权的空头方，他在 $ t $ 时刻获得一笔期权费 $ f_{t} $ 后，可以＂借入＂一只股票，将出售所得收入 $ S_{t} $ 用来购买无风险资产（净现金流为 $ f_{t} $ ）；- 然后在到期日 $ T $ ，出售无风险资产得到收入 $ S_{t} e^{r(T-t)} $ ，- 当 $ S_{T} \\leq X $ 时，因对方行权，按交割价格 $ X $＂偿还＂这只股票（净现金流为 $ S_{t} e^{r(T-t)}-X $ ）$ > $ 当 $ S_{T}>X $ 时，因对方弃权，按市场价格 $ S_{T} $＂偿还＂这只股票（净现金流为 $ S_{t} e^{r(T-t)}-S_{T} $ ）－得 $ T $ 时刻的净现金流为 $ S_{t} e^{r(T-t)}-\\max \\left\\{S_{T}, X\\right\\} $ 。

－由此可见，看跌期权的期权价格 $ f_{t} $ 是指：$ > $ 对于多头方，针对 $ T $ 时刻的净现金流$$\\max \\left\\{S_{T}, X\\right\\}-S_{t} e^{r(T-t)}$$$ f_{t} $ 是他愿意支付的价格。- 对于空头方，针对 $ T $ 时刻的净现金流$$S_{t} e^{r(T-t)}-\\max \\left\\{S_{T}, X\\right\\}$$$ f_{t} $ 是他愿意接受的价格。－因此，$ f_{t} $ 也是关于 $ T-t 、 S_{t} 、 r 、 X 、 S_{T} $ 的函数，记作$$f_{t}=f\\left(T-t, S_{t}, r, X, S_{T}\\right)$$

$$r f=\\frac{\\partial f}{\\partial t}+r S \\frac{\\partial f}{\\partial S}+\\frac{1}{2} \\sigma^{2} S^{2} \\frac{\\partial^{2} f}{\\partial S^{2}}$$

Black－Scholes 微分方程

－Black－Scholes 微分方程给出了当不存在零风险套利时 $ f_{t} $ 的- 种表达式。- 由零风险套利与风险偏好无关可知，Black－Scholes 微分方程的成立与风险偏好无关，因而，$ f_{t} $ 与风险偏好无关。－鉴于股票收益率水平 $ \\mu $ 是由风险偏好决定的量，可得 $ f_{t} $ 与 $ \\mu $无关。－因此，无论 $ \\mu $ 的值如何，得到的 $ f_{t} $ 都是相同的。

• 由此，可以在所有投资者均为风险中立者的假想市场中，来考虑 ft 的定价问题。该市场称为 风险中性市场。• 由于风险中立者的投资决策遵循期望收益准则，导致风险中性市场中所有股票的期望收益率均为无风险利率 r。• 在风险中性市场中，期权合约在 t 时刻的价值 ft（期初现金流），将由期权合约在到期日 T 的期望价值（期末现金流的数学期望），按无风险利率 r 折现而得。这种定价方式称为 风险中性定价。

---

－对于股票看涨期权，在风险中性市场中，按无风险利率 $ r $ 折现为现值，便得到该期权的定价 $ f_{t} $ ：$$f_{t}=e^{-r(T-t)} E\\left(\\max \\left\\{S_{T}-X, 0\\right\\}\\right)$$

其中，$ E\\left(\\max \\left\\{S_{T}-X, 0\\right\\}\\right) $ 为股票看涨期权在到期日 $ T $ 的期望价值。

注：这里假定在股票持有期间，股票本身不提供任何收益。

－在收益率标准差为常量的情形下，得到股票看涨期权的定价公式如下：$$f_{t}=S_{t} \\cdot N\\left(d_{1}\\right)-X e^{-r(T-t)} \\cdot N\\left(d_{2}\\right)$$$$\\begin{array}{l}d_{1}=\\frac{\\ln \\left(S_{t} / X\\right)+(T-t)\\left(r+\\sigma^{2} / 2\\right)}{\\sigma \\sqrt{T-t}} \\\\d_{2}=\\frac{\\ln \\left(S_{t} / X\\right)+(T-t)\\left(r-\\sigma^{2} / 2\\right)}{\\sigma \\sqrt{T-t}}\\end{array}$$

－对于股票看跌期权，在风险中性市场中，按无风险利率 $ r $ 折现为现值，便得到该期权的定价 $ f_{t} $ ：$$f_{t}=e^{-r(T-t)} E\\left(\\max \\left\\{X-S_{T}, 0\\right\\}\\right)$$

其中，$ E\\left(\\max \\left\\{X-S_{T}, 0\\right\\}\\right) $ 为股票看跌期权在到期日 $ T $ 的期望价值。

注：这里假定在股票持有期间，股票本身不提供任何收益。

－在收益率标准差为常量的情形下，得到股票看跌期权的定价公式如下：$$f_{t}=-S_{t} \\cdot N\\left(-d_{1}\\right)+X e^{-r(T-t)} \\cdot N\\left(-d_{2}\\right)$$

## 二叉树定价方法


股价模拟原理• 在弱有效性市场中，我们得到 ST 的真实分布为对数正态分布。• 在这里，基于二叉树结构得到 ST 的离散分布，并收敛到连续的对数正态分布。• 由于一个随机变量可以用概率分布来定义，因此，在弱有效性市场中，我们可以用二叉树方法来近似模拟 ST 的真实分布。

－由此，得到参数 $ u 、 d 、 p $ 的取值如下：$$\\begin{array}{l}u=e^{\\sigma \\sqrt{\\Delta t}} \\\\d=e^{-\\sigma \\sqrt{\\Delta t}} \\\\p=\\frac{e^{\\mu \\Delta t}-d}{u-d}\\end{array}$$


价格树图－时间为 0 时，已知股价为 $ S_{0} $ ；时间为 $ \\Delta t $ 时，股价有两种可能：$ S_{0} u $ 和 $ S_{0} d $ ；时间为 $ 2 \\Delta t $ 时，股价有三种可能：$ S_{0} u^{2} 、 S_{0} u d $和 $ S_{0} d^{2} $ ；－依次类推，时间为 $ n \\Delta t $ 时，股价有 $ n+1 $ 种可能：$$S_{0} u^{k} d^{n-k} \\quad k=0,1, \\ldots, n$$－其发生概率为：$$C_{n}^{k} p^{k}(1-p)^{n-k}$$

－期权价值的计算是从树图的末端（时刻 $ T $ ）开始往回倒推进行的。－$ T $ 时刻，看涨期权价值为 $ \\max \\left(S_{T}-X, 0\\right) $ ，看跌期权价值为 $ \\max \\left(X-S_{T}, 0\\right) $ 。

![alt text](image-31.png)

--- 

－在构造二叉树的过程中，如果 $ \\sigma $ 很小，则会遇到 $ p $ 为负的情形。

例如，$$\\begin{array}{l}r=12 \\%, \\sigma=1 \\%, \\Delta \\mathrm{t}=0.1 \\\\u=e^{0.01 \\sqrt{0.1}}=1.0032 \\\\d=e^{-0.01 \\sqrt{0.1}}=0.9968 \\\\p=\\frac{e^{0.12 \\times 0.1}-0.9968}{1.0032-0.9968}=2.39 \\quad 1-p=-1.39\\end{array}$$

负概率的避免方法－注意到用二叉树来描述期货合约的期货价格时，在风险中性市场中有$$\\begin{array}{l}p F u+(1-p) F d=F \\\\\\Rightarrow p=\\frac{1-d}{u-d} \\geq 0,1-p=\\frac{u-1}{u-d} \\geq 0\\end{array}$$－这表明，对于期货价格的二叉树构造过程，永远不会产生负的概率。


- 避免负的概率的方法：- 取一个期货合约，当前的期货价格为 $ F $ 。该合约与期权合约有相同的标的资产和到期日（ $ T $ ）。－用二叉树模拟 $ F $ 。$ > $ 在树图中时间为 $ i \\Delta t $ 的每个结点上，通过以下公式计算标的资产的价格 $ S $ ：$$S=F e^{-r(T-i \\Delta t)}$$`,__vite_glob_0_31=`---
title: Game Theory - Week 2
category: Notes
---

# Static 

**Static Games of Complete Information**

Static: make decision simultaneously

Complete information: everyone has the same information 

## Normal form 

Players, strategies, payoffs

- Bi-matrix 
  - 2 players
  - Each has a finite number of strategies 

Example:

$
\\begin{array}{c|cc}
 & \\text{ (C)} & \\text{(D)} \\\\
\\hline
\\text{(C)} & (-1, -1) & (-3, 0) \\\\
\\text{(D)} & (0, -3) & (-2, -2) \\\\
\\end{array}
$

## Solving

Dominated strategy
- A strategy **Always** does better regardless of other players' choices

### Iterate

- find Strictly dominated strategy, eliminate it.

Example:


$
\\begin{array}{c|ccc}
 & \\text{ (Left)} & \\text{(Middle)} & \\text{(Right)} \\\\
\\hline
\\text{(Up)} & (1, 0) & (1, 2) & (0, 1) \\\\
\\text{(Down)} & (0, 3) & (0, 1) & (2, 0) \\\\
\\end{array}
$

Right is dominated by Middle:



$
\\begin{array}{c|cc}
 & \\text{ (Left)} & \\text{(Middle)} \\\\
\\hline
\\text{(Up)} & (1, 0) & (1, 2) \\\\
\\text{(Down)} & (0, 3) & (0, 1) \\\\
\\end{array}
$

Down is dominated by Up 



$
\\begin{array}{c|cc}
 & \\text{ (Left)} & \\text{(Middle)} \\\\
\\hline
\\text{(Up)} & (1, 0) & (1, 2) \\\\
\\end{array}
$

Left is dominated by Middle 

$
\\begin{array}{c|c}
 & \\text{(Middle)} \\\\
\\hline
\\text{(Up)} & (1, 2) \\\\
\\end{array}
$

## Nash Equilibrium

When in a combination:

- Every player **CANNOT** do better by choosing a different choice.

`,__vite_glob_0_32=`# Problem 1.4

## Problem 

> 1.4. Suppose there are $ n $ firms in the Cournot oligopoly model. Let $ q_{i} $ denote the quantity produced by firm $ i $, and let $ Q=q_{1}+\\cdots+ $ $ q_{n} $ denote the aggregate quantity on the market. Let $ P $ denote the market-clearing price and assume that inverse demand is given by $ P(Q)=a-Q $ (assuming $ Q<a $, else $ P=0 $ ). Assume that the total cost of firm $ i $ from producing quantity $ q_{i} $ is $ C_{i}\\left(q_{i}\\right)=c q_{i} $. That is, there are no fixed costs and the marginal cost is constant at $ c $, where we assume $ c<a $. Following Cournot, suppose that the firms choose their quantities simultaneously. What is the Nash equilibrium? What happens as $ n $ approaches infinity?

## Solution 

Denote $\\pi_i$ as $i$-th firm's payoff, then:

$\\pi_i = (P-c)q_i = q_i(a-Q - c)$

To maximize the payoff, we have:

$a-Q-c-q_i = 0$

That is:

$q_i = a - Q - c$

Then we sum the $n$ firms up:

$\\sum_{i=1}^n q_i = Q = n(a-Q-c)$

Then we get:

$Q = \\dfrac{n(a-c)}{n+1}$

Then:

$q_i = \\dfrac{a-c}{n+1}$

Therefore, the Nash Equilibruim is :

$(\\dfrac{a-c}{n+1},\\dots,\\dfrac{a-c}{n+1})$

When $n$ goes to infinity:


$\\lim_{n\\to\\infty}\\dfrac{a-c}{n+1} = 0$

# Problem 1.5

## Problem 

> 1.5. Consider the following two finite versions of the Cournot duopoly model. First, suppose each firm must choose either half the monopoly quantity, $ q_{m} / 2=(a-c) / 4 $, or the Cournot equilibrium quantity, $ q_{c}=(a-c) / 3 $. No other quantities are feasible. Show that this two-action game is equivalent to the Prisoners' Dilemma: each firm has a strictly dominated strategy, and both are worse off in equilibrium than they would be if they cooperated. Second, suppose each firm can choose either $ q_{m} / 2 $, or $ q_{c} $, or a third quantity, $ q^{\\prime} $. Find a value for $ q^{\\prime} $ such that the game is equivalent to the Cournot model in Section 1.2.A, in the sense that ( $ q_{c}, q_{c} $ ) is a unique Nash equilibrium and both firms are worse off in equilibrium than they could be if they cooperated, but neither firm has a strictly dominated strategy.

## Solution (a)

The payoff matrix is:

$$
\\begin{array}{l|l|l|}
& q_m/2 & q_c \\\\ 
\\hline q_m/2& (\\dfrac{(a-c)^2}{8},\\dfrac{(a-c)^2}{8})&(\\dfrac{5(a-c)^2}{48}, \\dfrac{5(a-c)^2}{36})\\\\
\\hline q_c&(\\dfrac{5(a-c)^2}{36}, \\dfrac{5(a-c)^2}{48})&(\\dfrac{(a-c)^2}{9}, \\dfrac{(a-c)^2}{9})\\\\
\\hline
\\end{array}
$$

Then: $q_m/2$ is strictly dominated by $q_c$, however,

$(q_m/2, q_m/2) $ is worse than $(q_c, q_c)$

It correspond with Prisoners' Dilemma.

## Solution (b)

Assume $q' = \\dfrac{a-c}{k}$, then:

$$
\\begin{array}{l|l|l|l|}
& q_m/2 & q_c &q'\\\\ 
\\hline q_m/2& (\\dfrac{(a-c)^2}{8},\\dfrac{(a-c)^2}{8})&(\\dfrac{5(a-c)^2}{48}, \\dfrac{5(a-c)^2}{36})&(\\dfrac{(3k-4)(a-c)^2}{16k}, \\dfrac{(3k-4)(a-c)^2}{4k^2})\\\\
\\hline q_c&(\\dfrac{5(a-c)^2}{36}, \\dfrac{5(a-c)^2}{48})&(\\dfrac{(a-c)^2}{9}, \\dfrac{(a-c)^2}{9})&(\\dfrac{(2k-3)(a-c)^2}{9k}, \\dfrac{(2k-3)(a-c)^2}{3k^2})\\\\
\\hline q'&(\\dfrac{(3k-4)(a-c)^2}{4k^2},\\dfrac{(3k-4)(a-c)^2}{16k})&( \\dfrac{(2k-3)(a-c)^2}{3k^2},\\dfrac{(2k-3)(a-c)^2}{9k})&(\\dfrac{(k-2)(a-c)^2}{k^2},\\dfrac{(k-2)(a-c)^2}{k^2})\\\\ 
\\hline
\\end{array}
$$

To make $(q_c, q_c)$ a Nash Equilibruim, we need:

$\\dfrac{1}{9} > \\dfrac{2k-3}{3k^2}$

To make $q_m/2$ not be dominated by $q_c$, we need:

$\\dfrac{3k-4}{16k}\\ge\\dfrac{2k-3}{9k  }$

To make $q'$ not be dominated, we need:

$\\max(\\dfrac{3k-4}{4k^2}-\\dfrac{5}{36},\\dfrac{2k-3}{3k^2}-\\dfrac{1}{9},\\dfrac{k-2}{k^2}-\\dfrac{2k-3}{9k}) \\ge 0$

combined them together, we get:

$k = \\dfrac{12}{5}$

that is:

$$
\\begin{array}{l|l|l|l|}
& q_m/2 & q_c &q'\\\\ 
\\hline q_m/2& (\\dfrac{(a-c)^2}{8},\\dfrac{(a-c)^2}{8})&(\\dfrac{5(a-c)^2}{48}, \\dfrac{5(a-c)^2}{36})&(\\dfrac{(a-c)^2}{12}, \\dfrac{5(a-c)^2}{36})\\\\
\\hline q_c&(\\dfrac{5(a-c)^2}{36}, \\dfrac{5(a-c)^2}{48})&(\\dfrac{(a-c)^2}{9}, \\dfrac{(a-c)^2}{9})&(\\dfrac{(a-c)^2}{12}, \\dfrac{5(a-c)^2}{48})\\\\
\\hline q'&(\\dfrac{5(a-c)^2}{36},\\dfrac{(a-c)^2}{12})&( \\dfrac{5(a-c)^2}{48},\\dfrac{(a-c)^2}{12})&(\\dfrac{5(a-c)^2}{72},\\dfrac{5(a-c)^2}{72})\\\\ 
\\hline
\\end{array}
$$
`,__vite_glob_0_33=`---
title: Game Theory - Paper - Week 3
category: Game Theory Paper
---

# Channel Structures of Online Retail Platforms

# Modeling Framework: The Base Case 

$M$: Manufacturer

$I$: Online intermediary 

Options:

- Model R: reselling channel 
- Model A: agency channel 
- Model D: dual channel 

Model R:
- unit wholesale price 
- intermediary determine quantity 

Model A:
- determine quantity 
- pay unit commission rate $r$
  - exogenous 

Inverse demand function:

$p = a - q_M- q_I + e$

- $a$: potential market size
- $q_M$: manufacturer quantity (agency)
- $q_I$: intermediary quantity (reselling)
- $e$: service effort by intermediary

$\\dfrac{ke^2}{2}$: cost of service effort 

Model A:

1. Manufacturer decide $q_M$ and intermediary decide $e$
2. $p$ realised 

Model R:

1. Manufacturer decide $w$
2. intermediary decide $q_I$ and $e$
3. $p$ realised 

Model D:

1. Manufacturer decide $w$
2. intermediary decide $q_I$
3. Manufacturer decide $q_M$ and intermediary decide $e$
4. $p$ realised 


### Assumption 1

> $ k>\\underline{k} \\equiv \\max \\left[\\frac{1}{2}, \\frac{r}{2}, \\frac{1}{3-r}, \\frac{r(4-r)}{4(3-r)}+\\frac{1}{4} \\sqrt{\\frac{(2-r)^{2}\\left(r^{2}-4 r+12\\right)}{(r-3)^{2}}}\\right]= $ $ \\frac{r(4-r)}{4(3-r)}+\\frac{1}{4} \\sqrt{\\frac{(2-r)^{2}\\left(r^{2}-4 r+12\\right)}{(r-3)^{2}}} $.

- profit functions are concave 
- service effort is not low 

# 4 Equilibruim Price and Effort Decisions 

## 4.1 Centralized Model 

system profit:

$pQ - \\dfrac{ke^2}{2}$

optimal solution:

$ \\begin{array}{l}Q^{*}=\\frac{a k}{2 k-1}, \\\\ e^{*}=\\frac{a}{2 k-1} .\\end{array} $

## 4.2 Model A 

For Manufacturer:

$ \\max _{q_{M}}\\left(a-q_{M}+e\\right) q_{M}(1-r) $

For intermediary:

$ \\max _{e}\\left(a-q_{M}+e\\right) q_{M} r-\\frac{1}{2} k e^{2} $.

The equilibrium:

$ \\begin{array}{l}q_{M}^{A}=\\frac{a k}{2 k-r}, \\\\ e^{A}=\\frac{a r}{2 k-r} .\\end{array} $

Then we get:

$ \\begin{array}{l}\\pi_{M}^{A}=\\frac{a^{2} k^{2}(1-r)}{(r-2 k)^{2}}, \\\\ \\pi_{I}^{A}=\\frac{a^{2} k r}{4 k-2 r} .\\end{array} $

## 4.3 Model R 

Given $w$, intermediary have:

$ \\max _{e, q_{I}}\\left(a-q_{I}+e-w\\right) q_{I}-\\frac{1}{2} k e^{2} $

Then we get:

$ \\begin{array}{l}\\hat{q}_{I}(w)=\\frac{k(a-w)}{2 k-1}, \\\\ \\hat{e}(w)=\\frac{a-w}{2 k-1} .\\end{array} $

Then for manufacturer:

$ \\max _{w} w \\hat{q}_{I}(w) $

Then:

$ \\begin{aligned} w^{R} & =\\frac{a}{2} \\\\ q_{I}^{R} & =\\frac{a k}{2(2 k-1)} \\\\ e^{R} & =\\frac{a}{2(2 k-1)}\\end{aligned} $

Finally:

$ \\begin{array}{l}\\pi_{M}^{R}=\\frac{a^{2} k}{4(2 k-1)}, \\\\ \\pi_{I}^{R}=\\frac{a^{2} k}{8(2 k-1)} .\\end{array} $

## 4.4 Model D 

Given $w, q_I$, for manufacturer:

$ \\max _{q_{M}} w q_{I}+\\left(a-q_{M}-q_{I}+e\\right) q_{M}(1-r) $.

For intermediary:

$ \\begin{array}{l}\\max _{e}\\left(a-q_{M}-q_{I}+e-w\\right) q_{I}+\\left(a-q_{M}-q_{I}+e\\right) q_{M} r \\\\ \\quad-\\frac{1}{2} k e^{2}\\end{array} $

Then we get:

$ \\begin{array}{l}\\hat{q}_{M}\\left(q_{I}\\right)=\\frac{a k+(1-k) q_{I}}{2 k-r}, \\\\ \\hat{e}\\left(q_{I}\\right)=\\frac{a r+(2-r) q_{I}}{2 k-r} .\\end{array} $

For intermediary:

$ \\begin{array}{l}\\max _{q_{I}}\\left(a-\\hat{q}_{M}\\left(q_{I}\\right)-q_{I}+\\hat{e}\\left(q_{I}\\right)-w\\right) q_{I} \\\\ \\quad+\\left(a-\\hat{q}_{M}\\left(q_{I}\\right)-q_{I}+\\hat{e}\\left(q_{I}\\right)\\right) \\hat{q}_{M}\\left(q_{I}\\right) r-\\frac{1}{2} k\\left(\\hat{e}\\left(q_{I}\\right)\\right)^{2}\\end{array} $

Then we get:

$ \\hat{q}_{I}(w)=\\frac{a k(1-r)-w(2 k-r)}{k(2-r)} $.

For manufacturer:

$ \\begin{array}{r}\\max _{w} w \\hat{q}_{I}(w)+\\left(a-\\hat{q}_{I}(w)-\\hat{q}_{M}\\left(\\hat{q}_{I}(w)\\right)\\right. \\\\ \\left.+\\hat{e}\\left(\\hat{q}_{I}(w)\\right)\\right) \\hat{q}_{M}\\left(\\hat{q}_{I}(w)\\right)(1-r) .\\end{array} $

Finally:

$ \\begin{aligned} w^{D} & =\\frac{a k(1-r)\\left(2 k^{2}(3-r)-k r(4-r)-2(1-r)\\right)}{2(k(3-r)-1)(k-r+1)(2 k-r)}, \\\\ q_{I}^{D} & =\\frac{a k(2-r)(1-r)}{2(k(3-r)-1)(k-r+1)}, \\\\ q_{M}^{D} & =\\frac{a k(k(3-r)-r+1)}{2(k(3-r)-1)(k-r+1)}, \\\\ e^{D} & =\\frac{a((3-r) r k+2(1-r))}{2(k(3-r)-1)(k-r+1)} .\\end{aligned} $

# 5 Equilibrium Profits and Channel Structure

### Proposition 1

> (a) Wholesale price effect: $ w^{D}<w^{R} $ and $ \\partial w^{D} / \\partial r<0 $. 
> 
> (b) Channel flexibility effect: $ \\partial q_{M}^{D} / \\partial r> $ $ 0, \\partial q_{I}^{D} / \\partial r<0, \\partial\\left(q_{M}^{D}+q_{I}^{D}\\right) / \\partial r>0 $ and $ \\partial e^{D} / \\partial r>0 $.


### Proposition 2

> (a) $ \\pi_{I}^{D} \\geq \\pi_{I}^{A}, \\pi_{M}^{D} \\geq \\pi_{M}^{A} $, and $ \\pi_{I}^{D}+ $ $ \\pi_{M}^{D} \\geq \\pi_{I}^{A}+\\pi_{M}^{A} $. 
> 
> (b) There exists $ \\tilde{r}_{S C} $ such that $ \\pi_{I}^{D}+\\pi_{M}^{D} \\geq $ $ \\pi_{I}^{R}+\\pi_{M}^{R} $ if $ r \\geq \\tilde{r}_{S C} $ and $ \\pi_{I}^{D}+\\pi_{M}^{D}<\\pi_{I}^{R}+\\pi_{M}^{R} $ otherwise. 
> 
> (c) There exists $ \\tilde{r}_{I} \\in(0,1 / 2) $ such that $ \\pi_{I}^{D} \\geq \\pi_{I}^{R} $ if $ r \\geq \\tilde{r}_{I} $ and $ \\pi_{I}^{D}<\\pi_{I}^{R} $ otherwise. 
> 
> (d) There exist $ \\tilde{r}_{M} $ and $ \\tilde{k}_{M} $ such that $ \\pi_{M}^{D} \\geq \\pi_{M}^{R} $ if 
> (i) $ k \\geq \\tilde{k}_{M} $ and $ r \\leq 1 / 2 $ or 
> (ii) $ k>1 $ and $ 1 / 2<r \\leq \\tilde{r}_{M} $, and $ \\pi_{M}^{D}<\\pi_{M}^{R} $ otherwise.

---

$
\\begin{array}{|c|c|c|c|}
\\hline
\\text{Regions} & \\text{Profit Comparison} & \\text{Regions} & \\text{Profit Comparison} \\\\
\\hline
A & \\pi_{I}^{D} \\geq \\pi_{I}^{R}, \\pi_{M}^{D}<\\pi_{M}^{R} & C & \\pi_{I}^{D}<\\pi_{I}^{R}, \\pi_{M}^{D}<\\pi_{M}^{R} \\\\
\\hline
B & \\pi_{I}^{D} \\geq \\pi_{I}^{R}, \\pi_{M}^{D} \\geq \\pi_{M}^{R} & D & \\pi_{I}^{D}<\\pi_{I}^{R}, \\pi_{M}^{D} \\geq \\pi_{M}^{R} \\\\
\\hline
\\end{array}
$

![Figure 1](image-15.png)

### Corollary 1

> As $ k \\rightarrow \\infty, e_{I}^{D} \\rightarrow 0, q_{I}^{D} \\rightarrow 0, q_{M}^{D} \\rightarrow q_{M}^{A}= $ $ Q^{*} $, and $ \\pi_{I}^{D}+\\pi_{M}^{D} \\rightarrow \\pi_{I}^{A}+\\pi_{M}^{A}=a^{2} / 4 $.

### Proposition 3

> (a) When the intermediary chooses the channel structure, the equilibrium is dual channel if $ r \\geq \\tilde{r}_{I} $ (Regions A and B) and reselling channel otherwise (Regions $ C $ and $ D $ ). 
> 
> (b) When the manufacturer chooses the channel structure, the equilibrium is dual channel if 
> (i) $ k \\geq $ $ \\tilde{k}_{M} $ and $ r \\leq 1 / 2 $ or 
> (ii) $ k>1 $ and $ 1 / 2<r \\leq \\tilde{r}_{M} $ (Regions $ B $ and $ D) $ and reselling channel otherwise (Regions $ A $ and $ C) $.
> 
> (c) Both firms prefer dual channel if (i) $ k \\geq \\tilde{k}_{M} $ and $ \\tilde{r}_{I} \\leq r \\leq $ $ 1 / 2 $ or (ii) $ k>1 $ and $ 1 / 2<r \\leq \\tilde{r}_{M} $ (Region B). (d) Both firms prefer reselling channel if $ k<\\tilde{k}_{M} $ and $ r<\\tilde{r}_{I} $ (Region C).

# Extensions

$$
\\begin{array}{|c|c|c|c|}
\\hline
\\text{Regions} & \\text{Profit Comparison} & \\text{Regions} & \\text{Profit Comparison} \\\\
\\hline
A & \\pi_{I}^{D} \\geq \\pi_{I}^{R},\\; \\pi_{M}^{D} < \\pi_{M}^{R} & C & \\pi_{I}^{D} < \\pi_{I}^{R},\\; \\pi_{M}^{D} < \\pi_{M}^{R} \\\\
\\hline
B & \\pi_{I}^{D} \\geq \\pi_{I}^{R},\\; \\pi_{M}^{D} \\geq \\pi_{M}^{R} & D & \\pi_{I}^{D} < \\pi_{I}^{R},\\; \\pi_{M}^{D} \\geq \\pi_{M}^{R} \\\\
\\hline
\\end{array}
$$

![Figure 2 (a)](image-16.png)

![Figure 2 (b)](image-17.png)

## 6.1 Observable Service Effort 

![Figure 3 (a)](image-18.png)

![Figure 3 (b)](image-19.png)

## 6.2 Simultaneous Quantity Decisions

## 6.3 Manufacturer Service Effort 

### Proposition 4 


> (a) There exists $ \\tilde{r}_{I} \\in(0,1 / 4) $ such that $ \\pi_{I}^{A} \\geq $ $ \\pi_{I}^{R} $ if $ r \\geq \\tilde{r}_{I} $ and $ \\pi_{I}^{A}<\\pi_{I}^{R} $ otherwise. 
> 
> (b) There exist $ \\tilde{r}_{M} \\in $ $ (1 / 2,1) $ such that $ \\pi_{M}^{A} \\geq \\pi_{M}^{R} $ if $ r \\leq \\tilde{r}_{M} $ and $ \\pi_{M}^{A}<\\pi_{M}^{R} $ otherwise.

$$
\\begin{array}{|c|c|c|c|}
\\hline
\\text{Regions} & \\text{Profit Comparison} & \\text{Regions} & \\text{Profit Comparison} \\\\
\\hline
A & \\pi_{I}^{A} \\geq \\pi_{I}^{R},\\; \\pi_{M}^{A} < \\pi_{M}^{R} & C & \\pi_{I}^{A} < \\pi_{I}^{R},\\; \\pi_{M}^{A} < \\pi_{M}^{R} \\\\
\\hline
B & \\pi_{I}^{A} \\geq \\pi_{I}^{R},\\; \\pi_{M}^{A} \\geq \\pi_{M}^{R} & D & \\pi_{I}^{A} < \\pi_{I}^{R},\\; \\pi_{M}^{A} \\geq \\pi_{M}^{R} \\\\
\\hline
\\end{array}
$$

![Figure 4 (a)](image-20.png)

![Figure 4 (b)](image-21.png)

### Proposition 5

> (a) There exist $ \\tilde{r}_{I 1} \\in(1 / 2,1) $ and $ \\tilde{r}_{12} \\in $ $ (0,1 / 4) $ such that $ \\pi_{I}^{A} \\geq \\pi_{I}^{R} $ if 
> (i) $ k \\leq 1 / 2 $ and $ r \\leq \\tilde{r}_{11} $ or 
> (ii) $ k>1 / 2 $ and $ r \\geq \\tilde{r}_{12} $ and $ \\pi_{I}^{A}<\\pi_{I}^{R} $ otherwise. 
> 
> (b) $ \\pi_{M}^{A} \\geq \\pi_{M}^{R} $ if $ r \\leq \\tilde{r}_{M} \\equiv 1 / 2 $ and $ \\pi_{M}^{A}<\\pi_{M}^{R} $ otherwise.

`,__vite_glob_0_34=`---
title: Game Theory - Week 4
category: Notes
---



# 

## Example 1: Bertrand model of duopoly

Best respond function : 

$p^m = \\dfrac{a+c}{2}$

$B_1(p_2) = \\begin{cases}
\\{p_1:p_1>p_2\\} & if: p_2 < c \\\\
\\{p_1: p_1 \\ge p_2\\} &if: p_2 = c \\\\ 
\\oslash & if: e<p_2\\le p^m \\\\ 
p^m & if: p^m < p_2 
\\end{cases}
$


$B_1(p_1) = \\begin{cases}
\\{p_2:p_2>p_1\\} & if: p_1 < c \\\\
\\{p_2: p_2 \\ge p_1\\} &if: p_1 = c \\\\ 
\\oslash & if: e<p_1\\le p^m \\\\ 
p^m & if: p^m < p_1 
\\end{cases}
$

## Example 2: Public good

$u_1(c_1, c_2) = v_1(c_1+c_2) + w_1 - c_1$

$u_2(c_1, c_2) = v_2(c_1+ c_2) + w_2 - c_2$


Best response:
s} r_
$$                                                                                   

$$                                                                                   
1 - c_2 & if : c_2<r_
$R_1(c_2) = \\begin{case1 \\\\ 0& if:c_2 \\ge r_1 \\end{cases}$


$R_2(c_1) = \\begin{cases} r_2 - c_1 & if : c_1<r_2 \\\\ 0& if:c_1 \\ge r_2 \\end{cases}$


## Example 3: Farmers 

$u_i(g_1,\\dots,g_n) = g_i \\cdot v(g_1+\\dots+g_n)-cg_1$




`,__vite_glob_0_35=`---
title: Game Theory - Assignment - Week 4
category: Assignments
---

# 1

## Problem 

> 1. Consider the following game.
> $\\begin{array}{|l|l|l|l|l|}\\hline & w & x & y & z \\\\ \\hline a & 4,4 & 1,1 & 0,2 & 0,1 \\\\ \\hline b & 1,1 & 1,2 & 1,0 & 1,6 \\\\ \\hline c & 0,0 & 2,0 & 3,2 & 0,1 \\\\ \\hline d & 0,0 & 0,5 & 0,2 & 6,1 \\\\ \\hline\\end{array}$
> (a) Find a mixed strategy for the row player to strictly dominate strategy b.
> (b) Compute the set of all Nash equilibria (including mixed strategies). Hint: In any mixed strategy Nash equilibrium, we put zero probability on strictly dominated strategies.

## Solution (a)

Notice:

$\\dfrac{7}{18}a+\\dfrac{7}{18}c+\\dfrac{4}{18}d = (\\dfrac{14}{9}, \\dfrac{7}{6},\\dfrac{7}{6}, \\dfrac{4}{3}) > (1, 1, 1, 1)$

## Solution (b)

After eliminate b:


$\\begin{array}{|l|l|l|l|l|}\\hline & w & x & y & z \\\\ \\hline a & 4,4 & 1,1 & 0,2 & 0,1 \\\\ \\hline c & 0,0 & 2,0 & 3,2 & 0,1 \\\\ \\hline d & 0,0 & 0,5 & 0,2 & 6,1 \\\\ \\hline\\end{array}$

z is strictly dominated by y:

$\\begin{array}{|l|l|l|l|}\\hline & w & x & y \\\\ \\hline a & 4,4 & 1,1 & 0,2  \\\\ \\hline c & 0,0 & 2,0 & 3,2  \\\\ \\hline d & 0,0 & 0,5 & 0,2 \\\\ \\hline\\end{array}$

d is strictly dominated by a and c:

$\\begin{array}{|l|l|l|l|}\\hline & w & x & y \\\\ \\hline a & 4,4 & 1,1 & 0,2  \\\\ \\hline c & 0,0 & 2,0 & 3,2  \\\\ \\hline\\end{array}$

x is strictly dominated by y:


$\\begin{array}{|l|l|l|l|}\\hline & w  & y \\\\ \\hline a & 4,4  & 0,2  \\\\ \\hline c & 0,0 & 3,2  \\\\ \\hline\\end{array}$

Therefore the mixed nash equilibrium:

$\\left(\\left(\\dfrac{1}{2}, 0, \\dfrac{1}{2}, 0\\right),\\left(\\dfrac{3}{7}, 0, \\dfrac{4}{7}, 0\\right)\\right)$

# 1.12

## Problem 

> Find the mixed-strategy Nash equilibrium of the following normal-form game.
> $\\begin{array}{|c|c|c|}\\hline  & L & R \\\\ \\hline T & 2,1 & 0,2 \\\\ \\hline B & 1,2 & 3,0 \\\\ \\hline\\end{array}$


## Solution 

We need:

$l+2r = 2l$

$2t+b = 3b$

Then the nash equilibrium:

$((\\dfrac{1}{2},\\dfrac{1}{2}),(\\dfrac{2}{3},\\dfrac{1}{3}))$

# 1.13 

## Problem 

> Each of two firms has one job opening. Suppose that (for reasons not discussed here but relating to the value of filling each opening) the firms offer different wages: firm $ i $ offers the wage $ w_{i} $, where $ (1 / 2) w_{1}<w_{2}<2 w_{1} $. Imagine that there are two workers, each of whom can apply to only one firm. The workers simultaneously decide whether to apply to firm 1 or to firm 2 . If only one worker applies to a given firm, that worker gets the job; if both workers apply to one firm, the firm hires one worker at random and the other worker is unemployed (which has a payoff of zero). Solve for the Nash equilibria of the workers' normal-form game. (For more on the wages the firms will choose, see Montgomery [1991].)

## Solution 

Pure strategy equilibrium:

$(T, R), (B, L)$

Mixed strategy equilibrium:

we have:

$\\dfrac{1}{2}w_1l + w_1r = w_2l + \\dfrac{1}{2}w_2r$

$\\dfrac{1}{2}w_1u+w_1d = w_2u + \\dfrac{1}{2}w_2d$

Then we get:

$\\left(\\left(\\frac{2 w_{1}-w_{2}}{w_{1}+w_{2}}, \\frac{2 w_{2}-w_{1}}{w_{1}+w_{2}}\\right),\\left(\\frac{2 w_{1}-w_{2}}{w_{1}+w_{2}}, \\frac{2 w_{2}-w_{1}}{w_{1}+w_{2}}\\right)\\right)$

`,__vite_glob_0_36=`---
title: Game Theory - Paper - Week 4
category: Game Theory Paper
---

# Quality in Supply Chain Encroachment

# 3 Model and Benchmark Analysis

## 3.1 Basic Model 

$ U(u, p ; \\theta)=\\theta u-p $: Consumerm surplus 

- $u>0$: quality 
- $p$: price 
- $\\theta\\in[0,1]$: sensitivity

$q = 1-p/u$: demand 

$p = u(1-q)$: inverse demand function 

$ku^2$: manufacturer unit cost 

---

Timeline:

1. manufacturer decide $u$, $w$
2. retailer decide $q_R$
3. manufacturer decide $q_M$ (if exists)

## 3.2 Benchmark: No Encroachment

We have:

$ \\Pi_{R}^{N}\\left(q_{R}, w, u\\right)=\\left(u\\left(1-q_{R}\\right)-w\\right) q_{R} $

By maximize it, we have:

$ q_{R}^{N}(w, u)=\\frac{1}{2}-w /(2 u) $

Then for manufacturer:

$ \\max _{w, u}\\left(w-k u^{2}\\right) q_{R}^{N}(w, u)=\\max _{w, u}\\left(w-k u^{2}\\right)\\left(\\frac{1}{2}-\\frac{w}{2 u}\\right) $

Then:

$ w^{N}(u)=\\frac{k u^{2}}{2}+\\frac{u}{2} $

Then:

$ \\Pi_{M}^{N}(u)=\\frac{u(1-k u)^{2}}{8} \\quad $ and $ \\quad \\Pi_{R}^{N}(u)=\\frac{u(1-k u)^{2}}{16} $

Finally:

$ \\Pi_{M}^{N}=\\frac{1}{54 k} \\quad $ and $ \\quad \\Pi_{R}^{N}=\\frac{1}{108 k} $

# 4 Encroachment with Uniform Quality

## 4.1  Sequential Quantity Decisions

for manufacturer:

$ \\max _{q_{M}}\\left\\{\\left(w-k u^{2}\\right) q_{R}+\\left(u-u q_{M}-u q_{R}-c-k u^{2}\\right) q_{M}\\right\\} $

Then we get:

$ q_{M}^{u}\\left(q_{R}, w, u\\right)=  \\left(\\frac{1}{2}-q_{R} / 2-c /(2 u)-k u / 2\\right)^{+} $

Then for retailer:

$ \\max _{q_{R}}\\left(u\\left(1-q_{R}-q_{M}^{U}\\left(q_{R}, w, u\\right)\\right)-w\\right) q_{R} $

Then we get:

$ \\begin{array}{l}q_{R}^{u}(w, u)=\\frac{1}{2}-\\frac{w}{u}+\\frac{k u}{2}+\\frac{c}{2 u} \\quad \\text { and } \\\\ q_{M}^{u}(w, u)=\\frac{1}{4}+\\frac{w}{2 u}-\\frac{3 k u}{4}-\\frac{3 c}{4 u} .\\end{array} $

For manufacturer:

$ \\begin{array}{l}\\max _{w, u}\\left\\{\\left(w-k u^{2}\\right) q_{R}^{U}(w, u)\\right. \\\\ \\left.\\quad+\\left(u-u q_{M}^{u}(w, u)-u q_{R}^{U}(w, u)-c-k u^{2}\\right) q_{M}^{u}(w, u)\\right\\} .\\end{array} $

Then:

$ w^{U}(u)=\\frac{k u^{2}}{2}+\\frac{u}{2}-\\frac{c}{6} $

$ \\begin{array}{c}q_{R}^{U}\\left(w^{u}(u), u\\right)=\\frac{2 c}{3 u} \\text { and } \\\\ q_{M}^{U}\\left(w^{U}(u), u\\right)=-\\frac{k u}{2}-\\frac{5 c}{6 u}+\\frac{1}{2} .\\end{array} $

Then:

$ \\begin{array}{l}\\Pi_{M}^{u}(u)=\\frac{k^{2} u^{3}}{4}+\\frac{k c u}{2}+\\frac{7 c^{2}}{12 u}-\\frac{k u^{2}}{2}+\\frac{u}{4}-\\frac{c}{2} \\quad \\text { and } \\\\ \\Pi_{R}^{U}(u)=\\frac{2 c^{2}}{9 u}\\end{array} $

---

Weg get, retailer is better off with encroachment if and only if:

$ \\frac{3\\left(u-k u^{2}\\right)}{4 \\sqrt{2}}<c<\\frac{3\\left(u-k u^{2}\\right)}{5} $

### Proposition 1

> (i) There exists a threshold $ \\tilde{c} $ such that the manufacturer encroaches if and only if $ c<\\tilde{c} $. 
> 
> (ii) Under encroachment, (a) the product quality $ u^{u} $ is first increasing and then decreasing in $ c $, and (b) there exists a threshold $ c^{u} $ such that $ u^{U} \\geq u^{N} $, if $ c \\leq c^{u} $ and $ u^{U}<u^{N} $ otherwise. 
> 
> (iii) When encroachment happens, the manufacturer always wins, $ \\Pi_{M}^{U}-\\Pi_{M}^{N}>0 $, and the retailer always loses, $ \\Pi_{R}^{U}-\\Pi_{R}^{N}<0 $.

## 4.2 Simultaneous quantity Decisions

### Proposition 2 

> (i) When both firms choose quantities simultaneously, there exists a threshold $ \\tilde{c}^{\\prime} $ such that the manufacturer encroaches if and only if $ c<\\tilde{c}^{\\prime} $. Under encroachment, there exists $ c_{L} $ such that the retailer always loses $ \\left(\\Pi_{R}^{S}<\\Pi_{R}^{N}\\right) $, whereas the manufacturer loses $ \\left(\\Pi_{M}^{S}<\\Pi_{M}^{N}\\right) $ if and only if $ c_{L}<c<\\tilde{c}^{\\prime} $. (ii) The manufacturer is more likely to encroach under simultaneous than under sequential quantity decisions: $ \\tilde{c}<\\tilde{c}^{\\prime} $.

![Figure 1](image-23.png)

![Figure 2](image-24.png)

![Figure 3](image-25.png)

# 5 Encroachment with Quality Differentiation

- $u$: direct channel 
- $tu (t\\in (0, 1] or t \\ge 1)$: indirect channel 

### Proposition 3

> Under encroachment, the manufacturer never offers a product of strictly lower quality through the direct channel.


$\\begin{array}{lccc}
\\hline
c & t^{*} & u^{*} & q_{M}^{*} \\\\
\\hline
0 \\leq c < c_{1} & t^{*} = \\frac{6}{5} - \\frac{2}{5} \\sqrt{4 - \\frac{5c}{k u^{* 2}}} < 1 & u^{*} > \\sqrt{\\frac{4c}{3k}} & q_{M}^{*} > 0 \\\\
c_{1} < c \\leq c_{2} & t^{*} = 1 & u^{*} < \\sqrt{\\frac{4c}{3k}} & q_{M}^{*} > 0 \\\\
c > c_{2} & \\text{N/A} & \\text{N/A} & q_{M}^{*} = 0 \\\\
\\hline
\\end{array}$

### Proposition 4

> (i) There exist two thresholds $ c_{1}<c_{2} $ that characterize the manufacturer's equilibrium decisions as given in Table 1. 
> 
> (ii) When encroachment happens, the manufacturer always wins $ \\left(\\Pi_{M}^{*}>\\Pi_{M}^{N}\\right) $ and the retailer always loses $ \\left(\\Pi_{R}^{*}<\\Pi_{R}^{N}\\right) $.

![Figure 4](image-26.png)

![Figure 5](image-27.png)

### Corollary 2

> Given $ c>0 $, as $ k $ increases (i) the manufacturer becomes less likely to encroach or quality differentiate (i.e., both $ c_{1} $ and $ c_{2} $ decrease); and (ii) the retailer's profit first decreases and then increases.

# 6 Extension 

## 6.1 Segmentation Through the Retailer 

No direct channel, two product through retailer:

$w_1, w_2, u_1, u_2$

### Proposition 5

> When encroachment happens, the manufacturer always wins $ \\left(\\Pi_{M}^{*}-\\Pi_{M}^{N 2}>0\\right) $, and the retailer always loses $ \\left(\\Pi_{R}^{*}-\\Pi_{R}^{N 2}<0\\right) $

## 6.2 Encroachment with Fixed cost of Quality 

$\\max (ku^2, kt^2u^2)$: fixed cost of quality 

### Proposition 6

> Under encroachment, (i) quality differentiation is not optimal (i.e., $ t=1 $ ) and (ii) the manufacturer always wins and the retailer always loses.

## 6.3 No Quality Commitment for Direct Channel


(i) the manufacturer announces the product quality $ u_{R} $ and the wholesale price $ w $; 

(ii) the retailer chooses the order quantity $ q_{R} $; 

(iii) the manufacturer determines the product quality $ u_{M} $ and selling quantity $ q_{M} $.

### Proposition 7

> If the encroaching manufacturer cannot commit to a level of quality in the direct-channel product, then quality differentiation across channels is always optimal.

![Figure 6](image-28.png)

## 6.4 Generalized Cost Function

$\\begin{cases}
b&u\\le u_0\\\\ 
b+k(u-u_0)^2&u>u_0
\\end{cases}$: unit cost

### Proposition 8

> There exists a threshold $ \\bar{k}>0 $ such that 
> 
> (i) if $ k \\leq \\bar{k} $, then the retailer always loses from encroachment; 
> 
> (ii) if $ k>\\bar{k} $, then there exist $ \\underline{c} $ and $ \\bar{c} $ such that the retailer wins from encroachment when $ \\underline{c}<c<\\bar{c} $.

![Figure 7](image-29.png)

![Figure 8](image-30.png)



`,__vite_glob_0_37=`---
title: Game Theory - Week 5
category: Notes
---

`,__vite_glob_0_38=`---
title: Game Theory - Assignment - Week 5
category: Assignments
---

# 1

## Problem 

Consider the following game involving $ N $ matchsticks positioned on a table. Two players participate in this game, with Player 1 making the initial move, followed by Player 2. The players then continue to take turns until the game concludes. The game is governed by two rules:
(i) A player in his or her turn can pick either 1 or 2 matchsticks.
(ii) The player who picks the last matchstick wins the game.

Answer the following questions:
(a) For $ N=3 $, construct the game tree and determine the subgame perfect Nash equilibrium.
(b) For $ N=4 $, construct the game tree and determine the subgame perfect Nash equilibrium.
(c) For $ N=5 $, construct the game tree and determine the subgame perfect Nash equilibrium.
(d) If $ N=9,999 $, would you prefer to be Player 1 or Player 2? Specify the strategy that could guarantee a victory in this scenario.
(e) If $ N=10,000 $, would you prefer to be Player 1 or Player 2? Specify the strategy that could guarantee a victory in this scenario.
(f) If $ N=10,001 $, would you prefer to be Player 1 or Player 2? Specify the strategy that could guarantee a victory in this scenario.

## Solution (a)

Game tree:

- Player 1 picks 2 (A)
  - Player 2 picks 1 (M)
- Player 1 picks 1 (B)
  - Player 2 picks 2 (P)
  - Player 2 picks 1 (Q)
    - Player 1 picks 1 (C)

Backward induction:

Player 2 will pick 2 when Player 1 picks 1, then Player 2 always win.

Subgame perfect Nash equilibrium:

$(AC, MP), (BC, MP)$

## Solution (b)

We denote the strategy in [Solution a](#solution-a) for player 1 as $\\alpha$, for player 2 as $\\beta$

Game tree:

- Player 1 picks 2 (A)
  - Player 2 picks 2 (M)
  - Player 2 picks 1 (N)
    - Player 1 picks 1 (C)
- Player 1 picks 1 (B)
  - Player 2 act as $\\alpha$, player 1 as $\\beta$

Backward induction:

If Player picks 2, Player 2 will picks 2.
Because $\\beta$ makes player 1 win, player 1 will pick 1

Player 1 always win 

Subgame perfect Nash equilibrium:

$(BC\\beta, M\\alpha )$

## Solution (c)

We denote the strategy in [Solution b](#solution-b) for player 1 as $\\gamma$, for player 2 as $\\delta$

Game tree:

- Player 1 picks 2 (A)
  - Player 2 act as $\\alpha $, player 1 as $\\beta $
- Player 1 picks 1 (B)
  - Player 2 act as $\\gamma$, player 1 as $\\delta$

Backward induction:

$\\beta$ always win, so player 1 will choose $A$

subgame perfect Nash equilibrium:

$(A\\beta\\delta, \\alpha\\gamma)$

## Solution (d)

Player 2 wins

He will pick the number that makes $N$ proportional to $3$

## Solution (e)

Player 1 wins 

He will pick 1, then pick the number that makes $N$ proportional to $3$

## Solution (f)

Player 1 wins 

He will pick 2, then pick the number that makes $N$ proportional to $3$

# 2

## Problem 

Consider the following game involving $ N $ matchsticks positioned on a table. Two players participate in this game, with Player 1 making the initial move, followed by Player 2. The players then continue to take turns until the game concludes. The game is governed by two rules:
(i) A player in his or her turn can pick either 1 or 3 matchsticks.
(ii) The player who picks the last matchstick loses the game.

Answer the following questions:
(a) For $ N=3 $, construct the game tree and determine the subgame perfect Nash equilibrium.

(b) For $ N=4 $, construct the game tree and determine the subgame perfect Nash equilibrium.
(c) For $ N=5 $, construct the game tree and determine the subgame perfect Nash equilibrium.
(d) For $ N=6 $, construct the game tree and determine the subgame perfect Nash equilibrium.
(e) For $ N=7 $, construct the game tree and determine the subgame perfect Nash equilibrium.
(f) If $ N=100 $, would you prefer to be Player 1 or Player 2? Specify the strategy that could guarantee a victory in this scenario.
(g) If $ N=101 $, would you prefer to be Player 1 or Player 2? Specify the strategy that could guarantee a victory in this scenario.
(h) If $ N=102 $, would you prefer to be Player 1 or Player 2? Specify the strategy that could guarantee a victory in this scenario.
(i) If $ N=103 $, would you prefer to be Player 1 or Player 2? Specify the strategy that could guarantee a victory in this scenario.

## Solution (a)

Game tree:

- Player 1 picks 3 (A)
- Player 1 picks 2 (B)
  - Player 2 picks 1 (L)
- Player 1 picks 1 (C)
  - Player 2 picks 2 (O)
  - Player 2 picks 1 (P)
    - Player 1 picks 1 (D)

Backward induction:

in $O,P$, player 2 picks $O$

in $A,B,C$, plauer 1 picks $A$

subgame perfect Nash equilibrium:

$(AD,LO)$

## Solution (b)

Denote player 1, 2's strategy in [Solution (a)](#solution-a-1) as $\\alpha , \\beta $

game tree:

- Player 1 picks 3 (A)
  - Player 2 picks 1 (L)
- Player 1 picks 2 (B)
  - Player 2 picks 2 (O)
  - Player 2 picks 1 (P)
    - Player 1 picks 1 (D)
- Player 1 picks 1 (C)
  - Player 2 use $\\alpha $, player 1 use $\\beta $

Backward induction:

in $O,P$, player 2 choose $O$

Player 1 always lose 

subgame perfect Nash equilibrium

$(AD\\beta, LO\\alpha),(BD\\beta, LO\\alpha), (CD\\beta, LO\\alpha) $

## Solution (c)

Denote player 1, 2's strategy in [Solution (b)](#solution-b-1) as $\\gamma , \\delta $

game tree:

- Player 1 picks 3 (A)
  - Player 2 picks 2 (L)
  - Player 2 picks 1 (M)
    - Player 1 picks 1 (D)
- Player 1 picks 2 (B)
  - Player 2 use $\\alpha   $, player 1 use $\\beta $
- Player 1 picks 1 (C)
  - Player 2 use $\\gamma $, player 1 use $\\delta $

Backward induction:

in $L,M$, player 2 chooses $L$

because $\\delta$ always win, player 1 chooses $C$

subgame perfect Nash equilibrium:

$(CD\\beta\\delta, L\\alpha \\gamma )$

## Solution (d)

Denote player 1, 2's strategy in [Solution (c)](#solution-c-1) as $\\epsilon , \\zeta $

game tree:


- Player 1 picks 3 (A)
  - Player 2 use $\\alpha  $, player 1 use $\\beta  $
- Player 1 picks 2 (B)
  - Player 2 use $\\gamma $, player 1 use $\\delta $
- Player 1 picks 1 (C)
  - Player 2 use $\\epsilon $, player 1 use $\\zeta $

Backward induction:

$\\delta$ always win, so Player 1 chooses $B$

subgame perfect Nash equilibrium :

$(B\\beta \\delta \\zeta, \\alpha \\gamma \\epsilon)$

## Solution (e)

Denote player 1, 2's strategy in [Solution (d)](#solution-d-1) as $\\eta , \\theta  $

game tree:

- Player 1 picks 3 (A)$
  - Player 2 use $\\gamma  $, player 1 use $\\delta  $
- Player 1 picks 2 (B)
  - Player 2 use $\\epsilon $, player 1 use $\\zeta $
- Player 1 picks 1 (C)
  - Player 2 use $\\eta $, player 1 use $\\theta $


Backward induction:

$\\delta$ always win, so Player 1 chooses $A$

subgame perfect Nash equilibrium :

$(A\\delta \\zeta\\theta,  \\gamma \\epsilon\\eta)$

## Solution (f)

Player 2 wins.

He will pick the number that makes $N$ proportional to $4$

## Solution (g)

Player 1 wins.

He will first pick 1, then pick the number that makes $N$ proportional to $4$


## Solution (h)

Player 1 wins.

He will first pick 2, then pick the number that makes $N$ proportional to $4$


## Solution (h)

Player 1 wins.

He will first pick 3, then pick the number that makes $N$ proportional to $4$`,__vite_glob_0_39=`---
title: Game Theory - Paper - Week 5
category: Game Theory Paper
---

# Supplier Encroachment with a Dual-Purpose Retailer

# 3 Model and Benchmark

## 3.1 Model Setup

Suppltailerier 
- sell through retailer 

dual-purpose retailer 
- choose order quantity
- maximize profit and consumer surplus

Strategies of retailer:
- Consumer cooperatives
- Certified B Corporation 
- Commercial nonprofit

---
$1$: retailer's weight on profit
$\\delta\\in[0, 1)$: retailer's weight on consumer surplus 

objective function:

- $v_R=\\pi_R+\\delta_{CS}$
- $v_S=\\pi_S$
  - $\\pi$: profit 

$c$: Supplier direct selling cost 

$p=a-bQ$: market clearing price 
- $Q$: total quantity 

$U(Q) = aQ-\\dfrac{bQ^2}{2}$" consumer utility function 

$cs = U(Q) - pQ = \\dfrac{bQ^2}{2}$: consumer surplus 


(in 5.1: $cs_R = \\dfrac{q_R\\cdot cs}{q_R+q_S}$)

---

1. Supplier decide encroach ability 
2. supplier decide $w$(whilesale price)
3. retailer decide $q_R$(quantity)
4. supplier decide $q_S$(quantity)

## 3.2 Benchmark Analysis

### 3.2.1 Benchmark Game

for-profit retailer, no encroachment:

$w^N = \\dfrac{a}{2}$
$q_R^N = \\dfrac{a}{4b}$
$\\pi_S^N = \\dfrac{a^2}{8b}$
$\\pi_R^N = \\dfrac{a^2}{16b}$
$cs^N = \\dfrac{a^2}{32b}$

### 3.2.2 The Peril of Being a Dual-Purpose Firm

dual-purpose retailer, no encroachment 

$w^{RN} = \\dfrac{a}{2}$
$q^{RN }_R = \\dfrac{a}{4b-2b\\delta}$
$\\pi^{RN}_S = \\dfrac{a^2}{4b(2-\\delta)}$
$\\pi^{RN}_R = \\dfrac{a^2(1-\\delta)}{4b(2-\\delta)^2}$

$cs^{RN } = \\dfrac{a^2}{8b(2-\\delta)^2}$

#### Observation 1 

> In the absence of supplier encroachment, a dual-purpose retailer earns a lower profit than a for-profit retailer.

### 3.2.3  The Bright Side and Downside of Supplier Encroachment. 

for-profit retailer, encroachment 

#### Observation 2 (The Bright Side of Supplier Encroachment)

>  In the benchmark with a for-profit retailer, 
> 
> (i) the supplier is never worse off for having the encroachment ability, and strictly better off for having the option of encroachment when 
> 
> $ c \\in[0,5 a / 6) $; 
> 
> (ii) the retailer can be better off by supplier encroachment when 
> 
> $ c \\in(3 a /[4 \\sqrt{2}],(1-\\sqrt{2} / 4) a) $.


#### Observation 3 (The Downside of Supplier Encroachment)

> In the benchmark with a for-profit retailer, 
> 
> both the retailer and consumers can be worse off by supplier encroachment when 
> 
> $ c \\in(3 a / 4,5 a / 6) $.

# 4 Results 

dual-purpose encroachment 

## 4.1 Equilibrium

#### (1)

$\\pi_{S}=\\left(a-b q_{R}-b q_{S}\\right) q_{S}-c q_{S}+w q_{R} $

#### (2)

$v_{R}=\\left(a-b q_{R}-b q_{S}\\right) q_{R}-w q_{R}+\\frac{b \\delta}{2}\\left(q_{R}+q_{S}\\right)^{2}$

## 4.2 Encroachment Outcomes under Dual-Purpose Setting

#### Proposition 1

> With a for-profit supplier and a dualpurpose retailer, there exists a threshold on $ \\delta $, denoted by $ \\delta_{E}=2 \\sqrt{2}-2<1 $, such that:
> 
> (i) When $ \\delta \\in\\left[0, \\delta_{E}\\right] $, 
> 
> - (a) the supplier is better off for having the option of encroachment if $ c \\in\\left[0, c_{2}(\\delta)\\right) $, 
> 
> - (b) the supplier is indifferent if $ c \\in\\left[c_{2}(\\delta), a\\right) $.
> 
> (ii) When $ \\delta \\in\\left(\\delta_{E}, 1\\right) $, 
> 
> - (a) the supplier is better off for having the option of encroachment if $ c \\in\\left[0, c_{3}(\\delta)\\right) $ or $ c \\in\\left(c_{4}(\\delta), c_{1}(\\delta)\\right) $ or $ c \\in\\left(\\max \\left\\{c_{1}(\\delta), c_{5}(\\delta)\\right\\}, c_{2}(\\delta)\\right) $,
> - (b) the supplier is worse off for having the option of encroachment if $ c \\in\\left(c_{3}(\\delta), \\min \\left\\{c_{1}(\\delta), c_{4}(\\delta)\\right\\}\\right) $ or $ c \\in\\left(c_{1}(\\delta), c_{5}(\\delta)\\right) $, and
> - (c) the supplier is indifferent if $ c \\in\\left[c_{2}(\\delta), a\\right) $.

#### Proposition 2

> With a for-profit supplier and a dualpurpose retailer, there exists a threshold on $ \\delta $, denoted by $ \\delta_{R}=(34-16 \\sqrt{2}) / 23<1 $, such that:
> 
> (i) When $ \\delta \\in\\left[0, \\delta_{R}\\right] $, the retailer is better off by supplier encroachment if $ c \\in\\left(c_{6}(\\delta), c_{7}(\\delta)\\right) $, and worse off by supplier encroachment if $ c \\in\\left[0, c_{6}(\\delta)\\right) $ or $ c \\in\\left(c_{7}(\\delta), a\\right) $.
> 
> (ii) When $ \\delta \\in\\left(\\delta_{R}, 1\\right) $, the retailer is always worse off by supplier encroachment.

## 4.3 Implication for Firm Profitability 

- Retailer can boost profit from being dual-purpose?

#### Proposition 3

> In the presence of supplier encroachment, a dual-purpose retailer earns a higher profit than a for-profit retailer when:
> 
> (i) $ c \\in\\left(c_{3}(\\delta), \\min \\left\\{(3 a \\sqrt{2-2 \\delta}) /(8-4 \\delta), c_{4}(\\delta)\\right\\}\\right) $; or 
> 
> (ii) $ c \\in\\left(\\max \\left\\{a-a \\sqrt{2-2 \\delta} /(4-2 \\delta), c_{2}(\\delta)\\right\\}, 5 a / 6\\right) $.

## 4.4 Implications for Consumer Surplus

#### Proposition 4

> Consumer surplus when the retailer is a dual-purpose corporation compared to when he is a purely for-profit firm:
> 
> (i) is lower if $ c \\in\\left(c_{3}(\\delta), \\min \\left\\{(3 a-3 a \\delta) /(2-\\delta), c_{4}(\\delta)\\right\\}\\right) $;
> 
> (ii) is indifferent if $ c \\in\\left(3 a / 5, c_{2}(\\delta)\\right) $;
> 
> (iii) is higher if $ c $ is not within the region specified above.

#### Proposition 5

> Retailer's interest in consumer surplus
> 
> (i) increases his own profit but reduces consumer surplus if $ c \\in\\left(c_{3}(\\delta), \\min \\{(3 a \\sqrt{2-2 \\delta}) /(8-4 \\delta),(3 a-3 a \\delta) /\\right. $ $ \\left.\\left.(2-\\delta), c_{4}(\\delta)\\right\\}\\right) $;
> 
> (ii) increases both his own profit and consumer surplus if $ \\quad(a) \\quad c \\in\\left(\\max \\left\\{c_{3}(\\delta),(3 a-3 a \\delta) /(2-\\delta)\\right\\},(3 a\\right. $ $ \\sqrt{2-2 \\delta}) /(8-4 \\delta)) ; $ or (b) $ c \\in(\\max \\{a-a \\sqrt{2-2 \\delta} / $ $ \\left.\\left.(4-2 \\delta), c_{2}(\\delta)\\right\\}, 5 a / 6\\right) $.

# 5 Extensions 

## 5.1 Consumer Surplus Specific to the Retailer’s Quantity

retailer only care his consumers' surplus

$cs_R = \\dfrac{q_R\\cdot cs}{q_R+q_S}$

#### Proposition 6

> Under the parsimonious dual-purpose retailer setting, 
> 
> (i) the supplier is always better off for having the encroachment ability; 
> 
> (ii) the retailer is better off by supplier encroachment if $ c \\in\\left(\\bar{c}_{3}(\\delta), \\bar{c}_{4}(\\delta)\\right) $.

#### Proposition 7

> (i) The retailer earns a higher profit from establishing himself as a parsimonious dual-purpose firm rather than a pure profit maximizer if: 
> 
> - (a) $ c \\in\\left(\\bar{c}_{5}(\\delta), \\bar{c}_{6}(\\delta)\\right) $; or $ 
> - (b) c \\in\\left(\\max \\left\\{\\bar{c}_{2}(\\delta), \\bar{c}_{7}(\\delta)\\right\\}, 5 a / 6\\right) $. 
> 
> (ii) The presence of parsimonious dual-purpose retailer has no effect on consumer surplus if $ c \\in\\left(3 a / 5, \\bar{c}_{2}(\\delta)\\right) $; Otherwise, it always increases consumer surplus.

## 5.2 Extremely High Interests in Consumer Surplus

$\\delta\\in[1,2)$

#### Proposition 8

> When $ \\delta \\in[1,2) $,
> 
>  (i) the supplier is worse off for having the option to encroach if $ c \\in\\left(0, \\tilde{c}_{2}(\\delta)\\right) $; 
> 
> (ii) the retailer's profit is always worse off by supplier encroachment; 
> 
> (iii) the dual-purpose structure always hurts the retailer's profit but benefits consumer surplus.

## 5.3 Price Competition


$k$: differentiation 

$q_i = \\dfrac{(1-k)a-p_i+kp_i}{1-k^2}$

- tension between supplier encroachment and the retailer’s dual-purpose structure becomes less intense

- the encroachment deterrence effect (i.e., deterring the supplier from selling a positive quantity) is not present with a dual-purpose retailer

- the reduction in wholesale price is less pronounced than under quantity competition

- the supplier will sell a positive quantity through her direct channel in a smaller region of parameter space

- the supplier secures greater retail profit (relies more on reselling) by raising the wholesale price even if her selling cost is relatively small

`,__vite_glob_0_40=`---
title: Game Theory - Assignment - Week 6
category: Assignments
---

# 2.4

## Problem 

> Two partners would like to complete a project. Each partner receives the payoff $ V $ when the project is completed but neither receives any payoff before completion. The cost remaining before the project can be completed is $ R $. Neither partner can commit to making a future contribution towards completing the project, so they decide to play the following two-period game: In period one partner 1 chooses to contribute $ c_{1} $ towards completion. If this contribution is sufficient to complete the project then the game ends and each partner receives $ V $. If this contribution is not sufficient to complete the project (i.e., $ c_{1}<R $ ) then in period two partner 2 chooses to contribute $ c_{2} $ towards completion. If the (undiscounted) sum of the two contributions is sufficient to complete the project then the game ends and each partner receives $ V $. If this sum is not sufficient to complete the project then the game ends and both partners receive zero.

> Each partner must generate the funds for a contribution by taking money away from other profitable activities. The optimal way to do this is to take money away from the least profitable alternatives first. The resulting (opportunity) cost of a contribution is thus convex in the size of the contribution. Suppose that the cost of a contribution $ c $ is $ c^{2} $ for each partner. Assume that partner 1 discounts second-period benefits by the discount factor $ \\delta $. Compute the unique backwards-induction outcome of this twoperiod contribution game for each triple of parameters $ \\{V, R, \\delta\\} $; see Admati and Perry (1991) for the infinite-horizon case.

## Solution 

Partner 2's optimal $ c_{2} $ is:
- If contributing $ R-c_{1} $ gives non-negative payoff: $ V-\\left(R-c_{1}\\right)^{2} \\geq 0 $.
  - Then $ c_{2}=R-c_{1} $.
- Else, $ c_{2}=0 $ (no contribution, project not completed).

Partner 1 will choose $ c_{1} $ to maximize their payoff among these options.
Option 1: $ c_{1} \\geq R $
- Best is to set $ c_{1}=R $ (since higher $ c_{1} $ increases cost without benefit).
- Payoff: $ V-R^{2} $.

Option 2: $ R-\\sqrt{V} \\leq c_{1}<R $
- To maximize $ \\delta V-c_{1}^{2} $, set $ c_{1} $ as small as possible within this range, i.e., $ c_{1}=R-\\sqrt{V} $.
- Payoff: $ \\delta V-(R-\\sqrt{V})^{2}=\\delta V-\\left(R^{2}-2 R \\sqrt{V}+V\\right) $.

Option 3: $ c_{1}<R-\\sqrt{V} $
- Best is $ c_{1}=0 $ (no cost, no payoff).
- Payoff: 0 .

Case 1: $ R \\leq \\sqrt{V} $
- Then $ R-\\sqrt{V} \\leq 0 $, so minimal $ c_{1} $ in Option 2 is 0 .
- Option 2 becomes contributing $ 0 \\leq c_{1}<R $.
- Best in Option 2 is $ c_{1}=0 $, payoff $ \\delta V-0=\\delta V $.
- Option 1: $ c_{1}=R $, payoff $ V-R^{2} $.
- Compare $ \\delta V $ and $ V-R^{2} $.
- $ \\delta V \\geq V-R^{2} $ if $ R^{2} \\geq(1-\\delta) V $.
- Otherwise, $ V-R^{2}>\\delta V $.

Case 2: $ R>\\sqrt{V} $
- Then $ R-\\sqrt{V}>0 $.
- Option 2: $ c_{1}=R-\\sqrt{V} $, payoff $ \\delta V-(R-\\sqrt{V})^{2} $.
- Option 1: $ c_{1}=R $, payoff $ V-R^{2} $.
- Compare as earlier.

Then:

1. Partner 1 contributes enough to complete the project in Period $ 1\\left(c_{1} \\geq R\\right) $ :
- Optimal is $ c_{1}=R $.
- Payoff: $ V-R^{2} $.
- This is better than other options if $ V-R^{2} \\geq \\delta V-(R-\\sqrt{V})^{2} $ and $ V-R^{2} \\geq 0 $.
- The first inequality simplifies to $ (2-\\delta) \\sqrt{V} \\geq 2 R $.
2. Partner 1 contributes $ c_{1}=R-\\sqrt{V} $ (leading to completion in Period 2):
- This is optimal if $ (2-\\delta) \\sqrt{V}<2 R $ and $ \\delta V-(R-\\sqrt{V})^{2} \\geq 0 $.
- The second inequality is $ (R-\\sqrt{V})^{2} \\leq \\delta V $.
3. Partner 1 contributes $ c_{1}=0 $ (project not completed):
o If $ \\delta V-(R-\\sqrt{V})^{2}<0 $ and $ V-R^{2}<0 $.

---

Final answer:

1. If $ V \\geq R^{2} $ and $ (2-\\delta) \\sqrt{V} \\geq 2 R $ :
- Partner 1 contributes $ c_{1}=R $ in Period 1, completing the project.
- Partner 2 does not need to contribute.
2. If $ (R-\\sqrt{V})^{2} \\leq \\delta V $ and $ (2-\\delta) \\sqrt{V}<2 R $ :
- Partner 1 contributes $ c_{1}=R-\\sqrt{V} $ in Period 1 .
- Partner 2 contributes $ c_{2}=\\sqrt{V} $ in Period 2, completing the project.
3. Else:
- Partner 1 contributes $ c_{1}=0 $.
- Partner 2 contributes $ c_{2}=0 $.
- Project is not completed.`,__vite_glob_0_41=`---
title: Game Theory - Assignment - Week 7
category: Assignments
---

# Problem

> 2.6. Three oligopolists operate in a market with inverse demand given by $ P(Q)=a-Q $, where $ Q=q_{1}+q_{2}+q_{3} $ and $ q_{i} $ is the quantity produced by firm $ i $. Each firm has a constant marginal cost of production, $ c $, and no fixed cost. The firms choose their quantities as follows: (1) firm 1 chooses $ q_{1} \\geq 0 $; (2) firms 2 and 3 observe $ q_{1} $ and then simultaneously choose $ q_{2} $ and $ q_{3} $, respectively. What is the subgame-perfect outcome?

# Solution 

For firm 2:

$ \\pi_{2}=(P-c) q_{2}=\\left(a-\\left(q_{1}+q_{2}+q_{3}\\right)-c\\right) q_{2} $

By maximizing the profit, we can get:

$ q_{2}=\\frac{a-c-q_{1}-q_{3}}{2} $

Similarly:

$ q_{3}=\\frac{a-c-q_{1}-q_{2}}{2} $

With $q_2 = q_3$, we get:

$ q_{2}+q_{3}=\\frac{2\\left(a-c-q_{1}\\right)}{3} $

Then, for firm 1:

$ Q=q_{1}+q_{2}+q_{3}=q_{1}+\\frac{2\\left(a-c-q_{1}\\right)}{3} $

Then firm 1's profit is:

$ \\begin{array}{l}\\pi_{1}=(P-c) q_{1}=\\left(\\frac{a-q_{1}+2 c}{3}-c\\right) q_{1} \\\\ =\\left(\\frac{a-q_{1}+2 c-3 c}{3}\\right) q_{1}=\\frac{a-q_{1}-c}{3} q_{1}\\end{array} $

By maximizing the profit, we can get:

$ q_{1}=\\frac{a-c}{2} $

Also we can get:

$ q_2 = q_3 = \\frac{a-c}{6}$

Then:

$Q = \\dfrac{5(a-c)}{6}$

$P = \\dfrac{a + 5c}{6}$
`,__vite_glob_0_42=`---
title: Game Theory - Assignment - Week 8
category: Assignments
---

# 1

## Problem

> 1. Consider the following simultaneous moving game.

$$
\\begin{array}{ll|l|l|l|} 
&&&Player 2\\\\
 &  & L_{2} & M_{2} & R_{2} \\\\
\\hline
 & L_{1} & 1,1 & 6,0 & 0,0 \\\\
\\hline
  Player 1 & M_{1} & 0,6 & 4,4 & 0,0 \\\\
\\hline
 & R_{1} & 0,0 & 0,0 & 2,2 \\\\
\\hline
\\end{array}
$$

(a) Identify a mixed strategy for Player 1 that strictly dominates the strategy $ M_{1} $.
(b) Compute the set of all Nash equilibria, including those associated with mixed strategies. It is important to note that in any mixed strategy Nash equilibrium, strictly dominated strategies receive a probability of zero.
(c) Now consider a two-stage game where the stage game is the simultaneous move game and the discount factor is set to $ \\delta=1 $. Is it possible to identify a subgame perfect Nash equilibrium in which strategies $ M_{1} $ and $ M_{2} $ are employed in some stage? If so, please specify the subgame perfect Nash equilibrium; if not, please provide an explanation for why this is the case.
(d) Referring to the two-stage game discussed in part (c), what is the maximum payoff achievable for each of the two players when they engage in rational play?
(e) Consider the infinitely repeated game, using the simultaneous move game as the stage game, and let the discount factor be $ \\delta $. What is the minimum value of $ \\delta $ under which the two players implement grim trigger strategies and $ M_{1} $ and $ M_{2} $ are employed in every stage? Additionally, please outline the grim trigger strategy for each player.

## Solution (a)

$(\\dfrac{3}{4}, 0 , \\dfrac{1}{4})$

## Solution (b)

Pure: $ \\left(L_{1}, L_{2}\\right),\\left(R_{1}, R_{2}\\right) $
Mixed: $((\\dfrac{2}{3},0,{1}{3}),(\\dfrac{2}{3},0,{1}{3}))$

## Solution (c)

- Stage 2: Must be an NE- $ \\left(L_{1}, L_{2}\\right),\\left(R_{1}, R_{2}\\right) $, or mixed-none include $ M_{1} $ or $ M_{2} $.
- Stage 1: Playing $ \\left(M_{1}, M_{2}\\right) $ (payoff 4,4 ) deviates to $ L_{1} $ (6 against $ M_{2} $ ), breaking NE unless enforced, but stage 2 constraints prevent it.

No subgame-perfect NE includes $ M_{1} $ or $ M_{2} $ due to domination and NE requirements.
Answer for (c): Not possible, as $ M_{1} $ is strictly dominated and excluded from NE, including stage 2 .

## Solution (d)

$2+2=4$

## Solution (e)

Grim trigger: Play $ \\left(M_{1}, M_{2}\\right)(4,4) $ until deviation, then revert to NE (e.g., $ \\left(L_{1}, L_{2}\\right) $, payoff 1,1) forever.
- Cooperation: $ 4+4 \\delta+4 \\delta^{2}+\\cdots=\\frac{4}{1-\\delta} $
- Deviate: Player 1 plays $ L_{1} $ vs. $ M_{2}: 6 $, then 1 forever: $ 6+\\frac{\\delta}{1-\\delta} $
- Incentive: $ \\frac{4}{1-\\delta} \\geq 6+\\frac{\\delta}{1-\\delta} $
- Solve: $ 4 \\geq 6(1-\\delta)+\\delta \\rightarrow 4 \\geq 6-6 \\delta+\\delta \\rightarrow 4 \\geq 6-5 \\delta \\rightarrow 5 \\delta \\geq 2 \\rightarrow \\delta \\geq \\frac{2}{5} $

Answer for (e): Minimum $ \\delta=\\frac{2}{5} $. Grim trigger: Play $ M_{1}, M_{2} $ unless deviation, then $ L_{1}, L_{2} $ forever.

# 2.10

## Problem 

> 2.10. The accompanying simultaneous-move game is played twice, with the outcome of the first stage observed before the second stage begins. There is no discounting. The variable $ x $ is greater than 4 , so that $ (4,4) $ is not an equilibrium payoff in the one-shot game. For what values of $ x $ is the following strategy (played by both players) a subgame-perfect Nash equilibrium?

Play $ Q_{i} $ in the first stage. If the first-stage outcome is $ \\left(Q_{1}, Q_{2}\\right) $, play $ P_{i} $ in the second stage. If the first-stage outcome is $ \\left(y, Q_{2}\\right) $ where $ y \\neq Q_{1} $, play $ R_{i} $ in the second stage. If the first-stage outcome is $ \\left(Q_{1}, z\\right) $ where $ z \\neq Q_{2} $, play $ S_{i} $ in the second stage. If the first-stage outcome is $ (y, z) $ where $ y \\neq Q_{1} $ and $ z \\neq Q_{2} $, play $ P_{i} $ in the second stage.

$$
\\begin{array}{|l|l|l|l|l|}
\\hline 
 & P_{2} & Q_{2} & R_{2} & S_{2} \\\\
\\hline 
 {P_{1}}& 2, 2 & x, 0 & -1, 0 & 0,0 \\\\
\\hline 
Q_{1} & 0, x & 4, 4 & -1, 0 & 0,0 \\\\
\\hline 
R_{1} & 0, 0 & 0, 0 & 0, 2 & 0,0 \\\\
\\hline 
S_{1} & 0,-1 & 0, -1 & -1, -1 & 2,0 \\\\
\\hline
\\end{array}
$$


## Solution

- Both follow the strategy: Play $ \\left(Q_{1}, Q_{2}\\right) $.
  - First stage: $ \\left(Q_{1}, Q_{2}\\right) $ gives $ (4,4) $.
  - Second stage: $ \\left(P_{1}, P_{2}\\right) $ gives $ (2,2) $.
  - Total payoff: $ (4+2,4+2)=(6,6) $.
- Player 1 deviates to $ P_{1} $, Player 2 plays $ Q_{2} $ :
  - First stage: $ \\left(P_{1}, Q_{2}\\right) $ gives $ (\\mathrm{x}, 0) $.
  - Second stage: Since $ y=P_{1} \\neq Q_{1} $, play $\\left(\\mathrm{R}_1, \\mathrm{R}_2\\right) $ gives $ (0,2) $.
  - Total for Player 1: $ \\mathrm{x}+0=\\mathrm{x} $.
  - Total for Player 2: $ 0+2=2 $.
- Player 1's incentive: Compare total payoffs:
  - Sticking to $ Q_{1}: 6 $.
  - Deviating to $ P_{1}: x $.
  - No deviation if $ 6 \\geq x $ or $ x \\leq 6 $.
- Player 2 deviates to $ P_{2} $, Player 1 plays $ Q_{1} $ :
  - First stage: $ \\left(Q_{1}, P_{2}\\right) $ gives $ (0, \\mathrm{x}) $.
  - Second stage: Since $ z=P_{2} \\neq Q_{2} $, play $ \\left(S_{1}, S_{2}\\right) $ gives $ (2,0) $.
  - Total for Player 2: $ x+0=x $.
  - Total for Player 1: $ 0+2=2 $.
  - Player 2's incentive: 6 (sticking) vs. $ x $ (deviating).
  - No deviation if $ x \\leq 6 $.

Therefore if $x<6$ it's subgame-perfect NE

# 2.11

## Problem 

2.11. The simultaneous-move game (below) is played twice, with the outcome of the first stage observed before the second stage begins. There is no discounting. Can the payoff $ (4,4) $ be achieved in the first stage in a pure-strategy subgame-perfect Nash equilibrium? If so, give strategies that do so. If not, prove why not.
$$
\\begin{array}{c|c|c|c|} 
&L&C&R\\\\
 \\hline
 T & 3,1 & 0,0 & 5,0 \\\\
 \\hline
M & 2,1 & 1,2 & 3,1 \\\\
 \\hline
 B & 1,2 & 0,1 & 4,4 \\\\
 \\hline
\\end{array}
$$

## Solution

- Both play (B, R): First stage (4,4), second stage (T, L) with $ (3,1) $, total $ (7,5) $.
- Player 1 deviates to T, Player 2 plays R:
  - First stage: $ (T, \\mathrm{R}) $ with $ (5,0) $.
  - Second stage: Since $ (T, R) \\neq(B, R) $, play $ (M, C) $ with $ (1,2) $.
  - Total: Player 1: $ 5+1=6<7 $, Player 2: $ 0+2=2<5 $.
- Player 1 deviates to M, Player 2 plays R:
  - First stage: (M, R) with $ (3,1) $.
  - Second stage: (M, C) with $ (1,2) $.
  - Total: Player 1: $ 3+1=4<7 $, Player 2: $ 1+2=3<5 $.
- Player 2 deviates to $ L $, Player 1 plays B:
  - First stage: (B, L) with $ (1,2) $.
  - Second stage: (M, C) with $ (1,2) $.
  - Total: Player 1: $ 1+1=2<7 $, Player 2: $ 2+2=4<5 $.
- Player 2 deviates to C, Player 1 plays B:
  - First stage: $ (B, C) $ with $ (0,1) $.
  - Second stage: (M, C) with $ (1,2) $.
  - Total: Player 1: $ 0+1=1<7 $, Player 2: $ 1+2=3<5 $.

No unilateral deviation improves either player's total payoff:
- Player 1: Sticking with B gives 7, deviating gives 6 (T), 4 (M).
- Player 2: Sticking with R gives 5, deviating gives 4 (L), 3 (C).

Thus, (B,R) is a NE in the first stage given the second-stage strategies.
`,__vite_glob_0_43=`---
title: Game Theory - Assignment - Week 9
category: Assignments
---

# 2.15

## Problem

> Suppose there are $ n $ firms in a Cournot oligopoly. Inverse demand is given by $ P(Q)=a-Q $, where $ Q=q_{1}+\\cdots+q_{n} $. Consider the infinitely repeated game based on this stage game. What is the lowest value of $ \\delta $ such that the firms can use trigger strategies to sustain the monopoly output level in a subgame-perfect Nash equilibrium? How does the answer vary with $ n $, and why? If $ \\delta $ is too small for the firms to use trigger strategies to sustain the monopoly output, what is the most-profitable symmetric subgame-perfect Nash equilibrium that can be sustained using trigger strategies?

## Solution 

Monopoly:

$ \\pi=P(Q) \\cdot Q=(a-Q) \\cdot Q=a Q-Q^{2} $

Then:

$ \\dfrac{d \\pi}{d Q}=a-2 Q=0 \\Longrightarrow Q^{m}=\\dfrac{a}{2} $

Then:

$ \\pi_{i}^{m}=\\dfrac{\\pi^{m}}{n}=\\dfrac{a^{2}}{4 n} $

Cournot Nash equilibrium:

$ \\dfrac{\\partial \\pi_{i}}{\\partial q_{i}}=a-2 q_{i}-Q_{-i}=0 \\Longrightarrow q_{i}=\\dfrac{a-Q_{-i}}{2} $

$ q_{i}^{N}=\\dfrac{a}{n+1} $

Then:

$ \\pi_{i}^{N}=q_{i}^{N} \\cdot P\\left(Q^{N}\\right)=\\dfrac{a}{n+1} \\cdot \\dfrac{a}{n+1}=\\dfrac{a^{2}}{(n+1)^{2}} $

Diviation Data:

$ \\pi_{i}=q_{i}\\left(a-q_{i}-\\dfrac{(n-1) a}{2 n}\\right)=q_{i}\\left(\\dfrac{a}{2}+\\dfrac{a}{2 n}-q_{i}\\right)=q_{i}\\left(\\dfrac{a(n+1)}{2 n}-q_{i}\\right) $

$ \\pi_{i}=q_{i}\\left(a-q_{i}-\\dfrac{(n-1) a}{2 n}\\right)=q_{i}\\left(\\dfrac{a}{2}+\\dfrac{a}{2 n}-q_{i}\\right)=q_{i}\\left(\\dfrac{a(n+1)}{2 n}-q_{i}\\right) $

Then:

$ \\pi_{i}^{d}=q_{i}^{d} \\cdot P=\\dfrac{a(n+1)}{4 n} \\cdot \\dfrac{a(n+1)}{4 n}=\\dfrac{a^{2}(n+1)^{2}}{16 n^{2}} $

Trigger strategy:

$ \\dfrac{\\pi_{i}^{m}}{1-\\delta} \\geq \\pi_{i}^{d}+\\dfrac{\\delta}{1-\\delta} \\pi_{i}^{N} $

Then:

$ \\delta \\geq \\dfrac{(n-1)^{2}}{\\dfrac{n^{4}+4 n^{3}-10 n^{2}+4 n+1}{(n+1)^{2}}}=\\dfrac{(n-1)^{2}(n+1)^{2}}{n^{4}+4 n^{3}-10 n^{2}+4 n+1} $

# 2.17

## Problem

> 2.17. Consider the following infinite-horizon game between a single firm and a sequence of workers, each of whom lives for one period. In each period the worker chooses either to expend effort and so produce output $ y $ at effort cost $ c $ or to expend no effort, produce no output, and incur no cost. If output is produced, the firm owns it but can share it with the worker by paying a wage, as described next. Assume that at the beginning of the period the worker has an alternative opportunity worth zero (net of effort cost) and that the worker cannot be forced to accept a wage less than zero. Assume also that $ y>c $ so that expending effort is efficient.

> Within each period, the timing of events is as follows: first the worker chooses an effort level, then output is observed by both the firm and the worker, and finally the firm chooses a wage to pay the worker. Assume that no wage contracts can be enforced: the firm's choice of a wage is completely unconstrained. In a oneperiod game, therefore, subgame-perfection implies that the firm will offer a wage of zero independent of the worker's output, so the worker will not expend any effort.

> Now consider the infinite-horizon problem. Recall that each worker lives for only one period. Assume, however, that at the beginning of period $ t $, the history of the game through period $ t-1 $ is observed by the worker who will work in period $ t $. (Think of this knowledge as being passed down through the generations of workers.) Suppose the firm discounts the future according to the discount factor $ \\delta $ per period. Describe strategies for the firm and each worker in a subgame-perfect equilibrium in the infinitehorizon game in which in equilibrium each worker expends effort and so produces output $ y $, provided the discount factor is high enough. Give a necessary and sufficient condition for your equilibrium to exist.

## Solution 

 Firm's Strategy
- In period $ t $ :
- If the history shows the firm has always paid at least $ w^{*} \\geq c $ whenever output $ y $ was produced in all past periods (or if $ t=1 $, the initial period), then:
- Pay $ w_{t}=w^{*} $ if the worker produces output $ y $.
- Pay $ w_{t}=0 $ if the worker produces output 0 .
- If the history shows the firm ever paid $ w<w^{*} $ when output $ y $ was produced, then:
- Pay $ w_{t}=0 $ regardless of the worker's output.
- Choose $ w^{*} \\geq c $ to ensure the worker's participation constraint is satisfied.

Worker's Strategy (for worker in period $ t $ )**
- If the history shows the firm has always paid at least $ w^{*} \\geq c $ when output $ y $ was produced (or if $ t=1 $ ):
- Choose effort (produce $ y $ ) if $ w^{*} \\geq c $.
- Choose no effort (produce 0) if $ w^{*}<c $.
- If the history shows the firm ever paid $ w<w^{*} $ when output $ y $ was produced:
- Choose no effort (produce 0).

Then:

- Firm's Strategy: Pay $ w_{t}=c $ if the worker produces $ y $ and the firm has always paid $ w_{t} \\geq c $ when $ y $ was produced in the past (or $ t=1 $ ); otherwise, pay $ w_{t}=0 $.
- Worker's Strategy: In period $ t $, produce $ y $ if the firm has always paid $ w_{t} \\geq c $ when $ y $ was produced in the past (or $ t=1 $ ); otherwise, produce 0 .
- Condition: The equilibrium exists if and only if $ \\delta \\geq \\dfrac{c}{y} $.

`,__vite_glob_0_44=`---
title: Game Theory - Week 1
category: Notes
---

# Introduction

## What is a game?

- Decisions (single-person decision problem)
  - take the world as given, make best decision for yourself
- Games (multiple-person decison problem)
  - you best decision depends on what others do, and what they do may depend on what they think you do...

## Prisoner's Dilemma

- GPA race
- Grade inflation
- Arms race 

## What is Game Theory?

- A formal way to analyze **strategic interaction** among a group of rational players ( or agents ) who behave strategically

### Classifying Games

- Zero-sum / non-zero sum 
- One-shot / repeated 
- Fixed / manipulable rules 
- Enforceable / unenforceable cooperative agreements 
- Simultaneous / sequential moves 
- Complete / private information 

### Four main part

Static / Dynamic + Complete / private 

## Terminology 

- Players 
  - Participants in the game 
- Strategies 
  - A complete plan of actions 
    - Might be conditioned on history
- Payoffs
  - Some numerical representation of the objectives of each player 
    - Could take account fairness / reputation, etc.
    - Does not mean players are narrowly selfish
- Equilibrium
  - Players play strategies that are $mutual best response to each other$

### Standard Assumptions 

- Rationality
  - Players are perfect calculators and implementers of their desired strategy 
- Common knowledge of rules 
  - All players know the game being played 
  - All players know that all players know the game being played 
  - etc.

`,__vite_glob_0_45=`---
title: Game Theory - Assignment - Week 10
category: Assignments
---

# 7

Mictel corporation has a world monopoly on the production of personal computers. It can make two kinds of computers: low-end and high-end. The total population of prospective buyers is $ P $. There are two types of prospective buyers: casual users and intensive users. The casual ones comprise a fraction $ c $ of the population, and the rest (fraction $ 1-c $ ) are intensive users.

The costs of production of the two kinds of machines, as well as the benefits gained from the two by the two types of prospective buyers, are given in the following table. All figures are in thousands of dollars.

$$
\\begin{array}{|c|c|c|c|}
\\hline
 & \\text{COST} & \\text{BENEFIT FOR USER TYPE} & \\\\
\\hline
 & & \\text{Casual} & \\text{Intensive} \\\\
\\hline
\\text{PC TYPE} & \\text{Low-end} & 1 & 4 \\\\
\\hline
\\text{PC TYPE} & \\text{High-end} & 3 & 5 \\\\
\\hline
\\end{array}
$$

Each type of buyer calculates the net payoff (benefit minus price) that he would get from each type of machine and buys the type that would give the higher net payoff, provided that this payoff is nonnegative. If both types give equal nonnegative net payoffs for a buyer, he goes for the high end; if both types have negative net payoff for a buyer, he does not purchase. Mictel wants to maximize its expected profit.
(a) If Mictel were omniscient, then, when a prospective customer came along, knowing his type, the company could offer to sell him just one type of machine at a stated price, on a take-it-or-leave-it basis. What kind of machine would Mictel offer, and at what price, to what kind of buyer?
In fact, Mictel does not know the type of any particular buyer. It just makes its "catalog" available for all buyers to choose from.
(b) First suppose the company produces just the low-end machines and sells them for price $ x $. What value of $ x $ will maximize its profit? How does the answer depend on $ c $, the proportion of casual users in the population?
(c) Next suppose Mictel produces just the high-end machines and sells them for price $ y $. What value of $ y $ will maximize its profit, and how does the answer depend on $ c $ ?
(d) Finally, suppose the company produces both types of machines, selling the low-end ones for price $ x $ and the high-end ones for price $ y $. What "incentive compatibility" constraints on $ x $ and $ y $ must the company satisfy if it wants the casual users to buy the low-end machines and the intensive users to buy the high-end machines? What is the company's expected profit from this policy? What values of $ x $ and $ y $ will maximize the expected profit? How does the answer depend on $ c $ ?
(e) Putting it all together, what production and pricing policy should the company pursue? How does the answer depend on $ c $ ?

## Solution (a)

Casual Users

Low-end: Benefit = 4 , Cost = 1
- Max price: $ 4-\\mathrm{x} \\geq 0 \\rightarrow \\mathrm{x} \\leq 4 $
- Profit: $ \\mathrm{x}-1 $
- Set $ \\mathrm{x}=4 \\rightarrow $ Profit $ =4-1=3 $

High-end: Benefit $ =5 $, Cost $ =3 $
- Max price: $ 5-\\mathrm{y} \\geq 0 \\rightarrow \\mathrm{y} \\leq 5 $
- Profit: y - 3
- Set $ \\mathrm{y}=5 \\rightarrow $ Profit $ =5-3=2 $

Since $ 3>2 $, offer low-end at $ x=4 $, profit $ =3 $.


Intensive Users

Low-end: Benefit = 3, Cost = 1
- Max price: $ 3-\\mathrm{x} \\geq 0 \\rightarrow \\mathrm{x} \\leq 3 $
- Profit: $ \\mathrm{x}-1 $
- Set $ x=3 \\rightarrow $ Profit $ =3-1=2 $
  
High-end: Benefit $ =6 $, Cost $ =3 $
- Max price: $ 6-\\mathrm{y} \\geq 0 \\rightarrow \\mathrm{y} \\leq 6 $
- Profit: $ y-3 $
- Set $ \\mathrm{y}=6 \\rightarrow $ Profit $ =6-3=3 $

Since $ 3>2 $, offer high-end at $ y=6 $, profit $ =3 $.

## Solution (b)

Casual: $ 4-\\mathrm{x} \\geq 0 \\rightarrow \\mathrm{x} \\leq 4 $
Intensive: $ 3-\\mathrm{x} \\geq 0 \\rightarrow \\mathrm{x} \\leq 3 $
$ x>4 $ : Both net payoffs negative, no buyers, profit $ =0 $.
$ 3<x \\leq 4 $ : Casual buy ( $ 4-x \\geq 0 $ ), intensive don't ( $ 3-x<0 $ )
- Buyers = cP
- Profit $ =\\mathrm{cP}(\\mathrm{x}-1) $
- Maximize: $ x=4 \\rightarrow $ Profit $ =c P(4-1)=3 c P $
$ x \\leq 3 $ : Both buy
- Buyers = P
- Profit $ =P(x-1) $
- Maximize: $ x=3 \\rightarrow $ Profit $ =P(3-1)=2 P $

$3 cP vs. 2P$

$
3 \\mathrm{cP}>2 \\mathrm{P} \\rightarrow \\mathrm{c}>2 / 3
$

If $ \\mathrm{c}>2 / 3: \\mathrm{x}=4 $, profit $ =3 \\mathrm{cP} $
If $ \\mathrm{c}<2 / 3 $ : $ \\mathrm{x}=3 $, profit $ =2 \\mathrm{P} $
If $ \\mathrm{c}=2 / 3: 3(2 / 3) \\mathrm{P}=2 \\mathrm{P} $, either works

## Solution (c)

Casual: $ 5-\\mathrm{y} \\geq 0 \\rightarrow \\mathrm{y} \\leq 5 $
Intensive: $ 6-\\mathrm{y} \\geq 0 \\rightarrow \\mathrm{y} \\leq 6 $
$ \\mathrm{y}>6 $ : No buyers, profit $ =0 $.
$ 5<\\mathrm{y} \\leq 6 $ : Intensive buy ( $ 6-\\mathrm{y} \\geq 0 $ ), casual don't ( $ 5-\\mathrm{y}<0 $ )
- Buyers $ =(1-\\mathrm{c}) \\mathrm{P} $
- Profit $ =(1-c) P(y-3) $
- Maximize: $ y=6 \\rightarrow $ Profit $ =3(1-c) P $
$ y \\leq 5 $ : Both buy
- Buyers = P
- Profit $ =P(y-3) $
- Maximize: $ y=5 \\rightarrow $ Profit $ =2 \\mathrm{P} $


$3 (1-c)P vs. 2P$

$
3 (1-c)P>2 \\rightarrow 1-c>2 / 3
$

If $ 1-c<1 / 3: \\mathrm{y}=6 $, profit $ =3 (1-c) P $
If $ 1-c>1 / 3 $ : $ \\mathrm{y}=5 $, profit $ =2 P $
If $ 1-c=1 / 3: 3(2 / 3) P=2 P $, either works.

## Solution (d)

Constraints:

$$
\\begin{array}{l}
y-x \\ge 1 \\\\
y\\le x+3 \\\\ 
x\\le 4\\\\ 
y\\le 6
\\end{array}
$$

Solution:

$x=3, y=6$

Profit: $3P$

## Solution (e)

Low-end only: $\\max\\{3cP, 2P\\}$

High-end only: $\\max\\{3(1-c)P, 2P\\}$

Both: $3P$

Then: 

produce both, $x=4, y=6$, profit $3P$

`,__vite_glob_0_46=`---
title: Game Theory - Paper - Week 10
category: Game Theory Paper
---

# Model 

Period 1:
- The manufacturer sets a wholesale price $ w_{1} $ and offers a rebate $ \\delta $ to consumers, applicable only in period 1.
- The retailer chooses the procurement quantity $ Q_{1} $ and sets the retail price $ p_{1} $.
- Consumers pay an out-of-pocket price $ P_{1}=p_{1}-\\delta $, leading to purchases $ q\\left(p_{1}-\\delta\\right) $.
- Excess procurement becomes inventory: $ I=Q_{1}-q\\left(p_{1}-\\delta\\right) $, carried to period 2 at a holding cost $ h \\geq 0 $ per unit.

Period 2:
- The manufacturer sets a wholesale price $ w_{2} $.
- The retailer chooses procurement $ Q_{2} $ and retail price $ p_{2} $, using inventory $ I $ and new purchases $ Q_{2} $.
- Consumers pay $ P_{2}=p_{2} $ (no rebate), leading to purchases $ q\\left(p_{2}\\right) $.

- Consumer demand in each period $ i=1,2 $ is given by:
\\[
q\\left(P_{i}\\right)=\\frac{a-P_{i}}{b}
\\]
where $ P_{i} $ is the out-of-pocket price paid by consumers, $ a>0 $ is the demand intercept, and $ b>0 $ scales the price sensitivity.

# Proposition 1

(i) The manufacturer strictly benefits from offering consumer rebates.
(ii) The manufacturer's decision to offer rebates also benefits the retailer and consumers.

## Intuition

Without Rebates: The retailer uses inventory strategically to force the manufacturer to lower the wholesale price in period 2. By carrying extra inventory from period 1, the retailer reduces its dependence on period 2 purchases, weakening the manufacturer's pricing power. Anticipating this, the manufacturer sets a high $ w_{1} $ in period 1 to discourage excessive inventory, leading to high retail prices and inefficiencies (e.g., too much inventory and distorted pricing).

With Rebates: The manufacturer offers a rebate $ \\delta $ in period 1 , lowering the consumer's out-of-pocket price ( $ P_{1}=p_{1}-\\delta $ ). This boosts period 1 sales, making it more profitable for the retailer to sell now rather than hoard inventory for later. As a result:
- The retailer carries less inventory, reducing holding costs.
- The manufacturer can lower $ w_{1} $ since it doesn't need to counter excessive inventory buildup.
- Consumers enjoy lower prices in period 1 due to the rebate, and more efficient pricing overall.
- Why Everyone Wins: The rebate aligns incentives-sales increase, inventory costs drop, and pricing becomes less distorted, boosting profits for the manufacturer and retailer while lowering consumer costs.

# Proposition 2

The use of consumer rebates is preferred to the elimination of inventories (just-in-time, or JIT) by the manufacturer, retailer, and consumers alike.

## Intuition

- JIT (No Inventory): In a JIT system, the retailer cannot carry inventory, so each period operates independently. This leads to double marginalization-the manufacturer sets a high wholesale price, the retailer adds its markup, and consumers face high prices with reduced quantities. Efficiency suffers as there's no mechanism to soften the manufacturer's pricing power.
- Strategic Inventory Without Rebates (AAB): The retailer uses inventory to lower $ w_{2} $, mitigating double marginalization in period 2 . However, this comes at the cost of a high $ w_{1} $ (to deter inventory) and holding costs, which can outweigh the benefits depending on parameters.
- With Rebates: Rebates encourage period 1 sales, reducing excessive inventory while preserving some strategic use of inventory to limit double marginalization in period 2. This strikes a balance:
- Better than JIT because some inventory reduces pricing distortions.
- Better than no rebates because rebates prevent overstocking, lowering costs and stabilizing prices.
- Why Preferred: All parties benefit-manufacturer and retailer profits rise due to efficiency gains, and consumers get lower prices compared to JIT's high markups.

# Proposition 3

With nonlinear wholesale pricing, consumer rebates yield Pareto gains for positive holding costs $ (h>0) $.

## Intuition

Nonlinear Pricing Without Rebates: Nonlinear contracts (e.g., quantity-contingent pricing $ T_{t}\\left(Q_{t}\\right) $ ) allow the manufacturer to better align incentives than linear pricing, potentially extracting all retailer surplus. However, strategic inventory still creates inefficiencies-the retailer holds inventory to influence future terms, preventing the manufacturer from achieving the fully coordinated (first-best) outcome, as shown in AAB.

With Rebates: Adding rebates reduces the retailer's incentive to hold strategic inventory. The rebate boosts period 1 demand, making immediate sales more attractive than stockpiling. This allows the nonlinear contract to work more effectively:
- Inventory drops to zero (or minimal levels), eliminating holding cost inefficiencies.
- The manufacturer achieves first-best profit (like an integrated supply chain), while consumers benefit from lower prices.
- The retailer is indifferent (profit $ =0 $ ) as the manufacturer extracts all surplus, but this is still a Pareto improvement over the no-rebate case.

Why Pareto Gains: Rebates enhance coordination, benefiting the manufacturer (higher profit), consumers (lower prices), and at least not harming the retailer compared to the baseline.

# Proposition 4

In a three-period game:
- (i) The manufacturer and retailer each benefit from expiring consumer rebates regardless of their duration.
- (ii) The manufacturer prefers a long-duration rebate (valid in periods 1 and 2) if and only if the holding cost $ h $ is sufficiently large.

## Intuition 

Three-Period Dynamics: With three periods, the retailer can carry inventory from period 1 to $ 2\\left(I_{1}\\right) $ and from 2 to $ 3\\left(I_{2}\\right) $, amplifying strategic behavior. Without rebates, this leads to more inventory buildup and higher initial wholesale prices, increasing inefficiency.
Expiring Rebates (Short or Long):
- Short-Term Rebate (Period 1 Only): Encourages sales in period 1, reducing inventory carried to both period 2 and 3 .
- Long-Term Rebate (Periods 1 and 2): Boosts sales in the first two periods, mainly curbing inventory from period 2 to 3 .
- Both reduce strategic hoarding, lowering costs and wholesale prices, benefiting the manufacturer and retailer.

Duration Preference:
- Low Holding Costs: The retailer is willing to hold inventory longer (e.g., to period 3). A short-term rebate is more effective because it aggressively curbs inventory buildup across all periods by focusing on period 1 sales.
- High Holding Costs: Inventory is costly, so the retailer avoids long-term hoarding (period 3). The main issue is inventory from period 1 to 2 . A long-term rebate addresses this by incentivizing sales through period 2, aligning with the two-period model's logic.

Why Benefits Persist: Rebates, regardless of duration, mitigate strategic inventory, improving efficiency. The manufacturer's preference hinges on how holding costs shape inventory behavior.




`,__vite_glob_0_47=`---
title: Game Theory - Assignment - Week 11
category: Assignments
---

# 4.4

## Problem 



## Solution 

In pooling equilibria, both sender types play the same message.
1. Pooling on $ L $ :
- Sender strategy: Both $ t_{1} $ and $ t_{2} $ choose $ L $.
o Receiver strategy:
- Upon observing $ L $, play $ d $.
- Upon observing $ R $ (off-equilibrium), play $ d $.
o Beliefs:
- At $ L $ information set: $ P\\left(t_{1}\\right)=0.5, P\\left(t_{2}\\right)=0.5 $ (consistent with pooling).
- At $ R $ information set: $ P\\left(t_{1}\\right) \\leq 1 / 3 $ (off-equilibrium, arbitrary but must justify playing $ d $ ).
o Equilibrium justification:
- On-path $ (L) $ : Receiver's expected payoff from $ u $ is $ 0.5 \\times 1+0.5 \\times 0=0.5 $; from $ d $ is $ 0.5 \\times 0+0.5 \\times 1=0.5 $. Receiver is indifferent, so playing $ d $ is optimal.
- Off-path $ (R) $ : With belief $ P\\left(t_{1}\\right) \\leq 1 / 3 $, receiver's expected payoff from $ u $ is $ 2 \\times P\\left(t_{1}\\right) \\leq $ $ 2 / 3 $, and from $ d $ is $ 1-P\\left(t_{1}\\right) \\geq 2 / 3 $. Thus, playing $ d $ is optimal (strictly if $ P\\left(t_{1}\\right)<1 / 3 $, weakly if $ P\\left(t_{1}\\right)=1 / 3 $ ).
- Sender incentives:
- $ t_{1} $ : Gets 2 from $ L $ (receiver plays $ d $ ). Deviating to $ R $ : Receiver plays $ d $, so payoff is 0 (worse than 2). No incentive to deviate.
- $ t_{2} $ : Gets 1 from $ L $ (receiver plays $ d $ ). Deviating to $ R $ : Receiver plays $ d $, so payoff is 1 (same as equilibrium). Indifferent, so no strict incentive to deviate.

2. Pooling on $ R $ :
- Sender strategy: Both $ t_{1} $ and $ t_{2} $ choose $ R $.
o Receiver strategy:
- Upon observing $ R $, play $ u $.
- Upon observing $ L $ (off-equilibrium), play any action (e.g., $ u $ or $ d $ ) depending on belief.
o Beliefs:
- At $ R $ information set: $ P\\left(t_{1}\\right)=0.5, P\\left(t_{2}\\right)=0.5 $ (consistent with pooling).
- At $ L $ information set: Any belief $ P\\left(t_{1}\\right)=q $ for $ q \\in[0,1] $, and receiver plays a best response to this belief.
- Equilibrium justification:
- On-path $ (R) $ : Receiver's expected payoff from $ u $ is $ 0.5 \\times 2+0.5 \\times 0=1 $; from $ d $ is $ 0.5 \\times 0+0.5 \\times 1=0.5 $. Playing $ u $ is strictly optimal ( $ 1>0.5 $ ).
- Off-path $ (L) $ : Receiver plays a best response to belief $ q $. For example:
- If $ q>0.5 $, play $ u $ (since $ q>1-q $ ).
- If $ q<0.5 $, play $ d $ (since $ q<1-q $ ).
- If $ q=0.5 $, indifferent, can play either.
- Sender incentives:
- $ t_{1} $ : Gets 2 from $ R $ (receiver plays $ u $ ). Deviating to $ L $ : If receiver plays $ u $, payoff is $ 1<2 $; if receiver plays $ d $, payoff is 2 (same as equilibrium). Thus, deviation not profitable.
- $ t_{2} $ : Gets 1 from $ R $ (receiver plays $ u $ ). Deviating to $ L $ : If receiver plays $ u $, payoff is $ 0<1 $; if receiver plays $ d $, payoff is 1 (same as equilibrium). Thus, deviation not profitable.

In separating equilibria, sender types choose different messages.
3. Separating: $ t_{1} $ plays $ L, t_{2} $ plays $ R $ :
- Sender strategy: $ t_{1} $ chooses $ L, t_{2} $ chooses $ R $.
o Receiver strategy:
- Upon observing $ L $, play $ u $.
- Upon observing $ R $, play $ d $.
- Beliefs:
- At $ L $ information set: $ P\\left(t_{1}\\right)=1, P\\left(t_{2}\\right)=0 $ (consistent: only $ t_{1} $ plays $ L $ ).
- At $ R $ information set: $ P\\left(t_{1}\\right)=0, P\\left(t_{2}\\right)=1 $ (consistent: only $ t_{2} $ plays $ R $ ).
o Equilibrium justification:
- Receiver best response:
- At $ L $ (Node_A1): $ u $ gives receiver $ 1, d $ gives 0 ; play $ u $.
- At $ R $ (Node_B2): $ u $ gives receiver $ 0, d $ gives 1 ; play $ d $.
- Sender incentives:
- $ t_{1} $ : Plays $ L $, receiver plays $ u $, payoff is 1 . Deviating to $ R $ : Receiver plays $ d $, payoff is $ 0< $ 1. No incentive.
- $ t_{2} $ : Plays $ R $, receiver plays $ d $, payoff is 1 . Deviating to $ L $ : Receiver plays $ u $, payoff is $ 0< $ 1. No incentive.

4. Separating: $ t_{1} $ plays $ R, t_{2} $ plays $ L $ :
- Sender strategy: $ t_{1} $ chooses $ R, t_{2} $ chooses $ L $.
o Receiver strategy:
- Upon observing $ R $, play $ u $.
- Upon observing $ L $, play $ d $.
o Beliefs:
- At $ R $ information set: $ P\\left(t_{1}\\right)=1, P\\left(t_{2}\\right)=0 $ (consistent: only $ t_{1} $ plays $ R $ ).
- At $ L $ information set: $ P\\left(t_{1}\\right)=0, P\\left(t_{2}\\right)=1 $ (consistent: only $ t_{2} $ plays $ L $ ).
o Equilibrium justification:
- Receiver best response:
- At $ R $ (Node_A2): $ u $ gives receiver $ 2, d $ gives 0; play $ u $.
- At $ L $ (Node_B1): $ u $ gives receiver 0, $ d $ gives 1; play $ d $.
- Sender incentives:
- $ t_{1} $ : Plays $ R $, receiver plays $ u $, payoff is 2 . Deviating to $ L $ : Receiver plays $ d $, payoff is 2 (same). Indifferent, but no strict incentive to deviate.
- $ t_{2} $ : Plays $ L $, receiver plays $ d $, payoff is 1 . Deviating to $ R $ : Receiver plays $ u $, payoff is 1 (same). Indifferent, but no strict incentive to deviate.

Summary of all pure-strategy PBEs:
- Pooling on $ L $ : Both types play $ L $; receiver plays $ d $ on $ L $ and $ d $ on $ R $ with belief $ P\\left(t_{1}\\right) \\leq 1 / 3 $ at $ R $
- Pooling on $ R $ : Both types play $ R $; receiver plays $ u $ on $ R $ and any action on $ L $ with any belief.
- Separating ( $ t_{1}: L, t_{2}: R $ ): Receiver plays $ u $ on $ L, d $ on $ R $.
- Separating ( $ t_{1}: R, t_{2}: L $ ): Receiver plays $ u $ on $ R, d $ on $ L $.

--- 

1. Pooling on $ L $ :
- Sender strategy: Both $ t_{1} $ and $ t_{2} $ send $ L $.
- Receiver beliefs:
- After $ L: P\\left(t_{1}\\right)=0.5, P\\left(t_{2}\\right)=0.5 $ (consistent with pooling).
- After $ R $ (off-equilibrium): $ P\\left(t_{1}\\right) \\leq \\frac{2}{3} $ (arbitrary but must support equilibrium).
- Receiver strategy:
- After $ L $ : Plays $ u $ (expected payoff $ 0.5 \\times 0+0.5 \\times 3=1.5>0.5 \\times 1+0.5 \\times 1=1 $ ).
- After $ R $ : Plays $ u $ (optimal if $ P\\left(t_{1}\\right) \\leq \\frac{2}{3} $ since $ 2\\left(1-P\\left(t_{1}\\right)\\right) \\geq P\\left(t_{1}\\right) $ ).
- Incentive compatibility:
- $ t_{1} $ : Gets 3 (plays $ L $, receiver plays $ u $ ). Deviating to $ R $ : Receiver plays $ u $, payoff 0 (worse).
- $ t_{2} $ : Gets 3 (plays $ L $, receiver plays $ u $ ). Deviating to $ R $ : Receiver plays $ u $, payoff 1 (worse).
- Conclusion: This is a PBE if off-equilibrium belief satisfies $ P\\left(t_{1} \\mid R\\right) \\leq \\frac{2}{3} $.

2. Pooling on $ R $ :
- Sender strategy: Both $ t_{1} $ and $ t_{2} $ send $ R $.
- Receiver beliefs:

。After $ R: P\\left(t_{1}\\right)=0.5, P\\left(t_{2}\\right)=0.5 $ (consistent).
- After $ L $ (off-equilibrium): Any $ P\\left(t_{1}\\right)=q \\in[0,1] $.
- Receiver strategy:
- After $ R $ : Plays $ u $ (expected payoff $ 0.5 \\times 0+0.5 \\times 2=1>0.5 \\times 1+0.5 \\times 0=0.5 $ ).
- After $ L $ : Plays best response to $ q $ :
- If $ q<\\frac{2}{3} $, plays $ u $ (since $ 3(1-q)>1 $ ).
- If $ q>\\frac{2}{3} $, plays $ d $ (since $ 3(1-q)<1 $ ).
- If $ q=\\frac{2}{3} $, indifferent.
- Incentive compatibility fails:
- $ t_{1} $ : In equilibrium, gets 0 (plays $ R $, receiver plays $ u $ ). Deviating to $ L $ :
- If receiver plays $ u $, gets $ 3>0 $.
- If receiver plays $ d $, gets $ 1>0 $.
- Always profitable to deviate.
- Conclusion: No pooling equilibrium on $ R $.

1. Separating: $ t_{1} $ sends $ L, t_{2} $ sends $ R $
- Sender strategy: $ t_{1} \\rightarrow L, t_{2} \\rightarrow R $.
- Receiver beliefs:
- After $ L: P\\left(t_{1}\\right)=1, P\\left(t_{2}\\right)=0 $ (consistent).

。After $ R: P\\left(t_{1}\\right)=0, P\\left(t_{2}\\right)=1 $ (consistent).
- Receiver strategy:
o After $ L $ : Plays $ d $ (payoff $ 1>0 $ for $ u $ at $ A_{1} $ ).
- After $ R $ : Plays $ u $ (payoff $ 2>0 $ for $ d $ at $ B_{2} $ ).
- Incentive compatibility:
- $ t_{1} $ : Gets 1 (plays $ L $, receiver plays $ d $ ). Deviating to $ R $ : Receiver plays $ u $, payoff 0 (worse).
- $ t_{2} $ : Gets 1 (plays $ R $, receiver plays $ u $ ). Deviating to $ L $ : Receiver plays $ d $, payoff 0 (worse).
- Conclusion: This is a PBE.

2. Separating: $ t_{1} $ sends $ R, t_{2} $ sends $ L $
- Sender strategy: $ t_{1} \\rightarrow R, t_{2} \\rightarrow L $.
- Receiver beliefs:
o After $ L: P\\left(t_{1}\\right)=0, P\\left(t_{2}\\right)=1 $ (consistent).
- After $ R: P\\left(t_{1}\\right)=1, P\\left(t_{2}\\right)=0 $ (consistent).
- Receiver strategy:
- After $ L $ : Plays $ u $ (payoff $ 3>1 $ for $ d $ at $ B_{1} $ ).
- After $ R $ : Plays $ d $ (payoff $ 1>0 $ for $ u $ at $ A_{2} $ ).
- Incentive compatibility:
- $ t_{1} $ : Gets 4 (plays $ R $, receiver plays $ d $ ). Deviating to $ L $ : Receiver plays $ u $, payoff 3 (worse).
- $ t_{2} $ : Gets 3 (plays $ L $, receiver plays $ u $ ). Deviating to $ R $ : Receiver plays $ d $, payoff 2 (worse).
- Conclusion: This is a PBE.

Summary of All Pure-Strategy PBEs
1. Pooling on $ L $ :
- Both types send $ L $.
- Receiver plays $ u $ after $ L $ and $ u $ after $ R $.
- Belief after $ R: P\\left(t_{1} \\mid R\\right) \\leq \\frac{2}{3} $.
2. Separating Equilibrium 1:
- $ t_{1} $ sends $ L, t_{2} $ sends $ R $.
- Receiver plays $ d $ after $ L, u $ after $ R $.
- Beliefs: Certainty at each information set.
3. Separating Equilibrium 2:
- $ t_{1} $ sends $ R, t_{2} $ sends $ L $.
- Receiver plays $ u $ after $ L, d $ after $ R $.
- Beliefs: Certainty at each information set.`,__vite_glob_0_48=`---
title: Game Theory - Assignment - Week 2
category: Assignments
---

# 1.2 

## Problem 

> In the following normal-form game, what strategies survive iterated elimination of strictly dominated strategies? What are the pure-strategy Nash equilibria?
>
> $\\begin{array}{c|c|c|c|} & L & C & R \\\\ \\hline T & 2,0 & 1,1 & 4,2 \\\\\\hline M & 3,4 & 1,2 & 2,3 \\\\ \\hline B & 1,3 & 0,2 & 3,0 \\\\ \\hline \\end{array}$

## Solution （1）

$B$ is dominated by $T$:


$\\begin{array}{c|c|c|c|} & L & C & R \\\\ \\hline T & 2,0 & 1,1 & 4,2 \\\\\\hline M & 3,4 & 1,2 & 2,3 \\\\\\hline \\end{array}$

$C$ is dominated by $R$:

$\\begin{array}{c|c|c|} & L & R \\\\ \\hline T & 2,0 & 4,2 \\\\\\hline M & 3,4 & 2,3 \\\\\\hline \\end{array}$

Then we can't eliminate any other strategies

## Solution (2)

$(T,R)$ is a pure-strategy Nash equilibrium:
- Player 1 can't be better off ($M,B$ is $2, 3$ seperatly)
- Player 2 can't be better off ($L,C$ is $0, 1$ seperatly)

$(M,L)$ is a pure-strategy Nash equilibrium:
- Player 1 can't be better off ($M,B$ is $1, 2$ seperatly)
- Player 2 can't be better off ($L,C$ is $2, 3$ seperatly)

# 1.3

> Players 1 and 2 are bargaining over how to split one dollar. Both players simultaneously name shares they would like to have, $ s_{1} $ and $ s_{2} $, where $ 0 \\leq s_{1}, s_{2} \\leq 1 $. If $ s_{1}+s_{2} \\leq 1 $, then the players receive the shares they named; if $ s_{1}+s_{2}>1 $, then both players receive zero. What are the pure-strategy Nash equilibria of this game?

## Solution

For player 1, given $s_2$, he will choose:

$s_1 = 1 - s_2$

to maximize his payoff

Similarly, player 2 will choose:

$s_2 = 1 - s_1$

Both direct us to:

$s_1 + s_2 = 1$

Therefore, any $(s_1, s_2)$ that satisfies this formula is a pure-strategy Nash equilibrium.

Moreover, there's a special case:

$(s_1, s_2) = (1,1)$

In this case:
- when a player want to change to any $s>0$, the sum is over 1 and he receive zero, 
- if he changes to $s=0$, it satisfies $s_1 + s_2 \\le 1$ but he chooses 0 so the payoff is 0, 

Therefore, he can't be better off.



`,__vite_glob_0_49=`---
title: Game Theory - Assignment - Week 1
category: Assignments
---

# 1 Solution 

## (1)

### Answer

$$
\\begin{array}{|l|l|l|l|l|l|l|l|l|}
\\hline 3 & 8 & 5 & 7 & 6 & 4 & 2 & 1 & 9 \\\\
\\hline 7 & 9 & 4 & 5 & 1 & 2 & 6 & 8 & 3 \\\\
\\hline 2 & 1 & 6 & 3 & 9 & 8 & 7 & 5 & 4 \\\\
\\hline 5 & 7 & 3 & 4 & 8 & 9 & 1 & 2 & 6 \\\\
\\hline 9 & 4 & 1 & 2 & 7 & 6 & 5 & 3 & 8 \\\\
\\hline 8 & 6 & 2 & 1 & 5 & 3 & 9 & 4 & 7 \\\\
\\hline 6 & 3 & 8 & 9 & 2 & 5 & 4 & 7 & 1 \\\\
\\hline 1 & 5 & 9 & 8 & 4 & 7 & 3 & 6 & 2 \\\\
\\hline 4 & 2 & 7 & 6 & 3 & 1 & 8 & 9 & 5 \\\\
\\hline
\\end{array}
$$

### Steps

$$
\\begin{array}{|l|l|l|l|l|l|l|l|l|}
\\hline & 8 & 5 & & & & 2 & 1 & \\\\
\\hline & 9 & 4 & & 1 & 2 & & & 3 \\\\
\\hline & & & 3 & & & 7 & & 4 \\\\
\\hline 5 & & 3 & 4 & & 9 & & & \\\\
\\hline & 4 & & 2 & & 6 & & 3 & \\\\
\\hline & & & 1 & & 3 & 9 & & 7 \\\\
\\hline 6 & & 8 & & & 5 & & & \\\\
\\hline 1 & & & 8 & 4 & & 3 & 6 & \\\\
\\hline & 2 & 7 & & & & 8 & 9 & \\\\
\\hline
\\end{array}
$$

We can rule out 3's sequentially in first, seventh, eighth room: 

$$
\\begin{array}{|l|l|l|l|l|l|l|l|l|}
\\hline 3 & 8 & 5 & & & & 2 & 1 & \\\\
\\hline & 9 & 4 & & 1 & 2 & & & 3 \\\\
\\hline & & & 3 & & & 7 & & 4 \\\\
\\hline 5 & & 3 & 4 & & 9 & & & \\\\
\\hline & 4 & & 2 & & 6 & & 3 & \\\\
\\hline & & & 1 & & 3 & 9 & & 7 \\\\
\\hline 6 & 3 & 8 & & & 5 & & & \\\\
\\hline 1 & & & 8 & 4 & & 3 & 6 & \\\\
\\hline & 2 & 7 & & 3 & & 8 & 9 & \\\\
\\hline
\\end{array}
$$

We can rule out the seventh room's numbers:


$$
\\begin{array}{|l|l|l|l|l|l|l|l|l|}
\\hline 3 & 8 & 5 & & & & 2 & 1 & \\\\
\\hline & 9 & 4 & & 1 & 2 & & & 3 \\\\
\\hline & & & 3 & & & 7 & & 4 \\\\
\\hline 5 & & 3 & 4 & & 9 & & & \\\\
\\hline & 4 & & 2 & & 6 & & 3 & \\\\
\\hline & & & 1 & & 3 & 9 & & 7 \\\\
\\hline 6 & 3 & 8 & & & 5 & & & \\\\
\\hline 1 & 5 & 9 & 8 & 4 & & 3 & 6 & \\\\
\\hline 4 & 2 & 7 & & 3 & & 8 & 9 & \\\\
\\hline
\\end{array}
$$

We can sequentially rule out the eighth, ninth room's numbers:

$$
\\begin{array}{|l|l|l|l|l|l|l|l|l|}
\\hline 3 & 8 & 5 & & & & 2 & 1 & \\\\
\\hline & 9 & 4 & & 1 & 2 & & & 3 \\\\
\\hline & & & 3 & & & 7 & & 4 \\\\
\\hline 5 & & 3 & 4 & & 9 & & & \\\\
\\hline & 4 & & 2 & & 6 & & 3 & \\\\
\\hline & & & 1 & & 3 & 9 & & 7 \\\\
\\hline 6 & 3 & 8 & 9 & 2 & 5 & 4 & 7 & 1 \\\\
\\hline 1 & 5 & 9 & 8 & 4 & 7 & 3 & 6 & 2 \\\\
\\hline 4 & 2 & 7 & 6 & 3 & 1 & 8 & 9 & 5 \\\\
\\hline
\\end{array}
$$

We can sequentially rule out the sixth, fifth, fourth room's numbers:

$$
\\begin{array}{|l|l|l|l|l|l|l|l|l|}
\\hline 3 & 8 & 5 & & & & 2 & 1 & \\\\
\\hline & 9 & 4 & & 1 & 2 & & & 3 \\\\
\\hline & & & 3 & & & 7 & & 4 \\\\
\\hline 5 & 7 & 3 & 4 & 8 & 9 & 1 & 2 & 6 \\\\
\\hline 9 & 4 & 1 & 2 & 7 & 6 & 5 & 3 & 8 \\\\
\\hline 8 & 6 & 2 & 1 & 5 & 3 & 9 & 4 & 7 \\\\
\\hline 6 & 3 & 8 & 9 & 2 & 5 & 4 & 7 & 1 \\\\
\\hline 1 & 5 & 9 & 8 & 4 & 7 & 3 & 6 & 2 \\\\
\\hline 4 & 2 & 7 & 6 & 3 & 1 & 8 & 9 & 5 \\\\
\\hline
\\end{array}
$$

We can sequentially rule out the first, second third room's numbers:

$$
\\begin{array}{|l|l|l|l|l|l|l|l|l|}
\\hline 3 & 8 & 5 & 7 & 6 & 4 & 2 & 1 & 9 \\\\
\\hline 7 & 9 & 4 & 5 & 1 & 2 & 6 & 8 & 3 \\\\
\\hline 2 & 1 & 6 & 3 & 9 & 8 & 7 & 5 & 4 \\\\
\\hline 5 & 7 & 3 & 4 & 8 & 9 & 1 & 2 & 6 \\\\
\\hline 9 & 4 & 1 & 2 & 7 & 6 & 5 & 3 & 8 \\\\
\\hline 8 & 6 & 2 & 1 & 5 & 3 & 9 & 4 & 7 \\\\
\\hline 6 & 3 & 8 & 9 & 2 & 5 & 4 & 7 & 1 \\\\
\\hline 1 & 5 & 9 & 8 & 4 & 7 & 3 & 6 & 2 \\\\
\\hline 4 & 2 & 7 & 6 & 3 & 1 & 8 & 9 & 5 \\\\
\\hline
\\end{array}
$$

## (2)

Answer: It's not a game.

Proof: Notice the definition of a "Game": Game is a **multiple-person decison problem**,
- however, sudoku is a single player game, there's no other person.

Moreover: In a game **you best decision depends on what others do**,
- however, your decision depends on the board, not others.

# 2 Solution 

## Solution

May 2

## Steps

We first establish a sheet:

$$
\\begin{array}{|l|l|l|l|l|l|l|}
\\hline & 2 & 5 & 10 & 15 & 28 & 30 \\\\
\\hline Jan & & & ? & ? & & ? \\\\
\\hline Mar & & & ? & & ? & \\\\
\\hline May & ? & & & ? & & \\\\
\\hline Jul & ? & ? & & & & ? \\\\
\\hline
\\end{array}
$$

Xiaoming knows Xiaohong doesn't know either:
- It can't be a Month where there's a day with only one month (e.g. March, with 28 being the day with only one month)
  - Otherwise, Xiaohong will know the month throught the day.

Thus, we eliminate March(Because of March 28) and July (Because of July 5)

Then we get:


$$
\\begin{array}{|l|l|l|l|l|l|l|}
\\hline & 2 & 5 & 10 & 15 & 28 & 30 \\\\
\\hline Jan & & & ? & ? & & ? \\\\
\\hline Mar & & & \\text{x} & & \\text{x} & \\\\
\\hline May & ? & & & ? & & \\\\
\\hline Jul & \\text{x} & \\text{x} & & & & \\text{x} \\\\
\\hline
\\end{array}
$$

Xiaohong now know the day:
- It must be a day with only one month (e.g. 2, with May), otherwise, she won't know it.
Thus, we eliminate 15(It has more than one month)

Then we get:


$$
\\begin{array}{|l|l|l|l|l|l|l|}
\\hline & 2 & 5 & 10 & 15 & 28 & 30 \\\\
\\hline Jan & & & ? & \\text{x} & & ? \\\\
\\hline Mar & & & \\text{x} & & \\text{x} & \\\\
\\hline May & ? & & & \\text{x} & & \\\\
\\hline Jul & \\text{x} & \\text{x} & & & & \\text{x} \\\\
\\hline
\\end{array}
$$

Xiaoming now know the day:
- It must be a month with only one day (the only answer May 2), otherwise, he won't know it.
Thus, we can get the final answer: **May 2**


`,__vite_glob_0_50=`---
title: Game Theory - Paper - Week 1
category: Game Theory Paper
---

# The Bright Side of Supplier Encroachment

# Note 

## Methodology

Backward induction:

- set some variables as given
- solve the optimize problem 
- replace the value back to eliminate the variables

## Intuitions

Why Everyone benefits from encroachment?

- $\\Pi_{M}^{E} - \\Pi_{M}^{N} = \\underbrace{\\frac{3(a-2c)^2}{24b}}_{\\text{Increase in wholesale profit}} + \\underbrace{\\frac{2c^2}{24b}}_{\\text{Supplement from retail profit}} > 0 $
- $CS^{E} - CS^{N} = \\underbrace{\\frac{(9a-2c)(3a-2c)}{288b}}_{\\text{Price reduction and increased choice}} > 0$
- $c \\in \\left(\\underbrace{\\frac{3a}{4\\sqrt{2}}}_{\\text{Lower bound: avoid excessive squeezing of the retailer}}, \\underbrace{\\frac{3a}{5}}_{\\text{Upper bound: ensure manufacturer's retail competitiveness}}\\right)$

---

Balancing Cost Disadvantages

When $c$ is moderate:

- The manufacturer can credibly compete with the retailer without fully displacing it
- The retailer benefits from a lower $w$, offsetting partial sales loss to encroachment.

--- 

Summary:

Supplier encroachment, when strategically executed, transforms a zero-sum game into a Pareto improvement:

- **Manufacturers** gain from optimized wholesale pricing and direct retail profits.

- **Retailers** benefit if wholesale price cuts offset competitive losses.

- **Consumers** enjoy lower prices and expanded choice.

# 2 The basic model 

In vertical supply chain
- manufacturer(supplier) sell wholesale product to retailer 
- retailer sell product to final consumer 
- manufacturer may sell product directly to consumers

Some additional retail competition are examined in 3.4

Consumer demand:

- $P = a-bQ$
  - $a, b > 0$
  - $P$: price
  - $Q$: quantity

manufacturer produce good at constant unit (marginal) cost: $0$

retailer selling cost: $0$

- manufacturer's unit cost of selling to consumer: $c\\in [0,a)$

- manufacturer unit price: $w$

- Linear pricing arrangement

---

Timing:

1. the manufacturer establishes its wholesale price ($w$). 
2. the retailer chooses its profit-maximizing retail output $ q_{R} $. 
3. the manufacturer determines the number of units $ \\left(q_{M}\\right) $ of the homogeneous product it will sell directly to consumers 

Backward induction is employed to identify the equilibrium of the game 

Key properties are presented in 3

# 3 Findings

## 3.1 The No-Encroachment Setting 

Benchmark:
- the manufacturer can only reach consumers through its retailer. 

the retailer chooses its output $ q_{R} $ to maximize its monopoly profit from retail sales, 
- taking the unit wholesale price $ w $ as given. 

---

The retailer's problem is:

#### (1)

$ \\underset{q_{R}}{\\operatorname{Maximize}}\\left[a-b q_{R}\\right] q_{R}-w q_{R} $

We get:

the retailer's output in the no-encroach-ment setting given unit wholesale price:

#### (2)

$ q_{R}^{N}(w)=\\frac{a-w}{2 b} $

Anticipating the retailer's response , the manufacturer chooses $ w $, solving:

#### (3)

$ \\underset{w}{\\operatorname{Maximize}} w q_{R}^{N}(w) \\Leftrightarrow \\underset{w}{\\operatorname{Maximize}} \\frac{w[a-w]}{2 b} $

Then the equilibrium:

#### (4)

$ w^{N}=\\frac{a}{2} \\quad $ and $ \\quad q_{R}^{N}=\\frac{a}{4 b} $

We get profit:

#### (5)

$ \\Pi_{R}^{N}=\\frac{a^{2}}{16 b} \\quad $ and $ \\quad \\Pi_{M}^{N}=\\frac{a^{2}}{8 b} $

Consumer surplus:

#### (6)

$ C S^{N}=\\int_{0}^{q_{R}^{N}} b\\left[q_{R}^{N}-q\\right] d q=\\frac{b}{2}\\left[q_{R}^{N}\\right]^{2}=\\frac{a^{2}}{32 b} $

## 3.2 The Encroachment Setting 

In this setting:

- manufacturer can sell the product directly to consumers 
  - after setting the wholesale price
  - and supplying the wholesale product to the (incumbent) retailer.

---

Given wholesale price $ w $ and retailer supply $ q_{R} $, the manufacturer chooses $ q_{M} $ to:

#### (7)

$ \\underset{q_{M}}{\\operatorname{Maximize}}\\left[a-b q_{R}-b q_{M}\\right] q_{M}-c q_{M}+w q_{R} $

We get:

#### (8)

$ q_{M}^{E}\\left(q_{R}\\right)=\\frac{a-c-b q_{R}}{2 b} $

Given $w$, retailer choose $q_R$:

#### (9)

$ \\underset{q_{R}}{\\operatorname{Maximize}}\\left[a-b q_{R}-b q_{M}^{E}\\left(q_{R}\\right)\\right] q_{R}-w q_{R} $

We get:

#### (10)

$ q_{R}^{E}(w)=\\frac{a+c-2 w}{2 b} $

Substitute [(8)](#8) and [(8)](#10) into [(7)](#7) :

#### (11)

$ w^{E}=\\frac{a}{2}-\\frac{c}{6}, \\quad q_{R}^{E}=\\frac{2 c}{3 b}, \\quad $ and $ \\quad q_{M}^{E}=\\frac{3 a-5 c}{6 b} $

Then we get:

#### (12)

$ \\begin{array}{c}\\Pi_{R}^{E}=\\frac{2 c^{2}}{9 b}, \\quad \\Pi_{M}^{E}=\\frac{3 a^{2}-6 a c+7 c^{2}}{12 b}, \\quad \\text { and } \\\\ C S^{E}=\\frac{b}{2}\\left[q_{R}^{N}+q_{M}^{N}\\right]^{2}=\\frac{[3 a-c]^{2}}{72 b} .\\end{array} $

## 3.3 No Encroachment vs Encroachment 

Proposition 1 confirm that:
- Encroachment benefits manufacturer and consumer 
- manufacturer will encroach $ \\left(q_{M}^{E}>0\\right) $ if and only if its retail cost disadvantage is not too pronounced.

### Proposition 1 

> The manufacturer encroaches if and only if $ c<3 a / 5 $. 
> 
> The manufacturer and consumers both benefit from encroachment in this case: 
> 
> $ \\Pi_{M}^{E}-\\Pi_{M}^{N}= $ $ \\left(3[a-2 c]^{2}+2 c^{2}\\right) /[24 b]>0 $ 
> and $ C S^{E}-C S^{N}=[9 a-2 c] \\times $ $ [3 a-2 c] /[288 b]>0 $.

Key point: encroachment by the manufacturer can alter its preferred wholesale price

Fact: The manufacturer sets a lower wholesale price in the encroachment setting

the retailer may benefit from manufacturer encroachment

### Proposition 2

> Encroachment that increases retailer profit arises if and only if $ c \\in(3 a /[4 \\sqrt{2}], 3 a / 5) $

We get: systematic reduction in the wholesale price secure Pareto gains

- manufacturer reduces the price of the wholesale product in order to increase the retailer's demand for the input and thereby expand the use of the efﬁcient sales channel
- the substantial wholesale price reduction outweighs the direct reduction in demand due to the manufacturer's retail sales, and the retailer beneﬁts from encroachment

---

If the wholesale price is a result of bargaining between the parties

Suppose:

Wholesale price is determined by generalized Nash bargaining,
- the weights $ \\beta \\in(0,1] $ and $ 1-\\beta $ reflect the bargaining strengths of the manufacturer and the retailer, respectively. 

Encroachment that produces Pareto gains will arise in this setting
- if and only if $ c \\in(3 a /[4 \\sqrt{2}], 3 a /[7-2 \\beta]) $. The interval is nonempty whenever the manufacturer's bargaining strength is sufficiently pronounced 
  - (i.e., $ \\beta> $ $ [7-4 \\sqrt{2}] / 2 \\approx 0.67) $. 

Intuitively, substantial manufacturer bargaining strength produces relatively high wholesale prices in the absence of encroachment, which permits the wholesale price reductions that generate Pareto gains under encroachment.

---

Increase in industry profit:

$ \\Pi_{R}^{E}+\\Pi_{M}^{E}-\\left[\\Pi_{R}^{N}+\\Pi_{M}^{N}\\right]=\\frac{9 a^{2}-72 a c+116 c^{2}}{144 b} $

We get Proposition 3:

### Proposition 3

> Encroachment that increases industry profit arises if and only if $ c \\in[0,3 a /[2[6+\\sqrt{7}]]) $ or $ c \\in $ $ (3 a / 2[6-\\sqrt{7}], 3 a / 5) $.

Increase profit when:

- retailer's downstream cost advantage is sufﬁciently pronounced
- or sufficiently limited 

Industry profit can increase by as much as $ 28 \\% $ when the retailer's downstream cost advantage is pronounced $ (c>0.45 a) $
- primary effect of encroachment is to reduce the wholesale price and thereby limit losses from double marginalization. 

Industry profit can increase by as much as $ 33 \\% $ when the retailer's cost advantage is limited $ (c<0.17 a) $,
- encroachment enables the manufacturer to profit from serving retail customers directly and thereby limit losses from double marginalization by using a direct channel.

---

Consider **simultaneous encroachment setting**:

#### (14)

$ w^{E}=\\frac{a}{2}-\\frac{c}{10}, \\quad q_{R}^{E}=\\frac{2 c}{5 b}, \\quad $ and $ \\quad q_{M}^{E}=\\frac{5 a-7 c}{10 b} $

And:

#### (15)

$ \\begin{aligned} \\Pi_{R}^{E}=\\frac{4 c^{2}}{25 b}, \\quad \\Pi_{M}^{E} & =\\frac{5 a^{2}-10 a c+9 c^{2}}{20 b}, \\quad \\text { and } \\\\ C S^{E} & =\\frac{[5 a-3 c]^{2}}{200 b} .\\end{aligned} $

We get:

### Proposition 4

> The retailer, the manufacturer, and consumers all are better off under sequential encroachment than under simultaneous encroachment

## 3.4 The Effect of Additional Retail Competition 

Suppose:

- retailer (denoted $ R $ ) now faces competition from $ n \\geq 0 $ incumbent rivals 
  - (where rival $ i $ is denoted $ R_{i}^{\\prime} $ ). 
- For simplicity, each rival is presumed to be a vertically integrated producer of a substitute good who operates with unit cost $c$. 
- The inverse demand function is: $ P=a-b\\left[q_{R}+\\sum_{i} q_{R_{i}^{\\prime}}+q_{M}\\right] $, 
  - $ q_{R}, q_{R_{i}^{\\prime}} $, and $ q_{M} $ denote the retail output of retailer $ R $, established rival $ R_{i}^{\\prime} $, and the manufacturer, respectively.

Using the method in [3.1](#31-the-no-encroachment-setting), when no encroachment:

#### (16)

$ \\begin{array}{c}w^{N}(n)=\\frac{a+n c}{2[1+n]}, \\quad q_{R}^{N}(n)=\\frac{a+n c}{2 b[2+n]}, \\quad \\text { and } \\\\ q_{R_{i}^{\\prime}}^{N}(n)=\\frac{a[3+2 n]-c[4+3 n]}{2 b\\left[2+3 n+n^{2}\\right]} .\\end{array} $

Using the method in [3.2](#32-the-encroachment-setting), When encroachment:

#### (17)

$ \\begin{array}{c}w^{E}(n)=\\frac{a[3+n]+c\\left[-1+5 n+2 n^{2}\\right]}{2\\left[3+6 n+2 n^{2}\\right]}, \\\\ q_{R}^{E}(n)=\\frac{n a+c\\left[2+3 n+2 n^{2}\\right]}{b\\left[3+6 n+2 n^{2}\\right]}, \\\\ q_{R_{i}^{\\prime}}^{E}(n)=\\frac{a[3+2 n]-c[5+4 n]}{b\\left[3+6 n+2 n^{2}\\right]}, \\quad \\text { and } \\\\ q_{M}^{E}(n)=\\frac{a[3+2 n]-c[5+4 n]}{2 b\\left[3+6 n+2 n^{2}\\right]} .\\end{array} $

When encroachment arise:
- the manufacturer and consumers gain for all $n$

Profit:

#### (18)

$ \\begin{array}{c}\\Pi_{R}^{N}(n)=\\frac{[a+n c]^{2}}{4 b[2+n]^{2}} \\text { and } \\\\ \\Pi_{R}^{E}(n)=\\frac{\\left[n a+c\\left(2+3 n+2 n^{2}\\right)\\right]^{2}}{2 b\\left[3+6 n+2 n^{2}\\right]^{2}}\\end{array} $

### Proposition 5

> For all $n\\ge 0$
>
> (i) Encroachment arises if and only if $ c<[3+2 n] $ a/ [ $ 5+4 n] $, in which case both the manufacturer and consumers benefit from encroachment; and
> 
> (ii) Encroachment that increases retailer profit arises if and only if
>
> $ \\begin{array}{c}c \\in\\left(f(n) a, \\frac{[3+2 n] a}{[5+4 n]}\\right), \\text { where } \\\\ f(n)=\\frac{9+36 n+40 n^{2}+16 n^{3}+2 n^{4}}{7 n+4 n^{2}-4 n^{3}-2 n^{4}+\\sqrt{2}[2+n]^{2}\\left[3+9 n+8 n^{2}+2 n^{3}\\right]} .\\end{array} $
>

#### Corollary

> The range of $ c $ values for which the retailer benefits from encroachment increases as $ n $ increases, i.e., $ [3+2 n] a /[5+4 n]-f(n) a $ is increasing in $ n $

- As $n$ increases, retailer R is weakened by the larger number of retail rivals it faces.

retailer R's demand becomes more sensitive to the established wholesale price as $ n $ increases.
- (Retailer R's demand decreases as $ w $ increases at the rate $ 2[1+n] /[2+n] $, which is an increasing function of n.) 

In response to this increased sensitivity, the manufacturer lowers the input price.

This benefit of encroachment accrues exclusively to retailer $ R $. 

In contrast, the burden of the revenue reduction caused by encroachment is shared by all incumbent retailers.

Consequently, the range of $ c / a $ realizations in which retailer $ R $ gains from encroachment increases as the number of incumbent retailers ( $ n $ ) increases. 

Importantly, the range in which encroachment secures retailer gains in the absence of incumbent retail competition (i.e., when $ n=0 $, as specified in Proposition 2 and as illustrated by the region between the vertical intercepts of the two curves in Figure 1): is smaller than the corresponding range in the presence of incumbent retail competition.

# 4 Extensions

## 4.1 Imperfect Substitutes

- $n=0$

- not perfect substitute 

---

Let the (inverse) demand curve for the retail product of firm $ i $ be $ P_{i}=a-q_{i}-k q_{j} $,
- $ P_{i} $ is the price of firm $ i^{\\prime} $ s product, 
- $ q_{i} $ and $ q_{j} $ are the retail outputs of firms $ i $ and $ j $, respectively (for $ i, j=R, M $ ). 
- The parameter $ k \\in(0,1) $ represents the degree of product substitution. 

The demands for the two retail products become independent as $ k $ approaches 0 . 

The retail products become perfect substitutes (as in [3](#3)) as $ k $ approaches 1 .

We get:

#### (19)

$ \\begin{array}{c}w^{E}(k)=\\frac{a}{2}-\\frac{k^{2}[a(1-k)+c k]}{2\\left[8-5 k^{2}\\right]} \\\\ q_{R}^{E}(k)=\\frac{2[a(1-k)+c k]}{8-5 k^{2}}, \\\\ q_{M}^{E}(k)=\\frac{[a-c]\\left[8-3 k^{2}\\right]-2 a k}{2\\left[8-5 k^{2}\\right]}\\end{array} $

We can see: when the manufacturer encroaches, consumers and the manufacturer both beneﬁt for all values of $k$

Profit:

#### (20)

$ \\begin{aligned} \\Pi_{R}^{E}(k) & =\\left[a-q_{R}^{E}(k)-k q_{M}^{E}(k)\\right] q_{R}^{E}(k)-w q_{R}^{E}(k) \\\\ & =\\frac{\\left[4-2 k^{2}\\right][a(1-k)+c k]^{2}}{\\left[8-5 k^{2}\\right]^{2}} .\\end{aligned} $

Compare [(20)](#20) and [(5)](#5) we get:

### Proposition 6

> With imperfect substitutes:
>
> (i) Encroachment arises if and only if $ c< $ ([8-2k$ \\left.\\left.3 k^{2}\\right] a\\right) /\\left[8-3 k^{2}\\right] $, in which case both the manufacturer and consumers benefit from encroachment; and
> 
> (ii) Encroachment that increases retailer profit arises if and only if:
>
> $ \\begin{array}{c}c \\in\\left(g_{1}(k) a, \\frac{\\left[8-2 k-3 k^{2}\\right] a}{\\left[8-3 k^{2}\\right]}\\right), \\text { where } \\\\ g_{1}(k)=\\frac{128-112 k-64 k^{2}+57 k^{3}}{4\\left[\\left(8-5 k^{2}\\right) \\sqrt{4-2 k^{2}}+8\\left(2-2 k-k^{2}+k^{3}\\right)\\right]}\\end{array} $
>
> 

- manufacturer always encroaches
- does not affect retailer's profit 

Retailer

- benefits from more homogeneity ($k$ increase) for lower wholesale price
- harmed by more intense competition 

## 4.2 Price Competition 

Suppose set price rather than quantities:

#### (21)

$ \\begin{array}{c}\\widetilde{w}^{E}(k)=\\frac{a}{2}-\\frac{k^{2}[a(1-k)+c k]}{2\\left[8-5 k^{2}+k^{4}\\right]}, \\\\ \\tilde{q}_{R}^{E}(k)=\\frac{\\left[2-k^{2}\\right][a(1-k)+c k]}{\\left[1-k^{2}\\right]\\left[8-5 k^{2}+k^{4}\\right]}, \\quad \\text { and } \\\\ \\tilde{q}_{M}^{E}(k)=\\frac{[a-c]\\left[8-7 k^{2}+k^{4}\\right]-a k\\left[6-5 k^{2}+k^{4}\\right]}{2\\left[1-k^{2}\\right]\\left[8-5 k^{2}+k^{4}\\right]}\\end{array} $

The retailer's profit:

#### (22)

$ \\begin{aligned} \\widetilde{\\Pi}_{R}^{E}(k) & =\\left[a-\\tilde{q}_{R}^{E}(k)-k \\tilde{q}_{M}^{E}(k)\\right] \\tilde{q}_{R}^{E}(k)-w \\tilde{q}_{R}^{E}(k) \\\\ & =\\frac{\\left[4-2 k^{2}\\right][a(1-k)+c k]^{2}}{\\left[1-k^{2}\\right]\\left[8-5 k^{2}+k^{4}\\right]^{2}} .\\end{aligned} $

We get:

### Proposition 7

> Under retail price competition:
>
> $ \\begin{aligned} \\widetilde{\\Pi}_{R}^{E}(k) & =\\left[a-\\tilde{q}_{R}^{E}(k)-k \\tilde{q}_{M}^{E}(k)\\right] \\tilde{q}_{R}^{E}(k)-w \\tilde{q}_{R}^{E}(k) \\\\ & =\\frac{\\left[4-2 k^{2}\\right][a(1-k)+c k]^{2}}{\\left[1-k^{2}\\right]\\left[8-5 k^{2}+k^{4}\\right]^{2}} .\\end{aligned} $
>
> (i) Encroachment arises if and only if $ c<[8-6 k- $ $ \\left.7 k^{2}+5 k^{3}+k^{4}-k^{5}\\right] a /\\left[8-7 k^{2}+k^{4}\\right] $, in which case both the manufacturer and consumers benefit from encroachment; and
> 
> (ii) Encroachment that increases retailer profit arises if and only if
> $\\begin{array}{l}c \\in\\left(g_{2}(k) a, \\frac{\\left[8-6 k-7 k^{2}+5 k^{3}+k^{4}-k^{5}\\right] a}{\\left[8-7 k^{2}+k^{4}\\right]}\\right), \\quad \\text { where } \\\\g_{2}(k)=\\frac{128-176 k-64 k^{2}+153 k^{3}-51 k^{5}+11 k^{7}-k^{9}}{4\\left[\\left(8-5 k^{2}+k^{4}\\right) \\sqrt{4-6 k^{2}+2 k^{4}}+8\\left(2-2 k-k^{2}+k^{3}\\right)\\right]} \\end{array}$

## 4.3 Nonlinear Costs 

Suppose manufacturer's cost:

$cq_M+c_2[q_M]^2$

We have:

$ \\begin{aligned} w^{E}\\left(c_{2}\\right)= & \\frac{a}{2}-\\frac{c+a c_{2}}{6+22 c_{2}+16 c_{2}^{2}}, \\quad q_{R}^{E}\\left(c_{2}\\right)=\\frac{2\\left[c+a c_{2}\\right]}{3+8 c_{2}} \\\\ & q_{M}^{E}\\left(c_{2}\\right)=\\frac{3 a\\left[1+2 c_{2}\\right]-c\\left[5+8 c_{2}\\right]}{6+22 c_{2}+16 c_{2}^{2}}\\end{aligned} $


Also, the retailer's profit:

$ \\Pi_{R}^{E}\\left(c_{2}\\right)=\\frac{2\\left[1+2 c_{2}\\right]\\left[c+a c_{2}\\right]^{2}}{\\left[1+c_{2}\\right]\\left[3+8 c_{2}\\right]^{2}} $

Then we have:

### Proposition 8

> In nonlinear costs:
>
> (i) Encroachment arises if and only if $ c<3\\left[1+2 c_{2}\\right] $ a/ [ $ \\left.5+8 c_{2}\\right] $, in which case both the manufacturer and consumers benefit from encroachment; and
>
> (ii) Encroachment that increases retailer profit arises if and only if
> 
> $\\begin{array}{c}c \\in\\left(h\\left(c_{2}\\right) a, \\frac{3\\left[1+2 c_{2}\\right] a}{\\left[5+8 c_{2}\\right]}\\right), \\text { where } \\\\h\\left(c_{2}\\right)=\\frac{9+57 c_{2}+80 c_{2}^{2}}{4\\left[8 c_{2}\\left(1+2 c_{2}\\right)+\\left(3+8 c_{2}\\right) \\sqrt{2+6 c_{2}+4 c_{2}^{2}}\\right]} \\end{array}$

`,__vite_glob_0_51=`---
title: Game Theory - Paper - Week 2
category: Game Theory Paper
---

# Supplier Encroachment with Multiple Retailers

# Intuitions

## Proposition 1

1. Wholesale price independence from $ n $ : The supplier sets $ w=a / 2 $, balancing profit margin and retailer participation. Retailers' Cournot competition ensures their total output adjusts to $ n $, but the supplier's optimal markup remains fixed as it depends only on market potential $ a $.

2. Retailer quantities vs. total output: More retailers dilute individual orders ( $ q_{r_{i}} \\downarrow $ ) but intensify competition, increasing total output ( $ \\sum q_{r_{j}} \\uparrow $ ).

3. Profit dynamics: Supplier benefits from more retailers (no double marginalization), while retailers suffer from competition. Total supply chain profit rises due to reduced deadweight loss.

**Counterintuitive Aspect**:

- The wholesale price $ w^{n}=a / 2 $ being independent of $ n $ seems odd-intuitively, more retailers might incentivize the supplier to lower $ w $ to encourage ordering. However, in Cournot competition, retailers' aggregate output $ \\sum q_{r_{j}}=\\frac{n(a-w)}{n+1} $ increases with $ n $, so the supplier maximizes profit at $ w=a / 2 $ regardless of $ n $.

## Proposition 2

Supplier encroachment depends on its direct-selling cost $ c $.
- Low $ c \\leq \\underline{c} $ : Encroachment occurs-direct selling is efficient enough.
- Intermediate $ \\underline{c}<c \\leq \\bar{c} $ : Threat of encroachment disciplines retailers to limit orders, avoiding actual encroachment.
- High $ c>\\bar{c} $ : Encroachment is too costly; equilibrium mirrors no-encroachment.

**Counterintuitive Aspect**:

The threat of encroachment (without actual encroachment) can discipline retailers. Retailers selfregulate orders to $ q_{r_{i}}=\\frac{a-c}{n} $, preventing supplier entry. This strategic deterrence is a non-obvious equilibrium outcome.

## Corollary 1

1. Thresholds $ \\underline{c}, \\bar{c} \\downarrow n $ : More retailers reduce the supplier's incentive to encroach (higher competition dilutes direct-selling gains). 

2. Wholesale price $ w^{e n} \\downarrow n $ under EO: With encroachment, more retailers force the supplier to lower $ w $ to retain their participation. 

3. Constant total output under TE: Retailers collectively maintain $ \\sum q_{r_{j}}=a-c $ to deter encroachment, regardless of $ n $. 


**Counterintuitive Aspect**: 

- Total retailer output $ \\sum q_{r_{j}}=a-c $ under TE is invariant to $ n $. Despite more retailers, each reduces individual orders to keep total output fixed, strategically avoiding supplier entry.

## Proposition 3

- $ n>4 $ : Retailers are always harmed by encroachment. More retailers amplify competition, leaving no room for wholesale price concessions. 

- $ n \\leq 4 $ : Retailers may benefit if $ c \\in\\left[\\underline{c}_{r}, \\bar{c}_{r}\\right] $. Supplier's moderate $ c $ allows a lower $ w $ (to enable encroachment), which offsets competition losses. 

**Counterintuitive Aspect**: 

Small $ n $ allows retailers to gain from encroachment. The supplier's need to balance encroachment profits with wholesale revenue can lead to a lower $ w $, paradoxically boosting retailer profits.

## Proposition 4

- $ n<3 $ : Supplier always benefits from encroachment-direct selling adds a high-margin channel. 

- $ n \\geq 3 $ : Encroachment can harm the supplier if $ c \\in\\left[\\underline{c}_{s}, \\bar{c}_{s}\\right] $. Moderate $ c $ forces the supplier into a suboptimal trade-off: encroachment cannibalizes wholesale revenue more than it adds profit. 
 
**Counterintuitive Aspect**:
 
Encroachment option can reduce supplier profit. When $ c $ is moderate, the threat of encroachment forces the supplier to lower $ w $, but retailers' disciplined orders are insufficient to offset lost wholesale revenue.

## Proposition 5

Supplier prefers encroachment for very low or high $ c $, but enrolls new retailers for intermediate $ c $. 

- Low $ c $ : Direct selling dominates (low cost). 

- High $ c $ : Indirect channel expansion avoids costly encroachment. 

- Mid $ c $ : Enrolling retailers balances competition and scale.

**Counterintuitive Aspect**: 

Supplier may prefer encroachment even at higher $ c $. For $ c $ near thresholds, channel substitutability and economies of scale tilt the balance toward direct selling.

## Proposition 6

With imperfect substitution $ (\\theta<1) $ :

- Retailers benefit from encroachment only if $ n $ is small and $ \\theta $ is low (weak competition).

- Supplier harm from encroachment persists for $ n \\geq 3 $, but thresholds shrink as $ \\theta \\uparrow $.

**Counterintuitive Aspect**:

Lower $ \\theta $ (weaker substitution) expands the range where retailers benefit. Reduced cannibalization allows coexistence of direct/indirect channels, creating win-win scenarios.

## Proposition 7

With fixed cost $ f $ to add retailers:

- Low $ c \\leq \\underline{c}_{f} $ : Encroachment dominates.

- Intermediate $ c \\in\\left(\\underline{c}_{f}, \\bar{c}_{f}\\right) $ : Supplier balances enrolling retailers and deterring encroachment.

- High $ c \\geq \\bar{c}_{f} $ : No encroachment; enrolls retailers up to $ n^{e n f} $.


**Counterintuitive Aspect**:

Fixed costs create non-monotonic strategies. For moderate $ c $, enrolling more retailers (despite $ f $ ) is better than encroachment, but only up to a threshold.

## Proposition 8

Under sequential retailer decisions:

1. First-mover advantage: Retailer $ r_{1} $ may benefit from encroachment if $ n \\leq 6 $, leveraging early commitment.

2. Later retailers always lose: Followers face entrenched competition.

3. Supplier harm: For $ n \\geq 2 $, sequentiality amplifies profit loss from encroachment due to strategic retailer adjustments.



**Counterintuitive Aspect**:

Sequentiality creates asymmetry: early retailers can exploit encroachment to gain, while later ones lose. Supplier's profit loss arises from retailers' preemptive order reductions.

## Key unifying insight

**Strategic Deterrence vs. Cannibalization**:

Encroachment creates a tension-its threat disciplines retailers (raising total output), but its execution risks cannibalizing wholesale revenue. The equilibrium hinges on whether supplier gains from direct selling outweigh lost wholesale profits. Small $ n $ and moderate $ c $ often lead to lose-lose outcomes, revealing the fragility of encroachment as a strategy.




# 3 Model Setting 

$s$: Supplier 

$r_i, i = 1, 2, \\cdots, n$: Retailers 

$n$: number of retailers 

$w$: wholesale price 

$p=a-Q$: inverse demand function 
- $a>0$: market potential 
- $Q$: total quantity in market 
- $p$: market clearing price 

For $Q$:

- $Q = \\sum_{i=1}^nq_{r_i}$: Only retailer 
  - $q_{r_i} $: $r_i $ retailer's quantity 
- $Q = \\sum_{i=1}^nq_{r_i} + q_s$: Encroachment
  - $q_s$: selling quantity 

$c$: supplier unit selling cost 
- $c\\in(0,a)$

$0$: retailer's unit selling cost 

---

Decision sequence:

1. Supplier decide $w$
2. retailers determine $q_{r_i}$ simultaneously 
3. supplier decide $q_s$

# Analysis 

## No Supplier Encroachment 

Profit function:

$ \\pi_{s}=w \\sum_{j=1}^{n} q_{r_{j}} $ 
$ \\pi_{r_{i}}=\\left(a-\\sum_{j=1}^{n} q_{r_{j}}^{n}-w\\right) q_{r_{i}}^{n} $

$r_i $'s order given $w$:

$ q_{r_{i}}(w)=\\dfrac{a-w}{(n+1)}, i=1,2, \\cdots, n $

Then $w$:

$w^n = \\dfrac{a}{2}$

Then:

$ q_{r_{i}}^{n}=\\dfrac{a}{2(n+1)}, \\pi_{r_{i}}^{n}=\\dfrac{a^{2}}{4(n+1)^{2}} $ and $ \\pi_{s}^{n}=\\dfrac{n a^{2}}{4(n+1)} $

Then:

### Proposition 1

> When the supplier cannot encroach into the retail market, in equilibrium,
>
> 1. the optimal wholesale price $ w^{n} $ is independent of $ n $, the number of downstream retailers;
> 
> 2. each retailer's order quantity $ q_{r_{i}}^{n} $. $ i=1,2, \\cdots, n $, decreases in $ n $ while the total demand of all retailers $ \\sum_{j=1}^{n} q_{r_{j}}^{n} $ increases in $ n $;
> 
> 3. the supplier's profit $ \\pi_{s}^{n} $ increases in $ n $ while that of a retailer $ \\pi_{r_{i}}^{n} $ decreases in $ n $. The total supply chain profit $ \\pi_{c}^{n}=\\pi_{s}^{n}+\\sum_{j=1}^{n} \\pi_{r_{j}}^{n} $ increases in $ n $.

## 4.2 Potential Supplier Encroachment 

Now:

#### (1)

$ \\pi_{s}=w \\sum_{j=1}^{n} q_{r_{j}}+\\left(a-\\sum_{j=1}^{n} q_{r_{j}}-q_{s}-c\\right) q_{s} $

Then:

#### (2)

$ q_{s}\\left(q_{r_{i}}\\right)=\\left(\\frac{a-\\sum_{j=1}^{n} q_{r_{j}}-c}{2}\\right)^{+} $

Then:

$ \\pi_{r_{i}}=\\left(a-\\sum_{j=1}^{n} q_{r_{j}}-q_{s}\\left(q_{r_{i}}\\right)-w\\right) q_{r_{i}} $

Then:

#### (3)

$ \\left(q_{r_{i}}(w), q_{s}(w)\\right)=\\left\\{\\begin{array}{ll}\\left(\\frac{a+c-2 w}{(n+1)}, \\frac{a-(2 n+1) c+2 n w}{2(n+1)}\\right) & \\text { if } w>\\frac{(2 n+1) c-a}{2 n} ; \\\\ \\left(\\frac{a-c}{n}, 0\\right) & \\text { if } \\frac{(n+1) c-a}{n}<w \\leq \\frac{(2 n+1) c-a}{2 n} ; \\\\ \\left(\\frac{a-w}{(n+1)}, 0\\right) & \\text { if } w \\leq \\frac{(n+1) c-a}{n} .\\end{array}\\right. $

Then we get:

$ \\pi_{s}(w)=\\left\\{\\begin{array}{ll}n w \\frac{a+c-2 w}{(n+1)}+\\left(\\frac{a-(2 n+1) c+2 n w}{2(n+1)}\\right)^{2}, & \\text { if } w>\\frac{(2 n+1) c-a}{2 n} ; \\\\ w(a-c), & \\text { if } \\frac{(n+1) c-a}{n}<w \\leq \\frac{(2 n+1) c-a}{2 n} \\\\ n w \\frac{a-w}{(n+1)}, & \\text { if } w \\leq \\frac{(n+1) c-a}{n} .\\end{array}\\right. $

Following Proposition:

### Proposition 2

> When the supplier has the option to encroach into the retail market, the supplier encroaches only when his unit direct-selling $ \\cos t c \\leq \\underline{c} $ and never encroaches when $ c>\\bar{c} $, where:
>
> $ \\bar{c}=\\frac{2(n+1)^{2}+n \\sqrt{2(n+1)}}{2(n+1)(2 n+1)} a $ and $ \\underline{c}=\\frac{n+2}{2+3 n} a $

### Table 1 Equilibrium Wholesale Price, Quantities and Profits: Potential Encroachment
$$
\\begin{array}{lcccc}
\\hline 
 & \\text{Encroachment occurrence (EO)} & \\text{Threat of encroachment (TE)} & \\text{No encroachment (NE)} \\\\
\\hline 
& \\boldsymbol{c} \\leq \\boldsymbol{\\underline{c}} & \\underline{\\boldsymbol{c}} < \\boldsymbol{c} \\leq \\overline{\\boldsymbol{c}} & \\boldsymbol{c} > \\overline{\\boldsymbol{c}} \\\\
\\hline 
\\boldsymbol{W}^{en} & \\dfrac{(n+2) a - n c}{2(n+2)} & \\dfrac{(2n+1) c - a}{2n} & \\dfrac{a}{2} \\\\
q_{r_{i}}^{en} & \\dfrac{2c}{(n+2)} & \\dfrac{a - c}{n} & \\dfrac{a}{2(n+1)} \\\\
q_{s}^{en} & \\dfrac{(n+2) a - (2 + 3n) c}{2(n+2)} & 0 & 0 \\\\
\\pi_{r_{j}}^{en} & \\dfrac{2c^{2}}{(n+2)^{2}} & \\dfrac{(a - c)^{2}}{2n^{2}} & \\dfrac{a^{2}}{4(n+1)^{2}} \\\\
\\pi_{s}^{en} & \\dfrac{n c((n+2) a - n c)}{(n+2)^{2}} + \\dfrac{((n+2) a - (2 + 3n) c)^{2}}{4(n+2)^{2}} & \\dfrac{((2n+1) c - a)(a - c)}{2n} & \\dfrac{n a^{2}}{4(n+1)} \\\\
\\hline
\\end{array}
$$

![Figure 1 (a)](image-1.png)

![Figure 1 (b)](image-2.png)

### Corollary 1

> When the supplier has the option to encroach into the retail market, in equilibrium
> 
> 1. the two direct-selling cost thresholds $ \\underline{c} $ and $ \\bar{c} $ both decrease in $ n $;
> 
> 2. the optimal wholesale price $ w^{e n} $ decreases in $ n $ under encroachment occurrence while increases in $ n $ under the threat of encroachment.
> 
> 3. Each retailer's order quantity $ q_{r_{i}}^{e n} $ decreases in $ n $. Nonetheless, the total order quantity $ \\Sigma_{j=1}^{n} \\eta_{r_{j}}^{e n} $ remains constant (i.e., $ \\Sigma_{j=1}^{n} q_{r_{j}}^{e n}=a-c $ ) under the threat of encroachment, and increases in $ n $ under encroachment occurrence.

![Figure 2 (a)](image-3.png)

![Figure 2 (b)](image-4.png)

## 4.3 Impact of Supplier Encroachment

### Proposition 3

> When the supplier can encroach into the retail market, in equilibrium
>
> 1. if the number of retailers $ n>4 $, a retailer is always worse off with supplier encroachment. 
> 
> 2. if $ n \\leq 4 $, a retailer can benefit from supplier encroachment when the direct-selling cost $ c \\in\\left[\\underline{c}_{r}, \\bar{c}_{r}\\right] $, where $ \\underline{c}_{r}=\\frac{\\sqrt{2}(n+2) a}{4(n+1)} $ and $ \\bar{c}_{r}=\\frac{2(n+1)-\\sqrt{2} n}{2(n+1)} a $.

![Figure 3 (a)](image-5.png)

![Figure 3 (b)](image-6.png)

### Proposition 4

> When the supplier can encroach into the retail market, in equilibrium
>
> 1. if the number of retailers $ n<3 $, the supplier always benefits from having the option to encroach into the retail market. 
> 
> 2. if $ n \\geq 3 $, the supplier becomes worse off when being endowed with the option of encroachment if his direct-selling cost $ \\mathcal{C}_{s} \\leq c \\leq \\bar{c}_{s} $, where $ \\underline{c}_{s}=\\frac{(n+1)(n+2)-\\sqrt{n(n+1)(n-2)(n+2)}}{5 n^{2}+7 n+2} a $ and $ \\bar{c}_{s}=\\min $ $ \\left\\{\\frac{(n+1)(n+2)+\\sqrt{n(n+1)(n-2)(n+2)}}{5 n^{2}+7 n+2} a, \\frac{2(n+1)^{2}-n \\sqrt{2(n+1)}}{2(n+1)(2 n+1)} a\\right\\} $.

![Figure 4 (a)](image-7.png)

![Figure 4 (b)](image-8.png)

# Discussion 

## 5.1 Market Penetration via Channel Expansion

### Proposition 5

> When there are $ n $ incumbent retailers in his indirect distribution channel, the supplier should encroach into the retail market and direct sell when his direct-selling cost
>
> $\\begin{array}{c} c \\in\\left[0, \\frac{n+2-\\sqrt{n^{2}-n+2}}{5 n+2} a\\right] \\cup\\left[\\frac{2(n+1)(n+2)-\\sqrt{2 n(n-1)(n+2)}}{2(2 n+1)(n+2)} a,\\right. \\\\ \\left.\\frac{2(n+1)(n+2)+\\sqrt{2 n(n-1)(n+2)}}{2(2 n+1)(n+2)} a\\right] . \\end{array} $
>
> Otherwise, the supplier should enroll a new retailer into his indirect channel.

![Figure 5 (a)](image-9.png)

![Figure 5 (b)](image-10.png)

![Figure 6](image-11.png)

## 5.2 Imperfect Product Substitution

Then:

$ p_{r_{i}}=a-\\sum_{j=1}^{n} q_{r_{j}}-\\theta q_{s^{\\prime}}, i=1,2, \\cdots, n $ and $ p_{s}=a-q_{s}-\\theta \\sum_{j=1}^{n} q_{r_{j}} $

- $ 0<\\theta \\leq 1 $

$ \\begin{array}{l}\\pi_{s}=w \\sum_{j=1}^{n} q_{r_{j}}+\\left(a-\\theta \\sum_{j=1}^{n} q_{r_{j}}-q_{s}-c\\right) q_{s^{\\prime}} \\\\ \\pi_{r_{i}}=\\left(a-\\sum_{j=1}^{n} q_{r_{j}}-\\theta q_{s}-w\\right) q_{r_{i}}, i=1,2, \\cdots, n\\end{array} $

### Proposition 6

> When the channels are imperfect substitutes, the equilibrium wholesale price, quantities and profits are as shown in Table 2. Moreover,
>
> 1. if $ n \\leq\\left[\\frac{2\\left(2-\\theta^{2}\\right)+2 \\sqrt{2\\left(2-\\theta^{2}\\right)}}{\\theta^{2}}\\right] $, the retailer can benefit from supplier encroachment when $ c \\in\\left[\\underline{c}_{r-\\theta}, \\bar{c}_{r-\\theta}\\right] $, where $\\begin{array}{l}\\text { where } \\quad \\bar{c}_{r-\\theta}=\\frac{\\sqrt{2\\left(2-\\theta^{2}\\right)}(n+1)-n \\theta}{\\sqrt{2\\left(2-\\theta^{2}\\right)}(n+1)} a \\\\\\underline{c}_{r-\\theta}=\\frac{4(n+1)-(3 n+2) \\theta^{2}-2(1-\\theta) \\sqrt{2\\left(2-\\theta^{2}\\right)(n+1)}}{2 \\theta \\sqrt{2\\left(2-\\theta^{2}\\right)}(n+1)} a\\end{array}$
>
> 2. if $ n \\geq 3 $, the supplier becomes worse off when being endowed with the option of encroachment when $ c \\in\\left[\\underline{c}_{s-\\theta}, \\overline{\\mathcal{C}}_{s-\\theta}\\right] $, where 
> 
> $ \\underline{\\mathcal{C}}_{s-\\theta}=\\frac{4 n^{2} \\theta^{2}-8 n^{2} \\theta+4 n^{2}+n \\theta^{2}-8 n \\theta+8 n-2 \\theta^{2}+4}{(2-\\theta)^{2} n^{2}+\\left(8-4 \\theta-\\theta^{2}\\right) n+4-2 \\theta^{2}+\\theta \\sqrt{n\\left(-n^{2}+n+2\\right)\\left(2 \\theta^{2}-4 n+3 n \\theta^{2}-4\\right)}} a $, and 
> 
> $ \\bar{c}_{s-\\theta}=\\min \\left(\\frac{\\left((4-2 \\theta) n+4-2 \\theta^{2}\\right)(n+1)-\\theta^{2} n \\sqrt{2(n+1)}}{4 n^{2}-2 n \\theta^{2}+8 n-2 \\theta^{2}+4} a\\right. $, $ \\left.\\frac{4 n^{2} \\theta^{2}-8 n^{2} \\theta+4 n^{2}+n \\theta^{2}-8 n \\theta+8 n-2 \\theta^{2}+4}{(2-\\theta)^{2} n^{2}+\\left(8-4 \\theta-\\theta^{2}\\right) n+4-2 \\theta^{2}-\\theta \\sqrt{n\\left(-n^{2}+n+2\\right)\\left(2 \\theta^{2}-4 n+3 n \\theta^{2}-4\\right)}} a\\right) $. where 
> 
> $ \\bar{c}_{\\theta}=\\frac{\\left((4-2 \\theta) n+4-2 \\theta^{2}\\right)(n+1)+\\theta^{2} n \\sqrt{2(n+1)}}{\\left(4 n+4-2 \\theta^{2}\\right)(n+1)} a $ and $ \\mathcal{c}_{\\theta}=\\frac{4-2 \\theta^{2}+\\left(4-2 \\theta-\\theta^{2}\\right) n}{4-2 \\theta^{2}+\\left(4-\\theta^{2}\\right) n} a $.

### Corollary 2

> When the direct and indirect channels are imperfect substitutes, the thresholds stated in Proposition $ 6, \\bar{c}_{r-\\theta}, \\underline{c}_{r-\\theta}, \\bar{c}_{s-\\theta}, \\underline{c}_{s-\\theta} $ all decrease in $ \\theta $


$\\begin{array}{|c|c|c|c|}
\\hline 
 & \\text{Encroachment occurrence} 
\\boldsymbol{C} < \\underline{\\boldsymbol{C}}_{g}
& \\text{Threat of encroachment} 
\\underline{\\boldsymbol{c}}_{\\theta} < \\boldsymbol{c} \\leq \\overline{\\boldsymbol{c}}_{\\theta}& \\text{No encroachment} 
c \\geq \\overline{\\boldsymbol{c}}_{\\theta}\\\\
\\hline 
W^{\\text{en}} & \\dfrac{\\left(4 - 2 \\theta^{2} + n \\theta^{5} + 4 n\\left(1 - \\theta^{2}\\right)\\right) a - n \\theta^{3} c}{8(1 + n) - 2(3 n + 2) \\theta^{2}} & \\dfrac{\\left(2 \\pi + 2 - \\theta^{2}\\right) c - \\left(2 \\pi(1 - \\theta) + \\left(2 - \\theta^{2}\\right)\\right) a}{2 \\pi \\theta} & \\dfrac{a}{2} \\\\
\\hline 
q_{r_{i}}^{en} & \\dfrac{2(1 - \\theta) a + 2 c \\theta}{4(1 + n) - (3 n + 2) \\theta^{2}} & \\dfrac{a - C}{n G} & \\dfrac{a}{2(n + 1)} \\\\
\\hline 
q_{s}^{\\text{en}} & \\dfrac{\\left(4 - 2 \\theta^{2} + \\left(4 - 2 \\theta - \\theta^{2}\\right) n\\right) a - \\left(4 - 2 \\theta^{2} + \\left(4 - \\theta^{2}\\right) \\pi\\right) c}{8(1 + \\pi) - 2(3 n + 2) \\theta^{2}} & 0 & 0 \\\\
\\hline 
\\pi_{r_{j}}^{en} & \\dfrac{2\\left(2 - \\theta^{2}\\right)(a(1 - \\theta) + c \\theta)^{2}}{\\left(4(n + 1) - (3 n + 2) b^{2}\\right)^{2}} & \\dfrac{\\left(2 - \\xi^{2}\\right)(\\bar{a} - c)^{2}}{2 \\pi^{2} \\theta^{2}} & \\dfrac{a^{2}}{4(n + 1)^{2}} \\\\
\\hline 
\\pi_{s}^{en} & \\dfrac{\\left(4 - 2 \\theta^{2} + m \\theta^{2}\\right)(a - c)^{2} + 8 n(1 - \\theta)(a - c) a + 4 n c^{2}}{16(n + 1) - 4(3 n + 2) \\theta^{2}} & \\dfrac{\\left(\\left(2 \\pi + 2 - \\theta^{2}\\right) c - \\left(2 n(1 - \\theta) + 2 - \\theta^{2}\\right) a\\right)(a - c)}{2 \\pi \\theta^{2}} & \\dfrac{n a^{2}}{4(n + 1)} \\\\
\\hline
\\end{array}$


## 5.3 Costly Channel Expansion 

$f$: fixed cost to enroll a retailer 

![Figure 7 (a)](image-12.png)

![Figure 7 (b)](image-13.png)

### Proposition 7

> When the supplier can proactively choose the number of retailers to enroll into his indirect channel, the equilibrium encroachment strategy, the optimal number of enrolled retailers and equilibrium profits are presented in Table 3, where $ n^{\\text {enf }} $ is a real number, $ n^{e n f *} $ is an integer, 
> 
> $\\bar{c}_{f}=\\frac{a+\\sqrt{2 f}+\\sqrt{2(2-\\sqrt{2}) a \\sqrt{f}-2 f}}{2} \\text { and }_{c_{f}}=\\frac{2 \\sqrt{2 f}+a}{3} $


$
\\begin{array}{|c|c|c|c|}
\\hline 
 & \\text{Encroachment occurrence} 
\\text{(EO) } c \\leq \\underline{c}_{f} & \\text{Threat of encroachment} 
\\text{(TE) } \\underline{\\boldsymbol{c}}_{f} < \\boldsymbol{c} \\leq \\overline{\\boldsymbol{c}}_{f} & \\text{No encroachment (NE)} 
\\boldsymbol{c} > \\overline{\\boldsymbol{c}}_{f} \\\\
\\hline 
n^{\\text{ent}} & c \\sqrt{\\dfrac{2}{7}} - 2 & \\dfrac{a - c}{\\sqrt{2 f}} & \\dfrac{a}{2 \\sqrt{f}} - 1 \\\\
\\hline 
n^{\\text{enf*}} &  \\arg \\max _{n \\in\\left\\{\\left\\lfloor n^{e n t}\\right\\rfloor,\\left\\lfloor n^{e n t}\\right\\rfloor+1,\\left\\lfloor n^{n t}\\right\\rfloor,\\left\\lfloor n^{n t}\\right\\rfloor+1\\right\\}} \\pi_{s}^{e n f}(n)  & & \\\\
\\hline 
\\pi_{r_{j}}^{\\text{enf}}\\left(n^{\\text{enf}}\\right) & f & f & f \\\\
\\hline 
\\pi_{s}^{\\text{enf}}\\left(n^{\\text{anf}}\\right) & (c - \\sqrt{2 f})^{2} + \\dfrac{(a - c)^{2}}{4} & (c - \\sqrt{2 f})(a - c) & \\dfrac{(a - 2 \\sqrt{f})^{2}}{4} \\\\
\\hline
\\end{array}
$

### Proposition 8

> When retailers make their ordering decisions sequentially
>
> 1. if $ n \\leq 6 $, retailer $ r_{1} $ can benefit from supplier encroachment when $ c \\in\\left[\\underline{c}_{r-S}, \\bar{c}_{r-S}\\right] $, where 
> 
> $\\begin{array}{l} \\underline{c}_{r-S}=\\min \\left\\{\\frac{2^{n}+1}{2^{n+3 / 2}} a, \\underline{c}_{S}\\right\\}, \\\\ \\bar{c}_{r-S}=\\left(1-\\frac{2^{2 n}-2^{n+1}+2}{\\sqrt{2^{n+2}\\left(2^{3 n-1}+2^{2 n}-2-2^{n} \\sqrt{2^{n-1}\\left(2^{n}-2\\right)}\\right)}}\\right) a \\text { and } \\\\ \\underline{c}_{S}=\\left(2^{n}+1\\right)\\left(3 \\times 2^{2 n}-2^{n+1}+2-\\sqrt{2^{n+3}\\left(2^{n}-2\\right)}\\right. \\\\ \\frac{\\left.\\left.-2 \\sqrt{2} \\sqrt{\\left(2^{n}+1\\right)^{-1}\\left(2^{2 n}-2^{n+1}+2\\right)\\left(2^{n}-1\\right) \\sqrt{2^{n+1}\\left(2^{n}-2\\right)}-2^{n}\\left(2^{n}-2\\right)}\\right)\\right)}{9 \\times 2^{3 n}-13 \\times 2^{2^{n}}+2^{n+4}-2-\\left(2^{n+1}+2\\right) \\sqrt{2^{n+1}\\left(2^{n}-2\\right) a}} \\end{array}$
> 
> 2. Retailer $ r_{i}, i=2,3, \\cdots, n $, is always worse off with supplier encroachment. 
> 
> 3. if $ n \\geq 2 $, the supplier becomes worse off when being endowed with the option to encroach if $ c \\in\\left[\\underline{c}_{s-S}, \\bar{c}_{s-S}\\right] $, where $ \\underline{c}_{s-S}= $ $ \\frac{2^{n}\\left(2^{n}+1\\right)-\\sqrt{2^{n}\\left(2^{n}-1\\right)\\left(2^{n}-3\\right)\\left(2^{n}+1\\right)}}{5 \\times 2^{2 n}-3 \\times 2^{n}} a \\quad $ and $ \\quad \\bar{c}_{s-S}= $ $ \\frac{2^{3 n}-2^{n} \\sqrt{2^{n+1}\\left(2^{n}-2\\right)}-\\sqrt{2^{n}\\left(2^{2 n-1}-2^{n}+1\\right)\\left(\\left(2^{n}-1\\right) \\sqrt{2^{n+1}\\left(2^{n}-2\\right)}+2\\right)}}{2^{n}\\left(2^{2 n+1}-2^{n+1}+2-\\sqrt{2^{n+1}\\left(2^{n}-2\\right)}\\right)} a $.

![Figure 8](image-14.png)






`,__vite_glob_0_52=`---
title: Game Theory - Assignment - Paper
category: Assignments
---

# The Dollar Auction Game: A Game-Theoretic Analysis of Escalation and Commitment

## Abstract

This paper examines the dollar auction game, a paradigmatic example in game theory that demonstrates the phenomenon of escalation of commitment and rational irrationality. In this auction format, the highest bidder wins the prize but the second-highest bidder must also pay their bid without receiving anything in return. We develop a comprehensive theoretical framework to analyze the strategic interactions, equilibrium properties, and behavioral implications of this seemingly simple yet profoundly complex game. Our analysis reveals fundamental insights into competitive dynamics, sunk cost fallacies, and the paradoxical nature of rational decision-making in strategic environments.

**Keywords:** Game theory, Auction theory, Escalation of commitment, Nash equilibrium, Behavioral economics

## 1. Introduction

The dollar auction game, first introduced by economist Martin Shubik in 1971, represents one of the most compelling paradoxes in game theory and behavioral economics. At its core, the game appears deceptively simple: an auctioneer offers to sell a dollar bill to the highest bidder, with the standard auction rule that the winner pays their bid and receives the prize. However, the game introduces a crucial twist—the second-highest bidder must also pay their bid but receives nothing in return.

This seemingly minor modification transforms a straightforward auction into a complex strategic environment that can lead to escalating commitments far exceeding the value of the prize itself. The dollar auction has been used to model various real-world scenarios, from military conflicts and corporate takeovers to political campaigns and research and development competitions.

The significance of the dollar auction extends beyond its theoretical elegance. It serves as a powerful metaphor for situations where rational actors can find themselves trapped in escalating commitments, where the fear of losing their investment drives continued participation despite diminishing returns. This phenomenon, known as escalation of commitment or the "winner's curse," has profound implications for understanding decision-making in competitive environments.

## 2. Literature Review and Theoretical Background

### 2.1 Historical Development

The dollar auction game emerged from Shubik's broader work on game theory and social psychology. The original formulation was designed to demonstrate how rational individuals could be led into seemingly irrational behavior through the structure of incentives. Shubik's insight was that the combination of competitive bidding and the penalty for coming in second could create a "rationality trap" where players continue bidding beyond the point of economic sensibility.

Subsequent research has expanded on Shubik's original framework. O'Neill (1986) provided one of the first rigorous game-theoretic analyses, demonstrating that the game has no pure strategy Nash equilibrium when players have unlimited resources. Leininger (1989) further developed the theoretical foundations, showing that mixed strategy equilibria exist but are highly unstable.

### 2.2 Related Literature

The dollar auction belongs to a broader class of games studied in auction theory and mechanism design. It shares characteristics with war of attrition models (Maynard Smith, 1974), where contestants compete for a prize while incurring costs over time. The key difference lies in the discrete bidding structure and the specific penalty mechanism for the second-place finisher.

The game also relates to the extensive literature on escalation of commitment in organizational behavior (Staw, 1976; Brockner, 1992). This research stream examines why decision-makers continue investing in failing projects, often attributing the behavior to psychological biases such as loss aversion and the sunk cost fallacy.

### 2.3 Empirical Evidence

Experimental studies of the dollar auction have consistently demonstrated the theoretical predictions of escalation. Teger (1980) conducted early laboratory experiments showing that participants regularly bid beyond the value of the prize. More recent studies (Ku, Malhotra, and Murnighan, 2005) have examined the psychological mechanisms underlying escalation, finding that competitive arousal and self-justification play crucial roles.

## 3. Model Setup and Formal Framework

### 3.1 Basic Game Structure

We formally define the dollar auction game as follows:

**Players:** $N = {1, 2, ..., n} $ where  $n ≥ 2 $

**Prize Value:** $ V > 0  $(typically normalized to  $V = 1 $)

**Bidding Process:** Sequential bidding with minimum increment  $δ > 0 $

**Payoff Structure:**
- Highest bidder:  $V - b_i $ (where  $b_i $ is their winning bid)
- Second-highest bidder:  $-b_j $ (where  $b_j $ is their losing bid)
- All other players: $ 0 $

### 3.2 Strategic Form Representation

Let  $B_i $ represent the set of possible bids for player $ i $, where $B_i = {0, δ, 2δ, 3δ, ...}$. The strategy space for each player is the set of decision rules that map the current state of the auction to a bidding decision.

For simplicity, we initially consider a two-player version of the game with discrete bidding increments. Let$ b_1 $and$ b_2$ represent the final bids of players 1 and 2, respectively.

**Payoff Functions:**

For player 1:
$$
π_1(b_1, b_2) = \\\\
\\begin {array}{ll}
V - b_1    & if b_1 > b_2\\\\
-b_1       & if b_1 < b_2\\\\
V/2 - b_1   &if b_1 = b_2 \\\\
\\end{array} \\\\ 
\\text{
(assuming equal probability of winning ties)}
$$

For player 2:
$$
π_2(b_1, b_2) = \\\\
\\begin {array}{ll}
-b_2       & if b_1 > b_2\\\\
π_2(b_1, b_2) = V - b_2     & if b_1 < b_2\\\\
π_2(b_1, b_2) = V/2 - b_2   &if b_1 = b_2 \\\\
\\end{array} \\\\ 
\\text{
(assuming equal probability of winning ties)}
$$  


### 3.3 Dynamic Formulation

To capture the sequential nature of bidding, we model the game as an extensive form game with perfect information. The game proceeds in rounds, with players alternating bids until no player is willing to raise the current high bid.

Let$ h_t$ represent the history of bids up to round$ t$, and let $σ_i$ be player $i$'s strategy, which maps histories to actions (bid or pass). The game terminates when no player raises the current high bid in a given round.

## 4. Game-Theoretic Analysis

### 4.1 Pure Strategy Equilibria

A fundamental result of the dollar auction is that no pure strategy Nash equilibrium exists when players have unlimited resources. This can be demonstrated through contradiction:

**Proposition 1:** In the dollar auction game with unlimited resources and continuous bidding, no pure strategy Nash equilibrium exists.

**Proof Sketch:** Suppose there exists a pure strategy equilibrium where the highest bid is $b*$. If$ b* < V$, then the second-highest bidder has an incentive to bid $b* + ε$ for arbitrarily small$ ε > 0$, winning the auction and obtaining payoff $V - (b* + ε) > 0.$ If$ b* ≥ V,$ then the highest bidder receives negative payoff and would prefer not to bid, contradicting the equilibrium assumption.

This impossibility result highlights the inherent instability of the dollar auction and explains the observed escalation in experimental settings.

### 4.2 Mixed Strategy Analysis

Given the absence of pure strategy equilibria, we examine mixed strategy Nash equilibria. The analysis becomes complex due to the discrete nature of bidding and the asymmetric payoff structure.

**Proposition 2:** Mixed strategy equilibria exist but are characterized by high variance and potential for significant losses.

In the mixed strategy equilibrium, players randomize over their bidding strategies, leading to uncertain outcomes and expected payoffs that can be negative for both players. The equilibrium mixing probabilities depend critically on the players' risk preferences and resource constraints.

### 4.3 Resource-Constrained Analysis

When players face budget constraints, the game structure changes significantly. Let$ W_i $represent player$ i$'s wealth constraint, where $W_i ≥ 0.$

With binding wealth constraints, pure strategy equilibria can exist. Specifically, if one player has significantly more resources than others, they may be able to credibly commit to bidding beyond the prize value, deterring entry from resource-constrained opponents.

**Proposition 3:** If $W_1 > W_2 + V,$ then player 1 can guarantee victory by bidding$ W_2 + δ, $regardless of player 2's strategy.

This result demonstrates how asymmetric resources can resolve the escalation problem, but at the cost of potential inefficiency.

## 5. Behavioral and Psychological Considerations

### 5.1 Escalation of Commitment

The dollar auction serves as a laboratory for studying escalation of commitment, where decision-makers increase investment in a course of action based on previously invested resources (sunk costs) rather than future value.

The psychological mechanisms driving escalation include:

1. **Sunk Cost Fallacy:** Players continue bidding to justify previous investments
2. **Competitive Arousal:** The competitive nature of the auction increases risk-taking
3. **Loss Aversion:** The fear of losing invested amounts motivates continued bidding
4. **Self-Justification:** Players rationalize continued participation to maintain self-image

### 5.2 Cognitive Biases and Heuristics

Experimental evidence suggests that players in dollar auctions exhibit systematic deviations from rational choice predictions. Common biases include:

**Anchoring:** Initial bids serve as reference points that influence subsequent decisions
**Availability Heuristic:** Players overweight recent or memorable outcomes
**Overconfidence:** Systematic overestimation of the probability of winning

### 5.3 Learning and Adaptation

Repeated play of the dollar auction provides insights into learning dynamics. Studies show that while some players learn to avoid the escalation trap, others continue to exhibit commitment escalation across multiple rounds.

The learning process is complicated by the game's inherent uncertainty and the tension between individual rationality and collective irrationality.

## 6. Applications and Extensions

### 6.1 Military Conflicts and Arms Races

The dollar auction has been used to model military conflicts where opposing sides continue to invest resources in a winner-takes-all competition. Historical examples include:

- **World War I:** The prolonged trench warfare represented escalating commitments by both sides
- **Arms Races:** Cold War military spending exhibited similar escalation dynamics
- **Regional Conflicts:** Many territorial disputes show characteristics of dollar auction dynamics

### 6.2 Corporate Takeovers and Bidding Wars

In corporate finance, hostile takeover battles often resemble dollar auctions. Multiple bidders compete for a target company, with the losing bidders incurring significant costs (legal fees, due diligence, opportunity costs) without receiving any benefit.

Notable examples include:
- The RJR Nabisco takeover battle (1988)
- The Time-Warner-Paramount conflict (1989)
- Various telecom spectrum auctions

### 6.3 Research and Development Competitions

Patent races in pharmaceutical development exhibit dollar auction characteristics. Multiple firms invest heavily in research, but only the first to market typically captures the lion's share of profits.

### 6.4 Political Campaigns

Electoral campaigns, particularly primary contests, can take on dollar auction characteristics where candidates continue spending despite diminishing returns, driven by sunk costs and competitive pressures.

## 7. Extensions and Variations

### 7.1 Multi-Player Variations

Extending the dollar auction to multiple players $(n > 2)$ introduces additional complexity. With more players, the probability of winning decreases for each individual, but the competitive dynamics may intensify.

**Proposition 4:** In the n-player dollar auction, the expected total expenditure increases with the number of players, ceteris paribus.

### 7.2 Incomplete Information

When players have private information about their valuations or resources, the game becomes a Bayesian game. This extension is particularly relevant for modeling real-world scenarios where participants have different assessments of the prize value.

### 7.3 All-Pay Auctions

The dollar auction is closely related to all-pay auctions, where all bidders pay their bids regardless of whether they win. The key difference is that in dollar auctions, only the top two bidders pay, creating a discontinuous payoff structure.

### 7.4 Temporal Discounting

Incorporating time preferences and discounting rates can significantly alter the game dynamics. If players discount future payoffs, the incentive to escalate may be reduced, potentially leading to earlier termination.

### 7.5 Reputation and Repeated Games

In repeated dollar auction settings, reputation effects become important. Players may develop reputations for commitment or restraint, which can influence opponents' strategies in future rounds.


## 8. Conclusion

The dollar auction game represents a fundamental paradox in game theory, demonstrating how rational individuals can be led into collectively irrational outcomes through the structure of strategic incentives. Our analysis has revealed several key insights:

1. **Equilibrium Properties:** The absence of pure strategy Nash equilibria highlights the inherent instability of the game and explains observed escalation behavior.

2. **Behavioral Mechanisms:** Psychological factors such as sunk cost fallacy, competitive arousal, and loss aversion provide complementary explanations for escalation beyond pure game-theoretic predictions.

3. **Real-World Applications:** The dollar auction framework successfully models various competitive situations, from military conflicts to corporate takeovers, providing valuable insights for understanding escalation dynamics.

4. **Policy Implications:** The pathological properties of dollar auctions inform mechanism design and regulatory policy, highlighting the importance of avoiding structures that penalize unsuccessful participants.

5. **Methodological Contributions:** The game serves as an important testing ground for game-theoretic concepts, behavioral economics theories, and computational approaches.

The dollar auction's enduring relevance lies not only in its theoretical elegance but also in its practical applications. As we face increasingly complex competitive environments in business, politics, and international relations, understanding the mechanisms that drive escalation becomes ever more critical.

Future research should continue to explore the intersection of rational choice theory and behavioral psychology, developing more nuanced models that can better predict and prevent destructive escalation. The dollar auction will undoubtedly continue to serve as a valuable laboratory for these investigations, helping us understand the delicate balance between competition and cooperation in strategic interactions.

The game ultimately teaches us that in competitive environments, the structure of incentives matters as much as the rational calculation of outcomes. By recognizing when we find ourselves in dollar auction-like situations, we can perhaps avoid the trap of escalating commitment and make more informed strategic decisions.

---

## References

Brockner, J. (1992). The escalation of commitment to a failing course of action: Toward theoretical progress. *Academy of Management Review*, 17(1), 39-61.

Ku, G., Malhotra, D., & Murnighan, J. K. (2005). Towards a competitive arousal model of decision-making: A study of auction fever in live and Internet auctions. *Organizational Behavior and Human Decision Processes*, 96(2), 89-103.

Leininger, W. (1989). Escalation and cooperation in conflict situations: The dollar auction revisited. *Journal of Conflict Resolution*, 33(2), 231-254.

Maynard Smith, J. (1974). The theory of games and the evolution of animal conflicts. *Journal of Theoretical Biology*, 47(1), 209-221.

O'Neill, B. (1986). International escalation and the dollar auction. *Journal of Conflict Resolution*, 30(1), 33-50.

Shubik, M. (1971). The dollar auction game: A paradox in noncooperative behavior and escalation. *Journal of Conflict Resolution*, 15(1), 109-111.

Staw, B. M. (1976). Knee-deep in the big muddy: A study of escalating commitment to a chosen course of action. *Organizational Behavior and Human Performance*, 16(1), 27-44.

Teger, A. I. (1980). *Too much invested to quit*. New York: Pergamon Press.`,__vite_glob_0_53=`---
title: Math
---



# Useful Taylor Expression:

$\\ln(1+x) = \\sum_{n=1}^{\\infty}\\dfrac{(-1)^{n+1}x^n}{n}$`,__vite_glob_0_54=`---
title: Musician
---

江湖悠悠

于东然

就是南方凯

作业：

1. 美人鱼 抄谱 CCC 

2. 试随身乐队的吉他的和弦，操作 BBB 

3. 哼旋律 DDD

4. 第二个曲谱 AAA`,__vite_glob_0_55=`---
title: Strict Game Development
---

# MDA

- Mechanics
- Dynamics
- Aesthetics

## Aesthetics 

- Sensation 
- Fantasy
- Narrative
- Challenge 
- Fellowship
- Discovery 
- Expression 
- Submission 

## Dynamic Models 

- Challenge
  - Time Pressure 
  - Opponent play  
- Fellowship
  - Share information 
  - Supplying winning conditions that are more difficult to achieve alone 
- Expression
  - Buy, build and win items
  - Construct world 
  - 
- Narrative 

---

# Roadmap 

- Overall content 
- Experience 
- Analyse Dynamic 
- Mechanics

## Example 

- Theme

- Experience 

Challenge, narration, discovery, fantaasy 

- Challenge 
  - Find pattern, do assassin, and achievement 
    - 1. Easily be spotted
      - Enemy AI broad eyesight - a value 
      - Route dense  - the route 
      - Infamous point - the relation
    - 2. Find patterns and environment 
      - find route - screen 
      - repeat - route design 
      - time delay - 
      - item - 
    - 3.do assassin 
      - Climb - move mechanic 
      - Time delay to hide - 
      - Hidden places - 

# ARCS

- Attention
- Relevance
- Confidence 
- Satisfaction

## Attention 

- Perceptual arousal
- Inquiry arousal 
- Variability 

## Relevance 

- Goal orientation 
- Motive matching 
- Familiarity

## Confidence 

- Learning requirements 
- Success opportunities 
- Personal control 

## Satisfaction 

- Intrinsic reinforcement 
- Extrinsic rewards 
- Equity

---

# Combined with game design 

## Attention 

- Style, Character, UI, Story, SE 

## Relevance

- Relevated with real life

## Confidence

- Difficulty, Reward, Choices 

## Satisfaction

- Upgrade, tests.

# Immersion 

- Skill & Challenge 

- Boring - MindFlow - Anxiety 

## Everyonr MindFlow 

- Design 
- Focus 
- Visual

## Features of Immersion 

- target
- balance 
- reward 
- mind and move 
- time 
- focus 
- lose myself 
- control 
- targeted experience

## More detailed 

- Mindflow - Control - relax - bored - Indifferent - Worried - Anxiety - Motivate

## Stages 

- Ready 
  - Target 
  - Reward 
  - Balnace 
- Experience
  - Mind and move 
  - Focus 
  - Control 
- Effect 
  - Lose myself 
  - Time 
  - Targeted experience





`,__vite_glob_0_56=`# VSCode Vim setting: jj for esc

\`\`\`json
{
    "before": ["j", "j"],
    "after": ["<Esc>"]
}
\`\`\`

`,__vite_glob_0_57=`---
title: Test
---

# Understanding React Hooks

React Hooks are functions that let you use state and other React features without writing a class.

Here is some content with a mathematical formula inline: $E = mc^2$

And a block formula:

$$
\\int_{-\\infty}^{+\\infty} e^{-x^2} dx = \\sqrt{\\pi}
$$

More content...
`,__vite_glob_0_58=`Strategy: "Verified Creator" Program

`,__vite_glob_0_59=`---
title: Quantum Computation - Week 1
---

# Exercise 2.58

Suppose we prepare a quantum system in an eigenstate$|\\psi\\rangle$
of some observable $M$, with corresponding eigenvalue $m$.

What is the average observed value of $M$, and the standard deviation?

---

## Solution:

$\\langle M \\rangle = \\langle \\psi | M | \\psi \\rangle = m$ ($M|\\psi \\rangle = m|\\psi\\rangle$)

$\\langle M^2 \\rangle = \\langle \\psi | M^2 | \\psi \\rangle = m^2$

$\\Delta(M) = \\sqrt{\\langle M^2 \\rangle - \\langle M \\rangle ^2} = \\sqrt{m^2 - m^2 } = 0$

--- 

# 2.107->2.108:

$$
\\begin{aligned}[l]
&\\left[A,B\\right] \\\\ 
=&AB - BA\\\\
=&(C-\\langle C\\rangle)(D-\\langle D\\rangle) - (D-\\langle D\\rangle)(C-\\langle C\\rangle) \\\\
=& CD - DC\\\\
 = &\\left[C,D\\right]
\\end{aligned}
$$

--- 

# Exercise 2.59

Suppose we have qubit in the state  $|0\\rangle $,
and we measure the observable  $X$ .
What is the average value of  $X$  ?
What is the standard deviation of  $X$  ?

 --- 

## Solution


$$
\\begin{aligned}[l]
& \\langle X \\rangle \\\\
 = & \\langle 0 | X |0 \\rangle \\\\
 = &0\\\\
\\\\
&\\langle X^2\\rangle \\\\
 = &\\langle I \\rangle \\\\
= &1\\\\
\\\\
&\\Delta(X)\\\\
 = &\\sqrt{\\langle X ^2\\rangle - \\langle X \\rangle ^ 2}\\\\
= & 1
\\end{aligned}
$$

--- 

# Exercise 2.60

Show that  $\\vec{v} \\cdot \\vec{\\sigma} $ has eigenvalues  $\\pm $1 ,
and that the projectors onto the corresponding eigenspaces are given by
$P_{ \\pm}=(I \\pm \\vec{v} \\cdot \\vec{\\sigma}) / 2 .$

--- 

## Solution

$\\vec v \\cdot \\vec \\sigma = v_x \\sigma_x + v_y\\sigma_y + v_z\\sigma_z$

$\\Rightarrow (\\vec v \\cdot \\vec \\sigma)^2 = v_x ^ 2 + v_y ^ 2 + v_z ^ 2 = |\\vec v|^2 = I$

$\\Rightarrow P = \\dfrac{I \\pm \\vec v \\cdot \\vec \\sigma}{2}$

---

# Exercise 2.61

Calculate the probability of obtaining the result $+1$
for a measurement of  $\\vec{v} \\cdot \\vec{\\sigma} $,
given that the state prior to measurement is  $|0\\rangle $.
What is the state of the system after the measurement if $+1$ is obtained?

---

## Solution

$p = \\langle 0 | P_+ | 0\\rangle = \\dfrac{1}{2}(\\langle 0| I | 0\\rangle + \\langle 0 | \\vec v \\cdot \\vec \\sigma | 0 \\rangle)$

$ = \\dfrac{1}{2}(1 + v_z)$

$|\\psi' \\rangle = \\dfrac{1}{2}(I +\\vec v \\cdot \\vec \\sigma)|0\\rangle = (1 + v_z)|0\\rangle + (v_x + iv_y)|1\\rangle$

$\\dfrac{|\\psi'\\rangle}{\\sqrt{\\langle \\psi'|\\psi'\\rangle}} = \\dfrac{(1 + v_z)|0\\rangle + (v_x + iv_y)|1\\rangle}{\\sqrt{2(1+v_z)}}$





`,__vite_glob_0_60=`---
title: Quantum Computation - Week 2
---

# Phase

$e^{i\\theta}|\\psi\\rangle$ = $|\\psi\\rangle$, *global phase factor* is $e^{i\\theta}$.

$e^{i\\theta}|n$ = $a$, *relative phase factor* is $e^{i\\theta}$.

---

# Composite systems

The state space of a **composite** physical system is the **tensor product**
of the state spaces of the component physical systems.

---

# Exercise 2.66

Show that the average value of the observation $X_1Z_2$
for a two qubit system measured in the state $(|00\\rangle + |11\\rangle) / \\sqrt 2$ is zero.

---

## Solution

$\\langle X_1Z_2 \\rangle = \\langle (|00\\rangle + |11\\rangle) / \\sqrt 2 | X_1 Z_2 | (|00\\rangle + |11\\rangle) / \\sqrt 2 \\rangle$

$=\\langle (|00\\rangle + |11\\rangle) / \\sqrt 2 |(|10\\rangle - |01\\rangle)/\\sqrt 2\\rangle$

$=0 $

---
`,__vite_glob_0_61=`---
title: Quantum Computation - Week 3
---

# Exercise 2.67

Suppose  $V$  is a Hilbert space with a subspace  $W$ .

Suppose $U: W \\rightarrow V$  is a linear operator which preserves inner products,

that is, for any $ \\left|w_{1}\\right\\rangle$  and  $\\left|w_{2}\\right\\rangle$  in  $W$ ,

$\\left\\langle w_{1}\\right| U^{\\dagger} U\\left|w_{2}\\right\\rangle=\\left\\langle w_{1} \\mid w_{2}\\right\\rangle$ .


Prove that there exists a unitary operator  $U^{\\prime}: V \\rightarrow V $ which extends $U$ .

That is, $ U^{\\prime}|w\\rangle=U|w\\rangle$  for all $ |w\\rangle $ in  $W $, but $ U^{\\prime}$  is defined on the entire space  $V$ . 

Usually we omit the prime symbol $'$ and just write $ U  $to denote the extension.

---

## Proof

### U is an isometry from W into V

$\\forall |w_1\\rangle, |w_2\\rangle \\in W, \\langle U w_1 | U w_2 \\rangle = \\langle w_1 | U^\\dagger U | w_2\\rangle = \\langle w_1 | w_2 \\rangle$

Therefore, $U$ is an isometry.

### Extend U to unitary operator U' on V

Let $W^\\perp$ denote the orthogonal complement of $W$ in $V$, so $V = W \\oplus W^\\perp$

Notice that $V = U(W) \\oplus U(W)^\\perp$

$U$ is isometry $\\Rightarrow$ $\\dim W = \\dim U(W) \\Rightarrow \\dim W^\\perp = \\dim U(W)^\\perp$

$\\Rightarrow \\exists T: W^\\perp \\rightarrow U(W)^\\perp$, $T$ is isometry

Define $U': V\\rightarrow V $ by: $U'|v\\rangle = U|w\\rangle + T|w^\\perp\\rangle$

where $|v\\rangle = |w\\rangle + |w^\\perp\\rangle, |w\\rangle \\in W, |w^\\perp\\rangle\\in W^\\perp$

### Show that U' is unitary

$\\forall |v_1\\rangle, |v_2\\rangle \\in V, |v_i \\rangle =|w_i\\rangle + |w_i^\\perp\\rangle,$ we have:

$$
\\begin{aligned}
\\langle U'v_1|U'v_2\\rangle & = \\langle Uw_1 + Tw_1^\\perp | U w_2 + T w_2^\\perp\\rangle \\\\
&=\\langle Uw_1|Uw_2\\rangle + \\langle Tw_1^\\perp | Tw_2^\\perp\\rangle\\\\
&=\\langle w_1 | w_2\\rangle + \\langle w_1^\\perp|w_2^\\perp\\rangle\\\\
&=\\langle v_1|v_2\\rangle
\\end{aligned}
$$

$\\Box$

---

# Thoughts on 2.127 - 2.131, the POVM universal measurement

There's a **quantum system** with **state space** $Q$

We want to perform a $\\sum_{i}M_i$, a **POVM** on $|\\psi\\rangle$, but it's not a projector

We introduce a **ancilla system** with **state space** $M$,  with orthonormal basis $|m\\rangle$,

We construct a composed system $Q\\otimes M$, and $|\\Psi\\rangle = |\\psi\\rangle\\otimes|0\\rangle$ (here $|0\\rangle$ can be any state)

We denote $U$ on $Q\\otimes M$ by $U|\\Psi\\rangle = \\sum_i M_i|\\psi\\rangle|m\\rangle$,

we can see $U$ is unitary and preserves inner products, therefore:

$$
\\begin{aligned}
\\langle\\Psi_1|U^\\dagger U|\\Psi_2\\rangle &= \\sum_{i, j}\\langle\\psi_1|M_i^\\dagger \\langle m_i|M_j|\\psi_2\\rangle| m_j\\rangle\\\\
&=\\sum_{i,j}\\langle\\psi_1|M_i^\\dagger M_j|\\psi_2\\rangle\\langle m_i|m_j\\rangle\\\\
&=\\sum_i \\langle\\psi_1|M_i^\\dagger M_i|\\psi_2\\rangle \\text{ (notice only when i = j it's not zero)}\\\\ 
&=\\langle\\psi_1|\\psi_2\\rangle
\\end{aligned}
$$

then we can perform measurement on $M$ instead, we have $P_m = I_Q \\otimes |m\\rangle\\langle m |$

then the probability:

$$
\\begin{aligned}
p(m) &= \\langle\\Psi|U^\\dagger P_mU|\\Psi\\rangle\\\\
&= \\sum_{i, j}\\langle\\psi|M_i^\\dagger \\langle m_i|P_m M_j|\\psi\\rangle| m_j\\rangle\\\\
&=\\sum_{i,j}\\langle\\psi|M_i^\\dagger M_j|\\psi\\rangle \\langle m_i|m\\rangle\\langle m|m_j\\rangle \\\\
&=\\langle\\psi |M^\\dagger_m M_m|\\psi\\rangle \\text{ ((notice only mi = m and mj = m it's not zero))}
\\end{aligned}
$$

the state:

$$
\\begin{aligned}
\\dfrac{P_m U |\\Psi\\rangle}{\\sqrt{p(m)} } &= \\frac{\\sum_i M_i|\\psi\\rangle|m_i\\rangle\\langle m_i|m\\rangle}{\\sqrt{p(m)}}\\\\
&=\\dfrac{M_m|\\psi\\rangle|m\\rangle}{\\sqrt{\\langle\\psi|M^\\dagger _m M_m|\\psi\\rangle}} \\text{ (notice only mi = m it's not zero)}\\\\
\\end{aligned}
$$

(the book made a mistake here)

therefore the state of system $M$ is $|m\\rangle$,

the state of system $Q$ is $\\dfrac{M_m|\\psi\\rangle|m\\rangle}{\\sqrt{\\langle\\psi|M^\\dagger _m M_m|\\psi\\rangle}}$

which correspond with **Postulate 3**  $\\square$

---

# Exercise 2.68

Prove that $\\dfrac{|00\\rangle + |11\\rangle}{\\sqrt{2}} \\ne |a\\rangle|b\\rangle$ for all single qubit states $|a\\rangle, |b\\rangle$

---

## Proof

let $|a\\rangle = \\alpha |0\\rangle + \\beta|1\\rangle, |b\\rangle = \\gamma|0\\rangle + \\delta|1\\rangle$,

$|a\\rangle|b\\rangle = \\dfrac{1}{2}\\alpha\\gamma|00\\rangle + \\dfrac{1}{2}\\alpha\\delta|01\\rangle + \\dfrac{1}{2}\\beta\\gamma|10\\rangle + \\dfrac{1}{2}\\beta\\delta|11\\rangle$

then $\\alpha\\delta = 0$ and $\\beta\\gamma = 0$, contradiction.

---

# Superdense coding

# Exercise 2.70

Suppose  $E$  is any positive operator acting on Alice's qubit.

Show that  $\\langle\\psi| E \\otimes I|\\psi\\rangle  $takes the same value 

when  $|\\psi\\rangle  $is any of the four Bell states. 

Suppose some malevolent third party ('Eve') intercepts Alice's qubit 

on the way to Bob in the superdense coding protocol. 

Can Eve infer anything about which of the four possible bit strings  

$00,01,10,11  $Alice is trying to send? 

If so, how, or if not, why not?

---

## Solution

1. notice that $\\langle \\psi | E \\otimes I | \\psi \\rangle = tr((E\\otimes I )|\\psi\\rangle\\langle\\psi|)$

2. No, she can only access to one bit and there's no useful information.

---

# Density operator

density operator, density matrix:

$\\rho \\equiv \\sum_i p_i|\\psi_i\\rangle\\langle\\psi_i|$

$\\rho \\rightarrow U\\rho U^\\dagger$

$\\rho_m = \\dfrac{M_m\\rho M_m^\\dagger}{tr(M^\\dagger_m M_m \\rho)}$

$\\rho = \\sum_i p_i \\rho_i =\\sum_m M_m \\rho M_m ^\\dagger$
`,__vite_glob_0_62=`---
title: Quantum Computation - Week 4
---

# More density operator

$tr(\\rho) = 1$

$\\rho$ is a positive operator

# Postulates


## 1

$\\sum_i p_i \\rho_i$

## 2

$\\rho' = U\\rho U^\\dagger$

## 3

$p(m) = tr(M^\\dagger_mM_m\\rho)$

$\\dfrac{M_m\\rho M^\\dagger_m}{tr((M^\\dagger_mM_m\\rho)}$

$\\sum_mM^\\dagger_mM_m = I$

## 4

$\\rho_1\\otimes \\rho_2\\otimes\\cdots\\otimes\\rho_n$

## Pure state:

$\\rho = |\\psi\\rangle\\langle\\psi|$

---

# Exercise 2.71

(Criterion to decide if a state is mixed or pure) 

Let  $\\rho  $ be a density operator. 

Show that  $\\operatorname{tr}\\left(\\rho^{2}\\right) \\leq 1$ ,

with equality if and only if  $\\rho  $ is a pure state.

---

# Proof

$\\Rightarrow:$

$tr(\\rho^2) = 1 \\Rightarrow \\sum_i\\lambda_i^2 = 1\\Rightarrow $ one $\\lambda $ is 1

$\\Leftarrow:$

$\\rho = |\\psi\\rangle\\langle\\psi| \\Rightarrow \\rho^2 = \\rho \\Rightarrow tr(\\rho^2) = tr(\\rho) = 1$

---

# Same density matrices:

$|\\tilde \\psi_i\\rangle = \\sum_j u_{ij}|\\tilde \\phi_j\\rangle$

---

# Exercise 2.72

(Bloch sphere for mixed states) 

The Bloch sphere picture for pure states of a single qubit was introduced in Section 1.2. 

This description has an important generalization to mixed states as follows.

(1) Show that an arbitrary density matrix for a mixed state qubit may be written as

$\\rho=\\frac{I+\\vec{r} \\cdot \\vec{\\sigma}}{2}$

where  $\\vec{r}$  is a real three-dimensional vector such that  $\\|\\vec{r}\\| \\leq 1 $. 

This vector is known as the Bloch vector for the state  $\\rho $.


(2) What is the Bloch vector representation for the state  $\\rho=I / 2 $ ?

(3) Show that a state  $\\rho$  is pure if and only if  $\\|\\vec{r}\\|=1 $.

(4) Show that for pure states the description of the Bloch vector we have given coincides with that in Section 1.2.

---

## (1)

Exercise 2.60

## (2)

$\\vec r = (0, 0, 0)$

## (3)

)`,__vite_glob_0_63=`---
title: Science Create Startup - Week 0
category: Notes
---

# 科技创新创业

- 链：科创链
- 科技创新创业投资：科金链
- 科技创新创业政策：科政链
- 科技创新创业服务：科服链

## 路径

- 什么是科技创新创业？构成？过程？
- 案例：难在哪里？
- 创新创业动态风险特性
- 科技创新创业融资之道
- 科技创新创业组织制度育生态环境
- 总结 创新创业经济学特性
- 我们的未来 创新创业创造财富，分析，思考

## 一 数字经济时代科技创新创业

### 党中央的精神

十九大报告：

创新型国家 - 创新型大学

企业家精神 - 创新创业

创新创业

商事制度

多层次资本市场

### 经济增长 =技术进步 x 组织方式（人力 资本 资源 制度）










`,__vite_glob_0_64=`---
title: Science Create Startup - Week 1
category: Notes
---

# 科技创新创业

- 链：科创链
- 科技创新创业投资：科金链
- 科技创新创业政策：科政链
- 科技创新创业服务：科服链

## 路径

- 什么是科技创新创业？构成？过程？
- 案例：难在哪里？
- 创新创业动态风险特性
- 科技创新创业融资之道
- 科技创新创业组织制度育生态环境
- 总结 创新创业经济学特性
- 我们的未来 创新创业创造财富，分析，思考

## 一 数字经济时代科技创新创业

### 党中央的精神

十九大报告：

创新型国家 - 创新型大学

企业家精神 - 创新创业

创新创业

商事制度

多层次资本市场

### 经济增长 =技术进步 x 组织方式（人力 资本 资源 制度）










`,__vite_glob_0_65=`---
title: Science Create Startup - Week 2
category: Notes
---

#

## 创新和创业的区别？

- 创新：企业存在。产品、工艺、市场、组织、原材料创新
- 创业：企业不存在，通过技术经济过程让企业能生存

`,__vite_glob_0_66=`---
title: Stochastic Progress - Special 1
category: Notes
---

# 一维随机游走是暂态还是常返态？

$$
\\begin{array}{l}
\\sum_{n=1}^\\infty P_{00}^n\\\\ \\\\
=\\sum_{n=1}^\\infty P_{00}^{2n}\\\\ \\\\
= \\sum_{n=1}^\\infty \\dfrac{(2n)!}{n!n!}p^n(1-p)^n \\\\ \\\\
= \\sum_{n=1}^\\infty \\dfrac{1\\times 2\\times \\cdots \\times (2n-1)\\times 2n}{(1\\times 2 \\times \\cdots \\times n)(1\\times 2 \\times \\cdots \\times n)}p^n(1-p)^n \\\\ \\\\
= \\sum_{n=1}^\\infty \\dfrac{1\\times 3 \\times\\cdots\\times (2n-1)2^n}{1\\times 2 \\times \\cdots \\times n}p^n(1-p)^n \\text{  （分子偶数项的每一个是分母第一部分每一个的两倍 ）} 
\\end{array} 
$$

寻找上界：

$$
\\begin{array}{l}
\\sum_{n=1}^\\infty \\dfrac{1\\times 3 \\times\\cdots\\times (2n-1)2^n}{1\\times 2 \\times \\cdots \\times n}p^n(1-p)^n \\\\\\\\ 
<\\sum_{n=1}^\\infty \\dfrac{2\\times 4 \\times\\cdots\\times 2n}{1\\times 2 \\times \\cdots \\times n}2^np^n(1-p)^n\\\\ \\\\
=  \\sum_{n=1}^\\infty (4p(1-p))^n 
\\end{array}
$$

当 $p\\ne 0.5$时：

$$
\\begin{array}{l }
\\sum_{n=1}^\\infty P_{00}^n\\\\ \\\\ 
<\\sum_{n=1}^\\infty (4p(1-p))^n \\\\\\\\  
< \\sum_{n-1}^\\infty 1^n \\\\\\\\  
<\\infty
\\end{array}
$$

寻找下界：


$$
\\begin{array}{l}
\\sum_{n=1}^\\infty \\dfrac{1\\times 3 \\times\\cdots\\times (2n-1)2^n}{1\\times 2 \\times \\cdots \\times n}p^n(1-p)^n \\\\ \\\\ 
=\\sum_{n=1}^\\infty \\dfrac{1}{1}\\cdot \\dfrac{3}{2}\\cdots\\dfrac{2n-3}{n-1}\\dfrac{2n-1}{n} 2^np^n(1-p)^n \\\\ \\\\ 
=\\sum_{n=1}^\\infty \\dfrac{3}{1}\\cdot \\dfrac{5}{2}\\cdots\\dfrac{2n-1}{n-1}\\dfrac{1}{n} 2^np^n(1-p)^n \\text{   （分子整体向左移动）}\\\\ \\\\ 
\\gt \\sum_{n=1}^\\infty 2^{n-1}\\dfrac{1}{n} 2^n p^n (1-p)^n \\\\ \\\\
=\\sum_{n=1}^\\infty \\dfrac{1}{2n}(4p(1-p))^n
\\end{array}
$$

当 $p=0.5$时：

$$
\\begin{array}{l }
\\sum_{n=1}^\\infty P_{00}^n\\\\ \\\\
\\gt\\sum_{n=1}^\\infty \\dfrac{1}{2n}(4p(1-p))^n\\\\ \\\\
= \\sum_{n=1}^\\infty \\dfrac{1}{2n} \\\\ \\\\ 
=\\infty
\\end{array}
$$

# 一维对称随机游走是正常返还是零常返？

$$
\\begin{array}{l }
\\sum_{n=1}^\\infty n P_{00}^n\\\\ \\\\
\\sum_{n=1}^\\infty 2n P_{00}^{2n}\\\\ \\\\
\\gt\\sum_{n=1}^\\infty 2n\\dfrac{1}{2n}(4p(1-p))^n\\\\ \\\\
= \\sum_{n=1}^\\infty 1 \\\\ \\\\ 
=\\infty
\\end{array}
$$

# 二维对称随机游走是暂态还是常返态？

$$
\\begin{array}{l}
\\sum_{n=1}^\\infty P_{00}^n\\\\ \\\\
=\\sum_{n=1}^\\infty P_{00}^{2n}\\\\ \\\\
= \\sum_{n=1}^\\infty \\left(\\dfrac{1}{4}\\right)^{2n}\\sum_{i=0}^n \\dfrac{(2n)!}{i!i!(n-i)!(n-i)!}\\\\ \\\\ 
=\\sum_{n=1}^\\infty \\left(\\dfrac{1}{4}\\right)^{2n}\\sum_{i=0}^n\\dfrac{n!}{i!(n-i)!}\\dfrac{n!}{i!(n-i)!}\\dfrac{(2n)!}{n!n!} \\\\ \\\\ 
= \\sum_{n=1}^\\infty \\left(\\dfrac{1}{4}\\right)^{2n}\\sum_{i=0}^n \\binom{n}{i}\\binom{n}{n-i}\\binom{2n}{n} \\\\ \\\\
= \\sum_{n=1}^\\infty \\left(\\dfrac{1}{4}\\right)^{2n}\\binom{2n}{n} \\sum_{i=0}^n \\binom{n}{i}\\binom{n}{n-i}\\\\ \\\\
= \\sum_{n=1}^\\infty \\left(\\dfrac{1}{4}\\right)^{2n}\\binom{2n}{n} \\binom{2n}{n} \\\\ \\\\ 
\\text{   （直观理解： 2n 个球，在前 n 个选 i 个，后 n 个选 n-i 个，等价于 2n 个球直接选 n 个）}\\\\ \\\\
= \\sum_{n=1}^\\infty \\left(\\dfrac{1}{4^n}\\right)^{2}\\binom{2n}{n} \\binom{2n}{n} \\\\ \\\\ 
=\\sum_{n=1}^\\infty \\left(\\dfrac{(2n)!}{n!n!2^n2^n}\\right)^2 \\\\ \\\\
=\\sum_{n=1}^\\infty  \\left(\\dfrac{1\\times 2 \\times \\cdots 2n }{(2\\times 4 \\times \\cdots\\times 2n)(2\\times 4 \\times \\cdots\\times 2n)}\\right)^2 \\\\ \\\\
=\\sum_{n=1}^\\infty \\left(\\dfrac{1\\times 3\\times \\cdots\\times 2n-1}{2\\times 4\\times \\cdots\\times 2n}\\right)^2 \\\\ \\\\
= \\sum_{n=1}^\\infty \\dfrac{1}{2}\\cdot\\dfrac{1}{2}\\cdot\\dfrac{3}{4}\\cdot\\dfrac{3}{4}\\cdot\\dfrac{5}{6}\\cdot\\dfrac{5}{6}\\cdots\\dfrac{2n-1}{2n}\\cdot \\dfrac{2n-1}{2n} \\\\ \\\\ 
= \\sum_{n=1}^\\infty \\dfrac{1}{2}\\cdot\\dfrac{3}{2}\\cdot\\dfrac{3}{4}\\cdot\\dfrac{5}{4}\\cdot\\dfrac{5}{6}\\cdot\\dfrac{7}{6}\\cdots\\dfrac{2n-1}{2n}\\cdot\\dfrac{1}{2n}\\\\ \\\\ 
\\text{（分子整体向左移动）}\\\\ \\\\ 
= \\sum_{n=1}^\\infty \\dfrac{1}{2}\\cdot\\dfrac{3}{2}\\cdot\\dfrac{3}{4}\\cdot\\dfrac{5}{4}\\cdot\\dfrac{5}{6}\\cdot\\dfrac{7}{6}\\cdots\\dfrac{2n-1}{2n}\\cdot\\dfrac{2n+1}{2n}\\cdot \\dfrac{1}{2n+1} \\\\ \\\\ 
\\gt\\sum_{n=1}^\\infty  \\dfrac{1}{2}\\cdot\\dfrac{3}{2}\\cdot\\dfrac{1}{2}\\cdot\\dfrac{3}{2}\\cdot\\dfrac{2}{3}\\cdot\\dfrac{4}{3}\\cdots\\dfrac{n-1}{n}\\cdot\\dfrac{n+1}{n}\\cdot\\dfrac{1}{2n+1} \\\\ \\\\ 
\\text{（因为} \\dfrac{2k-1}{2k}\\cdot\\dfrac{2k+1}{2k}= 1-\\dfrac{1}{4k^2} > 1-\\dfrac{1}{k^2}=\\dfrac{k-1}{k}\\cdot\\dfrac{k+1}{k}\\text{）} \\\\ \\\\
= \\sum_{n=1}^\\infty \\dfrac{1}{2}\\cdot\\dfrac{3}{2}\\cdot\\dfrac{1}{2}\\cdot\\left(\\dfrac{3}{2}\\cdot\\dfrac{2}{3}\\right)\\cdot\\left(\\dfrac{4}{3}\\cdots\\dfrac{n-1}{n}\\right)\\cdot\\dfrac{n+1}{n}\\cdot\\dfrac{1}{2n+1} \\\\ \\\\ 
= \\sum_{n=1}^\\infty   \\dfrac{1}{2}\\cdot\\dfrac{3}{2}\\cdot\\dfrac{1}{2}\\cdot\\dfrac{n+1}{n}\\cdot\\dfrac{1}{2n+1} \\\\ \\\\ 
\\gt \\sum_{n=1}^\\infty \\dfrac{1}{2}\\cdot\\dfrac{3}{2}\\cdot\\dfrac{1}{2} \\cdot 1 \\cdot \\dfrac{1}{3n} \\\\ \\\\
=\\dfrac{1}{8} \\sum_{n=1}^\\infty \\dfrac{1}{n}\\\\ \\\\ 
=\\infty
\\end{array} 
$$

# 三维对称随机游走是暂态还是常返态？

$$
\\begin{array}{l}
\\sum_{n=1}^\\infty P_{00}^n\\\\ \\\\
= \\sum_{n=1}^\\infty P_{00}^{2n}\\\\ \\\\
= \\sum_{n=1}^\\infty \\left(\\dfrac{1}{6}\\right)^{2n} \\sum_{i+j=0}^n\\dfrac{(2n)!}{i!i!j!j!(n-i-j)!(n-i-j)!} \\\\ 
=  \\sum_{n=1}^\\infty \\left(\\dfrac{1}{6}\\right)^{2n} \\binom{2n}{n}\\sum_{i+j=0}^n\\dfrac{n!}{i!j!(n-i-j)!}\\dfrac{n!}{i!j!(n-i-j)!}\\\\ 
\\end{array}
$$

接下来需要推导一个放缩：

首先当 $i>j$, 有：

$$
\\begin{array}{l}
i!j! \\\\ \\\\ 
= (i-1)! \\cdot i\\cdot (j+1)!\\cdot \\dfrac{1}{j+1}\\\\\\\\
= (i-1)!(j+1)! \\dfrac{i}{j+1}\\\\ \\\\  
\\ge (i-1)!(j+1)!
\\end{array}
$$

同理可以得到：

$i!j! \\ge \\left(\\dfrac{i+j}{2}\\right)!\\left(\\dfrac{i+j}{2}\\right)!$

$i!j!(n-i-j)! \\ge (n/3)!(n/3)!(n/3)!$

$\\dfrac{n!}{i!j!(n-i-j)!} \\le \\dfrac{n!}{(n/3)!(n/3)!(n/3)!}$

接下来继续：

$$
\\begin{array}{l}
\\sum_{n=1}^\\infty P_{00}^n\\\\ \\\\
=  \\sum_{n=1}^\\infty \\left(\\dfrac{1}{6}\\right)^{2n} \\binom{2n}{n}\\sum_{i+j=0}^n\\dfrac{n!}{i!j!(n-i-j)!}\\dfrac{n!}{i!j!(n-i-j)!}\\\\ \\\\
\\le  \\sum_{n=1}^\\infty \\left(\\dfrac{1}{6}\\right)^{2n} \\binom{2n}{n}\\sum_{i+j=0}^n\\dfrac{n!}{i!j!(n-i-j)!}\\dfrac{n!}{(n/3)!(n/3)!(n/3)!}\\\\ \\\\
= \\sum_{n=1}^\\infty \\left(\\dfrac{1}{6}\\right)^{2n} \\binom{2n}{n}\\dfrac{n!}{(n/3)!(n/3)!(n/3)!}\\sum_{i+j=0}^n\\dfrac{n!}{i!j!(n-i-j)!}\\\\ \\\\
= \\sum_{n=1}^\\infty \\left(\\dfrac{1}{6}\\right)^{2n} \\binom{2n}{n}\\dfrac{n!}{(n/3)!(n/3)!(n/3)!}3^n\\\\ \\\\
\\text{（对于所有可能三种方向的全排列，就是全部的路径数）} \\\\ \\\\ 
= \\sum_{n=1}^\\infty\\left(\\dfrac{1}{6}\\right)^n\\left(\\dfrac{1}{2}\\right)^n\\binom{2n}{n}\\dfrac{n!}{(n/3)!(n/3)!(n/3)!}\\\\ \\\\
= \\sum_{n=1}^\\infty\\left(\\dfrac{1}{3}\\right)^n\\left(\\dfrac{1}{4}\\right)^n\\binom{2n}{n}\\dfrac{n!}{(n/3)!(n/3)!(n/3)!}\\\\ \\\\
\\end{array}
$$

接下来针对 $\\left(\\dfrac{1}{4}\\right)^n \\binom{2n}{n}$，回顾二维随机游走：

$$
\\begin{array}{l}
\\left(\\dfrac{1}{4}\\right)^{2n} \\binom{2n}{n} \\binom{2n}{n} \\\\ \\\\ 
=\\dfrac{1}{2}\\cdot\\dfrac{3}{2}\\cdot\\dfrac{3}{4}\\cdot\\dfrac{5}{4}\\cdot\\dfrac{5}{6}\\cdot\\dfrac{7}{6}\\cdots\\dfrac{2n-1}{2n}\\cdot\\dfrac{2n+1}{2n}\\cdot \\dfrac{1}{2n+1} \\\\ \\\\ 
=  \\left(\\dfrac{1}{2}\\cdot\\dfrac{3}{2}\\right)\\cdot\\left(\\dfrac{3}{4}\\cdot\\dfrac{5}{4}\\right)\\cdot\\left(\\dfrac{5}{6}\\cdot\\dfrac{7}{6}\\right)\\cdots\\left(\\dfrac{2n-1}{2n}\\cdot\\dfrac{2n+1}{2n}\\right)\\cdot \\dfrac{1}{2n+1} \\\\ \\\\ 
\\lt  1\\cdot 1\\cdot 1 \\cdots 1\\cdot \\dfrac{1}{2n+1} \\\\ 
\\lt \\dfrac{1}{n}
\\end{array}
$$

因此有$\\left(\\dfrac{1}{4}\\right)^n \\binom{2n}{n}<\\dfrac{1}{\\sqrt n}$

我们继续：

$$
\\begin{array}{l}
\\sum_{n=1}^\\infty P_{00}^n\\\\ \\\\
= \\sum_{n=1}^\\infty\\left(\\dfrac{1}{3}\\right)^n\\left(\\dfrac{1}{4}\\right)^n\\binom{2n}{n}\\dfrac{n!}{(n/3)!(n/3)!(n/3)!}\\\\ \\\\
\\lt \\sum_{n=1}^\\infty \\left(\\dfrac{1}{3}\\right)^n\\dfrac{1}{\\sqrt{n}}\\dfrac{n!}{(n/3)!(n/3)!(n/3)!}\\\\ \\\\
\\overset{n=3k}{=}\\sum_{3k=1}^\\infty\\dfrac{1}{\\sqrt{n}}  \\dfrac{1}{3^{3k}}\\dfrac{(3k)!}{k!k!k!}\\\\ \\\\
=\\sum_{3k=1}^\\infty\\dfrac{1}{\\sqrt{n}}  \\dfrac{1\\times 2\\times 3\\times 4\\times 5 \\times 6 \\cdots\\times 3k}{(3\\times 6\\times\\cdots\\times(3k-2)\\times(3k-1)\\times 3k)(3\\times 6\\times\\cdots\\times 3k)(3\\times 6\\times\\cdots\\times 3k)} \\\\ \\\\ 
=\\sum_{3k=1}^\\infty\\dfrac{1}{\\sqrt{n}} \\dfrac{1\\times 2\\times 4\\times 5  \\cdots\\times 3k-1}{(3\\times 6\\times\\cdots\\times 3k)(3\\times 6\\times\\cdots\\times(3k-2)\\times(3k-1))} \\\\ \\\\ 
=\\sum_{3k=1}^\\infty\\dfrac{1}{\\sqrt{n}}  \\dfrac{1}{3}\\cdot\\dfrac{2}{3}\\cdot\\dfrac{4}{6}\\cdot\\dfrac{5}{6}\\cdots\\dfrac{3k-2}{3k}\\cdot\\dfrac{3k-1}{3k}\\\\ \\\\
=\\sum_{3k=1}^\\infty\\dfrac{1}{\\sqrt{n}} \\dfrac{2}{3}\\cdot\\dfrac{4}{3}\\cdot\\dfrac{5}{6}\\cdot\\dfrac{7}{6}\\cdots\\dfrac{3k-1}{3k}\\cdot\\dfrac{1}{3k}\\\\ \\\\
= \\sum_{3k=1}^\\infty\\dfrac{1}{\\sqrt{n}}  \\left(\\dfrac{2}{3}\\cdot\\dfrac{4}{3}\\right)\\cdot\\left(\\dfrac{5}{6}\\cdot\\dfrac{7}{6}\\right)\\cdots\\left(\\dfrac{3k-1}{3k}\\cdot\\dfrac{3k+1}{3k}\\right)\\cdot\\dfrac{1}{3k+1}\\\\ \\\\
\\end{array} \\\\ \\\\ 
\\lt \\sum_{3k=1}^\\infty\\dfrac{1}{\\sqrt{n}}  1\\cdot 1 \\cdots 1 \\cdot \\dfrac{1}{3k+1} \\\\ \\\\
\\overset{3k=n}{=} \\sum_{3k=1}^\\infty\\dfrac{1}{\\sqrt{n}}  \\cdot\\dfrac{1}{n+1} \\\\ \\\\
\\lt \\sum_{3k=1}^\\infty\\dfrac{1}{n\\sqrt{n}}  \\\\ \\\\
\\lt\\infty
$$

# 更高维的对称随机游走是暂态还是常返态？

更高维的对称随机游走相比与三维更容易放缩，均为暂态

# 为什么维度高了之后是暂态的？直觉是什么？

假设我们在偏离 0 位置的地方，我们想要走到 0 处， 也就是 “内部”： 

- 一维随机游走的“内部”可以看作一根杆上的线段（如 $[-1, 1]$）
- 二维随机游走的“内部”可以看作一个平面内的圆（如 $x^2+y^2 = 1$）
- 三维随机游走的“内部”可以看作一个空间内的一个球（如 $x^2+y^2+z^2 = 1$）

可以发现：维度越高，“内部” 相对于“外部” 所占的 “比例” 会更小，因此也更难返回
`,__vite_glob_0_67=`---
title: Stochastic Progress - Week 2
category: Notes
---

# Conditional Expectation & Probability 

## Conditional Expectation 

When: $p_Y(y) > 0$

Then: 

$p_{X|Y}(x|y) = p(X=x|Y=y) = \\dfrac{p(X=x, Y=y)}{p_Y(y)}$

- $F_{X|Y}(x|y) = P\\{X\\le x|Y=y\\} = \\sum_{a\\le x}p_{X|Y}(a|y)$
- $E(X|Y=y) = \\sum_x xP\\{X=x|Y=y\\} = \\sum_x p_{X|Y} (x|y)$

## Formula 

$Var(X) = E[X^2] - (E[X])^2$

$Var(X) = E[Var(X|Y)] + Var(E[X|Y])$

# Conditional Probability 

## Example

> To maximize the probability of selecting the best award from a sequence of $n$ randomly ordered awards announced one by one (where each rejected award cannot be revisited and accepting an award ends the process)

Solution:

We use the strategy: Pass the first $k$ awards and select the first one that better than before

Denote: $X_k$ as using strategy pass first $k$ awards, $E$ as getting the best award.

If the place we stop (denote as $i$) is the best, we need:

1. The best award is at position $i$
2. The first $i-1$'s awards' best one should be in the first $k$ (Or we will stop in the middle)

Therefore:

$$
\\begin{array}{l}
P(E|X_k)\\\\ 
= \\sum_{i=k+1}^n\\dfrac{1}{n}\\cdot\\dfrac{k}{i-1}\\\\ 
= \\dfrac{k}{n}\\sum_{i=k+1}^n\\dfrac{1}{i-1}\\\\ 
\\approx \\dfrac{k}{n}(\\ln (n-1) - \\ln k)\\\\ 
\\end{array}
$$


To maximize the probability, let 

$f(k) = P(E|X_k) \\approx \\dfrac{k}{n}(\\ln (n-1) - \\ln k) $, 

then:

$$
\\begin{array}{l}
f'(k) = \\dfrac{\\ln (n-1) - \\ln (ek)}{n}
\\end{array}
$$

To maximize probability, we have:

$k = \\dfrac{n-1}{e}$




`,__vite_glob_0_68=`---
title: Stochastic Progress - Assignment - Week 2
category: Assignments
---

# Discrete Martingale

## 1

### Problem

> If $ \\left\\{Z_{n}, n \\geq 1\\right\\} $ is a martingale, prove that for $ 1 \\leq k<n $, 
> 
> $ \\mathbb{E}\\left[Z_{n} \\mid Z_{k}, \\ldots, Z_{1}\\right]=Z_{k} $ .
> 
> Similarly, if $ \\left\\{Z_{n}, n \\geq 1\\right\\} $ is a submartingale, prove that 
> 
> $\\mathbb{E}\\left[Z_{n} \\mid Z_{k}, \\ldots, Z_{1}\\right] \\geq Z_{k} $

### Proof (a)

Notice:

$$
\\begin{array}{l}
\\mathbb{E}\\left[Z_{n} \\mid Z_{k}, \\ldots, Z_{1}\\right]\\\\ 
=E[E[Z_n|Z_{n-1},\\dots,Z_1]|Z_k,\\dots,Z_1]\\\\ 
= E[Z_{n-1}|Z_k,\\dots,Z_1]
\\end{array}
$$

By induction, we can get:

$\\mathbb{E}\\left[Z_{n} \\mid Z_{k}, \\ldots, Z_{1}\\right]=Z_{k}$

### Proof (b)

Similarly, we have:

$$
\\begin{array}{l}
\\mathbb{E}\\left[Z_{n} \\mid Z_{k}, \\ldots, Z_{1}\\right]\\\\ 
=E[E[Z_n|Z_{n-1},\\dots,Z_1]|Z_k,\\dots,Z_1]\\\\ 
\\ge E[Z_{n-1}|Z_k,\\dots,Z_1]
\\end{array}
$$


By induction, we can get:

$\\mathbb{E}\\left[Z_{n} \\mid Z_{k}, \\ldots, Z_{1}\\right]\\ge Z_{k}$


## 2

### Problem 

> Let $ S_{0}=0, S_{n}=\\epsilon_{1}+\\cdots+\\epsilon_{n} $ for $ n \\geq 1 $, where $ \\left\\{\\epsilon_{i}\\right\\} $ are i.i.d. exponential random variables with $ \\lambda=1 $. Show that 
> 
> $X_{n}=2^{n} \\exp \\left(-S_{n}\\right), \\quad n \\geq 1$
> 
> is a martingale.

### Solution

First:

$$
\\begin{array}{l}
E[|X_n|]\\\\
=E[2^ne^{-n}]\\\\ 
< \\infty 
\\end{array}
$$

Then:

$$
\\begin{array}{l}
E[X_{n+1} | X_1,\\dots, X_n]\\\\ 
=E[2^{n+1}e^{-S_n}e^{-\\epsilon_{n+1}}]\\\\ 
= 2^{n+1}e^{-S_n}E[e^{-\\epsilon_{n+1}}]\\\\ 
= 2^{n+1}e^{-S_n}\\int_0^\\infty e^{-x} e^{-x} dx \\\\ 
= 2^ne^{-S_n} \\\\ 
=X_n
\\end{array}
$$

## 3

### Problem

> If $ X_{i}(i \\geq 1) $ are i.i.d. with $ \\mathbb{E}[|X|]<\\infty $, and $ N $ is a stopping time for $ \\left\\{X_{i}\\right\\} $ with $ \\mathbb{P}(N<\\infty)=1 $ and $ \\mathbb{E}[N]<\\infty $, show that 
> 
> $\\mathbb{E}\\left[\\sum_{i=1}^{N} X_{i}\\right]=\\mathbb{E}[N] \\mathbb{E}[X] . $

### Solution 

$$
\\begin{array}{l} 
E[\\sum_{i=1}^NX_i] \\\\ 
= E[\\sum_{i=1}^\\infty X_i I_{i\\le N}]\\\\ 
= \\sum_{i=1}^\\infty E[X] P(N\\ge i)\\\\ 
= \\sum_{i=1}^\\infty E[X]\\sum_{j=i}^\\infty P(N=j)\\\\ 
= \\sum_{j=1}^\\infty E[X] \\sum_{i=1}^j P(N=j) \\\\ 
=\\sum_{j=1}^\\infty E[X] jP(N=j) \\\\ 
= E[N]E[X]
\\end{array}
$$

## 4

### Problem 

>   Consider a process $ \\left\\{X_{n}, n \\geq 0\\right\\} $ where $ X_{0} $ is a positive integer. If $ X_{n}=0 $, then $ X_{n+1}=0 $. If $ X_{n}>0 $,
> 
> $X_{n+1}=\\left\\{\\begin{array}{ll}X_{n}+1, & \\text { with probability } 0.5 \\\\X_{n}-1, & \\text { with probability } 0.5\\end{array}\\right.$
>
> 
> (a) Show that $ X_{n} $ is a non-negative martingale.
> 
> (b) For $ X_{0}=i>0 $, use Kolmogorov's inequality for submartingales to bound$\\mathbb{P}\\left(\\exists n \\geq 0, X_{n} \\geq N \\mid X_{0}=i\\right)$

### Solution (a)

Notice $X_n \\ge 0$, and:

$$
\\begin{array}{l}
E[X_{n+1} | X_1,\\dots, X_n]\\\\ 
= E[X_{n+1}|X_n]\\\\ 
= \\begin{cases}
0.5(X_n+1)+0.5(X_n-1)& X_n >0 \\\\ 
X_n & X_n = 0
\\end{cases}\\\\ 
= X_n
\\end{array}
$$

Then:

$$
\\begin{array}{l}
E[|X_n|] \\\\ 
= E[X_n] \\\\ 
= E[X_0] \\\\ 
= X_0 < \\infty
\\end{array}
$$

### Solution (b)

$$
\\begin{array}{l}
P(\\max(X_0,\\dots,X_n)>N|X_0 = i)\\\\ 
\\le \\dfrac{E[X_n| X_0 = i]}{N} \\\\ 
= \\dfrac{i}{N}
\\end{array}
$$

which is the upper bound.



## 5

### Problem

> Prove Kolmogorov's Inequality: Let $ X_{1}, X_{2}, \\ldots $ be independent random variables with mean 0 . Define $ S_{k}=X_{1}+\\cdots+X_{k} $. For any $ a>0 $, show that: 
> 
> $ P\\left\\{\\max _{1 \\leq k \\leq n}\\left|S_{k}\\right| \\geq a\\right\\} \\leq \\frac{\\operatorname{Var}\\left(S_{n}\\right)}{a^{2}} $

### Proof (1)

> (1) Show that $ \\left\\{S_{k}, k=1,2, \\ldots\\right\\} $ is a martingale with mean 0 .

We have:

$E[|S_n|] \\le \\sqrt{E[S_n^2]} = Var[S_n] < \\infty$

Also:

$$
\\begin{array}{l}
E[S_{n+1}|S_1,\\dots,S_n]\\\\ 
=E[\\sum_{i=1}^{n+1}X_i|X_1,\\dots,X_n]\\\\ 
=E[X_1+\\dots+X_n|X_1,\\dots,X_n] + E[X_{n+1}]\\\\ 
= S_n
\\end{array}
$$

### Proof (2)

> (2) Define $ \\left\\{Z_{k}\\right\\} $ :
> 
> $Z_{k+1}=\\left\\{\\begin{array}{ll}S_{k+1}, & \\text { if } \\max _{1 \\leq i \\leq k}\\left|S_{i}\\right|<a \\\\Z_{k}, & \\text { if } \\max _{1 \\leq i \\leq k}\\left|S_{i}\\right| \\geq a\\end{array}\\right.$
> 
> with $ Z_{0}=0 $. Show $ \\left\\{Z_{k}\\right\\} $ is a martingale.

Notice $E[|Z_{n+1}|] < \\infty $, and:

$$
\\begin{array}{l}
E[Z_{n+1}|Z_1,\\dots,Z_n]\\\\ 
= E[S_{n+1}|Z_1,\\dots,Z_n]P(\\max_{1\\le i \\le n}|S_i| < a) + E[Z_n|Z_1,\\dots,Z_n]P(\\max_{1\\le i \\le n}|S_i| \\ge a) \\\\ 
= E[S_{n+1}|S_1,\\dots,S_n]P(\\max_{1\\le i \\le n}|S_i| < a) + Z_nP(\\max_{1\\le i \\le n}|S_i| \\ge a) \\\\ 
= S_nP(\\max_{1\\le i \\le n}|S_i| < a) + Z_nP(\\max_{1\\le i \\le n}|S_i| \\ge a) \\\\ 
= Z_nP(\\max_{1\\le i \\le n}|S_i| < a) + Z_nP(\\max_{1\\le i \\le n}|S_i| \\ge a) \\\\ 
= Z_n
\\end{array}
$$

### Proof (3)

> (3) For a martingale $ \\left\\{M_{k}\\right\\} $ with $ M_{0}=0 $, show:
> 
> $\\sum_{i=1}^{n} E\\left[\\left(M_{i}-M_{i-1}\\right)^{2}\\right]=E\\left[M_{n}^{2}\\right] .$

We have:

$$
\\begin{array}{l}
\\sum_{i=1}^nE[(M_i - M_{i-1})^2]\\\\ 
= \\sum_{i=1}^n E[E[M_i^2 - 2M_iM_{i-1}+M_{i-1}^2]|M_{i-1}] \\\\ 
= \\sum_{i=1}^n E[E[M_i^2] - M_{i-1}^2]\\\\ 
= \\sum_{i=1}^n E[M_i^2] - E[M_{i-1}^2] \\\\ 
= E[M_n^2] - E[M_0^2] \\\\ 
= E[M_n^2]
\\end{array}
$$

### Proof (4)

> (4) Use Chebyshev's inequality to show:
> 
> $P\\left\\{\\max _{1 \\leq k \\leq n}\\left|S_{k}\\right| \\geq a\\right\\} \\leq \\frac{E\\left[S_{n}^{2}\\right]}{a^{2}}=\\frac{\\operatorname{Var}\\left(S_{n}\\right)}{a^{2}} .$

We have:

$$
\\begin{array}{l}
P\\left\\{\\max _{1 \\leq k \\leq n}\\left|S_{k}\\right| \\geq a\\right\\}\\\\ 
= P\\{|Z_n|\\ge a\\} \\\\ 
\\le \\dfrac{E[Z_n^2]}{a^2}\\\\ 
\\le \\dfrac{E[S_n^2]}{a^2} \\\\ 
= \\dfrac{Var(S_n)}{a^2}
\\end{array}
$$

### Answer (5)

> (5) Does this proof apply to all $ \\left\\{S_{k}\\right\\} $ that are mean-0 martingales?

Answer: No 

The proof relies on the independent increments of $ \\left\\{S_{k}\\right\\} $. 

Specifically: 

- Step (3) assumes $ \\left\\{M_{k}\\right\\} $ has orthogonal increments (true for martingales). 

- Step (4) uses the fact that $ Z_{n}=S_{n} $ if no stopping occurs, which implicitly requires $ S_{n} $ to be a sum of independent variables. 

For general martingales, Kolmogorov's inequality does not hold; instead, Doob's inequality is used, which requires different techniques. Thus, independence is essential here.

# Chapter 4

## 2

### Problem 

> Suppose whether it rains today depends on the weather conditions of the previous three days. Explain how to analyze this system using a Markov chain. How many states must there be?

### Solution 

8, each day has 2 states, and there are:

$2^3 = 8$ 

states. 

## 3 

### Problem 

> In Exercise 2, suppose that if it has rained for the past three days, then it will rain today with probability 0.8; if there was no rain in the past three days, then it will rain today with probability 0.2; and in other cases, today's weather will be the same as yesterday's with probability 0.6. Determine the transition probability matrix $P$


### Solution 

We denote $R$ as rain and $N$ as no rain, then:

$$
\\begin{array}{|l|l|l|l|l|l|l|l|l|}
\\hline
 & \\text{R R R} & \\text{R R N} & \\text{R N R} & \\text{R N N} & \\text{N R R} & \\text{N N R} & \\text{N N R} \\\\ \\hline
\\text{R R R} & 0.8 & 0.2 & 0 & 0 & 0 & 0 & 0 \\\\ \\hline
\\text{R R N} & 0 & 0 & 0.4 & 0.6 & 0 & 0 & 0 \\\\ \\hline
\\text{R N R} & 0 & 0 & 0 & 0 & 0.6 & 0 & 0 \\\\ \\hline
\\text{R N N} & 0 & 0 & 0 & 0 & 0 & 0.4 & 0.6 \\\\ \\hline
\\text{N R R} & 0.6 & 0.4 & 0 & 0 & 0 & 0 & 0 \\\\ \\hline
\\text{N R N} & 0 & 0 & 0.4 & 0.6 & 0 & 0 & 0 \\\\ \\hline
\\text{N N R} & 0 & 0 & 0 & 0 & 0.6 & 0.2 & 0.8 \\\\ \\hline
\\text{N N N} & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\\\ \\hline
\\end{array}
$$

## 4

### Problem 

> Consider a process $ \\left\\{X_{n}, n \\geq 0\\right\\} $ taking values 0,1 , or 2 . Suppose 
> 
> $\\mathrm{P}\\left\\{X_{n+1}=j \\mid X_{n}=i, X_{n-1}=i_{n-1}, \\cdots, X_{0}=i_{0}\\right\\}=\\left\\{\\begin{array}{ll} P_{i j}^{\\mathrm{I}}, & \\text { if } n \\text { is even } \\\\ P_{i j}^{\\mathrm{II}}, & \\text { if } n \\text { is odd. } \\end{array}\\right. $
> 
>  Is $ \\left\\{X_{n}, n \\geq 0\\right\\} $ a Markov chain? If not, explain how to enlarge the state space to make it a Markov chain.

### Solution 

No, it depends on if $n$ is odd.

We can extend to $(i, k)$, where $k = \\begin{cases}0 &\\text {if } n \\text{ is odd}\\\\ 1 &\\text {if } n \\text{ is even}\\end{cases}$

## 5

### Problem 

> A Markov chain $ \\left\\{X_{n}, n \\geq 0\\right\\} $ with states $ 0,1,2 $ has the transition probability matrix: 
> 
> $ \\left[\\begin{array}{lll} \\frac{1}{2} & \\frac{1}{3} & \\frac{1}{6} \\\\ 0 & \\frac{1}{3} & \\frac{2}{3} \\\\ \\frac{1}{2} & 0 & \\frac{1}{2} \\end{array}\\right] . $
> 
>  Given $ \\mathrm{P}\\left(X_{0}=0\\right)=\\mathrm{P}\\left(X_{0}=1\\right)=\\frac{1}{4} $, find $ \\mathrm{E}\\left[X_{3}\\right] $.

### Solution 

Notice:

$$
\\begin{array}{l}
 \\left[\\begin{array}{lll} \\frac{1}{2} & \\frac{1}{3} & \\frac{1}{6} \\\\ 0 & \\frac{1}{3} & \\frac{2}{3} \\\\ \\frac{1}{2} & 0 & \\frac{1}{2} \\end{array}\\right]^3
=  \\left[\\begin{array}{lll} \\frac{13}{36} & \\frac{11}{54} & \\frac{47}{108} \\\\ \\frac{4}{9} & \\frac{4}{27} & \\frac{11}{27} \\\\ \\frac{5}{12} & \\dfrac{2}{9} & \\frac{13}{36} \\end{array}\\right]
\\end{array}
$$

Then:

$$
\\begin{array}{l}
[\\frac{1}{4},\\frac{1}{4},\\frac{1}{2}]\\left[\\begin{array}{lll} \\frac{13}{36} & \\frac{11}{54} & \\frac{47}{108} \\\\ \\frac{4}{9} & \\frac{4}{27} & \\frac{11}{27} \\\\ \\frac{5}{12} & \\dfrac{2}{9} & \\frac{13}{36} \\end{array}\\right]
\\\\
= \\left[\\frac{59}{144}, \\frac{43}{216}, \\frac{169}{432}\\right] 
\\end{array}
$$

Therefore:

$ \\mathrm{E}\\left[X_{3}\\right]=0 \\cdot \\frac{59}{144}+1 \\cdot \\frac{43}{216}+2 \\cdot \\frac{169}{432}=\\frac{43}{216}+\\frac{338}{432}=\\frac{53}{54} $

## 8

### Problem 

>  Suppose Coin 1 lands heads with probability 0.7, and Coin 2 lands heads with probability 0.6. If the coin tossed today lands heads, we choose Coin 1 to toss tomorrow; if it lands tails, we choose Coin 2 to toss tomorrow. Initially, we toss either Coin 1 or Coin 2 with equal probability.
> 
> (a) What is the probability that Coin 1 is tossed on the third day after starting?
> 
> (b) If the coin tossed on Monday lands heads, what is the probability that the coin tossed on Friday of the same week also lands heads?

### Solution (a)

The probability transition matrix:

$$
\\begin{array}{l|l|l|}
\\hline & 1 & 2 \\\\ 
\\hline 1 & 0.7 & 0.3 \\\\ 
\\hline 2 & 0.6 & 0.4 \\\\ 
\\hline 
\\end{array}
$$

Then for the third day:

$[0.5, 0.5]\\left[\\begin{array}{ll}0.7&0.3\\\\ 0.6&0.4\\end{array} \\right]^2 = [0.665, 0.335]$

So the probability is $0.665$

### Solution (b)

For Thursday:

$[1, 0]\\left[\\begin{array}{ll}0.7&0.3\\\\ 0.6&0.4\\end{array} \\right]^3 = [0.6667, 0.3333]$

Then for Friday:

$P(H) = 0.6667 * 0.7 + 0.3333 * 0.6 = 0.6667$

## 11 

### Problem 

> In Example 4.3, Gary was in glum 4 days ago. Given that he has not felt cheerful for a week, what is the probability that he is in glum today?
>
>  The transition probability matrix of $(C, S, G)$ (cheerful, so-so, glum) is: $\\boldsymbol{P}=\\left[\\begin{array}{lll} 0.5 & 0.4 & 0.1 \\\\ 0.3 & 0.4 & 0.3 \\\\ 0.2 & 0.3 & 0.5 \\end{array}\\right]$

### Solution

Notice:

$[\\dfrac{7}{15}, \\dfrac{8}{15}]\\left[\\begin{array}{ll}\\dfrac{4}{7}&\\dfrac{3}{7}\\\\ \\dfrac{3}{8}&\\dfrac{5}{8}\\end{array}\\right] = [\\dfrac{7}{15}, \\dfrac{8}{15}]$

Therefore, we can approximate that:

$[0, 1]\\left[\\begin{array}{ll}\\dfrac{4}{7}&\\dfrac{3}{7}\\\\ \\dfrac{3}{8}&\\dfrac{5}{8}\\end{array}\\right]^4 \\approx \\dfrac{8}{15}$

## 12

### Problem 

> For a Markov chain $ \\left\\{X_{n}, n \\geq 0\\right\\} $ with transition probabilities $ P_{i, j} $, consider the conditional probability $ \\mathrm{P}\\left(X_{n}=m \\mid X_{0}=i, X_{k} \\neq r\\right. $ for $ \\left.k=1, \\ldots, n\\right) $. Is this equal to the $ n $-step transition probability $ Q_{i, m}^{n} $ of a chain with state space excluding $ r $ and adjusted transitions $ Q_{i, j}=\\frac{P_{i, j}}{1-P_{i, r}} $ ? Prove or provide a counterexample.

### Solution

Consider a Markov chain with states $ \\{0,1,2\\} $ where $ r=2 $.

Transition probabilities from state 0: $ P_{0,0}=1 / 3, P_{0,1}=1 / 3, P_{0,2}=1 / 3 $.

Transition probabilities from state $ 1: P_{1,0}=1 / 2, P_{1,1}=1 / 4, P_{1,2}=1 / 4 $.

Then:

$Q_{0,0}^{2}=(1 / 2)(1 / 2)+(1 / 2)(2 / 3)=1 / 4+1 / 3=7 / 12$

$$
\\begin{array}{l }
\\mathrm{P}\\left(X_{2}=0 \\mid X_{0}=0, X_{1} \\neq 2, X_{2} \\neq 2\\right)\\\\ 
= \\dfrac{1 / 9+1 / 6}{1 / 9+1 / 9+1 / 6+1 / 12}\\\\ 
= 10 / 17 
\\end{array}
$$

Answer is No.

## 13 

### Problem

> Prove that if $ \\boldsymbol{P}^{r} $ has all positive entries for some $ r $, then $ \\boldsymbol{P}^{n} $ has all positive entries for $ n \\geq r $

### Solution 

We have:

$ P^{n}(i, j)=\\sum_{k} P^{r}(i, k) P^{n-r}(k, j)>0 $
`,__vite_glob_0_69=`---
title: Stochastic Progress - Week 3
category: Notes
---

## Conditional Expectation

$E[E[X|Y,W]|Y] = E[X|Y]$

# Martingale

## Stochastic Process

Stochastic Process: $\\{Z(t), t\\in T\\}$: A set of RV
- $Z(t)$: the **state** of process in time $t$

Components:

- **State Space**: the set for all possible $Z(t)$
- **Index Set**: $T$
- **Dependence Relationship**: Relationship between $Z(t)$

### Discrete Process

$T$ is a countable set 

### Continuous Process 

$T$ is a real number range 

## Martingale

Describe **fair game**

Two condition for SP:

- $E[|Z_n|] < \\infty$
- $E[Z_{n+1}|Z_1,\\dots,Z_n] = Z_n$

Example: A gambler's asset after $n$ games

### Corollaries

1. $E[Z_n] = E[E[Z_{n+1}|Z_1,\\dots,Z_n]] = E[Z_{n+1}]$
2. $E[Z_n] = E[Z_k] = E[Z_1], \\forall n>k>1$
3. $E[Z_m|Z_n,\\dots,Z_1] = Z_n, \\forall m>n$

### Example 

$X_i$ i.i.d. RV, has expectation $0$, $E[|X_i|]<\\infty$

Let $Z_n = \\sum_{i=1}^n X_i$

Then: $E[Z_{n+1}|Z_1, \\dots, Z_n] = Z_n$

$Z_n$ is a martingale 

--- 

(Doob Martingale)

$E[|X|]<\\infty, Z_n = E[X|Y_1,\\dots,Y_n]$


We first prove:

$E[Z_{n+1}|Z_1,\\dots,Z_n,Y] = Z_n$

Add conditional expectation for both side:

$E[E[Z_{n+1}|Z_1,\\dots,Z_n,Y]|Z_1,\\dots,Z_n] = E[Z_n|Z_1,\\dots,Z_n]$

For LHS:

$E[E[Z_{n+1}|Z_1,\\dots,Z_n,Y]|Z_1,\\dots,Z_n] = E[Z_{n+1}|Z_1,\\dots,Z_n]$

For RHS:

$E[Z_n|Z_1,\\dots,Z_n] = Z_n$

Then we prove the problem:

We want to prove:

$E[Z_{n+1}|Z_1,\\dots,Z_n,Y_1,\\dots ,Y_n] = Z_n$

For LHS:

$E[Z_{n+1}|Z_1,\\dots,Z_n,Y_1,\\dots ,Y_n] = E[Z_{n+1}|Y_1,\\dots ,Y_n]= Z_n$

---

$Z_n = \\sum_{i=1}^n(X_i - E[X_i | X_1,\\dots,X_{i=1}])$

## Stopping time

$N$: Stopping time: \${N=n}$ is completely decided by $Z_1, \\dots,Z_n$
- $P\\{N<\\infty\\} = 1$

- Example: Gamble until win 
- CounterExample: The lowest point of stock

### Stopping time process 

$\\bar{Z_n} = \\begin{cases}Z_n, &if: n\\le N\\\\ Z_N, &if: n>N\\end{cases} $

$\\{\\bar{Z_n}\\}$ is a Martingale:

Proof:

$$
\\begin{array}{ll}
&E[\\bar{Z_{n+1}}| \\bar Z_1,\\dots,\\bar Z_n] \\\\ 
&=E[\\bar{Z_{n+1}}| Z_1,\\dots,Z_n] \\\\ 
&= E[\\bar{Z_n} + I_{N \\ge n+1}(Z_{n+1} - Z_n)| Z_1,\\dots,Z_n]\\\\ 
&=\\bar{Z_n} + I_{n+1} E[(Z_{n+1} - Z_n)| Z_1,\\dots,Z_n]\\\\ 
&= \\bar{Z_n}
\\end{array}
$$

### Martingale Stopping Theorem

$P\\{N<\\infty\\} = 1$, if any condition meets, then $E[Z_N] = E[Z_1]$

1. $\\bar{Z_n}$ is uniformly bounded
- uniformly bounded: $\\exists M, s.t.; |\\bar{Z_n}|\\le M, \\forall n$
2. $N$ is bounded
- bounded: $\\exists M, s.t.: N\\le M, or: P(N\\le M ) = 1$
3. $E[N] < \\infty, \\exists M <\\infty ,s.t.: E[|Z_{n+1}-Z_n|\\mid Z_1,\\dots, Z_n] <M$
- $E[|Z_{n+1}-Z_n|\\mid Z_1,\\dots, Z_n]$ is bounded 

#### Example

(Wald Equation)

$X_i$ i.i.d. $E[|X|]<\\infty, P(N<\\infty) = 1, E[N]<\\infty $

Then:

$E[\\sum_{i=1}^NX_i] = E[N]E[X]$

## Sub, Super, Convergence

### Submartingale

$E[|Z_n|] <\\infty, E[Z_{n+1}|Z_1,\\dots,Z_n] \\ge Z_n$

- superfair game

### Supermartingale

$E[|Z_n|] <\\infty, E[Z_{n+1}|Z_1,\\dots,Z_n] \\le Z_n$

- subfair game 

### Stopping time theorem still meets 

### A corollary

\${Z_i}$ is Submartingale, $P\\{N<n\\} = 1$ then:

$E[Z_1]\\le E[Z_N]\\le E[Z_n]$

### Second corollary 

$\\{Z_n\\} $ is martingale, $f$ convex, then:

$\\{f(Z_n)\\}$ is Submartingale.


### Third corollary 

$\\{Z_n\\}$: non-negative Submartingale, $a>0$, then:

$P\\{\\max(Z_1,\\dots,Z_n)>a\\} \\le\\dfrac{E[Z_n]}{a}$

Proof: Let $N$ be the first time $Z_i > a$

$$
\\begin{array}{l}
P\\{\\max(Z_1,\\dots,Z_n)>a\\}K = P\\{Z_N>a\\} \\\\ 
\\le \\dfrac{E[Z_N]}{a} \\\\ 
\\le \\dfrac{E[Z_n]}{a}
\\end{array}
$$




--- 

$P\\{\\max(Z_1,\\dots,Z_n)>a\\} \\le\\dfrac{E[Z_n^2]}{a^2}$


### Martingale Convergence Theorem

$\\{Z_n\\}$ Martingale, $\\exists M<+\\infty$ s.t. $E[|Z_n|]\\le M,\\forall n$

 Then:

$ \\lim_{n\\to\\infty}Z_n \\overset{\\text{w.p. 1}}{\\to} a$


### Corollary  4

$\\{Z_n\\}$ Non-negative Martingale, then:

$ \\lim_{n\\to\\infty}Z_n \\overset{\\text{w.p. 1}}{\\to} a$


`,__vite_glob_0_70=`---
title: Stochastic Progress - Assignment - Week 3
category: Assignments
---

# 1

## Problem 

> Consider a Markov chain with a state space consisting of integers $ 0, \\pm 1, \\pm 2, \\ldots $, and transition probabilities:
> 
> $\\mathrm{P}_{\\mathrm{i}, \\mathrm{i}+1}=p=1-P_{i, i-1}, \\quad i=0, \\pm 1, \\pm 2, \\ldots$
> 
> where $ p \\in(0,1) $. We can directly establish recurrence in the symmetric case and determine the probability of eventually returning to state 0 in the asymmetric case.
> 
> (1) Let $ \\alpha $ denote the probability that the Markov chain eventually returns to state 0 given it is currently in state 1 . Show that $ \\alpha=1-p+p \\alpha^{2} $. (Hint: Condition on the next state.)
> 
> (2) Let $ \\beta=\\mathrm{P}\\{ $ eventually return to 0$ \\} $. Show that:
> 
> $ \\beta=\\mathrm{P}\\left\\{\\right. $ eventually return to $ \\left.0 \\mid X_{1}=1\\right\\} p+\\mathrm{P}\\left\\{\\right. $ eventually return to $ \\left.0 \\mid X_{1}=-1\\right\\}(1-p) $.
> 
> (3) Using the previous parts, show that if $ p=0.5 $ (symmetric random walk), all states are recurrent.
> 
> (4) Solve Problem 17 in Chapter 4 of the textbook.
> 
> (5) Referring to part (4), show that when $ p>0.5, \\mathrm{P}\\left\\{\\right. $ eventually return to $ \\left.0 \\mid X_{1}=-1\\right\\}=1 $.
> 
> (6) Combine part (5) with the transience of all states to show that when $ p>0.5, \\beta=2(1-p) $.
> 
> (7) Referring to part (4), show that when $ p<0.5, \\alpha=1 $.
> 
> (8) Combine part (7) with the transience of all states to show that when $ p<0.5, \\beta=2 p $.
> 
> (9) Combine parts (6) and (8) to derive the general form of $ \\beta $.

## Solution (1)

When moves to 2, we need $\\alpha^2$ to return to 0, therefore:

We have:

$\\alpha = (1-p) + p\\alpha^2$

## Solution (2)

Notice after first move, we can only be $1$ or $-1$, then the question is well explainerd 

## Solution (3)

After calculation, we have:

$\\alpha = 1$

Then:

$\\beta = p + 1-p = 1$

Also, it applies for every place.

## Solution (4)

Denote $X_n$ as the place at time $n$, $Z_n$ as the $n$-th move, then:

$E[Z_n] = p + (1-p)(-1) = 2p-1$

Then:

$\\dfrac{X_n}{n} = \\dfrac{1}{n}\\sum_{i=1}^nZ_n = 2p-1$

Therefore:

$X_n = n(2p-1)$

When $n\\to\\infty$, we have $X_n\\to\\infty$, which means any place can be only visited finite times.

## Solution (5)

$X_n\\to+\\infty$, then for any place less than $0$, $0$ is must visited 

## Solution (6)

We have:

$\\alpha = \\dfrac{1-p}{p}$

Then:

$\\beta =\\alpha p+(1-p) = 2(1-p)$

## Solution (7)

Same as [Solution 5](#solution-5)

## Solution (8)

Same as [Solution 6](#solution-6)

## Solution (9)

$\\beta = 2 \\min(p, 1-p)$

# Chapter 4

## Problem 14

> For each of the specified Markov chains below, classify the states and determine whether they are transient or recurrent. $ \\begin{array}{c} \\boldsymbol{P}_{1}=\\left[\\begin{array}{ccc} 0 & \\frac{1}{2} & \\frac{1}{2} \\\\ \\frac{1}{2} & 0 & \\frac{1}{2} \\\\ \\frac{1}{2} & \\frac{1}{2} & 0 \\end{array}\\right], \\quad \\boldsymbol{P}_{2}=\\left[\\begin{array}{cccc} 0 & 0 & 0 & 1 \\\\ 0 & 0 & 0 & 1 \\\\ \\frac{1}{2} & \\frac{1}{2} & 0 & 0 \\\\ 0 & 0 & 1 & 0 \\end{array}\\right] \\\\ \\boldsymbol{P}_{3}=\\left[\\begin{array}{ccccc} \\frac{1}{2} & 0 & \\frac{1}{2} & 0 & 0 \\\\ \\frac{1}{4} & \\frac{1}{2} & \\frac{1}{4} & 0 & 0 \\\\ \\frac{1}{2} & 0 & \\frac{1}{2} & 0 & 0 \\\\ 0 & 0 & 0 & \\frac{1}{2} & \\frac{1}{2} \\\\ 0 & 0 & 0 & \\frac{1}{2} & \\frac{1}{2} \\end{array}\\right], \\quad \\boldsymbol{P}_{4}=\\left[\\begin{array}{ccccc} \\frac{1}{4} & \\frac{3}{4} & 0 & 0 & 0 \\\\ \\frac{1}{2} & \\frac{1}{2} & 0 & 0 & 0 \\\\ 0 & 0 & 1 & 0 & 0 \\\\ 0 & 0 & \\frac{1}{3} & \\frac{2}{3} & 0 \\\\ 1 & 0 & 0 & 0 & 0 \\end{array}\\right] \\end{array} $

## Solution 

$P_1$: all states communicates with each other.

All states are **recurrent**

---

$P_2$: $4\\to 3 \\to 1\\text{ or } 2\\to 4$

All staes are **recurrent**

---

$P_3$: no other path goes to $2$

Recurrent classes:

$\\{1,3\\}, \\{4,5\\}$

Transient classes:

$\\{2\\}$

---

$P_4$: no path goes to $5$, no other path goes to $4$


Recurrent classes:

$\\{1,2\\}, \\{3\\}$

Transient classes:

$\\{4\\},\\{5\\}$

## Problem 15

> Prove that if a Markov chain has $ M $ states and state $ j $ is reachable from state $ i $, then it can be reached in at most $ M $ steps.

## Solution 

If there are more than $M$ steps, we consider the index of the start and end, there must be a duplicated start index $m$ 

Then, $m$ is revisited, therefore, any path in between can be eliminated, until the path is not longer than $M$

## Problem 16 

## Solution 

If $P_{ij}\\ne 0$,$i\\to j, j \\nrightarrow i, $ then $i$ can't be recurrent, because there's a positive probability that $i\\to j$ and never comes back, resulting contradiction.

## Problem 20

> A transition probability matrix $ \\boldsymbol{P} $ is called doubly stochastic if the sum of each column is 1 , i.e., for all $ j $, 
> 
> $ \\sum_{i} P_{i j}=1 . $ 
> 
> If such a chain is irreducible and aperiodic with $ M+1 $ states $ 0,1, \\ldots, M $, prove that the long-run proportion is 
> 
> $ \\pi_{j}=\\frac{1}{M+1}, \\quad j=0,1, \\ldots, M $

## Solution 

We have:

$\\pi_j = \\sum_{i}\\pi_iP_{ij} = (\\vec\\pi, \\vec P_j)$

Therefore:

$\\vec\\pi^T = \\vec\\pi^T P$

Then we get:

$\\lambda = 1$

With corresponding vector:

$\\vec v = (\\dfrac{1}{M+1},\\dots,\\dfrac{1}{M+1})^T$

Then we get the answer:

$\\pi_j = \\dfrac{1}{M+1}$

## Problem 21

> A standard model for mutations at a specific DNA nucleotide site is a Markov chain where a nucleotide remains unchanged with probability $ 1-3 \\alpha\\left(0<\\alpha<\\frac{1}{3}\\right) $ or changes to one of the other three nucleotides with equal probability $ \\alpha $. 
> 
> (a) Show that $ P_{1,1}^{n}=\\frac{1}{4}+\\frac{3}{4}(1-4 \\alpha)^{n} $. 
> 
> (b) What is the long-run proportion of time the chain spends in each state?

## Solution (a)

The matrix P is:

$$
\\left[\\begin{array}{cccc}
1-3\\alpha&\\alpha &\\alpha &\\alpha \\\\ 
\\alpha&1-3\\alpha &\\alpha &\\alpha \\\\ 
\\alpha&\\alpha &1-3\\alpha &\\alpha \\\\ 
\\alpha&\\alpha &\\alpha &1-3\\alpha \\\\ 
\\end{array}\\right]
$$

When $n=1$, $P^n_{1,1} = 1 - 3\\alpha$ holds.

Assume it holds for $n-1$, then:

$\\begin{array}{l}P^n_{1,1}\\\\ 
 = (1-3\\alpha )P^{n-1}_{1,1}+\\alpha(1-P^{n-1}_{1,1}) 
 \\\\ = (1-3 \\alpha )(\\dfrac{1}{4} +\\dfrac{3}{4}(1-4\\alpha )^{n-1}) + \\alpha (1-\\dfrac{1}{4}-\\dfrac{3}{4}(1-4\\alpha )^{n-1}) \\\\ 
 = \\dfrac{1}{4} + \\dfrac{3}{4}(1-4\\alpha )^n\\end{array} $

## Solution (b)

By symmetric, we can easily get:

$\\pi_j = \\dfrac{1}{4}, j = 1, 2, 3, 4$

## Problem 22

> Let $ Y_{n} $ be the sum of $ n $ independent rolls of a fair six-sided die. Find $ \\lim _{n \\rightarrow \\infty} \\mathrm{P}\\left\\{Y_{n}\\right. $ is a multiple of 13$ \\} $.

## Solution 

Notice the chain is irreducible  and aperiodic, then:

$ \\lim _{n \\rightarrow \\infty} \\mathrm{P}\\left\\{Y_{n}\\right. $ is a multiple of 13$ \\}= \\dfrac{1}{13} $

## Problem 23

> In good weather years, the number of storms follows a Poisson distribution with mean 1 ; in bad weather years, the number of storms follows a Poisson distribution with mean 3 . The weather condition of any year depends only on the previous year's weather. After a good weather year, the next year is equally likely to be good or bad; after a bad weather year, the next year is twice as likely to be bad as good. Assume year 0 (last year) was a good weather year. 
> 
> (a) Find the expected total number of storms in the next two years (year 1 and year 2). 
> 
> (b) Find the probability that year 3 has no storms. 
> 
> (c) Find the long-run average number of storms per year.

## Solution (a)

Year 1:

$E[X_1] = \\dfrac{1}{2} + \\dfrac{1}{2}\\cdot 3 = 2$

Year 2:

$E[X_2] = \\dfrac{5}{12} + \\dfrac{7}{12}\\cdot 3 = \\dfrac{13}{6}$

## Solution (b)

$P(G_3) = \\dfrac{29}{72}, P(B_3) = \\dfrac{43}{72}$

## Solution (c)

Probability transition matrix:

$P = \\left(\\begin{array}{ll}
\\dfrac{1}{2} & \\dfrac{1}{2}\\\\ 
\\dfrac{1}{3} & \\dfrac{2}{3}
\\end{array}\\right)$

Then solve the $\\pi $:

$\\pi = (\\dfrac{2}{5}, \\dfrac{3}{5})^T$

Then:

$\\dfrac{2}{5}\\cdot 1 +\\dfrac{3}{5}\\cdot 3 = \\dfrac{11}{5}$

## Problem 26

> Prove: repeatedly moving a randomly selected card to the top eventually results in a uniform distribution over all $ n $ ! permutations.


## Solution 

Notice if we do it reversely, that is \`remove the top card and insert into position $i$\`, every move has possibility  $\\dfrac{1}{n}$ to tansit to another state, so it is double stochastic.

## Problem 27

> Any individual in a population of $ N $ may be active or inactive in each time period. If an individual is active in a given time period, then independently of all other individuals, the probability that they are also active in the next time period is $ \\alpha $. Similarly, if an individual is inactive in a given time period, then independently of all other individuals, the probability that they remain inactive in the next time period is $ \\beta $. Let $ X_{n} $ denote the number of active individuals in time period $ n $.
> 
> (a) Prove that $ \\left\\{X_{n}, n \\geqslant 0\\right\\} $ is a Markov chain.
> 
> (b) Find $ \\mathrm{E}\\left[X_{n} \\mid X_{0}=i\\right] $.
> 
> (c) Derive an expression for the transition probabilities.
> 
> (d) Find the long-run proportion of time that exactly $ j $ individuals are active.

## Solution (a)

Notice state $n+1$ only depends on state $n$

## Solution (b)

$E[X_{n+1}|X_n] = \\alpha X_n + (N-X_n)(1-\\beta )$

With induction:

$ E\\left[X_{n} \\mid X_{0}=i\\right]=\\left(i-\\dfrac{N(1-\\beta)}{2-\\alpha-\\beta}\\right)(\\alpha+\\beta-1)^{n}+\\dfrac{N(1-\\beta)}{2-\\alpha-\\beta} $

## Solution (c)

$P(X_{n+1}=j|X_n=k) = \\sum_{m=\\max (0, j-(N-k))}^{\\min (k, j)}\\binom{k}{m} \\alpha^{m}(1-\\alpha)^{k-m} \\cdot\\binom{N-k}{j-m}(1-\\beta)^{j-m} \\beta^{N-k-(j-m)}$

## Solution (d)

For $ N=1 $, the stationary distribution $ \\pi $ satisfies:
$
\\pi_{1}=\\dfrac{1-\\beta}{2-\\alpha-\\beta}, \\quad \\pi_{0}=\\frac{1-\\alpha}{2-\\alpha-\\beta}
$

For general $ N $, individuals act independently. The stationary distribution is binomial with parameters $ N $ and $ p=\\dfrac{1-\\beta}{2-\\alpha-\\beta} $ :
$
\\pi_{j}=\\binom{N}{j}\\left(\\dfrac{1-\\beta}{2-\\alpha-\\beta}\\right)^{j}\\left(\\frac{1-\\alpha}{2-\\alpha-\\beta}\\right)^{N-j}
$

## Problem 36

> A process changes its state daily according to a two-state Markov chain. If the process is in state $ i $ on one day, then the next day it is in state $ j $ with probability $ P_{i, j} $, where
$
P_{0,0}=0.4, \\quad P_{0,1}=0.6, \\quad P_{1,0}=0.2, \\quad P_{1,1}=0.8
$

Each day, a message is sent. If the Markov chain is in state $ i $ on that day, the probability that the message sent is a good message is $ p_{i} $, and the probability that it is a bad message is $ q_{i}=1-p_{i,} $ for $ i=0,1 $.
> 
> (a) If the process is in state 0 on Monday, what is the probability that a good message is sent on Tuesday?
> 
> (b) If the process is in state 0 on Monday, what is the probability that a good message is sent on Friday?
> 
> (c) In the long run, what is the proportion of messages that are good?
> 
> (d) If a good message is sent on day $ n $, let $ Y_{n}=1 $; otherwise, let $ Y_{n}=2 $. Is $ \\left\\{Y_{n}, n \\geqslant 1\\right\\} $ a Markov chain? If yes, provide its transition probability matrix. If no, briefly explain why not.

## Solution (a)

$0.4p_0+0.6p_1$

## Solution (b)

We have:

$ P^{4}=\\left[\\begin{array}{ll}0.2512 & 0.7488 \\\\ 0.2496 & 0.7504\\end{array}\\right] $

Then it's:

$0.2512p_0 + 0.7488p_1$

## Solution (c)

Solve $\\pi^T = \\pi^T P$ we get:

$\\pi = (\\dfrac{1}{4}, \\dfrac{3}{4})^T$

Then:

$0.25p_0+0.75p_1$

## Solution (d)

No.

$Y_{n+1}$ is determined by $X_n$, instead of $Y_n$

## Problem 37

> Prove that the stationary probabilities of a Markov chain with transition probabilities $ P_{i, j} $ are also the stationary probabilities of the Markov chain defined by the transition probabilities
$
Q_{i, j}=P_{i, j}^{k}
$
for a specific positive integer $ k $.

## Solution 

we have:

$\\pi^T = \\pi^T P$

Therefore:

$\\pi^T = \\pi^T P = \\pi^T = \\pi^T P^2 = \\pi^T = \\pi^T P^k = \\pi^T = \\pi^T Q$

## Problem 42

> Let $ A $ be a set of states, and $ A^{\\mathrm{c}} $ be the set of remaining states.
(a) What does $ \\sum_{i \\in A} \\sum_{j \\in A^{c}} \\pi_{i} P_{i j} $ represent?
(b) What does $ \\sum_{i \\in A^{c}} \\sum_{j \\in A} \\pi_{i} P_{i j} $ represent?
(c) Explain the identity
$
\\sum_{i \\in A} \\sum_{j \\in A^{c}} \\pi_{i} P_{i j}=\\sum_{i \\in A^{c}} \\sum_{j \\in A} \\pi_{i} P_{i j}
$

## Solution (a)

Probability of $A$ flows to $A^C$


## Solution (b)

Probability of $A^C$ flows to $A$

## Solution (c)

Two flows must be equal

## Problem 45

> Consider an irreducible finite Markov chain with states $ 0,1, \\cdots, N $.
> 
> (a) Starting from state $ i $, what is the probability that the process eventually visits state $ j $ ? Provide an explanation.
> 
> (b) Let $ x_{i}=\\mathrm{P}\\{ $ visiting state $ N $ before visiting state $ 0 \\mid $ starting at $ i\\} $. Compute the system of linear equations satisfied by $ x_{i} $, for $ i=0,1, \\cdots, N $.
> 
> (c) If for $ i=1, \\cdots, N-1 $, it holds that $ \\sum_{j} j P_{i j}=i $, prove that $ x_{i}=i / N $ is a solution to the equations in (b).

## Solution (a)

1

finite and irreducible, therefore every state is **recurrent**

## Solution (b)

We have:

$ \\left\\{\\begin{array}{l}x_{i}=\\sum_{j=0}^{N} P_{i j} x_{j} \\quad \\text { for } i=1,2, \\ldots, N-1 \\\\ x_{0}=0 \\\\ x_{N}=1\\end{array}\\right. $

## Solution (c)

$\\begin{array}{l} 
\\sum_{j=0}^{N} P_{i j} x_{j} \\\\ 
=\\sum_{j=0}^{N} P_{i j} \\cdot \\frac{j}{N} \\\\ 
=\\frac{1}{N} \\sum_{j=0}^{N} j P_{i j} 
\\\\ = \\frac{i}{N} 
\\\\ = x_i
\\end{array}$

## Problem 47

> Consider an ergodic Markov chain $ \\left\\{X_{n}, n \\geqslant 0\\right\\} $ with limiting probabilities $ \\pi_{i} $. Define the process $ \\left\\{Y_{n}, n \\geqslant 1\\right\\} $ by $ Y_{n}=\\left(X_{n-1}, X_{n}\\right) $. That is, $ Y_{n} $ tracks the last two states of the original chain. Is $ \\left\\{Y_{n}, n \\geqslant 1\\right\\} $ a Markov chain? If so, determine its transition probabilities and find
> $\\lim _{n \\rightarrow \\infty} \\mathrm{P}\\left\\{Y_{n}=(i, j)\\right\\}$

## Solution 

$ P\\left(Y_{n+1}=(j, l) \\mid Y_{n}=(i, j)\\right)=P\\left(X_{n+1}=l \\mid X_{n}=j, X_{n-1}=i\\right) = P_{jl}$.

Therefore, $Y_n$ is a Markov chain 

$ P\\left(Y_{n+1}=(k, l) \\mid Y_{n}=(i, j)\\right)=\\left\\{\\begin{array}{ll}P_{j l} & \\text { if } k=j, \\\\ 0 & \\text { if } k \\neq j .\\end{array}\\right. $

$ \\lim _{n \\rightarrow \\infty} \\mathrm{P}\\left\\{Y_{n}=(i, j)\\right\\}=\\pi_{i} P_{i j} $.

## Problem 57

> A particle moves between $ n+1 $ vertices located on a circle in the following manner: at each step, it moves one step clockwise with probability $ p $, or one step counterclockwise with probability $ q= $ $ 1-p $. Starting from a special state 0 , let $ T $ be the first time it returns to state 0 . Find the probability that all states have been visited before $ T $.

## Solution 

if first move is $p$ and goes to 1, and we want to visit $n+1$ before $0$, we have:


We have:

$ \\left\\{\\begin{array}{l}x_{i}=px_{i-1} + (1-p)x_{i+1} \\quad \\text { for } i=1,2, \\ldots, N \\\\ x_{0}=0 \\\\ x_{N+1}=1\\end{array}\\right. $

When $p\\ne \\dfrac{1}{2}$ We can get:

$x_1 = \\dfrac{1-\\frac{p}{q}}{1-\\frac{p^n}{q^n}}$

Similarly we can get the answer:

$P = px_1 + qy_1 = p\\dfrac{1-\\frac{p}{q}}{1-\\frac{p^n}{q^n}} + q\\dfrac{1-\\frac{q}{p}}{1-\\frac{q^n}{p^n}}$

When $p = \\dfrac{1}{2}$:

$x_1 = \\dfrac{1}{2}$

$P = px_1+qy_1 = \\dfrac{1}{2}$

## Problem 59

> For the gambler's ruin model in Section 4.5.1, it is known that a gambler starts with wealth $ i $ (where $ i=0,1, \\ldots, N) $, and $ M_{i} $ denotes the average number of bets required until the gambler either goes bankrupt (wealth reaches 0 ) or achieves wealth $ N $. Prove that $ M_{i} $ satisfies the following system of equations:
$
M_{0}=M_{N}=0 ; \\quad M_{i}=1+p M_{i+1}+q M_{i-1}, \\quad \\text { for } i=1, \\ldots, N-1
$

> Solve the above system of equations to obtain:
$
M_{i}=\\left\\{\\begin{array}{ll}
i(N-i), & \\text { if } p=\\frac{1}{2} \\\\
\\frac{i}{q-p}-\\frac{N}{q-p} \\frac{1-(q / p)^{i}}{1-(q / p)^{N}}, & \\text { if } p \\neq \\frac{1}{2}
\\end{array}\\right.
$

## Solution 

It is trivial that:$ M_{0}=M_{N}=0 ; \\quad M_{i}=1+p M_{i+1}+q M_{i-1}, \\quad i=1, \\cdots, N-1 $

When $p = \\dfrac{1}{2}$:

$p(M_{i+1}-M_i) - q(M_i - M_{i-1}) = -1 $

Then:

$M_N - M_{N-1} = -\\dfrac{1}{p} -\\dfrac{q}{p^2}-\\cdots-\\dfrac{q^{
N-2}}{p^{N-1}} +\\dfrac{q^{N-1}}{p^{N-1}}M_1= -\\dfrac{1-\\frac{q^{N-1}}{p^{N-1}}}{p-q}+\\dfrac{q^{N-1}}{p^{N-1}}M_1$

Then:

$M_N = \\dfrac{N}{p-q}-\\dfrac{1-\\frac{q^N}{p^N}}{(p-q)(1-\\frac{q}{p})}+\\dfrac{1-\\frac{q^N}{p^N}}{1-\\frac{q}{p}}M_1 = 0 $

Then:

$M_1 = \\dfrac{1}{p-q}-\\dfrac{N}{p(1-\\frac{q^N}{p^N})}$

Therefore:

$M_i =  \\frac{i}{q-P}-\\frac{N}{q-P} \\frac{1-(q / p)^{i}}{1-(q / p)^{N}}$

When $p=\\dfrac{1}{2}$:

$M_N - M_{N-1} = -2(N-1)+M_1$

Then:

$M_N = -N(N-1)+(N-1)M_1 = 0$

Then:

$M_1 = \\dfrac{1}{N}$

Then:

$M_i = i(N-i)$

Therefore:

$ M_{i}=\\left\\{\\begin{array}{ll}i(N-i), & \\text { if } P=\\frac{1}{2} \\\\ \\frac{i}{q-P}-\\frac{N}{q-P} \\frac{1-(q / p)^{i}}{1-(q / p)^{N}}, & \\text { if } P \\neq \\frac{1}{2}\\end{array}\\right. $


## Problem 61

> Suppose in the gambler's ruin problem, the probability of winning a round depends on the gambler's current wealth. Specifically, let $ \\alpha_{i} $ be the probability that the gambler wins a round when his wealth is $ i $. Given that the gambler's initial wealth is $ i $, let $ P(i) $ denote the probability that the gambler's wealth reaches $ N $ before reaching 0 .
> 
> (a) Derive a formula relating $ P(i) $ to $ P(i-1) $ and $ P(i+1) $.
> 
> (b) Using the same method as in the gambler's ruin problem, solve the equation for $ P(i) $ from part (a).
> 
> (c) Suppose there are initially $ i $ balls in jar 1 and $ N-i $ balls in jar 2, and each time a ball is randomly selected from the $ N $ balls and moved to the other jar. Find the probability that jar 1 becomes empty before jar 2.

## Solution (a)

$ P(i)=\\alpha_{i} P(i+1)+\\left(1-\\alpha_{i}\\right) P(i-1) $

## Solution (b)

We omit the steps:

$ P(i)=\\frac{\\sum_{j=1}^{i}(-1)^{j-1} \\prod_{k=1}^{j-1} \\frac{1-\\alpha_{k}}{\\alpha_{k}}}{\\sum_{j=1}^{N}(-1)^{j-1} \\prod_{k=1}^{j-1} \\frac{1-\\alpha_{k}}{\\alpha_{k}}} $

## Solution (c)

$\\alpha _i = \\dfrac{i}{N}$, then:

$ \\frac{\\sum_{j=i+1}^{N}(j-1)!(N-j)!}{\\sum_{j=1}^{N}(j-1)!(N-j)!} $

placeholder



placeholder

placeholder

placeholder`,__vite_glob_0_71=`---
title: Stochastic Progress - Week 4
category: Notes
---

# Markov Chain

## Definition 

1. $\\{X_n\\}$ finite

2. $ \\begin{array}{l}P\\left\\{X_{n+1}=j \\mid X_{n}=i, X_{n-1}=i_{n-1}, \\ldots X_{0}=i_{0}\\right\\} \\\\ =P\\left\\{X_{n+1}=j \\mid X_{n}=i\\right\\}=P_{i j},\\end{array} $
3. $a_i = P\\{X_0 = i\\}, i\\ge 0$

## Propositions

1. $$\\begin{array}{l}P\\left\\{X_{n+1}=j \\mid X_{s}=i, X_{s-1}=i_{s-1}, \\ldots X_{0}=i_{0}\\right\\} \\\\ =P\\left\\{X_{n+1}=j \\mid X_{s}=i\\right\\} \\quad \\forall j, i, i_{s-1} \\ldots i_{0}\\end{array} $$ (Notice the condition is $s$ rather than $n$)

# C-K Equation

$ P_{i j}^{n+m}=\\sum_{k=0}^{\\infty} P_{i k}^{n} P_{k j}^{m}, \\quad \\forall n, m \\geq 0, \\forall i, j $

## Example

Calculate $P(X_k\\in A,\\exists k\\in [m]|X_0 = i)$

Solution:

Let $T_A = \\min\\{n\\ge 1, X_n\\in A\\}$

be the "First arrive time"

Then:

$$
\\begin{array}{l}
P(T_A \\le m)\\\\ 
= 1 - P(T_A > m)\\\\ 
= 1- P(X_j\\notin A, \\forall j \\in [m])
= 1 - \\sum_j Q_{ij}^m
\\end{array}
$$

- $Q = P_{S\\setminus A}$








`,__vite_glob_0_72=`---
title: Stochastic Progress - Assignment - Week 4
category: Assignments
---

# 6

## Problem

> In Example 5.3, if clerk % i % serves at an exponential rate % \\lambda_{i}, i=1,2 %, prove that
$$
\\mathrm{P}\\{\\text { Smith is not the last one }\\}=\\left(\\dfrac{\\lambda_{1}}{\\lambda_{1}+\\lambda_{2}}\\right)^{2}+\\left(\\dfrac{\\lambda_{2}}{\\lambda_{1}+\\lambda_{2}}\\right)^{2}
$$

## Proof 

Given the independent increment, The probability is:

$P(X_1<X_2)\\cdot P(X_1<X_2) + P(X_1>X_2)\\cdot P(X_1>X_2)$

$ = \\left(\\dfrac{\\lambda_{1}}{\\lambda_{1}+\\lambda_{2}}\\right)^{2}+\\left(\\dfrac{\\lambda_{2}}{\\lambda_{1}+\\lambda_{2}}\\right)^{2}$

---

# 9

## Problem 

> Machine 1 is currently working, and Machine 2 will start working % t % time units from now. If the lifetime of machine % i % follows an exponential distribution with rate % \\lambda_{i}(i=1,2) %, what is the probability that Machine 1 fails before Machine 2?

## Solution

The probability is:

$1 - P(X_1>t)P(X_1>X_2)$

$= 1 - e^{-\\lambda_1t} \\dfrac{\\lambda_2}{\\lambda_1+\\lambda_2}$

--- 

# 16

## Problem 

> There are three jobs to be processed. The processing time of job % i(i=1,2,3) % is an exponential random variable with rate % \\mu_{i} %. There are two available processors, so two jobs can be processed immediately, and the third job starts when one of the initial two finishes.
(a) Let % T_{i} % denote the completion time of job % i %. If the goal is to minimize % \\mathrm{E}\\left[T_{1}+T_{2}+T_{3}\\right] %, which two jobs should be processed first when % \\mu_{1}<\\mu_{2}<\\mu_{3} % ?
(b) Let % M % (called the makespan) be the total time until all three jobs are completed. Let % S % be the time when only one processor is working. Prove that:
$$
2 \\mathrm{E}[M]=\\mathrm{E}[S]+\\sum_{i=1}^{3} \\dfrac{1}{\\mu_{i}}
$$
For the following parts, assume % \\mu_{1}=\\mu_{2}=\\mu, \\mu_{3}=\\lambda %. Let % P(\\mu) % denote the probability that the last job to finish is either job 1 or job 2, and let % P(\\lambda)=1-P(\\mu) % denote the probability that the last job to finish is job 3.
(c) Express % \\mathrm{E}[S] % in terms of % P(\\mu) % and % P(\\lambda) %.
Let % P_{i, j}(\\mu) % be the value of % P(\\mu) % when jobs % i % and % j % are processed first.
(d) Prove that % P_{1,2}(\\mu) \\leq P_{1,3}(\\mu) %.
(e) If % \\mu>\\lambda %, show that % \\mathrm{E}[M] % is minimized when job 3 is one of the first two jobs to be processed.
(f) If % \\mu<\\lambda %, show that % \\mathrm{E}[M] % is minimized when jobs 1 and 2 are processed first.

## Solution (a)

$$
\\begin{array}{l}
E[T_1+T_2+T_3]\\\\ 
= E[\\min(X,Y) + \\max(X,Y) + (\\min(X,Y) + E[Z])] \\\\ 
= E[X+Y+Z] + E[\\min(X, Y)]
\\end{array}
$$

Therefore choose the job $2, 3$

## Solution (b)

Denote the time where each job finish as $T_{(1)}, T_{(2)}, T_{(3)}$, then, the total working time gives us:

$X+Y+Z = M + T_{(2)} = 2M - S$

Then apply the expectation:

$2E[M] = E[S] + \\sum_{i=1}^3\\dfrac{1}{\\mu_i}$

## Solution (c)

$ E[S]=P\\left(M=T_{1}\\right) \\dfrac{1}{\\mu}+P\\left(M=T_{2}\\right) \\dfrac{1}{\\mu}+P\\left(M=T_{3}\\right) \\dfrac{1}{\\lambda}=\\dfrac{P\\left(M=T_{1}\\right)+P\\left(M=T_{2}\\right)}{\\mu}+\\dfrac{P\\left(M=T_{3}\\right)}{\\lambda}=\\dfrac{P(\\mu)}{\\mu}+\\dfrac{P(\\lambda)}{\\lambda} $.

## Solution (d)

$P_{1,2}(\\mu) = P(Y>Z) = \\dfrac{\\lambda}{\\lambda+\\mu}$

$P_{1,3}(\\mu) = 1 - \\left(\\dfrac{\\mu}{\\mu+\\lambda}\\right)^2$

Then:

$P_{1,3}(\\mu)-P_{1,2}(\\mu) = \\dfrac{\\lambda\\mu}{(\\lambda+\\mu)^2}\\ge 0$

## Solution (e)

We need minimize $E[S]$, notice $\\mu>\\lambda$, then we need maximize $P(\\mu)$ (from (c)), then $P_{1,3}(\\mu)$ is larger.

## Solution (f)

Similarly, we need minimize $P(\\mu)$, then $P_{1, 2}(\\mu)$ is smaller

# 31

## Problem

> A doctor has two scheduled appointments, one at 1:00 PM and another at 1:30 PM. The appointment durations are independent exponential random variables with a mean of 30 minutes. Assuming both patients arrive on time, find the expected time that the patient with the 1:30 PM appointment spends in the doctor's office.

## Solution 

$E[T] = P(X>30)(E[X]+E[Y]) +P(X<30)E[Y] = 60e^{-1} + 30(1-e^{-1}) = 30 + 30e^{-1}$

# 36

## Problem

> Let $ S(t) $ denote the price of a security at time $ t $. A popular model for the process $ \\{S(t), t \\geq 0\\} $ assumes that the price remains constant until a "shock" occurs, at which point the price is multiplied by a random factor. If we let $ N(t) $ denote the number of shocks up to time $ t $, and $ X_{i} $ denote the multiplicative factor of the $ i $-th shock, then this model assumes:
$$
S(t)=S(0) \\prod_{i=1}^{N(t)} X_{i}
$$
where $ \\prod_{i=1}^{N(t)} X_{i}=1 $ when $ N(t)=0 $. Assume that:
> - The $ X_{i} $ are independent exponential random variables with rate $ \\mu $.
> - $ \\{N(t), t \\geq 0\\} $ is a Poisson process with rate $ \\lambda $.
> - $ \\{N(t), t \\geq 0\\} $ is independent of the $ X_{i} $.
> - $ S(0)=s $.
(a) Find $ \\mathrm{E}[S(t)] $.
(b) Find $ \\mathrm{E}\\left[S^{2}(t)\\right] $.

## Solution (a)

$$
\\begin{array}{l}
E[S(t)] \\\\ 
= S(0)E[\\prod_{i=1}^{N(t)}X_i] \\\\ 
= S(0)E[E[\\prod_{i=1}^{N(t)}X_i]|N(t)] \\\\ 
= S(0)E[\\dfrac{1}{\\mu^{N(t)}}|N(t)] \\\\
= =s \\exp \\left(-\\lambda t\\left(1-\\dfrac{1}{\\mu}\\right)\\right) \\\\
\\end{array}
$$

## Solution (b)

Similarly:

$$
\\begin{array}{l}
E[S^2(t)] = s^2  \\exp \\left(-\\lambda t\\left(1-\\dfrac{2}{\\mu^2}\\right)\\right) 
\\end{array}
$$

# 38

## Problem

> Let $ \\left\\{M_{i}(t), t \\geq 0\\right\\}(i=1,2,3) $ be independent Poisson processes with rates $ \\lambda_{i}(i=1,2,3) $, and define:
$$
N_{1}(t)=M_{1}(t)+M_{2}(t), \\quad N_{2}(t)=M_{2}(t)+M_{3}(t)
$$

The stochastic process $ \\left\\{\\left(N_{1}(t), N_{2}(t)\\right), t \\geq 0\\right\\} $ is called a bivariate Poisson process.
(a) Find $ \\mathrm{P}\\left\\{N_{1}(t)=n, N_{2}(t)=m\\right\\} $.
(b) Find $ \\operatorname{Cov}\\left(N_{1}(t), N_{2}(t)\\right) $.

## Solution (a)

$$
\\begin{array}{l }
P(N_1(t)=n,N_2(t)=m)\\\\ 
= \\sum_{i=0}^{\\min(m,n)}P(M_1(t)=n-i,M_2(t)=i,M_3(t)=m-i)\\\\ 
=\\sum_{i=0}^{\\min(m,n)}\\dfrac{(\\lambda_1t)^{n-i}e^{-\\lambda_1 t}}{(n-i)!}\\dfrac{(\\lambda_2t)^{i}e^{-\\lambda_2 t}}{i!}\\dfrac{(\\lambda_3t)^{m-i}e^{-\\lambda_3 t}}{(m-i)!}\\\\ 
=\\sum_{i=0}^{\\min(m,n)}\\dfrac{\\lambda_1^n\\lambda_3^nt^{m+n}e^{-(\\lambda_1+\\lambda_2+\\lambda_3)t}}{n!m!}\\dfrac{i!(m\\cdots(m-i+1))(n\\cdots(n-i+1))\\lambda_2^i}{(\\lambda_1\\lambda_3 t)^i}
\\end{array}
$$

## Solution (b)

$$
\\begin{array}{l }
Cov(N_1(t),N_2(t))\\\\ 
= Cov(M_1(t)+M_2(t),M_2(t)+M_3(t))\\\\ 
= E[M_2^2(t)]- (E[M_2(t)])^2\\\\ 
= Var[M_2^2(t)]\\\\ 
=\\lambda_2 t
\\end{array}
$$

# 40

## Problem

> Prove that if $ \\left\\{N_{1}(t), t \\geq 0\\right\\} $ and $ \\left\\{N_{2}(t), t \\geq 0\\right\\} $ are independent Poisson processes with rates $ \\lambda_{1} $ and $ \\lambda_{2} $, respectively, then $ \\{N(t), t \\geq 0\\} $ is a Poisson process with rate $ \\lambda_{1}+\\lambda_{2} $, where $ N(t)= $ $ N_{1}(t)+N_{2}(t) $.

## Solution 

$N(0) = 0$


$ N\\left(t_{i}\\right)-N\\left(t_{i-1}\\right)=\\left[N_{1}\\left(t_{i}\\right)-N_{1}\\left(t_{i-1}\\right)\\right]+\\left[N_{2}\\left(t_{i}\\right)-N_{2}\\left(t_{i-1}\\right)\\right] $ is independent 

$ N(t+s)-N(s)=\\left[N_{1}(t+s)-N_{1}(s)\\right]+\\left[N_{2}(t+s)-N_{2}(s)\\right] $ is poission distributed.

Therefore, $ N(t+s)-N(s) \\sim $ Poisson $ \\left(\\left(\\lambda_{1}+\\lambda_{2}\\right) t\\right) $.

# 42

## Problem

> Let $ \\{N(t), t \\geq 0\\} $ be a Poisson process with rate $ \\lambda $. Let $ S_{n} $ denote the time of the $ n $-th event. Find:
(a) $ \\mathrm{E}\\left[S_{4}\\right] $,
(b) $ \\mathrm{E}\\left[S_{4} \\mid N(1)=2\\right] $,
(c) $ \\mathrm{E}[N(4)-N(2) \\mid N(1)=3] $.

## Solution (a)

$E[S_4] = \\dfrac{4}{\\lambda}$

## Solution (b)

$1+\\dfrac{2}{\\lambda}$

## Solution (c)

$2\\lambda$

# 49

## Problem 

> Events occur according to a Poisson process with rate $ \\lambda $. At each event occurrence time, we must decide whether to continue or stop, with the goal of stopping at the last event time before a fixed time $ T $, where $ T>1 / \\lambda $. Specifically:
> - If an event occurs at time $ t(0 \\leq t \\leq T) $ and we decide to stop, we win if no additional events occur in $ (t, T] $, otherwise we lose.
> - If we choose not to stop at an event and no additional events occur before $ T $, we lose.
> - If no events occur before T, we lose.

> Consider the strategy of stopping at the first event that occurs after a fixed time $ s(0 \\leq s \\leq T) $.
(a) What is the probability of winning when using this strategy?
(b) What value of $ s $ maximizes the winning probability?
(c) Show that when using the optimal $ s $ from (b), the winning probability is $ 1 / e $.

## Solution (a)

Only one event occurs in $ (s, T] $, so the probability of winning is:

$\\lambda(T-s)e^{-\\lambda(T-S)}$

## Solution (b)

$ \\lambda(T-s)=1 \\Longrightarrow s=T-\\dfrac{1}{\\lambda} $.

## Solution (c)

$ P(\\operatorname{win})=\\lambda\\left(T-\\left(T-\\dfrac{1}{\\lambda}\\right)\\right) e^{-\\lambda\\left(T-\\left(T-\\dfrac{1}{\\lambda}\\right)\\right)}=\\lambda\\left(\\dfrac{1}{\\lambda}\\right) e^{-\\lambda\\left(\\dfrac{1}{\\lambda}\\right)}=1 \\cdot e^{-1}=\\dfrac{1}{e} $.

# 50    

## Problem 

> The time between consecutive train arrivals is uniformly distributed over $ (0,1) $ hours. Passengers arrive according to a Poisson process with a rate of 7 per hour. Suppose a train has just departed.
Let $ X $ be the number of passengers who board the next train. Find:
(a) $ \\mathrm{E}[X] $,
(b) $ \\operatorname{Var}(X) $.

## Solution (a)

$$
\\begin{array}{l }
E[X] \\\\ 
= E[E[X|T]]\\\\ 
= E[\\lambda T]
= \\dfrac{\\lambda}{2}\\\\ 
= 3.5
\\end{array}
$$

## Solution (b)

$$
\\begin{array}{l }
Var(X) \\\\ 
= Var(E(X|T)) + E(Var(X|T))\\\\ 
= Var(\\lambda T) + E(\\lambda T)\\\\ 
= \\dfrac{\\lambda^2}{12} +\\dfrac{7}{2}\\\\ 
= \\dfrac{91}{12} 
\\end{array}
$$

# 52

## Problem 

> Team 1 and Team 2 are playing a match. The teams score according to independent Poisson processes with rates $ \\lambda_{1} $ and $ \\lambda_{2} $, respectively. The match stops when one team leads by $ k $ points. Find the probability that Team 1 wins.

## Solution 

$ P_{0}=\\dfrac{\\left(\\dfrac{\\lambda_{1}}{\\lambda_{2}}\\right)^{k}}{1+\\left(\\dfrac{\\lambda_{1}}{\\lambda_{2}}\\right)^{k}}=\\dfrac{\\dfrac{\\lambda_{1}^{k}}{\\lambda_{2}^{k}}}{1+\\dfrac{\\lambda_{1}^{k}}{\\lambda_{2}^{k}}}=\\dfrac{\\lambda_{1}^{k}}{\\lambda_{1}^{k}+\\lambda_{2}^{k}} $

# 59

## Problem 

> An insurance company has two types of claims. Let $ N_{i}(t) $ denote the number of type $ i $ claims up to time $ t $, and assume that $ \\left\\{N_{1}(t), t \\geq 0\\right\\} $ and $ \\left\\{N_{2}(t), t \\geq 0\\right\\} $ are independent Poisson processes with rates $ \\lambda_{1}=10 $ and $ \\lambda_{2}=1 $. The successive claim amounts for type 1 are independent exponential random variables with a mean of \\$1000, while those for type 2 are independent exponential random variables with a mean of $ \\$ 5000 $. Given that a claim of $ \\$ 4000 $ has just arrived, what is the probability that it is a type 1 claim?

## Solution 

$ P( $ Type $ 1 \\mid X=4000)=\\dfrac{P(\\text { Type } 1) \\cdot f_{X_{1}}(4000)}{P(\\text { Type } 1) \\cdot f_{X_{1}}(4000)+P(\\text { Type } 2) \\cdot f_{X_{2}}(4000)} $

$=\\dfrac{\\dfrac{10}{11000} e^{-4}}{\\dfrac{10}{11000} e^{-4}+\\dfrac{1}{55000} e^{-0.8}}=\\dfrac{e^{-4}}{e^{-4}+\\dfrac{1}{5} e^{-0.8}}$

# 60

## Problem

> Customers enter a bank according to a Poisson process with rate $ \\lambda $. Suppose two customers arrive in the first hour. What are the probabilities of the following events?
(a) Both customers arrive in the first 20 minutes.
(b) At least one customer arrives in the first 20 minutes.

## Solution (a)

$ P\\left(T_{1} \\leq \\dfrac{1}{3}, T_{2} \\leq \\dfrac{1}{3}\\right)=P\\left(T_{1} \\leq \\dfrac{1}{3}\\right) \\cdot P\\left(T_{2} \\leq \\dfrac{1}{3}\\right)=\\left(\\dfrac{1}{3}\\right)^{2}=\\dfrac{1}{9} $.

## Solution (b)

$ P( $ At least one $ )=1-\\left(\\dfrac{2}{3}\\right)^{2}=1-\\dfrac{4}{9}=\\dfrac{5}{9} $.

# 64

## Problem 

> Assume people arrive at a bus stop according to a Poisson process with rate $ \\lambda $. The bus departs at time $ t $. Let $ X $ denote the total waiting time of all people boarding the bus by time $ t $. We want to determine $ \\operatorname{Var}(X) $. Let $ N(t) $ be the number of people who arrived by time $ t $.
(a) What is $ \\mathrm{E}[X \\mid N(t)] $ ?
(b) Argue that $ \\operatorname{Var}(X \\mid N(t))=N(t) t^{2} / 12 $.
(c) What is $ \\operatorname{Var}(X) $ ?

## Solution (a)

$ \\mathrm{E}[X \\mid N(t)=n]=\\sum_{i=1}^{n} \\mathrm{E}\\left[t-T_{i}\\right]=n\\left(t-\\mathrm{E}\\left[T_{i}\\right]\\right)=n\\left(t-\\dfrac{t}{2}\\right)=\\dfrac{n t}{2} $.

## Solution (b)

$ \\operatorname{Var}(X \\mid N(t)=n)=\\sum_{i=1}^{n} \\operatorname{Var}\\left(t-T_{i}\\right)=n \\cdot \\operatorname{Var}\\left(T_{i}\\right)=n \\cdot \\dfrac{t^{2}}{12}=\\dfrac{n t^{2}}{12} $.

## Solution (c)

$ \\operatorname{Var}(X)=\\mathrm{E}[\\operatorname{Var}(X \\mid N(t))]+\\operatorname{Var}(\\mathrm{E}[X \\mid N(t)]) $

Then:

$ \\begin{array}{c}\\mathrm{E}[\\operatorname{Var}(X \\mid N(t))]=\\mathrm{E}\\left[\\dfrac{N(t) t^{2}}{12}\\right]=\\dfrac{t^{2}}{12} \\mathrm{E}[N(t)]=\\dfrac{t^{2}}{12} \\lambda t=\\dfrac{\\lambda t^{3}}{12} . \\\\ \\operatorname{Var}(\\mathrm{E}[X \\mid N(t)])=\\operatorname{Var}\\left(\\dfrac{N(t) t}{2}\\right)=\\dfrac{t^{2}}{4} \\operatorname{Var}(N(t))=\\dfrac{t^{2}}{4} \\lambda t=\\dfrac{\\lambda t^{3}}{4} .\\end{array} $

Then:

$ \\operatorname{Var}(X)=\\dfrac{\\lambda t^{3}}{12}+\\dfrac{\\lambda t^{3}}{4}=\\dfrac{\\lambda t^{3}}{3} $.

# 67

## Problem 

> Satellites are launched into space according to a Poisson process with rate $ \\lambda $. Each satellite remains in space for a random time (with distribution $ G $ ) before landing. Find the probability that at time $ t $, there are no satellites in space that were launched before time $ s $, where $ s<t $.

## Solution 

$ P(L>t-u)=1-G(t-u) $.

$ \\lambda \\int_{0}^{s} P(L>t-u) d u=\\lambda \\int_{0}^{s}(1-G(t-u)) d u $

$ P( $ None survive $ )=\\exp \\left(-\\lambda \\int_{t-s}^{t}(1-G(v)) d v\\right) $

# 78

## Problem 

> A store opens at 8:00 AM. Customers arrive according to the following Poisson process rates:
> - From 8:00 AM to 10:00 AM: 4 customers per hour.
> - From 10:00 AM to 12:00 PM: 8 customers per hour.
> - From 12:00 PM to 2:00 PM: The arrival rate increases linearly from 8 to 10 customers per hour.
> - From 2:00 PM to 5:00 PM: The arrival rate decreases linearly from 10 to 4 customers per hour.
> Determine the distribution of the total number of customers entering the store on a given day.

## Solution

$ N \\sim $ Poisson $ (8+16+18+21=63) $.

# 79

## Problem 

> Suppose events occur according to a nonhomogeneous Poisson process with intensity function $ \\lambda(t) $ , $ t>0 $. Further assume that an event occurring at time $ s $ is a type 1 event with probability $ p(s) $, $ s>0 $. If $ N_{1}(t) $ is the number of type 1 events that occur by time $ t $, what type of process is $ \\left\\{N_{1}(t), t \\geq 0\\right\\} ? $

## Solution 

Independent Increments

$ N_{1}(t)-N_{1}(s) $ is poission with mean: $ \\int_{s}^{t} p(u) \\lambda(u) d u $

Then: it's a nonhomogeneous poission process 

# 83

## Problem 

> Suppose $ \\left\\{N_{0}(t), t \\geq 0\\right\\} $ is a Poisson process with rate $ \\lambda=1 $. Let $ \\lambda(t) $ be a nonnegative function of $ t $, and define:
$$
m(t)=\\int_{0}^{t} \\lambda(s) d s
$$
Define $ N(t)=N_{0}(m(t)) $. Show that $ \\{N(t), t \\geq 0\\} $ is a nonhomogeneous Poisson process with intensity function $ \\lambda(t)(t \\geq 0) $.

## Solution

$ N(0)=N_{0}(m(0))=N_{0}(0)=0 $.

$ N\\left(t_{i}\\right)-N\\left(t_{i-1}\\right)=N_{0}\\left(m\\left(t_{i}\\right)\\right)-N_{0}\\left(m\\left(t_{i-1}\\right)\\right) $ are independent.

$ N_{0}(m(t))-N_{0}(m(s)) \\sim $ Poisson $ (m(t)-m(s)) = $Poisson$  \\left(\\int_{s}^{t} \\lambda(u) d u\\right) $

# 86

> In good years, storms occur according to a Poisson process with rate 3 per unit time, while in other years, they occur at rate 5 per unit time. Suppose the probability that next year is a good year is 0.3 . Let $ N(t) $ denote the number of storms in the first $ t $ units of time next year.
(a) Find $ \\mathrm{P}\\{N(t)=n\\} $.
(b) Is $ \\{N(t), t \\geq 0\\} $ a Poisson process?
(c) Does $ \\{N(t), t \\geq 0\\} $ have stationary increments? Why?
(d) Does it have independent increments? Why?
(e) If there are 3 storms by $ t=1 $, what is the conditional probability that it is a good year?

## Solution (a)

$ \\mathrm{P}\\{N(t)=n\\}=0.3 \\cdot \\dfrac{(3 t)^{n} e^{-3 t}}{n!}+0.7 \\cdot \\dfrac{(5 t)^{n} e^{-5 t}}{n!} $

## Solution (b)

No, there's no stationary increment.

## Solution (c)

No, depends on year type 

## Solution (d)

No, it depends on the year type.

## Solution (e)

$ \\mathrm{P}(\\operatorname{Good} \\mid N(1)=3)=\\dfrac{\\mathrm{P}(N(1)=3 \\mid \\text { Good }) \\cdot \\mathrm{P}(\\text { Good })}{\\mathrm{P}(N(1)=3)} =\\dfrac{0.3 \\cdot \\dfrac{27 e^{-3}}{6}}{0.3 \\cdot \\dfrac{27 e^{-3}}{6}+0.7 \\cdot \\dfrac{125 e^{-5}}{6}}=\\dfrac{8.1 e^{-3}}{8.1 e^{-3}+87.5 e^{-5}} $.

# 87

## Problem 

> When $ \\{X(t), t \\geq 0\\} $ is a compound Poisson process, determine:
$$
\\operatorname{Cov}(X(t), X(t+s))
$$

## Solution 

$ \\operatorname{Cov}(X(t), X(t+s))=\\operatorname{Cov}(X(t), X(t)+\\Delta X)=\\operatorname{Var}(X(t))+\\operatorname{Cov}(X(t), \\Delta X) =\\operatorname{Var}(X(t))=\\lambda t \\mathrm{E}\\left[Y^{2}\\right] $

# 88


## Problem

> Customers arrive at an ATM according to a Poisson process with a rate of 12 per hour. The amount withdrawn per transaction is a random variable with a mean of \\$30 and a standard deviation of \\$50 (negative withdrawals represent deposits). The ATM operates for 15 hours each day. Find the approximate probability that the total daily withdrawals are less than $ \\$ 6000 $.

## Solution 

$ \\mathrm{E}[X(t)]=\\lambda t \\mathrm{E}[Y]=12 \\times 15 \\times 30=5400 $

$ \\operatorname{Var}(X(t))=\\lambda t \\mathrm{E}\\left[Y^{2}\\right]=\\lambda t\\left(\\sigma_{Y}^{2}+(\\mathrm{E}[Y])^{2}\\right)=12 \\times 15 \\times\\left(50^{2}+30^{2}\\right)=612,000 $

$ P(X(15)<6000)=P\\left(Z<\\dfrac{6000-5400}{782.30}\\right)=P(Z<0.767)\\approx 0.778 $

`,__vite_glob_0_73=`---
title: Stochastic Progress - Week 5
category: Notes
---

<!-- # Problem

> Denote $N$ as the times needed to get three consecutive Heads when tossing a coin, find $P(N\\le 8)$

## Solution 

Denote $S_i$ as $i$ consecutive Heads happens, then:

$ P=\\left[\\begin{array}{llll}\\frac{1}{2} & \\frac{1}{2} & 0 & 0 \\\\ \\frac{1}{2} & 0 & \\frac{1}{2} & 0 \\\\ \\frac{1}{2} & 0 & 0 & \\frac{1}{2} \\\\ 0 & 0 & 0 & 1\\end{array}\\right] $
 -->

# Classification of states 

## Reachability

$\\exists n\\ge 0 , P_{ij}^n>0$, then $j$ is reachable from $i$

## Communicability

$i$ and $j$ is reachable for each other 

### Property

- Reflexivity: $i$ is communicative to $i$
- Symmetry: $i \\lrArr j$ then $j \\lrarr i$
- Transitivity: $i \\lrArr j,j\\lrArr k$ then $i\\lrArr k$

---

## Transient & Recurrent

Let $f_i$ be the probability start from $i$ and will return to $i$

it is **Transient** if $f_i < 1$

it is **Recurrent** if $f_i = 1$

### Proposition

1. if $i$ is recurrent, then it will be revisit infinite times.
2. if $i$ is transient, then the revisit time $\\sim Ge(\\dfrac{1}{1-f_i})$
3. $i$ is recurrent $\\lrArr$ expectation of revisit time is infinite 
4. finite state markov chain can't be all transient

## Propositions 

### Determine transient / recurrent 

- if $\\sum P_{ii}^n = \\infty$, then $i$ is recurrent 
- if $\\sum P_{ii}^n < \\infty$, then $i$ is transient 

---

- if $i$ is recurrent, $i$ and $j$ is transitive, then $j$ is recurrent 







`,__vite_glob_0_74=`---
title: Stochastic Progress - Assignment - Week 5
category: Assignments
---

# 1

## Problem

> A population of organisms consists of male and female members. In a small population, a specific male may mate with a specific female with probability $ \\lambda h+o(h) $ in any time interval of length $ h $. Each mating immediately produces an offspring that is equally likely to be male or female. Let $ N_{1}(t) $ and $ N_{2}(t) $ denote the number of males and females in the population at time $ t $, respectively. Derive the parameters for the continuous-time Markov chain $ \\left\\{N_{1}(t), N_{2}(t)\\right\\} $, namely the parameters $ v_{i} $ and $ P_{i j} $ from Section 6.2.

## Solution 

$ v_{i}=\\lambda m f \\quad $ if $ m \\geq 1, f \\geq 1 ; \\quad $ otherwise $ v_{i}=0 $.


if $ m, j \\ge 1: $

$ P_{i \\rightarrow(m+1, f)}=\\dfrac{1}{2}, \\quad P_{i \\rightarrow(m, f+1)}=\\dfrac{1}{2}, \\quad P_{i \\rightarrow j}=0 $ for all other $ j $.

else: 

$ P_{i \\rightarrow j}=0 \\quad $ for all $ j \\neq i \\quad $  ,$P_{i \\rightarrow j}=1 $ else.

# 4

## Problem 

> Potential customers arrive at a single-server service station according to a Poisson process with rate $ \\lambda $. However, if an arrival finds that there are already $ n $ people in the system, they will enter the system with probability $ \\alpha_{n} $. Assuming exponential service times with rate $ \\mu $, model this as a birth-and-death process and determine the birth rates and death rates.

## Solution 

Birth rates: $ \\lambda_{n}=\\lambda \\alpha_{n} $ for $ n=0,1,2, \\ldots $
Death rates: $ \\mu_{n}=\\left\\{\\begin{array}{ll}\\mu & \\text { if } n \\geq 1 \\\\ 0 & \\text { if } n=0\\end{array}\\right. $

# 5

## Problem 

> There is a population of $ N $ individuals, some of whom are infected with a certain disease. The spread occurs as follows: contacts between two individuals in the population occur according to a Poisson process with rate $ \\lambda $. Each contact is equally likely to involve any pair of individuals from the $ \\binom{N}{2} $ possible pairs in the population. If a contact involves an infected individual and a susceptible (uninfected) individual, the susceptible individual becomes infected with probability $ p $. Once infected, an individual remains infected forever. Let $ X(t) $ denote the number of infected individuals in the population at time $ t $.
(a) Is $ \\{X(t), t \\geqslant 0\\} $ a continuous-time Markov chain?
(b) Determine its type.
(c) Starting with one infected individual, what is the expected time until all members are infected

## Solution (a)

Yes. 

Index set: $t$, continuous 

State space: $X(t)$ in $ \\{0,1,2, \\ldots, N\\} $, discrete.

It only depend on present state.

$ \\lambda_{k}=\\lambda p \\dfrac{2 k(N-k)}{N(N-1)} $

## Solution (b)

pure birth process

## Solution (c)


$$
\\begin{array}{l}
E[T]\\\\ 
=\\sum_{k=1}^{N-1} E\\left[T_{k}\\right]\\\\ 
=\\sum_{k=1}^{N-1} \\dfrac{1}{\\lambda_{k}} \\\\ 
=\\sum_{k=1}^{N-1} \\dfrac{1}{\\lambda p \\dfrac{2 k(N-k)}{N(N-1)}}\\\\ 
=\\dfrac{N(N-1)}{2 \\lambda p} \\sum_{k=1}^{N-1} \\dfrac{1}{k(N-k)}
\\end{array}
$$.

Where:

$ \\sum_{k=1}^{N-1} \\dfrac{1}{k(N-k)}=\\dfrac{1}{N} \\sum_{k=1}^{N-1}\\left(\\dfrac{1}{k}+\\dfrac{1}{N-k}\\right)=\\dfrac{1}{N}\\left(\\sum_{k=1}^{N-1} \\dfrac{1}{k}+\\sum_{k=1}^{N-1} \\dfrac{1}{N-k}\\right) $.

Then:

$ E[T]=\\dfrac{N(N-1)}{2 \\lambda p} \\cdot \\dfrac{2}{N}\\sum_{m=1}^{N-1} \\dfrac{1}{m} = \\dfrac{N-1}{\\lambda p}\\sum_{m=1}^{N-1} \\dfrac{1}{m}   $

# 7 

## Problem 

> Individuals join a club according to a Poisson process with rate $ \\lambda $. Each new member must pass through $ k $ consecutive stages to become a full member. The time to pass through each stage is an exponential random variable with rate $ \\mu $, and these times are independent. Let $ N_{i}(t) $ denote the number of club members who have exactly passed $ i $ stages at time $ t $, for $ i=1, \\ldots, k-1 $. Furthermore, let $ \\boldsymbol{N}(t)=\\left(N_{1}(t), N_{2}(t), \\ldots, N_{k-1}(t)\\right) $.
(a) Is $ \\{\\boldsymbol{N}(t), t \\geqslant 0\\} $ a continuous-time Markov chain?
(b) If yes, give the infinitesimal transition rates. That is, for any state $ \\boldsymbol{n}=\\left(n_{1}, \\ldots, n_{k-1}\\right) $, specify the possible next states and their infinitesimal rates.

## Solution (a)

Yes 

Index set: $t$, continuous 

State space: $ \\boldsymbol{n}=\\left(n_{1}, n_{2}, \\ldots, n_{k-1}\\right) $, discrete.

It only depend on present state.

## Solution (b)

1. Arrival of a new member (starts at stage 1):
- Next state: $ \\left(n_{1}+1, n_{2}, n_{3}, \\ldots, n_{k-1}\\right) $
- Rate: $ \\lambda $
1. Completion of stage $ i $ by a member (for $ i=1,2, \\ldots, k-2 $ ):
- Next state: $ \\left(n_{1}, \\ldots, n_{i}-1, n_{i+1}+1, \\ldots, n_{k-1}\\right) $
- Rate: $ \\mu \\cdot n_{i} $ (provided $ n_{i}>0 $ )
1. Completion of stage $ k-1 $ by a member (leaves the system):
- Next state: $ \\left(n_{1}, n_{2}, \\ldots, n_{k-2}, n_{k-1}-1\\right) $
- Rate: $ \\mu \\cdot n_{k-1}\\left(\\right. $ provided $ \\left.n_{k-1}>0\\right) $

# 8

## Problem 

Consider two machines, each having an exponential lifetime with mean $ 1 / \\lambda $. There is a repairman who can service a machine at an exponential rate $ \\mu $. Set up the Kolmogorov backward equations; no need to solve them.

## Solution 

$ Q=\\left(\\begin{array}{ccc}-\\mu & \\mu & 0 \\\\ \\lambda & -(\\lambda+\\mu) & \\mu \\\\ 0 & 2 \\lambda & -2 \\lambda\\end{array}\\right) $

1. For $ i=0 $ :
$$
\\dfrac{d}{d t} P_{0 j}(t)=Q_{00} P_{0 j}(t)+Q_{01} P_{1 j}(t)+Q_{02} P_{2 j}(t)=-\\mu P_{0 j}(t)+\\mu P_{1 j}(t)
$$
2. For $ i=1 $ :
$$
\\dfrac{d}{d t} P_{1 j}(t)=Q_{10} P_{0 j}(t)+Q_{11} P_{1 j}(t)+Q_{12} P_{2 j}(t)=\\lambda P_{0 j}(t)-(\\lambda+\\mu) P_{1 j}(t)+\\mu P_{2 j}(t)
$$
3. For $ i=2 $ :
$$
\\dfrac{d}{d t} P_{2 j}(t)=Q_{20} P_{0 j}(t)+Q_{21} P_{1 j}(t)+Q_{22} P_{2 j}(t)=2 \\lambda P_{1 j}(t)-2 \\lambda P_{2 j}(t)
$$

# 11

## Problem 

Consider a Yule process starting with one individual, i.e., assume $ X(0)=1 $. Let $ T_{i} $ denote the time for the process to go from a population size of $ i $ to size $ i+1 $.
(a) Argue that $ T_{i}(i=1, \\ldots, j) $ are independent exponential random variables with rates $ i \\lambda $, respectively.
(b) Let $ X_{1}, \\ldots, X_{j} $ be independent exponential random variables, each with rate $ \\lambda $, and interpret $ X_{i} $ as the lifetime of component $ i $. Argue that $ \\max \\left(X_{1}, \\ldots, X_{j}\\right) $ can be expressed as
$$
\\max \\left(X_{1}, \\ldots, X_{j}\\right)=\\varepsilon_{1}+\\varepsilon_{2}+\\cdots+\\varepsilon_{j}
$$
where $ \\varepsilon_{1}, \\varepsilon_{2}, \\ldots, \\varepsilon_{j} $ are independent exponential random variables with rates $ j \\lambda,(j-1) \\lambda, \\ldots, \\lambda $, respectively.
Hint: Interpret $ \\varepsilon_{i} $ as the time between the $ (i-1) $-th and $ i $-th failure.
(c) Using (a) and (b), argue that
$$
P\\left\\{T_{1}+\\cdots+T_{j} \\leq t\\right\\}=\\left(1-e^{-\\lambda t}\\right)^{j}
$$
(d) Using (c), derive
$$
P_{1 j}(t)=\\left(1-e^{-\\lambda t}\\right)^{j-1}-\\left(1-e^{-\\lambda t}\\right)^{j}=e^{-\\lambda t}\\left(1-e^{-\\lambda t}\\right)^{j-1}
$$

Hence, given $ X(0)=1, X(t) $ has a geometric distribution with parameter $ p=e^{-\\lambda t} $.
(e) Now show that
$$
P_{i j}(t)=\\binom{j-1}{i-1} e^{-\\lambda t i}\\left(1-e^{-\\lambda t}\\right)^{j-i}
$$

## Solution (a)

In a Yule process, each individual gives birth independently at rate $ \\lambda $. When the population size is $ i $, the total birth rate is $ i \\lambda $ (sum of rates from $ i $ independent individuals). Thus, the time $ T_{i} $ to go from size $ i $ to $ i+1 $ is exponentially distributed with rate $ i \\lambda $.
The times $ T_{i} $ are independent because the birth events are memoryless and depend only on the current population size. Given the Markov property, the future evolution is independent of the past, and the inter-event times are independent.
Therefore, $ T_{i} \\sim \\operatorname{Exponential}(i \\lambda) $ for $ i=1, \\ldots, j $, and they are independent.

## Solution (b)

The time to the first failure, $ \\varepsilon_{1} $, is the minimum of $ j $ exponential lifetimes, so $ \\varepsilon_{1} \\sim $ Exponential $ (j \\lambda) $.
After the first failure, $ j-1 $ components remain. The time to the next failure, $ \\varepsilon_{2} $, is exponential with rate $ (j-1) \\lambda $.
Continuing, the time between the $ (k-1) $-th and $ k $-th failure is $ \\varepsilon_{k} \\sim \\operatorname{Exponential}((j-k+ $ 1) $ \\lambda $ ) for $ k=1, \\ldots, j $.

The total time until the last failure is $ M=\\sum_{k=1}^{j} \\varepsilon_{k} $. Due to the memoryless property of the exponential distribution, the inter-failure times $ \\varepsilon_{k} $ are independent.
Thus, $ M=\\varepsilon_{1}+\\varepsilon_{2}+\\cdots+\\varepsilon_{j} $, where $ \\varepsilon_{k} $ are independent with rates $ j \\lambda,(j-1) \\lambda, \\ldots, \\lambda $.

## Solution (c)

From (a), $ \\sum_{i=1}^{j} T_{i} $ is the sum of independent exponential random variables with rates $ \\lambda, 2 \\lambda, \\ldots, j \\lambda $

From (b), $ \\max \\left(X_{1}, \\ldots, X_{j}\\right) $ has the same distribution as $ \\sum_{k=1}^{j} \\varepsilon_{k} $ with rates $ j \\lambda,(j-1) \\lambda, \\ldots, \\lambda $, which is identical to the set of rates $ \\lambda, 2 \\lambda, \\ldots, j \\lambda $ (order does not affect the distribution of the sum).
The CDF of $ \\max \\left(X_{1}, \\ldots, X_{j}\\right) $ is:
$$
P\\left(\\max \\left(X_{1}, \\ldots, X_{j}\\right) \\leq t\\right)=\\prod_{i=1}^{j} P\\left(X_{i} \\leq t\\right)=\\left(1-e^{-\\lambda t}\\right)^{j}, \\quad \\text { since } X_{i} \\sim \\text { Exponential }(\\lambda) .
$$

Therefore,
$$
P\\left\\{\\sum_{i=1}^{j} T_{i} \\leq t\\right\\}=\\left(1-e^{-\\lambda t}\\right)^{j}
$$

## Solution (d)

$ P_{1 j}(t)=P(X(t)=j \\mid X(0)=1) $. In a Yule process, the population size increases monotonically.
- The event $ \\{X(t) \\geq j\\} $ occurs if the time to reach size $ j $ from size 1 is at most $ t $, i.e., $ \\sum_{k=1}^{j-1} T_{k} \\leq t $. From (c),
$$
P(X(t) \\geq j)=P\\left(\\sum_{k=1}^{j-1} T_{k} \\leq t\\right)=\\left(1-e^{-\\lambda t}\\right)^{j-1}
$$
- Similarly,
$$
P(X(t) \\geq j+1)=P\\left(\\sum_{k=1}^{j} T_{k} \\leq t\\right)=\\left(1-e^{-\\lambda t}\\right)^{j}
$$

Thus,
$$
P(X(t)=j)=P(X(t) \\geq j)-P(X(t) \\geq j+1)=\\left(1-e^{-\\lambda t}\\right)^{j-1}-\\left(1-e^{-\\lambda t}\\right)^{j} .
$$

Simplifying,
$$
P_{1 j}(t)=\\left(1-e^{-\\lambda t}\\right)^{j-1}\\left(1-\\left(1-e^{-\\lambda t}\\right)\\right)=e^{-\\lambda t}\\left(1-e^{-\\lambda t}\\right)^{j-1}
$$

This is the probability mass function of a geometric distribution with parameter $ p=e^{-\\lambda t} $, where $ X(t) $ takes values in $ \\{1,2,3, \\ldots\\} $ and
$$
P(X(t)=j)=(1-p)^{j-1} p, \\quad p=e^{-\\lambda t}
$$

## Solution (e)

For initial size $ X(0)=i $, each of the $ i $ initial individuals spawns an independent Yule process. Th size of each subprocess at time $ t $ is geometrically distributed with parameter $ p=e^{-\\lambda t} $, as in (d). $ Y_{k} $ be the size of the $ k $-th subprocess, so:
$$
P\\left(Y_{k}=m\\right)=e^{-\\lambda t}\\left(1-e^{-\\lambda t}\\right)^{m-1}, \\quad m=1,2, \\ldots
$$

The total population size is $ X(t)=\\sum_{k=1}^{i} Y_{k} $. Define $ Z_{k}=Y_{k}-1 $ (number of offspring beyond the initial individual), so $ Z_{k} \\geq 0 $ and:
$$
P\\left(Z_{k}=n\\right)=e^{-\\lambda t}\\left(1-e^{-\\lambda t}\\right)^{n}, \\quad n=0,1,2, \\ldots .
$$

Then $ X(t)=\\sum_{k=1}^{i}\\left(Z_{k}+1\\right)=\\sum_{k=1}^{i} Z_{k}+i $, and $ P(X(t)=j)=P\\left(\\sum_{k=1}^{i} Z_{k}=j-i\\right) $.
The sum of $ i $ i.i.d. geometric random variables (starting at 0 ) follows a negative binomial distribution:
$$
P\\left(\\sum_{k=1}^{i} Z_{k}=m\\right)=\\binom{m+i-1}{i-1} p^{i}(1-p)^{m}, \\quad m=0,1,2, \\ldots
$$

Substitute $ m=j-i $ and $ p=e^{-\\lambda t} $ :
$$
P_{i j}(t)=\\binom{(j-i)+i-1}{i-1} e^{-\\lambda t i}\\left(1-e^{-\\lambda t}\\right)^{j-i}=\\binom{j-1}{i-1} e^{-\\lambda t i}\\left(1-e^{-\\lambda t}\\right)^{j-i}
$$

This holds for $ j \\geq i $ (0 otherwise), and matches (d) when $ i=1 $.

# 13

## Problem 

A barber shop operated by a single barber can accommodate at most two customers. Potential customers arrive according to a Poisson process at a rate of 3 per hour. The service times are independent exponential random variables with a mean of $ 1 / 4 $ hour. Solve the following:
(a) The average number of customers in the shop.
(b) The proportion of potential customers who enter the shop.
(c) If the barber works twice as fast, how much more business will he do?

## Solution (a)

$ \\begin{array}{l}P_{0}=\\dfrac{1-\\rho}{1-\\rho^{3}}, \\quad \\rho=\\dfrac{\\lambda}{\\mu}=\\dfrac{3}{4} \\\\ P_{0}=\\dfrac{1-3 / 4}{1-(3 / 4)^{3}}=\\dfrac{1 / 4}{1-27 / 64}=\\dfrac{1 / 4}{37 / 64}=\\dfrac{16}{37} \\\\ P_{1}=\\rho P_{0}=\\dfrac{3}{4} \\cdot \\dfrac{16}{37}=\\dfrac{12}{37} \\\\ P_{2}=\\rho^{2} P_{0}=\\left(\\dfrac{3}{4}\\right)^{2} \\cdot \\dfrac{16}{37}=\\dfrac{9}{16} \\cdot \\dfrac{16}{37}=\\dfrac{9}{37}\\end{array} $

$ L=0 \\cdot P_{0}+1 \\cdot P_{1}+2 \\cdot P_{2}=0+\\dfrac{12}{37}+2 \\cdot \\dfrac{y}{37}=\\dfrac{12}{37}+\\dfrac{18}{37}=\\dfrac{30}{37} $

## Solution (b)

$ P_{\\text {accept }}=P_{0}+P_{1}=\\dfrac{16}{37}+\\dfrac{12}{37}=\\dfrac{28}{37} $

## Solution (c)

$ \\begin{array}{l}P_{0}^{\\prime}=\\dfrac{1-\\rho^{\\prime}}{1-\\left(\\rho^{\\prime}\\right)^{3}}=\\dfrac{1-3 / 8}{1-(3 / 8)^{3}}=\\dfrac{5 / 8}{1-27 / 512}=\\dfrac{5 / 8}{485 / 512}=\\dfrac{5}{8} \\cdot \\dfrac{512}{485}=\\dfrac{320}{485}=\\dfrac{64}{97} \\\\ P_{1}^{\\prime}=\\rho^{\\prime} P_{0}^{\\prime}=\\dfrac{3}{8} \\cdot \\dfrac{64}{97}=\\dfrac{24}{97} \\\\ P_{2}^{\\prime}=\\left(\\rho^{\\prime}\\right)^{2} P_{0}^{\\prime}=\\left(\\dfrac{3}{8}\\right)^{2} \\cdot \\dfrac{64}{97}=\\dfrac{9}{64} \\cdot \\dfrac{64}{97}=\\dfrac{9}{97}\\end{array} $

$ P_{\\text {accept }}^{\\prime}=P_{0}^{\\prime}+P_{1}^{\\prime}=\\dfrac{64}{97}+\\dfrac{24}{97}=\\dfrac{8 \\gamma}{97} $

- Original: $ \\lambda_{\\text {eff }}^{\\text {old }}=\\lambda\\left(1-P_{2}\\right)=3 \\cdot\\left(1-\\dfrac{9}{37}\\right)=3 \\cdot \\dfrac{28}{37}=\\dfrac{84}{37} $
- New: $ \\lambda_{\\text {eff }}^{\\text {new }}=\\lambda\\left(1-P_{2}^{\\prime}\\right)=3 \\cdot\\left(1-\\dfrac{9}{97}\\right)=3 \\cdot \\dfrac{88}{97}=\\dfrac{264}{97} $

$ \\lambda_{\\text {eff }}^{\\text {new }}-\\lambda_{\\text {eff }}^{\\text {old }}=\\dfrac{264}{97}-\\dfrac{264}{37}=\\dfrac{264 \\times 37-84 \\times 97}{97 \\times 37}=\\dfrac{9 76 8-8 148}{3589}=\\dfrac{1620}{3589} $

# 15

## Problem 

A service center consists of two service lines. Each line serves customers at an exponential rate averaging 2 services per hour. Customers arrive according to a Poisson process with a rate of 3 per hour, and the system capacity is at most 3 customers.
(a) What proportion of potential customers enter the system?
(b) If there is only a single service line, and it is twice as fast (i.e., $ \\mu=4 $ ), what is the value in (a)?

## Solution (a)


$ P_{0}=\\left[\\dfrac{(3 / 2)^{0}}{0!}+\\dfrac{(3 / 2)^{1}}{1!}+\\dfrac{(3 / 2)^{2}}{2!}+\\dfrac{(3 / 2)^{2}}{2!}\\left(\\dfrac{3 / 2}{2}\\right)^{3-2}\\right]^{-1} =\\dfrac{32}{143} $

$ \\begin{array}{l}P_{1}=\\dfrac{3}{2} \\times \\dfrac{32}{143}=\\dfrac{48}{143} \\\\ P_{2}=\\dfrac{(3 / 2)^{2}}{2} \\times \\dfrac{32}{143}=\\dfrac{9 / 4}{2} \\times \\dfrac{32}{143}=\\dfrac{9}{8} \\times \\dfrac{32}{143}=\\dfrac{36}{143} \\\\ P_{3}=\\dfrac{9}{8} \\times \\dfrac{3}{4} \\times \\dfrac{32}{143}=\\dfrac{27}{32} \\times \\dfrac{32}{143}=\\dfrac{27}{143}\\end{array} $

## Solution (b)

$ P_{0}= $$ \\left[1+\\dfrac{3}{4}+\\left(\\dfrac{3}{4}\\right)^{2}+\\left(\\dfrac{3}{4}\\right)^{3}\\right]^{-1}= $$ =\\dfrac{64}{175} $

$ P_{3}=\\left(\\dfrac{3}{4}\\right)^{3} \\times \\dfrac{64}{175}=\\dfrac{27}{64} \\times \\dfrac{64}{175}=\\dfrac{27}{175} $

$ 1-P_{3}=1-27 / 175=148 / 175 $

# 17

## Problem 

Each time a machine is repaired, it remains operational for an exponentially distributed time with rate $ \\lambda $. It then fails, and there are two types of failure. If it is a type I failure, the repair time is exponentially distributed with rate $ \\mu_{1} $. If it is a type II failure, the repair time is exponentially distributed with rate $ \\mu_{2} $. Each failure is independent of the time until failure of the machine. The probability of a type I failure is $ p $, and the probability of a type II failure is $ 1-p $. What is the proportion of time the machine is down due to a type I failure? What is the proportion of time the machine is down due to a type II failure? What is the proportion of time the machine is operational?

## Solution 
$$
Q=\\left[\\begin{array}{ccc}-\\lambda & \\lambda p & \\lambda(1-p) \\\\ \\mu_{1} & -\\mu_{1} & 0 \\\\ \\mu_{2} & 0 & -\\mu_{2}\\end{array}\\right]
$$
The balance equations are:
1. For state $ 0:-\\lambda \\pi_{0}+\\mu_{1} \\pi_{1}+\\mu_{2} \\pi_{2}=0 $
2. For state 1: $ \\lambda p \\pi_{0}-\\mu_{1} \\pi_{1}=0 $
3. For state 2 : $ \\lambda(1-p) \\pi_{0}-\\mu_{2} \\pi_{2}=0 $

Solving these equations:
- From equation 2: $ \\pi_{1}=\\dfrac{\\lambda p}{\\mu_{1}} \\pi_{0} $
- From equation 3: $ \\pi_{2}=\\dfrac{\\lambda(1-p)}{\\mu_{2}} \\pi_{0} $
- Substituting into $ \\pi_{0}+\\pi_{1}+\\pi_{2}=1 $ :
$$
\\begin{array}{l}
\\pi_{0}+\\dfrac{\\lambda p}{\\mu_{1}} \\pi_{0}+\\dfrac{\\lambda(1-p)}{\\mu_{2}} \\pi_{0}=1 \\\\
\\pi_{0}\\left(1+\\dfrac{\\lambda p}{\\mu_{1}}+\\dfrac{\\lambda(1-p)}{\\mu_{2}}\\right)=1
\\end{array}
$$

Let $ D=\\mu_{1} \\mu_{2}+\\lambda p \\mu_{2}+\\lambda(1-p) \\mu_{1} $. Then:
$$
\\begin{array}{l}
\\pi_{0}=\\dfrac{\\mu_{1} \\mu_{2}}{D} \\\\
\\pi_{1}=\\dfrac{\\lambda p}{\\mu_{1}} \\cdot \\dfrac{\\mu_{1} \\mu_{2}}{D}=\\dfrac{\\lambda p \\mu_{2}}{D} \\\\
\\pi_{2}=\\dfrac{\\lambda(1-p)}{\\mu_{2}} \\cdot \\dfrac{\\mu_{1} \\mu_{2}}{D}=\\dfrac{\\lambda(1-p) \\mu_{1}}{D}
\\end{array}
$$

# 18

## Problem 

After being repaired, a machine operates for an exponentially distributed time with rate $ \\lambda $, then fails. Upon failure, the repair process begins. The repair process proceeds sequentially through $ k $ distinct stages. Stage 1 must be completed first, followed by stage 2, and so on. The times to complete these repairs are independent, with stage $ i $ requiring an exponentially distributed time with rate $ \\mu_{i}(i=1, \\cdots, k) $.
(a) What is the proportion of time the machine is undergoing repair at stage $ i $ ?
(b) What is the proportion of time the machine is operational?

## Solution (a) (b)

$ \\begin{aligned} \\pi_{0} & =\\dfrac{1}{1+\\lambda \\sum_{j=1}^{k} \\dfrac{1}{\\mu_{j}}} \\\\ \\pi_{i} & =\\dfrac{\\lambda / \\mu_{i}}{1+\\lambda \\sum_{j=1}^{k} \\dfrac{1}{\\mu_{j}}} \\text { for } i=1, \\ldots, k\\end{aligned} $

# 20

## Problem 

We have two machines: one is working, and the other is a backup. The working machine operates for an exponentially distributed time with rate $ \\lambda $ (mean $ 1 / \\lambda $ ) before failing. When it fails:
- If the backup is in a workable state, it immediately takes over as the working machine.
- The failed machine is sent to the repair shop, where a single repairman fixes it in an exponentially distributed time with rate $ \\mu $ (mean $ 1 / \\mu $ ).
- If the repairman is idle, he starts repairing the failed machine right away.
- If the repairman is busy (repairing another machine), the failed machine waits. Once the repairman finishes, the newly repaired machine starts working, and he begins repairing the waiting machine.

Initially, both machines are in working condition, meaning one is working, and the other is a workable backup. We need to find:
- (a) The expected time until both machines are in the repair shop (i.e., neither is working).
- (b) The variance of that time.
- (c) The long-run proportion of time there is one working machine.

## Solution (a)

1. $ m_{2}=\\dfrac{1}{\\lambda}+m_{1} $
2. $ m_{1}=\\dfrac{1}{\\lambda+\\mu}+\\dfrac{\\mu}{\\lambda+\\mu} m_{2} $

Substitute $ m_{2}=\\dfrac{1}{\\lambda}+m_{1} $ into the second equation:
$$
\\begin{array}{l}
m_{1}=\\dfrac{1}{\\lambda+\\mu}+\\dfrac{\\mu}{\\lambda+\\mu}\\left(\\dfrac{1}{\\lambda}+m_{1}\\right) \\\\
m_{1}=\\dfrac{1}{\\lambda+\\mu}+\\dfrac{\\mu}{\\lambda+\\mu} \\cdot \\dfrac{1}{\\lambda}+\\dfrac{\\mu}{\\lambda+\\mu} m_{1} \\\\
m_{1}-\\dfrac{\\mu}{\\lambda+\\mu} m_{1}=\\dfrac{1}{\\lambda+\\mu}+\\dfrac{\\mu}{\\lambda(\\lambda+\\mu)} \\\\
m_{1}\\left(1-\\dfrac{\\mu}{\\lambda+\\mu}\\right)=\\dfrac{\\lambda+\\mu+\\mu}{\\lambda(\\lambda+\\mu)} \\\\
m_{1} \\cdot \\dfrac{\\lambda}{\\lambda+\\mu}=\\dfrac{\\lambda+2 \\mu}{\\lambda(\\lambda+\\mu)} \\\\
m_{1}=\\dfrac{\\lambda+2 \\mu}{\\lambda(\\lambda+\\mu)} \\cdot \\dfrac{\\lambda+\\mu}{\\lambda}=\\dfrac{\\lambda+2 \\mu}{\\lambda^{2}}
\\end{array}
$$

Wait, let's correct that:
$$
m_{1}=\\dfrac{1}{\\lambda+\\mu}+\\dfrac{\\mu}{\\lambda+\\mu} m_{2}
$$

Substitute $ m_{1}=m_{2}-\\dfrac{1}{\\lambda} $ into the second equation:
$$
\\begin{array}{l}
m_{2}-\\dfrac{1}{\\lambda}=\\dfrac{1}{\\lambda+\\mu}+\\dfrac{\\mu}{\\lambda+\\mu} m_{2} \\\\
m_{2}-\\dfrac{\\mu}{\\lambda+\\mu} m_{2}=\\dfrac{1}{\\lambda}+\\dfrac{1}{\\lambda+\\mu} \\\\
m_{2}\\left(1-\\dfrac{\\mu}{\\lambda+\\mu}\\right)=\\dfrac{\\lambda+\\mu+\\lambda}{\\lambda(\\lambda+\\mu)} \\\\
m_{2} \\cdot \\dfrac{\\lambda}{\\lambda+\\mu}=\\dfrac{2 \\lambda+\\mu}{\\lambda(\\lambda+\\mu)} \\\\
m_{2}=\\dfrac{2 \\lambda+\\mu}{\\lambda(\\lambda+\\mu)} \\cdot \\dfrac{\\lambda+\\mu}{\\lambda}=\\dfrac{2 \\lambda+\\mu}{\\lambda^{2}}
\\end{array}
$$

Then, $ m_{1}=m_{2}-\\dfrac{1}{\\lambda}=\\dfrac{2 \\lambda+\\mu}{\\lambda^{2}}-\\dfrac{1}{\\lambda}=\\dfrac{2 \\lambda+\\mu-\\lambda}{\\lambda^{2}}=\\dfrac{\\lambda+\\mu}{\\lambda^{2}} $.

## Solution (b)

Define $ v_{i}=\\operatorname{Var}\\left(T_{i}\\right) $ and $ w_{i}=E\\left[T_{i}^{2}\\right] $, so $ v_{i}=w_{i}-m_{i}^{2} $. We need $ v_{2} $.
- State 2: $ T_{2}=\\operatorname{Exp}(\\lambda)+T_{1} $, independent.
$$
w_{2}=E\\left[\\operatorname{Exp}(\\lambda)^{2}\\right]+2 E[\\operatorname{Exp}(\\lambda)] m_{1}+w_{1}=\\dfrac{2}{\\lambda^{2}}+\\dfrac{2}{\\lambda} m_{1}+w_{1} .
$$
- State 1: Sojourn time is $ \\operatorname{Exp}(\\lambda+\\mu) $, then:
- To State O (probability $ \\dfrac{\\lambda}{\\lambda+\\mu} $ ): extra time 0 .
- To State 2 (probability $ \\dfrac{\\mu}{\\lambda+\\mu} $ ): extra time $ T_{2} $.
$$
\\begin{array}{l}
w_{1}=E\\left[\\operatorname{Exp}(\\lambda+\\mu)^{2}\\right]+2 E[\\operatorname{Exp}(\\lambda+\\mu)] \\cdot \\dfrac{\\mu}{\\lambda+\\mu} m_{2}+\\dfrac{\\mu}{\\lambda+\\mu} w_{2} \\\\
=\\dfrac{2}{(\\lambda+\\mu)^{2}}+2 \\cdot \\dfrac{1}{\\lambda+\\mu} \\cdot \\dfrac{\\mu}{\\lambda+\\mu} m_{2}+\\dfrac{\\mu}{\\lambda+\\mu} w_{2} \\\\
=\\dfrac{2}{(\\lambda+\\mu)^{2}}+\\dfrac{2 \\mu}{(\\lambda+\\mu)^{2}} m_{2}+\\dfrac{\\mu}{\\lambda+\\mu} w_{2} .
\\end{array}
$$

Using $ m_{1}=\\dfrac{\\lambda+\\mu}{\\lambda^{2}}, m_{2}=\\dfrac{2 \\lambda+\\mu}{\\lambda^{2}} $ :
1. $ w_{2}=\\dfrac{2}{\\lambda^{2}}+\\dfrac{2}{\\lambda} \\cdot \\dfrac{\\lambda+\\mu}{\\lambda^{2}}+w_{1}=\\dfrac{2}{\\lambda^{2}}+\\dfrac{2(\\lambda+\\mu)}{\\lambda^{3}}+w_{1}=\\dfrac{4 \\lambda+2 \\mu}{\\lambda^{3}}+w_{1} $
2. $ w_{1}=\\dfrac{2}{(\\lambda+\\mu)^{2}}+\\dfrac{2 \\mu}{(\\lambda+\\mu)^{2}} \\cdot \\dfrac{2 \\lambda+\\mu}{\\lambda^{2}}+\\dfrac{\\mu}{\\lambda+\\mu} w_{2}=\\dfrac{2}{(\\lambda+\\mu)^{2}}+\\dfrac{2 \\mu(2 \\lambda+\\mu)}{\\lambda^{2}(\\lambda+\\mu)^{2}}+\\dfrac{\\mu}{\\lambda+\\mu} w_{2} $

Let $ a=\\dfrac{2}{(\\lambda+\\mu)^{2}}+\\dfrac{2 \\mu(2 \\lambda+\\mu)}{\\lambda^{2}(\\lambda+\\mu)^{2}}=\\dfrac{2 \\lambda^{2}+2 \\mu(2 \\lambda+\\mu)}{\\lambda^{2}(\\lambda+\\mu)^{2}}=\\dfrac{2(\\lambda+\\mu)^{2}}{\\lambda^{2}(\\lambda+\\mu)^{2}}=\\dfrac{2}{\\lambda^{2}} $,
$$
\\begin{array}{l}
b=\\dfrac{\\mu}{\\lambda+\\mu} \\\\
c=\\dfrac{4 \\lambda+2 \\mu}{\\lambda^{3}}
\\end{array}
$$

Then:
- $ w_{1}=a+b w_{2} $
- $ w_{2}=c+w_{1} $

Then:
- $ w_{1}=a+b w_{2} $
- $ w_{2}=c+w_{1} $

Substitute: $ w_{1}=a+b\\left(c+w_{1}\\right) $
$$
\\begin{array}{l}
w_{1}(1-b)=a+b c \\\\
w_{1}=\\dfrac{a+b c}{1-b} \\\\
w_{2}=c+\\dfrac{a+b c}{1-b}
\\end{array}
$$

Compute:
- $ a+b c=\\dfrac{2}{\\lambda^{2}}+\\dfrac{\\mu}{\\lambda+\\mu} \\cdot \\dfrac{4 \\lambda+2 \\mu}{\\lambda^{3}}=\\dfrac{2}{\\lambda^{2}}+\\dfrac{2 \\mu(2 \\lambda+\\mu)}{\\lambda^{3}(\\lambda+\\mu)} $
- Denominator: $ (\\lambda+\\mu) \\lambda^{3} $
$$
=\\dfrac{2 \\lambda(\\lambda+\\mu)+2 \\mu(2 \\lambda+\\mu)}{\\lambda^{3}(\\lambda+\\mu)}=\\dfrac{2 \\lambda^{2}+6 \\lambda \\mu+2 \\mu^{2}}{\\lambda^{3}(\\lambda+\\mu)}
$$
- $ 1-b=\\dfrac{\\lambda}{\\lambda+\\mu} $
$$
w_{1}=\\dfrac{2 \\lambda^{2}+6 \\lambda \\mu+2 \\mu^{2}}{\\lambda^{3}(\\lambda+\\mu)} \\cdot \\dfrac{\\lambda+\\mu}{\\lambda}=\\dfrac{2\\left(\\lambda^{2}+3 \\lambda \\mu+\\mu^{2}\\right)}{\\lambda^{4}}
$$
- $ w_{2}=\\dfrac{4 \\lambda+2 \\mu}{\\lambda^{3}}+\\dfrac{2\\left(\\lambda^{2}+3 \\lambda \\mu+\\mu^{2}\\right)}{\\lambda^{4}}=\\dfrac{(4 \\lambda+2 \\mu) \\lambda+2\\left(\\lambda^{2}+3 \\lambda \\mu+\\mu^{2}\\right)}{\\lambda^{4}}=\\dfrac{6 \\lambda^{2}+8 \\lambda \\mu+2 \\mu^{2}}{\\lambda^{4}} $

## Solution (c)

- State 2: $ \\lambda \\pi_{2}=\\mu \\pi_{1} \\rightarrow \\pi_{2}=\\dfrac{\\mu}{\\lambda} \\pi_{1} $
- State 0: $ \\mu \\pi_{0}=\\lambda \\pi_{1} \\rightarrow \\pi_{0}=\\dfrac{\\lambda}{\\mu} \\pi_{1} $
- State 1: $ (\\lambda+\\mu) \\pi_{1}=\\lambda \\pi_{2}+\\mu \\pi_{0} $ (checks out when substituted)
- $ \\pi_{2}+\\pi_{1}+\\pi_{0}=1 $
$$
\\begin{array}{l}
\\dfrac{\\mu}{\\lambda} \\pi_{1}+\\pi_{1}+\\dfrac{\\lambda}{\\mu} \\pi_{1}=\\pi_{1}\\left(\\dfrac{\\mu}{\\lambda}+1+\\dfrac{\\lambda}{\\mu}\\right)=1 \\\\
\\dfrac{\\mu^{2}+\\lambda \\mu+\\lambda^{2}}{\\lambda \\mu} \\pi_{1}=1 \\\\
\\pi_{1}=\\dfrac{\\lambda \\mu}{\\lambda^{2}+\\lambda \\mu+\\mu^{2}} \\\\
\\pi_{2}=\\dfrac{\\mu^{2}}{\\lambda^{2}+\\lambda \\mu+\\mu^{2}} \\\\
\\pi_{0}=\\dfrac{\\lambda^{2}}{\\lambda^{2}+\\lambda \\mu+\\mu^{2}}
\\end{array}
$$

Proportion: $ \\pi_{2}+\\pi_{1}=\\dfrac{\\mu^{2}+\\lambda \\mu}{\\lambda^{2}+\\lambda \\mu+\\mu^{2}}=\\dfrac{\\mu(\\mu+\\lambda)}{\\lambda^{2}+\\lambda \\mu+\\mu^{2}} $.
For (c), the proportion is:
$$
\\dfrac{\\mu(\\mu+\\lambda)}{\\lambda^{2}+\\lambda \\mu+\\mu^{2}}
$$

# 23

## Problem 

We have a workshop with 3 machines and 2 repairmen. Each machine works for an exponentially distributed time with a mean of 10 before failing, and the repair time for a machine by a repairman is exponentially distributed with a mean of 8 . We need to determine:
(a) The average number of machines not in use.
(b) The proportion of time both repairmen are busy.

## Solution (a)

$ \\begin{array}{l}\\pi_{1}=\\pi_{0} \\dfrac{\\lambda_{0}}{\\mu_{1}}=\\pi_{0} \\dfrac{3 \\lambda}{\\mu}=\\pi_{0} \\cdot 3 \\rho=\\pi_{0} \\cdot 3 \\cdot 0.8=\\pi_{0} \\cdot \\dfrac{12}{5} \\\\ \\pi_{2}=\\pi_{1} \\dfrac{\\lambda_{1}}{\\mu_{2}}=\\pi_{1} \\dfrac{2 \\lambda}{2 \\mu}=\\pi_{1} \\cdot \\rho=\\pi_{0} \\cdot \\dfrac{12}{5} \\cdot 0.8=\\pi_{0} \\cdot \\dfrac{12}{5} \\cdot \\dfrac{4}{5}=\\pi_{0} \\cdot \\dfrac{48}{25} \\\\ \\pi_{3}=\\pi_{2} \\dfrac{\\lambda_{2}}{\\mu_{3}}=\\pi_{2} \\dfrac{\\lambda}{2 \\mu}=\\pi_{2} \\cdot \\dfrac{\\rho}{2}=\\pi_{0} \\cdot \\dfrac{48}{25} \\cdot \\dfrac{0.8}{2}=\\pi_{0} \\cdot \\dfrac{48}{25} \\cdot 0.4=\\pi_{0} \\cdot \\dfrac{48}{25} \\cdot \\dfrac{2}{5}=\\pi_{0} \\cdot \\dfrac{96}{125}\\end{array} $

$ \\begin{array}{l}E[n]=0 \\cdot \\pi_{0}+1 \\cdot \\pi_{1}+2 \\cdot \\pi_{2}+3 \\cdot \\pi_{3}=\\pi_{1}+2 \\pi_{2}+3 \\pi_{3} \\\\ E[n]=\\dfrac{300}{761}+2 \\cdot \\dfrac{240}{761}+3 \\cdot \\dfrac{96}{761}=\\dfrac{300}{761}+\\dfrac{480}{761}+\\dfrac{288}{761}=\\dfrac{300+480+288}{761}=\\dfrac{1068}{761}\\end{array} $

## Solution (b)

$ \\pi_{2}+\\pi_{3}=\\dfrac{240}{761}+\\dfrac{96}{761}=\\dfrac{240+96}{761}=\\dfrac{336}{761} $

# 24

## Problem 



We're dealing with a scenario where taxis and customers arrive at a station following Poisson processes, with rates of 1 taxi per minute and 2 customers per minute, respectively. Taxis are patient-they'll wait no matter how many pile up-but customers are not; if they arrive and find no taxi, they leave immediately. Our mission is to find:
(a) The average number of taxis waiting.
(b) The proportion of customers who get a taxi.



## Solution (a)

- $ \\pi_{1}=\\dfrac{1}{2} \\pi_{0} $
- $ \\pi_{2}=\\dfrac{1}{2} \\pi_{1}=\\left(\\dfrac{1}{2}\\right)^{2} \\pi_{0} $
- $ \\pi_{3}=\\dfrac{1}{2} \\pi_{2}=\\left(\\dfrac{1}{2}\\right)^{3} \\pi_{0} $

The average number of taxis waiting is the expected value:
$$
E[n]=\\sum_{n=0}^{\\infty} n \\pi_{n}=\\sum_{n=1}^{\\infty} n \\cdot \\dfrac{1}{2^{n+1}}
$$
(Note: when $ n=0 $, the term is 0 , so we start at $ n=1 $.)
Rewrite the sum:
$$
E[n]=\\sum_{n=1}^{\\infty} n \\cdot \\dfrac{1}{2} \\cdot\\left(\\dfrac{1}{2}\\right)^{n}=\\dfrac{1}{2} \\sum_{n=1}^{\\infty} n\\left(\\dfrac{1}{2}\\right)^{n}
$$

For a series $ \\sum_{n=1}^{\\infty} n x^{n} $, where $ |x|<1 $ :
$$
\\sum_{n=1}^{\\infty} n x^{n}=\\dfrac{x}{(1-x)^{2}}
$$

With $ x=\\dfrac{1}{2} $ :
$$
\\sum_{n=1}^{\\infty} n\\left(\\dfrac{1}{2}\\right)^{n}=\\dfrac{\\dfrac{1}{2}}{\\left(1-\\dfrac{1}{2}\\right)^{2}}=\\dfrac{\\dfrac{1}{2}}{\\left(\\dfrac{1}{2}\\right)^{2}}=\\dfrac{\\dfrac{1}{2}}{\\dfrac{1}{4}}=2
$$

So:
$$
E[n]=\\dfrac{1}{2} \\cdot 2=1
$$

## Solution (b)

$ P( $ customer gets a taxi $ )=P(n \\geq 1)=1-P(n=0)=1-\\pi_{0}=1-\\dfrac{1}{2}=\\dfrac{1}{2} $`,__vite_glob_0_75=`---
title: Stochastic Progress - Week 6
category: Notes
---

# Long-run property 

## Eventually reaching probability

$f_{i,j} = P(\\exists n>0, X_n = j|X_0 = i)$

---

$f_{i,j} = \\sum_n f_{ij}^n$
- $f_{i,j}$: Eventually reaching probability
- $f_{ij}$: First reaching probability

## Proposition 

1. if $i $ is recurrent, $i$ and $j $ is transitive, then $f_{i,j} = 1 $

## Positive recurrent & Null recurrent

$N_j = \\min \\{ n > 0| X_n = j\\}$: steps needed for revisit 

$m_j = E[N_j | X_0 = j]$: expectation steps of revisit 

- if $m_j < \\infty$, $j$ is **Positive recurrent**
- if $m_j = \\infty$, $j$ is **Null recurrent**

---

$m_j = E[N_j|X_0 = j] = \\sum_{n=1}^\\infty n f_{jj}^{(n)}$

## Long-run proportion

$\\pi_{j}=\\dfrac{1}{m_{j}}=\\dfrac{1}{E\\left[N_{j} \\mid X_{0}=j\\right]}$

### Theorem

$\\pi_j = \\sum_{i}\\pi_i P_{ij}, j\\ge 1$
where: $\\sum_{j} \\pi_j  = 1$

### Note

that equals to:

$\\pi^T = \\pi^T P$

### Theorem 

$L = \\lambda W$

- $L$: Long-run proportion
- $\\lambda$: flow-in probability
- $W$: average time

-------------------------## Stationary probability

$\\pi_j$: stationary probability

### Example 

> Example 4.25 Assume that the number of new families checking into a hotel each day follows a Poisson distribution with mean $ \\lambda $. Additionally, the number of days a family stays at the hotel is a geometric random variable with parameter $ p \\in(0,1) $ (the checkout probability). All families act independently. Let $ X_{n} $ denote the number of families staying at the hotel on the $ n $-th day. It can be shown that $ \\left\\{X_{n}, n \\geq 0\\right\\} $ is a Markov chain. Find:
> 
> (a) The transition probabilities of the Markov chain.
> 
> (b) $ E\\left[X_{n} \\mid X_{0}=i\\right] $.
> 
> (c) The stationary probabilities of the Markov chain.

### Solution (a)

From $i$ to $j$: remains $k$, comes $j-k$

Number of remain: $B(i, 1-p)$
Number of arrival: $Poi(\\lambda)$

$P_{ij} = \\sum_{k=0}^{\\min(i,j)}\\binom{i}{k}(1-p)^k p^{i-k}\\cdot\\dfrac{e^{-\\lambda }\\lambda^{j-k}}{(j-k)!}$

### Solution (b)

$ E\\left[X_{n+1} \\mid X_{0}=i\\right]=(1-p) E\\left[X_{n} \\mid X_{0}=i\\right]+\\lambda $

Then:

$ E\\left[X_{n} \\mid X_{0}=i\\right]=\\left(i-\\frac{\\lambda}{p}\\right)(1-p)^{n}+\\frac{\\lambda}{p} $.

### Solution (c)

$ \\mu=(1-p) \\mu+\\lambda $

Then we get:

$\\mu = \\dfrac{\\lambda}{p}$

### Example 

> A company has $ r $ types of employees. - A type $ i $ employee transitions to type $ j(j=1, \\ldots, r) $ in the next period with probability $ q_{i j} $, or leaves the company with probability $ 1-\\sum_{j=1}^{r} q_{i j} $. - Each period, new employees of type $ j $ are hired according to independent Poisson processes with mean $ \\lambda_{j} $. - Let $ \\boldsymbol{X}_{n}=\\left(X_{n}(1), \\ldots, X_{n}(r)\\right) $, where $ X_{n}(i) $ is the number of type $ i $ employees at period $ n $. Then $ \\left\\{\\boldsymbol{X}_{n}\\right\\} $ is a Markov chain. Find the stationary probability distribution of this Markov chain.

### Solution 

$ \\mu_{j}=\\sum_{i=1}^{r} \\mu_{i} q_{i j}+\\lambda_{j} \\quad $ for all $ j=1, \\ldots, r $.

## Proposition 

$\\lim _{N \\rightarrow \\infty} \\frac{\\sum_{n=1}^{N} r\\left(X_{n}\\right)}{N}=\\sum_{j=0}^{\\infty} r(j) \\pi_{j}$

## Period of a state

$d$: period, only $d$'s multiple can revisit 

$P_{ii}^n$ divergence



placeholder


placeholder


placeholder


placeholder


placeholder


`,__vite_glob_0_76=`---
title: Stochastic Progress - Assignment - Week 6
category: Assignments
---

# 2

## Problem 

> Assume that the interarrival time distribution of a renewal process is Poisson with mean $ \\mu $. That is, assume
$$
\\mathrm{P}\\left\\{X_{n}=k\\right\\}=\\mathrm{e}^{-\\mu} \\frac{\\mu^{k}}{k!}, \\quad k=0,1, \\cdots
$$
(a) Find the distribution of $ S_{n} $.
(b) Compute $ \\mathrm{P}\\{N(t)=n\\} $.

## Solution (a)

Since $ S_{n}=X_{1}+X_{2}+\\cdots+X_{n} $ is the sum of $ n $ i.i.d. Poisson random variables, each with parameter $ \\mu, S_{n} $ follows a Poisson distribution with parameter $ n \\mu $. Therefore, the probability mass function (PMF) of $ S_{n} $ is:

$ \\mathrm{P}\\left\\{S_{n}=k\\right\\}=e^{-n \\mu} \\frac{(n \\mu)^{k}}{k!}, \\quad k=0,1,2, \\ldots $

## Solution (b)

The event $ \\{N(t)=n\\} $ occurs if and only if the $ n $-th renewal happens by time $ t $ and the $ (n+1) $-th renewal happens after time $ t $, i.e., $ S_{n} \\leq t $ and $ S_{n+1}>t $. This can be expressed as:
$$
\\mathrm{P}\\{N(t)=n\\}=\\mathrm{P}\\left\\{S_{n} \\leq t\\right\\}-\\mathrm{P}\\left\\{S_{n+1} \\leq t\\right\\}
$$
because $ \\left\\{S_{n+1} \\leq t\\right\\} \\subseteq\\left\\{S_{n} \\leq t\\right\\} $ (since $ S_{n+1}=S_{n}+X_{n+1} \\geq S_{n} $ ), and the difference gives the probability that $ S_{n} \\leq t $ but $ S_{n+1}>t $.
- $ S_{n} \\sim \\operatorname{Poisson}(n \\mu) $, so $ \\mathrm{P}\\left\\{S_{n} \\leq t\\right\\}=\\sum_{k=0}^{t} e^{-n \\mu} \\frac{(n \\mu)^{k}}{k!} $.
- $ S_{n+1} \\sim \\operatorname{Poisson}((n+1) \\mu) $, so $ \\mathrm{P}\\left\\{S_{n+1} \\leq t\\right\\}=\\sum_{k=0}^{t} e^{-(n+1) \\mu} \\frac{((n+1) \\mu)^{k}}{k!} $.
$ \\mathrm{P}\\{N(t)=n\\}=\\sum_{k=0}^{t} e^{-n \\mu} \\frac{(n \\mu)^{k}}{k!}-\\sum_{k=0}^{t} e^{-(n+1) \\mu} \\frac{((n+1) \\mu)^{k}}{k!} $

# 4

## Problem 

> Let $ \\left\\{N_{1}(t), t \\geq 0\\right\\} $ and $ \\left\\{N_{2}(t), t \\geq 0\\right\\} $ be independent renewal processes. Let $ N(t)= $ $ N_{1}(t)+N_{2}(t) $.
(a) Are the interarrival times of $ \\{N(t), t \\geq 0\\} $ independent?
(b) Are they identically distributed?
(c) Is $ \\{N(t), t \\geq 0\\} $ a renewal process?

## Solution (a)

No.

## Solution (b)

No.

## Solution (c)

No.

# 5

## Problem 

> Let $ U_{1}, U_{2}, \\cdots $ be independent uniform random variables on $ (0,1) $. Define $ N $ as
$$
N=\\min \\left\\{n: U_{1}+U_{2}+\\cdots+U_{n}>1\\right\\}
$$

> What is $ \\mathrm{E}[N] $ ?

## Solution 


$ P\\left(S_{n} \\leq x\\right)=\\frac{1}{n!} \\sum_{k=0}^{\\lfloor x\\rfloor}(-1)^{k}\\binom{n}{k}(x-k)^{n}, \\quad 0 \\leq x \\leq n $

$ \\mathrm{E}[N]=\\sum_{k=0}^{\\infty} \\mathrm{P}(N>k)=\\sum_{k=0}^{\\infty} \\frac{1}{k!}  = e$.

，6， 8，10，12， 14，17，
18，19，22，26，27

# 6

## Problem 

> Consider a renewal process $ \\{N(t), t \\geqslant 0\\} $ with interarrival times following a $ \\Gamma(r, \\lambda) $ distribution. That is, the interarrival density is
$$
f(x)=\\frac{\\lambda \\mathrm{e}^{-\\lambda x}(\\lambda x)^{r-1}}{(r-1)!}, \\quad x>0
$$
(a) Prove that
$$
\\mathrm{P}\\{N(t) \\geqslant n\\}=\\sum_{i=n r}^{\\infty} \\frac{\\mathrm{e}^{-\\lambda t}(\\lambda t)^{i}}{i!}
$$
(b) Prove that
$$
m(t)=\\sum_{i=r}^{\\infty}\\left\\lfloor\\frac{i}{r}\\right\\rfloor \\frac{\\mathrm{e}^{-\\lambda t}(\\lambda t)^{i}}{i!}
$$
where $ \\lfloor i / r\\rfloor $ is the greatest integer less than or equal to $ i / r $.

## Solution (a)

Recall that $ N(t) \\geqslant n $ if and only if the $ n $-th arrival occurs by time $ t $, i.e., $ S_{n} \\leqslant t $. Since $ S_{n} $ is the time of the $ n r $-th event in the Poisson process $ \\{M(t)\\} $, we have:
$$
\\mathrm{P}\\{N(t) \\geqslant n\\}=\\mathrm{P}\\left\\{S_{n} \\leqslant t\\right\\}=\\mathrm{P}\\{M(t) \\geqslant n r\\}
$$

This is because the $ n r $-th event occurs by time $ t $ if and only if there are at least $ n r $ events in the Poisson process by time $ t $.

The probability $ \\mathrm{P}\\{M(t) \\geqslant n r\\} $ for a Poisson process with rate $ \\lambda $ is given by the tail of the Poisson distribution:
$$
\\mathrm{P}\\{M(t) \\geqslant n r\\}=\\sum_{i=n r}^{\\infty} \\mathrm{P}\\{M(t)=i\\}=\\sum_{i=n r}^{\\infty} \\frac{\\mathrm{e}^{-\\lambda t}(\\lambda t)^{i}}{i!}
$$

Therefore,
$$
\\mathrm{P}\\{N(t) \\geqslant n\\}=\\sum_{i=n r}^{\\infty} \\frac{\\mathrm{e}^{-\\lambda t}(\\lambda t)^{i}}{i!}
$$

## Solution (b)

The renewal function $ m(t) $ is defined as the expected number of renewals by time $ t $, i.e., $ m(t)= $ $ \\mathrm{E}[N(t)] $. From the relationship with the Poisson process, we have $ N(t)=\\left\\lfloor\\frac{M(t)}{r}\\right\\rfloor $. Thus,
$$
m(t)=\\mathrm{E}\\left[\\left\\lfloor\\frac{M(t)}{r}\\right\\rfloor\\right] .
$$

Since $ M(t) $ is a discrete random variable (Poisson with mean $ \\lambda t $ ), the expectation can be computed as:
$$
\\mathrm{E}\\left[\\left\\lfloor\\frac{M(t)}{r}\\right\\rfloor\\right]=\\sum_{k=0}^{\\infty}\\left\\lfloor\\frac{k}{r}\\right\\rfloor \\mathrm{P}\\{M(t)=k\\}=\\sum_{k=0}^{\\infty}\\left\\lfloor\\frac{k}{r}\\right\\rfloor \\frac{\\mathrm{e}^{-\\lambda t}(\\lambda t)^{k}}{k!} .
$$

Note that for $ k<r,\\left\\lfloor\\frac{k}{r}\\right\\rfloor=0 $ because $ 0 \\leq k / r<1 $. Therefore, the sum can start from $ k=r $ :
$$
\\mathrm{E}\\left[\\left\\lfloor\\frac{M(t)}{r}\\right\\rfloor\\right]=\\sum_{k=r}^{\\infty}\\left\\lfloor\\frac{k}{r}\\right\\rfloor \\frac{\\mathrm{e}^{-\\lambda t}(\\lambda t)^{k}}{k!}
$$

Changing the index to $ i $ for consistency with the given expression, we have:
$$
m(t)=\\sum_{i=r}^{\\infty}\\left\\lfloor\\frac{i}{r}\\right\\rfloor \\frac{\\mathrm{e}^{-\\lambda t}(\\lambda t)^{i}}{i!} .
$$

# 8

## Problem 

> Replace a machine when it fails or has been in use for $ T $ years. If the successive lifetimes of the machines are independent, with a common distribution $ F $ having density function $ f $, prove that
(a) The long-run rate at which machines are replaced is
$$
\\left[\\int_{0}^{T} x f(x) d x+T(1-F(T))\\right]^{-1}
$$
(b) The long-run rate at which machines fail is
$$
\\frac{F(T)}{\\int_{0}^{T} x f(x) d x+T[1-F(T)]}
$$

## Solution (a)

We compute $ E[Y]=E[\\min (X, T)] $. For a non-negative random variable, the expectation can be expressed as:
$$
E[Y]=\\int_{0}^{\\infty} P(Y>y) d y
$$

The survival function $ P(Y>y) $ is:
- $ P(Y>y)=P(\\min (X, T)>y)=P(X>y) $ for $ 0 \\leq y<T $, since $ \\min (X, T)>y $ iff $ X>y $ when $ y<T $.
- $ P(Y>y)=0 $ for $ y \\geq T $, because $ Y \\leq T $.

Thus,
$$
P(Y>y)=\\left\\{\\begin{array}{ll}
1-F(y) & \\text { if } 0 \\leq y<T \\\\
0 & \\text { if } y \\geq T
\\end{array}\\right.
$$
and
$$
E[Y]=\\int_{0}^{T}(1-F(y)) d y
$$

We now show that this equals the expression inside the inverse in part (a). Consider:
$$
\\int_{0}^{T} x f(x) d x+T(1-F(T))
$$

Using integration by parts on $ \\int_{0}^{T} x f(x) d x $, let $ u=x $ and $ d v=f(x) d x $. Then $ d u=d x $ and $ v= $ $ F(x) $ (since $ F^{\\prime}(x)=f(x) $ ). Assuming $ F(0)=0 $ (as lifetime is positive), we have:
$$
\\int_{0}^{T} x f(x) d x=[x F(x)]_{0}^{T}-\\int_{0}^{T} F(x) d x=T F(T)-\\int_{0}^{T} F(x) d x
$$

Substitute this into the expression:
$$
=T F(T)-\\int_{0}^{T} F(x) d x+T-T F(T)=T-\\int_{0}^{T} F(x) d x=\\int_{0}^{T}(1-F(x)) d x
$$

Thus,
$$
E[Y]=\\int_{0}^{T}(1-F(y)) d y=\\int_{0}^{T} x f(x) d x+T(1-F(T))
$$

Therefore, the long-run replacement rate is:
$$
\\frac{1}{E[Y]}=\\left[\\int_{0}^{T} x f(x) d x+T(1-F(T))\\right]^{-1}
$$

## Solution (b)

- $ R=1 $ if the replacement is due to failure (i.e., $ X<T $ ).
- $ R=0 $ if the replacement is due to reaching age $ T $ (i.e., $ X \\geq T $ ).

The expected reward per cycle is:
$$
E[R]=P(\\text { failure })=P(X<T)=F(T)
$$

The expected cycle length is $ E[Y] $, as computed in part (a). By the renewal reward theorem, the long-run failure rate (reward per unit time) is:
$$
\\frac{E[R]}{E[Y]}=\\frac{F(T)}{E[Y]}=\\frac{F(T)}{\\int_{0}^{T} x f(x) d x+T[1-F(T)]}
$$

# 10

## Problem 

> Consider a renewal process with mean interarrival time $ \\mu $. Suppose each event of this process is counted with probability $ p $. Let $ N_{C}(t) $ denote the number of counted events up to time $ t(t>0) $.
(a) Is $ \\left\\{N_{C}(t), t \\geqslant 0\\right\\} $ a renewal process?
(b) What is $ \\lim _{t \\rightarrow \\infty} \\frac{N_{G}(t)}{t} $ ?

## Solution (a)

Yes.

- Let $ M_{k} $ be the number of original events between the $ (k-1) $-th and $ k $-th counted event (including the $ k $-th counted event). Since each event is counted independently with probability $ p $, $ M_{k} $ follows a geometric distribution with success probability $ p $, i.e., $ \\mathbb{P}\\left(M_{k}=m\\right)=(1- $ $ p)^{m-1} p $ for $ m=1,2,3, \\ldots $.
- Then $ S_{k}=\\sum_{i=1}^{M_{k}} T_{i}^{(k)} $, where $ \\left\\{T_{i}^{(k)}\\right\\} $ are i.i.d. copies of $ T_{i} $.

Since:
- The sequence $ \\left\\{M_{k}\\right\\}_{k=1}^{\\infty} $ is i.i.d. (geometric with parameter $ p $ ),
- The interarrival times $ \\left\\{T_{i}^{(k)}\\right\\} $ are i.i.d. for each $ k $ and independent of $ \\left\\{M_{k}\\right\\} $,
- And for each $ k, S_{k} $ depends only on $ M_{k} $ and the corresponding $ T_{i}^{(k)} $,

## Solution (b)

From part (a), $ N_{C}(t) $ is a renewal process with i.i.d. interarrival times $ S_{k} $, where $ S_{k}=\\sum_{i=1}^{M_{k}} T_{i} $ and $ M_{k} \\sim \\operatorname{Geometric}(p) $. The expected interarrival time is:
$$
\\mathbb{E}\\left[S_{k}\\right]=\\mathbb{E}\\left[\\sum_{i=1}^{M_{k}} T_{i}\\right] .
$$

Using the law of total expectation and the independence of $ M_{k} $ and $ \\left\\{T_{i}\\right\\} $ :
$$
\\mathbb{E}\\left[S_{k}\\right]=\\mathbb{E}\\left[\\mathbb{E}\\left[\\sum_{i=1}^{M_{k}} T_{i} \\mid M_{k}\\right]\\right]=\\mathbb{E}\\left[\\sum_{i=1}^{M_{k}} \\mathbb{E}\\left[T_{i}\\right]\\right]=\\mathbb{E}\\left[M_{k} \\cdot \\mu\\right]=\\mu \\cdot \\mathbb{E}\\left[M_{k}\\right] .
$$

Since $ M_{k} $ is geometric with success probability $ p, \\mathbb{E}\\left[M_{k}\\right]=\\frac{1}{p} $. Thus,
$$
\\mathbb{E}\\left[S_{k}\\right]=\\mu \\cdot \\frac{1}{p}=\\frac{\\mu}{p}
$$

By the elementary renewal theorem, for a renewal process with finite mean interarrival time $ \\mathbb{E}\\left[S_{k}\\right] $, the long-run rate is:
$$
\\lim _{t \\rightarrow \\infty} \\frac{N_{C}(t)}{t}=\\frac{1}{\\mathbb{E}\\left[S_{k}\\right]}=\\frac{1}{\\mu / p}=\\frac{p}{\\mu} .
$$

# 12

## Problem 

> Events occur according to a Poisson process with rate $ \\lambda $. An event that occurs within time $ d $ after the event immediately preceding it is called a " $ d $-event". For example, if $ d=1 $, and events occur at times $ 2,2.8,4,6,6.6, \\ldots $, then the events at times 2.8 and 6.6 are $ d $-events.
(a) What is the rate at which $ d $-events occur?
(b) What is the proportion of $ d $-events among all events?

## Solution (a)

The overall event occurrence rate is $ \\lambda $. Since each event (after the first) is a $ d $-event with probability $ p=1-e^{-\\lambda d} $ independently, the long-run rate of $ d $-events is:
$$
\\lambda \\times p=\\lambda\\left(1-e^{-\\lambda d}\\right)
$$

This can also be derived by noting that the process of $ d $-events forms a renewal process where the interarrival times between consecutive $ d $-events have a specific distribution. Specifically, the time between consecutive $ d $-events is the sum of a geometric number of exponential interarrival times:
- Let $ N $ be the number of events until the next $ d $-event, including the $ d $-event itself. Then $ N $ follows a geometric distribution with success probability $ p=1-e^{-\\lambda d} $, so $ P(N=k)=(1- $ $ p)^{k-1} p $ for $ k=1,2,3, \\ldots $, and $ E[N]=1 / p $.
- The interarrival time between consecutive $ d $-events is $ W=\\sum_{i=1}^{N} S_{i} $, where $ S_{i} \\sim \\operatorname{Exp}(\\lambda) $. By independence, $ E[W]=E[N] \\cdot E\\left[S_{i}\\right]=(1 / p) \\cdot(1 / \\lambda)=1 /(\\lambda p) $.
- The long-run rate of $ d $-events is $ 1 / E[W]=\\lambda p=\\lambda\\left(1-e^{-\\lambda d}\\right) $.

Thus, the rate at which $ d $-events occur is $ \\lambda\\left(1-e^{-\\lambda d}\\right) $.

## Solution (b)

Let $ N(t) $ be the total number of events up to time $ t $, and $ N_{d}(t) $ be the number of $ d $-events up to time $ t $. The proportion of $ d $-events is $ \\lim _{t \\rightarrow \\infty} \\frac{N_{d}(t)}{N(t)} $.

Excluding the first event (which cannot be a $ d $-event and becomes negligible as $ t \\rightarrow \\infty $ ), we have:
$$
N_{d}(t)=\\sum_{i=2}^{N(t)} I_{i}, \\quad \\text { where } \\quad I_{i}=\\mathbf{1}_{\\left\\{S_{i} \\leq d\\right\\}} .
$$

The indicators $ I_{i} $ are i.i.d. Bernoulli random variables with success probability $ p=1-e^{-\\lambda d} $. As $ t \\rightarrow \\infty, N(t) \\rightarrow \\infty $ almost surely. By the strong law of large numbers:
$$
\\frac{1}{N(t)-1} \\sum_{i=2}^{N(t)} I_{i} \\rightarrow p \\quad \\text { almost surely. }
$$

Since $ \\frac{N(t)-1}{N(t)} \\rightarrow 1 $ as $ t \\rightarrow \\infty $, it follows that:
$$
\\frac{N_{d}(t)}{N(t)}=\\frac{\\sum_{i=2}^{N(t)} I_{i}}{N(t)}=\\frac{\\sum_{i=2}^{N(t)} I_{i}}{N(t)-1} \\cdot \\frac{N(t)-1}{N(t)} \\rightarrow p \\cdot 1=1-e^{-\\lambda d} .
$$

Thus, the long-run proportion of $ d $-events among all events is $ 1-e^{-\\lambda d} $.

# 14

## Problem

Consider the gambler's ruin problem where in each game, the gambler wins 1 yuan with probability $ p $ and loses 1 yuan with probability $ 1-p $. The gambler continues playing until their fortune reaches either $ N-i $ yuan or $ -i $ yuan. (That is, the gambler starts with $ i $ yuan and stops when their fortune reaches 0 or $ N $.) Let $ T $ be the number of games played before the gambler stops. Using Wald's equation and the known probability that the gambler ends up with a fortune of $ N $ (i.e., a net gain of $ N-i) $, find $ \\mathrm{E}[T] $.

## Solution 

$$
\\mathrm{E}\\left[X_{j}\\right]=p \\cdot 1+(1-p) \\cdot(-1)=2 p-1
$$

The gambler starts with an initial fortune of $ i $ yuan. The process stops when the fortune reaches 0 or $ N $, so $ T $ is a stopping time. The total winnings up to time $ T $ is $ \\sum_{j=1}^{T} X_{j}=S_{T}-S_{0} $, where $ S_{0}=i $ is the initial fortune, and $ S_{T} $ is the fortune at stopping time $ T $. Therefore:
$$
\\sum_{j=1}^{T} X_{j}=S_{T}-i
$$

The possible values of $ S_{T} $ are 0 or $ N $, so the possible values of $ \\sum_{j=1}^{T} X_{j} $ are:
- $ 0-i=-i $ (if ruin occurs, fortune reaches 0 ),
- $ N-i $ (if success occurs, fortune reaches $ N $ ).

The expected value of the sum is:
$$
\\mathrm{E}\\left[\\sum_{j=1}^{T} X_{j}\\right]=\\mathrm{E}\\left[S_{T}-i\\right]=\\mathrm{E}\\left[S_{T}\\right]-i
$$

Let $ P_{i} $ be the probability that the gambler reaches fortune $ N $ (i.e., ends with a net gain of $ N-i $ ). Then:
$$
\\mathrm{E}\\left[S_{T}\\right]=P_{i} \\cdot N+\\left(1-P_{i}\\right) \\cdot 0=P_{i} N
$$
so:
$$
\\mathrm{E}\\left[\\sum^{T} X_{j}\\right]=P_{i} N-i
$$

Solving for $ \\mathrm{E}[T] $ :
$$
\\mathrm{E}[T]=\\frac{P_{i} N-i}{2 p-1}
$$

This expression is valid for $ p \\neq \\frac{1}{2} $. When $ p=\\frac{1}{2}, \\mathrm{E}\\left[X_{j}\\right]=2 \\cdot \\frac{1}{2}-1=0 $, and Wald's equation gives:
$$
\\mathrm{E}\\left[\\sum_{j=1}^{T} X_{j}\\right]=0 \\cdot \\mathrm{E}[T]=0
$$
which is consistent since $ P_{i}=\\frac{i}{N} $ (as derived below) and $ P_{i} N-i=\\frac{i}{N} \\cdot N-i=0 $. However, the expression $ \\frac{P_{i} N-i}{2 p-1} $ is undefined when $ p=\\frac{1}{2} $. In this case, the expected time is known to be $ \\mathrm{E}[T]= $ $ i(N-i) $.
Solving for $ \\mathrm{E}[T] $ :
$$
\\mathrm{E}[T]=\\frac{P_{i} N-i}{2 p-1}
$$

This expression is valid for $ p \\neq \\frac{1}{2} $. When $ p=\\frac{1}{2}, \\mathrm{E}\\left[X_{j}\\right]=2 \\cdot \\frac{1}{2}-1=0 $, and Wald's equation gives:
$$
\\mathrm{E}\\left[\\sum_{j=1}^{T} X_{j}\\right]=0 \\cdot \\mathrm{E}[T]=0
$$

The probability $ P_{i} $ that the gambler reaches $ N $ before 0 , starting from $ i $, is a standard result in gambler's ruin:
- If $ p \\neq \\frac{1}{2} $, let $ q=1-p $. Then:
$$
P_{i}=\\frac{1-\\left(\\frac{q}{p}\\right)^{i}}{1-\\left(\\frac{q}{p}\\right)^{N}}
$$
- If $ p=\\frac{1}{2} $, then:
$$
P_{i}=\\frac{i}{N}
$$

Final Expression for $ \\mathrm{E}[T] $
- For $ p \\neq \\frac{1}{2} $ :
$$
\\mathrm{E}[T]=\\frac{P_{i} N-i}{2 p-1}=\\frac{\\left(\\frac{1-\\binom{p}{p}^{i}}{1-\\binom{p}{p}^{N}}\\right) N-i}{2 p-1}
$$
- For $ p=\\frac{1}{2} $ :
$$
\\mathrm{E}[T]=i(N-i)
$$

# 17

## Problem 

In Example 7.6, assume that potential customers arrive according to a renewal process with interarrival distribution $ F $. Does the number of events up to time $ t $ form a renewal process (possibly delayed) if an event corresponds to a customer who:
(a) enters the bank?
(b) leaves the bank?

What if $ F $ is exponential?

## Solution (a)

Yes. Yes.

## Solution (b)

No. Yes.

# 18

## Problem 

> Calculate the renewal function when the interarrival distribution $ F $ satisfies $ 1-F(t)=p e^{-\\mu_{1} t}+ $ $ (1-p) e^{-\\mu_{2} t} $.

## Solution

The survival function is given by:
$$
1-F(t)=p e^{-\\mu_{1} t}+(1-p) e^{-\\mu_{2} t}, \\quad t \\geq 0
$$

The cumulative distribution function (CDF) is:
$$
F(t)=1-p e^{-\\mu_{1} t}-(1-p) e^{-\\mu_{2} t}
$$

The probability density function (PDF) is the derivative of the CDF:
$$
f(t)=\\frac{d}{d t} F(t)=p \\mu_{1} e^{-\\mu_{1} t}+(1-p) \\mu_{2} e^{-\\mu_{2} t}
$$

This is a mixture of two exponential distributions.
The renewal function $ M(t) $ is defined as the expected number of renewals (events) up to time $ t $. To find $ M(t) $, we use the Laplace transform approach. The Laplace-Stieltjes transform of the renewal function satisfies:
$$
\\mathcal{L}_{d M}(s)=\\int_{0}^{\\infty} e^{-s t} d M(t)=\\frac{\\mathcal{L}_{f}(s)}{1-\\mathcal{L}_{f}(s)}
$$
where $ \\mathcal{L}_{f}(s) $ is the Laplace transform of the interarrival density $ f(t) $.

First, compute $ \\mathcal{L}_{f}(s) $ :
$$
\\mathcal{L}_{f}(s)=\\int_{0}^{\\infty} e^{-s t} f(t) d t=\\int_{0}^{\\infty} e^{-s t}\\left[p \\mu_{1} e^{-\\mu_{1} t}+(1-p) \\mu_{2} e^{-\\mu_{2} t}\\right] d t
$$

This splits into two integrals:
$$
\\mathcal{L}_{f}(s)=p \\mu_{1} \\int_{0}^{\\infty} e^{-\\left(s+\\mu_{1}\\right) t} d t+(1-p) \\mu_{2} \\int_{0}^{\\infty} e^{-\\left(s+\\mu_{2}\\right) t} d t=p \\mu_{1} \\frac{1}{s+\\mu_{1}}+(1-p) \\mu_{2} \\frac{1}{s+\\mu_{2}}
$$

Next, compute $ 1-\\mathcal{L}_{f}(s) $ :
$$
1-\\mathcal{L}_{f}(s)=1-\\left(\\frac{p \\mu_{1}}{s+\\mu_{1}}+\\frac{(1-p) \\mu_{2}}{s+\\mu_{2}}\\right)
$$

Combining over a common denominator $ \\left(s+\\mu_{1}\\right)\\left(s+\\mu_{2}\\right) $ :
$$
\\mathcal{L}_{f}(s)=\\frac{p \\mu_{1}\\left(s+\\mu_{2}\\right)+(1-p) \\mu_{2}\\left(s+\\mu_{1}\\right)}{\\left(s+\\mu_{1}\\right)\\left(s+\\mu_{2}\\right)}=\\frac{s\\left(p \\mu_{1}+(1-p) \\mu_{2}\\right)+\\mu_{1} \\mu_{2}}{\\left(s+\\mu_{1}\\right)\\left(s+\\mu_{2}\\right)} .
$$

Thus,
$$
1-\\mathcal{L}_{f}(s)=\\frac{\\left(s+\\mu_{1}\\right)\\left(s+\\mu_{2}\\right)-\\left[s\\left(p \\mu_{1}+(1-p) \\mu_{2}\\right)+\\mu_{1} \\mu_{2}\\right]}{\\left(s+\\mu_{1}\\right)\\left(s+\\mu_{2}\\right)}=\\frac{s^{2}+s\\left(p \\mu_{2}+(1-p) \\mu_{1}\\right)}{\\left(s+\\mu_{1}\\right)\\left(s+\\mu_{2}\\right)} .
$$

Now,
$$
\\mathcal{L}_{d M}(s)=\\frac{\\mathcal{L}_{f}(s)}{1-\\mathcal{L}_{f}(s)}=\\frac{\\frac{s\\left(p \\mu_{1}+(1-p) \\mu_{2}\\right)+\\mu_{1} \\mu_{2}}{\\left(s+\\mu_{1}\\right)\\left(s+\\mu_{2}\\right)}}{\\frac{s^{2}+s\\left(p \\mu_{2}+(1-p) \\mu_{1}\\right)}{\\left(s+\\mu_{1}\\right)\\left(s+\\mu_{2}\\right)}}=\\frac{s\\left(p \\mu_{1}+(1-p) \\mu_{2}\\right)+\\mu_{1} \\mu_{2}}{s^{2}+s\\left(p \\mu_{2}+(1-p) \\mu_{1}\\right)}
$$

Let $ a=p \\mu_{1}+(1-p) \\mu_{2} $ and $ b=p \\mu_{2}+(1-p) \\mu_{1} $, so:
$$
\\mathcal{L}_{d M}(s)=\\frac{a s+\\mu_{1} \\mu_{2}}{s(s+b)}
$$

The Laplace transform of $ M(t) $, denoted $ \\tilde{M}(s)=\\int_{0}^{\\infty} e^{-s t} M(t) d t $, satisfies $ \\mathcal{L}_{d M}(s)=s \\tilde{M}(s) $ since $ M(0)=0 $. Thus:
$$
s \\tilde{M}(s)=\\frac{a s+\\mu_{1} \\mu_{2}}{s(s+b)} \\Longrightarrow \\tilde{M}(s)=\\frac{a s+\\mu_{1} \\mu_{2}}{s^{2}(s+b)}
$$

To find $ M(t) $, we invert this Laplace transform. Perform partial fraction decomposition:
$$
\\frac{a s+\\mu_{1} \\mu_{2}}{s^{2}(s+b)}=\\frac{A}{s}+\\frac{B}{s^{2}}+\\frac{C}{s+b}
$$

Solving for the constants:
$$
a s+\\mu_{1} \\mu_{2}=A s(s+b)+B(s+b)+C s^{2} .
$$

Equate coefficients:
- $ s^{2}: A+C=0 $
- $ s^{1}: A b+B=a $
- $ s^{0}: B b=\\mu_{1} \\mu_{2} $

From $ B b=\\mu_{1} \\mu_{2} $, we have $ B=\\frac{\\mu_{1} \\mu_{2}}{b} $.
From $ A+C=0 $, we have $ C=-A $.
Substitute into the $ s^{1} $ equation:
$$
A b+\\frac{\\mu_{1} \\mu_{2}}{b}=a \\Longrightarrow A=\\frac{a}{b}-\\frac{\\mu_{1} \\mu_{2}}{b^{2}} .
$$

Thus,
$$
C=-\\left(\\frac{a}{b}-\\frac{\\mu_{1} \\mu_{2}}{b^{2}}\\right)
$$

The mean interarrival time $ \\mu $ is:
$$
\\mu=\\int_{0}^{\\infty}(1-F(t)) d t=\\int_{0}^{\\infty}\\left(p e^{-\\mu_{1} t}+(1-p) e^{-\\mu_{2} t}\\right) d t=\\frac{p}{\\mu_{1}}+\\frac{1-p}{\\mu_{2}}
$$

Note that $ \\frac{1}{\\mu}=\\frac{\\mu_{1} \\mu_{2}}{b} $, so $ B=\\frac{1}{\\mu} $.

Compute $ a b-\\mu_{1} \\mu_{2} $ :
$$
\\begin{array}{c}
a b=\\left(p \\mu_{1}+(1-p) \\mu_{2}\\right)\\left(p \\mu_{2}+(1-p) \\mu_{1}\\right)=p(1-p)\\left(\\mu_{1}^{2}+\\mu_{2}^{2}\\right)+p^{2} \\mu_{1} \\mu_{2}+(1-p)^{2} \\mu_{1} \\mu_{2} \\\\
a b-\\mu_{1} \\mu_{2}=p(1-p)\\left(\\mu_{1}^{2}-2 \\mu_{1} \\mu_{2}+\\mu_{2}^{2}\\right)=p(1-p)\\left(\\mu_{1}-\\mu_{2}\\right)^{2}
\\end{array}
$$

Thus,
$$
A=\\frac{p(1-p)\\left(\\mu_{1}-\\mu_{2}\\right)^{2}}{b^{2}}
$$

The inverse Laplace transform gives:
$$
M(t)=\\mathcal{L}^{-1}\\left\\{\\frac{A}{s}+\\frac{B}{s^{2}}+\\frac{C}{s+b}\\right\\}=A+B t+C e^{-b t}
$$

Substituting $ C=-A $ :
$$
M(t)=A+B t-A e^{-b t}=B t+A\\left(1-e^{-b t}\\right)
$$

Substitute the expressions for $ A $ and $ B $ :
$$
M(t)=\\frac{t}{\\mu}+\\frac{p(1-p)\\left(\\mu_{1}-\\mu_{2}\\right)^{2}}{b^{2}}\\left(1-e^{-b t}\\right)
$$
where $ b=p \\mu_{2}+(1-p) \\mu_{1} $ and $ \\mu=\\frac{p}{\\mu_{1}}+\\frac{1-p}{\\mu_{2}} $.

$ M(t)=\\frac{t}{\\mu}+\\frac{p(1-p)\\left(\\mu_{1}-\\mu_{2}\\right)^{2}}{\\left[p \\mu_{2}+(1-p) \\mu_{1}\\right]^{2}}\\left(1-e^{-\\left[p \\mu_{2}+(1-p) \\mu_{1}\\right] t}\\right) $,

# 19

## Problem 

> Consider a renewal process with interarrival times uniformly distributed on (0,1). Determine the expected time from $ t=1 $ until the next renewal.

## Solution 

Let $ U $ be the time of the last renewal before or at time $ t=1 $. The next renewal occurs at time $ U+ $ $ Y $, where $ Y $ is the interarrival time following $ U $, and $ Y \\sim \\operatorname{Uniform}(0,1) $, independent of $ U $. The time from $ t=1 $ to the next renewal is $ B(1)=(U+Y)-1 $. Since there are no renewals in $ (U, 1] $, it follows that $ U+Y>1 $ almost surely.

The cumulative distribution function (CDF) of $ U $ is derived as follows. For $ u \\in[0,1], P(U \\leq u)= $ $ P $ (no renewals in $ (u, 1]) $. This probability is given by:
$$
P(U \\leq u)=1+e^{u}(u-1) .
$$

The probability density function (PDF) of $ U $ is:
$$
f_{U}(u)=\\frac{d}{d u}\\left[1+e^{u}(u-1)\\right]=u e^{u}, \\quad u \\in[0,1] .
$$

The expected value of $ U $ is:
$$
E[U]=\\int_{0}^{1} u \\cdot u e^{u} d u=\\int_{0}^{1} u^{2} e^{u} d u
$$

Using integration by parts:
- Let $ v=u^{2}, d w=e^{u} d u $, so $ d v=2 u d u, w=e^{u} $.
- Then:
$$
\\int u^{2} e^{u} d u=u^{2} e^{u}-\\int 2 u e^{u} d u
$$
- Now, $ \\int u e^{u} d u=u e^{u}-\\int e^{u} d u=u e^{u}-e^{u} $.
- Substituting back:
$$
\\int u^{2} e^{u} d u=u^{2} e^{u}-2\\left(u e^{u}-e^{u}\\right)=u^{2} e^{u}-2 u e^{u}+2 e^{u}
$$
- Evaluating from 0 to 1 :
$$
\\left[u^{2} e^{u}-2 u e^{u}+2 e^{u}\\right]_{0}^{1}=(1 \\cdot e-2 \\cdot e+2 e)-(0-0+2)=e-2 .
$$

Thus, $ E[U]=e-2 $.

Thus, $ E[U]=e-2 $.
Given $ U $, the conditional distribution of $ Y $ is uniform on ( $ 1-U, 1 $ ), because $ Y>1-U $ must hold. The conditional expectation of $ Y $ given $ U $ is:
$$
E[Y \\mid U]=E[Y \\mid Y>1-U]=\\frac{(1-U)+1}{2}=1-\\frac{U}{2} .
$$

The conditional expectation of $ B(1) $ given $ U $ is:
$$
E[B(1) \\mid U]=E[(U+Y-1) \\mid U]=U+E[Y \\mid U]-1=U+\\left(1-\\frac{U}{2}\\right)-1=\\frac{U}{2} .
$$

The unconditional expectation is:
$$
E[B(1)]=E[E[B(1) \\mid U]]=E\\left[\\frac{U}{2}\\right]=\\frac{1}{2} E[U]=\\frac{1}{2}(e-2) .
$$

Alternatively, using the age $ A(1)=1-U $, the distribution of $ A(1) $ has PDF:
$$
f_{A}(a)=f_{U}(1-a)\\left|\\frac{d u}{d a}\\right|=(1-a) e^{1-a}, \\quad a \\in[0,1] .
$$

Given $ A(1)=a $, the remaining life $ B(1) $ is uniformly distributed on $ (0,1-a) $, so:
$$
E[B(1) \\mid A(1)=a]=\\frac{1-a}{2} .
$$

Then:
$$
E[B(1)]=E[E[B(1) \\mid A(1)]]=E\\left[\\frac{1-A(1)}{2}\\right]=\\frac{1}{2} E[1-A(1)]=\\frac{1}{2} E[U]=\\frac{1}{2}(e-2),
$$

# 22 

## Problem 

> J's strategy for buying cars is as follows: For the first $ T $ units of time after acquiring a new car, all failures are repaired. After the car reaches an age of $ T $, upon the first failure, it is sent to the junkyard and a new car is purchased. Assume that the time to first failure for a new car is an exponential random variable with rate $ \\lambda $, and the time to next failure for a repaired car is an exponential random variable with rate $ \\mu $.
(a) What is the rate at which J buys new cars?
(b) Suppose a new car costs $ C $, and each repair costs $ r $. What is J's long-run average cost per unit time?

## Solution(a)

To find $ \\mathbb{E}[L] $, define the failure times in a cycle. Let $ Z_{1} $ be the time to the first failure, $ Z_{1} \\sim \\operatorname{Exp}(\\lambda) $. For $ k \\geq 2 $, let $ Z_{k} $ be the time to the next failure after a repair, $ Z_{k} \\sim \\operatorname{Exp}(\\mu) $, and all $ Z_{k} $ are independent. The cumulative time to the $ k $-th failure is $ S_{k}=\\sum_{i=1}^{k} Z_{i} $. The cycle ends at the smallest $ N $ such that $ S_{N}>T $, so $ L=S_{N} $.

By Wald's equation and the properties of stopping times,
$$
\\mathbb{E}[L]=\\mathbb{E}\\left[S_{N}\\right]=\\sum_{i=1}^{\\infty} \\mathbb{E}\\left[Z_{i}\\right] \\mathbb{P}(N \\geq i)
$$

Here, $ \\mathbb{E}\\left[Z_{1}\\right]=\\frac{1}{\\lambda}, \\mathbb{E}\\left[Z_{i}\\right]=\\frac{1}{\\mu} $ for $ i \\geq 2 $, and $ \\mathbb{P}(N \\geq i)=\\mathbb{P}\\left(S_{i-1} \\leq T\\right) $ for $ i \\geq 2 $ (with $ S_{0}=0 $, so $ \\mathbb{P}(N \\geq 1)=1 $ ). Thus,
$$
\\mathbb{E}[L]=\\frac{1}{\\lambda} \\cdot 1+\\sum_{i=2}^{\\infty} \\frac{1}{\\mu} \\mathbb{P}\\left(S_{i-1} \\leq T\\right)=\\frac{1}{\\lambda}+\\frac{1}{\\mu} \\sum_{k=1}^{\\infty} \\mathbb{P}\\left(S_{k} \\leq T\\right),
$$
where $ k=i-1 $.

The sum $ \\sum_{k=1}^{\\infty} \\mathbb{P}\\left(S_{k} \\leq T\\right)=\\mathbb{E}[N(T)] $, where $ N(T) $ is the number of failures up to time $ T $ in a delayed renewal process. The first interarrival time is $ \\operatorname{Exp}(\\lambda) $, and subsequent interarrival times are $ \\operatorname{Exp}(\\mu) $. The renewal function $ m(t)=\\mathbb{E}[N(t)] $ satisfies
$$
m(t)=F_{1}(t)+\\int_{0}^{t} m_{2}(t-s) f_{1}(s) d s
$$
where $ F_{1}(t)=1-e^{-\\lambda t} $ is the $ \\operatorname{CDF} $ of $ \\operatorname{Exp}(\\lambda), f_{1}(t)=\\lambda e^{-\\lambda t} $ is the $ \\operatorname{PDF} $, and $ m_{2}(t)=\\mu t $ is the renewal function for the ordinary renewal process with interarrival $ \\operatorname{Exp}(\\mu) $. Thus,
$$
m(t)=\\left(1-e^{-\\lambda t}\\right)+\\int_{0}^{t}(\\mu(t-s)) \\lambda e^{-\\lambda s} d s
$$

The integral is
$$
\\int_{0}^{t} \\mu(t-s) \\lambda e^{-\\lambda s} d s=\\mu \\lambda\\left[\\frac{t}{\\lambda}+\\frac{1}{\\lambda^{2}} e^{-\\lambda t}-\\frac{1}{\\lambda^{2}}\\right]=\\mu t+\\frac{\\mu}{\\lambda} e^{-\\lambda t}-\\frac{\\mu}{\\lambda}
$$
so
$$
m(t)=1-e^{-\\lambda t}+\\mu t+\\frac{\\mu}{\\lambda} e^{-\\lambda t}-\\frac{\\mu}{\\lambda}=\\mu t+\\left(1-\\frac{\\mu}{\\lambda}\\right)\\left(1-e^{-\\lambda t}\\right)
$$

Therefore, $ \\mathbb{E}[N(T)]=m(T)=\\mu T+\\left(1-\\frac{\\mu}{\\lambda}\\right)\\left(1-e^{-\\lambda T}\\right) $, and
$$
\\mathbb{E}[L]=\\frac{1}{\\lambda}+\\frac{1}{\\mu}\\left[\\mu T+\\left(1-\\frac{\\mu}{\\lambda}\\right)\\left(1-e^{-\\lambda T}\\right)\\right]=T+\\frac{1}{\\mu}+\\left(\\frac{1}{\\lambda}-\\frac{1}{\\mu}\\right) e^{-\\lambda T} .
$$

The rate of buying new cars is
$$
\\frac{1}{\\mathbb{E}[L]}=\\left[T+\\frac{1}{\\mu}+\\left(\\frac{1}{\\lambda}-\\frac{1}{\\mu}\\right) e^{-\\lambda T}\\right]^{-1} .
$$

## Solution (b)

The total cost per cycle is $ C+r(N-1) $. The expected cost per cycle is
$$
\\mathbb{E}[C+r(N-1)]=C+r(\\mathbb{E}[N]-1)
$$

From part (a), $ \\mathbb{E}[N]=1+\\mathbb{E}[N(T)]=1+m(T)=1+\\mu T+\\left(1-\\frac{\\mu}{\\lambda}\\right)\\left(1-e^{-\\lambda T}\\right) $, so
$$
\\mathbb{E}[N]-1=\\mu T+\\left(1-\\frac{\\mu}{\\lambda}\\right)\\left(1-e^{-\\lambda T}\\right) .
$$

Thus, the expected cost per cycle is
$$
C+r\\left[\\mu T+\\left(1-\\frac{\\mu}{\\lambda}\\right)\\left(1-e^{-\\lambda T}\\right)\\right]
$$

The long-run average cost per unit time is the expected cost per cycle divided by the expected cycle length:
$$
\\frac{C+r\\left[\\mu T+\\left(1-\\frac{\\mu}{\\lambda}\\right)\\left(1-e^{-\\lambda T}\\right)\\right]}{T+\\frac{1}{\\mu}+\\left(\\frac{1}{\\lambda}-\\frac{1}{\\mu}\\right) e^{-\\lambda T}} .
$$

# 26 

## Problem

> Consider a train station where passengers arrive according to a Poisson process with rate $ \\lambda $. Whenever there are $ N $ passengers waiting at the station, a train is dispatched. However, it takes $ K $ units of time for the train to arrive at the station, and it carries all waiting passengers upon arrival. Assume that the station incurs a cost at a rate of $ n \\cdot c $ per unit time when there are $ n $ passengers waiting, where $ c $ is the cost rate per passenger per unit time. Find the long-run average cost.

## Solution 

Since passenger arrivals follow a Poisson process with rate $ \\lambda, T_{1} $ is the time of the $ N $-th arrival, which follows an Erlang distribution with shape parameter $ N $ and rate $ \\lambda $. Thus,
$$
\\mathbb{E}\\left[T_{1}\\right]=\\frac{N}{\\lambda}
$$

The expected cycle length is
$$
\\mathbb{E}[T]=\\mathbb{E}\\left[T_{1}+K\\right]=\\frac{N}{\\lambda}+K .
$$

The cost per cycle is $ C_{\\text {cycle }}=c \\int_{0}^{T} n(s) d s $, where $ n(s) $ is the number of waiting passengers at time s. We split the integral into two intervals: $ \\left[0, T_{1}\\right] $ and $ \\left[T_{1}, T_{1}+K\\right] $ (since $ T=T_{1}+K $ ).
- Interval $ \\left[0, T_{1}\\right] $ : Passengers arrive, and $ n(s) $ is the number of arrivals by time $ s $. At $ s=T_{1} $, $ n(s)=N $. The integral $ \\int_{0}^{T_{1}} n(s) d s $ can be expressed using the arrival times. Let $ T_{i} $ be the arrival time of the $ i $-th passenger $ (i=1,2, \\ldots, N) $. Then,
$$
\\int_{0}^{T_{1}} n(s) d s=\\sum_{i=1}^{N}\\left(T_{1}-T_{i}\\right)
$$
since passenger $ i $ contributes waiting time from $ T_{i} $ to $ T_{1} $. The expectation is
$$
\\mathbb{E}\\left[\\sum_{i=1}^{N}\\left(T_{1}-T_{i}\\right)\\right]=\\mathbb{E}\\left[N T_{1}-\\sum_{i=1}^{N} T_{i}\\right]
$$

For a Poisson process, $ \\mathbb{E}\\left[T_{i}\\right]=\\frac{i}{\\lambda} $ and $ \\mathbb{E}\\left[T_{1}\\right]=\\mathbb{E}\\left[T_{N}\\right]=\\frac{N}{\\lambda} $. Thus,
$$
\\begin{array}{c}
\\mathbb{E}\\left[\\sum_{i=1}^{N} T_{i}\\right]=\\sum_{i=1}^{N} \\mathbb{E}\\left[T_{i}\\right]=\\sum_{i=1}^{N} \\frac{i}{\\lambda}=\\frac{1}{\\lambda} \\cdot \\frac{N(N+1)}{2}, \\\\
\\mathbb{E}\\left[N T_{1}\\right]=N \\cdot \\frac{N}{\\lambda}=\\frac{N^{2}}{\\lambda},
\\end{array}
$$

SO
$$
\\mathbb{E}\\left[\\sum_{i=1}^{N}\\left(T_{1}-T_{i}\\right)\\right]=\\frac{N^{2}}{\\lambda}-\\frac{1}{\\lambda} \\cdot \\frac{N(N+1)}{2}=\\frac{N(N-1)}{2 \\lambda} .
$$

- Interval $ \\left[T_{1}, T_{1}+K\\right] $ : At $ s=T_{1} $, there are $ N $ passengers. During $ \\left[T_{1}, T_{1}+K\\right] $, additional passengers arrive according to a Poisson process with rate $ \\lambda $, independent of the past. Let $ N^{\\prime}(u) $ be the number of arrivals by time $ u $ in this interval, where $ u=s-T_{1} $. Then $ n(s)= $ $ N+N^{\\prime}\\left(s-T_{1}\\right) $, and
$$
\\int_{T_{1}}^{T_{1}+K} n(s) d s=\\int_{0}^{K}\\left[N+N^{\\prime}(u)\\right] d u
$$


Combining both intervals, the expected value of the integral is
$$
\\mathbb{E}\\left[\\int_{0}^{T} n(s) d s\\right]=\\frac{N(N-1)}{2 \\lambda}+N K+\\frac{\\lambda K^{2}}{2} .
$$

Thus, the expected cost per cycle is
$$
\\mathbb{E}\\left[C_{\\text {cycle }}\\right]=c\\left(\\frac{N(N-1)}{2 \\lambda}+N K+\\frac{\\lambda K^{2}}{2}\\right) .
$$

By the renewal reward theorem,
$$
\\text { Long-run average cost }=\\frac{\\mathbb{E}\\left[C_{\\text {cycle }}\\right]}{\\mathbb{E}[T]}=\\frac{c\\left(\\frac{N(N-1)}{2 \\lambda}+N K+\\frac{\\lambda K^{2}}{2}\\right)}{\\frac{N}{\\lambda}+K} .
$$

Simplifying the expression:
$$
=c \\cdot \\frac{\\frac{N(N-1)}{2 \\lambda}+N K+\\frac{\\lambda K^{2}}{2}}{\\frac{N}{\\lambda}+K}=c \\cdot \\frac{\\frac{N(N-1)+2 N K \\lambda+\\lambda^{2} K^{2}}{2 \\lambda}}{\\frac{N+K \\lambda}{\\lambda}}=c \\cdot \\frac{N(N-1)+2 N K \\lambda+\\lambda^{2} K^{2}}{2(N+\\lambda K)} .
$$

Let $ Q=\\lambda K $. Then the numerator is $ N(N-1)+2 N Q+Q^{2} $, and
$$
N(N-1)+2 N Q+Q^{2}=\\left(N^{2}+2 N Q+Q^{2}\\right)-N=(N+Q)^{2}-N .
$$

Thus,

The long-run average cost is
$$
\\frac{c}{2}\\left(N+\\lambda K-\\frac{N}{N+\\lambda K}\\right)
$$


#  27

## Problem 

> Consider a machine consisting of two independent components, where the $ i $-th component operates for an exponential time with rate $ \\lambda_{i} $. The machine functions as long as at least one component is working (i.e., it fails only when both components fail). When a machine fails, a new machine with both components working is immediately put into use. Each machine failure incurs a cost $ K $, and while the machine is in use, it incurs an operating cost at a rate of $ c_{i} $ per unit time when there are $ i $ working components $ (i=1,2) $. Find the long-run average cost per unit time.

## Solution 

The system can be modeled as a renewal process, where each renewal cycle begins when a new machine (both components working) is put into use and ends when the machine fails (both components failed). The long-run average cost per unit time is given by the renewal reward theorem:
$$
\\text { Long-run average cost }=\\frac{\\mathbb{E}[\\text { Cost per cycle }]}{\\mathbb{E}[\\text { Cycle length }]} \\text {. }
$$

We define the states of the machine within a cycle:
- State 2: Both components working.
- State 1A: Component 1 working, component 2 failed.
- State 1B: Component 2 working, component 1 failed.
- State 0: Both components failed (machine failure).

The transition rates are:
- From state 2 , the machine transitions to state 1 B at rate $ \\lambda_{1} $ (if component 1 fails) or to state 1 A at rate $ \\lambda_{2} $ (if component 2 fails). The total transition rate out of state 2 is $ \\lambda_{1}+\\lambda_{2} $.
- From state 1 A , the machine transitions to state 0 at rate $ \\lambda_{1} $ (component 1 fails).
- From state 1 B , the machine transitions to state 0 at rate $ \\lambda_{2} $ (component 2 fails).

Step 1: Expected Cycle Length
Let $ T $ be the cycle length (time from state 2 to state 0 ). Define:
- $ E_{2} $ : Expected time to state 0 starting from state 2.
- $ E_{1 A} $ : Expected time to state 0 starting from state 1A.
- $ E_{1 B} $ : Expected time to state 0 starting from state 1 B .

From state 1A or 1B, the time to failure is exponential:
$$
E_{1 A}=\\frac{1}{\\lambda_{1}}, \\quad E_{1 B}=\\frac{1}{\\lambda_{2}} .
$$

From state 2, the probability of transitioning to state 1A is $ P( $ to 1 A$ )=\\frac{\\lambda_{2}}{\\lambda_{1}+\\lambda_{2}} $ (if component 2 fails), and to state 1 B is $ P( $ to 1 B$ )=\\frac{\\lambda_{1}}{\\lambda_{1}+\\lambda_{2}} $ (if component 1 fails). The expected time spent in state 2 is $ \\frac{1}{\\lambda_{1}+\\lambda_{2}} $. Thus:

$$
E_{2}=\\frac{1}{\\lambda_{1}+\\lambda_{2}}+\\frac{1}{\\lambda_{1}+\\lambda_{2}}\\left(\\frac{\\lambda_{2}}{\\lambda_{1}}+\\frac{\\lambda_{1}}{\\lambda_{2}}\\right)=\\frac{1}{\\lambda_{1}+\\lambda_{2}}\\left(1+\\frac{\\lambda_{1}^{2}+\\lambda_{2}^{2}}{\\lambda_{1} \\lambda_{2}}\\right) .
$$

Further simplification:
$$
1+\\frac{\\lambda_{1}^{2}+\\lambda_{2}^{2}}{\\lambda_{1} \\lambda_{2}}=\\frac{\\lambda_{1} \\lambda_{2}+\\lambda_{1}^{2}+\\lambda_{2}^{2}}{\\lambda_{1} \\lambda_{2}}
$$
so:
$$
E_{2}=\\frac{\\lambda_{1} \\lambda_{2}+\\lambda_{1}^{2}+\\lambda_{2}^{2}}{\\lambda_{1} \\lambda_{2}\\left(\\lambda_{1}+\\lambda_{2}\\right)}=\\frac{\\lambda_{1}^{2}+\\lambda_{1} \\lambda_{2}+\\lambda_{2}^{2}}{\\lambda_{1} \\lambda_{2}\\left(\\lambda_{1}+\\lambda_{2}\\right)}
$$

Alternatively, using algebraic manipulation:
$$
E_{2}=\\frac{1}{\\lambda_{1}}+\\frac{1}{\\lambda_{2}}-\\frac{1}{\\lambda_{1}+\\lambda_{2}} .
$$

Thus, the expected cycle length is:
$$
\\mathbb{E}[T]=E_{2}=\\frac{1}{\\lambda_{1}}+\\frac{1}{\\lambda_{2}}-\\frac{1}{\\lambda_{1}+\\lambda_{2}} .
$$

The cost per cycle consists of:
- A fixed cost $ K $ incurred when the machine fails (upon entering state 0 ).
- Operating costs: At rate $ c_{2} $ per unit time in state 2 , and $ c_{1} $ per unit time in state 1 (either 1A or 1B).

Let $ T_{2} $ be the time spent in state 2 per cycle, and $ T_{1} $ be the total time spent in state 1 per cycle. The expected cost per cycle is:
$$
\\mathbb{E}[\\text { Cost per cycle }]=K+c_{2} \\mathbb{E}\\left[T_{2}\\right]+c_{1} \\mathbb{E}\\left[T_{1}\\right] .
$$
- Expected time in state 2 : The time in state 2 is exponential with rate $ \\lambda_{1}+\\lambda_{2} $, so:
$$
\\mathbb{E}\\left[T_{2}\\right]=\\frac{1}{\\lambda_{1}+\\lambda_{2}} .
$$
- Expected time in state 1: The time in state 1 depends on which substate is entered:
- If entered state 1A (probability $ \\frac{\\lambda_{2}}{\\lambda_{1}+\\lambda_{2}} $ ), the time is exponential with rate $ \\lambda_{1} $, so expected time is $ \\frac{1}{\\lambda_{1}} $.
- If entered state 1 B (probability $ \\frac{\\lambda_{1}}{\\lambda_{1}+\\lambda_{2}} $ ), the time is exponential with rate $ \\lambda_{2} $, so expected time is $ \\frac{1}{\\lambda_{2}} $.
Thus:

$ \\mathbb{E}\\left[T_{1}\\right]=\\mathbb{E}[T]-\\mathbb{E}\\left[T_{2}\\right]=\\left(\\frac{1}{\\lambda_{1}}+\\frac{1}{\\lambda_{2}}-\\frac{1}{\\lambda_{1}+\\lambda_{2}}\\right)-\\frac{1}{\\lambda_{1}+\\lambda_{2}}=\\frac{1}{\\lambda_{1}}+\\frac{1}{\\lambda_{2}}-\\frac{2}{\\lambda_{1}+\\lambda_{2}}= $

By the renewal reward theorem:
$$
\\text { Long-run average cost }=\\frac{\\mathbb{E}[\\text { Cost per cycle }]}{\\mathbb{E}[T]}=\\frac{K+c_{2} \\cdot \\frac{1}{\\lambda_{1}+\\lambda_{2}}+c_{1} \\cdot \\frac{\\lambda_{1}^{2}+\\lambda_{2}^{2}}{\\lambda_{1} \\lambda_{2}\\left(\\lambda_{1}+\\lambda_{2}\\right)}}{\\frac{1}{\\lambda_{1}}+\\frac{1}{\\lambda_{2}}-\\frac{1}{\\lambda_{1}+\\lambda_{2}}} .
$$

Substitute $ \\mathbb{E}[T]=\\frac{\\lambda_{1}^{2}+\\lambda_{1} \\lambda_{2}+\\lambda_{2}^{2}}{\\lambda_{1} \\lambda_{2}\\left(\\lambda_{1}+\\lambda_{2}\\right)} $ and write the numerator with a common denominator:
$$
\\mathbb{E}[\\text { Cost per cycle }]=K+\\frac{c_{2} \\lambda_{1} \\lambda_{2}+c_{1}\\left(\\lambda_{1}^{2}+\\lambda_{2}^{2}\\right)}{\\lambda_{1} \\lambda_{2}\\left(\\lambda_{1}+\\lambda_{2}\\right)} .
$$

Thus:
$$
\\text { Long-run average cost }=\\frac{K+\\frac{c_{2} \\lambda_{1} \\lambda_{2}+c_{1}\\left(\\lambda_{1}^{2}+\\lambda_{2}^{2}\\right)}{\\lambda_{1} \\lambda_{2}\\left(\\lambda_{1}+\\lambda_{2}\\right)}}{\\frac{\\lambda_{1}^{2}+\\lambda_{1} \\lambda_{2}+\\lambda_{2}^{2}}{\\lambda_{1} \\lambda_{2}\\left(\\lambda_{1}+\\lambda_{2}\\right)}}=\\frac{K \\lambda_{1} \\lambda_{2}\\left(\\lambda_{1}+\\lambda_{2}\\right)+c_{2} \\lambda_{1} \\lambda_{2}+c_{1}\\left(\\lambda_{1}^{2}+\\lambda_{2}^{2}\\right)}{\\lambda_{1}^{2}+\\lambda_{1} \\lambda_{2}+\\lambda_{2}^{2}} \\text {. }
$$

The denominator is $ \\lambda_{1}^{2}+\\lambda_{1} \\lambda_{2}+\\lambda_{2}^{2} $, and the numerator is $ K \\lambda_{1} \\lambda_{2}\\left(\\lambda_{1}+\\lambda_{2}\\right)+c_{1}\\left(\\lambda_{1}^{2}+\\lambda_{2}^{2}\\right)+ $ $ c_{2} \\lambda_{1} \\lambda_{2} $`,__vite_glob_0_77=`---
title: Stochastic Progress - Week 7
category: Notes
---

# 

## Example 1

> A gambler wins 1 unit with probability $ p $ and loses 1 unit with probability $ q=1-p $ in each bet. Assuming each bet is independent and the gambler starts with $ i $ units, what is the probability that their wealth reaches $ N $ before reaching 0 ?

## Example 2 

> Consider a finite-state Markov chain with transient set $ \\boldsymbol{T}=\\{1,2, \\ldots, t\\} $. Let
$
\\boldsymbol{P}_{\\boldsymbol{T}}=\\left[\\begin{array}{cccc}
P_{11} & P_{12} & \\cdots & P_{1 t} \\\\
\\vdots & \\vdots & \\ddots & \\vdots \\\\
P_{t 1} & P_{t 2} & \\cdots & P_{t t}
\\end{array}\\right]
$
be the submatrix of the transition matrix.

Note: The sum of some rows may be less than 1.
For transient states $ i $ and $ j $, define
$
\\begin{aligned}
s_{i j}= & E[\\text { number of visits to state } j \\text { by a Markov chain starting in state } i] \\\\
& =E\\left[\\text { number of times the Markov chain visits state } j \\mid X_{0}=i\\right]
\\end{aligned}
$
which represents the expected number of times the Markov chain, starting from state $ i $, stays in state $ j $. Find $ s_{i j} $.

## Solution 

$ s_{i j}=\\delta_{i j}+\\sum_{k \\in T} P_{i k} \\cdot s_{k j} $

Then:

$ \\mathbf{S}=\\mathbf{I}+\\boldsymbol{P}_{\\boldsymbol{T}} \\cdot \\mathbf{S} $

We get:

$ \\mathbf{S}=\\left(\\mathbf{I}-\\boldsymbol{P}_{\\boldsymbol{T}}\\right)^{-1} $

## Final arrive probability

$f_{ij} = \\dfrac{s_{ij}-\\delta _{ij}}{s_{jj}}$

Proof: $s_{ij} = f_{ij}s_{jj}$

## Example 3 

Consider $ n $ elements $ e_{1}, \\ldots, e_{n} $ in an ordered list. At each unit of time, the probability that element $ e_{i} $ is requested is $ P_{i} $, independent of past requests, with $ \\sum_{i=1}^{n} P_{i}=1 $. After an element is requested, it is moved to the front of the list.

Objective: Calculate the expected position of the requested element after the system has been running for a long time.

## Solution 

Notice the probability of $e_j$ is before $e_i$ is $\\dfrac{P_j}{P_i+P_j}$, then the expectation:

$ E_{i}=1+\\sum_{j \\neq i} \\frac{P_{j}}{P_{i}+P_{j}} $

---

## Example 4


Let $ X_{i}(i \\geq 1)=-1,0,1, \\ldots $ be independent and identically distributed random variables. Define $ P_{j}=P\\left\\{X_{i}=j\\right\\} $, and assume $ \\sum_{j=-1}^{\\infty} P_{j}=1 $. Let
$
S_{0}=0, \\quad S_{n}=\\sum_{i=1}^{n} X_{i}
$

The sequence $ \\left\\{S_{n}(n \\geq 0)\\right\\} $ represents a random walk with no left jumps (i.e., it can decrease by at most 1).

Question 1: In the long run, what is the total gain? (Assume unlimited borrowing is possible.)

Question 2: Starting with 0 units, on average, after how many bets will a loss of $ k $ units occur?

Question 3: What is the distribution of the number of bets in Question 2?

Question 4: For a prudent gambler, in the long run, how many times does the total gain reach $ -k $ ?

Question 5: For an unlucky gambler, what is the probability that the total gain $ S_{n} $ remains negative?

Question 6: For a regretful gambler, when is the last time they lose exactly $ k $ units?

## Solution 

Question 1: 

$E(X)<0$, it goes to $-\\infty$

Question 2:

$E[T_{-1}|X_1] = E[1+ T_{-X_1+1}] = 1+(X_1+1)E[T_{-1}]$

Apply Expectation to both side:

$E[T_{-1}]  = -\\dfrac{1}{E[X]}$

Question 3:

$P(T_{-k} = n ) = \\dfrac{k}{n}P(S_n = -k)$
- $S_n = \\sum_{i=1}^n X_i$

Question 4

$E[\\sum_{i=1}^\\infty I_n] = \\sum_{n-1}^\\infty P(S_n = -k) = \\dfrac {E[T_k]}{k} = -\\dfrac{1}{E[X]}$

Question 5

The hitting times $\\sim Ge(p)$

$\\dfrac{1}{p} = -\\dfrac{1}{E[X]}$

Question 6

$$
\\begin{array}{l}
E[L_{-k}]\\\\ 
= \\sum_{n=0}^\\infty n P(L_{-k} = n) \\\\ 
= -E[X]\\sum_{n=0}^\\infty nP(S_n=-k)\\\\ 
= -E[X]\\sum_{n=0}^\\infty n \\dfrac{n}{k} P(T_{-k}=n) \\\\ 
= \\dfrac{v}{k}\\sum_{n=0}^\\infty  n^2 P(T_{-k}=n) \\\\ 
= \\dfrac{v}{k}E[T^2_{-k}] \\\\ 
= \\dfrac{v}{k} (E^2[T_{-k}] + Var[T_{-k}])
\\end{array}
$$

`,__vite_glob_0_78=`---
title: Stochastic Progress - Week 8
category: Notes
---

# Exponential Distribution

$ f(x)=\\left\\{\\begin{array}{cc}\\lambda e^{-\\lambda x}, & x \\geq 0 \\\\ 0 & , x<0\\end{array}\\right. $

$ \\mathrm{F}(x)=\\int_{-\\infty}^{x} f(y) d y=\\left\\{\\begin{array}{cl}1-e^{-\\lambda x} & , x \\geq 0 \\\\ 0 & , x<0\\end{array}\\right. $

$ \\begin{array}{l}P\\{X \\leq x\\}=1-e^{-\\lambda x} \\\\ P\\{X>x\\}=1-P\\{X \\leq x\\}=e^{-\\lambda x}\\end{array} $



## Example:

Let $T$ as Exponential RV with parameter $\\alpha $:

$ \\int_{0}^{\\infty} e^{-\\alpha x} E[R(x)] d x=E\\left[\\int_{0}^{T} R(x) d x\\right] $

Proof:

$ \\begin{aligned} &E\\left[\\int_{0}^{\\infty} R(x) I(x) d x\\right] \\\\ 
& =\\int_{0}^{\\infty} E[R(x) I(x)] d x \\\\ & =\\int_{0}^{\\infty} E[R(x)] E[I(x)] d x \\\\ & =\\int_{0}^{\\infty} E[R(x)] P\\{T \\geq x\\} d x \\\\ & =\\int_{0}^{\\infty} e^{-\\alpha x} E[R(x)] d x\\end{aligned} $

## Markov property

$ P\\{X>s+t \\mid X>t\\}=P\\{X>s\\} $

Other form:

$ \\dfrac{P\\{X>s+t, X>t\\}}{P\\{X>t\\}}=P\\{X>s\\} $

$ P\\{X>s+t\\}=P\\{X>t\\} P\\{X>s\\} $

### Proof

$ P(X>s+t \\mid X>s)=\\dfrac{P(X>s+t \\cap X>s)}{P(X>s)} =\\dfrac{e^{-\\lambda(s+t)}}{e^{-\\lambda s}}=e^{-\\lambda t}=P(X>t)  $

Risk rate function: $ r(t)=\\dfrac{f(t)}{1-F(t)} $

$ \\begin{array}{c}P\\{X \\in(t, t+d t) \\mid X>t\\}=\\dfrac{P\\{X \\in(t, t+d t), X>t\\}}{P\\{X>t\\}} \\\\ =\\dfrac{P\\{X \\in(t, t+d t)\\}}{P\\{X>t\\}} \\approx \\dfrac{f(t) d t}{1-F(t)}=r(t) d t\\end{array} $

$r(t) = \\lambda$

$ r(t)=\\dfrac{f(t)}{1-F(t)}=\\dfrac{\\dfrac{d}{d t} F(t)}{1-F(t)} $

Then can get $F(t)$

## Example x

$X_1,\\dots,X_n$ are independent Exponential RVs with parameter $\\lambda_i$.

$ \\sum_{j=1}^{n} P_{j}=1 $, where $ P_{j}=P\\{T=j\\} $

Then for $X_T$:

$ \\begin{array}{c}f(t)=\\sum_{i=1}^{n} \\lambda_{i} P_{i} e^{-\\lambda_{i} t} \\\\ F(t)=1-\\sum_{i=1}^{n} P_{i} e^{-\\lambda_{i} t} \\\\ r(t)=\\dfrac{\\sum_{j=1}^{n} \\lambda_{j} P_{j} e^{-\\lambda_{j} t}}{\\sum_{i=1}^{n} P_{i} e^{-\\lambda_{i} t}}=\\sum_{j=1}^{n} \\lambda_{j} P\\{T=j \\mid X>t\\} \\\\ \\lim _{t \\rightarrow \\infty} r(t)=\\min \\lambda_{i}\\end{array} $

## Propositions

1. $X_i$ are i.i.d. Exponential RVs with parameter $\\lambda$, then $\\sum_{i=1}^{n} X_i\\sim Ga(n,\\lambda)$ 

2. $ \\min \\left(X_{1}, \\ldots, X_{n}\\right) \\sim \\operatorname{Exp}\\left(\\sum_{i=1}^{n} \\lambda_{i}\\right) $

3. $ P\\left\\{X_{1}<X_{2}\\right\\}=\\dfrac{\\lambda_{1}}{\\lambda_{1}+\\lambda_{2}} $

4. $P(X_i = \\min_j X_j) = \\dfrac{\\lambda_i}{\\sum_{j=1}^{n} \\lambda_j} $

5. $ P\\left\\{X_{i_{1}}<\\cdots<X_{i_{n}} \\mid \\min _{\\mathrm{i}} X_{i}>t\\right\\}  =P\\left\\{X_{i_{1}}<\\cdots<X_{i_{n}}\\right\\}$

## Convolution

$ f_{S}(t)=f_{X_{1}+\\cdots+X_{n}}(t)=\\sum_{i=1}^{n} C_{i, n} \\lambda_{i} e^{-\\lambda_{i} t} $, where $ C_{i, n}=\\prod_{j \\neq i} \\dfrac{\\lambda_{j}}{\\lambda_{j}-\\lambda_{i}} $

$ r_{S}(t)=\\dfrac{\\sum_{i=1}^{n} C_{i, n} \\lambda_{i} e^{-\\lambda_{i} t}}{\\sum_{i=1}^{n} C_{i, n} e^{-\\lambda_{i} t}} $

$ \\lim _{t \\rightarrow \\infty} r_{S}(t)=\\min \\left(\\lambda_{1}, \\ldots, \\lambda_{n}\\right)=\\lambda^{*} $

## An extension

$ \\mathrm{Y}=\\sum_{i=1}^{N} X_{i} $ 

Then:


$
f_{Y}(t)=\\sum_{n=1}^{m} P_{n} \\sum_{i=1}^{n} C_{i, n} \\lambda_{i} e^{-\\lambda_{i} t},
$

# Counting Process

$\\{N(t), t \\geq 0\\}$ is a counting process.

If:

1. $N(t) \\ge 0$ 
2. $N(t)$ is integer
3. if $s < t$, then $N(s) \\le N(t)$
4. for $s < t$, $N(t) - N(s)$ is the event counts in $(s, t]$

## independent increments

For any integer $ n $ and  $ 0 \\leq t_{1}<t_{2}<\\cdots<t_{n} $
$ >N(0), N\\left(t_{1}\\right)-N(0), N\\left(t_{2}\\right)-N\\left(t_{1}\\right), \\ldots, N\\left(t_{n}\\right)-N\\left(t_{n-1}\\right) $ independent.

## Stationary increments

For any $ s>0 $ 和 $ 0 \\leq t_{1}<t_{2} $ ， $ >N\\left(t_{1}, t_{2}\\right], N\\left(t_{1}+s, t_{2}+s\\right] $ i.d.

# Poission Process

## $o(h)$

$\\lim_{h\\to 0} \\dfrac{f(h)}{h}=0$, then $o(h) := f(\\cdot)$ 

## Definition

1. $N(0)=0$
2. $\\{N(t), t \\geq 0\\}$ has Stationary increments and independent increments.
3. $P\\{N(t+h)-N(t)=1\\}=\\lambda h+o(h) $
4. $P\\{N(t+h)-N(t) \\geq 2\\}=o(h)$

## Proof 

$ P_{k}(t+h)=P_{k}(t)(1-\\lambda h)+P_{k-1}(t) \\lambda h+o(h) $.

$ \\dfrac{d P_{k}(t)}{d t}=-\\lambda P_{k}(t)+\\lambda P_{k-1}(t) \\quad(k \\geq 1) $

$ \\dfrac{d P_{0}(t)}{d t}=-\\lambda P_{0}(t) $.

$ \\dfrac{d P_{0}}{d t}=-\\lambda P_{0} \\Longrightarrow P_{0}(t)=e^{-\\lambda t} $.

$ \\dfrac{d P_{1}}{d t}+\\lambda P_{1}=\\lambda e^{-\\lambda t} \\Longrightarrow P_{1}(t)=\\lambda t e^{-\\lambda t} $

$ P_{k}(t)=\\dfrac{(\\lambda t)^{k} e^{-\\lambda t}}{k!} $

## Definition 2

    
1. $N(0)=0$
2. $\\{N(t), t \\geq 0\\}$ has independent increments
3. $ N(s, s+t] \\sim  \\operatorname{Poisson}(\\lambda t), \\forall s, t \\geq 0 $.

## $T_n$: arrival interval 

- $T_1$ first arrival
- $T_n$: time between $n-1$ and $n$ arrivals

### Proposition

$T_n$ is i.i.d. Exponential RV with parameter $\\lambda$.

#### Proof

$P(T_1 > t) = P(N(t) = 0) = e^{-\\lambda t}, T_1 \\sim \\operatorname{Exp}(\\lambda)$


### $S_n$: waiting interval 

$f_{S_n}(t) = \\lambda e^{-\\lambda t}\\dfrac{(\\lambda t)^{n-1}}{(n-1)!}$

####  Proof

$S_n = \\sum_{i=1}^n T_i$

## Definition 3

Let $ \\left\\{T_{n}, n \\geq 1\\right\\} $ be i.i.d. exponential random variables with mean $ 1 / \\lambda $. Define $ S_{0}=0 $, $ S_{n}=\\sum_{i=1}^{n} T_{i} $, and the counting process $ N(t)=\\max \\left\\{n: S_{n} \\leq t\\right\\} $. Then $ \\{N(t), t \\geq 0\\} $ is a Poisson process with rate $ \\lambda $.

### Proof

1. $ P(N(t)=n)=P\\left(S_{n} \\leq t\\right)-P\\left(S_{n+1} \\leq t\\right)=\\int_{0}^{t} \\frac{\\lambda^{n} s^{n-1} e^{-\\lambda s}}{(n-1)!} d s-\\int_{0}^{t} \\frac{\\lambda^{n+1} s^{n} e^{-\\lambda s}}{n!} d s =\\frac{(\\lambda t)^{n} e^{-\\lambda t}}{n!} $,

2. For disjoint intervals $ \\left(t_{i}, t_{j}\\right] $, the increments $ N\\left(t_{j}\\right)-N\\left(t_{i}\\right) $ depend on disjoint subsets of $ \\left\\{T_{n}\\right\\} $. Since $ \\left\\{T_{n}\\right\\} $ are independent, the increments are independent.

3. The distribution of $ N(t+s)-N(s) $ depends only on $ t $. By the memoryless property, the process after time $ s $ is a replica of the original process, hence:$N(t+s)-N(s) \\stackrel{d}{=} N(t)$

# Proposition 

## Thinning

Proposition 5.3 (Thinning of a Poisson Process). Let $ \\{N(t), t \\geq 0\\} $ be a Poisson process with rate $ \\lambda $. Suppose each event of $ \\{N(t)\\} $ is independently classified as a type- 1 event with probability $ p $ or a type-2 event with probability $ 1-p $. Define the counting processes:
$ N_{1}(t)= $ number of type-1 events by time $ t, \\quad N_{2}(t)= $ number of type-2 events by time $ t $.
Then:
1. $ \\left\\{N_{1}(t), t \\geq 0\\right\\} $ is a Poisson process with rate $ \\lambda p $.
2. $ \\left\\{N_{2}(t), t \\geq 0\\right\\} $ is a Poisson process with rate $ \\lambda(1-p) $.
3. $ \\left\\{N_{1}(t)\\right\\} $ and $ \\left\\{N_{2}(t)\\right\\} $ are independent of each other.

### Proof 

$ P\\left(N_{1}(t)=k\\right)=\\sum_{n=k}^{\\infty} P(N(t)=n) \\cdot P\\left(N_{1}(t)=k \\mid N(t)=n\\right)= \\sum_{n=k}^{\\infty} \\frac{(\\lambda t)^{n} e^{-\\lambda t}}{n!} \\cdot\\binom{n}{k} p^{k}(1-p)^{n-k} =\\frac{(\\lambda p t)^{k} e^{-\\lambda p t}}{k!} \\cdot \\sum_{m=0}^{\\infty} \\frac{(\\lambda(1-p) t)^{m} e^{-\\lambda(1-p) t}}{m!}=\\frac{(\\lambda p t)^{k} e^{-\\lambda p t}}{k!} $.

## Example 

You, as a business owner, want to sell a bubble tea machine. Offers arrive according to a Poisson process with rate $ \\lambda $. Each offer is a random value with density function $ f(x) $. Once an offer is received, you must either accept it or reject it and wait for the next offer.
- While the machine remains unsold, you incur a holding cost of $ c $ per unit time. Your goal is to maximize the expected total return, defined as the selling price minus the total holding cost.
- Assume your strategy is to accept the first offer exceeding a threshold $ y $ (called a $ y $-strategy). What is the optimal value of $ y $ ?

### Solution

Step 1: Model Setup
- Offer Arrival: Offers follow a Poisson process with rate $ \\lambda $.
- Offer Distribution: Each offer $ X $ has density $ f(x) $.
- Strategy: Accept the first offer $ X \\geq y $.
- Holding Cost: $ c $ per unit time until sale.

Step 2: Key Quantities
1. Probability of Accepting an Offer:
$
p=P(X \\geq y)=\\int_{y}^{\\infty} f(x) d x
$
2. Time to Sale: The first valid offer (i.e., $ X \\geq y $ ) occurs at time $ T $, which follows an exponential distribution with rate $ \\lambda p $. Thus:
$
E[T]=\\frac{1}{\\lambda p}
$
3. Expected Holding Cost:
$
E[\\text { Holding Cost }]=c \\cdot E[T]=\\frac{c}{\\lambda p}
$
4. Conditional Expected Selling Price:
$
E[X \\mid X \\geq y]=\\frac{1}{p} \\int_{y}^{\\infty} x f(x) d x
$

Step 3: Expected Total Return
The expected total return $ V(y) $ is:
$
V(y)=E[\\text { Selling Price }]-E[\\text { Holding Cost }]=\\frac{1}{p} \\int_{y}^{\\infty} x f(x) d x-\\frac{c}{\\lambda p}
$

Simplify:
$
V(y)=\\frac{\\int_{y}^{\\infty} x f(x) d x-\\frac{c}{\\lambda}}{p} .
$

Step 4: Optimization
To maximize $ V(y) $, take the derivative $ V^{\\prime}(y) $ and set it to zero:
$
V^{\\prime}(y)=\\frac{d}{d y}\\left[\\frac{\\int_{y}^{\\infty} x f(x) d x-\\frac{c}{\\lambda}}{\\int_{y}^{\\infty} f(x) d x}\\right]=0
$

Derivative Calculation:
Let $ A(y)=\\int_{y}^{\\infty} x f(x) d x-\\frac{c}{\\lambda}, B(y)=\\int_{y}^{\\infty} f(x) d x $.
Using the quotient rule:
$
V^{\\prime}(y)=\\frac{A^{\\prime}(y) B(y)-A(y) B^{\\prime}(y)}{B(y)^{2}} .
$
- $ A^{\\prime}(y)=-y f(y) $,
- $ B^{\\prime}(y)=-f(y) $.

Substitute:
$
V^{\\prime}(y)=\\frac{(-y f(y)) B(y)-\\left(\\int_{y}^{\\infty} x f(x) d x-\\frac{c}{\\lambda}\\right)(-f(y))}{B(y)^{2}}
$

Simplify the numerator:
$
-f(y)\\left[y B(y)-\\int_{y}^{\\infty} x f(x) d x+\\frac{c}{\\lambda}\\right]=0
$

This implies:
$
y B(y)-\\int_{y}^{\\infty} x f(x) d x+\\frac{c}{\\lambda}=0
$

Step 5: Optimality Condition
Rearranging:
$
\\int_{y}^{\\infty}(x-y) f(x) d x=\\frac{c}{\\lambda}
$

Equivalently:
$
E\\left[(X-y)^{+}\\right]=\\frac{c}{\\lambda},
$
where $ (X-y)^{+}=\\max (X-y, 0) $.

## Superposition

Let $ \\left\\{N_{1}(t), t \\geq 0\\right\\},\\left\\{N_{2}(t), t \\geq 0\\right\\}, \\ldots $, be independent Poisson processes with rates $ \\lambda_{1}, \\lambda_{2}, \\ldots $, respectively. Then, the combined process defined by
$
N(t)=N_{1}(t)+N_{2}(t)+\\cdots
$
is a Poisson process with rate $ \\lambda=\\lambda_{1}+\\lambda_{2}+\\cdots $.

## Example 

Example: Let $ \\left\\{N_{1}(t), t \\geq 0\\right\\} $ and $ \\left\\{N_{2}(t), t \\geq 0\\right\\} $ be independent Poisson processes with rates $ \\lambda_{1} $ and $ \\lambda_{2} $, respectively. Let $ S_{n}^{1} $ denote the time of the $ n $-th event in $ \\left\\{N_{1}(t)\\right\\} $, and $ S_{m}^{2} $ denote the time of the $ m $-th event in $ \\left\\{N_{2}(t)\\right\\} $. Find $ P\\left(S_{n}^{1}<S_{m}^{2}\\right) $, i.e., the probability that the $ n $-th event of $ \\left\\{N_{1}(t)\\right\\} $ occurs before the $ m $-th event of $ \\left\\{N_{2}(t)\\right\\} $.

### Solution 

The number of events from $ \\left\\{N_{1}(t)\\right\\} $ among the first $ (n+m-1) $ merged events follows a binomial distribution with parameters $ (n+m-1, p) $. The desired probability is the sum of probabilities of having $ k \\geq n $ successes (events from $ N_{1}(t) $ ):
$$
P\\left(S_{n}^{1}<S_{m}^{2}\\right)=\\sum_{k=n}^{n+m-1}\\binom{n+m-1}{k} p^{k}(1-p)^{n+m-1-k}
$$

## Order statistics

Let $ Y_{1}, \\ldots, Y_{n} $ be independent and identically distributed (i.i.d.) random variables with probability density function $ f $. Let $ Y_{(k)} $ denote the $ k $-th smallest value among $ Y_{1}, \\ldots, Y_{n} $. Then, $ Y_{(1)}, \\ldots, Y_{(n)} $ are the order statistics of $ Y_{1}, \\ldots, Y_{n} $.

The joint density of $ Y_{(1)}, \\ldots, Y_{(n)} $ is given by:
$$
f_{Y_{(1)}, \\ldots, Y_{(n)}}\\left(y_{1}, \\ldots, y_{n}\\right)=n!\\prod_{i=1}^{n} f\\left(y_{i}\\right), \\quad \\text { for } y_{1}<y_{2}<\\cdots<y_{n} .
$$

### Theorem about uniform distribution 

Theorem: Let $ Y_{1}, Y_{2}, \\ldots, Y_{n} $ be independent and identically distributed (i.i.d.) random variables uniformly distributed on the interval $ (0, t) $. Let $ Y_{(1)}, Y_{(2)}, \\ldots, Y_{(n)} $ denote their order statistics. Then, the joint probability density function (PDF) of the order statistics is:
$$
f_{Y_{(1)}, Y_{(2)}, \\ldots, Y_{(n)}}\\left(y_{1}, y_{2}, \\ldots, y_{n}\\right)=\\frac{n!}{t^{n}}, \\quad \\text { for } 0<y_{1}<y_{2}<\\cdots<y_{n}<t
$$

### Theorem: poission process 

Let $ \\{N(t), t \\geq 0\\} $ be a Poisson process with rate $ \\lambda $. Given that $ N(t)=n $, the event times $ S_{1}, S_{2}, \\ldots, S_{n} $ are the ordered times of the $ n $ events in $ (0, t) $. We aim to show that, conditioned on $ N(t)=n $, the joint distribution of $ S_{1}, S_{2}, \\ldots, S_{n} $ is equivalent to the joint distribution of $ n $ independent uniform random variables on $ (0, t) $, sorted in ascending order.

### Theorem: More Thinning

Let $ N(t) $ be a Poisson process with rate $ \\lambda $, and suppose each event occurring at time $ s $ is independently classified into type $ i(i=1, \\ldots, k) $ with probability $ P_{i}(s) $. Let $ N_{i}(t) $ denote the number of type- $ i $ events by time $ t $. Then, the expected value of $ N_{i}(t) $ is:
$$
E\\left[N_{i}(t)\\right]=\\lambda \\int_{0}^{t} P_{i}(s) d s
$$



placeholder  


placeholder  


placeholder  


placeholder  


`,__vite_glob_0_79=`---
title: Stochastic Progress - Special 8
category: Notes
---

# 8.1.2

## Problem

> $\\int_{0}^{\\infty} e^{-\\alpha x} E[R(x)] d x=E\\left[\\int_{0}^{T} R(x) d x\\right]$, where $T\\sim Exp(\\alpha)$ 

## Solution 

$$
\\begin{array}{l }
RHS \\\\ 
= E[E[\\int_0^T R(x) dx]|T] \\\\ 
= \\int_0^\\infty E[\\int_0^t R(x) dx] \\alpha e^{-\\alpha t }dt \\\\ 
= \\int_0^\\infty (\\int_0^t E[R(x)] dx) \\alpha e^{-\\alpha t }dt \\\\ 
= \\int_0^\\infty (\\int_x^\\infty \\alpha e^{-\\alpha t}dt) E[R(x)] dx \\\\ 
= \\int_0^\\infty e^{-\\alpha x} E[R(x)] dx \\\\ 
\\end{array}
$$

## Advantage

- No Indicator function is required.


# Ex 5.4

## Problem

> $\\lambda =  1/10$ Solve $E[(X-4)^+], Var[(X-4)^+]$

## Solution 

$$
\\begin{array}{l }
E[(X-4)^+] \\\\ 
= E[(X-4)^+|X>4]P(X>4) \\\\  
= E[X-4|X>4] P(X>4) \\\\ 
= P(X>4) E[X] \\\\ 
= 10e^{-4/10}
\\end{array}
$$

$$
\\begin{array}{l }
Var[(X-4)^+] \\\\ 
= E[(X-4)^{+2}] - E^2[(X-4)^+]\\\\ 
= E[(X-4)^{+2}|X>4]P(X>4) - E^2[(X-4)^+|X>4]P^2(X>4) \\\\ 
= E[X^2]P(X>4) - E^2[X]P^2(X>4) \\\\ 
= (Var[X] + E^2[X])P(X>4)- E^2[X]P^2(X>4) \\\\
= 200e^{-4/10} - 100e^{-8/10}
\\end{array}
$$

## Advantage

No indicator function is required.

# Ex 5.15

## Problem 

> You, as a business owner, want to sell a bubble tea machine. Offers arrive according to a Poisson process with rate $ \\lambda $. Each offer is a random value with density function $ f(x) $. Once an offer is received, you must either accept it or reject it and wait for the next offer.
- While the machine remains unsold, you incur a holding cost of $ c $ per unit time. Your goal is to maximize the expected total return, defined as the selling price minus the total holding cost.
- Assume your strategy is to accept the first offer exceeding a threshold $ y $ (called a $ y $-strategy). What is the optimal value of $ y $ ?

## Solution 

Step 1: Model Setup
- Offer Arrival: Offers follow a Poisson process with rate $ \\lambda $.
- Offer Distribution: Each offer $ X $ has density $ f(x) $.
- Strategy: Accept the first offer $ X \\geq y $.
- Holding Cost: $ c $ per unit time until sale.

Step 2: Key Quantities
1. Probability of Accepting an Offer:
$
p=P(X \\geq y)=\\int_{y}^{\\infty} f(x) d x
$
2. Time to Sale: The first valid offer (i.e., $ X \\geq y $ ) occurs at time $ T $, which follows an exponential distribution with rate $ \\lambda p $. Thus:
$
E[T]=\\frac{1}{\\lambda p}
$
3. Expected Holding Cost:
$
E[\\text { Holding Cost }]=c \\cdot E[T]=\\frac{c}{\\lambda p}
$
4. Conditional Expected Selling Price:
$
E[X \\mid X \\geq y]=\\frac{1}{p} \\int_{y}^{\\infty} x f(x) d x
$

Step 3: Expected Total Return
The expected total return $ V(y) $ is:
$
V(y)=E[\\text { Selling Price }]-E[\\text { Holding Cost }]=\\frac{1}{p} \\int_{y}^{\\infty} x f(x) d x-\\frac{c}{\\lambda p}
$

Simplify:
$
V(y)=\\frac{\\int_{y}^{\\infty} x f(x) d x-\\frac{c}{\\lambda}}{p} .
$

Step 4: Optimization
To maximize $ V(y) $, take the derivative $ V^{\\prime}(y) $ and set it to zero:
$
V^{\\prime}(y)=\\frac{d}{d y}\\left[\\frac{\\int_{y}^{\\infty} x f(x) d x-\\frac{c}{\\lambda}}{\\int_{y}^{\\infty} f(x) d x}\\right]=0
$

Derivative Calculation:
Let $ A(y)=\\int_{y}^{\\infty} x f(x) d x-\\frac{c}{\\lambda}, B(y)=\\int_{y}^{\\infty} f(x) d x $.
Using the quotient rule:
$
V^{\\prime}(y)=\\frac{A^{\\prime}(y) B(y)-A(y) B^{\\prime}(y)}{B(y)^{2}} .
$
- $ A^{\\prime}(y)=-y f(y) $,
- $ B^{\\prime}(y)=-f(y) $.

Substitute:
$
V^{\\prime}(y)=\\frac{(-y f(y)) B(y)-\\left(\\int_{y}^{\\infty} x f(x) d x-\\frac{c}{\\lambda}\\right)(-f(y))}{B(y)^{2}}
$

Simplify the numerator:
$
-f(y)\\left[y B(y)-\\int_{y}^{\\infty} x f(x) d x+\\frac{c}{\\lambda}\\right]=0
$

This implies:
$
y B(y)-\\int_{y}^{\\infty} x f(x) d x+\\frac{c}{\\lambda}=0
$

Step 5: Optimality Condition
Rearranging:
$
\\int_{y}^{\\infty}(x-y) f(x) d x=\\frac{c}{\\lambda}
$

Equivalently:
$
E\\left[(X-y)^{+}\\right]=\\frac{c}{\\lambda},
$
where $ (X-y)^{+}=\\max (X-y, 0) $.

## Advantage

- Understanbale




`,__vite_glob_0_80=`---
title: Stochastic Progress - Week 9
category: Notes
---

# Nonhomogeneous Poisson Process

A counting process $ \\{N(t), t \\geq 0\\} $ is called a nonhomogeneous Poisson process with intensity function $ \\lambda(t) $ (for $ t \\geq 0 $ ) if the following conditions are satisfied:
1. Initialization: $ N(0)=0 $.
2. Independent Increments: The process $ \\{N(t), t \\geq 0\\} $ has independent increments.
3. No Simultaneous Events:
$
P\\{N(t+h)-N(t) \\geq 2\\}=o(h) \\quad \\text { as } h \\rightarrow 0
$
4. Incremental Probability:
$
P\\{N(t+h)-N(t)=1\\}=\\lambda(t) h+o(h) \\quad \\text { as } h \\rightarrow 0 .
$

## Expectation Function

$ m(t)=\\int_{0}^{t} \\lambda(y) d y $

## Theorem 

For a nonhomogeneous Poisson process $ \\{N(t), t \\geq 0\\} $ with intensity function $ \\lambda(t) $, the increment $ N(s+t)-N(s) $ over the interval $ [s, s+t] $ follows a Poisson distribution with mean:
$
m(s+t)-m(s)=\\int_{s}^{s+t} \\lambda(y) d y
$
where $ m(t)=\\int_{0}^{t} \\lambda(y) d y $. Formally,
$
N(s+t)-N(s) \\sim \\text { Poisson }\\left(\\int_{s}^{s+t} \\lambda(y) d y\\right) .
$

# Compound Poisson Process

A stochastic process $ \\{X(t), t \\geq 0\\} $ is called a compound Poisson process if it can be expressed as:
$
X(t)=\\sum_{i=1}^{N(t)} Y_{i}, \\quad t \\geq 0
$
where:
1. $ \\{N(t), t \\geq 0\\} $ is a Poisson process with rate $ \\lambda $.
2. $ \\left\\{Y_{i}, i \\geq 1\\right\\} $ is a sequence of independent and identically distributed (i.i.d.) random variables, independent of $ \\{N(t)\\} $.

## Proposition 

$ \\begin{array}{c}E[X(t)]=E[N(t)] E\\left[Y_{1}\\right]=\\lambda t E\\left[Y_{1}\\right] \\\\ \\operatorname{Var}[X(t)]=\\lambda t E\\left[Y_{1}^{2}\\right]\\end{array} $

## Compound Poisson Process Addition

Let $ \\left\\{X_{1}(t), t \\geq 0\\right\\} $ and $ \\left\\{X_{2}(t), t \\geq 0\\right\\} $ be independent compound Poisson processes defined as:
$
X_{1}(t)=\\sum_{i=1}^{N_{1}(t)} Y_{1 i}, \\quad X_{2}(t)=\\sum_{i=1}^{N_{2}(t)} Y_{2 i}
$
where:
- $ N_{1}(t) \\sim \\operatorname{Poisson}\\left(\\lambda_{1} t\\right) $ and $ N_{2}(t) \\sim \\operatorname{Poisson}\\left(\\lambda_{2} t\\right) $,
- $ \\left\\{Y_{1 i}\\right\\} \\stackrel{\\text { i.i.d. }}{\\sim} F_{1},\\left\\{Y_{2 i}\\right\\} \\stackrel{\\text { i.i.d. }}{\\sim} F_{2} $,
- $ N_{1}(t), N_{2}(t),\\left\\{Y_{1 i}\\right\\} $, and $ \\left\\{Y_{2 i}\\right\\} $ are mutually independent.

We aim to show that $ X(t)=X_{1}(t)+X_{2}(t) $ is also a compound Poisson process.

## Example 

For a single-server queue with Poisson arrivals (rate $ \\lambda $ ) and i.i.d. service times:
- Idle period: No customers present, server inactive.
- Busy period: Begins when a customer arrives to an empty system and ends when the system is empty again. During service of the initial customer:
- New arrivals join the queue (no balking)
- Service continues recursively until all customers are processed

By the memoryless property of Poisson arrivals, all busy periods are identically distributed. Let B denote the busy period duration.

Find: $ \\mathrm{E}[\\mathrm{B}] $ and $ \\operatorname{Var}[\\mathrm{B}] $.

### Solution 


Taking conditional expectation:
$
E[B \\mid S]=S+\\lambda S \\cdot E[B]
$

Averaging over $ S $ :
$
E[B]=E[S]+\\lambda E[S] \\cdot E[B]
$

Solving for $ E[B] $ :
$
E[B]=\\frac{E[S]}{1-\\lambda E[S]}
$
provided $ \\lambda E[S]<1 $ (stability condition).

The variance calculation is more involved and uses the law of total variance:
$
\\operatorname{Var}[B]=E[\\operatorname{Var}[B \\mid S]]+\\operatorname{Var}[E[B \\mid S]]
$

After detailed derivation (see full report), we obtain:
$
\\operatorname{Var}[B]=\\frac{\\lambda(E[S])^{3}+\\operatorname{Var}[S]}{(1-\\lambda E[S])^{3}}
$

# Conditional Poisson Process

A counting process $ \\{N(t), t \\geq 0\\} $ is called a conditional Poisson process if there exists a positive random variable $ L $ such that, given $ L=\\lambda $, the process is a Poisson process with rate $ \\lambda $.

## Proposition 

$ \\begin{array}{c}E[N(t)]=t E[L] \\\\ \\operatorname{Var}[N(t)]=E[L t]+\\operatorname{Var}[L t]=t E[L]+t^{2} \\operatorname{Var}[L]\\end{array} $


`,__vite_glob_0_81=`---
title: Stochastic Progress - Week 1
category: Notes
---

# Cheat sheet

$$
\\begin{array}{|c|c|c|c|c|}
\\hline
\\text{分布} & \\text{概率密度函数 (PDF)} & \\text{均值} & \\text{方差} & \\text{矩母函数 (MGF)} \\\\
\\hline
\\text{伯努利分布 } (p) & 
f(x) = p^x (1-p)^{1-x}, \\quad x \\in \\{0,1\\} & 
p & 
p(1-p) & 
1 - p + pe^t \\\\
\\hline
\\text{二项分布 } (n, p) & 
f(x) = \\binom{n}{x} p^x (1-p)^{n-x}, \\quad x \\in \\{0,1,\\dots,n\\} & 
np & 
np(1-p) & 
(1 - p + pe^t)^n \\\\
\\hline
\\text{泊松分布 } (\\lambda) & 
f(x) = \\frac{e^{-\\lambda} \\lambda^x}{x!}, \\quad x \\in \\{0,1,2,\\dots\\} & 
\\lambda & 
\\lambda & 
e^{\\lambda(e^t - 1)} \\\\
\\hline
\\text{几何分布 } (p) & 
f(x) = p(1-p)^{x-1}, \\quad x \\in \\{1,2,\\dots\\} & 
\\frac{1}{p} & 
\\frac{1-p}{p^2} & 
\\frac{pe^t}{1 - (1 - p)e^t} \\\\
\\hline
\\text{均匀分布 } (a, b) & 
f(x) = \\frac{1}{b-a}, \\quad x \\in [a,b] & 
\\frac{a + b}{2} & 
\\frac{(b - a)^2}{12} & 
\\frac{e^{tb} - e^{ta}}{t(b - a)} \\\\
\\hline
\\text{正态分布 } (\\mu, \\sigma^2) & 
f(x) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} e^{-\\frac{(x-\\mu)^2}{2\\sigma^2}}, \\quad x \\in \\mathbb{R} & 
\\mu & 
\\sigma^2 & 
e^{\\mu t + \\frac{1}{2}\\sigma^2 t^2} \\\\
\\hline
\\text{指数分布 } (\\lambda) & 
f(x) = \\lambda e^{-\\lambda x}, \\quad x \\geq 0 & 
\\frac{1}{\\lambda} & 
\\frac{1}{\\lambda^2} & 
\\frac{\\lambda}{\\lambda - t} \\\\
\\hline
\\text{伽马分布 } (\\alpha, \\beta) & 
f(x) = \\frac{\\beta^\\alpha x^{\\alpha-1} e^{-\\beta x}}{\\Gamma(\\alpha)}, \\quad x \\geq 0 & 
\\frac{\\alpha}{\\beta} & 
\\frac{\\alpha}{\\beta^2} & 
\\left(\\frac{\\beta}{\\beta - t}\\right)^\\alpha \\\\
\\hline
\\text{卡方分布 } (k) & 
f(x) = \\frac{x^{k/2-1} e^{-x/2}}{2^{k/2} \\Gamma(k/2)}, \\quad x \\geq 0 & 
k & 
2k & 
(1 - 2t)^{-k/2} \\\\
\\hline
\\end{array}
$$


# Probability

## Sample Space & Event

- Sample Space: $S$

- Event: $E$, a subset of $S$
  - Union: $E\\cup F$
    - $\\cup_{n=1}^\\infty E_n$
  - Intersection: $E\\cap F $ or $EF$
    - $\\cap_{n=1}^\\infty E_n$
  - Mutually Exclusive: $EF = \\oslash$
  - Complement: $E^c$


## Inclusion-Exclusion Principle

> $P(E\\cup F) = P(E) + P(F) - P(EF)$


## Conditional Probability

> $P(E|F) = \\dfrac{P(EF)}{P(F)}, P(F)>0$

## Independent Event

Events Independent if:

> $P(EF) = P(E)P(F)$
> - Or: $P(E|F) = P(E)$

For multiple events:

> $P(E_1\\dots E_r) = P(E_1)\\dots P(E_r), \\forall r\\le n$

## Bayes' Rule 

> $ P\\left(F_{j} \\mid E\\right)=\\dfrac{P\\left(F_{j} E\\right)}{P(E)}=\\dfrac{P\\left(E \\mid F_{j}\\right) P\\left(F_{j}\\right)}{\\sum_{i=1}^{n} P\\left(E \\mid F_{i}\\right) P\\left(F_{i}\\right)} $
> - $F_1,\\dots,F_n$ mutually exclusive 
> - Notice: $ \\cup_{i=1}^{n} F_{i}=S $
>
> Some corollaries:
>
> $ E=E \\cap S=E \\cap\\left(F \\cup F^{c}\\right)=E F \\cup E F^{c} $
>
> $ P(E)=P(E \\mid F) P(F)+P\\left(E \\mid F^{c}\\right) P\\left(F^{c}\\right) $
>
> $ P(D \\mid E)=\\dfrac{P(D E)}{P(E)}=\\dfrac{P(E \\mid D) P(D)}{P(E \\mid D) P(D)+P\\left(E \\mid D^{c}\\right) P\\left(D^{c}\\right)} $

# Random Variable (RV)

- $X$: Bounded Real Function definitioned on Sample Space 

- $F(\\cdot)$: Cumulative Distribution Function (CDF)
- $F(b) = P\\{X\\le b\\}, \\forall b $
  - $F(b)$ non-decreasing 
  - $ \\lim _{b \\rightarrow \\infty} F(b)=F(\\infty)=1 $
  - $ \\lim _{b \\rightarrow-\\infty} F(b)=F(-\\infty)=0 $
  - $ P(X<b)=\\lim _{h \\rightarrow 0^{+}} F(b-h) $

## Discrete Random Variable

- Probability Distribution Function (PDF)

$ p(a)=P\\{X=a\\} $

- Bernoulli 
- Binom 
- Geometry 
- Possion 

A special case:

When a Binom Distribution with small $p$ and large $n$

$$
\\begin{aligned}
&p(i)\\\\ 
=& \\binom{n}{i}p^i(1-p)^{n-i}\\\\ 
=& \\dfrac{n!}{i!(n-i)!}p^i(1-p)^{n-i}\\\\
\\overset{\\lambda=np}{=}&
\\dfrac{n(n-1)\\dots(n-i+1)}{i!}\\cdot\\dfrac{\\lambda^i}{n^i}\\cdot\\dfrac{(1-\\frac{\\lambda}{n})^n}{(1-\\frac{\\lambda}{n})^i}\\\\ 
=&1\\cdot \\dfrac{\\lambda^i}{n^i}\\cdot\\dfrac{e^{-\\lambda}}{1}\\\\
=&e^{-\\lambda}\\dfrac{\\lambda^i}{i!}
\\end{aligned}
$$

## Continuous Random Variable

pdf:

$P\\{X\\in B\\} = \\int_B f(x)dx, \\forall B$

An important approximation:
- $\\int_{a - \\epsilon/2}^{a +\\epsilon/2} f(x)dx \\approx \\epsilon f(a)$

cdf:

$F(a) = P\\{X\\in(-\\infty, a]\\} = \\int_{-\\infty}^a f(x)dx$

- Uniform
- Exponential
- Gamma
- Normal

## Expectation

Discrete:

- $E(X) = \\sum_{x:p(x)>0}xp(x)$

Continuous:

- $E(x) = \\int_{-\\infty}^{\\infty}xf(x)dx$

$$
\\begin{array}{|l|l|}
\\hline Bernoulli & p\\\\ 
\\hline Binom & np\\\\ 
\\hline Geometry & 1/p \\\\ 
\\hline Possion & \\lambda \\\\ 
\\hline Uniform & (\\alpha + \\beta) / 2 \\\\ 
\\hline Exponential & \\alpha / \\lambda \\\\ 
\\hline Normal & \\mu \\\\ 
\\hline
\\end{array}
$$

Corollaries:

- For Discrete RV:
  - $E[g(x)] = \\sum_{x:p(x)>0} g(x)p(x) $
- For Continuous RV:
  - $E[g(x)] = \\int_{-\\infty}^\\infty g(x)f(x)dx$

---

Moment:

- $E(X^n)$

Variation:

- $Var(X) = E[(X-E[X])^2] = E(X^2)-(EX)^2$

## Joint Distributino 

CDF:

$F(a,b) = P\\{X\\le a, Y\\le b\\}, -\\infty < a,b < \\infty $

PDF:

$p(x,y) = P\\{X=x, Y=y\\}$

Expectation:

- $E[g(X,Y)] = \\sum_x\\sum_y g(x,y)p(x,y)$
- $E[g(X,Y)] = \\int_{-\\infty}^\\infty\\int_{-\\infty}^\\infty g(x,y)f(x,y)dxdy$

### Independent

They are Independent if: $F(a,b) = F_X(a)F_Y(b),\\forall a,b$

- Discrete: $p(x,y) = p_X(x)p_Y(y)$
- Continuous: $f(x,y) = f_X(x)f_Y(y)$

If Independent:
- $E[g(X)h(Y)] - E[g(X)]E[h(Y)]$

### Covariation

$Cov(X,Y) = E[(X-E[X])(Y-E[Y])] = E[XY] - E[X]E[Y]$

- $Cov(X,X) = Var(X)$
- $Cov(X,Y) = Cov(Y,X)$
- $Cov(cX,Y) = cCov(X,Y)$
- $Cov(\\sum_{i=1}^n X_i,\\sum_{j=1}^m Y_j) = \\sum_{i=1}^n\\sum_{j=1}^m Cov(X_i, Y_j)$
- $Var(\\sum_{i=1}^n X_i) = \\sum_{i=1}^n Var(X_i) + 2\\sum_{i=1}^n \\sum_{j<i} Cov(X_i, X_j)$
- If $X,Y$ Independent, $Cov(X,Y) = =0$

---

Sample Average:

for i.i.d. RV:

$\\bar{X} = \\sum_{i=1}^n X_i / n$

- $E[\\bar{X}]= \\mu$
- $Var(\\bar{X}) = \\sigma^2/n$
- $Cov(\\bar{X},X_i-\\bar{X})=0$

---

Convolution:

Discrete:

- $P_{X+Y }(a) = \\sum_{y=-\\infty }^{+\\infty }P_X(a-y)P_Y(y)$

Continuous
- $F_{X+Y }(a) = \\int_{-\\infty }^\\infty F_X(a-y) g(y)dy $

---

Multivariate Transformation

Given $ n $ random variables $ X_{1}, \\ldots, X_{n} $ with a known joint density function, we aim to compute the joint density function of the transformed variables $ Y_{1}, \\ldots, Y_{n} $, where:
- $ Y_{1}=g_{1}\\left(X_{1}, \\ldots, X_{n}\\right), \\ldots, Y_{n}=g_{n}\\left(X_{1}, \\ldots, X_{n}\\right) $,
- Each $ g_{i} $ has continuous partial derivatives,
- The Jacobian determinant $ J\\left(x_{1}, \\ldots, x_{n}\\right) $ is non-zero at all points $ \\left(x_{1}, \\ldots, x_{n}\\right) $,
- The system of equations $ y_{1}=g_{1}\\left(x_{1}, \\ldots, x_{n}\\right), \\ldots, y_{n}=g_{n}\\left(x_{1}, \\ldots, x_{n}\\right) $ has a unique solution $ x_{i}=h_{i}\\left(y_{1}, \\ldots, y_{n}\\right) $.

Jacobian Determinant:
$
J\\left(x_{1}, \\ldots, x_{n}\\right)=\\left|\\begin{array}{ccc}
\\frac{\\partial g_{1}}{\\partial x_{1}} & \\cdots & \\frac{\\partial g_{1}}{\\partial x_{n}} \\\\
\\vdots & \\ddots & \\vdots \\\\
\\frac{\\partial g_{n}}{\\partial x_{1}} & \\cdots & \\frac{\\partial g_{n}}{\\partial x_{n}}
\\end{array}\\right|
$

Joint Density Function of $ Y_{1}, \\ldots, Y_{n} $
$
f_{Y_{1}, \\ldots, Y_{n}}\\left(y_{1}, \\ldots, y_{n}\\right)=f_{X_{1}, \\ldots, X_{n}}\\left(h_{1}\\left(y_{1}, \\ldots, y_{n}\\right), \\ldots, h_{n}\\left(y_{1}, \\ldots, y_{n}\\right)\\right) \\cdot\\left|J\\left(h_{1}, \\ldots, h_{n}\\right)\\right|^{-1}
$
where $ |J|^{-1} $ is the absolute value of the reciprocal of the Jacobian determinant evaluated at $ x_{i}= $ $ h_{i}\\left(y_{1}, \\ldots, y_{n}\\right) $.

#### Example for Jacobian Matrix 

(1):

> Assume $X_1,X_2\\sim N(0,1$ i.i.d. and $Y_1 = X_1+X_2,Y_2 = X_1-X_2$

We have:

$ X_{1}=\\frac{Y_{1}+Y_{2}}{2}, \\quad X_{2}=\\frac{Y_{1}-Y_{2}}{2} $

The Jacobian Matrix:

$ J=\\left|\\begin{array}{ll}\\frac{\\partial Y_{1}}{\\partial X_{1}} & \\frac{\\partial Y_{1}}{\\partial X_{2}} \\\\ \\frac{\\partial Y_{2}}{\\partial X_{1}} & \\frac{\\partial Y_{2}}{\\partial X_{2}}\\end{array}\\right|=\\left|\\begin{array}{cc}1 & 1 \\\\ 1 & -1\\end{array}\\right|=-2 \\Longrightarrow|J|^{-1}=\\frac{1}{2} $

Therefore:

$ f_{Y_{1}, Y_{2}}\\left(y_{1}, y_{2}\\right)=f_{X_{1}, X_{2}}\\left(\\frac{y_{1}+y_{2}}{2}, \\frac{y_{1}-y_{2}}{2}\\right) \\cdot \\frac{1}{2} $

We have:

$ f_{X_{1}, X_{2}}\\left(x_{1}, x_{2}\\right)=\\frac{1}{2 \\pi} e^{-\\frac{x_{1}^{2}+x_{2}^{2}}{2}} $

Then we get:

$ f_{Y_{1}, Y_{2}}\\left(y_{1}, y_{2}\\right)=\\frac{1}{4 \\pi} e^{-\\frac{y_{1}^{2}+y_{2}^{2}}{4}} $

Therefore, $Y_1, Y_2\\sim N(0,2)$

---

(2)

> Assume $ U_{1}, U_{2} \\sim \\operatorname{Uniform}(0,1) $, and $ Y_{1}=\\sqrt{-2 \\ln U_{1}} \\cos \\left(2 \\pi U_{2}\\right), \\quad Y_{2}=\\sqrt{-2 \\ln U_{1}} \\sin \\left(2 \\pi U_{2}\\right) $

We have:

$ U_{1}=e^{-\\frac{Y_{1}^{2}+Y_{2}^{2}}{2}}, \\quad U_{2}=\\frac{1}{2 \\pi} \\arctan \\left(\\frac{Y_{2}}{Y_{1}}\\right) $

Then Jacobian Matrix:

$ |J|=\\frac{1}{2 \\pi} e^{-\\frac{Y_{1}^{2}+Y_{2}^{2}}{2}} $, therefore $ |J|^{-1}=2 \\pi e^{\\frac{Y_{1}^{2}+Y_{2}^{2}}{2}} $

$ f_{Y_{1}, Y_{2}}\\left(y_{1}, y_{2}\\right)=f_{U_{1}, U_{2}}\\left(u_{1}, u_{2}\\right) \\cdot|J|^{-1}=1 \\cdot 2 \\pi e^{\\frac{v_{1}^{2}+v_{2}^{2}}{2}} \\cdot \\frac{1}{2 \\pi} e^{-\\frac{v_{1}^{2}+v_{2}^{2}}{2}}=\\frac{1}{2 \\pi} e^{-\\frac{-v_{1}^{2}+v_{2}^{2}}{2}} $

Therefore, $Y_1, Y_2\\sim N(0,1)$

---

(3)

> Assume $ X_{1}, X_{2} \\sim \\operatorname{Exp}(\\lambda) $ and $ Y_{1}=\\frac{X_{1}}{X_{2}}, \\quad Y_{2}=X_{2} $

We have:

$ X_{1}=Y_{1} Y_{2}, \\quad X_{2}=Y_{2} $

For Jacobian Matrix:

$ J=\\left|\\begin{array}{cc}\\frac{\\partial X_{1}}{\\partial Y_{1}} & \\frac{\\partial X_{1}}{\\partial Y_{2}} \\\\ \\frac{\\partial X_{2}}{\\partial Y_{1}} & \\frac{\\partial X_{2}}{\\partial Y_{2}}\\end{array}\\right|=\\left|\\begin{array}{cc}Y_{2} & Y_{1} \\\\ 0 & 1\\end{array}\\right|=Y_{2} \\Longrightarrow|J|^{-1}=\\frac{1}{\\left|Y_{2}\\right|} $

Then:

$ f_{Y_{1}, Y_{2}}\\left(y_{1}, y_{2}\\right)=f_{X_{1}, X_{2}}\\left(y_{1} y_{2}, y_{2}\\right) \\cdot \\frac{1}{\\left|y_{2}\\right|}=\\lambda^{2} e^{-\\lambda\\left(y_{1} y_{2}+y_{2}\\right)} \\cdot y_{2} $



---

## Moment Generating Function

Moment Generating Function (MGF) of a Random Variable $ X $ :
$
\\phi(t)=E\\left(e^{t X}\\right)=\\left\\{\\begin{array}{ll}
\\sum_{x} e^{t x} p(x) & \\text { (for discrete random variables) } \\\\
\\int_{-\\infty}^{\\infty} e^{t x} f(x) d x & \\text { (for continuous random variables) }
\\end{array}\\right.
$

1. Calculating Moments:

$
E\\left[X^{n}\\right]=\\phi^{(n)}(0)
$

- $ \\phi^{(n)}(t) $ is the $ n $-th derivative of $ \\phi(t) $.

2. Sum of Independent Random Variables:

> The MGF of the sum of independent random variables is the product of their individual MGFs. 

That is, if $ X_{1}, X_{2}, \\ldots, X_{n} $ are independent, then:

$
\\phi_{X_{1}+X_{2}+\\cdots+X_{n}}(t)=\\phi_{X_{1}}(t) \\cdot \\phi_{X_{2}}(t) \\cdots \\phi_{X_{n}}(t)
$
3. Uniqueness of Distribution:

The moment generating function uniquely determines the probability distribution of a random variable (if it exists).

4. Connection to Laplace Transform:

For $ t \\geq 0 $ and a non-negative random variable $ X $, the function $ g(t)=\\phi(-t)\\in [0,1] $. This is related to the Laplace transform of the distribution of $ X $.

5. Joint MGF:
- $\\phi (t_1,\\dots, t_n) = E[e^{(t_1X_1+\\cdots+t_nX_n)}]$

--- 

**Binomial MGF**

$ M_{X}(t)=\\sum_{k=0}^{n} e^{t k}\\binom{n}{k} p^{k}(1-p)^{n-k}=\\sum_{k=0}^{n}\\binom{n}{k}\\left(p e^{t}\\right)^{k}(1-p)^{n-k} $

We get:

$ M_{X}(t)=\\left(p e^{t}+(1-p)\\right)^{n} $

**Poisson MGF**

$ M_{X}(t)=\\sum_{k=0}^{\\infty} e^{t k} \\frac{\\lambda^{k} e^{-\\lambda}}{k!}=e^{-\\lambda} \\sum_{k=0}^{\\infty} \\frac{\\left(\\lambda e^{t}\\right)^{k}}{k!} $

Then: 

$ M_{X}(t)=e^{-\\lambda} \\cdot e^{\\lambda e^{t}}=e^{\\lambda\\left(e^{t}-1\\right)} $

**Normal MGF**

$ M_{X}(t)=\\int_{-\\infty}^{\\infty} e^{t x} \\cdot \\frac{1}{\\sqrt{2 \\pi \\sigma^{2}}} e^{-\\frac{(x-\\mu)^{2}}{2 \\sigma^{2}}} d x $

Look at the power:

$ t x-\\frac{(x-\\mu)^{2}}{2 \\sigma^{2}}=-\\frac{x^{2}-2\\left(\\mu+\\sigma^{2} t\\right) x+\\mu^{2}}{2 \\sigma^{2}} $

Then: 

$ M_{X}(t)=e^{\\mu t+\\frac{\\sigma^{2} t^{2}}{2}} $

**Exponential MGF**

$ M_{X}(t)=\\int_{0}^{\\infty} e^{t x} \\cdot \\lambda e^{-\\lambda x} d x=\\lambda \\int_{0}^{\\infty} e^{-(\\lambda-t) x} d x $

Then: 

$ M_{X}(t)=\\lambda \\cdot \\frac{1}{\\lambda-t}=\\frac{\\lambda}{\\lambda-t} \\quad(t<\\lambda) $

**Gamma MGF**

$ M_{X}(t)=\\int_{0}^{\\infty} e^{t x} \\cdot \\frac{\\lambda^{\\alpha}}{\\Gamma(\\alpha)} x^{\\alpha-1} e^{-\\lambda x} d x=\\frac{\\lambda^{\\alpha}}{(\\lambda-t)^{\\alpha}} \\cdot \\frac{\\Gamma(\\alpha)}{\\Gamma(\\alpha)} $

Then:

$ M_{X}(t)=\\left(\\frac{\\lambda}{\\lambda-t}\\right)^{\\alpha} $


## Theorem

### 1. Markov's Inequality (Proposition 2.6)

Statement:
Let $ X $ be a non-negative random variable. For any $ a>0 $ :
$
P\\{X \\geq a\\} \\leq \\frac{E\\lfloor X]}{a}
$

Proof:
Define the indicator function:
$
I_{\\{X \\geq a\\}}=\\left\\{\\begin{array}{ll}
1 & \\text { if } X \\geq a \\\\
0 & \\text { otherwise }
\\end{array}\\right.
$

Since $ X \\geq a \\cdot I_{\\{X \\geq a\\}} $, taking expectations on both sides:
$
E[X] \\geq E\\left[a \\cdot I_{\\{X \\geq a\\}}\\right]=a \\cdot P\\{X \\geq a\\}
$

Rearranging gives:
$
P\\{X \\geq a\\} \\leq \\frac{E[X]}{a}
$

### 2. Chebyshev's Inequality (Proposition 2.7)

Statement:
Let $ X $ be a random variable with mean $ \\mu $ and variance $ \\sigma^{2} $. For any $ k>0 $ :
$
P\\{|X-\\mu| \\geq k\\} \\leq \\frac{\\sigma^{2}}{k^{2}}
$

Proof:
Apply Markov's Inequality to the non-negative random variable $ (X-\\mu)^{2} $ :
$
P\\{|X-\\mu| \\geq k\\}=P\\left\\{(X-\\mu)^{2} \\geq k^{2}\\right\\} \\leq \\frac{E\\left[(X-\\mu)^{2}\\right]}{k^{2}}=\\frac{\\sigma^{2}}{k^{2}}
$

### 3. Strong Law of Large Numbers (Theorem 2.1)

Statement:
Let $ X_{1}, X_{2}, \\ldots $ be independent and identically distributed (i.i.d.) random variables with mean $ \\mu $. Then, as $ n \\rightarrow \\infty $ :
$
\\frac{X_{1}+X_{2}+\\cdots+X_{n}}{n} \\rightarrow \\mu \\quad \\text { with probability } 1 .
$

Proof Sketch (Simplified):
The full proof requires advanced tools (e.g., Borel-Cantelli lemma or martingale convergence). A key idea is to show that the sample mean converges almost surely by bounding the variance of partial sums. For i.i.d. variables:
1. Convergence in $ L^{2} $ :
$
\\operatorname{Var}\\left(\\frac{X_{1}+\\cdots+X_{n}}{n}\\right)=\\frac{\\sigma^{2}}{n} \\rightarrow 0 \\quad \\text { as } n \\rightarrow \\infty .
$
2. Borel-Cantelli Lemma:

For $ \\epsilon>0 $, use Chebyshev's inequality to show:
$
\\sum_{n=1}^{\\infty} P\\left(\\left|\\frac{S_{n}}{n}-\\mu\\right| \\geq \\epsilon\\right)<\\infty
$
implying almost sure convergence.

### 4. Central Limit Theorem (Theorem 2.2)

Statement:
Let $ X_{1}, X_{2}, \\ldots $ be i.i.d. random variables with mean $ \\mu $ and variance $ \\sigma^{2} $. As $ n \\rightarrow \\infty $, the distribution of the standardized sum converges to the standard normal distribution:
$
\\frac{X_{1}+\\cdots+X_{n}-n \\mu}{\\sqrt{n} \\sigma} \\xrightarrow{d} N(0,1) .
$

Equivalently:
$
P\\left\\{\\frac{X_{1}+\\cdots+X_{n}-n \\mu}{\\sqrt{n} \\sigma} \\leq a\\right\\} \\rightarrow \\frac{1}{\\sqrt{2 \\pi}} \\int_{-\\infty}^{a} e^{-x^{2} / 2} d x
$

Proof Sketch (Using Moment Generating Functions):
1. Standardization:

Let $ Y_{i}=\\frac{X_{i}-\\mu}{\\sigma} $, so $ E\\left[Y_{i}\\right]=0, \\operatorname{Var}\\left(Y_{i}\\right)=1 $.

2. MGF of the Sum:

The MGF of $ S_{n}=\\frac{Y_{1}+\\cdots+Y_{n}}{\\sqrt{n}} $ is:
$
M_{S_{n}}(t)=\\left(M_{Y}\\left(\\frac{t}{\\sqrt{n}}\\right)\\right)^{n}
$

3. Taylor Expansion:

Expand $ M_{Y}\\left(\\frac{t}{\\sqrt{n}}\\right) $ around $ t=0 $ :
$
M_{Y}\\left(\\frac{t}{\\sqrt{n}}\\right)=1+\\frac{t^{2}}{2 n}+o\\left(\\frac{1}{n}\\right)
$

4. Limit as $ n \\rightarrow \\infty $ :
$
\\lim _{n \\rightarrow \\infty} M_{S_{n}}(t)=e^{t^{2} / 2}
$
which is the MGF of $ N(0,1) $. By uniqueness of MGFs, the result follows.

### 5. Composed Random Variable Equality

For all $h$:

$ 
\\mathrm{E}\\left[S_{N} h\\left(S_{N}\\right)\\right]=\\mathrm{E}[N] \\mathrm{E}\\left[X_{1} h\\left(S_{M}\\right)\\right]
$

Where:

$P\\{M=n\\} = \\dfrac{nP\\{N=n\\}}{E[N]}$

Proof:

$$
\\begin{aligned}
&\\mathrm{E}\\left[S_{N} h\\left(S_{N}\\right)\\right]\\\\ 
&=\\mathrm{E}\\left[\\sum_{i=1}^{N} X_{i} h\\left(S_{N}\\right)\\right] \\\\ 
& =\\sum_{n=0}^{\\infty} \\mathrm{E}\\left[\\sum_{i=1}^{n} X_{i} h\\left(S_{N}\\right) \\mid N=n\\right] \\cdot \\mathrm{P}\\{N=n\\} \\\\ 
& = \\sum_{n=0}^{\\infty} n \\cdot \\mathrm{E}\\left[X_{1} h\\left(S_{n}\\right)\\right] \\cdot \\mathrm{P}\\{N=n\\} \\\\ 
&= \\mathrm{E}[N] \\cdot \\sum_{n=0}^{\\infty} \\mathrm{E}\\left[X_{1} h\\left(S_{n}\\right)\\right] \\cdot \\frac{n \\mathrm{P}\\{N=n\\}}{\\mathrm{E}[N]}\\\\ 
&=\\mathrm{E}[N] \\mathrm{E}\\left[X_{1} h\\left(S_{M}\\right)\\right]
\\end{aligned}
$$

### 6. A corollary

$
\\begin{array}{l}
\\mathrm{P}\\left\\{S_{N}=0\\right\\}=\\mathrm{P}\\{N=0\\} \\\\
\\mathrm{P}\\left\\{S_{N}=k\\right\\}=\\frac{1}{k} \\mathrm{E}[N] \\sum_{j=1}^{k} j \\alpha_{j} \\mathrm{P}\\left\\{S_{M-1}=k-j\\right\\}, \\quad k>0
\\end{array}
$

Proof:

Choose $h$ as indicator function, we get:

$ \\mathrm{P}\\left\\{S_{N}=k\\right\\}=\\frac{\\mathrm{E}[N]}{k} \\cdot \\mathrm{E}\\left[X_{1} \\mathbf{1}_{\\left\\{S_{M}=k\\right\\}}\\right] $

Then for RHS:

$$
\\begin{aligned}
& \\mathrm{E}\\left[X_{1} \\mathbf{1}_{\\left\\{S_{M}=k\\right\\}}\\right] \\\\ 
&=\\sum_{n=1}^{\\infty} \\mathrm{P}\\{M=n\\} \\cdot \\mathrm{E}\\left[X_{1} \\mathbf{1}_{\\left\\{S_{M}=k\\right\\}} \\mid M=n\\right] \\\\
& =\\sum_{n=1}^{\\infty} \\mathrm{P}\\{M=n\\}  \\cdot \\mathrm{E}\\left[X_{1} \\mathbf{1}_{\\left\\{S_{n}=k\\right\\}}\\right]\\\\
&=\\sum_{n=1}^{\\infty} \\mathrm{P}\\{M=n\\}  \\cdot \\sum_{j=1}^{k} j \\alpha_{j} \\cdot \\mathrm{P}\\left\\{S_{n-1}=k-j\\right\\} \\\\ 
& =\\sum_{j=1}^{k} j \\alpha_{j} \\cdot \\sum_{n=1}^{\\infty} \\mathrm{P}\\{M=n\\} \\cdot \\mathrm{P}\\left\\{S_{n-1}=k-j\\right\\} \\\\
&=\\sum_{j=1}^{k} j \\alpha_{j} \\cdot \\mathrm{P}\\left\\{S_{M-1}=k-j\\right\\}\\\\  
\\end{aligned}
$$

Finally:

$ \\mathrm{P}\\left\\{S_{N}=k\\right\\}=\\frac{\\mathrm{E}[N]}{k} \\cdot \\sum_{j=1}^{k} j \\alpha_{j} \\cdot \\mathrm{P}\\left\\{S_{M-1}=k-j\\right\\} $





placeholder


placeholder

placeholder

placeholder

placeholder

placeholder

`,__vite_glob_0_82=`---
title: Stochastic Progress - Week 10
category: Notes
---

# Continuous-time Markov chain 

1. Index Set:
- Time $ t $ is continuous ( $ t \\geq 0 $ ), unlike discrete steps in DTMCs.
- This is the key difference: transitions can occur at any real-valued time.
2. State Space:
- Discrete (finite or countably infinite), typically non-negative integers.
- The chain still "jumps" between distinct states (like DTMCs).
3. Random Variables:
- $ X(0) $ (initial state) and $ X(t) $ (state at time $ t $ ) are discrete random variables.
- Key behavior: Upon entering a state $ i $, the process stays there for a random holding time before jumping to another state.
- This exponentially distributed dwell time is a defining trait of CTMCs.
4. Markov \\& Time-Homogeneous Properties:
- For all $ s, t \\geq 0,0 \\leq u<s $, and states $ i, j, x(u) $ :
$
P\\{X(s+t)=j \\mid X(s)=i, X(u)=x(u), 0 \\leq u<s\\}=P\\{X(s+t)=j \\mid X(s)=i\\}
$
(Markov property: Future depends only on the present state, not past history).
o If time-homogeneous:
$
P\\{X(s+t)=j \\mid X(s)=i\\}=P\\{X(t)=j \\mid X(0)=i\\}=P_{i j}(t),
$
where $ P_{i j}(t) $ is the transition probability from state $ i $ to $ j $ in time $ t $.

# Definition 2 on transition probabilities:

1. Exponential Holding Times:
- Upon entering state $ i $, the process stays there for an exponentially distributed time with rate $ v_{i} $ (mean holding time $ 1 / v_{i} $ ).
- The memoryless property of the exponential distribution ensures the Markov property.
2. State Transitions:
- When leaving state $ i $, the process jumps to another state $ j \\neq i $ with probability $ P_{i j} $.
o Transition probabilities satisfy:
$
P_{i i}=0 \\quad \\text { (no self-transitions) }, \\quad \\sum_{j \\neq i} P_{i j}=1 \\quad \\text { (must move to another state) }
$
3. Independence of Timing and Destination:
- The holding time in state $ i $ and the next state $ j $ are independent random variables.
- This separation simplifies analysis and aligns with the Markov property.

# Birth-Death Process:

A birth-death process is a continuous-time Markov chain (CTMC) where the state $ X(t) $ represents the current population size in a system. The process evolves through two fundamental events: births (arrivals) and deaths (departures), with the following key properties:

## Definition 

1. State Transitions:
- From state $ n $, the process can only transition to:
- $ n+1 $ (a birth, arrival at rate $ \\lambda_{n} $ )
- $ n-1 $ (a death, departure at rate $ \\mu_{n} $ ).
- No other transitions are allowed (e.g., no jumps of size >1).
2. Exponential Timing:
- Births: The time until the next arrival is exponentially distributed with rate $ \\lambda_{n} $ (mean $ 1 / \\lambda_{n} $ ).
- Deaths: The time until the next departure is exponentially distributed with rate $ \\mu_{n} $ (mean $ 1 / \\mu_{n} $ ).
- Independence: The birth and death times are mutually independent.
3. Boundary Condition:
- $ \\mu_{0}=0 $ : No departures can occur from state 0 (extinction).
4. Rates:
- Birth rates: $ \\left\\{\\lambda_{n}\\right\\}_{n=0}^{\\infty} $ (arrival rates when in state $ n $ ).
- Death rates: $ \\left\\{\\mu_{n}\\right\\}_{n=1}^{\\infty} $ (departure rates when in state $ n $ ).

## Yule Process

A **pure birth process** where:

1. Population Dynamics:
- Each existing member independently produces new members at rate $ \\lambda $.
- No deaths: The population only increases (pure birth process).
2. Exponential Growth:
- The time until a member produces a new member follows $ \\operatorname{Exp}(\\lambda) $ (mean $ 1 / \\lambda $ ).
- With $ n $ members, the total birth rate is $ \\lambda_{n}=n \\lambda $ (each of the $ n $ members contributes rate $ \\lambda $ ).
3. Process Definition:
- $ X(t) $ : Population size at time $ t $.
o $ \\{X(t), t \\geq 0\\} $ is a pure birth process with $ \\lambda_{n}=n \\lambda $.

## Example 

We consider a birth-death process with the following transition rates:
- Birth rate: $ \\lambda_{n}=n \\lambda+\\theta $ for $ n \\geq 0 $
- Death rate: $ \\mu_{n}=n \\mu $ for $ n \\geq 1 $, with $ \\mu_{0}=0 $

The goal is to compute the expected population size $ M(t)=E[X(t)] $ at time $ t $, where $ X(t) $ represents the number of individuals in the system.

### Solution

$ \\frac{d M}{d t}=(\\lambda-\\mu) M(t)+\\theta $

Then:

$ M(t)=k e^{(\\lambda-\\mu) t}+\\frac{\\theta}{\\lambda-\\mu}\\left(e^{(\\lambda-\\mu) t}-1\\right) $

## Example 2

Consider a homogeneous birth-death process with constant birth rate $ \\lambda_{i}=\\lambda $ (for all $ i \\geq 0 $ ) and constant death rate $ \\mu_{i}=\\mu $ (for all $ i \\geq 1 $ ), where $ k<j $. The expected time to transition from state $ k $ to state $ j $ is derived as follows:

### Solution

$ E\\left[T_{i, i+1} \\mid I_{i, i+1}=1\\right]=\\frac{1}{\\lambda_{i}+\\mu_{i}} $

$ E\\left[T_{i, i+1} \\mid I_{i, i+1}=0\\right]=\\frac{1}{\\lambda_{i}+\\mu_{i}}+E\\left[T_{i-1, i}\\right]+E\\left[T_{i, i+1}\\right] $

Then:

$ E\\left[T_{i, i+1} \\mid I_{i, i+1}=0\\right]=\\frac{1}{\\lambda_{i}+\\mu_{i}}+E\\left[T_{i-1, i}\\right]+E\\left[T_{i, i+1}\\right] $

- Case 1: $ \\lambda=\\mu $
$
E_{i}=\\frac{i+1}{\\lambda}, \\quad i \\geq 0
$
- Case 2: $ \\lambda \\neq \\mu $

Let $ r=\\mu / \\lambda $. Then:
$
E_{i}=\\frac{1-r^{i+1}}{\\lambda-\\mu}, \\quad i \\geq 0
$

- Case 1: $ \\lambda=\\mu $
$
\\sum_{i=k}^{j-1} E_{i}=\\sum_{i=k}^{j-1} \\frac{i+1}{\\lambda}=\\frac{1}{\\lambda} \\sum_{m=k+1}^{j} m=\\frac{(k+j+1)(j-k)}{2 \\lambda}
$
- Case 2: $ \\lambda \\neq \\mu $
$
\\sum_{i=k}^{j-1} E_{i}=\\sum_{i=k}^{j-1} \\frac{1-r^{i+1}}{\\lambda-\\mu}=\\frac{1}{\\lambda-\\mu}\\left[(j-k)-\\sum_{i=k}^{j-1} r^{i+1}\\right]
$

The geometric series sums to:
$
\\sum_{i=k}^{j-1} r^{i+1}=r^{k+1} \\frac{1-r^{j-k}}{1-r}=\\frac{\\lambda}{\\lambda-\\mu}\\left(r^{k+1}-r^{j+1}\\right)
$

Substituting $ r=\\mu / \\lambda $ :
$
\\sum_{i=k}^{j-1} E_{i}=\\frac{1}{\\lambda-\\mu}\\left[(j-k)-\\frac{\\lambda}{\\lambda-\\mu}\\left(\\left(\\frac{\\mu}{\\lambda}\\right)^{k+1}-\\left(\\frac{\\mu}{\\lambda}\\right)^{j+1}\\right)\\right] .
$

## Example 3

Consider a pure birth process $ \\{X(t), t \\geq 0\\} $ where:
- The process starts in state $ i $ at time 0 .
- Transitions occur only from state $ n $ to state $ n+1 $ (no deaths or downward transitions).
- The birth rate in state $ n $ is $ \\lambda_{n}>0 $.
- Distinct birth rates: $ \\lambda_{r} \\neq \\lambda_{s} $ for all $ r \\neq s $ (all birth rates are unique).

Under these conditions, the transition probability $ P_{i j}(t)=P(X(t)=j \\mid X(0)=i) $ has an explicit closed-form expression.

### Solution

Consider a pure birth process $ \\{X(t), t \\geq 0\\} $ where:
- The process starts in state $ i $ at time 0 .
- Transitions occur only from state $ n $ to state $ n+1 $ (no deaths or downward transitions).
- The birth rate in state $ n $ is $ \\lambda_{n}>0 $.
- Distinct birth rates: $ \\lambda_{r} \\neq \\lambda_{s} $ for all $ r \\neq s $ (all birth rates are unique).

Under these conditions, the transition probability $ P_{i j}(t)=P(X(t)=j \\mid X(0)=i) $ has an explicit closed-form expression.

1. Probability of remaining in the same state $ (i=j) $ :
$
P_{i i}(t)=e^{-\\lambda_{i} t}
$

This is the probability that no birth occurs by time $ t $, which follows from the exponential holding time in state $ i $ with rate $ \\lambda_{i} $.
2. Probability of transitioning to a higher state $ (i<j) $ :
$
P_{i j}(t)=\\sum_{k=i}^{j} e^{-\\lambda_{k} t} \\prod_{\\substack{r=i \\\\ r \\neq k}}^{j} \\frac{\\lambda_{r}}{\\lambda_{r}-\\lambda_{k}}-\\sum_{k=i}^{j-1} e^{-\\lambda_{k} t} \\prod_{\\substack{r=i \\\\ r \\neq k}}^{j-1} \\frac{\\lambda_{r}}{\\lambda_{r}-\\lambda_{k}}
$

Step 1: Kolmogorov Forward Equations
For a pure birth process:
- Transitions occur only from state $ n $ to $ n+1 $ at rate $ \\lambda_{n} $.
- The forward equations for $ P_{i j}(t)=P(X(t)=j \\mid X(0)=i) $ are:
$
\\frac{d}{d t} P_{i j}(t)=\\left\\{\\begin{array}{ll}
-\\lambda_{j} P_{i j}(t)+\\lambda_{j-1} P_{i, j-1}(t) & \\text { if } j>i \\\\
-\\lambda_{i} P_{i i}(t) & \\text { if } j=i
\\end{array}\\right.
$
- Initial condition: $ P_{i j}(0)=\\delta_{i j} $.

Step 2: Solve for $ P_{i i}(t) $
- For $ j=i $ :
$
\\frac{d}{d t} P_{i i}(t)=-\\lambda_{i} P_{i i}(t), \\quad P_{i i}(0)=1
$
- Solution:
$
P_{i i}(t)=e^{-\\lambda_{i} t} .
$

Step 3: Laplace Transform of Forward Equations
Define the Laplace transform:
$
\\phi_{i j}(s)=\\mathcal{L}\\left\\{P_{i j}(t)\\right\\}=\\int_{0}^{\\omega} e^{-s t} P_{i j}(t) d t, \\quad \\operatorname{Re}(s)>0
$
- For $ j>i $, the forward equation becomes:
$
s \\phi_{i j}(s)-\\delta_{i j}=-\\lambda_{j} \\phi_{i j}(s)+\\lambda_{j-1} \\phi_{i, j-1}(s)
$
- Since $ j>i, \\delta_{i j}=0 $ :
$
\\left(s+\\lambda_{j}\\right) \\phi_{i j}(s)=\\lambda_{j-1} \\phi_{i, j-1}(s)
$
- Recursive relation:
$
\\phi_{i j}(s)=\\frac{\\lambda_{j-1}}{s+\\lambda_{j}} \\phi_{i, j-1}(s)
$

Step 4: Solve Recursively for $ \\phi_{i j}(s) $
- Base case $ (j=i) $ :
$
\\phi_{i i}(s)=\\mathcal{L}\\left\\{e^{-\\lambda_{i} t}\\right\\}=\\frac{1}{s+\\lambda_{i}}
$
- For $ j=i+1 $ :
$
\\phi_{i, i+1}(s)=\\frac{\\lambda_{i}}{s+\\lambda_{i+1}} \\cdot \\frac{1}{s+\\lambda_{i}}
$
- For $ j=i+2 $ :
$
\\phi_{i, i+2}(s)=\\frac{\\lambda_{i+1}}{s+\\lambda_{i+2}} \\cdot \\frac{\\lambda_{i}}{s+\\lambda_{i+1}} \\cdot \\frac{1}{s+\\lambda_{i}} .
$
- General pattern:
$
\\phi_{i j}(s)=\\left[\\prod_{k=i}^{j-1} \\lambda_{k}\\right] \\cdot \\prod_{k=i}^{j} \\frac{1}{s+\\lambda_{k}}
$

Step 5: Inverse Laplace Transform via Partial Fractions
To find $ P_{i j}(t)=\\mathcal{L}^{-1}\\left\\{\\phi_{i j}(s)\\right\\} $, decompose:
$
\\phi_{i j}(s)=\\prod_{k=i}^{j} \\frac{1}{s+\\lambda_{k}} \\cdot \\prod_{k=i}^{j-1} \\lambda_{k}=C \\sum_{k=i}^{j} \\frac{A_{k}}{s+\\lambda_{k}},
$
where $ C=\\prod_{k=i}^{j-1} \\lambda_{k} $, and $ A_{k} $ are residues.
- Residue for pole $ s=-\\lambda_{k} $ :
$
A_{k}=\\lim _{s \\rightarrow-\\lambda_{k}}\\left(s+\\lambda_{k}\\right) \\prod_{m=i}^{j} \\frac{1}{s+\\lambda_{m}}=\\prod_{\\substack{m=i \\\\ m \\neq k}}^{j} \\frac{1}{\\lambda_{m}-\\lambda_{k}}
$
- Since $ \\lambda_{m} \\neq \\lambda_{k} $ for $ m \\neq k $, this is well-defined. Thus:
$
\\phi_{i j}(s)=C \\sum_{k=i}^{j}\\left[\\prod_{\\substack{m=i \\\\ m \\neq k}}^{j} \\frac{1}{\\lambda_{m}-\\lambda_{k}}\\right] \\frac{1}{s+\\lambda_{k}} .
$

Step 6: Apply Inverse Laplace Transform
- The inverse transform of $ \\frac{1}{s+\\lambda_{k}} $ is $ e^{-\\lambda_{k} t} $.
- Thus:
$
P_{i j}(t)=\\left[\\prod_{k=i}^{j-1} \\lambda_{k}\\right] \\sum_{k=i}^{j}\\left[\\prod_{\\substack{m=i \\\\ m \\neq k}}^{j} \\frac{1}{\\lambda_{m}-\\lambda_{k}}\\right] e^{-\\lambda_{k} t} .
$
- Simplify the product:
$
\\prod_{k=i}^{j-1} \\lambda_{k} \\cdot \\prod_{\\substack{m=i \\\\ m \\neq k}}^{j} \\frac{1}{\\lambda_{m}-\\lambda_{k}}=\\prod_{\\substack{m=i \\\\ m \\neq k}}^{j} \\frac{\\lambda_{m}}{\\lambda_{m}-\\lambda_{k}} \\cdot \\frac{1}{\\lambda_{j}} \\quad \\text { (adjust indices). }
$
- Final adjustment:

The expression in Proposition 6.1 is equivalent after reindexing and combining terms. For $ i<j $ :
$
P_{i j}(t)=\\sum_{k=i}^{j} e^{-\\lambda_{k} t} \\prod_{\\substack{r=i \\\\ r \\neq k}}^{j} \\frac{\\lambda_{r}}{\\lambda_{r}-\\lambda_{k}}-\\sum_{k=i}^{j-1} e^{-\\lambda_{k} t} \\prod_{\\substack{r=i \\\\ r \\neq k}}^{j-1} \\frac{\\lambda_{r}}{\\lambda_{r}-\\lambda_{k}} .
$



`,__vite_glob_0_83=`---
title: Stochastic Progress - Week 11
category: Notes
---



# $P_{ij}(t)$

$ 1-P_{i i}(h)=\\sum_{j \\neq i} P_{i j}(h)=v_{i} h+o(h) $

Then we get:

$ v_{i}=\\lim _{h \\rightarrow 0} \\frac{1-P_{i i}(h)}{h} $

---

$ P_{i j}(h)=P_{i j} \\cdot\\left(v_{i} h+o(h)\\right)+o(h)=P_{i j} v_{i} h+o(h) $

Then we get:

$ P_{i j}=\\lim _{h \\rightarrow 0} \\frac{P_{i j}(h)}{v_{i} h}=\\lim _{h \\rightarrow 0} \\frac{P_{i j}(h)}{1-P_{i i}(h)} $

# $q_{ij}$

$ q_{i j}=v_{i} P_{i j} $

$ v_{i}=v_{i} \\sum_{j} P_{i j}=\\sum_{j} v_{i} P_{i j}=\\sum_{j} q_{i j} $

$ P_{i j}=\\frac{q_{i j}}{v_{i}}=\\frac{q_{i j}}{\\sum_{j} q_{i j}} $

## CK Formula

$ P_{i j}(t+s)=\\sum_{k=0}^{\\infty} P_{i k}(t) P_{k j}(s) $

# Kolmogorov Backward Equation

For all states $ i, j $ and time $ t \\geq 0 $,
$$
P_{i j}^{\\prime}(t)=\\sum_{k \\neq i} q_{i k} P_{k j}(t)-v_{i} P_{i j}(t)
$$
where:
- $ P_{i j}(t) $ is the transition probability from state $ i $ to $ j $ by time $ t $,
- $ q_{i k} $ is the entry of the infinitesimal generator matrix $ Q\\left(q_{i k}=v_{i} P_{i k}\\right. $ for $ \\left.k \\neq i\\right) $,
- $ v_{i}=-q_{i i} $ is the exit rate from state $ i $.

## Proof

$$
P_{i j}(t+h)=\\sum_{k} P_{i k}(h) P_{k j}(t)
$$

Separate the sum:
$$
P_{i j}(t+h)=P_{i i}(h) P_{i j}(t)+\\sum_{k \\neq i} P_{i k}(h) P_{k j}(t)
$$

Substitute asymptotic expressions:
$$
P_{i j}(t+h)=\\left(1-v_{i} h+o(h)\\right) P_{i j}(t)+\\sum_{k \\neq i}\\left(q_{i k} h+o(h)\\right) P_{k j}(t)
$$

Expand:
$$
P_{i j}(t+h)=P_{i j}(t)-v_{i} h P_{i j}(t)+h \\sum_{k \\neq i} q_{i k} P_{k j}(t)+o(h)
$$

Rearrange:
$$
\\frac{P_{i j}(t+h)-P_{i j}(t)}{h}=\\sum_{k \\neq i} q_{i k} P_{k j}(t)-v_{i} P_{i j}(t)+\\frac{o(h)}{h}
$$

Take limit $ h \\rightarrow 0 $ :
$$
\\lim _{h \\rightarrow 0} \\frac{P_{i j}(t+h)-P_{i j}(t)}{h}=P_{i j}^{\\prime}(t)=\\sum_{k \\neq i} q_{i k} P_{k j}(t)-v_{i} P_{i j}(t)
$$

# Pure birth euqation 

$ P_{i j}^{\\prime}(t)=\\lambda_{i} P_{i+1, j}(t)-\\lambda_{i} P_{i j}(t) $

# Birth-death equation

$ P_{0 j}^{\\prime}(t)=\\lambda_{0} P_{1 j}(t)-\\lambda_{0} P_{0 j}(t)=\\lambda_{0}\\left(P_{1 j}(t)-P_{0 j}(t)\\right) $,

$ \\begin{array}{c}P_{0 j}^{\\prime}(t)=\\lambda_{0} P_{1 j}(t)-\\lambda_{0} P_{0 j}(t)=\\lambda_{0}\\left(P_{1 j}(t)-P_{0 j}(t)\\right) \\\\ P_{i j}^{\\prime}(t)=\\left(\\lambda_{i}+\\mu_{i}\\right)\\left[\\frac{\\lambda_{i}}{\\lambda_{i}+\\mu_{i}} P_{i+1, j}(t)+\\frac{\\mu_{i}}{\\lambda_{i}+\\mu_{i}} P_{i-1, j}(t)\\right]-\\left(\\lambda_{i}+\\mu_{i}\\right) P_{i j}(t), \\mathrm{i}>0\\end{array} $

# Kolmogorov Forward Equation

For most continuous-time Markov chains, the transition probabilities satisfy for all states $ i, j $ and time $ t \\geq 0 $ :
$$
P_{i j}^{\\prime}(t)=\\sum_{k \\neq j} P_{i k}(t) q_{k j}-P_{i j}(t) v_{j}
$$
where $ q_{k j} $ are entries of the infinitesimal generator matrix $ Q $, and $ v_{j}=-q_{j j} $ is the exit rate from state $ j $.

## Proof

Step 1: Chapman-Kolmogorov Equation
$$
P_{i j}(t+h)=\\sum_{k} P_{i k}(t) P_{k j}(h) .
$$

Step 2: Separate the \\( j \\)-Term
$$
P_{i j}(t+h)=P_{i j}(t) P_{j j}(h)+\\sum_{k \\neq j} P_{i k}(t) P_{k j}(h) .
$$

Step 3: Asymptotic Behavior as \\( h \\rightarrow 0 \\)
- \\( P_{j j}(h)=1-v_{j} h+o(h) \\),
- \\( P_{k j}(h)=q_{k j} h+o(h) \\) for \\( k \\neq j \\).

Substitute:
$$
P_{i j}(t+h)=P_{i j}(t)\\left(1-v_{j} h+o(h)\\right)+\\sum_{k \\neq j} P_{i k}(t)\\left(q_{k j} h+o(h)\\right) .
$$

Step 4: Expand and Rearrange
$$
P_{i j}(t+h)=P_{i j}(t)-v_{j} h P_{i j}(t)+h \\sum_{k \\neq j} P_{i k}(t) q_{k j}+o(h) .
$$

Step 5: Form the Derivative
$$
\\frac{P_{i j}(t+h)-P_{i j}(t)}{h}=\\sum_{k \\neq j} P_{i k}(t) q_{k j}-v_{j} P_{i j}(t)+\\frac{o(h)}{h} .
$$

Step 6: Take Limit \\( h \\rightarrow 0 \\)
$$
\\lim _{h \\rightarrow 0} \\frac{P_{i j}(t+h)-P_{i j}(t)}{h}=P_{i j}^{\\prime}(t)=\\sum_{k \\neq j} P_{i k}(t) q_{k j}-v_{j} P_{i j}(t) .
$$

# Pure birth equation 

For a pure birth process, the transition probabilities satisfy:
$$
\\begin{array}{c}
P_{i i}^{\\prime}(t)=-\\lambda_{i} P_{i i}(t) \\\\
P_{i j}^{\\prime}(t)=\\lambda_{j-1} P_{i, j-1}(t)-\\lambda_{j} P_{i j}(t), \\quad j \\geq i+1
\\end{array}
$$
with initial conditions:
$$
\\begin{array}{c}
P_{i i}(0)=1 \\\\
P_{i j}(0)=0, \\quad j \\neq i
\\end{array}
$$

The solution to these differential equations is (recursively):
$$
\\begin{array}{c}
P_{i i}(t)=e^{-\\lambda_{i} t}, \\quad i \\geq 0 \\\\
P_{i i}(t)=\\lambda_{i-1} e^{-\\lambda_{j} t} \\int_{0}^{t} e^{\\lambda_{j} s} P_{i, j-1}(s) d s, \\quad j \\geq i+1
\\end{array}
$$

## Proof 

Step 1: Prove \\( P_{i i}(t)=e^{-\\lambda_{i} t} \\)
- Differential Equation:
$$
P_{i i}^{\\prime}(t)=-\\lambda_{i} P_{i i}(t), \\quad P_{i i}(0)=1 .
$$
- Solution:

This is a first-order linear ODE. Separating variables:
$$
\\frac{d P_{i i}}{P_{i i}}=-\\lambda_{i} d t \\Longrightarrow \\ln P_{i i}=-\\lambda_{i} t+C
$$

Apply \\( P_{i i}(0)=1 \\) :
$$
\\ln 1=0+C \\Longrightarrow C=0 \\Longrightarrow P_{i i}(t)=e^{-\\lambda_{i} t} \\text {. }
$$

Step 2: Prove \\( P_{i j}(t)=\\lambda_{j-1} e^{-\\lambda_{j} t} \\int_{0}^{t} e^{\\lambda_{j} s} P_{i, j-1}(s) d s \\) for \\( j \\geq i+1 \\)
- Differential Equation:
$$
P_{i j}^{\\prime}(t)=\\lambda_{j-1} P_{i, j-1}(t)-\\lambda_{j} P_{i j}(t), \\quad P_{i j}(0)=0 . \\quad(j \\geq i+1)
$$
- Solution:

Rewrite as a first-order linear nonhomogeneous ODE:
$$
P_{i j}^{\\prime}(t)+\\lambda_{j} P_{i j}(t)=\\lambda_{j-1} P_{i, j-1}(t)
$$

Multiply by the integrating factor \\( e^{\\lambda_{j} t} \\) :
$$
e^{\\lambda_{j} t} P_{i j}^{\\prime}(t)+\\lambda_{j} e^{\\lambda_{j} t} P_{i j}(t)=\\lambda_{j-1} P_{i, j-1}(t) e^{\\lambda_{j} t}
$$

The left side is the derivative of \\( e^{\\lambda_{j} t} P_{i j}(t) \\) :
$$
\\frac{d}{d t}\\left[e^{\\lambda_{j} t} P_{i j}(t)\\right]=\\lambda_{j-1} P_{i, j-1}(t) e^{\\lambda_{j} t}
$$

Integrate both sides from 0 to \\( t \\) :
$$
e^{\\lambda_{j} t} P_{i j}(t)-\\underbrace{e^{0} P_{i j}(0)}_{=0}=\\lambda_{j-1} \\int_{0}^{t} e^{\\lambda_{j} s} P_{i, j-1}(s) d s
$$

Solve for \\( P_{i j}(t) \\) :
$$
P_{i j}(t)=\\lambda_{j-1} e^{-\\lambda_{j} t} \\int_{0}^{t} e^{\\lambda_{j} s} P_{i, j-1}(s) d s
$$

Step 3: Verify Initial Conditions
- For \\( P_{\\mathrm{i} i}(t) \\) :
$$
P_{i i}(0)=e^{-\\lambda_{i} \\cdot U}=e^{U}=1
$$
- For \\( P_{i j}(t)(j \\neq i) \\) :
$$
P_{i j}(0)=\\lambda_{j-1} e^{0} \\int_{0}^{U} e^{\\lambda_{j} s} P_{i, j-1}(s) d s=0
$$
- The solution satisfies \\( P_{i j}(0)=0 \\) for \\( j \\neq i \\).

# Birth-death equation

For a general birth-death process, the forward Kolmogorov equations are:
$$
\\begin{array}{c}
P_{i 0}^{\\prime}(t)=\\sum_{k \\neq 0} q_{k 0} P_{i k}(t)-\\lambda_{0} P_{i 0}(t)=\\mu_{1} P_{i 1}(t)-\\lambda_{0} P_{i 0}(t) \\\\
P_{i j}^{\\prime}(t)=\\sum_{k \\neq j} q_{k j} P_{i k}(t)-\\left(\\lambda_{j}+\\mu_{j}\\right) P_{i j}(t)=\\lambda_{j-1} P_{i, j-1}(t) \\\\
\\quad+\\mu_{j+1} P_{i, j+1}(t)-\\left(\\lambda_{j}+\\mu_{j}\\right) P_{i j}(t)
\\end{array}
$$


`,__vite_glob_0_84=`---
title: Stochastic Progress - Week 12
category: Notes
---

# Limiting Probability (Long-run proportion)

$P_j = \\lim_{t\\to\\infty} P_{ij}(t)$

- $\\sum_{j}P_j = 1$
- Ergodic: after a sufficiently long time, the process can reach any state at any given time with distinct positive probabilities.

---

Conditions for existing:

- Irreducibility
- Positive recurrence 

---

How to solve $P_j$:

$ \\begin{aligned} v_{j} P_{j}= & \\sum_{k \\neq j} q_{k j} P_{k}, \\quad \\forall j \\\\ & \\sum_{j} P_{j}=1\\end{aligned} $

## Birth-Death Process 

$v_0 = \\lambda_0, v_j = \\lambda_j + \\mu_j$

Then:

$P_{n}=\\dfrac{\\lambda_{n-1} \\lambda_{n-2} \\ldots \\lambda_{1} \\lambda_{0}}{\\mu_{n} \\mu_{n-1} \\ldots \\mu_{2} \\mu_{1}} P_{0}$

$P_{0}=\\dfrac{1}{1+\\sum_{n=1}^{\\infty} \\frac{\\lambda_{n-1} \\lambda_{n-2} \\ldots \\lambda_{1} \\lambda_{0}}{\\mu_{n} \\mu_{n-1} \\ldots \\mu_{2} \\mu_{1}}} $

`,__vite_glob_0_85=`---
title: Stochastic Progress - Week 13
category: Notes
---

# Renewal Process 

Renewal Process: Let $ \\{N(t), t \\geq 0\\} $ be a counting process.

If the sequence of nonnegative random variables $ \\left\\{X_{1}, X_{2}, \\ldots\\right\\} $ is independent and identically distributed (i.i.d.), then the counting process $ \\{N(t), t \\geq 0\\} $ is called a renewal process.

- $ N(t) $ represents the number of events that have occurred up to time $ t $.
- Let $ X_{n} $ denote the interarrival time between the ( $ n-1 $ )-th and $ n $-th events of this process ( $ n \\geq 1 $ ). 

---

$S_0 = 0, S_n = \\sum_{i=1}^n X_i$

# $N(t)$ and $S_n$

$ N(t)\\ge n \\Lrarr S_n \\le t$

$N(t) = \\max \\{n:S_n\\le t\\}$

$S_{N(t)}\\le t ,S_{N(t)+1}>t$

---

# Distribution of $N(t)$

$P\\{N(t) = n\\} = G_n(t) - G_{n+1}(t)$

Where: $X\\sim G, G_n$ is convolution


---

$P\\{N(t) = n\\} = \\int_0^t \\bar G(t-y)f_{S_n}(y)dy$

Where: $\\bar G = 1-G$

# Renewal Function

$m(t) = E[N(t)]$: Renewal Function 

# Limit Theorem 

- when $t\\to\\infty$, $\\dfrac{N(t)}{t}\\to\\dfrac{1}{\\mu}$

# Renewal Reward Process 

Consider a renewal process $ \\{N(t), t \\geq 0\\} $ with inter-arrival times $ X_{n} $, where $ E\\left[X_{n}\\right]=E[X] $.

At each renewal $ n $, a reward $ R_{n} $ is received,
The process $ \\{R(t), t \\geq 0\\} $ is called a renewal reward process.

- .$ R(t)=\\sum_{n=1}^{N(t)} R_{n} $, representing the total reward earned up to time $ t $.

- $ R_{n} $ may depend on $ X_{n} $ or be accumulated during the process
- $ R_{n}(n \\geq 1) $ are independent and identically distributed with $ E\\left[R_{n}\\right]=E[R] $.

## Proposition

If $ E[R]<\\infty $ and $ E[X]<\\infty $, then:

- $ \\lim _{t \\rightarrow \\infty} \\frac{R(t)}{t}=\\frac{E[R]}{E[X]} $. w.p. 1
- $ \\lim _{t \\rightarrow \\infty} \\frac{E[R(t)]}{t}=\\frac{E[R]}{E[X]} $.

## Elementary Renewal Theorem

As $t\\to\\infty$:

$ \\frac{m(t)}{t} \\rightarrow \\dfrac{1}{\\mu} $,

where $ \\frac{1}{\\mu} $ is interpreted as 0 when $ \\mu=\\infty $.

## Stopping Time 

A stopping time$ N $ for the stochastic process $ \\left\\{X_{n}, n \\geq 1\\right\\} $ is a possibly infinite positive integer-valued random variable. 

- If for every $ n=1,2, \\ldots $, the event $ \\{N=n\\} $ is entirely determined by $ X_{1}, \\ldots, X_{n} $ 
  - (i.e., $ \\{N=n\\} $ is independent of $ X_{n+1}, X_{n+2}, \\ldots $ ), 
- then $ N $ is called a stopping time for the sequence of independent random variables $ X_{1}, X_{2}, \\ldots $.

## Wald Equation 

$ E\\left[\\sum_{n=1}^{N} X_{n}\\right]=E[N] E[X] $

- Where $N$ is a stopping time of $X$

### Proof:

 $ \\mathrm{E}\\left[\\sum_{n=1}^{N} X_{n}\\right]=E\\left[\\sum_{n=1}^{\\infty} X_{n} I_{n}\\right]=\\sum_{n=1}^{\\infty} E\\left[X_{n} I_{n}\\right]= \\sum_{n=1}^{\\infty} E\\left[X_{n}\\right] E\\left[I_{n}\\right]=E[X] \\sum_{n=1}^{\\infty} E\\left[I_{n}\\right]=E[X] E\\left[\\sum_{n=1}^{\\infty} I_{n}\\right]=  E[X] E[N] $

 ## Proposition 

 $ E\\left[X_{1}+\\cdots+X_{N(t)+1}\\right]=E[X] E[N(t)+1] $

 $ E\\left[S_{N(t)+1}\\right]=\\mu[m(t)+1] $

 `,__vite_glob_0_86=`---
title: Stochastic Progress - Assignment - Week 1
category: Assignments
---

# 2

## (1)

### Problem

> Are $ \\cup_{n=1}^{\\infty} E_{n} $ and $ \\cap_{n=1}^{\\infty} E_{n} $ events? If so, what do they represent?

### Solution

Yes, they are events.

$\\cup_{n=1}^\\infty E_n$ is the event that one of them happens

$\\cap_{n=1}^\\infty E_n$ is the event that all of them happen

## (2)

### Problem 

> Example: Three pairwise independent events that are not mutually independent.

### Solution 

Consider following setting:

$\\Omega = \\{\\omega_1,\\omega_2,\\omega_3,\\omega_4\\}, E_1 = \\{\\omega_1,\\omega_2\\}, E_2 = \\{\\omega_1,\\omega_3\\}, E_3 = \\{\\omega_1,\\omega_4\\}$

Then:

$P(E_1E_2) =\\dfrac{1}{4}, P(E_1)P(E_2) = \\dfrac{1}{2}\\cdot\\dfrac{1}{2} = \\dfrac{1}{4}$

same goes for $E_1E_3, E_2E_3$

However:

$P(E_1E_2E_3) = \\dfrac{1}{4}, P(E_1)P(E_2)P(E_3) = \\dfrac{1}{2}\\cdot\\dfrac{1}{2}\\cdot\\dfrac{1}{2} = \\dfrac{1}{8}$

## (3)

### Problem

> Statement: If $ F_{1}, \\ldots, F_{n} $ are mutually exclusive and exhaustive $ \\left(\\cup_{i=1}^{n} F_{i}=S\\right) $, then: $ P(E)=\\sum_{i=1}^{n} P\\left(E \\mid F_{i}\\right) P\\left(F_{i}\\right) . $

### Proof

Notice:

$P(E|F_i)P(F_i) = P(EF_i)$

Since $F_i\\cap F_j = \\oslash,\\forall i\\ne j$

We can get:

$EF_i\\cap EF_j = E(F_i\\cap F_j) = \\oslash$

Then:

$P(E) = P(ES) = P(E(\\cup_{i=1}^n F_i)) = \\sum_{i=1}^n P(EF_i) = \\sum_{i=1^n} P(E|F_i)P(F_i)$

## (4)

### Problem 

> Write Binomial Theorem

### Solution 

For any integers $ n \\geq 0 $ and real numbers $ a, b $ :
$
(a+b)^{n}=\\sum_{k=0}^{n}\\binom{n}{k} a^{n-k} b^{k} .
$

## (5)

### Problem 

> Expectation of $ X $ if $ Y=X+1 $ is Geometric

### Solution 

Since: $E[Y] = \\dfrac{1}{p}$

Then: $E[X] = E[Y-1] = E[Y]-1 = \\dfrac{1}{p} - 1$

## (6)

### Problem 

> Distribution of $ X+Y $ for Independent Poisson Variables

### Solution 

Assuming: $p(x) = e^{-\\lambda_1}\\dfrac{\\lambda_1^x}{x!},p(y) = e^{-\\lambda_2}\\dfrac{\\lambda_2^y}{y!},$

Then for $X+Y$

$\\begin{aligned}
&P(X+Y= z)\\\\ 
 &= \\sum_{i=0}^{z}e^{-\\lambda_1}\\dfrac{\\lambda_1^i}{i!}e^{-\\lambda_2}\\dfrac{\\lambda_2^{z-i}}{(z-i)!} \\\\
&=e^{-(\\lambda_1+\\lambda_2)}\\sum_{i=0}^{z}\\dfrac{\\lambda^i_1\\lambda_2^{z-i}}{i!(z-i)!} 
 \\end{aligned}$

Notice:

$(\\lambda_1+\\lambda_2)^z = z! \\sum_{i=0}^{z}\\dfrac{\\lambda^i_1\\lambda_2^{z-i}}{i!(z-i)!} $

Then:

$P(X+Y = z) =e^{-(\\lambda_1+\\lambda_2)}\\dfrac{(\\lambda_1+\\lambda_2)^z}{z!} $

Therefore:

$X+Y\\sim \\text{Poi}(\\lambda_1+\\lambda_2)$

## (7)

### Problem 

> Expected Number of Tosses Until First Head

### Solution 

Denote $E$ as "First toss is Head",then:

$\\begin{aligned}
&E(X)\\\\
& = E(X|E)P(E) + E(X|E^c)P(E^c) \\\\
&= 1\\cdot p + (\\dfrac{1}{p}+1)\\cdot (1-p)\\\\ 
&= \\dfrac{1}{p}
\\end{aligned}$

## (8)

### Problem 

> Consider $ n $ independent trials, where each trial results in one of $ 1, \\ldots, r $ with probabilities $ p_{1}, \\ldots, p_{r} $, respectively, such that $ p_{1}+\\cdots+p_{r}=1 $. Let $ N_{i} $ denote the number of trials resulting in outcome $ i $. The vector $ \\left(N_{1}, \\ldots, N_{r}\\right) $ follows a multinomial distribution. Using the conditional expectation formula, compute $ \\operatorname{Cov}\\left(N_{i}, N_{j}\\right) $

### Solution 

We have:

$E[N_i] = np_i$

Notice: $(N_i | N_j=y) \\sim \\text{B}(n-y, \\dfrac{p_i}{1-p_j})$

Then:

$E[N_iN_j|N_j=y] =y(n-y)\\dfrac{p_i}{1-p_j} $

$\\begin{aligned}
&E[N_iN_j]\\\\ 
&=E[E[N_iN_j|N_j]]\\\\ 
&=\\sum_{y=0}^n y(n-y)\\dfrac{p_i}{1-p_j}\\cdot \\binom{n}{y}p_j^y (1-p_j)^{n-y}
\\end{aligned}
$

Notice:

$\\sum_{y=0}^n y\\binom{n}{y}p_j^y (1-p_j)^{n-y} = E[N_j] = np_j$

$\\sum_{y=0}^n y^2\\binom{n}{y}p_j^y (1-p_j)^{n-y} = E[N_j^2] =(E[N_j])^2 + Var[N_j]= n^2p_j^2 + np_j(1-p_j)$

Then:

$$
\\begin{aligned}
&E[N_iN_j]\\\\ 
&=\\dfrac{p_i}{1-p_j}(n^2p_j- n^2p_j^2 - np_j(1-p_j))\\\\
&= p_i (n^2p_j - np_j)\\\\
&= n(n-1)p_ip_j
\\end{aligned}
$$

Then:

$\\begin{aligned} 
&Cov(N_j,N_j)\\\\ 
& = E[N_iN_j] - E[N_i]E[N_j] \\\\ 
&= n(n-1)p_ip_j - np_i\\cdot np_j\\\\ 
&=-np_ip_j 
\\end{aligned}
$

## (9)

### Problem 

> 9. Let $ X_{1}, X_{2}, \\ldots $ be i.i.d. random variables, and $ N $ be a non-negative integer-valued random variable independent of the $ X $-sequence. Define $ S_{0}=0 $ and $ S_{N}=\\sum_{i=1}^{N} X_{i} $ (a compound random variable). Assume $ N $ follows a Poisson distribution with mean $ \\lambda $.Assume $X_i$ is interger random variable, $P\\{X_1 = j\\} = a_j, j>0$. Moreover, $\\mathrm{P}\\{M=n\\}=\\frac{n \\mathrm{P}\\{N=n\\}}{\\mathrm{E}[N]}$. Find an expression for $ P_{n}= $ $ P\\left\\{S_{N}=n\\right\\}, n=0,1, \\ldots $

### Solution 

We have:

$
\\begin{aligned}
&P_n \\\\ 
&= \\sum_{k=0}^\\infty P(S_k=n)\\cdot P(N=k)\\\\ 
&=\\sum_{k=0}^n P(S_k=n)\\cdot P(N=k)\\\\ 
&=\\sum_{k=0}^n P(S_k=n)\\cdot e^{-\\lambda}\\dfrac{\\lambda^k}{k!}\\\\ 
\\end{aligned}
$

With MGF:

$\\phi(t) = E[e^{tS_N}]= \\sum_{n=0}^\\infty P_n e^{tn}$

$\\phi'(t) = \\sum_{n=0}^\\infty nP_ne^{tn}$

On the other hand:

$
\\begin{aligned}
&E[e^{tS_N}]\\\\ 
&= E[E[e^{tS_N}|N]]\\\\ 
&=E[(E[e^{tX_1}])^N]\\\\ 
&=e^{\\lambda(E[e^{tX_1}]-1)}\\\\ 
&=e^{\\lambda(\\sum_{j=1}^\\infty (a_j e^{tj})-1)}
\\end{aligned}
$

Then:

$\\phi'(t) = \\lambda \\sum_{j=1}^\\infty (ja_j e^{tj})\\phi(t)$

Replace $\\phi(t) $ and $\\phi'(t)$, we get:

$\\sum_{n=0}^{\\infty}nP_ne^{tn}= \\lambda \\sum_{j=1}^\\infty (ja_j e^{tj})\\sum_{n=0}^\\infty P_n e^{tn}$

To match the power of $e$, we get:

$nP_n = \\lambda \\sum_{j=1}^n ja_j P_{n-j}$

That is:

$ P_{n}=\\left\\{\\begin{array}{ll}e^{-\\lambda} & \\text { if } n=0, \\\\ \\frac{\\lambda}{n} \\sum_{j=1}^{n} j a_{j} P_{n-j} & \\text { if } n \\geq 1 .\\end{array}\\right. $


## (10)

### Problem 

> 10. If $ N $ follows a binomial distribution with parameters $ r $ and $ p $, find $ P_{n}=P\\left\\{S_{N}=n\\right\\}, n= $ $ 0,1, \\ldots $.

### Solution 

Notice:

$(M-1)\\sim \\text{B}(r-1,p)$

With the corollary:

$ \\mathrm{P}\\left\\{S_{N}=k\\right\\}=\\frac{\\mathrm{E}[N]}{k} \\cdot \\sum_{j=1}^{k} j \\alpha_{j} \\cdot \\mathrm{P}\\left\\{S_{M-1}=k-j\\right\\}, k>0 $

We denote $P_r(k) = P(S_{N_{(r)}}=k)$, where $N(r)\\sim \\text{B}(r,p)$, then:

$P_r(0) = (1-p)^r$

$P_r(k) = \\dfrac{rp}{k}\\sum_{j=1}^k ja_j P_{r-1}(k-j), k>0$

---

# Chapter 1

## 10

### Problem 

> Prove Bool's Inequality: $ \\mathrm{P}\\left(\\bigcup_{i=1}^{n} E_{i}\\right) \\leqslant \\sum_{i=1}^{n} \\mathrm{P}\\left(E_{i}\\right) $

### Solution 

We prove by induction:

When $n=1$, it is obvious that:

$P(E_1)\\le P(E_1)$

For $n-1$, assume that:

$ \\mathrm{P}\\left(\\bigcup_{i=1}^{n-1} E_{i}\\right) \\leqslant \\sum_{i=1}^{n-1} \\mathrm{P}\\left(E_{i}\\right) $

Then:

$$
\\begin{aligned}
&\\mathrm{P}\\left(\\bigcup_{i=1}^{n} E_{i}\\right)\\\\ 
&=\\mathrm{P}\\left(\\bigcup_{i=1}^{n-1} E_{i}\\right)+\\mathrm{P}\\left(E_{n}\\right)-\\mathrm{P}\\left(\\bigcup_{i=1}^{n-1} E_{i} \\cap E_{n}\\right)
 \\\\ 
 &\\le\\mathrm{P}\\left(\\bigcup_{i=1}^{n-1} E_{i}\\right)+\\mathrm{P}\\left(E_{n}\\right)\\\\ 
& \\le \\sum_{i=1}^{n-1} \\mathrm{P}\\left(E_{i}\\right)+\\mathrm{P}\\left(E_{n}\\right)\\\\ 
&=\\sum_{i=1}^{n} \\mathrm{P}\\left(E_{i}\\right)  
\\end{aligned}
$$

## 12

### Problem 

> Let $ E $ and $ F $ be mutually exclusive events in the sample space of a certain experiment. Suppose the experiment is repeated until either $ E $ or $ F $ occurs. What is the sample space of this super experiment? Prove that the probability of event $ E $ occurring before event $ F $ is
$
\\frac{\\mathrm{P}(E)}{\\mathrm{P}(E)+\\mathrm{P}(F)}
$

### Solution 

For the sample space:

$\\Omega = \\cup_{k=0}^\\infty \\{(E\\cup F)^c\\}^k\\times \\{E,F\\}$

Denote $G_E$ as "$E$ happens at first experiment",$G_F$ as "$F$ happens at first experiment", $H$ as the needed event. Notice that:

$
\\begin{aligned}
&P(H|(G_E\\cup G_F)^c) = P(H)\\\\ 
&P(H) \\\\ 
&= P(H|G_E)P(G_E)+ P(H|G_F)P(G_F) + P(H|(G_E\\cup G_F)^c)P((G_E\\cup G_F)^c)\\\\ 
&= 1\\cdot P(E) + 0 + P(H)\\cdot (1-P(E)- P(H))\\\\ 
\\end{aligned}
$

Then we get:

$P(H) = \\dfrac{P(E)}{P(E)+P(F)}$

## 23

### Problem 

> For events $ E_{1}, E_{2}, \\cdots, E_{n} $ Prove:
> 
> $\\mathrm{P}\\left(E_{1} E_{2} \\cdots E_{n}\\right)=\\mathrm{P}\\left(E_{1}\\right) \\mathrm{P}\\left(E_{2} \\mid E_{1}\\right) \\mathrm{P}\\left(E_{3} \\mid E_{1} E_{2}\\right) \\cdots \\mathrm{P}\\left(E_{n} \\mid E_{1} \\cdots E_{n-1}\\right)$

### Solution 

We prove by induction: 

For $n-1$, it's obvious that:

$P(E_1) = P(E_1)$

Then, assume case $n-1$ holds, that is: 

$P(E_1E_2\\cdots E_{n-1})
=P(E_1)P(E_2|E_1)P(E_3|E_1E_2)\\cdots P(E_{n-1}|E_1\\cdots E_{n-2})$

Notice:

$P(E_1E_2\\cdots E_n) = P(E_n|E_1\\cdots E_{n-1})P(E_1\\cdots E_{n-1})$

Then:

$
\\begin{aligned}
&P(E_1E_2\\cdots E_n)\\\\ 
& = P(E_n|E_1\\cdots E_{n-1})P(E_1\\cdots E_{n-1})\\\\ 
&=P(E_1)P(E_2|E_1)P(E_3|E_1E_2)\\cdots P(E_{n}|E_1\\cdots E_{n-1})
\\end{aligned}
$

## 28

### Problem 

> If the occurrence of $ B $ makes $ A $ more likely to occur, does the occurrence of $ A $ make $ B $ more likely to occur?

### Solution 

Yes.

We translate the problem into:

Given: $P(A|B)>P(A)$,

Prove or not: $P(B|A)>P(B)$

Notice:

$P(A|B)P(B) = P(AB) = P(B|A)P(A)$

Rearrange it:

$\\dfrac{P(A|B)}{P(A)}=\\dfrac{P(B|A)}{P(B)}$

Given $P(A|B)> P(A)$

We get:

$P(B|A)>P(B)$

## 39

### Problem 

> Assume that stores A, B, and C have 50, 75, and 100 employees, respectively. Among them, 50\\%, $ 60 \\% $, and $ 70 \\% $ are female. The probability of resignation is the same for all employees, regardless of gender. Now, an employee has resigned, and she is female. What is the probability that she worked at store C?

### Solution 

Denote $E$ as "Employee is female", $F$ as "Employee works in C, then:

$
\\begin{aligned}
&P(F|E) \\\\ 
&= \\dfrac{P(EF)}{P(E)}\\\\ 
&= \\dfrac{100 \\times 70\\%}{50\\times 50\\% + 75 \\times 60\\% +100 \\times 70\\%}\\\\ 
&= \\dfrac{1}{2}
\\end{aligned}
$

# Chapter 2

## 7

### Problem 

> Suppose a coin with a probability of 0.7 for landing heads is tossed 3 times. Let $ X $ denote the number of heads that appear in these 3 tosses. Determine the probability mass function of $ X $.

### Solution 

Notice:

$X\\sim \\text{B}(3,0.7)$

Then:

$ P(X=k)=\\left\\{\\begin{array}{ll}0.027, & \\text { if } k=0, \\\\ 0.189, & \\text { if } k=1, \\\\ 0.441, & \\text { if } k=2, \\\\ 0.343, & \\text { if } k=3\\end{array}\\right. $

## 23 

### Problem 

> Negative binomial distribution: Continuously toss a coin with probability $ p $ of landing heads until $ r $ heads appear. Derive the probability that the number of tosses required, $ X $, is $ n $ (where $ n \\geqslant r $ ):
> 
> $\\mathrm{P}\\{X=n\\}=\\binom{n-1}{r-1} p^{r}(1-p)^{n-r}, \\quad n \\geqslant r$


### Solution 

Notice that we need $r-1$ heads in $n-1$ times, then:

$P\\{X=n\\} = \\binom{n-1}{r-1}p^{r}(1-p)^{n-r}$

## 46

### Problem (a)

> If $ X $ is a non-negative integer-valued random variable, prove that:
> $\\mathrm{E}[X]=\\sum_{n=1}^{\\infty} \\mathrm{P}\\{X \\geqslant n\\}=\\sum_{n=0}^{\\infty} \\mathrm{P}\\{X>n\\} .$

### Solution (a)

Notice:

$$
\\begin{aligned}
&\\sum_{n=1}^{\\infty} \\mathrm{P}\\{X \\geqslant n\\}\\\\ 
&=  \\sum_{n=1}^{\\infty} \\sum_{k=n}^{\\infty} \\mathrm{P}\\{X=k\\}  \\\\ 
&= \\sum_{k=1}^{\\infty}  \\sum_{n=1}^{k}\\mathrm{P}\\{X=k\\}  \\\\ 
&= \\sum_{k=1}^\\infty k P\\{X=k\\} \\\\ 
&= E[X]
\\end{aligned}
$$

Also:

$$
\\begin{aligned}
&\\sum_{n=1}^{\\infty} \\mathrm{P}\\{X \\geqslant n\\}\\\\ 
&=\\sum_{n=1}^{\\infty} \\mathrm{P}\\{X > n-1\\}\\\\ 
&=\\sum_{n=0}^{\\infty} \\mathrm{P}\\{X > n\\}\\\\ 
\\end{aligned}
$$

### Problem (b)

> If $ X $ and $ Y $ are both non-negative integer-valued random variables, prove that:
> 
> $\\mathrm{E}[X Y]=\\sum_{n=1}^{\\infty} \\sum_{m=1}^{\\infty} \\mathrm{P}(X \\geqslant n, Y \\geqslant m) .$

### Solution 

Similarly:

$$
\\begin{aligned}
&\\sum_{n=1}^{\\infty} \\sum_{m=1}^{\\infty} \\mathrm{P}(X \\geqslant n, Y \\geqslant m) \\\\ 
&= \\sum_{n=1}^{\\infty} \\sum_{m=1}^{\\infty}\\sum_{x=n}^\\infty \\sum_{y=m}^\\infty  \\mathrm{P}(X =x, Y =y)\\\\ 
&=\\sum_{x=1}^{\\infty} \\sum_{y=1}^{\\infty}\\sum_{n=1}^x \\sum_{m=1}^y  \\mathrm{P}(X =x, Y =y)\\\\ 
&=\\sum_{x=1}^{\\infty} \\sum_{y=1}^{\\infty}xy\\mathrm{P}(X =x, Y =y)\\\\ 
&=E[XY]
\\end{aligned}
$$

## 48 

### Problem 

> If $ X $ is a non-negative random variable and $ g $ is a differentiable function with $ g(0)=0 $, then:
> 
> $\\mathrm{E}[g(X)]=\\int_{0}^{\\infty} \\mathrm{P}(X>t) g^{\\prime}(t) \\mathrm{d} t$
> 
> Prove the above result when $ X $ is a continuous random variable.

### Solution 

We have:

$$
\\begin{aligned}
&\\int_{0}^{\\infty} \\mathrm{P}(X>t) g^{\\prime}(t) \\mathrm{d} t \\\\ 
&=\\int_{0}^{\\infty} \\int_t^\\infty P(X=x) g^{\\prime}(t) \\mathrm d x \\mathrm{d} t \\\\ 
&=\\int_{0}^{\\infty} \\int_0^x P(X=x) g^{\\prime}(t) \\mathrm d t\\mathrm{d} x \\\\ 
&=\\int_0^\\infty g(x)P(X=x)\\mathrm d x \\\\ 
&= E[g(x)]
\\end{aligned}
$$

## 71 

### Problem 

> Prove that the sum of independent and identically distributed (i.i.d.) exponential random variables has a gamma distribution.

### Solution 

Notice for exponential distribution: 


$ M_{X}(t)=\\int_{0}^{\\infty} e^{t x} \\cdot \\lambda e^{-\\lambda x} d x=\\lambda \\int_{0}^{\\infty} e^{-(\\lambda-t) x} d x $

Then: 

$ M_{X}(t)=\\lambda \\cdot \\frac{1}{\\lambda-t}=\\frac{\\lambda}{\\lambda-t} \\quad(t<\\lambda) $

Also, for Gamma distribution:

$ M_{X}(t)=\\int_{0}^{\\infty} e^{t x} \\cdot \\frac{\\lambda^{\\alpha}}{\\Gamma(\\alpha)} x^{\\alpha-1} e^{-\\lambda x} d x=\\frac{\\lambda^{\\alpha}}{(\\lambda-t)^{\\alpha}} \\cdot \\frac{\\Gamma(\\alpha)}{\\Gamma(\\alpha)} $

Then:

$ M_{X}(t)=\\left(\\frac{\\lambda}{\\lambda-t}\\right)^{\\alpha} $

Therefore, for i.i.d. exponential distributions:

$M_{\\sum_{i=1}^{\\alpha} X_i}(t) = (\\dfrac{\\lambda}{\\lambda-t})^\\alpha $

Therefore:

$\\sum_{i=1}^{\\alpha} X_i\\sim \\text{Gamma}(\\alpha)$

# Chapter 3

## 7

### Problem 

> Suppose the joint probability mass function $ p(x, y, z) $ of $ X, Y $, and $ Z $ is given by:
> 
> $\\begin{array}{llll}p(1,1,1)=\\frac{1}{8}, & p(2,1,1)=\\frac{1}{4}, & p(1,1,2)=\\frac{1}{8}, & p(2,1,2)=\\frac{3}{16} \\\\p(1,2,1)=\\frac{1}{16}, & p(2,2,1)=0, & p(1,2,2)=0, & p(2,2,2)=\\frac{1}{4}\\end{array}$
> 
> What is $ \\mathrm{E}[X \\mid Y=2] $ ? What is $ \\mathrm{E}[X \\mid Y=2, Z=1] $ ?

### Solution 

We have:

$P(Y=2) = \\sum_{x,z}p(x,2,z) = \\dfrac{5}{16}$

With conditional probability:

$P(X=1|Y=2) = \\dfrac{P(X=1,Y=2)}{P(Y=2)} = \\dfrac{1}{5}$

$P(X=2|Y=2) = \\dfrac{P(X=2,Y=2)}{P(Y=2)} = \\dfrac{4}{5}$

Then:

$$
\\begin{aligned}
&E[X|Y=2]\\\\ 
&= \\sum_{x}x\\cdot P(X=x|Y=2) \\\\ 
&= \\dfrac{9}{5}
\\end{aligned}
$$

Similarly:


$$
\\begin{aligned}
&E[X|Y=2, Z=1]\\\\ 
&= \\sum_{x}x\\cdot P(X=x|Y=2, Z=1) \\\\ 
&= 1
\\end{aligned}
$$

## 14

### Problem 

> Let $ X $ be a uniform random variable on $ (0,1) $. Find $ \\mathrm{E}[X \\mid X<1 / 2] $

### Solution 

We have:

$p(x) = 1, x\\in (0, 1)$

Then:

$$
\\begin{aligned}
&E[X|X<\\dfrac{1}{2}]\\\\ 
&= \\int_0^1 xP(X=x|X<\\dfrac{1}{2}) dx \\\\ 
&=\\int_0^\\frac{1}{2}x\\dfrac{P(X=x)}{\\dfrac{1}{2}}dx \\\\ 
&= \\dfrac{1}{4}
\\end{aligned}
$$

## 27 

### Problem

> Continuously toss a coin with probability $ p $ of landing heads until the pattern $ \\mathrm{T}, \\mathrm{T}, \\mathrm{H} $ appears. (That is, you stop tossing when the most recent toss is heads, and the two tosses immediately before it are tails.) Let $ X $ be the number of tosses. Find $ \\mathrm{E}[X] $.

### Solution 

We give the solution by states:

We denote:

$S_0 $: the most recent toss is H or nothing

$S_1$: the most recent toss is T 

$S_2$: the most recent tosses are T, T

We denote:

$E_i$ as the tosses needed for T, T, H in state $i$

Then:

$E_0 = (1-p)E_1 + pE_0 + 1$

$E_1 = (1-p)E_2 + pE_0 + 1$

$E_2 = p\\cdot 0 + (1-p)E_2 + 1$

By solving this, we get:

$E_2 = \\dfrac{1}{p}$

$E_0 = \\dfrac{1/p}{1-2p+p^2}$

Therefore:

$E[X] = \\dfrac{1}{p(1-p)^2}$

## 57

### Problem 

> The number of storms in the next rainy season follows a Poisson distribution, but its parameter is uniformly distributed over $ (0,5) $. That is, $ \\Lambda $ is uniformly distributed over $ (0,5) $, and given $ \\Lambda=\\lambda $, the number of storms is a Poisson random variable with mean $ \\lambda $. Find the probability that there are at least three storms in this rainy season.

### Solution 

Denote $X$ as the number of storms in this rainy season.

Notice:

$p(\\lambda) = \\dfrac{1}{5}$

$P(X=x|\\Lambda = \\lambda) = \\dfrac{\\lambda^x}{x!}e^{-\\lambda}$

Then:

$$
\\begin{aligned}
&P(X\\ge 3)\\\\ 
&= \\int_0^5 P(X\\ge 3|\\Lambda = \\lambda) P(\\Lambda =\\lambda) d \\lambda \\\\ 
&= \\dfrac{1}{5}\\int_0^5(1-e^{-\\lambda} - \\lambda e^{-\\lambda} - \\dfrac{\\lambda^2}{2}e^{-\\lambda})d\\lambda \\\\ 
&=\\dfrac{1}{5}[\\lambda+e^{-\\lambda}+ (\\lambda + 1)e^{-\\lambda} + (\\dfrac{\\lambda^2}{2}+\\lambda+1)e^{-\\lambda}]^5_0\\\\ 
&=\\dfrac{1}{5}[\\lambda + (\\dfrac{\\lambda^2}{2}+2\\lambda+3)e^{-\\lambda}]^5_0\\\\
&=\\dfrac{2}{5} + \\dfrac{51}{10}e^{-5}\\\\
\\end{aligned}
$$

## 59

### Problem

> Assume that each new coupon collected is independent of the past, and the probability of collecting a coupon of type $ i $ is $ p_{i} $. A total of $ n $ coupons are collected. Let $ A_{i} $ denote the event "at least one of the $ n $ coupons is of type $ i $." For $ i \\neq j $, compute $ P\\left(A_{i} A_{j}\\right) $ using the following methods:
(a) Condition on the number of type $ i $ coupons $ N_{i} $ among the $ n $ coupons;
(b) Condition on the time $ F_{i} $ when the first type $ i $ coupon is collected;
(c) Use the identity $ \\mathrm{P}\\left(A_{i} \\cup A_{j}\\right)=\\mathrm{P}\\left(A_{i}\\right)+\\mathrm{P}\\left(A_{j}\\right)-\\mathrm{P}\\left(A_{i} A_{j}\\right) $.

### Solution (a)

We have:

$$
\\begin{aligned}
&P(A_iA_j)\\\\ 
&=\\sum_{k=1}^n P(A_j|N_i=k)P(N_i=k) \\\\ 
&= \\sum_{k=1}^n(1-(1-\\dfrac{p_j}{1-p_i})^{n-k})\\binom{n}{k}p_i^k(1-p_i)^{n-k}
\\end{aligned}
$$

### Solution (b)

Similarly, we have:

$$
\\begin{aligned}
&P(A_iA_j)\\\\ 
&=\\sum_{k=1}^n P(A_j|F_i=k)P(F_i=k) \\\\ 
&= \\sum_{m=1}^{n}\\left[1-\\left(1-\\frac{p_{j}}{1-p_{i}}\\right)^{m-1}\\left(1-p_{j}\\right)^{n-m}\\right]\\left(1-p_{i}\\right)^{m-1} p_{i}
\\end{aligned}
$$

### Solution (c)

We have:

$
\\begin{aligned}
&P(A_iA_j) \\\\ 
&= P(A_i) + P(A_j) - P(A_i \\cup A_j) \\\\ 
&= (1-(1-p_i)^n) + (1-(1-p_j)^n) - (1-(1-p_i-p_j)^n)\\\\ 
&= 1 - (1-p_i)^n - (1-p_j)^n + (1-p_i- p_j )^n
\\end{aligned}$


`,__vite_glob_0_87=`---
title: Stochastic Progress - Cheatsheet
category: Cheatsheets
---

指数分布

$f(x) = \\lambda e^{-\\lambda x}, F(x) = 1 - e^{-\\lambda x}$

$P(X>x) = e^{-\\lambda x }$

$E(X) = \\dfrac{1}{\\lambda}, Var(X) = \\dfrac{1}{\\lambda^2}$

$r(t)=\\dfrac{f(t)}{1-F(t)}$: 失败率函数

指数分布： $r(t) = \\lambda$

超指数随机变量： $P(T=j) =P_j, \\sum_{j=1}^n P_j = 1,X_i\\sim Exp(\\lambda_i)$

- $f(t) = \\sum_{i=1}^n\\lambda_iP_ie^{-\\lambda_i t}$
- $F(t) = 1-\\sum_{i=1}^n P_i e^{-\\lambda_i t}$
- $r(t) = \\sum_{j=1}^n \\lambda_j P(T=j|X>t)$
- $\\lim_{t\\to\\infty}r(t) = \\min \\lambda_i$

---

- $X\\sim Exp(\\lambda), \\sum_n X\\sim Ga(n,\\lambda)$
- $\\min(X_1,X_2,\\cdots,X_n) \\sim Exp(\\sum_{i=1}^n \\lambda_i)$
- $X_1\\sim Exp(\\lambda_1), X_2\\sim Exp(\\lambda_2), P(X_1<X_2)=\\dfrac{\\lambda_1}{\\lambda_1+\\lambda_2}$
- $P(X_i = \\min (X_1,X_2,\\cdots,X_n)) = \\dfrac{\\lambda_i}{\\sum_{j=1}^n \\lambda_j}$
- "$\\min_i X_i>t$"条件不会影响 $X_i$的次序
- $\\min(X_1,\\dots,X_n)\\sim Exp(\\sum_{i=1}^n \\lambda_i)$

亚指数随机变量：

$S=\\sum_{i=1}^n X_i, $ where $ X_i\\sim Exp(\\lambda_i)$: 亚指数随机变量

$f_S(t) = \\sum_{i=1}^n C_{i,n} \\lambda_i e^{-\\lambda_i t}$, where $C_{i, n} = \\prod_{j\\ne i}\\dfrac{\\lambda_j}{\\lambda_j-\\lambda_i}$

- $P(S>t) = \\sum_{i=1}^n C_{i,n}e^{-\\lambda_i t}$

- $r_S(t) = \\dfrac{\\sum_{i=1}^n C_{i,n}\\lambda_i e^{-\\lambda_i t}}{\\sum_{i=1}^n C_{i,n} e^{-\\lambda_i t}}$

---

考克斯随机变量

$Y = \\sum_{i=1}^N X_i$, where $\\sum_{n=1}^m P_{N=n} = 1, X_i\\sim Exp(\\lambda_i)$

$f_Y(t) = \\sum_{n=1}^m P_n\\sum_{i=1}^n C_{i,n}\\lambda_i e^{-\\lambda_i t}$

---

计数过程

$N(t)$ 时间 $t$ 前发生事件次数

定义：

1. $N(t)\\ge 0$
2. $N(t)$整数
3. $N(s)\\le N(t)$ if $s<t$
4. $N(t)-N(S)$ 表示 $(s, t]$事件个数

---

泊松过程：首先是计数过程

1. $N(0) = 0$
2. $\\{N(t)\\}$平稳增量，独立增量
3. $P(N(t+h) - N(t) = 1) = \\lambda h + o(h)$
4. $P(N(t+h) - N(t) \\ge 2)=o(h)$


- 平稳增量：时间段长度决定事件个数
- 独立增量：发生的事件独立

---

若$\\{N(t)\\}$是速率为$\\lambda$的泊松过程，则：

- $N(s+t)-N(s)\\sim Poi(\\lambda t)$

---

定义2

- $N(0)=0$
- 独立增量
- $N(s, s+t]\\sim Poisson(\\lambda t)$

---

$\\{T_n\\}$到达时间间隔列，$n-1$到 $n$的耗时

$T_n\\sim Exp(\\lambda)$

---

$\\{S_n\\} = \\sum_{i=1}^n T_i$: 等待时间列

$f_{S_n}(t) = \\lambda e^{-\\lambda t} \\dfrac{(\\lambda t)^{n-1}}{(n-1)!}$

---

$S_n $是速率 $\\lambda$ 的泊松过程

---

分流成独立的 $N_1(t)$速率 $\\lambda p$, $N_2(t)$ 速率 $\\lambda(1-p)$

---

$P\\{ S_n ^1<S_m^2\\} = \\sum_{k=n}^{n+m-1} \\binom{n+m-1}{k}(\\dfrac{\\lambda_1}{\\lambda_1+\\lambda_2})^k (\\dfrac{\\lambda_2}{\\lambda_1+\\lambda_2})^{n+m-k-1}$

---

$P\\{T_1<s|N(t)=1\\} =\\dfrac{s}{t}$

---

次序统计量：

$ f_{Y_{(1)}, \\ldots, Y_{(n)}}\\left(y_{1}, \\ldots, y_{n}\\right)=n!\\prod_{i=1}^{n} f\\left(y_{i}\\right) $

若均匀分布：

$ f\\left(y_{1}, y_{2}, \\ldots, y_{n}\\right)=\\dfrac{n!}{t^{n}} $

$E[D(t)|N(t)=n]=E[\\sum_{i=1}^n e^{-\\alpha U_{(i)}}C_i]$

$ f_{S_{1}, \\ldots S_{n-1}}\\left(s_{1}, \\ldots, s_{n-1} \\mid S_{n}=t\\right)=\\frac{(n-1)!}{t^{n-1}}, 0<s_{1}<\\cdots<s_{n-1}<t $

---

$ E\\left[N_{i}(t)\\right]=\\lambda \\int_{0}^{t} P_{i}(s) d s $

- $N_i(t)$：到时刻 t，类型 i 事件发生的个数

# 非时间对齐

不平稳，4.: $\\lambda (t)$

$m(t) = \\int_0^t \\lambda(y)dy$: 均值函数

$N(t+s)-N(s)$均值为 $m(t+s)-m(s)$


分流：以 $P_1(s)$抽样， $\\lambda_i(t) = \\lambda P_i (t)$

---

# 复合 

$X(t) = \\sum_{i=1}^{N(t)} Y_i$, $N(t)$是复合泊松过程

- $E[X(t)] = \\lambda t E[Y_1]$
- $Var[X(t)] = \\lambda t E[Y_1^2]$

有限时：

$X(t) = \\sum_j \\alpha _j N_j (t)$

$X_1(t)+X_2(t)$是复合泊松随机过程

参数： $\\lambda_1+\\lambda_2$ 分布函数： 
$F(x) = \\dfrac{\\lambda_1}{\\lambda_1+\\lambda_2} F_1(x) + \\dfrac{\\lambda_2}{\\lambda_1+\\lambda_2} F_2(x)$

--- 

条件泊松过程：

$L=\\lambda$: $N(t)$是泊松过程

$ \\begin{array}{l}P\\{N(t+s)-N(s)=n\\} \\\\ =\\int_{0}^{\\infty} P\\{N(t+s)-N(s)=n \\mid L=\\lambda\\} g(\\lambda) d \\lambda \\\\ =\\int_{0}^{\\infty} \\frac{e^{-\\lambda t}(\\lambda t)^{n}}{n!} g(\\lambda) d \\lambda\\end{array} $

- $E[N(t)] = tE[L]$
- $Var[N(t)] = tE[L] + t^2Var[L]$

$ f_{L \\mid N(t)}(\\lambda \\mid n)=\\frac{e^{-\\lambda}(\\lambda)^{n} g(\\lambda)}{\\int_{0}^{\\infty} e^{-\\lambda t}(\\lambda)^{n} g(\\lambda) d \\lambda} $

---

# 连续时间马氏链

定义

1. 指标集: $\\{t\\ge 0\\}$ 的连续值
2. 状态空间： 离散值
3. 初始状态 $X(0)$和各时刻随机变量 $X(t)$: 离散随机变量
4. 相依关系/转移概率： $P_{ij}(t) = P(X(s+t)= j | X(s) = i, X(u) = x(u), 0\\le u < s)$: 现在处于状态 $i$的过程，时间 $t$ 后处于状态 $j$ 的概率

性质：

- 马氏性质： 重启，平稳 

$X(t)$ 的分布：

$P(X(t) = j) = \\sum_{i=0}^{\\infty }P_{ij} (t) P(X(0) = i)$

---

定义2: 

- 状态 $i$停留时间 $\\sim Exp(v_i)$
- 状态间转移概率 $P_{ii} = 0, \\sum_j P_{ij} - 1$

---

生灭过程定义：

- 连续时间随机过程

当状态为 $n$:

- 进入间隔时间 $\\sim Exp(\\lambda_n)$
- 离开间隔时间 $\\sim Exp(\\mu_n)$

---

尤尔过程

成员之间独立，以速率 $\\lambda$ 产生新成员, $\\lambda_n = n\\lambda$

---

生灭过程 $E(T_{i, i+1})$:

$E(T_{i, i+1}) = \\dfrac{1}{\\lambda_i} + \\dfrac{\\mu_i}{\\lambda_i} E(T_{i-1, i})$

$E(T_{ij}) = E(T_{i, i+1}) + E(T_{i+1, i+2}) + \\cdots + E(T_{j-1, j})$

- 当 $\\lambda \\ne \\mu$, $E(T_{i, i+1}) = \\dfrac{1- (\\dfrac{\\mu}{\\lambda})^{i+1}}{\\lambda-\\mu}$
- 当 $\\lambda = \\mu$, $E(T_{i, i+1}) = \\dfrac{i+1}{\\lambda}$

---

纯生过程

- $P_{ij}(t) = \\sum_{k=i}^j e^{-\\lambda_k t} \\prod_{r\\ne k , r = i} ^ j \\dfrac{\\lambda _r}{\\lambda_r - \\lambda_k} - \\sum_{k = i}^{j-1}e^{-\\lambda_k t}\\prod_{r\\ne k , r=i }^{j -1 } \\dfrac{\\lambda_r}{\\lambda_r - \\lambda_k}$
- $P_{ii}(t) = e^{-\\lambda_i t}$

---

尤尔过程的转移概率：

- $P_{1j}(t) = e^{-\\lambda t}(1-e^{-\\lambda t})^{j- 1}$

- $P_{ij}(t) = \\binom{j-1}{i-1}(e^{-\\lambda t})^i(1-e^{-\\lambda t})^{j-i}$

--- 

# $P_{ij}(t), P_{ij}, v_i$

- $\\lim_{h\\to 0}\\dfrac{1- P_{ii}(h)}{h} = v_i$
- $\\lim_{h\\to 0} \\dfrac{P_{ij}(h)}{h} = v_i P_{ij} = q_{ij}$

---

$q_{ij} = v_iP_{ij}$ 瞬时转移概率

- $v_i = \\sum_j q_{ij}$
- $P_{ij} = \\dfrac{q_ij}{v_i} = \\dfrac{q_{ij}}{\\sum_j q_{ij}}$

---

# CK 方程

$P_{ij} (t+s) = \\sum_{k=0}^\\infty P_{ik}(t) P_{kj}(s)$

---

# 柯尔莫哥洛夫向后方程

- $P_{ij}'(t) = \\sum_{k\\ne i} q_{ik} P_{kj} (t) - v_i P_{ij}(t)$

纯生过程的向后方程：

- $P_{ij}'(t) = \\lambda_i P_{i+1,j}(t) - \\lambda_i P_{ij}(t)$

一般生灭过程:

- $P_{0j}'(t) = \\lambda_0P_{1j}(t) - \\lambda_0 P_{0j}(t) = \\lambda_0 (P_{1j}(t) - P_{0j}(t))$
- $P_{ij}'(t) = (\\lambda_i+\\mu_i)(\\dfrac{\\lambda_i}{\\lambda_i + \\mu_i} P_{i + 1, j}(t) + \\dfrac{\\mu_i}{\\lambda_i+\\mu_i}P_{i-1, k}(t)) - (\\lambda_i + \\mu_i)P_{ij}(t)$

# 柯尔莫哥洛夫向前方程

$P'_{ij}(t) = \\sum_{k\\ne j} P_ik(t) q_{kj} - P_{ij} (t) v_j$

纯生过程的向前方程

$P_{ii}'(t) = -\\lambda_i P_{ii}(t)$

$P_{ij}' (t) = \\lambda_{j-1} P_{i, j-1}(t) - \\lambda_j P_{ij} (t)$

一般生灭过程的向前方程

$P_{i0}'(t) = \\sum_{k\\ne 0} q_{k0} P_{ik}(t) - \\lambda_0 P_{i 0} (t) = \\mu_1 P_{i1}(t) - \\lambda_0 P_{i0} (t)$

$P_{ij}'(t) = \\sum_{k\\ne j}q_{kj} P_{ik}(t) - (\\lambda_j + \\mu _j)P_{ij}(t) = \\lambda_{j-1}P_{i, j-1}(t) + \\mu_{j+1}P_{i, j+1} (t) - (\\lambda_j + \\mu_j)P_{ij} (t)$

---

极限概率

$P_j \\equiv \\lim_{t\\to\\infty} P_{ij}(t)$: 极限概率，长程比例
- $\\sum_j P_j = 1$

---

条件：

- 不可约
- 正常返

求解：

- $v_jP_j = \\sum_{k\\ne j} q_{kj}P_k$
- $\\sum_j P_j = 1$

---

生灭过程的极限概率

- $P_n = \\dfrac{\\lambda_{n-1}\\lambda_{n-2}\\dots\\lambda_1\\lambda_0}{\\mu_n\\mu_{n-1}\\dots\\mu_2\\mu_1}P_0$
- $P_0 = \\dfrac{1}{1+\\sum_{n=1}^\\infty \\dfrac{\\lambda_{n-1}\\lambda_{n-2}\\dots \\lambda_1\\lambda_0}{\\mu_n\\mu_{n-1}\\dots\\mu_2\\mu_1}}$

---

更新过程

$X_n$: 第 $n-1$ 个和第 $n$ 个事件之间的间隔时间

$X_n$ 独立同分布， $N(t)$ 是更新过程

- $\\mu = E[X_n]$

$S_0 = 0, S_n = \\sum_{i=1}^n X_i$ 更新过程

- $N(t)\\ge n \\Lrarr S_n \\le t $
- $N(t) = \\max(n:S_n \\le t)$
- $S_{N(t)}\\le t , S_{N(t) + 1} > t$

---

$X$ 的分布为 $F$

$P(N(t)=n) = F_n(t) - F_{n+1}(t)$, $F_n$ 是 $n$个 $F$的卷积

- $S_n = \\sum_{i=1}^n X_i $

---

$m(t) = E(N(t))$: 更新过程的均值函数： 更新函数

$m(t) = \\sum_{n=1}^\\infty F_n(t)$

更新函数 $m(t)$ 唯一确定更新过程： $m(t) = \\lambda t$

$m(t) = \\int_0^t (1+m(t-x)) f(x)fx = F(t) + \\int_0^t m(t-x) f(x) dx$

---

# 更新过程速率：

$\\dfrac{N(t)}{t}\\to \\dfrac{1}{\\mu}$

---

# 更新报酬过程：

$R(t) = \\sum_{n=1}^{N(t)} R_n$: 更新报酬过程
- $N(t)$: 更新过程， 到达时间间隔 $X_n$

---

若 $E[R] < \\infty, E[X] < \\infty$

- $\\lim_{t\\to\\infty} \\dfrac{R(t)}{t} = \\dfrac{E(R)}{E(X)}$
- $\\lim_{t\\to\\infty} \\dfrac{E(R(t))}{t} = \\dfrac{E(R)}{E(X)}$

---

基本更新定理：

$t\\to\\infty , \\dfrac{m(t)}{t}\\to\\dfrac{1}{\\mu}$

---

停时：

$N$ 为随机变量，对 $X_i$ 观察 $N$ 个后停止，则 $N$是停时

---

瓦尔德方程

$E[\\sum_{n=1}^N X_n] = E[N]E[X]$
- $N$ 是停时

$N (t) = \\argmax_n (S_n \\le t)$: 是停时

- $E[X_1+\\dots + X_{N(t)+1}]=E[X]E[N(t)+1]$



placeholder

placeholder

placeholder

placeholder
`,__vite_glob_0_88=`---
title: Supply Chain Management - Week 1
category: Notes
---

# Introduction to Supply chain management

## KYC - Know your Customer

FOXCONN

- Credits arbitrage
- Interest arbitrage
- Exchange rate arbitrage 
- Efficiency arbitrage 

Integration of Industry and Investment:
- Investment enhances Industry
- industry push investment 

---

Developing triangle
- Environment, resuorce, labor
- technology management brand
- capital, standard, creativity 

## KYW - Know your Want 

- 60s cost Mass product material flow manufacturing is king OM(operations management)
- 70s quality TPS/SIT 
- 80s flexibility FMS 
- 90s service mass customazation material / information flow 
- 00s speed vertical integration make capital flow cash is king 
- sustainbility ESG 

## KYCash - Know your Cash 

$\\sum_{n=0}^\\infty na_nx^{n-1} = \\dfrac{1}{x+2},x = 1:\\dfrac{1}{3}$`,__vite_glob_0_89=`---
title: Supply Chain Management - Week 2
category: Notes
---

# Why changes?

**Value disciplined** change 
- product 
- service 
- experience
- participation

# 3 Multiple

- multiple flows 
- multiple organizations 
- multiple functions 

# First Principle 

- Consider customer's needs 

# Know your Supply chain & Cash 


Observations:

- Facility 
- Efficiency 
- Levels 

## The Development chain 

R&D - Brand - Design - Procurement - Manufacturing - Distribution - Sales - Sales service 

A Parabola:

- global production network
- value added

---

- Development chain 
- supply chain

# Supply chain

Buy material - sell - pay - get money

- Buy material - sell: average sell / inventory period 
- sell - get money: average accounts receivable period 
- Buy material - pay: average accounts payable period 
- pay - get money: cash period

# Cash Conversion Cycle

> Cash Conversion Cycle = DIO + DSO – DPO

- DIO stands for Days Inventory Outstanding
- DSO stands for Days Sales Outstanding
- DPO stands for Days Payable Outstanding

`,__vite_glob_0_90=`---
title: Supply Chain Management - Week 4
category: Notes
---

# Mismatching Between Supply and Demand 

## Bullwhip Effect(agility)

- cost goes up 

### How to Solve

- managing uncertainty
- risk pooling 
  
## Value (Adaptability)

## Double Marginalization (Alignment)

### How to solve 

Risk sharing 
- global optimization 
- local optimization 
`,__vite_glob_0_91=`---
title: Supply Chain Management - Week 5
category: Notes
---

# CSR - Creating shared value 

## Responsibilities

- philanthropy
- ethical 
- legal
- compliance 

`,__vite_glob_0_92=`---
title: Supply Chain Management - Week 6
category: Notes
---

# Inventory Management and Risk Pooling

# Model 

## Notation 

$D$: demand rate per day 
$Q$: order quantities
$K$: fixed setup cost 
$h$: holding cost 
$Leadtime = 0$: time between order place and recept
$Initial-inventory = 0$
Planning horizon is infinite 

## EOQ

$K + \\dfrac{hTQ}{2}$: total cost per cycle
- $\\dfrac{hQ}{2}$: average inventory holding cost 
- $T=\\dfrac{Q}{D}$: cycle time 

$\\dfrac{KD}{Q}+\\dfrac{hQ}{2}$: average total cost per unit time 

$Q^* = \\sqrt{\\dfrac{2KD}{h}}$: best Q 

# Continuous Review Policy 

## Notation 

$AVG$: Average daily demand 
$STD$: Stand Deviation of demand 
$L$: Lead time 
$h$: holding cost 
$\\alpha $: service level (probability of stocking out is $1-\\alpha  $)

## Model 

$L\\cdot AVG$: Average demand during lead time 
$Safety stock$: $z\\cdot STD\\cdot \\sqrt{L}$
$R = L\\cdot AVG + z\\cdot STD \\cdot \\sqrt{L}$: Reorder level
$Q^* = \\sqrt{\\dfrac{2K\\cdot AVG}{h}}$: best quantity 

# Variable Lead Time 

## Notation 

$AVGL$: Average lead time 

$STDL$: stand Deviation of lead time 

## Model 

$Safety stock = z \\sqrt{A V G L \\times S T D^{2}+A V G^{2} \\times S T D L^{2}}$

$R = =A V G \\times A V G L+z \\sqrt{A V G L \\times S T D^{2}+A V G^{2} \\times S T D L^{2}} $

$Q^* = \\sqrt{\\dfrac{2K\\cdot AVG}{h}}$: best quantity 



`,__vite_glob_0_93=`---
title: Supply Chain Management - Cheatsheet
category: Cheatsheets
---

# Conception

## Intro

- Revolution
- 3M
- 3C (Cash Conversion Cycle)

--- 

Flows:

- Material flow 
- Value-added flow 
- Fund/Demand flow 
- Information flow 
- After use service flow 

Observations:

- Every facility need considered
- 

## 3M



## Beer game

- Managing Uncertainty -> Bullwhip effect : cost 
- Global optimization -> Double marginalization effect : value 

## 3A

- Agility Adaptability Alignment 

## Sustainble SC 

StarBucks: CSR

- Strategy Integration Coordination Innovation Sustainability

# Integration -> Risk Pooling -> Cost 

## Inventory

- EOQ 
- Two-bit system(Q, R)
  - Min-max (s, S')
  - Base-stock system (R, S'')

## Inventory Simulation 

- Risk pooling 
  - Application 
    - Product design 
    - Process design 
    - Distribution design 

## Integration

- Push (MTS)
- Pull 
- Push & Pull 

Postponement 
Delayed Differentiation 
Process standardiation 
Mass customization 

## COordination product design 

DFM 

DFL 
- EOS
- Concurrent 
- standardization

DFSC / UED 
- Esquel 

DVC
- ysoul case

# Coordination co-operation  -> risk sharing -> value 

## SC contract

wholesale price contract 

return policy 

risk sharing contract 

## Strategical Alliance 

R-S partnership

3PL 

DI 

## Logistics Finance 

BPO 
- Ester Asia 
- PCH

VC 
- Zhengming Logistics 

# Innovation & Sustainability 

## SCF

Conception 

Design

Application 


- P & G 
  - Factoring 
  - Reverse factoring 

## Sustainbility (SCF)

CSR 

CSV 

-> Hongxuan Agri. Case 

## Fintech & SC & SCF 

3S 

Ouyel case 

Shengye Case 

UCA case 

20-80 rule 

Long tailed effect 



`;var empty$2=null;const empty$3=Object.freeze(Object.defineProperty({__proto__:null,default:empty$2},Symbol.toStringTag,{value:"Module"})),require$$0=getAugmentedNamespace(empty$3);var toString$3=Object.prototype.toString,kindOf=function(a){if(a===void 0)return"undefined";if(a===null)return"null";var o=typeof a;if(o==="boolean")return"boolean";if(o==="string")return"string";if(o==="number")return"number";if(o==="symbol")return"symbol";if(o==="function")return isGeneratorFn(a)?"generatorfunction":"function";if(isArray$1(a))return"array";if(isBuffer$1(a))return"buffer";if(isArguments(a))return"arguments";if(isDate(a))return"date";if(isError(a))return"error";if(isRegexp(a))return"regexp";switch(ctorName(a)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(isGeneratorObj(a))return"generator";switch(o=toString$3.call(a),o){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return o.slice(8,-1).toLowerCase().replace(/\s/g,"")};function ctorName(e){return typeof e.constructor=="function"?e.constructor.name:null}function isArray$1(e){return Array.isArray?Array.isArray(e):e instanceof Array}function isError(e){return e instanceof Error||typeof e.message=="string"&&e.constructor&&typeof e.constructor.stackTraceLimit=="number"}function isDate(e){return e instanceof Date?!0:typeof e.toDateString=="function"&&typeof e.getDate=="function"&&typeof e.setDate=="function"}function isRegexp(e){return e instanceof RegExp?!0:typeof e.flags=="string"&&typeof e.ignoreCase=="boolean"&&typeof e.multiline=="boolean"&&typeof e.global=="boolean"}function isGeneratorFn(e,a){return ctorName(e)==="GeneratorFunction"}function isGeneratorObj(e){return typeof e.throw=="function"&&typeof e.return=="function"&&typeof e.next=="function"}function isArguments(e){try{if(typeof e.length=="number"&&typeof e.callee=="function")return!0}catch(a){if(a.message.indexOf("callee")!==-1)return!0}return!1}function isBuffer$1(e){return e.constructor&&typeof e.constructor.isBuffer=="function"?e.constructor.isBuffer(e):!1}/*!
 * is-extendable <https://github.com/jonschlinkert/is-extendable>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var isExtendable=function(a){return typeof a<"u"&&a!==null&&(typeof a=="object"||typeof a=="function")},isObject$1=isExtendable,extendShallow=function(a){isObject$1(a)||(a={});for(var o=arguments.length,c=1;c<o;c++){var d=arguments[c];isObject$1(d)&&assign(a,d)}return a};function assign(e,a){for(var o in a)hasOwn$1(a,o)&&(e[o]=a[o])}function hasOwn$1(e,a){return Object.prototype.hasOwnProperty.call(e,a)}var typeOf$3=kindOf,extend$3=extendShallow,sectionMatter=function(e,a){typeof a=="function"&&(a={parse:a});var o=toObject(e),c={section_delimiter:"---",parse:identity},d=extend$3({},c,a),$=d.section_delimiter,g=o.content.split(/\r?\n/),b=null,_=createSection(),j=[],_e=[];function et(ot){o.content=ot,b=[],j=[]}function tt(ot){_e.length&&(_.key=getKey(_e[0],$),_.content=ot,d.parse(_,b),b.push(_),_=createSection(),j=[],_e=[])}for(var nt=0;nt<g.length;nt++){var at=g[nt],lt=_e.length,mt=at.trim();if(isDelimiter(mt,$)){if(mt.length===3&&nt!==0){if(lt===0||lt===2){j.push(at);continue}_e.push(mt),_.data=j.join(`
`),j=[];continue}b===null&&et(j.join(`
`)),lt===2&&tt(j.join(`
`)),_e.push(mt);continue}j.push(at)}return b===null?et(j.join(`
`)):tt(j.join(`
`)),o.sections=b,o};function isDelimiter(e,a){return!(e.slice(0,a.length)!==a||e.charAt(a.length+1)===a.slice(-1))}function toObject(e){if(typeOf$3(e)!=="object"&&(e={content:e}),typeof e.content!="string"&&!isBuffer(e.content))throw new TypeError("expected a buffer or string");return e.content=e.content.toString(),e.sections=[],e}function getKey(e,a){return e?e.slice(a.length).trim():""}function createSection(){return{key:"",data:"",content:""}}function identity(e){return e}function isBuffer(e){return e&&e.constructor&&typeof e.constructor.isBuffer=="function"?e.constructor.isBuffer(e):!1}var engines$2={exports:{}},jsYaml$1={},loader$1={},common$6={};function isNothing(e){return typeof e>"u"||e===null}function isObject(e){return typeof e=="object"&&e!==null}function toArray(e){return Array.isArray(e)?e:isNothing(e)?[]:[e]}function extend$2(e,a){var o,c,d,$;if(a)for($=Object.keys(a),o=0,c=$.length;o<c;o+=1)d=$[o],e[d]=a[d];return e}function repeat(e,a){var o="",c;for(c=0;c<a;c+=1)o+=e;return o}function isNegativeZero(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}common$6.isNothing=isNothing;common$6.isObject=isObject;common$6.toArray=toArray;common$6.repeat=repeat;common$6.isNegativeZero=isNegativeZero;common$6.extend=extend$2;function YAMLException$4(e,a){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=a,this.message=(this.reason||"(unknown reason)")+(this.mark?" "+this.mark.toString():""),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}YAMLException$4.prototype=Object.create(Error.prototype);YAMLException$4.prototype.constructor=YAMLException$4;YAMLException$4.prototype.toString=function(a){var o=this.name+": ";return o+=this.reason||"(unknown reason)",!a&&this.mark&&(o+=" "+this.mark.toString()),o};var exception=YAMLException$4,common$5=common$6;function Mark$1(e,a,o,c,d){this.name=e,this.buffer=a,this.position=o,this.line=c,this.column=d}Mark$1.prototype.getSnippet=function(a,o){var c,d,$,g,b;if(!this.buffer)return null;for(a=a||4,o=o||75,c="",d=this.position;d>0&&`\0\r
\u2028\u2029`.indexOf(this.buffer.charAt(d-1))===-1;)if(d-=1,this.position-d>o/2-1){c=" ... ",d+=5;break}for($="",g=this.position;g<this.buffer.length&&`\0\r
\u2028\u2029`.indexOf(this.buffer.charAt(g))===-1;)if(g+=1,g-this.position>o/2-1){$=" ... ",g-=5;break}return b=this.buffer.slice(d,g),common$5.repeat(" ",a)+c+b+$+`
`+common$5.repeat(" ",a+this.position-d+c.length)+"^"};Mark$1.prototype.toString=function(a){var o,c="";return this.name&&(c+='in "'+this.name+'" '),c+="at line "+(this.line+1)+", column "+(this.column+1),a||(o=this.getSnippet(),o&&(c+=`:
`+o)),c};var mark$1=Mark$1,YAMLException$3=exception,TYPE_CONSTRUCTOR_OPTIONS=["kind","resolve","construct","instanceOf","predicate","represent","defaultStyle","styleAliases"],YAML_NODE_KINDS=["scalar","sequence","mapping"];function compileStyleAliases(e){var a={};return e!==null&&Object.keys(e).forEach(function(o){e[o].forEach(function(c){a[String(c)]=o})}),a}function Type$h(e,a){if(a=a||{},Object.keys(a).forEach(function(o){if(TYPE_CONSTRUCTOR_OPTIONS.indexOf(o)===-1)throw new YAMLException$3('Unknown option "'+o+'" is met in definition of "'+e+'" YAML type.')}),this.tag=e,this.kind=a.kind||null,this.resolve=a.resolve||function(){return!0},this.construct=a.construct||function(o){return o},this.instanceOf=a.instanceOf||null,this.predicate=a.predicate||null,this.represent=a.represent||null,this.defaultStyle=a.defaultStyle||null,this.styleAliases=compileStyleAliases(a.styleAliases||null),YAML_NODE_KINDS.indexOf(this.kind)===-1)throw new YAMLException$3('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var type=Type$h,common$4=common$6,YAMLException$2=exception,Type$g=type;function compileList(e,a,o){var c=[];return e.include.forEach(function(d){o=compileList(d,a,o)}),e[a].forEach(function(d){o.forEach(function($,g){$.tag===d.tag&&$.kind===d.kind&&c.push(g)}),o.push(d)}),o.filter(function(d,$){return c.indexOf($)===-1})}function compileMap(){var e={scalar:{},sequence:{},mapping:{},fallback:{}},a,o;function c(d){e[d.kind][d.tag]=e.fallback[d.tag]=d}for(a=0,o=arguments.length;a<o;a+=1)arguments[a].forEach(c);return e}function Schema$6(e){this.include=e.include||[],this.implicit=e.implicit||[],this.explicit=e.explicit||[],this.implicit.forEach(function(a){if(a.loadKind&&a.loadKind!=="scalar")throw new YAMLException$2("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.")}),this.compiledImplicit=compileList(this,"implicit",[]),this.compiledExplicit=compileList(this,"explicit",[]),this.compiledTypeMap=compileMap(this.compiledImplicit,this.compiledExplicit)}Schema$6.DEFAULT=null;Schema$6.create=function(){var a,o;switch(arguments.length){case 1:a=Schema$6.DEFAULT,o=arguments[0];break;case 2:a=arguments[0],o=arguments[1];break;default:throw new YAMLException$2("Wrong number of arguments for Schema.create function")}if(a=common$4.toArray(a),o=common$4.toArray(o),!a.every(function(c){return c instanceof Schema$6}))throw new YAMLException$2("Specified list of super schemas (or a single Schema object) contains a non-Schema object.");if(!o.every(function(c){return c instanceof Type$g}))throw new YAMLException$2("Specified list of YAML types (or a single Type object) contains a non-Type object.");return new Schema$6({include:a,explicit:o})};var schema=Schema$6,Type$f=type,str=new Type$f("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),Type$e=type,seq=new Type$e("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),Type$d=type,map=new Type$d("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),Schema$5=schema,failsafe=new Schema$5({explicit:[str,seq,map]}),Type$c=type;function resolveYamlNull(e){if(e===null)return!0;var a=e.length;return a===1&&e==="~"||a===4&&(e==="null"||e==="Null"||e==="NULL")}function constructYamlNull(){return null}function isNull(e){return e===null}var _null=new Type$c("tag:yaml.org,2002:null",{kind:"scalar",resolve:resolveYamlNull,construct:constructYamlNull,predicate:isNull,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"}},defaultStyle:"lowercase"}),Type$b=type;function resolveYamlBoolean(e){if(e===null)return!1;var a=e.length;return a===4&&(e==="true"||e==="True"||e==="TRUE")||a===5&&(e==="false"||e==="False"||e==="FALSE")}function constructYamlBoolean(e){return e==="true"||e==="True"||e==="TRUE"}function isBoolean(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var bool=new Type$b("tag:yaml.org,2002:bool",{kind:"scalar",resolve:resolveYamlBoolean,construct:constructYamlBoolean,predicate:isBoolean,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"}),common$3=common$6,Type$a=type;function isHexCode(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function isOctCode(e){return 48<=e&&e<=55}function isDecCode(e){return 48<=e&&e<=57}function resolveYamlInteger(e){if(e===null)return!1;var a=e.length,o=0,c=!1,d;if(!a)return!1;if(d=e[o],(d==="-"||d==="+")&&(d=e[++o]),d==="0"){if(o+1===a)return!0;if(d=e[++o],d==="b"){for(o++;o<a;o++)if(d=e[o],d!=="_"){if(d!=="0"&&d!=="1")return!1;c=!0}return c&&d!=="_"}if(d==="x"){for(o++;o<a;o++)if(d=e[o],d!=="_"){if(!isHexCode(e.charCodeAt(o)))return!1;c=!0}return c&&d!=="_"}for(;o<a;o++)if(d=e[o],d!=="_"){if(!isOctCode(e.charCodeAt(o)))return!1;c=!0}return c&&d!=="_"}if(d==="_")return!1;for(;o<a;o++)if(d=e[o],d!=="_"){if(d===":")break;if(!isDecCode(e.charCodeAt(o)))return!1;c=!0}return!c||d==="_"?!1:d!==":"?!0:/^(:[0-5]?[0-9])+$/.test(e.slice(o))}function constructYamlInteger(e){var a=e,o=1,c,d,$=[];return a.indexOf("_")!==-1&&(a=a.replace(/_/g,"")),c=a[0],(c==="-"||c==="+")&&(c==="-"&&(o=-1),a=a.slice(1),c=a[0]),a==="0"?0:c==="0"?a[1]==="b"?o*parseInt(a.slice(2),2):a[1]==="x"?o*parseInt(a,16):o*parseInt(a,8):a.indexOf(":")!==-1?(a.split(":").forEach(function(g){$.unshift(parseInt(g,10))}),a=0,d=1,$.forEach(function(g){a+=g*d,d*=60}),o*a):o*parseInt(a,10)}function isInteger(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!common$3.isNegativeZero(e)}var int=new Type$a("tag:yaml.org,2002:int",{kind:"scalar",resolve:resolveYamlInteger,construct:constructYamlInteger,predicate:isInteger,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0"+e.toString(8):"-0"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),common$2=common$6,Type$9=type,YAML_FLOAT_PATTERN=new RegExp("^(?:[-+]?(?:0|[1-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\\.[0-9_]*|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function resolveYamlFloat(e){return!(e===null||!YAML_FLOAT_PATTERN.test(e)||e[e.length-1]==="_")}function constructYamlFloat(e){var a,o,c,d;return a=e.replace(/_/g,"").toLowerCase(),o=a[0]==="-"?-1:1,d=[],"+-".indexOf(a[0])>=0&&(a=a.slice(1)),a===".inf"?o===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:a===".nan"?NaN:a.indexOf(":")>=0?(a.split(":").forEach(function($){d.unshift(parseFloat($,10))}),a=0,c=1,d.forEach(function($){a+=$*c,c*=60}),o*a):o*parseFloat(a,10)}var SCIENTIFIC_WITHOUT_DOT=/^[-+]?[0-9]+e/;function representYamlFloat(e,a){var o;if(isNaN(e))switch(a){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(a){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(a){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(common$2.isNegativeZero(e))return"-0.0";return o=e.toString(10),SCIENTIFIC_WITHOUT_DOT.test(o)?o.replace("e",".e"):o}function isFloat(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||common$2.isNegativeZero(e))}var float=new Type$9("tag:yaml.org,2002:float",{kind:"scalar",resolve:resolveYamlFloat,construct:constructYamlFloat,predicate:isFloat,represent:representYamlFloat,defaultStyle:"lowercase"}),Schema$4=schema,json=new Schema$4({include:[failsafe],implicit:[_null,bool,int,float]}),Schema$3=schema,core=new Schema$3({include:[json]}),Type$8=type,YAML_DATE_REGEXP=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),YAML_TIMESTAMP_REGEXP=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function resolveYamlTimestamp(e){return e===null?!1:YAML_DATE_REGEXP.exec(e)!==null||YAML_TIMESTAMP_REGEXP.exec(e)!==null}function constructYamlTimestamp(e){var a,o,c,d,$,g,b,_=0,j=null,_e,et,tt;if(a=YAML_DATE_REGEXP.exec(e),a===null&&(a=YAML_TIMESTAMP_REGEXP.exec(e)),a===null)throw new Error("Date resolve error");if(o=+a[1],c=+a[2]-1,d=+a[3],!a[4])return new Date(Date.UTC(o,c,d));if($=+a[4],g=+a[5],b=+a[6],a[7]){for(_=a[7].slice(0,3);_.length<3;)_+="0";_=+_}return a[9]&&(_e=+a[10],et=+(a[11]||0),j=(_e*60+et)*6e4,a[9]==="-"&&(j=-j)),tt=new Date(Date.UTC(o,c,d,$,g,b,_)),j&&tt.setTime(tt.getTime()-j),tt}function representYamlTimestamp(e){return e.toISOString()}var timestamp=new Type$8("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:resolveYamlTimestamp,construct:constructYamlTimestamp,instanceOf:Date,represent:representYamlTimestamp}),Type$7=type;function resolveYamlMerge(e){return e==="<<"||e===null}var merge$1=new Type$7("tag:yaml.org,2002:merge",{kind:"scalar",resolve:resolveYamlMerge});function commonjsRequire(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var NodeBuffer;try{var _require$1=commonjsRequire;NodeBuffer=_require$1("buffer").Buffer}catch{}var Type$6=type,BASE64_MAP=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function resolveYamlBinary(e){if(e===null)return!1;var a,o,c=0,d=e.length,$=BASE64_MAP;for(o=0;o<d;o++)if(a=$.indexOf(e.charAt(o)),!(a>64)){if(a<0)return!1;c+=6}return c%8===0}function constructYamlBinary(e){var a,o,c=e.replace(/[\r\n=]/g,""),d=c.length,$=BASE64_MAP,g=0,b=[];for(a=0;a<d;a++)a%4===0&&a&&(b.push(g>>16&255),b.push(g>>8&255),b.push(g&255)),g=g<<6|$.indexOf(c.charAt(a));return o=d%4*6,o===0?(b.push(g>>16&255),b.push(g>>8&255),b.push(g&255)):o===18?(b.push(g>>10&255),b.push(g>>2&255)):o===12&&b.push(g>>4&255),NodeBuffer?NodeBuffer.from?NodeBuffer.from(b):new NodeBuffer(b):b}function representYamlBinary(e){var a="",o=0,c,d,$=e.length,g=BASE64_MAP;for(c=0;c<$;c++)c%3===0&&c&&(a+=g[o>>18&63],a+=g[o>>12&63],a+=g[o>>6&63],a+=g[o&63]),o=(o<<8)+e[c];return d=$%3,d===0?(a+=g[o>>18&63],a+=g[o>>12&63],a+=g[o>>6&63],a+=g[o&63]):d===2?(a+=g[o>>10&63],a+=g[o>>4&63],a+=g[o<<2&63],a+=g[64]):d===1&&(a+=g[o>>2&63],a+=g[o<<4&63],a+=g[64],a+=g[64]),a}function isBinary(e){return NodeBuffer&&NodeBuffer.isBuffer(e)}var binary=new Type$6("tag:yaml.org,2002:binary",{kind:"scalar",resolve:resolveYamlBinary,construct:constructYamlBinary,predicate:isBinary,represent:representYamlBinary}),Type$5=type,_hasOwnProperty$3=Object.prototype.hasOwnProperty,_toString$2=Object.prototype.toString;function resolveYamlOmap(e){if(e===null)return!0;var a=[],o,c,d,$,g,b=e;for(o=0,c=b.length;o<c;o+=1){if(d=b[o],g=!1,_toString$2.call(d)!=="[object Object]")return!1;for($ in d)if(_hasOwnProperty$3.call(d,$))if(!g)g=!0;else return!1;if(!g)return!1;if(a.indexOf($)===-1)a.push($);else return!1}return!0}function constructYamlOmap(e){return e!==null?e:[]}var omap=new Type$5("tag:yaml.org,2002:omap",{kind:"sequence",resolve:resolveYamlOmap,construct:constructYamlOmap}),Type$4=type,_toString$1=Object.prototype.toString;function resolveYamlPairs(e){if(e===null)return!0;var a,o,c,d,$,g=e;for($=new Array(g.length),a=0,o=g.length;a<o;a+=1){if(c=g[a],_toString$1.call(c)!=="[object Object]"||(d=Object.keys(c),d.length!==1))return!1;$[a]=[d[0],c[d[0]]]}return!0}function constructYamlPairs(e){if(e===null)return[];var a,o,c,d,$,g=e;for($=new Array(g.length),a=0,o=g.length;a<o;a+=1)c=g[a],d=Object.keys(c),$[a]=[d[0],c[d[0]]];return $}var pairs=new Type$4("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:resolveYamlPairs,construct:constructYamlPairs}),Type$3=type,_hasOwnProperty$2=Object.prototype.hasOwnProperty;function resolveYamlSet(e){if(e===null)return!0;var a,o=e;for(a in o)if(_hasOwnProperty$2.call(o,a)&&o[a]!==null)return!1;return!0}function constructYamlSet(e){return e!==null?e:{}}var set=new Type$3("tag:yaml.org,2002:set",{kind:"mapping",resolve:resolveYamlSet,construct:constructYamlSet}),Schema$2=schema,default_safe=new Schema$2({include:[core],implicit:[timestamp,merge$1],explicit:[binary,omap,pairs,set]}),Type$2=type;function resolveJavascriptUndefined(){return!0}function constructJavascriptUndefined(){}function representJavascriptUndefined(){return""}function isUndefined(e){return typeof e>"u"}var _undefined=new Type$2("tag:yaml.org,2002:js/undefined",{kind:"scalar",resolve:resolveJavascriptUndefined,construct:constructJavascriptUndefined,predicate:isUndefined,represent:representJavascriptUndefined}),Type$1=type;function resolveJavascriptRegExp(e){if(e===null||e.length===0)return!1;var a=e,o=/\/([gim]*)$/.exec(e),c="";return!(a[0]==="/"&&(o&&(c=o[1]),c.length>3||a[a.length-c.length-1]!=="/"))}function constructJavascriptRegExp(e){var a=e,o=/\/([gim]*)$/.exec(e),c="";return a[0]==="/"&&(o&&(c=o[1]),a=a.slice(1,a.length-c.length-1)),new RegExp(a,c)}function representJavascriptRegExp(e){var a="/"+e.source+"/";return e.global&&(a+="g"),e.multiline&&(a+="m"),e.ignoreCase&&(a+="i"),a}function isRegExp(e){return Object.prototype.toString.call(e)==="[object RegExp]"}var regexp=new Type$1("tag:yaml.org,2002:js/regexp",{kind:"scalar",resolve:resolveJavascriptRegExp,construct:constructJavascriptRegExp,predicate:isRegExp,represent:representJavascriptRegExp}),esprima;try{var _require=commonjsRequire;esprima=_require("esprima")}catch{typeof window<"u"&&(esprima=window.esprima)}var Type=type;function resolveJavascriptFunction(e){if(e===null)return!1;try{var a="("+e+")",o=esprima.parse(a,{range:!0});return!(o.type!=="Program"||o.body.length!==1||o.body[0].type!=="ExpressionStatement"||o.body[0].expression.type!=="ArrowFunctionExpression"&&o.body[0].expression.type!=="FunctionExpression")}catch{return!1}}function constructJavascriptFunction(e){var a="("+e+")",o=esprima.parse(a,{range:!0}),c=[],d;if(o.type!=="Program"||o.body.length!==1||o.body[0].type!=="ExpressionStatement"||o.body[0].expression.type!=="ArrowFunctionExpression"&&o.body[0].expression.type!=="FunctionExpression")throw new Error("Failed to resolve function");return o.body[0].expression.params.forEach(function($){c.push($.name)}),d=o.body[0].expression.body.range,o.body[0].expression.body.type==="BlockStatement"?new Function(c,a.slice(d[0]+1,d[1]-1)):new Function(c,"return "+a.slice(d[0],d[1]))}function representJavascriptFunction(e){return e.toString()}function isFunction(e){return Object.prototype.toString.call(e)==="[object Function]"}var _function=new Type("tag:yaml.org,2002:js/function",{kind:"scalar",resolve:resolveJavascriptFunction,construct:constructJavascriptFunction,predicate:isFunction,represent:representJavascriptFunction}),Schema$1=schema,default_full=Schema$1.DEFAULT=new Schema$1({include:[default_safe],explicit:[_undefined,regexp,_function]}),common$1=common$6,YAMLException$1=exception,Mark=mark$1,DEFAULT_SAFE_SCHEMA$1=default_safe,DEFAULT_FULL_SCHEMA$1=default_full,_hasOwnProperty$1=Object.prototype.hasOwnProperty,CONTEXT_FLOW_IN=1,CONTEXT_FLOW_OUT=2,CONTEXT_BLOCK_IN=3,CONTEXT_BLOCK_OUT=4,CHOMPING_CLIP=1,CHOMPING_STRIP=2,CHOMPING_KEEP=3,PATTERN_NON_PRINTABLE=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,PATTERN_NON_ASCII_LINE_BREAKS=/[\x85\u2028\u2029]/,PATTERN_FLOW_INDICATORS=/[,\[\]\{\}]/,PATTERN_TAG_HANDLE=/^(?:!|!!|![a-z\-]+!)$/i,PATTERN_TAG_URI=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function _class(e){return Object.prototype.toString.call(e)}function is_EOL(e){return e===10||e===13}function is_WHITE_SPACE(e){return e===9||e===32}function is_WS_OR_EOL(e){return e===9||e===32||e===10||e===13}function is_FLOW_INDICATOR(e){return e===44||e===91||e===93||e===123||e===125}function fromHexCode(e){var a;return 48<=e&&e<=57?e-48:(a=e|32,97<=a&&a<=102?a-97+10:-1)}function escapedHexLen(e){return e===120?2:e===117?4:e===85?8:0}function fromDecimalCode(e){return 48<=e&&e<=57?e-48:-1}function simpleEscapeSequence(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"":e===95?" ":e===76?"\u2028":e===80?"\u2029":""}function charFromCodepoint(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}var simpleEscapeCheck=new Array(256),simpleEscapeMap=new Array(256);for(var i$2=0;i$2<256;i$2++)simpleEscapeCheck[i$2]=simpleEscapeSequence(i$2)?1:0,simpleEscapeMap[i$2]=simpleEscapeSequence(i$2);function State$1(e,a){this.input=e,this.filename=a.filename||null,this.schema=a.schema||DEFAULT_FULL_SCHEMA$1,this.onWarning=a.onWarning||null,this.legacy=a.legacy||!1,this.json=a.json||!1,this.listener=a.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.documents=[]}function generateError(e,a){return new YAMLException$1(a,new Mark(e.filename,e.input,e.position,e.line,e.position-e.lineStart))}function throwError(e,a){throw generateError(e,a)}function throwWarning(e,a){e.onWarning&&e.onWarning.call(null,generateError(e,a))}var directiveHandlers={YAML:function(a,o,c){var d,$,g;a.version!==null&&throwError(a,"duplication of %YAML directive"),c.length!==1&&throwError(a,"YAML directive accepts exactly one argument"),d=/^([0-9]+)\.([0-9]+)$/.exec(c[0]),d===null&&throwError(a,"ill-formed argument of the YAML directive"),$=parseInt(d[1],10),g=parseInt(d[2],10),$!==1&&throwError(a,"unacceptable YAML version of the document"),a.version=c[0],a.checkLineBreaks=g<2,g!==1&&g!==2&&throwWarning(a,"unsupported YAML version of the document")},TAG:function(a,o,c){var d,$;c.length!==2&&throwError(a,"TAG directive accepts exactly two arguments"),d=c[0],$=c[1],PATTERN_TAG_HANDLE.test(d)||throwError(a,"ill-formed tag handle (first argument) of the TAG directive"),_hasOwnProperty$1.call(a.tagMap,d)&&throwError(a,'there is a previously declared suffix for "'+d+'" tag handle'),PATTERN_TAG_URI.test($)||throwError(a,"ill-formed tag prefix (second argument) of the TAG directive"),a.tagMap[d]=$}};function captureSegment(e,a,o,c){var d,$,g,b;if(a<o){if(b=e.input.slice(a,o),c)for(d=0,$=b.length;d<$;d+=1)g=b.charCodeAt(d),g===9||32<=g&&g<=1114111||throwError(e,"expected valid JSON character");else PATTERN_NON_PRINTABLE.test(b)&&throwError(e,"the stream contains non-printable characters");e.result+=b}}function mergeMappings(e,a,o,c){var d,$,g,b;for(common$1.isObject(o)||throwError(e,"cannot merge mappings; the provided source object is unacceptable"),d=Object.keys(o),g=0,b=d.length;g<b;g+=1)$=d[g],_hasOwnProperty$1.call(a,$)||(a[$]=o[$],c[$]=!0)}function storeMappingPair(e,a,o,c,d,$,g,b){var _,j;if(Array.isArray(d))for(d=Array.prototype.slice.call(d),_=0,j=d.length;_<j;_+=1)Array.isArray(d[_])&&throwError(e,"nested arrays are not supported inside keys"),typeof d=="object"&&_class(d[_])==="[object Object]"&&(d[_]="[object Object]");if(typeof d=="object"&&_class(d)==="[object Object]"&&(d="[object Object]"),d=String(d),a===null&&(a={}),c==="tag:yaml.org,2002:merge")if(Array.isArray($))for(_=0,j=$.length;_<j;_+=1)mergeMappings(e,a,$[_],o);else mergeMappings(e,a,$,o);else!e.json&&!_hasOwnProperty$1.call(o,d)&&_hasOwnProperty$1.call(a,d)&&(e.line=g||e.line,e.position=b||e.position,throwError(e,"duplicated mapping key")),a[d]=$,delete o[d];return a}function readLineBreak(e){var a;a=e.input.charCodeAt(e.position),a===10?e.position++:a===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):throwError(e,"a line break is expected"),e.line+=1,e.lineStart=e.position}function skipSeparationSpace(e,a,o){for(var c=0,d=e.input.charCodeAt(e.position);d!==0;){for(;is_WHITE_SPACE(d);)d=e.input.charCodeAt(++e.position);if(a&&d===35)do d=e.input.charCodeAt(++e.position);while(d!==10&&d!==13&&d!==0);if(is_EOL(d))for(readLineBreak(e),d=e.input.charCodeAt(e.position),c++,e.lineIndent=0;d===32;)e.lineIndent++,d=e.input.charCodeAt(++e.position);else break}return o!==-1&&c!==0&&e.lineIndent<o&&throwWarning(e,"deficient indentation"),c}function testDocumentSeparator(e){var a=e.position,o;return o=e.input.charCodeAt(a),!!((o===45||o===46)&&o===e.input.charCodeAt(a+1)&&o===e.input.charCodeAt(a+2)&&(a+=3,o=e.input.charCodeAt(a),o===0||is_WS_OR_EOL(o)))}function writeFoldedLines(e,a){a===1?e.result+=" ":a>1&&(e.result+=common$1.repeat(`
`,a-1))}function readPlainScalar(e,a,o){var c,d,$,g,b,_,j,_e,et=e.kind,tt=e.result,nt;if(nt=e.input.charCodeAt(e.position),is_WS_OR_EOL(nt)||is_FLOW_INDICATOR(nt)||nt===35||nt===38||nt===42||nt===33||nt===124||nt===62||nt===39||nt===34||nt===37||nt===64||nt===96||(nt===63||nt===45)&&(d=e.input.charCodeAt(e.position+1),is_WS_OR_EOL(d)||o&&is_FLOW_INDICATOR(d)))return!1;for(e.kind="scalar",e.result="",$=g=e.position,b=!1;nt!==0;){if(nt===58){if(d=e.input.charCodeAt(e.position+1),is_WS_OR_EOL(d)||o&&is_FLOW_INDICATOR(d))break}else if(nt===35){if(c=e.input.charCodeAt(e.position-1),is_WS_OR_EOL(c))break}else{if(e.position===e.lineStart&&testDocumentSeparator(e)||o&&is_FLOW_INDICATOR(nt))break;if(is_EOL(nt))if(_=e.line,j=e.lineStart,_e=e.lineIndent,skipSeparationSpace(e,!1,-1),e.lineIndent>=a){b=!0,nt=e.input.charCodeAt(e.position);continue}else{e.position=g,e.line=_,e.lineStart=j,e.lineIndent=_e;break}}b&&(captureSegment(e,$,g,!1),writeFoldedLines(e,e.line-_),$=g=e.position,b=!1),is_WHITE_SPACE(nt)||(g=e.position+1),nt=e.input.charCodeAt(++e.position)}return captureSegment(e,$,g,!1),e.result?!0:(e.kind=et,e.result=tt,!1)}function readSingleQuotedScalar(e,a){var o,c,d;if(o=e.input.charCodeAt(e.position),o!==39)return!1;for(e.kind="scalar",e.result="",e.position++,c=d=e.position;(o=e.input.charCodeAt(e.position))!==0;)if(o===39)if(captureSegment(e,c,e.position,!0),o=e.input.charCodeAt(++e.position),o===39)c=e.position,e.position++,d=e.position;else return!0;else is_EOL(o)?(captureSegment(e,c,d,!0),writeFoldedLines(e,skipSeparationSpace(e,!1,a)),c=d=e.position):e.position===e.lineStart&&testDocumentSeparator(e)?throwError(e,"unexpected end of the document within a single quoted scalar"):(e.position++,d=e.position);throwError(e,"unexpected end of the stream within a single quoted scalar")}function readDoubleQuotedScalar(e,a){var o,c,d,$,g,b;if(b=e.input.charCodeAt(e.position),b!==34)return!1;for(e.kind="scalar",e.result="",e.position++,o=c=e.position;(b=e.input.charCodeAt(e.position))!==0;){if(b===34)return captureSegment(e,o,e.position,!0),e.position++,!0;if(b===92){if(captureSegment(e,o,e.position,!0),b=e.input.charCodeAt(++e.position),is_EOL(b))skipSeparationSpace(e,!1,a);else if(b<256&&simpleEscapeCheck[b])e.result+=simpleEscapeMap[b],e.position++;else if((g=escapedHexLen(b))>0){for(d=g,$=0;d>0;d--)b=e.input.charCodeAt(++e.position),(g=fromHexCode(b))>=0?$=($<<4)+g:throwError(e,"expected hexadecimal character");e.result+=charFromCodepoint($),e.position++}else throwError(e,"unknown escape sequence");o=c=e.position}else is_EOL(b)?(captureSegment(e,o,c,!0),writeFoldedLines(e,skipSeparationSpace(e,!1,a)),o=c=e.position):e.position===e.lineStart&&testDocumentSeparator(e)?throwError(e,"unexpected end of the document within a double quoted scalar"):(e.position++,c=e.position)}throwError(e,"unexpected end of the stream within a double quoted scalar")}function readFlowCollection(e,a){var o=!0,c,d=e.tag,$,g=e.anchor,b,_,j,_e,et,tt={},nt,at,lt,mt;if(mt=e.input.charCodeAt(e.position),mt===91)_=93,et=!1,$=[];else if(mt===123)_=125,et=!0,$={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=$),mt=e.input.charCodeAt(++e.position);mt!==0;){if(skipSeparationSpace(e,!0,a),mt=e.input.charCodeAt(e.position),mt===_)return e.position++,e.tag=d,e.anchor=g,e.kind=et?"mapping":"sequence",e.result=$,!0;o||throwError(e,"missed comma between flow collection entries"),at=nt=lt=null,j=_e=!1,mt===63&&(b=e.input.charCodeAt(e.position+1),is_WS_OR_EOL(b)&&(j=_e=!0,e.position++,skipSeparationSpace(e,!0,a))),c=e.line,composeNode(e,a,CONTEXT_FLOW_IN,!1,!0),at=e.tag,nt=e.result,skipSeparationSpace(e,!0,a),mt=e.input.charCodeAt(e.position),(_e||e.line===c)&&mt===58&&(j=!0,mt=e.input.charCodeAt(++e.position),skipSeparationSpace(e,!0,a),composeNode(e,a,CONTEXT_FLOW_IN,!1,!0),lt=e.result),et?storeMappingPair(e,$,tt,at,nt,lt):j?$.push(storeMappingPair(e,null,tt,at,nt,lt)):$.push(nt),skipSeparationSpace(e,!0,a),mt=e.input.charCodeAt(e.position),mt===44?(o=!0,mt=e.input.charCodeAt(++e.position)):o=!1}throwError(e,"unexpected end of the stream within a flow collection")}function readBlockScalar(e,a){var o,c,d=CHOMPING_CLIP,$=!1,g=!1,b=a,_=0,j=!1,_e,et;if(et=e.input.charCodeAt(e.position),et===124)c=!1;else if(et===62)c=!0;else return!1;for(e.kind="scalar",e.result="";et!==0;)if(et=e.input.charCodeAt(++e.position),et===43||et===45)CHOMPING_CLIP===d?d=et===43?CHOMPING_KEEP:CHOMPING_STRIP:throwError(e,"repeat of a chomping mode identifier");else if((_e=fromDecimalCode(et))>=0)_e===0?throwError(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):g?throwError(e,"repeat of an indentation width identifier"):(b=a+_e-1,g=!0);else break;if(is_WHITE_SPACE(et)){do et=e.input.charCodeAt(++e.position);while(is_WHITE_SPACE(et));if(et===35)do et=e.input.charCodeAt(++e.position);while(!is_EOL(et)&&et!==0)}for(;et!==0;){for(readLineBreak(e),e.lineIndent=0,et=e.input.charCodeAt(e.position);(!g||e.lineIndent<b)&&et===32;)e.lineIndent++,et=e.input.charCodeAt(++e.position);if(!g&&e.lineIndent>b&&(b=e.lineIndent),is_EOL(et)){_++;continue}if(e.lineIndent<b){d===CHOMPING_KEEP?e.result+=common$1.repeat(`
`,$?1+_:_):d===CHOMPING_CLIP&&$&&(e.result+=`
`);break}for(c?is_WHITE_SPACE(et)?(j=!0,e.result+=common$1.repeat(`
`,$?1+_:_)):j?(j=!1,e.result+=common$1.repeat(`
`,_+1)):_===0?$&&(e.result+=" "):e.result+=common$1.repeat(`
`,_):e.result+=common$1.repeat(`
`,$?1+_:_),$=!0,g=!0,_=0,o=e.position;!is_EOL(et)&&et!==0;)et=e.input.charCodeAt(++e.position);captureSegment(e,o,e.position,!1)}return!0}function readBlockSequence(e,a){var o,c=e.tag,d=e.anchor,$=[],g,b=!1,_;for(e.anchor!==null&&(e.anchorMap[e.anchor]=$),_=e.input.charCodeAt(e.position);_!==0&&!(_!==45||(g=e.input.charCodeAt(e.position+1),!is_WS_OR_EOL(g)));){if(b=!0,e.position++,skipSeparationSpace(e,!0,-1)&&e.lineIndent<=a){$.push(null),_=e.input.charCodeAt(e.position);continue}if(o=e.line,composeNode(e,a,CONTEXT_BLOCK_IN,!1,!0),$.push(e.result),skipSeparationSpace(e,!0,-1),_=e.input.charCodeAt(e.position),(e.line===o||e.lineIndent>a)&&_!==0)throwError(e,"bad indentation of a sequence entry");else if(e.lineIndent<a)break}return b?(e.tag=c,e.anchor=d,e.kind="sequence",e.result=$,!0):!1}function readBlockMapping(e,a,o){var c,d,$,g,b=e.tag,_=e.anchor,j={},_e={},et=null,tt=null,nt=null,at=!1,lt=!1,mt;for(e.anchor!==null&&(e.anchorMap[e.anchor]=j),mt=e.input.charCodeAt(e.position);mt!==0;){if(c=e.input.charCodeAt(e.position+1),$=e.line,g=e.position,(mt===63||mt===58)&&is_WS_OR_EOL(c))mt===63?(at&&(storeMappingPair(e,j,_e,et,tt,null),et=tt=nt=null),lt=!0,at=!0,d=!0):at?(at=!1,d=!0):throwError(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,mt=c;else if(composeNode(e,o,CONTEXT_FLOW_OUT,!1,!0))if(e.line===$){for(mt=e.input.charCodeAt(e.position);is_WHITE_SPACE(mt);)mt=e.input.charCodeAt(++e.position);if(mt===58)mt=e.input.charCodeAt(++e.position),is_WS_OR_EOL(mt)||throwError(e,"a whitespace character is expected after the key-value separator within a block mapping"),at&&(storeMappingPair(e,j,_e,et,tt,null),et=tt=nt=null),lt=!0,at=!1,d=!1,et=e.tag,tt=e.result;else if(lt)throwError(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=b,e.anchor=_,!0}else if(lt)throwError(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=b,e.anchor=_,!0;else break;if((e.line===$||e.lineIndent>a)&&(composeNode(e,a,CONTEXT_BLOCK_OUT,!0,d)&&(at?tt=e.result:nt=e.result),at||(storeMappingPair(e,j,_e,et,tt,nt,$,g),et=tt=nt=null),skipSeparationSpace(e,!0,-1),mt=e.input.charCodeAt(e.position)),e.lineIndent>a&&mt!==0)throwError(e,"bad indentation of a mapping entry");else if(e.lineIndent<a)break}return at&&storeMappingPair(e,j,_e,et,tt,null),lt&&(e.tag=b,e.anchor=_,e.kind="mapping",e.result=j),lt}function readTagProperty(e){var a,o=!1,c=!1,d,$,g;if(g=e.input.charCodeAt(e.position),g!==33)return!1;if(e.tag!==null&&throwError(e,"duplication of a tag property"),g=e.input.charCodeAt(++e.position),g===60?(o=!0,g=e.input.charCodeAt(++e.position)):g===33?(c=!0,d="!!",g=e.input.charCodeAt(++e.position)):d="!",a=e.position,o){do g=e.input.charCodeAt(++e.position);while(g!==0&&g!==62);e.position<e.length?($=e.input.slice(a,e.position),g=e.input.charCodeAt(++e.position)):throwError(e,"unexpected end of the stream within a verbatim tag")}else{for(;g!==0&&!is_WS_OR_EOL(g);)g===33&&(c?throwError(e,"tag suffix cannot contain exclamation marks"):(d=e.input.slice(a-1,e.position+1),PATTERN_TAG_HANDLE.test(d)||throwError(e,"named tag handle cannot contain such characters"),c=!0,a=e.position+1)),g=e.input.charCodeAt(++e.position);$=e.input.slice(a,e.position),PATTERN_FLOW_INDICATORS.test($)&&throwError(e,"tag suffix cannot contain flow indicator characters")}return $&&!PATTERN_TAG_URI.test($)&&throwError(e,"tag name cannot contain such characters: "+$),o?e.tag=$:_hasOwnProperty$1.call(e.tagMap,d)?e.tag=e.tagMap[d]+$:d==="!"?e.tag="!"+$:d==="!!"?e.tag="tag:yaml.org,2002:"+$:throwError(e,'undeclared tag handle "'+d+'"'),!0}function readAnchorProperty(e){var a,o;if(o=e.input.charCodeAt(e.position),o!==38)return!1;for(e.anchor!==null&&throwError(e,"duplication of an anchor property"),o=e.input.charCodeAt(++e.position),a=e.position;o!==0&&!is_WS_OR_EOL(o)&&!is_FLOW_INDICATOR(o);)o=e.input.charCodeAt(++e.position);return e.position===a&&throwError(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(a,e.position),!0}function readAlias(e){var a,o,c;if(c=e.input.charCodeAt(e.position),c!==42)return!1;for(c=e.input.charCodeAt(++e.position),a=e.position;c!==0&&!is_WS_OR_EOL(c)&&!is_FLOW_INDICATOR(c);)c=e.input.charCodeAt(++e.position);return e.position===a&&throwError(e,"name of an alias node must contain at least one character"),o=e.input.slice(a,e.position),_hasOwnProperty$1.call(e.anchorMap,o)||throwError(e,'unidentified alias "'+o+'"'),e.result=e.anchorMap[o],skipSeparationSpace(e,!0,-1),!0}function composeNode(e,a,o,c,d){var $,g,b,_=1,j=!1,_e=!1,et,tt,nt,at,lt;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,$=g=b=CONTEXT_BLOCK_OUT===o||CONTEXT_BLOCK_IN===o,c&&skipSeparationSpace(e,!0,-1)&&(j=!0,e.lineIndent>a?_=1:e.lineIndent===a?_=0:e.lineIndent<a&&(_=-1)),_===1)for(;readTagProperty(e)||readAnchorProperty(e);)skipSeparationSpace(e,!0,-1)?(j=!0,b=$,e.lineIndent>a?_=1:e.lineIndent===a?_=0:e.lineIndent<a&&(_=-1)):b=!1;if(b&&(b=j||d),(_===1||CONTEXT_BLOCK_OUT===o)&&(CONTEXT_FLOW_IN===o||CONTEXT_FLOW_OUT===o?at=a:at=a+1,lt=e.position-e.lineStart,_===1?b&&(readBlockSequence(e,lt)||readBlockMapping(e,lt,at))||readFlowCollection(e,at)?_e=!0:(g&&readBlockScalar(e,at)||readSingleQuotedScalar(e,at)||readDoubleQuotedScalar(e,at)?_e=!0:readAlias(e)?(_e=!0,(e.tag!==null||e.anchor!==null)&&throwError(e,"alias node should not have any properties")):readPlainScalar(e,at,CONTEXT_FLOW_IN===o)&&(_e=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):_===0&&(_e=b&&readBlockSequence(e,lt))),e.tag!==null&&e.tag!=="!")if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&throwError(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),et=0,tt=e.implicitTypes.length;et<tt;et+=1)if(nt=e.implicitTypes[et],nt.resolve(e.result)){e.result=nt.construct(e.result),e.tag=nt.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else _hasOwnProperty$1.call(e.typeMap[e.kind||"fallback"],e.tag)?(nt=e.typeMap[e.kind||"fallback"][e.tag],e.result!==null&&nt.kind!==e.kind&&throwError(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+nt.kind+'", not "'+e.kind+'"'),nt.resolve(e.result)?(e.result=nt.construct(e.result),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):throwError(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")):throwError(e,"unknown tag !<"+e.tag+">");return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||_e}function readDocument(e){var a=e.position,o,c,d,$=!1,g;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap={},e.anchorMap={};(g=e.input.charCodeAt(e.position))!==0&&(skipSeparationSpace(e,!0,-1),g=e.input.charCodeAt(e.position),!(e.lineIndent>0||g!==37));){for($=!0,g=e.input.charCodeAt(++e.position),o=e.position;g!==0&&!is_WS_OR_EOL(g);)g=e.input.charCodeAt(++e.position);for(c=e.input.slice(o,e.position),d=[],c.length<1&&throwError(e,"directive name must not be less than one character in length");g!==0;){for(;is_WHITE_SPACE(g);)g=e.input.charCodeAt(++e.position);if(g===35){do g=e.input.charCodeAt(++e.position);while(g!==0&&!is_EOL(g));break}if(is_EOL(g))break;for(o=e.position;g!==0&&!is_WS_OR_EOL(g);)g=e.input.charCodeAt(++e.position);d.push(e.input.slice(o,e.position))}g!==0&&readLineBreak(e),_hasOwnProperty$1.call(directiveHandlers,c)?directiveHandlers[c](e,c,d):throwWarning(e,'unknown document directive "'+c+'"')}if(skipSeparationSpace(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,skipSeparationSpace(e,!0,-1)):$&&throwError(e,"directives end mark is expected"),composeNode(e,e.lineIndent-1,CONTEXT_BLOCK_OUT,!1,!0),skipSeparationSpace(e,!0,-1),e.checkLineBreaks&&PATTERN_NON_ASCII_LINE_BREAKS.test(e.input.slice(a,e.position))&&throwWarning(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&testDocumentSeparator(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,skipSeparationSpace(e,!0,-1));return}if(e.position<e.length-1)throwError(e,"end of the stream or a document separator is expected");else return}function loadDocuments(e,a){e=String(e),a=a||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var o=new State$1(e,a),c=e.indexOf("\0");for(c!==-1&&(o.position=c,throwError(o,"null byte is not allowed in input")),o.input+="\0";o.input.charCodeAt(o.position)===32;)o.lineIndent+=1,o.position+=1;for(;o.position<o.length-1;)readDocument(o);return o.documents}function loadAll(e,a,o){a!==null&&typeof a=="object"&&typeof o>"u"&&(o=a,a=null);var c=loadDocuments(e,o);if(typeof a!="function")return c;for(var d=0,$=c.length;d<$;d+=1)a(c[d])}function load(e,a){var o=loadDocuments(e,a);if(o.length!==0){if(o.length===1)return o[0];throw new YAMLException$1("expected a single document in the stream, but found more")}}function safeLoadAll(e,a,o){return typeof a=="object"&&a!==null&&typeof o>"u"&&(o=a,a=null),loadAll(e,a,common$1.extend({schema:DEFAULT_SAFE_SCHEMA$1},o))}function safeLoad(e,a){return load(e,common$1.extend({schema:DEFAULT_SAFE_SCHEMA$1},a))}loader$1.loadAll=loadAll;loader$1.load=load;loader$1.safeLoadAll=safeLoadAll;loader$1.safeLoad=safeLoad;var dumper$1={},common=common$6,YAMLException=exception,DEFAULT_FULL_SCHEMA=default_full,DEFAULT_SAFE_SCHEMA=default_safe,_toString=Object.prototype.toString,_hasOwnProperty=Object.prototype.hasOwnProperty,CHAR_TAB=9,CHAR_LINE_FEED=10,CHAR_CARRIAGE_RETURN=13,CHAR_SPACE=32,CHAR_EXCLAMATION=33,CHAR_DOUBLE_QUOTE=34,CHAR_SHARP=35,CHAR_PERCENT=37,CHAR_AMPERSAND=38,CHAR_SINGLE_QUOTE=39,CHAR_ASTERISK=42,CHAR_COMMA=44,CHAR_MINUS=45,CHAR_COLON=58,CHAR_EQUALS=61,CHAR_GREATER_THAN=62,CHAR_QUESTION=63,CHAR_COMMERCIAL_AT=64,CHAR_LEFT_SQUARE_BRACKET=91,CHAR_RIGHT_SQUARE_BRACKET=93,CHAR_GRAVE_ACCENT=96,CHAR_LEFT_CURLY_BRACKET=123,CHAR_VERTICAL_LINE=124,CHAR_RIGHT_CURLY_BRACKET=125,ESCAPE_SEQUENCES={};ESCAPE_SEQUENCES[0]="\\0";ESCAPE_SEQUENCES[7]="\\a";ESCAPE_SEQUENCES[8]="\\b";ESCAPE_SEQUENCES[9]="\\t";ESCAPE_SEQUENCES[10]="\\n";ESCAPE_SEQUENCES[11]="\\v";ESCAPE_SEQUENCES[12]="\\f";ESCAPE_SEQUENCES[13]="\\r";ESCAPE_SEQUENCES[27]="\\e";ESCAPE_SEQUENCES[34]='\\"';ESCAPE_SEQUENCES[92]="\\\\";ESCAPE_SEQUENCES[133]="\\N";ESCAPE_SEQUENCES[160]="\\_";ESCAPE_SEQUENCES[8232]="\\L";ESCAPE_SEQUENCES[8233]="\\P";var DEPRECATED_BOOLEANS_SYNTAX=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"];function compileStyleMap(e,a){var o,c,d,$,g,b,_;if(a===null)return{};for(o={},c=Object.keys(a),d=0,$=c.length;d<$;d+=1)g=c[d],b=String(a[g]),g.slice(0,2)==="!!"&&(g="tag:yaml.org,2002:"+g.slice(2)),_=e.compiledTypeMap.fallback[g],_&&_hasOwnProperty.call(_.styleAliases,b)&&(b=_.styleAliases[b]),o[g]=b;return o}function encodeHex(e){var a,o,c;if(a=e.toString(16).toUpperCase(),e<=255)o="x",c=2;else if(e<=65535)o="u",c=4;else if(e<=4294967295)o="U",c=8;else throw new YAMLException("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+o+common.repeat("0",c-a.length)+a}function State(e){this.schema=e.schema||DEFAULT_FULL_SCHEMA,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=common.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=compileStyleMap(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function indentString(e,a){for(var o=common.repeat(" ",a),c=0,d=-1,$="",g,b=e.length;c<b;)d=e.indexOf(`
`,c),d===-1?(g=e.slice(c),c=b):(g=e.slice(c,d+1),c=d+1),g.length&&g!==`
`&&($+=o),$+=g;return $}function generateNextLine(e,a){return`
`+common.repeat(" ",e.indent*a)}function testImplicitResolving(e,a){var o,c,d;for(o=0,c=e.implicitTypes.length;o<c;o+=1)if(d=e.implicitTypes[o],d.resolve(a))return!0;return!1}function isWhitespace(e){return e===CHAR_SPACE||e===CHAR_TAB}function isPrintable(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==65279||65536<=e&&e<=1114111}function isNsChar(e){return isPrintable(e)&&!isWhitespace(e)&&e!==65279&&e!==CHAR_CARRIAGE_RETURN&&e!==CHAR_LINE_FEED}function isPlainSafe(e,a){return isPrintable(e)&&e!==65279&&e!==CHAR_COMMA&&e!==CHAR_LEFT_SQUARE_BRACKET&&e!==CHAR_RIGHT_SQUARE_BRACKET&&e!==CHAR_LEFT_CURLY_BRACKET&&e!==CHAR_RIGHT_CURLY_BRACKET&&e!==CHAR_COLON&&(e!==CHAR_SHARP||a&&isNsChar(a))}function isPlainSafeFirst(e){return isPrintable(e)&&e!==65279&&!isWhitespace(e)&&e!==CHAR_MINUS&&e!==CHAR_QUESTION&&e!==CHAR_COLON&&e!==CHAR_COMMA&&e!==CHAR_LEFT_SQUARE_BRACKET&&e!==CHAR_RIGHT_SQUARE_BRACKET&&e!==CHAR_LEFT_CURLY_BRACKET&&e!==CHAR_RIGHT_CURLY_BRACKET&&e!==CHAR_SHARP&&e!==CHAR_AMPERSAND&&e!==CHAR_ASTERISK&&e!==CHAR_EXCLAMATION&&e!==CHAR_VERTICAL_LINE&&e!==CHAR_EQUALS&&e!==CHAR_GREATER_THAN&&e!==CHAR_SINGLE_QUOTE&&e!==CHAR_DOUBLE_QUOTE&&e!==CHAR_PERCENT&&e!==CHAR_COMMERCIAL_AT&&e!==CHAR_GRAVE_ACCENT}function needIndentIndicator(e){var a=/^\n* /;return a.test(e)}var STYLE_PLAIN=1,STYLE_SINGLE=2,STYLE_LITERAL=3,STYLE_FOLDED=4,STYLE_DOUBLE=5;function chooseScalarStyle(e,a,o,c,d){var $,g,b,_=!1,j=!1,_e=c!==-1,et=-1,tt=isPlainSafeFirst(e.charCodeAt(0))&&!isWhitespace(e.charCodeAt(e.length-1));if(a)for($=0;$<e.length;$++){if(g=e.charCodeAt($),!isPrintable(g))return STYLE_DOUBLE;b=$>0?e.charCodeAt($-1):null,tt=tt&&isPlainSafe(g,b)}else{for($=0;$<e.length;$++){if(g=e.charCodeAt($),g===CHAR_LINE_FEED)_=!0,_e&&(j=j||$-et-1>c&&e[et+1]!==" ",et=$);else if(!isPrintable(g))return STYLE_DOUBLE;b=$>0?e.charCodeAt($-1):null,tt=tt&&isPlainSafe(g,b)}j=j||_e&&$-et-1>c&&e[et+1]!==" "}return!_&&!j?tt&&!d(e)?STYLE_PLAIN:STYLE_SINGLE:o>9&&needIndentIndicator(e)?STYLE_DOUBLE:j?STYLE_FOLDED:STYLE_LITERAL}function writeScalar(e,a,o,c){e.dump=function(){if(a.length===0)return"''";if(!e.noCompatMode&&DEPRECATED_BOOLEANS_SYNTAX.indexOf(a)!==-1)return"'"+a+"'";var d=e.indent*Math.max(1,o),$=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-d),g=c||e.flowLevel>-1&&o>=e.flowLevel;function b(_){return testImplicitResolving(e,_)}switch(chooseScalarStyle(a,g,e.indent,$,b)){case STYLE_PLAIN:return a;case STYLE_SINGLE:return"'"+a.replace(/'/g,"''")+"'";case STYLE_LITERAL:return"|"+blockHeader(a,e.indent)+dropEndingNewline(indentString(a,d));case STYLE_FOLDED:return">"+blockHeader(a,e.indent)+dropEndingNewline(indentString(foldString(a,$),d));case STYLE_DOUBLE:return'"'+escapeString(a)+'"';default:throw new YAMLException("impossible error: invalid scalar style")}}()}function blockHeader(e,a){var o=needIndentIndicator(e)?String(a):"",c=e[e.length-1]===`
`,d=c&&(e[e.length-2]===`
`||e===`
`),$=d?"+":c?"":"-";return o+$+`
`}function dropEndingNewline(e){return e[e.length-1]===`
`?e.slice(0,-1):e}function foldString(e,a){for(var o=/(\n+)([^\n]*)/g,c=function(){var j=e.indexOf(`
`);return j=j!==-1?j:e.length,o.lastIndex=j,foldLine(e.slice(0,j),a)}(),d=e[0]===`
`||e[0]===" ",$,g;g=o.exec(e);){var b=g[1],_=g[2];$=_[0]===" ",c+=b+(!d&&!$&&_!==""?`
`:"")+foldLine(_,a),d=$}return c}function foldLine(e,a){if(e===""||e[0]===" ")return e;for(var o=/ [^ ]/g,c,d=0,$,g=0,b=0,_="";c=o.exec(e);)b=c.index,b-d>a&&($=g>d?g:b,_+=`
`+e.slice(d,$),d=$+1),g=b;return _+=`
`,e.length-d>a&&g>d?_+=e.slice(d,g)+`
`+e.slice(g+1):_+=e.slice(d),_.slice(1)}function escapeString(e){for(var a="",o,c,d,$=0;$<e.length;$++){if(o=e.charCodeAt($),o>=55296&&o<=56319&&(c=e.charCodeAt($+1),c>=56320&&c<=57343)){a+=encodeHex((o-55296)*1024+c-56320+65536),$++;continue}d=ESCAPE_SEQUENCES[o],a+=!d&&isPrintable(o)?e[$]:d||encodeHex(o)}return a}function writeFlowSequence(e,a,o){var c="",d=e.tag,$,g;for($=0,g=o.length;$<g;$+=1)writeNode(e,a,o[$],!1,!1)&&($!==0&&(c+=","+(e.condenseFlow?"":" ")),c+=e.dump);e.tag=d,e.dump="["+c+"]"}function writeBlockSequence(e,a,o,c){var d="",$=e.tag,g,b;for(g=0,b=o.length;g<b;g+=1)writeNode(e,a+1,o[g],!0,!0)&&((!c||g!==0)&&(d+=generateNextLine(e,a)),e.dump&&CHAR_LINE_FEED===e.dump.charCodeAt(0)?d+="-":d+="- ",d+=e.dump);e.tag=$,e.dump=d||"[]"}function writeFlowMapping(e,a,o){var c="",d=e.tag,$=Object.keys(o),g,b,_,j,_e;for(g=0,b=$.length;g<b;g+=1)_e="",g!==0&&(_e+=", "),e.condenseFlow&&(_e+='"'),_=$[g],j=o[_],writeNode(e,a,_,!1,!1)&&(e.dump.length>1024&&(_e+="? "),_e+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),writeNode(e,a,j,!1,!1)&&(_e+=e.dump,c+=_e));e.tag=d,e.dump="{"+c+"}"}function writeBlockMapping(e,a,o,c){var d="",$=e.tag,g=Object.keys(o),b,_,j,_e,et,tt;if(e.sortKeys===!0)g.sort();else if(typeof e.sortKeys=="function")g.sort(e.sortKeys);else if(e.sortKeys)throw new YAMLException("sortKeys must be a boolean or a function");for(b=0,_=g.length;b<_;b+=1)tt="",(!c||b!==0)&&(tt+=generateNextLine(e,a)),j=g[b],_e=o[j],writeNode(e,a+1,j,!0,!0,!0)&&(et=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,et&&(e.dump&&CHAR_LINE_FEED===e.dump.charCodeAt(0)?tt+="?":tt+="? "),tt+=e.dump,et&&(tt+=generateNextLine(e,a)),writeNode(e,a+1,_e,!0,et)&&(e.dump&&CHAR_LINE_FEED===e.dump.charCodeAt(0)?tt+=":":tt+=": ",tt+=e.dump,d+=tt));e.tag=$,e.dump=d||"{}"}function detectType(e,a,o){var c,d,$,g,b,_;for(d=o?e.explicitTypes:e.implicitTypes,$=0,g=d.length;$<g;$+=1)if(b=d[$],(b.instanceOf||b.predicate)&&(!b.instanceOf||typeof a=="object"&&a instanceof b.instanceOf)&&(!b.predicate||b.predicate(a))){if(e.tag=o?b.tag:"?",b.represent){if(_=e.styleMap[b.tag]||b.defaultStyle,_toString.call(b.represent)==="[object Function]")c=b.represent(a,_);else if(_hasOwnProperty.call(b.represent,_))c=b.represent[_](a,_);else throw new YAMLException("!<"+b.tag+'> tag resolver accepts not "'+_+'" style');e.dump=c}return!0}return!1}function writeNode(e,a,o,c,d,$){e.tag=null,e.dump=o,detectType(e,o,!1)||detectType(e,o,!0);var g=_toString.call(e.dump);c&&(c=e.flowLevel<0||e.flowLevel>a);var b=g==="[object Object]"||g==="[object Array]",_,j;if(b&&(_=e.duplicates.indexOf(o),j=_!==-1),(e.tag!==null&&e.tag!=="?"||j||e.indent!==2&&a>0)&&(d=!1),j&&e.usedDuplicates[_])e.dump="*ref_"+_;else{if(b&&j&&!e.usedDuplicates[_]&&(e.usedDuplicates[_]=!0),g==="[object Object]")c&&Object.keys(e.dump).length!==0?(writeBlockMapping(e,a,e.dump,d),j&&(e.dump="&ref_"+_+e.dump)):(writeFlowMapping(e,a,e.dump),j&&(e.dump="&ref_"+_+" "+e.dump));else if(g==="[object Array]"){var _e=e.noArrayIndent&&a>0?a-1:a;c&&e.dump.length!==0?(writeBlockSequence(e,_e,e.dump,d),j&&(e.dump="&ref_"+_+e.dump)):(writeFlowSequence(e,_e,e.dump),j&&(e.dump="&ref_"+_+" "+e.dump))}else if(g==="[object String]")e.tag!=="?"&&writeScalar(e,e.dump,a,$);else{if(e.skipInvalid)return!1;throw new YAMLException("unacceptable kind of an object to dump "+g)}e.tag!==null&&e.tag!=="?"&&(e.dump="!<"+e.tag+"> "+e.dump)}return!0}function getDuplicateReferences(e,a){var o=[],c=[],d,$;for(inspectNode(e,o,c),d=0,$=c.length;d<$;d+=1)a.duplicates.push(o[c[d]]);a.usedDuplicates=new Array($)}function inspectNode(e,a,o){var c,d,$;if(e!==null&&typeof e=="object")if(d=a.indexOf(e),d!==-1)o.indexOf(d)===-1&&o.push(d);else if(a.push(e),Array.isArray(e))for(d=0,$=e.length;d<$;d+=1)inspectNode(e[d],a,o);else for(c=Object.keys(e),d=0,$=c.length;d<$;d+=1)inspectNode(e[c[d]],a,o)}function dump(e,a){a=a||{};var o=new State(a);return o.noRefs||getDuplicateReferences(e,o),writeNode(o,0,e,!0,!0)?o.dump+`
`:""}function safeDump(e,a){return dump(e,common.extend({schema:DEFAULT_SAFE_SCHEMA},a))}dumper$1.dump=dump;dumper$1.safeDump=safeDump;var loader=loader$1,dumper=dumper$1;function deprecated(e){return function(){throw new Error("Function "+e+" is deprecated and cannot be used.")}}jsYaml$1.Type=type;jsYaml$1.Schema=schema;jsYaml$1.FAILSAFE_SCHEMA=failsafe;jsYaml$1.JSON_SCHEMA=json;jsYaml$1.CORE_SCHEMA=core;jsYaml$1.DEFAULT_SAFE_SCHEMA=default_safe;jsYaml$1.DEFAULT_FULL_SCHEMA=default_full;jsYaml$1.load=loader.load;jsYaml$1.loadAll=loader.loadAll;jsYaml$1.safeLoad=loader.safeLoad;jsYaml$1.safeLoadAll=loader.safeLoadAll;jsYaml$1.dump=dumper.dump;jsYaml$1.safeDump=dumper.safeDump;jsYaml$1.YAMLException=exception;jsYaml$1.MINIMAL_SCHEMA=failsafe;jsYaml$1.SAFE_SCHEMA=default_safe;jsYaml$1.DEFAULT_SCHEMA=default_full;jsYaml$1.scan=deprecated("scan");jsYaml$1.parse=deprecated("parse");jsYaml$1.compose=deprecated("compose");jsYaml$1.addConstructor=deprecated("addConstructor");var yaml=jsYaml$1,jsYaml=yaml;(function(module,exports){const yaml=jsYaml,engines=module.exports;engines.yaml={parse:yaml.safeLoad.bind(yaml),stringify:yaml.safeDump.bind(yaml)},engines.json={parse:JSON.parse.bind(JSON),stringify:function(e,a){const o=Object.assign({replacer:null,space:2},a);return JSON.stringify(e,o.replacer,o.space)}},engines.javascript={parse:function parse(str,options,wrap){try{return wrap!==!1&&(str=`(function() {
return `+str.trim()+`;
}());`),eval(str)||{}}catch(e){if(wrap!==!1&&/(unexpected|identifier)/i.test(e.message))return parse(str,options,!1);throw new SyntaxError(e)}},stringify:function(){throw new Error("stringifying JavaScript is not supported")}}})(engines$2);var enginesExports=engines$2.exports,buffer={},base64Js={};base64Js.byteLength=byteLength;base64Js.toByteArray=toByteArray;base64Js.fromByteArray=fromByteArray;var lookup=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,code$1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i$1=0,len=code$1.length;i$1<len;++i$1)lookup[i$1]=code$1[i$1],revLookup[code$1.charCodeAt(i$1)]=i$1;revLookup[45]=62;revLookup[95]=63;function getLens(e){var a=e.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var o=e.indexOf("=");o===-1&&(o=a);var c=o===a?0:4-o%4;return[o,c]}function byteLength(e){var a=getLens(e),o=a[0],c=a[1];return(o+c)*3/4-c}function _byteLength(e,a,o){return(a+o)*3/4-o}function toByteArray(e){var a,o=getLens(e),c=o[0],d=o[1],$=new Arr(_byteLength(e,c,d)),g=0,b=d>0?c-4:c,_;for(_=0;_<b;_+=4)a=revLookup[e.charCodeAt(_)]<<18|revLookup[e.charCodeAt(_+1)]<<12|revLookup[e.charCodeAt(_+2)]<<6|revLookup[e.charCodeAt(_+3)],$[g++]=a>>16&255,$[g++]=a>>8&255,$[g++]=a&255;return d===2&&(a=revLookup[e.charCodeAt(_)]<<2|revLookup[e.charCodeAt(_+1)]>>4,$[g++]=a&255),d===1&&(a=revLookup[e.charCodeAt(_)]<<10|revLookup[e.charCodeAt(_+1)]<<4|revLookup[e.charCodeAt(_+2)]>>2,$[g++]=a>>8&255,$[g++]=a&255),$}function tripletToBase64(e){return lookup[e>>18&63]+lookup[e>>12&63]+lookup[e>>6&63]+lookup[e&63]}function encodeChunk(e,a,o){for(var c,d=[],$=a;$<o;$+=3)c=(e[$]<<16&16711680)+(e[$+1]<<8&65280)+(e[$+2]&255),d.push(tripletToBase64(c));return d.join("")}function fromByteArray(e){for(var a,o=e.length,c=o%3,d=[],$=16383,g=0,b=o-c;g<b;g+=$)d.push(encodeChunk(e,g,g+$>b?b:g+$));return c===1?(a=e[o-1],d.push(lookup[a>>2]+lookup[a<<4&63]+"==")):c===2&&(a=(e[o-2]<<8)+e[o-1],d.push(lookup[a>>10]+lookup[a>>4&63]+lookup[a<<2&63]+"=")),d.join("")}var ieee754={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ieee754.read=function(e,a,o,c,d){var $,g,b=d*8-c-1,_=(1<<b)-1,j=_>>1,_e=-7,et=o?d-1:0,tt=o?-1:1,nt=e[a+et];for(et+=tt,$=nt&(1<<-_e)-1,nt>>=-_e,_e+=b;_e>0;$=$*256+e[a+et],et+=tt,_e-=8);for(g=$&(1<<-_e)-1,$>>=-_e,_e+=c;_e>0;g=g*256+e[a+et],et+=tt,_e-=8);if($===0)$=1-j;else{if($===_)return g?NaN:(nt?-1:1)*(1/0);g=g+Math.pow(2,c),$=$-j}return(nt?-1:1)*g*Math.pow(2,$-c)};ieee754.write=function(e,a,o,c,d,$){var g,b,_,j=$*8-d-1,_e=(1<<j)-1,et=_e>>1,tt=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,nt=c?0:$-1,at=c?1:-1,lt=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(b=isNaN(a)?1:0,g=_e):(g=Math.floor(Math.log(a)/Math.LN2),a*(_=Math.pow(2,-g))<1&&(g--,_*=2),g+et>=1?a+=tt/_:a+=tt*Math.pow(2,1-et),a*_>=2&&(g++,_/=2),g+et>=_e?(b=0,g=_e):g+et>=1?(b=(a*_-1)*Math.pow(2,d),g=g+et):(b=a*Math.pow(2,et-1)*Math.pow(2,d),g=0));d>=8;e[o+nt]=b&255,nt+=at,b/=256,d-=8);for(g=g<<d|b,j+=d;j>0;e[o+nt]=g&255,nt+=at,g/=256,j-=8);e[o+nt-at]|=lt*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const a=base64Js,o=ieee754,c=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=_e,e.SlowBuffer=gt,e.INSPECT_MAX_BYTES=50;const d=2147483647;e.kMaxLength=d;const{Uint8Array:$,ArrayBuffer:g,SharedArrayBuffer:b}=globalThis;_e.TYPED_ARRAY_SUPPORT=_(),!_e.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function _(){try{const ct=new $(1),rt={foo:function(){return 42}};return Object.setPrototypeOf(rt,$.prototype),Object.setPrototypeOf(ct,rt),ct.foo()===42}catch{return!1}}Object.defineProperty(_e.prototype,"parent",{enumerable:!0,get:function(){if(_e.isBuffer(this))return this.buffer}}),Object.defineProperty(_e.prototype,"offset",{enumerable:!0,get:function(){if(_e.isBuffer(this))return this.byteOffset}});function j(ct){if(ct>d)throw new RangeError('The value "'+ct+'" is invalid for option "size"');const rt=new $(ct);return Object.setPrototypeOf(rt,_e.prototype),rt}function _e(ct,rt,it){if(typeof ct=="number"){if(typeof rt=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return at(ct)}return et(ct,rt,it)}_e.poolSize=8192;function et(ct,rt,it){if(typeof ct=="string")return lt(ct,rt);if(g.isView(ct))return ot(ct);if(ct==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof ct);if(tn(ct,g)||ct&&tn(ct.buffer,g)||typeof b<"u"&&(tn(ct,b)||ct&&tn(ct.buffer,b)))return st(ct,rt,it);if(typeof ct=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const ht=ct.valueOf&&ct.valueOf();if(ht!=null&&ht!==ct)return _e.from(ht,rt,it);const bt=ut(ct);if(bt)return bt;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof ct[Symbol.toPrimitive]=="function")return _e.from(ct[Symbol.toPrimitive]("string"),rt,it);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof ct)}_e.from=function(ct,rt,it){return et(ct,rt,it)},Object.setPrototypeOf(_e.prototype,$.prototype),Object.setPrototypeOf(_e,$);function tt(ct){if(typeof ct!="number")throw new TypeError('"size" argument must be of type number');if(ct<0)throw new RangeError('The value "'+ct+'" is invalid for option "size"')}function nt(ct,rt,it){return tt(ct),ct<=0?j(ct):rt!==void 0?typeof it=="string"?j(ct).fill(rt,it):j(ct).fill(rt):j(ct)}_e.alloc=function(ct,rt,it){return nt(ct,rt,it)};function at(ct){return tt(ct),j(ct<0?0:pt(ct)|0)}_e.allocUnsafe=function(ct){return at(ct)},_e.allocUnsafeSlow=function(ct){return at(ct)};function lt(ct,rt){if((typeof rt!="string"||rt==="")&&(rt="utf8"),!_e.isEncoding(rt))throw new TypeError("Unknown encoding: "+rt);const it=ft(ct,rt)|0;let ht=j(it);const bt=ht.write(ct,rt);return bt!==it&&(ht=ht.slice(0,bt)),ht}function mt(ct){const rt=ct.length<0?0:pt(ct.length)|0,it=j(rt);for(let ht=0;ht<rt;ht+=1)it[ht]=ct[ht]&255;return it}function ot(ct){if(tn(ct,$)){const rt=new $(ct);return st(rt.buffer,rt.byteOffset,rt.byteLength)}return mt(ct)}function st(ct,rt,it){if(rt<0||ct.byteLength<rt)throw new RangeError('"offset" is outside of buffer bounds');if(ct.byteLength<rt+(it||0))throw new RangeError('"length" is outside of buffer bounds');let ht;return rt===void 0&&it===void 0?ht=new $(ct):it===void 0?ht=new $(ct,rt):ht=new $(ct,rt,it),Object.setPrototypeOf(ht,_e.prototype),ht}function ut(ct){if(_e.isBuffer(ct)){const rt=pt(ct.length)|0,it=j(rt);return it.length===0||ct.copy(it,0,0,rt),it}if(ct.length!==void 0)return typeof ct.length!="number"||kt(ct.length)?j(0):mt(ct);if(ct.type==="Buffer"&&Array.isArray(ct.data))return mt(ct.data)}function pt(ct){if(ct>=d)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+d.toString(16)+" bytes");return ct|0}function gt(ct){return+ct!=ct&&(ct=0),_e.alloc(+ct)}_e.isBuffer=function(rt){return rt!=null&&rt._isBuffer===!0&&rt!==_e.prototype},_e.compare=function(rt,it){if(tn(rt,$)&&(rt=_e.from(rt,rt.offset,rt.byteLength)),tn(it,$)&&(it=_e.from(it,it.offset,it.byteLength)),!_e.isBuffer(rt)||!_e.isBuffer(it))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(rt===it)return 0;let ht=rt.length,bt=it.length;for(let xt=0,wt=Math.min(ht,bt);xt<wt;++xt)if(rt[xt]!==it[xt]){ht=rt[xt],bt=it[xt];break}return ht<bt?-1:bt<ht?1:0},_e.isEncoding=function(rt){switch(String(rt).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},_e.concat=function(rt,it){if(!Array.isArray(rt))throw new TypeError('"list" argument must be an Array of Buffers');if(rt.length===0)return _e.alloc(0);let ht;if(it===void 0)for(it=0,ht=0;ht<rt.length;++ht)it+=rt[ht].length;const bt=_e.allocUnsafe(it);let xt=0;for(ht=0;ht<rt.length;++ht){let wt=rt[ht];if(tn(wt,$))xt+wt.length>bt.length?(_e.isBuffer(wt)||(wt=_e.from(wt)),wt.copy(bt,xt)):$.prototype.set.call(bt,wt,xt);else if(_e.isBuffer(wt))wt.copy(bt,xt);else throw new TypeError('"list" argument must be an Array of Buffers');xt+=wt.length}return bt};function ft(ct,rt){if(_e.isBuffer(ct))return ct.length;if(g.isView(ct)||tn(ct,g))return ct.byteLength;if(typeof ct!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof ct);const it=ct.length,ht=arguments.length>2&&arguments[2]===!0;if(!ht&&it===0)return 0;let bt=!1;for(;;)switch(rt){case"ascii":case"latin1":case"binary":return it;case"utf8":case"utf-8":return un(ct).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return it*2;case"hex":return it>>>1;case"base64":return hn(ct).length;default:if(bt)return ht?-1:un(ct).length;rt=(""+rt).toLowerCase(),bt=!0}}_e.byteLength=ft;function yt(ct,rt,it){let ht=!1;if((rt===void 0||rt<0)&&(rt=0),rt>this.length||((it===void 0||it>this.length)&&(it=this.length),it<=0)||(it>>>=0,rt>>>=0,it<=rt))return"";for(ct||(ct="utf8");;)switch(ct){case"hex":return It(this,rt,it);case"utf8":case"utf-8":return Nt(this,rt,it);case"ascii":return dt(this,rt,it);case"latin1":case"binary":return Mt(this,rt,it);case"base64":return zt(this,rt,it);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $t(this,rt,it);default:if(ht)throw new TypeError("Unknown encoding: "+ct);ct=(ct+"").toLowerCase(),ht=!0}}_e.prototype._isBuffer=!0;function _t(ct,rt,it){const ht=ct[rt];ct[rt]=ct[it],ct[it]=ht}_e.prototype.swap16=function(){const rt=this.length;if(rt%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let it=0;it<rt;it+=2)_t(this,it,it+1);return this},_e.prototype.swap32=function(){const rt=this.length;if(rt%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let it=0;it<rt;it+=4)_t(this,it,it+3),_t(this,it+1,it+2);return this},_e.prototype.swap64=function(){const rt=this.length;if(rt%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let it=0;it<rt;it+=8)_t(this,it,it+7),_t(this,it+1,it+6),_t(this,it+2,it+5),_t(this,it+3,it+4);return this},_e.prototype.toString=function(){const rt=this.length;return rt===0?"":arguments.length===0?Nt(this,0,rt):yt.apply(this,arguments)},_e.prototype.toLocaleString=_e.prototype.toString,_e.prototype.equals=function(rt){if(!_e.isBuffer(rt))throw new TypeError("Argument must be a Buffer");return this===rt?!0:_e.compare(this,rt)===0},_e.prototype.inspect=function(){let rt="";const it=e.INSPECT_MAX_BYTES;return rt=this.toString("hex",0,it).replace(/(.{2})/g,"$1 ").trim(),this.length>it&&(rt+=" ... "),"<Buffer "+rt+">"},c&&(_e.prototype[c]=_e.prototype.inspect),_e.prototype.compare=function(rt,it,ht,bt,xt){if(tn(rt,$)&&(rt=_e.from(rt,rt.offset,rt.byteLength)),!_e.isBuffer(rt))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof rt);if(it===void 0&&(it=0),ht===void 0&&(ht=rt?rt.length:0),bt===void 0&&(bt=0),xt===void 0&&(xt=this.length),it<0||ht>rt.length||bt<0||xt>this.length)throw new RangeError("out of range index");if(bt>=xt&&it>=ht)return 0;if(bt>=xt)return-1;if(it>=ht)return 1;if(it>>>=0,ht>>>=0,bt>>>=0,xt>>>=0,this===rt)return 0;let wt=xt-bt,jt=ht-it;const Xt=Math.min(wt,jt),Wt=this.slice(bt,xt),Gt=rt.slice(it,ht);for(let Ut=0;Ut<Xt;++Ut)if(Wt[Ut]!==Gt[Ut]){wt=Wt[Ut],jt=Gt[Ut];break}return wt<jt?-1:jt<wt?1:0};function vt(ct,rt,it,ht,bt){if(ct.length===0)return-1;if(typeof it=="string"?(ht=it,it=0):it>2147483647?it=2147483647:it<-2147483648&&(it=-2147483648),it=+it,kt(it)&&(it=bt?0:ct.length-1),it<0&&(it=ct.length+it),it>=ct.length){if(bt)return-1;it=ct.length-1}else if(it<0)if(bt)it=0;else return-1;if(typeof rt=="string"&&(rt=_e.from(rt,ht)),_e.isBuffer(rt))return rt.length===0?-1:Pt(ct,rt,it,ht,bt);if(typeof rt=="number")return rt=rt&255,typeof $.prototype.indexOf=="function"?bt?$.prototype.indexOf.call(ct,rt,it):$.prototype.lastIndexOf.call(ct,rt,it):Pt(ct,[rt],it,ht,bt);throw new TypeError("val must be string, number or Buffer")}function Pt(ct,rt,it,ht,bt){let xt=1,wt=ct.length,jt=rt.length;if(ht!==void 0&&(ht=String(ht).toLowerCase(),ht==="ucs2"||ht==="ucs-2"||ht==="utf16le"||ht==="utf-16le")){if(ct.length<2||rt.length<2)return-1;xt=2,wt/=2,jt/=2,it/=2}function Xt(Gt,Ut){return xt===1?Gt[Ut]:Gt.readUInt16BE(Ut*xt)}let Wt;if(bt){let Gt=-1;for(Wt=it;Wt<wt;Wt++)if(Xt(ct,Wt)===Xt(rt,Gt===-1?0:Wt-Gt)){if(Gt===-1&&(Gt=Wt),Wt-Gt+1===jt)return Gt*xt}else Gt!==-1&&(Wt-=Wt-Gt),Gt=-1}else for(it+jt>wt&&(it=wt-jt),Wt=it;Wt>=0;Wt--){let Gt=!0;for(let Ut=0;Ut<jt;Ut++)if(Xt(ct,Wt+Ut)!==Xt(rt,Ut)){Gt=!1;break}if(Gt)return Wt}return-1}_e.prototype.includes=function(rt,it,ht){return this.indexOf(rt,it,ht)!==-1},_e.prototype.indexOf=function(rt,it,ht){return vt(this,rt,it,ht,!0)},_e.prototype.lastIndexOf=function(rt,it,ht){return vt(this,rt,it,ht,!1)};function Tt(ct,rt,it,ht){it=Number(it)||0;const bt=ct.length-it;ht?(ht=Number(ht),ht>bt&&(ht=bt)):ht=bt;const xt=rt.length;ht>xt/2&&(ht=xt/2);let wt;for(wt=0;wt<ht;++wt){const jt=parseInt(rt.substr(wt*2,2),16);if(kt(jt))return wt;ct[it+wt]=jt}return wt}function St(ct,rt,it,ht){return mn(un(rt,ct.length-it),ct,it,ht)}function qt(ct,rt,it,ht){return mn(dn(rt),ct,it,ht)}function Ft(ct,rt,it,ht){return mn(hn(rt),ct,it,ht)}function Dt(ct,rt,it,ht){return mn(fn(rt,ct.length-it),ct,it,ht)}_e.prototype.write=function(rt,it,ht,bt){if(it===void 0)bt="utf8",ht=this.length,it=0;else if(ht===void 0&&typeof it=="string")bt=it,ht=this.length,it=0;else if(isFinite(it))it=it>>>0,isFinite(ht)?(ht=ht>>>0,bt===void 0&&(bt="utf8")):(bt=ht,ht=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const xt=this.length-it;if((ht===void 0||ht>xt)&&(ht=xt),rt.length>0&&(ht<0||it<0)||it>this.length)throw new RangeError("Attempt to write outside buffer bounds");bt||(bt="utf8");let wt=!1;for(;;)switch(bt){case"hex":return Tt(this,rt,it,ht);case"utf8":case"utf-8":return St(this,rt,it,ht);case"ascii":case"latin1":case"binary":return qt(this,rt,it,ht);case"base64":return Ft(this,rt,it,ht);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Dt(this,rt,it,ht);default:if(wt)throw new TypeError("Unknown encoding: "+bt);bt=(""+bt).toLowerCase(),wt=!0}},_e.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function zt(ct,rt,it){return rt===0&&it===ct.length?a.fromByteArray(ct):a.fromByteArray(ct.slice(rt,it))}function Nt(ct,rt,it){it=Math.min(ct.length,it);const ht=[];let bt=rt;for(;bt<it;){const xt=ct[bt];let wt=null,jt=xt>239?4:xt>223?3:xt>191?2:1;if(bt+jt<=it){let Xt,Wt,Gt,Ut;switch(jt){case 1:xt<128&&(wt=xt);break;case 2:Xt=ct[bt+1],(Xt&192)===128&&(Ut=(xt&31)<<6|Xt&63,Ut>127&&(wt=Ut));break;case 3:Xt=ct[bt+1],Wt=ct[bt+2],(Xt&192)===128&&(Wt&192)===128&&(Ut=(xt&15)<<12|(Xt&63)<<6|Wt&63,Ut>2047&&(Ut<55296||Ut>57343)&&(wt=Ut));break;case 4:Xt=ct[bt+1],Wt=ct[bt+2],Gt=ct[bt+3],(Xt&192)===128&&(Wt&192)===128&&(Gt&192)===128&&(Ut=(xt&15)<<18|(Xt&63)<<12|(Wt&63)<<6|Gt&63,Ut>65535&&Ut<1114112&&(wt=Ut))}}wt===null?(wt=65533,jt=1):wt>65535&&(wt-=65536,ht.push(wt>>>10&1023|55296),wt=56320|wt&1023),ht.push(wt),bt+=jt}return At(ht)}const Et=4096;function At(ct){const rt=ct.length;if(rt<=Et)return String.fromCharCode.apply(String,ct);let it="",ht=0;for(;ht<rt;)it+=String.fromCharCode.apply(String,ct.slice(ht,ht+=Et));return it}function dt(ct,rt,it){let ht="";it=Math.min(ct.length,it);for(let bt=rt;bt<it;++bt)ht+=String.fromCharCode(ct[bt]&127);return ht}function Mt(ct,rt,it){let ht="";it=Math.min(ct.length,it);for(let bt=rt;bt<it;++bt)ht+=String.fromCharCode(ct[bt]);return ht}function It(ct,rt,it){const ht=ct.length;(!rt||rt<0)&&(rt=0),(!it||it<0||it>ht)&&(it=ht);let bt="";for(let xt=rt;xt<it;++xt)bt+=Ct[ct[xt]];return bt}function $t(ct,rt,it){const ht=ct.slice(rt,it);let bt="";for(let xt=0;xt<ht.length-1;xt+=2)bt+=String.fromCharCode(ht[xt]+ht[xt+1]*256);return bt}_e.prototype.slice=function(rt,it){const ht=this.length;rt=~~rt,it=it===void 0?ht:~~it,rt<0?(rt+=ht,rt<0&&(rt=0)):rt>ht&&(rt=ht),it<0?(it+=ht,it<0&&(it=0)):it>ht&&(it=ht),it<rt&&(it=rt);const bt=this.subarray(rt,it);return Object.setPrototypeOf(bt,_e.prototype),bt};function Lt(ct,rt,it){if(ct%1!==0||ct<0)throw new RangeError("offset is not uint");if(ct+rt>it)throw new RangeError("Trying to access beyond buffer length")}_e.prototype.readUintLE=_e.prototype.readUIntLE=function(rt,it,ht){rt=rt>>>0,it=it>>>0,ht||Lt(rt,it,this.length);let bt=this[rt],xt=1,wt=0;for(;++wt<it&&(xt*=256);)bt+=this[rt+wt]*xt;return bt},_e.prototype.readUintBE=_e.prototype.readUIntBE=function(rt,it,ht){rt=rt>>>0,it=it>>>0,ht||Lt(rt,it,this.length);let bt=this[rt+--it],xt=1;for(;it>0&&(xt*=256);)bt+=this[rt+--it]*xt;return bt},_e.prototype.readUint8=_e.prototype.readUInt8=function(rt,it){return rt=rt>>>0,it||Lt(rt,1,this.length),this[rt]},_e.prototype.readUint16LE=_e.prototype.readUInt16LE=function(rt,it){return rt=rt>>>0,it||Lt(rt,2,this.length),this[rt]|this[rt+1]<<8},_e.prototype.readUint16BE=_e.prototype.readUInt16BE=function(rt,it){return rt=rt>>>0,it||Lt(rt,2,this.length),this[rt]<<8|this[rt+1]},_e.prototype.readUint32LE=_e.prototype.readUInt32LE=function(rt,it){return rt=rt>>>0,it||Lt(rt,4,this.length),(this[rt]|this[rt+1]<<8|this[rt+2]<<16)+this[rt+3]*16777216},_e.prototype.readUint32BE=_e.prototype.readUInt32BE=function(rt,it){return rt=rt>>>0,it||Lt(rt,4,this.length),this[rt]*16777216+(this[rt+1]<<16|this[rt+2]<<8|this[rt+3])},_e.prototype.readBigUInt64LE=Rt(function(rt){rt=rt>>>0,Jt(rt,"offset");const it=this[rt],ht=this[rt+7];(it===void 0||ht===void 0)&&en(rt,this.length-8);const bt=it+this[++rt]*2**8+this[++rt]*2**16+this[++rt]*2**24,xt=this[++rt]+this[++rt]*2**8+this[++rt]*2**16+ht*2**24;return BigInt(bt)+(BigInt(xt)<<BigInt(32))}),_e.prototype.readBigUInt64BE=Rt(function(rt){rt=rt>>>0,Jt(rt,"offset");const it=this[rt],ht=this[rt+7];(it===void 0||ht===void 0)&&en(rt,this.length-8);const bt=it*2**24+this[++rt]*2**16+this[++rt]*2**8+this[++rt],xt=this[++rt]*2**24+this[++rt]*2**16+this[++rt]*2**8+ht;return(BigInt(bt)<<BigInt(32))+BigInt(xt)}),_e.prototype.readIntLE=function(rt,it,ht){rt=rt>>>0,it=it>>>0,ht||Lt(rt,it,this.length);let bt=this[rt],xt=1,wt=0;for(;++wt<it&&(xt*=256);)bt+=this[rt+wt]*xt;return xt*=128,bt>=xt&&(bt-=Math.pow(2,8*it)),bt},_e.prototype.readIntBE=function(rt,it,ht){rt=rt>>>0,it=it>>>0,ht||Lt(rt,it,this.length);let bt=it,xt=1,wt=this[rt+--bt];for(;bt>0&&(xt*=256);)wt+=this[rt+--bt]*xt;return xt*=128,wt>=xt&&(wt-=Math.pow(2,8*it)),wt},_e.prototype.readInt8=function(rt,it){return rt=rt>>>0,it||Lt(rt,1,this.length),this[rt]&128?(255-this[rt]+1)*-1:this[rt]},_e.prototype.readInt16LE=function(rt,it){rt=rt>>>0,it||Lt(rt,2,this.length);const ht=this[rt]|this[rt+1]<<8;return ht&32768?ht|4294901760:ht},_e.prototype.readInt16BE=function(rt,it){rt=rt>>>0,it||Lt(rt,2,this.length);const ht=this[rt+1]|this[rt]<<8;return ht&32768?ht|4294901760:ht},_e.prototype.readInt32LE=function(rt,it){return rt=rt>>>0,it||Lt(rt,4,this.length),this[rt]|this[rt+1]<<8|this[rt+2]<<16|this[rt+3]<<24},_e.prototype.readInt32BE=function(rt,it){return rt=rt>>>0,it||Lt(rt,4,this.length),this[rt]<<24|this[rt+1]<<16|this[rt+2]<<8|this[rt+3]},_e.prototype.readBigInt64LE=Rt(function(rt){rt=rt>>>0,Jt(rt,"offset");const it=this[rt],ht=this[rt+7];(it===void 0||ht===void 0)&&en(rt,this.length-8);const bt=this[rt+4]+this[rt+5]*2**8+this[rt+6]*2**16+(ht<<24);return(BigInt(bt)<<BigInt(32))+BigInt(it+this[++rt]*2**8+this[++rt]*2**16+this[++rt]*2**24)}),_e.prototype.readBigInt64BE=Rt(function(rt){rt=rt>>>0,Jt(rt,"offset");const it=this[rt],ht=this[rt+7];(it===void 0||ht===void 0)&&en(rt,this.length-8);const bt=(it<<24)+this[++rt]*2**16+this[++rt]*2**8+this[++rt];return(BigInt(bt)<<BigInt(32))+BigInt(this[++rt]*2**24+this[++rt]*2**16+this[++rt]*2**8+ht)}),_e.prototype.readFloatLE=function(rt,it){return rt=rt>>>0,it||Lt(rt,4,this.length),o.read(this,rt,!0,23,4)},_e.prototype.readFloatBE=function(rt,it){return rt=rt>>>0,it||Lt(rt,4,this.length),o.read(this,rt,!1,23,4)},_e.prototype.readDoubleLE=function(rt,it){return rt=rt>>>0,it||Lt(rt,8,this.length),o.read(this,rt,!0,52,8)},_e.prototype.readDoubleBE=function(rt,it){return rt=rt>>>0,it||Lt(rt,8,this.length),o.read(this,rt,!1,52,8)};function Ot(ct,rt,it,ht,bt,xt){if(!_e.isBuffer(ct))throw new TypeError('"buffer" argument must be a Buffer instance');if(rt>bt||rt<xt)throw new RangeError('"value" argument is out of bounds');if(it+ht>ct.length)throw new RangeError("Index out of range")}_e.prototype.writeUintLE=_e.prototype.writeUIntLE=function(rt,it,ht,bt){if(rt=+rt,it=it>>>0,ht=ht>>>0,!bt){const jt=Math.pow(2,8*ht)-1;Ot(this,rt,it,ht,jt,0)}let xt=1,wt=0;for(this[it]=rt&255;++wt<ht&&(xt*=256);)this[it+wt]=rt/xt&255;return it+ht},_e.prototype.writeUintBE=_e.prototype.writeUIntBE=function(rt,it,ht,bt){if(rt=+rt,it=it>>>0,ht=ht>>>0,!bt){const jt=Math.pow(2,8*ht)-1;Ot(this,rt,it,ht,jt,0)}let xt=ht-1,wt=1;for(this[it+xt]=rt&255;--xt>=0&&(wt*=256);)this[it+xt]=rt/wt&255;return it+ht},_e.prototype.writeUint8=_e.prototype.writeUInt8=function(rt,it,ht){return rt=+rt,it=it>>>0,ht||Ot(this,rt,it,1,255,0),this[it]=rt&255,it+1},_e.prototype.writeUint16LE=_e.prototype.writeUInt16LE=function(rt,it,ht){return rt=+rt,it=it>>>0,ht||Ot(this,rt,it,2,65535,0),this[it]=rt&255,this[it+1]=rt>>>8,it+2},_e.prototype.writeUint16BE=_e.prototype.writeUInt16BE=function(rt,it,ht){return rt=+rt,it=it>>>0,ht||Ot(this,rt,it,2,65535,0),this[it]=rt>>>8,this[it+1]=rt&255,it+2},_e.prototype.writeUint32LE=_e.prototype.writeUInt32LE=function(rt,it,ht){return rt=+rt,it=it>>>0,ht||Ot(this,rt,it,4,4294967295,0),this[it+3]=rt>>>24,this[it+2]=rt>>>16,this[it+1]=rt>>>8,this[it]=rt&255,it+4},_e.prototype.writeUint32BE=_e.prototype.writeUInt32BE=function(rt,it,ht){return rt=+rt,it=it>>>0,ht||Ot(this,rt,it,4,4294967295,0),this[it]=rt>>>24,this[it+1]=rt>>>16,this[it+2]=rt>>>8,this[it+3]=rt&255,it+4};function Vt(ct,rt,it,ht,bt){rn(rt,ht,bt,ct,it,7);let xt=Number(rt&BigInt(4294967295));ct[it++]=xt,xt=xt>>8,ct[it++]=xt,xt=xt>>8,ct[it++]=xt,xt=xt>>8,ct[it++]=xt;let wt=Number(rt>>BigInt(32)&BigInt(4294967295));return ct[it++]=wt,wt=wt>>8,ct[it++]=wt,wt=wt>>8,ct[it++]=wt,wt=wt>>8,ct[it++]=wt,it}function Ht(ct,rt,it,ht,bt){rn(rt,ht,bt,ct,it,7);let xt=Number(rt&BigInt(4294967295));ct[it+7]=xt,xt=xt>>8,ct[it+6]=xt,xt=xt>>8,ct[it+5]=xt,xt=xt>>8,ct[it+4]=xt;let wt=Number(rt>>BigInt(32)&BigInt(4294967295));return ct[it+3]=wt,wt=wt>>8,ct[it+2]=wt,wt=wt>>8,ct[it+1]=wt,wt=wt>>8,ct[it]=wt,it+8}_e.prototype.writeBigUInt64LE=Rt(function(rt,it=0){return Vt(this,rt,it,BigInt(0),BigInt("0xffffffffffffffff"))}),_e.prototype.writeBigUInt64BE=Rt(function(rt,it=0){return Ht(this,rt,it,BigInt(0),BigInt("0xffffffffffffffff"))}),_e.prototype.writeIntLE=function(rt,it,ht,bt){if(rt=+rt,it=it>>>0,!bt){const Xt=Math.pow(2,8*ht-1);Ot(this,rt,it,ht,Xt-1,-Xt)}let xt=0,wt=1,jt=0;for(this[it]=rt&255;++xt<ht&&(wt*=256);)rt<0&&jt===0&&this[it+xt-1]!==0&&(jt=1),this[it+xt]=(rt/wt>>0)-jt&255;return it+ht},_e.prototype.writeIntBE=function(rt,it,ht,bt){if(rt=+rt,it=it>>>0,!bt){const Xt=Math.pow(2,8*ht-1);Ot(this,rt,it,ht,Xt-1,-Xt)}let xt=ht-1,wt=1,jt=0;for(this[it+xt]=rt&255;--xt>=0&&(wt*=256);)rt<0&&jt===0&&this[it+xt+1]!==0&&(jt=1),this[it+xt]=(rt/wt>>0)-jt&255;return it+ht},_e.prototype.writeInt8=function(rt,it,ht){return rt=+rt,it=it>>>0,ht||Ot(this,rt,it,1,127,-128),rt<0&&(rt=255+rt+1),this[it]=rt&255,it+1},_e.prototype.writeInt16LE=function(rt,it,ht){return rt=+rt,it=it>>>0,ht||Ot(this,rt,it,2,32767,-32768),this[it]=rt&255,this[it+1]=rt>>>8,it+2},_e.prototype.writeInt16BE=function(rt,it,ht){return rt=+rt,it=it>>>0,ht||Ot(this,rt,it,2,32767,-32768),this[it]=rt>>>8,this[it+1]=rt&255,it+2},_e.prototype.writeInt32LE=function(rt,it,ht){return rt=+rt,it=it>>>0,ht||Ot(this,rt,it,4,2147483647,-2147483648),this[it]=rt&255,this[it+1]=rt>>>8,this[it+2]=rt>>>16,this[it+3]=rt>>>24,it+4},_e.prototype.writeInt32BE=function(rt,it,ht){return rt=+rt,it=it>>>0,ht||Ot(this,rt,it,4,2147483647,-2147483648),rt<0&&(rt=4294967295+rt+1),this[it]=rt>>>24,this[it+1]=rt>>>16,this[it+2]=rt>>>8,this[it+3]=rt&255,it+4},_e.prototype.writeBigInt64LE=Rt(function(rt,it=0){return Vt(this,rt,it,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),_e.prototype.writeBigInt64BE=Rt(function(rt,it=0){return Ht(this,rt,it,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Yt(ct,rt,it,ht,bt,xt){if(it+ht>ct.length)throw new RangeError("Index out of range");if(it<0)throw new RangeError("Index out of range")}function Kt(ct,rt,it,ht,bt){return rt=+rt,it=it>>>0,bt||Yt(ct,rt,it,4),o.write(ct,rt,it,ht,23,4),it+4}_e.prototype.writeFloatLE=function(rt,it,ht){return Kt(this,rt,it,!0,ht)},_e.prototype.writeFloatBE=function(rt,it,ht){return Kt(this,rt,it,!1,ht)};function Qt(ct,rt,it,ht,bt){return rt=+rt,it=it>>>0,bt||Yt(ct,rt,it,8),o.write(ct,rt,it,ht,52,8),it+8}_e.prototype.writeDoubleLE=function(rt,it,ht){return Qt(this,rt,it,!0,ht)},_e.prototype.writeDoubleBE=function(rt,it,ht){return Qt(this,rt,it,!1,ht)},_e.prototype.copy=function(rt,it,ht,bt){if(!_e.isBuffer(rt))throw new TypeError("argument should be a Buffer");if(ht||(ht=0),!bt&&bt!==0&&(bt=this.length),it>=rt.length&&(it=rt.length),it||(it=0),bt>0&&bt<ht&&(bt=ht),bt===ht||rt.length===0||this.length===0)return 0;if(it<0)throw new RangeError("targetStart out of bounds");if(ht<0||ht>=this.length)throw new RangeError("Index out of range");if(bt<0)throw new RangeError("sourceEnd out of bounds");bt>this.length&&(bt=this.length),rt.length-it<bt-ht&&(bt=rt.length-it+ht);const xt=bt-ht;return this===rt&&typeof $.prototype.copyWithin=="function"?this.copyWithin(it,ht,bt):$.prototype.set.call(rt,this.subarray(ht,bt),it),xt},_e.prototype.fill=function(rt,it,ht,bt){if(typeof rt=="string"){if(typeof it=="string"?(bt=it,it=0,ht=this.length):typeof ht=="string"&&(bt=ht,ht=this.length),bt!==void 0&&typeof bt!="string")throw new TypeError("encoding must be a string");if(typeof bt=="string"&&!_e.isEncoding(bt))throw new TypeError("Unknown encoding: "+bt);if(rt.length===1){const wt=rt.charCodeAt(0);(bt==="utf8"&&wt<128||bt==="latin1")&&(rt=wt)}}else typeof rt=="number"?rt=rt&255:typeof rt=="boolean"&&(rt=Number(rt));if(it<0||this.length<it||this.length<ht)throw new RangeError("Out of range index");if(ht<=it)return this;it=it>>>0,ht=ht===void 0?this.length:ht>>>0,rt||(rt=0);let xt;if(typeof rt=="number")for(xt=it;xt<ht;++xt)this[xt]=rt;else{const wt=_e.isBuffer(rt)?rt:_e.from(rt,bt),jt=wt.length;if(jt===0)throw new TypeError('The value "'+rt+'" is invalid for argument "value"');for(xt=0;xt<ht-it;++xt)this[xt+it]=wt[xt%jt]}return this};const Zt={};function on(ct,rt,it){Zt[ct]=class extends it{constructor(){super(),Object.defineProperty(this,"message",{value:rt.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${ct}]`,this.stack,delete this.name}get code(){return ct}set code(bt){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:bt,writable:!0})}toString(){return`${this.name} [${ct}]: ${this.message}`}}}on("ERR_BUFFER_OUT_OF_BOUNDS",function(ct){return ct?`${ct} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),on("ERR_INVALID_ARG_TYPE",function(ct,rt){return`The "${ct}" argument must be of type number. Received type ${typeof rt}`},TypeError),on("ERR_OUT_OF_RANGE",function(ct,rt,it){let ht=`The value of "${ct}" is out of range.`,bt=it;return Number.isInteger(it)&&Math.abs(it)>2**32?bt=ln(String(it)):typeof it=="bigint"&&(bt=String(it),(it>BigInt(2)**BigInt(32)||it<-(BigInt(2)**BigInt(32)))&&(bt=ln(bt)),bt+="n"),ht+=` It must be ${rt}. Received ${bt}`,ht},RangeError);function ln(ct){let rt="",it=ct.length;const ht=ct[0]==="-"?1:0;for(;it>=ht+4;it-=3)rt=`_${ct.slice(it-3,it)}${rt}`;return`${ct.slice(0,it)}${rt}`}function sn(ct,rt,it){Jt(rt,"offset"),(ct[rt]===void 0||ct[rt+it]===void 0)&&en(rt,ct.length-(it+1))}function rn(ct,rt,it,ht,bt,xt){if(ct>it||ct<rt){const wt=typeof rt=="bigint"?"n":"";let jt;throw rt===0||rt===BigInt(0)?jt=`>= 0${wt} and < 2${wt} ** ${(xt+1)*8}${wt}`:jt=`>= -(2${wt} ** ${(xt+1)*8-1}${wt}) and < 2 ** ${(xt+1)*8-1}${wt}`,new Zt.ERR_OUT_OF_RANGE("value",jt,ct)}sn(ht,bt,xt)}function Jt(ct,rt){if(typeof ct!="number")throw new Zt.ERR_INVALID_ARG_TYPE(rt,"number",ct)}function en(ct,rt,it){throw Math.floor(ct)!==ct?(Jt(ct,it),new Zt.ERR_OUT_OF_RANGE("offset","an integer",ct)):rt<0?new Zt.ERR_BUFFER_OUT_OF_BOUNDS:new Zt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${rt}`,ct)}const an=/[^+/0-9A-Za-z-_]/g;function nn(ct){if(ct=ct.split("=")[0],ct=ct.trim().replace(an,""),ct.length<2)return"";for(;ct.length%4!==0;)ct=ct+"=";return ct}function un(ct,rt){rt=rt||1/0;let it;const ht=ct.length;let bt=null;const xt=[];for(let wt=0;wt<ht;++wt){if(it=ct.charCodeAt(wt),it>55295&&it<57344){if(!bt){if(it>56319){(rt-=3)>-1&&xt.push(239,191,189);continue}else if(wt+1===ht){(rt-=3)>-1&&xt.push(239,191,189);continue}bt=it;continue}if(it<56320){(rt-=3)>-1&&xt.push(239,191,189),bt=it;continue}it=(bt-55296<<10|it-56320)+65536}else bt&&(rt-=3)>-1&&xt.push(239,191,189);if(bt=null,it<128){if((rt-=1)<0)break;xt.push(it)}else if(it<2048){if((rt-=2)<0)break;xt.push(it>>6|192,it&63|128)}else if(it<65536){if((rt-=3)<0)break;xt.push(it>>12|224,it>>6&63|128,it&63|128)}else if(it<1114112){if((rt-=4)<0)break;xt.push(it>>18|240,it>>12&63|128,it>>6&63|128,it&63|128)}else throw new Error("Invalid code point")}return xt}function dn(ct){const rt=[];for(let it=0;it<ct.length;++it)rt.push(ct.charCodeAt(it)&255);return rt}function fn(ct,rt){let it,ht,bt;const xt=[];for(let wt=0;wt<ct.length&&!((rt-=2)<0);++wt)it=ct.charCodeAt(wt),ht=it>>8,bt=it%256,xt.push(bt),xt.push(ht);return xt}function hn(ct){return a.toByteArray(nn(ct))}function mn(ct,rt,it,ht){let bt;for(bt=0;bt<ht&&!(bt+it>=rt.length||bt>=ct.length);++bt)rt[bt+it]=ct[bt];return bt}function tn(ct,rt){return ct instanceof rt||ct!=null&&ct.constructor!=null&&ct.constructor.name!=null&&ct.constructor.name===rt.name}function kt(ct){return ct!==ct}const Ct=function(){const ct="0123456789abcdef",rt=new Array(256);for(let it=0;it<16;++it){const ht=it*16;for(let bt=0;bt<16;++bt)rt[ht+bt]=ct[it]+ct[bt]}return rt}();function Rt(ct){return typeof BigInt>"u"?Bt:ct}function Bt(){throw new Error("BigInt not supported")}})(buffer);const Buffer=buffer.Buffer;var utils$4={};/*!
 * strip-bom-string <https://github.com/jonschlinkert/strip-bom-string>
 *
 * Copyright (c) 2015, 2017, Jon Schlinkert.
 * Released under the MIT License.
 */var stripBomString=function(e){return typeof e=="string"&&e.charAt(0)==="\uFEFF"?e.slice(1):e};(function(e){const a=stripBomString,o=kindOf;e.define=function(c,d,$){Reflect.defineProperty(c,d,{enumerable:!1,configurable:!0,writable:!0,value:$})},e.isBuffer=function(c){return o(c)==="buffer"},e.isObject=function(c){return o(c)==="object"},e.toBuffer=function(c){return typeof c=="string"?Buffer.from(c):c},e.toString=function(c){if(e.isBuffer(c))return a(String(c));if(typeof c!="string")throw new TypeError("expected input to be a string or buffer");return a(c)},e.arrayify=function(c){return c?Array.isArray(c)?c:[c]:[]},e.startsWith=function(c,d,$){return typeof $!="number"&&($=d.length),c.slice(0,$)===d}})(utils$4);const engines$1=enginesExports,utils$3=utils$4;var defaults$4=function(e){const a=Object.assign({},e);return a.delimiters=utils$3.arrayify(a.delims||a.delimiters||"---"),a.delimiters.length===1&&a.delimiters.push(a.delimiters[0]),a.language=(a.language||a.lang||"yaml").toLowerCase(),a.engines=Object.assign({},engines$1,a.parsers,a.engines),a},engine=function(e,a){let o=a.engines[e]||a.engines[aliase(e)];if(typeof o>"u")throw new Error('gray-matter engine "'+e+'" is not registered');return typeof o=="function"&&(o={parse:o}),o};function aliase(e){switch(e.toLowerCase()){case"js":case"javascript":return"javascript";case"coffee":case"coffeescript":case"cson":return"coffee";case"yaml":case"yml":return"yaml";default:return e}}const typeOf$2=kindOf,getEngine$1=engine,defaults$3=defaults$4;var stringify$4=function(e,a,o){if(a==null&&o==null)switch(typeOf$2(e)){case"object":a=e.data,o={};break;case"string":return e;default:throw new TypeError("expected file to be a string or object")}const c=e.content,d=defaults$3(o);if(a==null){if(!d.data)return e;a=d.data}const $=e.language||d.language,g=getEngine$1($,d);if(typeof g.stringify!="function")throw new TypeError('expected "'+$+'.stringify" to be a function');a=Object.assign({},e.data,a);const b=d.delimiters[0],_=d.delimiters[1],j=g.stringify(a,o).trim();let _e="";return j!=="{}"&&(_e=newline(b)+newline(j)+newline(_)),typeof e.excerpt=="string"&&e.excerpt!==""&&c.indexOf(e.excerpt.trim())===-1&&(_e+=newline(e.excerpt)+newline(_)),_e+newline(c)};function newline(e){return e.slice(-1)!==`
`?e+`
`:e}const defaults$2=defaults$4;var excerpt$1=function(e,a){const o=defaults$2(a);if(e.data==null&&(e.data={}),typeof o.excerpt=="function")return o.excerpt(e,o);const c=e.data.excerpt_separator||o.excerpt_separator;if(c==null&&(o.excerpt===!1||o.excerpt==null))return e;const d=typeof o.excerpt=="string"?o.excerpt:c||o.delimiters[0],$=e.content.indexOf(d);return $!==-1&&(e.excerpt=e.content.slice(0,$)),e};const typeOf$1=kindOf,stringify$3=stringify$4,utils$2=utils$4;var toFile$1=function(e){return typeOf$1(e)!=="object"&&(e={content:e}),typeOf$1(e.data)!=="object"&&(e.data={}),e.contents&&e.content==null&&(e.content=e.contents),utils$2.define(e,"orig",utils$2.toBuffer(e.content)),utils$2.define(e,"language",e.language||""),utils$2.define(e,"matter",e.matter||""),utils$2.define(e,"stringify",function(a,o){return o&&o.language&&(e.language=o.language),stringify$3(e,a,o)}),e.content=utils$2.toString(e.content),e.isEmpty=!1,e.excerpt="",e};const getEngine=engine,defaults$1=defaults$4;var parse$4=function(e,a,o){const c=defaults$1(o),d=getEngine(e,c);if(typeof d.parse!="function")throw new TypeError('expected "'+e+'.parse" to be a function');return d.parse(a,c)};const fs=require$$0,sections=sectionMatter,defaults=defaults$4,stringify$2=stringify$4,excerpt=excerpt$1,engines=enginesExports,toFile=toFile$1,parse$3=parse$4,utils$1=utils$4;function matter(e,a){if(e==="")return{data:{},content:e,excerpt:"",orig:e};let o=toFile(e);const c=matter.cache[o.content];if(!a){if(c)return o=Object.assign({},c),o.orig=c.orig,o;matter.cache[o.content]=o}return parseMatter(o,a)}function parseMatter(e,a){const o=defaults(a),c=o.delimiters[0],d=`
`+o.delimiters[1];let $=e.content;o.language&&(e.language=o.language);const g=c.length;if(!utils$1.startsWith($,c,g))return excerpt(e,o),e;if($.charAt(g)===c.slice(-1))return e;$=$.slice(g);const b=$.length,_=matter.language($,o);_.name&&(e.language=_.name,$=$.slice(_.raw.length));let j=$.indexOf(d);return j===-1&&(j=b),e.matter=$.slice(0,j),e.matter.replace(/^\s*#[^\n]+/gm,"").trim()===""?(e.isEmpty=!0,e.empty=e.content,e.data={}):e.data=parse$3(e.language,e.matter,o),j===b?e.content="":(e.content=$.slice(j+d.length),e.content[0]==="\r"&&(e.content=e.content.slice(1)),e.content[0]===`
`&&(e.content=e.content.slice(1))),excerpt(e,o),(o.sections===!0||typeof o.section=="function")&&sections(e,o.section),e}matter.engines=engines;matter.stringify=function(e,a,o){return typeof e=="string"&&(e=matter(e,o)),stringify$2(e,a,o)};matter.read=function(e,a){const o=fs.readFileSync(e,"utf8"),c=matter(o,a);return c.path=e,c};matter.test=function(e,a){return utils$1.startsWith(e,defaults(a).delimiters[0])};matter.language=function(e,a){const c=defaults(a).delimiters[0];matter.test(e)&&(e=e.slice(c.length));const d=e.slice(0,e.search(/\r?\n/));return{raw:d,name:d?d.trim():""}};matter.cache={};matter.clearCache=function(){matter.cache={}};var grayMatter=matter;const matter$1=getDefaultExportFromCjs(grayMatter),toTitleCase=e=>e.replace(/[-_]/g," ").replace(/\w\S*/g,a=>a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()),markdownFiles=Object.assign({"../posts/Algebra Chapter 0/A0_1.md":__vite_glob_0_0,"../posts/Algebra Chapter 0/A0_2.md":__vite_glob_0_1,"../posts/Business English/BE_01.md":__vite_glob_0_2,"../posts/Business English/BE_02.md":__vite_glob_0_3,"../posts/Business English/BE_06A.md":__vite_glob_0_4,"../posts/Business English/BE_08.md":__vite_glob_0_5,"../posts/Business English/BE_09.md":__vite_glob_0_6,"../posts/Business English/BE_Cheatsheet.md":__vite_glob_0_7,"../posts/Business Paper/EC_09.md":__vite_glob_0_8,"../posts/Business Paper/EC_1.md":__vite_glob_0_9,"../posts/Business Paper/EC_2.md":__vite_glob_0_10,"../posts/Business Paper/EC_3.md":__vite_glob_0_11,"../posts/Business Paper/EC_4.md":__vite_glob_0_12,"../posts/Business Paper/EC_5.md":__vite_glob_0_13,"../posts/Business Paper/EC_6.md":__vite_glob_0_14,"../posts/Business Paper/EC_7.md":__vite_glob_0_15,"../posts/Business Paper/EC_8.md":__vite_glob_0_16,"../posts/Cure Dolly/CD_1.md":__vite_glob_0_17,"../posts/Cure Dolly/CD_2.md":__vite_glob_0_18,"../posts/Cure Dolly/CD_3.md":__vite_glob_0_19,"../posts/Cure Dolly/CD_4.md":__vite_glob_0_20,"../posts/Cure Dolly/CD_5.md":__vite_glob_0_21,"../posts/Econometrics/EE_01.md":__vite_glob_0_22,"../posts/Econometrics/EE_01SP.md":__vite_glob_0_23,"../posts/Financial Engineer/FE_02.md":__vite_glob_0_24,"../posts/Financial Engineer/FE_02A.md":__vite_glob_0_25,"../posts/Financial Engineer/FE_04.md":__vite_glob_0_26,"../posts/Financial Engineer/FE_05.md":__vite_glob_0_27,"../posts/Financial Engineer/FE_1.md":__vite_glob_0_28,"../posts/Financial Engineer/FE_9.md":__vite_glob_0_29,"../posts/Financial Engineer/FE_Cheatsheet.md":__vite_glob_0_30,"../posts/Game Theory/GT_02.md":__vite_glob_0_31,"../posts/Game Theory/GT_03A.md":__vite_glob_0_32,"../posts/Game Theory/GT_03P.md":__vite_glob_0_33,"../posts/Game Theory/GT_04.md":__vite_glob_0_34,"../posts/Game Theory/GT_04A.md":__vite_glob_0_35,"../posts/Game Theory/GT_04P.md":__vite_glob_0_36,"../posts/Game Theory/GT_05.md":__vite_glob_0_37,"../posts/Game Theory/GT_05A.md":__vite_glob_0_38,"../posts/Game Theory/GT_05P.md":__vite_glob_0_39,"../posts/Game Theory/GT_06A.md":__vite_glob_0_40,"../posts/Game Theory/GT_07A.md":__vite_glob_0_41,"../posts/Game Theory/GT_08A.md":__vite_glob_0_42,"../posts/Game Theory/GT_09A.md":__vite_glob_0_43,"../posts/Game Theory/GT_1.md":__vite_glob_0_44,"../posts/Game Theory/GT_10A.md":__vite_glob_0_45,"../posts/Game Theory/GT_10P.md":__vite_glob_0_46,"../posts/Game Theory/GT_11A.md":__vite_glob_0_47,"../posts/Game Theory/GT_A02.md":__vite_glob_0_48,"../posts/Game Theory/GT_A1.md":__vite_glob_0_49,"../posts/Game Theory/GT_P1.md":__vite_glob_0_50,"../posts/Game Theory/GT_P2.md":__vite_glob_0_51,"../posts/Game Theory/GT_Paper.md":__vite_glob_0_52,"../posts/Misc/MA_1.md":__vite_glob_0_53,"../posts/Misc/MU_01.md":__vite_glob_0_54,"../posts/Misc/SGD_02.md":__vite_glob_0_55,"../posts/Misc/diary.md":__vite_glob_0_56,"../posts/Misc/post1.md":__vite_glob_0_57,"../posts/Misc/temp.md":__vite_glob_0_58,"../posts/Quantum Computattion/QC_1.md":__vite_glob_0_59,"../posts/Quantum Computattion/QC_2.md":__vite_glob_0_60,"../posts/Quantum Computattion/QC_3.md":__vite_glob_0_61,"../posts/Quantum Computattion/QC_4.md":__vite_glob_0_62,"../posts/Science Create Startup/NOTE_SCS_1.md":__vite_glob_0_63,"../posts/Science Create Startup/SCS_01.md":__vite_glob_0_64,"../posts/Science Create Startup/SCS_02.md":__vite_glob_0_65,"../posts/Stochastic Progress/SP_01SP.md":__vite_glob_0_66,"../posts/Stochastic Progress/SP_02.md":__vite_glob_0_67,"../posts/Stochastic Progress/SP_02A.md":__vite_glob_0_68,"../posts/Stochastic Progress/SP_03.md":__vite_glob_0_69,"../posts/Stochastic Progress/SP_03A.md":__vite_glob_0_70,"../posts/Stochastic Progress/SP_04.md":__vite_glob_0_71,"../posts/Stochastic Progress/SP_04A.md":__vite_glob_0_72,"../posts/Stochastic Progress/SP_05.md":__vite_glob_0_73,"../posts/Stochastic Progress/SP_05A.md":__vite_glob_0_74,"../posts/Stochastic Progress/SP_06.md":__vite_glob_0_75,"../posts/Stochastic Progress/SP_06A.md":__vite_glob_0_76,"../posts/Stochastic Progress/SP_07.md":__vite_glob_0_77,"../posts/Stochastic Progress/SP_08.md":__vite_glob_0_78,"../posts/Stochastic Progress/SP_08_Detail.md":__vite_glob_0_79,"../posts/Stochastic Progress/SP_09.md":__vite_glob_0_80,"../posts/Stochastic Progress/SP_1.md":__vite_glob_0_81,"../posts/Stochastic Progress/SP_10.md":__vite_glob_0_82,"../posts/Stochastic Progress/SP_11.md":__vite_glob_0_83,"../posts/Stochastic Progress/SP_12.md":__vite_glob_0_84,"../posts/Stochastic Progress/SP_13.md":__vite_glob_0_85,"../posts/Stochastic Progress/SP_A1.md":__vite_glob_0_86,"../posts/Stochastic Progress/SP_Cheatsheet.md":__vite_glob_0_87,"../posts/Supply Chain Management/SCM_01.md":__vite_glob_0_88,"../posts/Supply Chain Management/SCM_02.md":__vite_glob_0_89,"../posts/Supply Chain Management/SCM_04.md":__vite_glob_0_90,"../posts/Supply Chain Management/SCM_05.md":__vite_glob_0_91,"../posts/Supply Chain Management/SCM_06.md":__vite_glob_0_92,"../posts/Supply Chain Management/SCM_Cheatsheet.md":__vite_glob_0_93}),usePosts=()=>{const[e,a]=reactExports.useState([]),[o,c]=reactExports.useState({});return reactExports.useEffect(()=>{const d=[],$={};let g=1;for(const b in markdownFiles){const _=markdownFiles[b],j=b.match(/\/posts\/(.*)\.md$/);if(j){const _e=j[1],{data:et,content:tt}=matter$1(_);$[_e]=tt,d.push({id:g++,title:et.title||toTitleCase(_e.split("/").pop()||_e),date:et.date||new Date().toISOString().split("T")[0],excerpt:et.excerpt||tt.slice(0,150)+"...",contentKey:_e,author:et.author||"Anonymous",category:et.category||_e.split("/")[0]||"Uncategorized"})}}console.log("Available content keys:",d.map(b=>b.contentKey)),a(d.sort((b,_)=>new Date(_.date).getTime()-new Date(b.date).getTime())),c($)},[]),{posts:e,contents:o}},ITEMS_PER_PAGE=5,Home=()=>{const{posts:e}=usePosts(),a=useLocation(),c=new URLSearchParams(a.search).get("category"),d=Array.from(new Set(e.map(ot=>ot.category))),[$,g]=reactExports.useState(!1),[b,_]=reactExports.useState("");reactExports.useEffect(()=>{const ot=st=>{st.key==="/"&&!$&&(st.preventDefault(),g(!0)),st.key==="Escape"&&$&&g(!1)};return document.addEventListener("keydown",ot),()=>document.removeEventListener("keydown",ot)},[$]),reactExports.useEffect(()=>{_e(1)},[c]);const[j,_e]=reactExports.useState(1),[et,tt]=reactExports.useState(()=>{const ot=localStorage.getItem("sidebarExpanded");return ot?JSON.parse(ot):!1}),nt=c&&c!=="All"?e.filter(ot=>ot.category===c):e,at=Math.ceil(nt.length/ITEMS_PER_PAGE),lt=nt.slice((j-1)*ITEMS_PER_PAGE,j*ITEMS_PER_PAGE),mt=nt.length>0;return jsxRuntimeExports.jsxs("div",{className:"container mx-auto mt-10",children:[jsxRuntimeExports.jsx("h1",{className:`font-bold mb-8 text-center text-sky-100
      text-5xl
      sm:text-5xl
      lg:text-6xl
      `,children:"This is Luna's world"}),jsxRuntimeExports.jsxs("div",{className:"flex row-auto",children:[jsxRuntimeExports.jsx("div",{className:`
          transition-all duration-300 ease-in-out
          ${et?"w-[250px]":"w-10"}
          mr-6
        `,children:jsxRuntimeExports.jsx(Sidebar,{categories:d,isExpanded:et,onExpandedChange:tt},c)}),jsxRuntimeExports.jsx("div",{className:`
          transition-all duration-300 ease-in-out
          flex-1
          ${et?"ml-0":"ml-4"}
        `,children:mt?jsxRuntimeExports.jsx(BlogList,{posts:lt,currentPage:j,totalPages:at,onPageChange:_e}):jsxRuntimeExports.jsx("p",{className:"text-sky-100",children:"No posts found in this category."})})]}),$&&jsxRuntimeExports.jsx(SearchModal,{searchTerm:b,onSearchTermChange:_,onClose:()=>{g(!1),_("")},posts:e})]})},About=()=>jsxRuntimeExports.jsxs("div",{className:"mx-auto w-1/2 mt-10 p-6 bg-sky-100 rounded-lg shadow",children:[jsxRuntimeExports.jsx("h1",{className:"text-3xl font-bold mb-4 text-sky-900",children:"About"}),jsxRuntimeExports.jsx("p",{className:"text-sky-900 leading-7",children:"Love is murderous utopia."})]});function ok$1(){}function unreachable(){}function parse$2(e){const a=[],o=String(e||"");let c=o.indexOf(","),d=0,$=!1;for(;!$;){c===-1&&(c=o.length,$=!0);const g=o.slice(d,c).trim();(g||!$)&&a.push(g),d=c+1,c=o.indexOf(",",d)}return a}function stringify$1(e,a){const o={};return(e[e.length-1]===""?[...e,""]:e).join((o.padRight?" ":"")+","+(o.padLeft===!1?"":" ")).trim()}const nameRe=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,nameReJsx=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,emptyOptions$5={};function name(e,a){return(emptyOptions$5.jsx?nameReJsx:nameRe).test(e)}const re=/[ \t\n\f\r]/g;function whitespace(e){return typeof e=="object"?e.type==="text"?empty$1(e.value):!1:empty$1(e)}function empty$1(e){return e.replace(re,"")===""}class Schema{constructor(a,o,c){this.property=a,this.normal=o,c&&(this.space=c)}}Schema.prototype.property={};Schema.prototype.normal={};Schema.prototype.space=null;function merge(e,a){const o={},c={};let d=-1;for(;++d<e.length;)Object.assign(o,e[d].property),Object.assign(c,e[d].normal);return new Schema(o,c,a)}function normalize$1(e){return e.toLowerCase()}class Info{constructor(a,o){this.property=a,this.attribute=o}}Info.prototype.space=null;Info.prototype.boolean=!1;Info.prototype.booleanish=!1;Info.prototype.overloadedBoolean=!1;Info.prototype.number=!1;Info.prototype.commaSeparated=!1;Info.prototype.spaceSeparated=!1;Info.prototype.commaOrSpaceSeparated=!1;Info.prototype.mustUseProperty=!1;Info.prototype.defined=!1;let powers=0;const boolean=increment(),booleanish=increment(),overloadedBoolean=increment(),number=increment(),spaceSeparated=increment(),commaSeparated=increment(),commaOrSpaceSeparated=increment();function increment(){return 2**++powers}const types=Object.freeze(Object.defineProperty({__proto__:null,boolean,booleanish,commaOrSpaceSeparated,commaSeparated,number,overloadedBoolean,spaceSeparated},Symbol.toStringTag,{value:"Module"})),checks=Object.keys(types);class DefinedInfo extends Info{constructor(a,o,c,d){let $=-1;if(super(a,o),mark(this,"space",d),typeof c=="number")for(;++$<checks.length;){const g=checks[$];mark(this,checks[$],(c&types[g])===types[g])}}}DefinedInfo.prototype.defined=!0;function mark(e,a,o){o&&(e[a]=o)}const own$6={}.hasOwnProperty;function create(e){const a={},o={};let c;for(c in e.properties)if(own$6.call(e.properties,c)){const d=e.properties[c],$=new DefinedInfo(c,e.transform(e.attributes||{},c),d,e.space);e.mustUseProperty&&e.mustUseProperty.includes(c)&&($.mustUseProperty=!0),a[c]=$,o[normalize$1(c)]=c,o[normalize$1($.attribute)]=c}return new Schema(a,o,e.space)}const xlink=create({space:"xlink",transform(e,a){return"xlink:"+a.slice(5).toLowerCase()},properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null}}),xml=create({space:"xml",transform(e,a){return"xml:"+a.slice(3).toLowerCase()},properties:{xmlLang:null,xmlBase:null,xmlSpace:null}});function caseSensitiveTransform(e,a){return a in e?e[a]:a}function caseInsensitiveTransform(e,a){return caseSensitiveTransform(e,a.toLowerCase())}const xmlns=create({space:"xmlns",attributes:{xmlnsxlink:"xmlns:xlink"},transform:caseInsensitiveTransform,properties:{xmlns:null,xmlnsXLink:null}}),aria=create({transform(e,a){return a==="role"?a:"aria-"+a.slice(4).toLowerCase()},properties:{ariaActiveDescendant:null,ariaAtomic:booleanish,ariaAutoComplete:null,ariaBusy:booleanish,ariaChecked:booleanish,ariaColCount:number,ariaColIndex:number,ariaColSpan:number,ariaControls:spaceSeparated,ariaCurrent:null,ariaDescribedBy:spaceSeparated,ariaDetails:null,ariaDisabled:booleanish,ariaDropEffect:spaceSeparated,ariaErrorMessage:null,ariaExpanded:booleanish,ariaFlowTo:spaceSeparated,ariaGrabbed:booleanish,ariaHasPopup:null,ariaHidden:booleanish,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:spaceSeparated,ariaLevel:number,ariaLive:null,ariaModal:booleanish,ariaMultiLine:booleanish,ariaMultiSelectable:booleanish,ariaOrientation:null,ariaOwns:spaceSeparated,ariaPlaceholder:null,ariaPosInSet:number,ariaPressed:booleanish,ariaReadOnly:booleanish,ariaRelevant:null,ariaRequired:booleanish,ariaRoleDescription:spaceSeparated,ariaRowCount:number,ariaRowIndex:number,ariaRowSpan:number,ariaSelected:booleanish,ariaSetSize:number,ariaSort:null,ariaValueMax:number,ariaValueMin:number,ariaValueNow:number,ariaValueText:null,role:null}}),html$2=create({space:"html",attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},transform:caseInsensitiveTransform,mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:commaSeparated,acceptCharset:spaceSeparated,accessKey:spaceSeparated,action:null,allow:null,allowFullScreen:boolean,allowPaymentRequest:boolean,allowUserMedia:boolean,alt:null,as:null,async:boolean,autoCapitalize:null,autoComplete:spaceSeparated,autoFocus:boolean,autoPlay:boolean,blocking:spaceSeparated,capture:null,charSet:null,checked:boolean,cite:null,className:spaceSeparated,cols:number,colSpan:null,content:null,contentEditable:booleanish,controls:boolean,controlsList:spaceSeparated,coords:number|commaSeparated,crossOrigin:null,data:null,dateTime:null,decoding:null,default:boolean,defer:boolean,dir:null,dirName:null,disabled:boolean,download:overloadedBoolean,draggable:booleanish,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:boolean,formTarget:null,headers:spaceSeparated,height:number,hidden:boolean,high:number,href:null,hrefLang:null,htmlFor:spaceSeparated,httpEquiv:spaceSeparated,id:null,imageSizes:null,imageSrcSet:null,inert:boolean,inputMode:null,integrity:null,is:null,isMap:boolean,itemId:null,itemProp:spaceSeparated,itemRef:spaceSeparated,itemScope:boolean,itemType:spaceSeparated,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:boolean,low:number,manifest:null,max:null,maxLength:number,media:null,method:null,min:null,minLength:number,multiple:boolean,muted:boolean,name:null,nonce:null,noModule:boolean,noValidate:boolean,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:boolean,optimum:number,pattern:null,ping:spaceSeparated,placeholder:null,playsInline:boolean,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:boolean,referrerPolicy:null,rel:spaceSeparated,required:boolean,reversed:boolean,rows:number,rowSpan:number,sandbox:spaceSeparated,scope:null,scoped:boolean,seamless:boolean,selected:boolean,shadowRootClonable:boolean,shadowRootDelegatesFocus:boolean,shadowRootMode:null,shape:null,size:number,sizes:null,slot:null,span:number,spellCheck:booleanish,src:null,srcDoc:null,srcLang:null,srcSet:null,start:number,step:null,style:null,tabIndex:number,target:null,title:null,translate:null,type:null,typeMustMatch:boolean,useMap:null,value:booleanish,width:number,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:spaceSeparated,axis:null,background:null,bgColor:null,border:number,borderColor:null,bottomMargin:number,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:boolean,declare:boolean,event:null,face:null,frame:null,frameBorder:null,hSpace:number,leftMargin:number,link:null,longDesc:null,lowSrc:null,marginHeight:number,marginWidth:number,noResize:boolean,noHref:boolean,noShade:boolean,noWrap:boolean,object:null,profile:null,prompt:null,rev:null,rightMargin:number,rules:null,scheme:null,scrolling:booleanish,standby:null,summary:null,text:null,topMargin:number,valueType:null,version:null,vAlign:null,vLink:null,vSpace:number,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:boolean,disableRemotePlayback:boolean,prefix:null,property:null,results:number,security:null,unselectable:null}}),svg$1=create({space:"svg",attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},transform:caseSensitiveTransform,properties:{about:commaOrSpaceSeparated,accentHeight:number,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:number,amplitude:number,arabicForm:null,ascent:number,attributeName:null,attributeType:null,azimuth:number,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:number,by:null,calcMode:null,capHeight:number,className:spaceSeparated,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:number,diffuseConstant:number,direction:null,display:null,dur:null,divisor:number,dominantBaseline:null,download:boolean,dx:null,dy:null,edgeMode:null,editable:null,elevation:number,enableBackground:null,end:null,event:null,exponent:number,externalResourcesRequired:null,fill:null,fillOpacity:number,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:commaSeparated,g2:commaSeparated,glyphName:commaSeparated,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:number,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:number,horizOriginX:number,horizOriginY:number,id:null,ideographic:number,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:number,k:number,k1:number,k2:number,k3:number,k4:number,kernelMatrix:commaOrSpaceSeparated,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:number,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:number,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:number,overlineThickness:number,paintOrder:null,panose1:null,path:null,pathLength:number,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:spaceSeparated,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:number,pointsAtY:number,pointsAtZ:number,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:commaOrSpaceSeparated,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:commaOrSpaceSeparated,rev:commaOrSpaceSeparated,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:commaOrSpaceSeparated,requiredFeatures:commaOrSpaceSeparated,requiredFonts:commaOrSpaceSeparated,requiredFormats:commaOrSpaceSeparated,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:number,specularExponent:number,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:number,strikethroughThickness:number,string:null,stroke:null,strokeDashArray:commaOrSpaceSeparated,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:number,strokeOpacity:number,strokeWidth:null,style:null,surfaceScale:number,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:commaOrSpaceSeparated,tabIndex:number,tableValues:null,target:null,targetX:number,targetY:number,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:commaOrSpaceSeparated,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:number,underlineThickness:number,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:number,values:null,vAlphabetic:number,vMathematical:number,vectorEffect:null,vHanging:number,vIdeographic:number,version:null,vertAdvY:number,vertOriginX:number,vertOriginY:number,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:number,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null}}),valid=/^data[-\w.:]+$/i,dash=/-[a-z]/g,cap$1=/[A-Z]/g;function find(e,a){const o=normalize$1(a);let c=a,d=Info;if(o in e.normal)return e.property[e.normal[o]];if(o.length>4&&o.slice(0,4)==="data"&&valid.test(a)){if(a.charAt(4)==="-"){const $=a.slice(5).replace(dash,camelcase);c="data"+$.charAt(0).toUpperCase()+$.slice(1)}else{const $=a.slice(4);if(!dash.test($)){let g=$.replace(cap$1,kebab);g.charAt(0)!=="-"&&(g="-"+g),a="data"+g}}d=DefinedInfo}return new d(c,a)}function kebab(e){return"-"+e.toLowerCase()}function camelcase(e){return e.charAt(1).toUpperCase()}const hastToReact={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},html$1=merge([xml,xlink,xmlns,aria,html$2],"html"),svg=merge([xml,xlink,xmlns,aria,svg$1],"svg");function parse$1(e){const a=String(e||"").trim();return a?a.split(/[ \t\n\r\f]+/g):[]}function stringify(e){return e.join(" ").trim()}var cjs={},COMMENT_REGEX=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,NEWLINE_REGEX=/\n/g,WHITESPACE_REGEX=/^\s*/,PROPERTY_REGEX=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,COLON_REGEX=/^:\s*/,VALUE_REGEX=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,SEMICOLON_REGEX=/^[;\s]*/,TRIM_REGEX=/^\s+|\s+$/g,NEWLINE=`
`,FORWARD_SLASH="/",ASTERISK="*",EMPTY_STRING="",TYPE_COMMENT="comment",TYPE_DECLARATION="declaration",inlineStyleParser=function(e,a){if(typeof e!="string")throw new TypeError("First argument must be a string");if(!e)return[];a=a||{};var o=1,c=1;function d(at){var lt=at.match(NEWLINE_REGEX);lt&&(o+=lt.length);var mt=at.lastIndexOf(NEWLINE);c=~mt?at.length-mt:c+at.length}function $(){var at={line:o,column:c};return function(lt){return lt.position=new g(at),j(),lt}}function g(at){this.start=at,this.end={line:o,column:c},this.source=a.source}g.prototype.content=e;function b(at){var lt=new Error(a.source+":"+o+":"+c+": "+at);if(lt.reason=at,lt.filename=a.source,lt.line=o,lt.column=c,lt.source=e,!a.silent)throw lt}function _(at){var lt=at.exec(e);if(lt){var mt=lt[0];return d(mt),e=e.slice(mt.length),lt}}function j(){_(WHITESPACE_REGEX)}function _e(at){var lt;for(at=at||[];lt=et();)lt!==!1&&at.push(lt);return at}function et(){var at=$();if(!(FORWARD_SLASH!=e.charAt(0)||ASTERISK!=e.charAt(1))){for(var lt=2;EMPTY_STRING!=e.charAt(lt)&&(ASTERISK!=e.charAt(lt)||FORWARD_SLASH!=e.charAt(lt+1));)++lt;if(lt+=2,EMPTY_STRING===e.charAt(lt-1))return b("End of comment missing");var mt=e.slice(2,lt-2);return c+=2,d(mt),e=e.slice(lt),c+=2,at({type:TYPE_COMMENT,comment:mt})}}function tt(){var at=$(),lt=_(PROPERTY_REGEX);if(lt){if(et(),!_(COLON_REGEX))return b("property missing ':'");var mt=_(VALUE_REGEX),ot=at({type:TYPE_DECLARATION,property:trim(lt[0].replace(COMMENT_REGEX,EMPTY_STRING)),value:mt?trim(mt[0].replace(COMMENT_REGEX,EMPTY_STRING)):EMPTY_STRING});return _(SEMICOLON_REGEX),ot}}function nt(){var at=[];_e(at);for(var lt;lt=tt();)lt!==!1&&(at.push(lt),_e(at));return at}return j(),nt()};function trim(e){return e?e.replace(TRIM_REGEX,EMPTY_STRING):EMPTY_STRING}var __importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(cjs,"__esModule",{value:!0});var _default=cjs.default=StyleToObject,inline_style_parser_1=__importDefault(inlineStyleParser);function StyleToObject(e,a){var o=null;if(!e||typeof e!="string")return o;var c=(0,inline_style_parser_1.default)(e),d=typeof a=="function";return c.forEach(function($){if($.type==="declaration"){var g=$.property,b=$.value;d?a(g,b,$):b&&(o=o||{},o[g]=b)}}),o}const styleToObject=_default.default||_default,pointEnd=point$2("end"),pointStart=point$2("start");function point$2(e){return a;function a(o){const c=o&&o.position&&o.position[e]||{};if(typeof c.line=="number"&&c.line>0&&typeof c.column=="number"&&c.column>0)return{line:c.line,column:c.column,offset:typeof c.offset=="number"&&c.offset>-1?c.offset:void 0}}}function position$1(e){const a=pointStart(e),o=pointEnd(e);if(a&&o)return{start:a,end:o}}function stringifyPosition(e){return!e||typeof e!="object"?"":"position"in e||"type"in e?position(e.position):"start"in e||"end"in e?position(e):"line"in e||"column"in e?point$1(e):""}function point$1(e){return index(e&&e.line)+":"+index(e&&e.column)}function position(e){return point$1(e&&e.start)+"-"+point$1(e&&e.end)}function index(e){return e&&typeof e=="number"?e:1}class VFileMessage extends Error{constructor(a,o,c){super(),typeof o=="string"&&(c=o,o=void 0);let d="",$={},g=!1;if(o&&("line"in o&&"column"in o?$={place:o}:"start"in o&&"end"in o?$={place:o}:"type"in o?$={ancestors:[o],place:o.position}:$={...o}),typeof a=="string"?d=a:!$.cause&&a&&(g=!0,d=a.message,$.cause=a),!$.ruleId&&!$.source&&typeof c=="string"){const _=c.indexOf(":");_===-1?$.ruleId=c:($.source=c.slice(0,_),$.ruleId=c.slice(_+1))}if(!$.place&&$.ancestors&&$.ancestors){const _=$.ancestors[$.ancestors.length-1];_&&($.place=_.position)}const b=$.place&&"start"in $.place?$.place.start:$.place;this.ancestors=$.ancestors||void 0,this.cause=$.cause||void 0,this.column=b?b.column:void 0,this.fatal=void 0,this.file,this.message=d,this.line=b?b.line:void 0,this.name=stringifyPosition($.place)||"1:1",this.place=$.place||void 0,this.reason=this.message,this.ruleId=$.ruleId||void 0,this.source=$.source||void 0,this.stack=g&&$.cause&&typeof $.cause.stack=="string"?$.cause.stack:"",this.actual,this.expected,this.note,this.url}}VFileMessage.prototype.file="";VFileMessage.prototype.name="";VFileMessage.prototype.reason="";VFileMessage.prototype.message="";VFileMessage.prototype.stack="";VFileMessage.prototype.column=void 0;VFileMessage.prototype.line=void 0;VFileMessage.prototype.ancestors=void 0;VFileMessage.prototype.cause=void 0;VFileMessage.prototype.fatal=void 0;VFileMessage.prototype.place=void 0;VFileMessage.prototype.ruleId=void 0;VFileMessage.prototype.source=void 0;const own$5={}.hasOwnProperty,emptyMap=new Map,cap=/[A-Z]/g,dashSomething=/-([a-z])/g,tableElements=new Set(["table","tbody","thead","tfoot","tr"]),tableCellElement=new Set(["td","th"]),docs="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function toJsxRuntime(e,a){if(!a||a.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const o=a.filePath||void 0;let c;if(a.development){if(typeof a.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");c=developmentCreate(o,a.jsxDEV)}else{if(typeof a.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof a.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");c=productionCreate(o,a.jsx,a.jsxs)}const d={Fragment:a.Fragment,ancestors:[],components:a.components||{},create:c,elementAttributeNameCase:a.elementAttributeNameCase||"react",evaluater:a.createEvaluater?a.createEvaluater():void 0,filePath:o,ignoreInvalidStyle:a.ignoreInvalidStyle||!1,passKeys:a.passKeys!==!1,passNode:a.passNode||!1,schema:a.space==="svg"?svg:html$1,stylePropertyNameCase:a.stylePropertyNameCase||"dom",tableCellAlignToStyle:a.tableCellAlignToStyle!==!1},$=one$3(d,e,void 0);return $&&typeof $!="string"?$:d.create(e,d.Fragment,{children:$||void 0},void 0)}function one$3(e,a,o){if(a.type==="element")return element$3(e,a,o);if(a.type==="mdxFlowExpression"||a.type==="mdxTextExpression")return mdxExpression(e,a);if(a.type==="mdxJsxFlowElement"||a.type==="mdxJsxTextElement")return mdxJsxElement(e,a,o);if(a.type==="mdxjsEsm")return mdxEsm(e,a);if(a.type==="root")return root$2(e,a,o);if(a.type==="text")return text$6(e,a)}function element$3(e,a,o){const c=e.schema;let d=c;a.tagName.toLowerCase()==="svg"&&c.space==="html"&&(d=svg,e.schema=d),e.ancestors.push(a);const $=findComponentFromName(e,a.tagName,!1),g=createElementProps(e,a);let b=createChildren(e,a);return tableElements.has(a.tagName)&&(b=b.filter(function(_){return typeof _=="string"?!whitespace(_):!0})),addNode(e,g,$,a),addChildren(g,b),e.ancestors.pop(),e.schema=c,e.create(a,$,g,o)}function mdxExpression(e,a){if(a.data&&a.data.estree&&e.evaluater){const c=a.data.estree.body[0];return c.type,e.evaluater.evaluateExpression(c.expression)}crashEstree(e,a.position)}function mdxEsm(e,a){if(a.data&&a.data.estree&&e.evaluater)return e.evaluater.evaluateProgram(a.data.estree);crashEstree(e,a.position)}function mdxJsxElement(e,a,o){const c=e.schema;let d=c;a.name==="svg"&&c.space==="html"&&(d=svg,e.schema=d),e.ancestors.push(a);const $=a.name===null?e.Fragment:findComponentFromName(e,a.name,!0),g=createJsxElementProps(e,a),b=createChildren(e,a);return addNode(e,g,$,a),addChildren(g,b),e.ancestors.pop(),e.schema=c,e.create(a,$,g,o)}function root$2(e,a,o){const c={};return addChildren(c,createChildren(e,a)),e.create(a,e.Fragment,c,o)}function text$6(e,a){return a.value}function addNode(e,a,o,c){typeof o!="string"&&o!==e.Fragment&&e.passNode&&(a.node=c)}function addChildren(e,a){if(a.length>0){const o=a.length>1?a:a[0];o&&(e.children=o)}}function productionCreate(e,a,o){return c;function c(d,$,g,b){const j=Array.isArray(g.children)?o:a;return b?j($,g,b):j($,g)}}function developmentCreate(e,a){return o;function o(c,d,$,g){const b=Array.isArray($.children),_=pointStart(c);return a(d,$,g,b,{columnNumber:_?_.column-1:void 0,fileName:e,lineNumber:_?_.line:void 0},void 0)}}function createElementProps(e,a){const o={};let c,d;for(d in a.properties)if(d!=="children"&&own$5.call(a.properties,d)){const $=createProperty(e,d,a.properties[d]);if($){const[g,b]=$;e.tableCellAlignToStyle&&g==="align"&&typeof b=="string"&&tableCellElement.has(a.tagName)?c=b:o[g]=b}}if(c){const $=o.style||(o.style={});$[e.stylePropertyNameCase==="css"?"text-align":"textAlign"]=c}return o}function createJsxElementProps(e,a){const o={};for(const c of a.attributes)if(c.type==="mdxJsxExpressionAttribute")if(c.data&&c.data.estree&&e.evaluater){const $=c.data.estree.body[0];$.type;const g=$.expression;g.type;const b=g.properties[0];b.type,Object.assign(o,e.evaluater.evaluateExpression(b.argument))}else crashEstree(e,a.position);else{const d=c.name;let $;if(c.value&&typeof c.value=="object")if(c.value.data&&c.value.data.estree&&e.evaluater){const b=c.value.data.estree.body[0];b.type,$=e.evaluater.evaluateExpression(b.expression)}else crashEstree(e,a.position);else $=c.value===null?!0:c.value;o[d]=$}return o}function createChildren(e,a){const o=[];let c=-1;const d=e.passKeys?new Map:emptyMap;for(;++c<a.children.length;){const $=a.children[c];let g;if(e.passKeys){const _=$.type==="element"?$.tagName:$.type==="mdxJsxFlowElement"||$.type==="mdxJsxTextElement"?$.name:void 0;if(_){const j=d.get(_)||0;g=_+"-"+j,d.set(_,j+1)}}const b=one$3(e,$,g);b!==void 0&&o.push(b)}return o}function createProperty(e,a,o){const c=find(e.schema,a);if(!(o==null||typeof o=="number"&&Number.isNaN(o))){if(Array.isArray(o)&&(o=c.commaSeparated?stringify$1(o):stringify(o)),c.property==="style"){let d=typeof o=="object"?o:parseStyle(e,String(o));return e.stylePropertyNameCase==="css"&&(d=transformStylesToCssCasing(d)),["style",d]}return[e.elementAttributeNameCase==="react"&&c.space?hastToReact[c.property]||c.property:c.attribute,o]}}function parseStyle(e,a){const o={};try{styleToObject(a,c)}catch(d){if(!e.ignoreInvalidStyle){const $=d,g=new VFileMessage("Cannot parse `style` attribute",{ancestors:e.ancestors,cause:$,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw g.file=e.filePath||void 0,g.url=docs+"#cannot-parse-style-attribute",g}}return o;function c(d,$){let g=d;g.slice(0,2)!=="--"&&(g.slice(0,4)==="-ms-"&&(g="ms-"+g.slice(4)),g=g.replace(dashSomething,toCamel)),o[g]=$}}function findComponentFromName(e,a,o){let c;if(!o)c={type:"Literal",value:a};else if(a.includes(".")){const d=a.split(".");let $=-1,g;for(;++$<d.length;){const b=name(d[$])?{type:"Identifier",name:d[$]}:{type:"Literal",value:d[$]};g=g?{type:"MemberExpression",object:g,property:b,computed:!!($&&b.type==="Literal"),optional:!1}:b}c=g}else c=name(a)&&!/^[a-z]/.test(a)?{type:"Identifier",name:a}:{type:"Literal",value:a};if(c.type==="Literal"){const d=c.value;return own$5.call(e.components,d)?e.components[d]:d}if(e.evaluater)return e.evaluater.evaluateExpression(c);crashEstree(e)}function crashEstree(e,a){const o=new VFileMessage("Cannot handle MDX estrees without `createEvaluater`",{ancestors:e.ancestors,place:a,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw o.file=e.filePath||void 0,o.url=docs+"#cannot-handle-mdx-estrees-without-createevaluater",o}function transformStylesToCssCasing(e){const a={};let o;for(o in e)own$5.call(e,o)&&(a[transformStyleToCssCasing(o)]=e[o]);return a}function transformStyleToCssCasing(e){let a=e.replace(cap,toDash);return a.slice(0,3)==="ms-"&&(a="-"+a),a}function toCamel(e,a){return a.toUpperCase()}function toDash(e){return"-"+e.toLowerCase()}const urlAttributes={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},emptyOptions$4={};function toString$2(e,a){const o=emptyOptions$4,c=typeof o.includeImageAlt=="boolean"?o.includeImageAlt:!0,d=typeof o.includeHtml=="boolean"?o.includeHtml:!0;return one$2(e,c,d)}function one$2(e,a,o){if(node(e)){if("value"in e)return e.type==="html"&&!o?"":e.value;if(a&&"alt"in e&&e.alt)return e.alt;if("children"in e)return all$2(e.children,a,o)}return Array.isArray(e)?all$2(e,a,o):""}function all$2(e,a,o){const c=[];let d=-1;for(;++d<e.length;)c[d]=one$2(e[d],a,o);return c.join("")}function node(e){return!!(e&&typeof e=="object")}const element$2=document.createElement("i");function decodeNamedCharacterReference(e){const a="&"+e+";";element$2.innerHTML=a;const o=element$2.textContent;return o.charCodeAt(o.length-1)===59&&e!=="semi"||o===a?!1:o}function splice(e,a,o,c){const d=e.length;let $=0,g;if(a<0?a=-a>d?0:d+a:a=a>d?d:a,o=o>0?o:0,c.length<1e4)g=Array.from(c),g.unshift(a,o),e.splice(...g);else for(o&&e.splice(a,o);$<c.length;)g=c.slice($,$+1e4),g.unshift(a,0),e.splice(...g),$+=1e4,a+=1e4}function push(e,a){return e.length>0?(splice(e,e.length,0,a),e):a}const hasOwnProperty={}.hasOwnProperty;function combineExtensions(e){const a={};let o=-1;for(;++o<e.length;)syntaxExtension(a,e[o]);return a}function syntaxExtension(e,a){let o;for(o in a){const d=(hasOwnProperty.call(e,o)?e[o]:void 0)||(e[o]={}),$=a[o];let g;if($)for(g in $){hasOwnProperty.call(d,g)||(d[g]=[]);const b=$[g];constructs(d[g],Array.isArray(b)?b:b?[b]:[])}}}function constructs(e,a){let o=-1;const c=[];for(;++o<a.length;)(a[o].add==="after"?e:c).push(a[o]);splice(e,0,0,c)}function decodeNumericCharacterReference(e,a){const o=Number.parseInt(e,a);return o<9||o===11||o>13&&o<32||o>126&&o<160||o>55295&&o<57344||o>64975&&o<65008||(o&65535)===65535||(o&65535)===65534||o>1114111?"�":String.fromCodePoint(o)}function normalizeIdentifier(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const asciiAlpha=regexCheck(/[A-Za-z]/),asciiAlphanumeric=regexCheck(/[\dA-Za-z]/),asciiAtext=regexCheck(/[#-'*+\--9=?A-Z^-~]/);function asciiControl(e){return e!==null&&(e<32||e===127)}const asciiDigit=regexCheck(/\d/),asciiHexDigit=regexCheck(/[\dA-Fa-f]/),asciiPunctuation=regexCheck(/[!-/:-@[-`{-~]/);function markdownLineEnding(e){return e!==null&&e<-2}function markdownLineEndingOrSpace(e){return e!==null&&(e<0||e===32)}function markdownSpace(e){return e===-2||e===-1||e===32}const unicodePunctuation=regexCheck(new RegExp("\\p{P}|\\p{S}","u")),unicodeWhitespace=regexCheck(/\s/);function regexCheck(e){return a;function a(o){return o!==null&&o>-1&&e.test(String.fromCharCode(o))}}function normalizeUri(e){const a=[];let o=-1,c=0,d=0;for(;++o<e.length;){const $=e.charCodeAt(o);let g="";if($===37&&asciiAlphanumeric(e.charCodeAt(o+1))&&asciiAlphanumeric(e.charCodeAt(o+2)))d=2;else if($<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode($))||(g=String.fromCharCode($));else if($>55295&&$<57344){const b=e.charCodeAt(o+1);$<56320&&b>56319&&b<57344?(g=String.fromCharCode($,b),d=1):g="�"}else g=String.fromCharCode($);g&&(a.push(e.slice(c,o),encodeURIComponent(g)),c=o+d+1,g=""),d&&(o+=d,d=0)}return a.join("")+e.slice(c)}function factorySpace(e,a,o,c){const d=c?c-1:Number.POSITIVE_INFINITY;let $=0;return g;function g(_){return markdownSpace(_)?(e.enter(o),b(_)):a(_)}function b(_){return markdownSpace(_)&&$++<d?(e.consume(_),b):(e.exit(o),a(_))}}const content$1={tokenize:initializeContent};function initializeContent(e){const a=e.attempt(this.parser.constructs.contentInitial,c,d);let o;return a;function c(b){if(b===null){e.consume(b);return}return e.enter("lineEnding"),e.consume(b),e.exit("lineEnding"),factorySpace(e,a,"linePrefix")}function d(b){return e.enter("paragraph"),$(b)}function $(b){const _=e.enter("chunkText",{contentType:"text",previous:o});return o&&(o.next=_),o=_,g(b)}function g(b){if(b===null){e.exit("chunkText"),e.exit("paragraph"),e.consume(b);return}return markdownLineEnding(b)?(e.consume(b),e.exit("chunkText"),$):(e.consume(b),g)}}const document$2={tokenize:initializeDocument},containerConstruct={tokenize:tokenizeContainer};function initializeDocument(e){const a=this,o=[];let c=0,d,$,g;return b;function b(ut){if(c<o.length){const pt=o[c];return a.containerState=pt[1],e.attempt(pt[0].continuation,_,j)(ut)}return j(ut)}function _(ut){if(c++,a.containerState._closeFlow){a.containerState._closeFlow=void 0,d&&st();const pt=a.events.length;let gt=pt,ft;for(;gt--;)if(a.events[gt][0]==="exit"&&a.events[gt][1].type==="chunkFlow"){ft=a.events[gt][1].end;break}ot(c);let yt=pt;for(;yt<a.events.length;)a.events[yt][1].end={...ft},yt++;return splice(a.events,gt+1,0,a.events.slice(pt)),a.events.length=yt,j(ut)}return b(ut)}function j(ut){if(c===o.length){if(!d)return tt(ut);if(d.currentConstruct&&d.currentConstruct.concrete)return at(ut);a.interrupt=!!(d.currentConstruct&&!d._gfmTableDynamicInterruptHack)}return a.containerState={},e.check(containerConstruct,_e,et)(ut)}function _e(ut){return d&&st(),ot(c),tt(ut)}function et(ut){return a.parser.lazy[a.now().line]=c!==o.length,g=a.now().offset,at(ut)}function tt(ut){return a.containerState={},e.attempt(containerConstruct,nt,at)(ut)}function nt(ut){return c++,o.push([a.currentConstruct,a.containerState]),tt(ut)}function at(ut){if(ut===null){d&&st(),ot(0),e.consume(ut);return}return d=d||a.parser.flow(a.now()),e.enter("chunkFlow",{_tokenizer:d,contentType:"flow",previous:$}),lt(ut)}function lt(ut){if(ut===null){mt(e.exit("chunkFlow"),!0),ot(0),e.consume(ut);return}return markdownLineEnding(ut)?(e.consume(ut),mt(e.exit("chunkFlow")),c=0,a.interrupt=void 0,b):(e.consume(ut),lt)}function mt(ut,pt){const gt=a.sliceStream(ut);if(pt&&gt.push(null),ut.previous=$,$&&($.next=ut),$=ut,d.defineSkip(ut.start),d.write(gt),a.parser.lazy[ut.start.line]){let ft=d.events.length;for(;ft--;)if(d.events[ft][1].start.offset<g&&(!d.events[ft][1].end||d.events[ft][1].end.offset>g))return;const yt=a.events.length;let _t=yt,vt,Pt;for(;_t--;)if(a.events[_t][0]==="exit"&&a.events[_t][1].type==="chunkFlow"){if(vt){Pt=a.events[_t][1].end;break}vt=!0}for(ot(c),ft=yt;ft<a.events.length;)a.events[ft][1].end={...Pt},ft++;splice(a.events,_t+1,0,a.events.slice(yt)),a.events.length=ft}}function ot(ut){let pt=o.length;for(;pt-- >ut;){const gt=o[pt];a.containerState=gt[1],gt[0].exit.call(a,e)}o.length=ut}function st(){d.write([null]),$=void 0,d=void 0,a.containerState._closeFlow=void 0}}function tokenizeContainer(e,a,o){return factorySpace(e,e.attempt(this.parser.constructs.document,a,o),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function classifyCharacter(e){if(e===null||markdownLineEndingOrSpace(e)||unicodeWhitespace(e))return 1;if(unicodePunctuation(e))return 2}function resolveAll(e,a,o){const c=[];let d=-1;for(;++d<e.length;){const $=e[d].resolveAll;$&&!c.includes($)&&(a=$(a,o),c.push($))}return a}const attention={name:"attention",resolveAll:resolveAllAttention,tokenize:tokenizeAttention};function resolveAllAttention(e,a){let o=-1,c,d,$,g,b,_,j,_e;for(;++o<e.length;)if(e[o][0]==="enter"&&e[o][1].type==="attentionSequence"&&e[o][1]._close){for(c=o;c--;)if(e[c][0]==="exit"&&e[c][1].type==="attentionSequence"&&e[c][1]._open&&a.sliceSerialize(e[c][1]).charCodeAt(0)===a.sliceSerialize(e[o][1]).charCodeAt(0)){if((e[c][1]._close||e[o][1]._open)&&(e[o][1].end.offset-e[o][1].start.offset)%3&&!((e[c][1].end.offset-e[c][1].start.offset+e[o][1].end.offset-e[o][1].start.offset)%3))continue;_=e[c][1].end.offset-e[c][1].start.offset>1&&e[o][1].end.offset-e[o][1].start.offset>1?2:1;const et={...e[c][1].end},tt={...e[o][1].start};movePoint(et,-_),movePoint(tt,_),g={type:_>1?"strongSequence":"emphasisSequence",start:et,end:{...e[c][1].end}},b={type:_>1?"strongSequence":"emphasisSequence",start:{...e[o][1].start},end:tt},$={type:_>1?"strongText":"emphasisText",start:{...e[c][1].end},end:{...e[o][1].start}},d={type:_>1?"strong":"emphasis",start:{...g.start},end:{...b.end}},e[c][1].end={...g.start},e[o][1].start={...b.end},j=[],e[c][1].end.offset-e[c][1].start.offset&&(j=push(j,[["enter",e[c][1],a],["exit",e[c][1],a]])),j=push(j,[["enter",d,a],["enter",g,a],["exit",g,a],["enter",$,a]]),j=push(j,resolveAll(a.parser.constructs.insideSpan.null,e.slice(c+1,o),a)),j=push(j,[["exit",$,a],["enter",b,a],["exit",b,a],["exit",d,a]]),e[o][1].end.offset-e[o][1].start.offset?(_e=2,j=push(j,[["enter",e[o][1],a],["exit",e[o][1],a]])):_e=0,splice(e,c-1,o-c+3,j),o=c+j.length-_e-2;break}}for(o=-1;++o<e.length;)e[o][1].type==="attentionSequence"&&(e[o][1].type="data");return e}function tokenizeAttention(e,a){const o=this.parser.constructs.attentionMarkers.null,c=this.previous,d=classifyCharacter(c);let $;return g;function g(_){return $=_,e.enter("attentionSequence"),b(_)}function b(_){if(_===$)return e.consume(_),b;const j=e.exit("attentionSequence"),_e=classifyCharacter(_),et=!_e||_e===2&&d||o.includes(_),tt=!d||d===2&&_e||o.includes(c);return j._open=!!($===42?et:et&&(d||!tt)),j._close=!!($===42?tt:tt&&(_e||!et)),a(_)}}function movePoint(e,a){e.column+=a,e.offset+=a,e._bufferIndex+=a}const autolink={name:"autolink",tokenize:tokenizeAutolink};function tokenizeAutolink(e,a,o){let c=0;return d;function d(nt){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(nt),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),$}function $(nt){return asciiAlpha(nt)?(e.consume(nt),g):nt===64?o(nt):j(nt)}function g(nt){return nt===43||nt===45||nt===46||asciiAlphanumeric(nt)?(c=1,b(nt)):j(nt)}function b(nt){return nt===58?(e.consume(nt),c=0,_):(nt===43||nt===45||nt===46||asciiAlphanumeric(nt))&&c++<32?(e.consume(nt),b):(c=0,j(nt))}function _(nt){return nt===62?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(nt),e.exit("autolinkMarker"),e.exit("autolink"),a):nt===null||nt===32||nt===60||asciiControl(nt)?o(nt):(e.consume(nt),_)}function j(nt){return nt===64?(e.consume(nt),_e):asciiAtext(nt)?(e.consume(nt),j):o(nt)}function _e(nt){return asciiAlphanumeric(nt)?et(nt):o(nt)}function et(nt){return nt===46?(e.consume(nt),c=0,_e):nt===62?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(nt),e.exit("autolinkMarker"),e.exit("autolink"),a):tt(nt)}function tt(nt){if((nt===45||asciiAlphanumeric(nt))&&c++<63){const at=nt===45?tt:et;return e.consume(nt),at}return o(nt)}}const blankLine={partial:!0,tokenize:tokenizeBlankLine};function tokenizeBlankLine(e,a,o){return c;function c($){return markdownSpace($)?factorySpace(e,d,"linePrefix")($):d($)}function d($){return $===null||markdownLineEnding($)?a($):o($)}}const blockQuote={continuation:{tokenize:tokenizeBlockQuoteContinuation},exit,name:"blockQuote",tokenize:tokenizeBlockQuoteStart};function tokenizeBlockQuoteStart(e,a,o){const c=this;return d;function d(g){if(g===62){const b=c.containerState;return b.open||(e.enter("blockQuote",{_container:!0}),b.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(g),e.exit("blockQuoteMarker"),$}return o(g)}function $(g){return markdownSpace(g)?(e.enter("blockQuotePrefixWhitespace"),e.consume(g),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),a):(e.exit("blockQuotePrefix"),a(g))}}function tokenizeBlockQuoteContinuation(e,a,o){const c=this;return d;function d(g){return markdownSpace(g)?factorySpace(e,$,"linePrefix",c.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(g):$(g)}function $(g){return e.attempt(blockQuote,a,o)(g)}}function exit(e){e.exit("blockQuote")}const characterEscape={name:"characterEscape",tokenize:tokenizeCharacterEscape};function tokenizeCharacterEscape(e,a,o){return c;function c($){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume($),e.exit("escapeMarker"),d}function d($){return asciiPunctuation($)?(e.enter("characterEscapeValue"),e.consume($),e.exit("characterEscapeValue"),e.exit("characterEscape"),a):o($)}}const characterReference={name:"characterReference",tokenize:tokenizeCharacterReference};function tokenizeCharacterReference(e,a,o){const c=this;let d=0,$,g;return b;function b(et){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(et),e.exit("characterReferenceMarker"),_}function _(et){return et===35?(e.enter("characterReferenceMarkerNumeric"),e.consume(et),e.exit("characterReferenceMarkerNumeric"),j):(e.enter("characterReferenceValue"),$=31,g=asciiAlphanumeric,_e(et))}function j(et){return et===88||et===120?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(et),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),$=6,g=asciiHexDigit,_e):(e.enter("characterReferenceValue"),$=7,g=asciiDigit,_e(et))}function _e(et){if(et===59&&d){const tt=e.exit("characterReferenceValue");return g===asciiAlphanumeric&&!decodeNamedCharacterReference(c.sliceSerialize(tt))?o(et):(e.enter("characterReferenceMarker"),e.consume(et),e.exit("characterReferenceMarker"),e.exit("characterReference"),a)}return g(et)&&d++<$?(e.consume(et),_e):o(et)}}const nonLazyContinuation$1={partial:!0,tokenize:tokenizeNonLazyContinuation$1},codeFenced={concrete:!0,name:"codeFenced",tokenize:tokenizeCodeFenced};function tokenizeCodeFenced(e,a,o){const c=this,d={partial:!0,tokenize:gt};let $=0,g=0,b;return _;function _(ft){return j(ft)}function j(ft){const yt=c.events[c.events.length-1];return $=yt&&yt[1].type==="linePrefix"?yt[2].sliceSerialize(yt[1],!0).length:0,b=ft,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),_e(ft)}function _e(ft){return ft===b?(g++,e.consume(ft),_e):g<3?o(ft):(e.exit("codeFencedFenceSequence"),markdownSpace(ft)?factorySpace(e,et,"whitespace")(ft):et(ft))}function et(ft){return ft===null||markdownLineEnding(ft)?(e.exit("codeFencedFence"),c.interrupt?a(ft):e.check(nonLazyContinuation$1,lt,pt)(ft)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),tt(ft))}function tt(ft){return ft===null||markdownLineEnding(ft)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),et(ft)):markdownSpace(ft)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),factorySpace(e,nt,"whitespace")(ft)):ft===96&&ft===b?o(ft):(e.consume(ft),tt)}function nt(ft){return ft===null||markdownLineEnding(ft)?et(ft):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),at(ft))}function at(ft){return ft===null||markdownLineEnding(ft)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),et(ft)):ft===96&&ft===b?o(ft):(e.consume(ft),at)}function lt(ft){return e.attempt(d,pt,mt)(ft)}function mt(ft){return e.enter("lineEnding"),e.consume(ft),e.exit("lineEnding"),ot}function ot(ft){return $>0&&markdownSpace(ft)?factorySpace(e,st,"linePrefix",$+1)(ft):st(ft)}function st(ft){return ft===null||markdownLineEnding(ft)?e.check(nonLazyContinuation$1,lt,pt)(ft):(e.enter("codeFlowValue"),ut(ft))}function ut(ft){return ft===null||markdownLineEnding(ft)?(e.exit("codeFlowValue"),st(ft)):(e.consume(ft),ut)}function pt(ft){return e.exit("codeFenced"),a(ft)}function gt(ft,yt,_t){let vt=0;return Pt;function Pt(Dt){return ft.enter("lineEnding"),ft.consume(Dt),ft.exit("lineEnding"),Tt}function Tt(Dt){return ft.enter("codeFencedFence"),markdownSpace(Dt)?factorySpace(ft,St,"linePrefix",c.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(Dt):St(Dt)}function St(Dt){return Dt===b?(ft.enter("codeFencedFenceSequence"),qt(Dt)):_t(Dt)}function qt(Dt){return Dt===b?(vt++,ft.consume(Dt),qt):vt>=g?(ft.exit("codeFencedFenceSequence"),markdownSpace(Dt)?factorySpace(ft,Ft,"whitespace")(Dt):Ft(Dt)):_t(Dt)}function Ft(Dt){return Dt===null||markdownLineEnding(Dt)?(ft.exit("codeFencedFence"),yt(Dt)):_t(Dt)}}}function tokenizeNonLazyContinuation$1(e,a,o){const c=this;return d;function d(g){return g===null?o(g):(e.enter("lineEnding"),e.consume(g),e.exit("lineEnding"),$)}function $(g){return c.parser.lazy[c.now().line]?o(g):a(g)}}const codeIndented={name:"codeIndented",tokenize:tokenizeCodeIndented},furtherStart={partial:!0,tokenize:tokenizeFurtherStart};function tokenizeCodeIndented(e,a,o){const c=this;return d;function d(j){return e.enter("codeIndented"),factorySpace(e,$,"linePrefix",5)(j)}function $(j){const _e=c.events[c.events.length-1];return _e&&_e[1].type==="linePrefix"&&_e[2].sliceSerialize(_e[1],!0).length>=4?g(j):o(j)}function g(j){return j===null?_(j):markdownLineEnding(j)?e.attempt(furtherStart,g,_)(j):(e.enter("codeFlowValue"),b(j))}function b(j){return j===null||markdownLineEnding(j)?(e.exit("codeFlowValue"),g(j)):(e.consume(j),b)}function _(j){return e.exit("codeIndented"),a(j)}}function tokenizeFurtherStart(e,a,o){const c=this;return d;function d(g){return c.parser.lazy[c.now().line]?o(g):markdownLineEnding(g)?(e.enter("lineEnding"),e.consume(g),e.exit("lineEnding"),d):factorySpace(e,$,"linePrefix",5)(g)}function $(g){const b=c.events[c.events.length-1];return b&&b[1].type==="linePrefix"&&b[2].sliceSerialize(b[1],!0).length>=4?a(g):markdownLineEnding(g)?d(g):o(g)}}const codeText={name:"codeText",previous:previous$1,resolve:resolveCodeText,tokenize:tokenizeCodeText};function resolveCodeText(e){let a=e.length-4,o=3,c,d;if((e[o][1].type==="lineEnding"||e[o][1].type==="space")&&(e[a][1].type==="lineEnding"||e[a][1].type==="space")){for(c=o;++c<a;)if(e[c][1].type==="codeTextData"){e[o][1].type="codeTextPadding",e[a][1].type="codeTextPadding",o+=2,a-=2;break}}for(c=o-1,a++;++c<=a;)d===void 0?c!==a&&e[c][1].type!=="lineEnding"&&(d=c):(c===a||e[c][1].type==="lineEnding")&&(e[d][1].type="codeTextData",c!==d+2&&(e[d][1].end=e[c-1][1].end,e.splice(d+2,c-d-2),a-=c-d-2,c=d+2),d=void 0);return e}function previous$1(e){return e!==96||this.events[this.events.length-1][1].type==="characterEscape"}function tokenizeCodeText(e,a,o){let c=0,d,$;return g;function g(et){return e.enter("codeText"),e.enter("codeTextSequence"),b(et)}function b(et){return et===96?(e.consume(et),c++,b):(e.exit("codeTextSequence"),_(et))}function _(et){return et===null?o(et):et===32?(e.enter("space"),e.consume(et),e.exit("space"),_):et===96?($=e.enter("codeTextSequence"),d=0,_e(et)):markdownLineEnding(et)?(e.enter("lineEnding"),e.consume(et),e.exit("lineEnding"),_):(e.enter("codeTextData"),j(et))}function j(et){return et===null||et===32||et===96||markdownLineEnding(et)?(e.exit("codeTextData"),_(et)):(e.consume(et),j)}function _e(et){return et===96?(e.consume(et),d++,_e):d===c?(e.exit("codeTextSequence"),e.exit("codeText"),a(et)):($.type="codeTextData",j(et))}}class SpliceBuffer{constructor(a){this.left=a?[...a]:[],this.right=[]}get(a){if(a<0||a>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+a+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return a<this.left.length?this.left[a]:this.right[this.right.length-a+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(a,o){const c=o??Number.POSITIVE_INFINITY;return c<this.left.length?this.left.slice(a,c):a>this.left.length?this.right.slice(this.right.length-c+this.left.length,this.right.length-a+this.left.length).reverse():this.left.slice(a).concat(this.right.slice(this.right.length-c+this.left.length).reverse())}splice(a,o,c){const d=o||0;this.setCursor(Math.trunc(a));const $=this.right.splice(this.right.length-d,Number.POSITIVE_INFINITY);return c&&chunkedPush(this.left,c),$.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(a){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(a)}pushMany(a){this.setCursor(Number.POSITIVE_INFINITY),chunkedPush(this.left,a)}unshift(a){this.setCursor(0),this.right.push(a)}unshiftMany(a){this.setCursor(0),chunkedPush(this.right,a.reverse())}setCursor(a){if(!(a===this.left.length||a>this.left.length&&this.right.length===0||a<0&&this.left.length===0))if(a<this.left.length){const o=this.left.splice(a,Number.POSITIVE_INFINITY);chunkedPush(this.right,o.reverse())}else{const o=this.right.splice(this.left.length+this.right.length-a,Number.POSITIVE_INFINITY);chunkedPush(this.left,o.reverse())}}}function chunkedPush(e,a){let o=0;if(a.length<1e4)e.push(...a);else for(;o<a.length;)e.push(...a.slice(o,o+1e4)),o+=1e4}function subtokenize(e){const a={};let o=-1,c,d,$,g,b,_,j;const _e=new SpliceBuffer(e);for(;++o<_e.length;){for(;o in a;)o=a[o];if(c=_e.get(o),o&&c[1].type==="chunkFlow"&&_e.get(o-1)[1].type==="listItemPrefix"&&(_=c[1]._tokenizer.events,$=0,$<_.length&&_[$][1].type==="lineEndingBlank"&&($+=2),$<_.length&&_[$][1].type==="content"))for(;++$<_.length&&_[$][1].type!=="content";)_[$][1].type==="chunkText"&&(_[$][1]._isInFirstContentOfListItem=!0,$++);if(c[0]==="enter")c[1].contentType&&(Object.assign(a,subcontent(_e,o)),o=a[o],j=!0);else if(c[1]._container){for($=o,d=void 0;$--&&(g=_e.get($),g[1].type==="lineEnding"||g[1].type==="lineEndingBlank");)g[0]==="enter"&&(d&&(_e.get(d)[1].type="lineEndingBlank"),g[1].type="lineEnding",d=$);d&&(c[1].end={..._e.get(d)[1].start},b=_e.slice(d,o),b.unshift(c),_e.splice(d,o-d+1,b))}}return splice(e,0,Number.POSITIVE_INFINITY,_e.slice(0)),!j}function subcontent(e,a){const o=e.get(a)[1],c=e.get(a)[2];let d=a-1;const $=[],g=o._tokenizer||c.parser[o.contentType](o.start),b=g.events,_=[],j={};let _e,et,tt=-1,nt=o,at=0,lt=0;const mt=[lt];for(;nt;){for(;e.get(++d)[1]!==nt;);$.push(d),nt._tokenizer||(_e=c.sliceStream(nt),nt.next||_e.push(null),et&&g.defineSkip(nt.start),nt._isInFirstContentOfListItem&&(g._gfmTasklistFirstContentOfListItem=!0),g.write(_e),nt._isInFirstContentOfListItem&&(g._gfmTasklistFirstContentOfListItem=void 0)),et=nt,nt=nt.next}for(nt=o;++tt<b.length;)b[tt][0]==="exit"&&b[tt-1][0]==="enter"&&b[tt][1].type===b[tt-1][1].type&&b[tt][1].start.line!==b[tt][1].end.line&&(lt=tt+1,mt.push(lt),nt._tokenizer=void 0,nt.previous=void 0,nt=nt.next);for(g.events=[],nt?(nt._tokenizer=void 0,nt.previous=void 0):mt.pop(),tt=mt.length;tt--;){const ot=b.slice(mt[tt],mt[tt+1]),st=$.pop();_.push([st,st+ot.length-1]),e.splice(st,2,ot)}for(_.reverse(),tt=-1;++tt<_.length;)j[at+_[tt][0]]=at+_[tt][1],at+=_[tt][1]-_[tt][0]-1;return j}const content={resolve:resolveContent,tokenize:tokenizeContent},continuationConstruct={partial:!0,tokenize:tokenizeContinuation};function resolveContent(e){return subtokenize(e),e}function tokenizeContent(e,a){let o;return c;function c(b){return e.enter("content"),o=e.enter("chunkContent",{contentType:"content"}),d(b)}function d(b){return b===null?$(b):markdownLineEnding(b)?e.check(continuationConstruct,g,$)(b):(e.consume(b),d)}function $(b){return e.exit("chunkContent"),e.exit("content"),a(b)}function g(b){return e.consume(b),e.exit("chunkContent"),o.next=e.enter("chunkContent",{contentType:"content",previous:o}),o=o.next,d}}function tokenizeContinuation(e,a,o){const c=this;return d;function d(g){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(g),e.exit("lineEnding"),factorySpace(e,$,"linePrefix")}function $(g){if(g===null||markdownLineEnding(g))return o(g);const b=c.events[c.events.length-1];return!c.parser.constructs.disable.null.includes("codeIndented")&&b&&b[1].type==="linePrefix"&&b[2].sliceSerialize(b[1],!0).length>=4?a(g):e.interrupt(c.parser.constructs.flow,o,a)(g)}}function factoryDestination(e,a,o,c,d,$,g,b,_){const j=_||Number.POSITIVE_INFINITY;let _e=0;return et;function et(ot){return ot===60?(e.enter(c),e.enter(d),e.enter($),e.consume(ot),e.exit($),tt):ot===null||ot===32||ot===41||asciiControl(ot)?o(ot):(e.enter(c),e.enter(g),e.enter(b),e.enter("chunkString",{contentType:"string"}),lt(ot))}function tt(ot){return ot===62?(e.enter($),e.consume(ot),e.exit($),e.exit(d),e.exit(c),a):(e.enter(b),e.enter("chunkString",{contentType:"string"}),nt(ot))}function nt(ot){return ot===62?(e.exit("chunkString"),e.exit(b),tt(ot)):ot===null||ot===60||markdownLineEnding(ot)?o(ot):(e.consume(ot),ot===92?at:nt)}function at(ot){return ot===60||ot===62||ot===92?(e.consume(ot),nt):nt(ot)}function lt(ot){return!_e&&(ot===null||ot===41||markdownLineEndingOrSpace(ot))?(e.exit("chunkString"),e.exit(b),e.exit(g),e.exit(c),a(ot)):_e<j&&ot===40?(e.consume(ot),_e++,lt):ot===41?(e.consume(ot),_e--,lt):ot===null||ot===32||ot===40||asciiControl(ot)?o(ot):(e.consume(ot),ot===92?mt:lt)}function mt(ot){return ot===40||ot===41||ot===92?(e.consume(ot),lt):lt(ot)}}function factoryLabel(e,a,o,c,d,$){const g=this;let b=0,_;return j;function j(nt){return e.enter(c),e.enter(d),e.consume(nt),e.exit(d),e.enter($),_e}function _e(nt){return b>999||nt===null||nt===91||nt===93&&!_||nt===94&&!b&&"_hiddenFootnoteSupport"in g.parser.constructs?o(nt):nt===93?(e.exit($),e.enter(d),e.consume(nt),e.exit(d),e.exit(c),a):markdownLineEnding(nt)?(e.enter("lineEnding"),e.consume(nt),e.exit("lineEnding"),_e):(e.enter("chunkString",{contentType:"string"}),et(nt))}function et(nt){return nt===null||nt===91||nt===93||markdownLineEnding(nt)||b++>999?(e.exit("chunkString"),_e(nt)):(e.consume(nt),_||(_=!markdownSpace(nt)),nt===92?tt:et)}function tt(nt){return nt===91||nt===92||nt===93?(e.consume(nt),b++,et):et(nt)}}function factoryTitle(e,a,o,c,d,$){let g;return b;function b(tt){return tt===34||tt===39||tt===40?(e.enter(c),e.enter(d),e.consume(tt),e.exit(d),g=tt===40?41:tt,_):o(tt)}function _(tt){return tt===g?(e.enter(d),e.consume(tt),e.exit(d),e.exit(c),a):(e.enter($),j(tt))}function j(tt){return tt===g?(e.exit($),_(g)):tt===null?o(tt):markdownLineEnding(tt)?(e.enter("lineEnding"),e.consume(tt),e.exit("lineEnding"),factorySpace(e,j,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),_e(tt))}function _e(tt){return tt===g||tt===null||markdownLineEnding(tt)?(e.exit("chunkString"),j(tt)):(e.consume(tt),tt===92?et:_e)}function et(tt){return tt===g||tt===92?(e.consume(tt),_e):_e(tt)}}function factoryWhitespace(e,a){let o;return c;function c(d){return markdownLineEnding(d)?(e.enter("lineEnding"),e.consume(d),e.exit("lineEnding"),o=!0,c):markdownSpace(d)?factorySpace(e,c,o?"linePrefix":"lineSuffix")(d):a(d)}}const definition={name:"definition",tokenize:tokenizeDefinition},titleBefore={partial:!0,tokenize:tokenizeTitleBefore};function tokenizeDefinition(e,a,o){const c=this;let d;return $;function $(nt){return e.enter("definition"),g(nt)}function g(nt){return factoryLabel.call(c,e,b,o,"definitionLabel","definitionLabelMarker","definitionLabelString")(nt)}function b(nt){return d=normalizeIdentifier(c.sliceSerialize(c.events[c.events.length-1][1]).slice(1,-1)),nt===58?(e.enter("definitionMarker"),e.consume(nt),e.exit("definitionMarker"),_):o(nt)}function _(nt){return markdownLineEndingOrSpace(nt)?factoryWhitespace(e,j)(nt):j(nt)}function j(nt){return factoryDestination(e,_e,o,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(nt)}function _e(nt){return e.attempt(titleBefore,et,et)(nt)}function et(nt){return markdownSpace(nt)?factorySpace(e,tt,"whitespace")(nt):tt(nt)}function tt(nt){return nt===null||markdownLineEnding(nt)?(e.exit("definition"),c.parser.defined.push(d),a(nt)):o(nt)}}function tokenizeTitleBefore(e,a,o){return c;function c(b){return markdownLineEndingOrSpace(b)?factoryWhitespace(e,d)(b):o(b)}function d(b){return factoryTitle(e,$,o,"definitionTitle","definitionTitleMarker","definitionTitleString")(b)}function $(b){return markdownSpace(b)?factorySpace(e,g,"whitespace")(b):g(b)}function g(b){return b===null||markdownLineEnding(b)?a(b):o(b)}}const hardBreakEscape={name:"hardBreakEscape",tokenize:tokenizeHardBreakEscape};function tokenizeHardBreakEscape(e,a,o){return c;function c($){return e.enter("hardBreakEscape"),e.consume($),d}function d($){return markdownLineEnding($)?(e.exit("hardBreakEscape"),a($)):o($)}}const headingAtx={name:"headingAtx",resolve:resolveHeadingAtx,tokenize:tokenizeHeadingAtx};function resolveHeadingAtx(e,a){let o=e.length-2,c=3,d,$;return e[c][1].type==="whitespace"&&(c+=2),o-2>c&&e[o][1].type==="whitespace"&&(o-=2),e[o][1].type==="atxHeadingSequence"&&(c===o-1||o-4>c&&e[o-2][1].type==="whitespace")&&(o-=c+1===o?2:4),o>c&&(d={type:"atxHeadingText",start:e[c][1].start,end:e[o][1].end},$={type:"chunkText",start:e[c][1].start,end:e[o][1].end,contentType:"text"},splice(e,c,o-c+1,[["enter",d,a],["enter",$,a],["exit",$,a],["exit",d,a]])),e}function tokenizeHeadingAtx(e,a,o){let c=0;return d;function d(_e){return e.enter("atxHeading"),$(_e)}function $(_e){return e.enter("atxHeadingSequence"),g(_e)}function g(_e){return _e===35&&c++<6?(e.consume(_e),g):_e===null||markdownLineEndingOrSpace(_e)?(e.exit("atxHeadingSequence"),b(_e)):o(_e)}function b(_e){return _e===35?(e.enter("atxHeadingSequence"),_(_e)):_e===null||markdownLineEnding(_e)?(e.exit("atxHeading"),a(_e)):markdownSpace(_e)?factorySpace(e,b,"whitespace")(_e):(e.enter("atxHeadingText"),j(_e))}function _(_e){return _e===35?(e.consume(_e),_):(e.exit("atxHeadingSequence"),b(_e))}function j(_e){return _e===null||_e===35||markdownLineEndingOrSpace(_e)?(e.exit("atxHeadingText"),b(_e)):(e.consume(_e),j)}}const htmlBlockNames=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],htmlRawNames=["pre","script","style","textarea"],htmlFlow={concrete:!0,name:"htmlFlow",resolveTo:resolveToHtmlFlow,tokenize:tokenizeHtmlFlow},blankLineBefore={partial:!0,tokenize:tokenizeBlankLineBefore},nonLazyContinuationStart={partial:!0,tokenize:tokenizeNonLazyContinuationStart};function resolveToHtmlFlow(e){let a=e.length;for(;a--&&!(e[a][0]==="enter"&&e[a][1].type==="htmlFlow"););return a>1&&e[a-2][1].type==="linePrefix"&&(e[a][1].start=e[a-2][1].start,e[a+1][1].start=e[a-2][1].start,e.splice(a-2,2)),e}function tokenizeHtmlFlow(e,a,o){const c=this;let d,$,g,b,_;return j;function j($t){return _e($t)}function _e($t){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume($t),et}function et($t){return $t===33?(e.consume($t),tt):$t===47?(e.consume($t),$=!0,lt):$t===63?(e.consume($t),d=3,c.interrupt?a:dt):asciiAlpha($t)?(e.consume($t),g=String.fromCharCode($t),mt):o($t)}function tt($t){return $t===45?(e.consume($t),d=2,nt):$t===91?(e.consume($t),d=5,b=0,at):asciiAlpha($t)?(e.consume($t),d=4,c.interrupt?a:dt):o($t)}function nt($t){return $t===45?(e.consume($t),c.interrupt?a:dt):o($t)}function at($t){const Lt="CDATA[";return $t===Lt.charCodeAt(b++)?(e.consume($t),b===Lt.length?c.interrupt?a:St:at):o($t)}function lt($t){return asciiAlpha($t)?(e.consume($t),g=String.fromCharCode($t),mt):o($t)}function mt($t){if($t===null||$t===47||$t===62||markdownLineEndingOrSpace($t)){const Lt=$t===47,Ot=g.toLowerCase();return!Lt&&!$&&htmlRawNames.includes(Ot)?(d=1,c.interrupt?a($t):St($t)):htmlBlockNames.includes(g.toLowerCase())?(d=6,Lt?(e.consume($t),ot):c.interrupt?a($t):St($t)):(d=7,c.interrupt&&!c.parser.lazy[c.now().line]?o($t):$?st($t):ut($t))}return $t===45||asciiAlphanumeric($t)?(e.consume($t),g+=String.fromCharCode($t),mt):o($t)}function ot($t){return $t===62?(e.consume($t),c.interrupt?a:St):o($t)}function st($t){return markdownSpace($t)?(e.consume($t),st):Pt($t)}function ut($t){return $t===47?(e.consume($t),Pt):$t===58||$t===95||asciiAlpha($t)?(e.consume($t),pt):markdownSpace($t)?(e.consume($t),ut):Pt($t)}function pt($t){return $t===45||$t===46||$t===58||$t===95||asciiAlphanumeric($t)?(e.consume($t),pt):gt($t)}function gt($t){return $t===61?(e.consume($t),ft):markdownSpace($t)?(e.consume($t),gt):ut($t)}function ft($t){return $t===null||$t===60||$t===61||$t===62||$t===96?o($t):$t===34||$t===39?(e.consume($t),_=$t,yt):markdownSpace($t)?(e.consume($t),ft):_t($t)}function yt($t){return $t===_?(e.consume($t),_=null,vt):$t===null||markdownLineEnding($t)?o($t):(e.consume($t),yt)}function _t($t){return $t===null||$t===34||$t===39||$t===47||$t===60||$t===61||$t===62||$t===96||markdownLineEndingOrSpace($t)?gt($t):(e.consume($t),_t)}function vt($t){return $t===47||$t===62||markdownSpace($t)?ut($t):o($t)}function Pt($t){return $t===62?(e.consume($t),Tt):o($t)}function Tt($t){return $t===null||markdownLineEnding($t)?St($t):markdownSpace($t)?(e.consume($t),Tt):o($t)}function St($t){return $t===45&&d===2?(e.consume($t),zt):$t===60&&d===1?(e.consume($t),Nt):$t===62&&d===4?(e.consume($t),Mt):$t===63&&d===3?(e.consume($t),dt):$t===93&&d===5?(e.consume($t),At):markdownLineEnding($t)&&(d===6||d===7)?(e.exit("htmlFlowData"),e.check(blankLineBefore,It,qt)($t)):$t===null||markdownLineEnding($t)?(e.exit("htmlFlowData"),qt($t)):(e.consume($t),St)}function qt($t){return e.check(nonLazyContinuationStart,Ft,It)($t)}function Ft($t){return e.enter("lineEnding"),e.consume($t),e.exit("lineEnding"),Dt}function Dt($t){return $t===null||markdownLineEnding($t)?qt($t):(e.enter("htmlFlowData"),St($t))}function zt($t){return $t===45?(e.consume($t),dt):St($t)}function Nt($t){return $t===47?(e.consume($t),g="",Et):St($t)}function Et($t){if($t===62){const Lt=g.toLowerCase();return htmlRawNames.includes(Lt)?(e.consume($t),Mt):St($t)}return asciiAlpha($t)&&g.length<8?(e.consume($t),g+=String.fromCharCode($t),Et):St($t)}function At($t){return $t===93?(e.consume($t),dt):St($t)}function dt($t){return $t===62?(e.consume($t),Mt):$t===45&&d===2?(e.consume($t),dt):St($t)}function Mt($t){return $t===null||markdownLineEnding($t)?(e.exit("htmlFlowData"),It($t)):(e.consume($t),Mt)}function It($t){return e.exit("htmlFlow"),a($t)}}function tokenizeNonLazyContinuationStart(e,a,o){const c=this;return d;function d(g){return markdownLineEnding(g)?(e.enter("lineEnding"),e.consume(g),e.exit("lineEnding"),$):o(g)}function $(g){return c.parser.lazy[c.now().line]?o(g):a(g)}}function tokenizeBlankLineBefore(e,a,o){return c;function c(d){return e.enter("lineEnding"),e.consume(d),e.exit("lineEnding"),e.attempt(blankLine,a,o)}}const htmlText={name:"htmlText",tokenize:tokenizeHtmlText};function tokenizeHtmlText(e,a,o){const c=this;let d,$,g;return b;function b(dt){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(dt),_}function _(dt){return dt===33?(e.consume(dt),j):dt===47?(e.consume(dt),gt):dt===63?(e.consume(dt),ut):asciiAlpha(dt)?(e.consume(dt),_t):o(dt)}function j(dt){return dt===45?(e.consume(dt),_e):dt===91?(e.consume(dt),$=0,at):asciiAlpha(dt)?(e.consume(dt),st):o(dt)}function _e(dt){return dt===45?(e.consume(dt),nt):o(dt)}function et(dt){return dt===null?o(dt):dt===45?(e.consume(dt),tt):markdownLineEnding(dt)?(g=et,Nt(dt)):(e.consume(dt),et)}function tt(dt){return dt===45?(e.consume(dt),nt):et(dt)}function nt(dt){return dt===62?zt(dt):dt===45?tt(dt):et(dt)}function at(dt){const Mt="CDATA[";return dt===Mt.charCodeAt($++)?(e.consume(dt),$===Mt.length?lt:at):o(dt)}function lt(dt){return dt===null?o(dt):dt===93?(e.consume(dt),mt):markdownLineEnding(dt)?(g=lt,Nt(dt)):(e.consume(dt),lt)}function mt(dt){return dt===93?(e.consume(dt),ot):lt(dt)}function ot(dt){return dt===62?zt(dt):dt===93?(e.consume(dt),ot):lt(dt)}function st(dt){return dt===null||dt===62?zt(dt):markdownLineEnding(dt)?(g=st,Nt(dt)):(e.consume(dt),st)}function ut(dt){return dt===null?o(dt):dt===63?(e.consume(dt),pt):markdownLineEnding(dt)?(g=ut,Nt(dt)):(e.consume(dt),ut)}function pt(dt){return dt===62?zt(dt):ut(dt)}function gt(dt){return asciiAlpha(dt)?(e.consume(dt),ft):o(dt)}function ft(dt){return dt===45||asciiAlphanumeric(dt)?(e.consume(dt),ft):yt(dt)}function yt(dt){return markdownLineEnding(dt)?(g=yt,Nt(dt)):markdownSpace(dt)?(e.consume(dt),yt):zt(dt)}function _t(dt){return dt===45||asciiAlphanumeric(dt)?(e.consume(dt),_t):dt===47||dt===62||markdownLineEndingOrSpace(dt)?vt(dt):o(dt)}function vt(dt){return dt===47?(e.consume(dt),zt):dt===58||dt===95||asciiAlpha(dt)?(e.consume(dt),Pt):markdownLineEnding(dt)?(g=vt,Nt(dt)):markdownSpace(dt)?(e.consume(dt),vt):zt(dt)}function Pt(dt){return dt===45||dt===46||dt===58||dt===95||asciiAlphanumeric(dt)?(e.consume(dt),Pt):Tt(dt)}function Tt(dt){return dt===61?(e.consume(dt),St):markdownLineEnding(dt)?(g=Tt,Nt(dt)):markdownSpace(dt)?(e.consume(dt),Tt):vt(dt)}function St(dt){return dt===null||dt===60||dt===61||dt===62||dt===96?o(dt):dt===34||dt===39?(e.consume(dt),d=dt,qt):markdownLineEnding(dt)?(g=St,Nt(dt)):markdownSpace(dt)?(e.consume(dt),St):(e.consume(dt),Ft)}function qt(dt){return dt===d?(e.consume(dt),d=void 0,Dt):dt===null?o(dt):markdownLineEnding(dt)?(g=qt,Nt(dt)):(e.consume(dt),qt)}function Ft(dt){return dt===null||dt===34||dt===39||dt===60||dt===61||dt===96?o(dt):dt===47||dt===62||markdownLineEndingOrSpace(dt)?vt(dt):(e.consume(dt),Ft)}function Dt(dt){return dt===47||dt===62||markdownLineEndingOrSpace(dt)?vt(dt):o(dt)}function zt(dt){return dt===62?(e.consume(dt),e.exit("htmlTextData"),e.exit("htmlText"),a):o(dt)}function Nt(dt){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(dt),e.exit("lineEnding"),Et}function Et(dt){return markdownSpace(dt)?factorySpace(e,At,"linePrefix",c.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(dt):At(dt)}function At(dt){return e.enter("htmlTextData"),g(dt)}}const labelEnd={name:"labelEnd",resolveAll:resolveAllLabelEnd,resolveTo:resolveToLabelEnd,tokenize:tokenizeLabelEnd},resourceConstruct={tokenize:tokenizeResource},referenceFullConstruct={tokenize:tokenizeReferenceFull},referenceCollapsedConstruct={tokenize:tokenizeReferenceCollapsed};function resolveAllLabelEnd(e){let a=-1;const o=[];for(;++a<e.length;){const c=e[a][1];if(o.push(e[a]),c.type==="labelImage"||c.type==="labelLink"||c.type==="labelEnd"){const d=c.type==="labelImage"?4:2;c.type="data",a+=d}}return e.length!==o.length&&splice(e,0,e.length,o),e}function resolveToLabelEnd(e,a){let o=e.length,c=0,d,$,g,b;for(;o--;)if(d=e[o][1],$){if(d.type==="link"||d.type==="labelLink"&&d._inactive)break;e[o][0]==="enter"&&d.type==="labelLink"&&(d._inactive=!0)}else if(g){if(e[o][0]==="enter"&&(d.type==="labelImage"||d.type==="labelLink")&&!d._balanced&&($=o,d.type!=="labelLink")){c=2;break}}else d.type==="labelEnd"&&(g=o);const _={type:e[$][1].type==="labelLink"?"link":"image",start:{...e[$][1].start},end:{...e[e.length-1][1].end}},j={type:"label",start:{...e[$][1].start},end:{...e[g][1].end}},_e={type:"labelText",start:{...e[$+c+2][1].end},end:{...e[g-2][1].start}};return b=[["enter",_,a],["enter",j,a]],b=push(b,e.slice($+1,$+c+3)),b=push(b,[["enter",_e,a]]),b=push(b,resolveAll(a.parser.constructs.insideSpan.null,e.slice($+c+4,g-3),a)),b=push(b,[["exit",_e,a],e[g-2],e[g-1],["exit",j,a]]),b=push(b,e.slice(g+1)),b=push(b,[["exit",_,a]]),splice(e,$,e.length,b),e}function tokenizeLabelEnd(e,a,o){const c=this;let d=c.events.length,$,g;for(;d--;)if((c.events[d][1].type==="labelImage"||c.events[d][1].type==="labelLink")&&!c.events[d][1]._balanced){$=c.events[d][1];break}return b;function b(tt){return $?$._inactive?et(tt):(g=c.parser.defined.includes(normalizeIdentifier(c.sliceSerialize({start:$.end,end:c.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(tt),e.exit("labelMarker"),e.exit("labelEnd"),_):o(tt)}function _(tt){return tt===40?e.attempt(resourceConstruct,_e,g?_e:et)(tt):tt===91?e.attempt(referenceFullConstruct,_e,g?j:et)(tt):g?_e(tt):et(tt)}function j(tt){return e.attempt(referenceCollapsedConstruct,_e,et)(tt)}function _e(tt){return a(tt)}function et(tt){return $._balanced=!0,o(tt)}}function tokenizeResource(e,a,o){return c;function c(et){return e.enter("resource"),e.enter("resourceMarker"),e.consume(et),e.exit("resourceMarker"),d}function d(et){return markdownLineEndingOrSpace(et)?factoryWhitespace(e,$)(et):$(et)}function $(et){return et===41?_e(et):factoryDestination(e,g,b,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(et)}function g(et){return markdownLineEndingOrSpace(et)?factoryWhitespace(e,_)(et):_e(et)}function b(et){return o(et)}function _(et){return et===34||et===39||et===40?factoryTitle(e,j,o,"resourceTitle","resourceTitleMarker","resourceTitleString")(et):_e(et)}function j(et){return markdownLineEndingOrSpace(et)?factoryWhitespace(e,_e)(et):_e(et)}function _e(et){return et===41?(e.enter("resourceMarker"),e.consume(et),e.exit("resourceMarker"),e.exit("resource"),a):o(et)}}function tokenizeReferenceFull(e,a,o){const c=this;return d;function d(b){return factoryLabel.call(c,e,$,g,"reference","referenceMarker","referenceString")(b)}function $(b){return c.parser.defined.includes(normalizeIdentifier(c.sliceSerialize(c.events[c.events.length-1][1]).slice(1,-1)))?a(b):o(b)}function g(b){return o(b)}}function tokenizeReferenceCollapsed(e,a,o){return c;function c($){return e.enter("reference"),e.enter("referenceMarker"),e.consume($),e.exit("referenceMarker"),d}function d($){return $===93?(e.enter("referenceMarker"),e.consume($),e.exit("referenceMarker"),e.exit("reference"),a):o($)}}const labelStartImage={name:"labelStartImage",resolveAll:labelEnd.resolveAll,tokenize:tokenizeLabelStartImage};function tokenizeLabelStartImage(e,a,o){const c=this;return d;function d(b){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(b),e.exit("labelImageMarker"),$}function $(b){return b===91?(e.enter("labelMarker"),e.consume(b),e.exit("labelMarker"),e.exit("labelImage"),g):o(b)}function g(b){return b===94&&"_hiddenFootnoteSupport"in c.parser.constructs?o(b):a(b)}}const labelStartLink={name:"labelStartLink",resolveAll:labelEnd.resolveAll,tokenize:tokenizeLabelStartLink};function tokenizeLabelStartLink(e,a,o){const c=this;return d;function d(g){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(g),e.exit("labelMarker"),e.exit("labelLink"),$}function $(g){return g===94&&"_hiddenFootnoteSupport"in c.parser.constructs?o(g):a(g)}}const lineEnding={name:"lineEnding",tokenize:tokenizeLineEnding};function tokenizeLineEnding(e,a){return o;function o(c){return e.enter("lineEnding"),e.consume(c),e.exit("lineEnding"),factorySpace(e,a,"linePrefix")}}const thematicBreak$1={name:"thematicBreak",tokenize:tokenizeThematicBreak};function tokenizeThematicBreak(e,a,o){let c=0,d;return $;function $(j){return e.enter("thematicBreak"),g(j)}function g(j){return d=j,b(j)}function b(j){return j===d?(e.enter("thematicBreakSequence"),_(j)):c>=3&&(j===null||markdownLineEnding(j))?(e.exit("thematicBreak"),a(j)):o(j)}function _(j){return j===d?(e.consume(j),c++,_):(e.exit("thematicBreakSequence"),markdownSpace(j)?factorySpace(e,b,"whitespace")(j):b(j))}}const list$1={continuation:{tokenize:tokenizeListContinuation},exit:tokenizeListEnd,name:"list",tokenize:tokenizeListStart},listItemPrefixWhitespaceConstruct={partial:!0,tokenize:tokenizeListItemPrefixWhitespace},indentConstruct={partial:!0,tokenize:tokenizeIndent};function tokenizeListStart(e,a,o){const c=this,d=c.events[c.events.length-1];let $=d&&d[1].type==="linePrefix"?d[2].sliceSerialize(d[1],!0).length:0,g=0;return b;function b(nt){const at=c.containerState.type||(nt===42||nt===43||nt===45?"listUnordered":"listOrdered");if(at==="listUnordered"?!c.containerState.marker||nt===c.containerState.marker:asciiDigit(nt)){if(c.containerState.type||(c.containerState.type=at,e.enter(at,{_container:!0})),at==="listUnordered")return e.enter("listItemPrefix"),nt===42||nt===45?e.check(thematicBreak$1,o,j)(nt):j(nt);if(!c.interrupt||nt===49)return e.enter("listItemPrefix"),e.enter("listItemValue"),_(nt)}return o(nt)}function _(nt){return asciiDigit(nt)&&++g<10?(e.consume(nt),_):(!c.interrupt||g<2)&&(c.containerState.marker?nt===c.containerState.marker:nt===41||nt===46)?(e.exit("listItemValue"),j(nt)):o(nt)}function j(nt){return e.enter("listItemMarker"),e.consume(nt),e.exit("listItemMarker"),c.containerState.marker=c.containerState.marker||nt,e.check(blankLine,c.interrupt?o:_e,e.attempt(listItemPrefixWhitespaceConstruct,tt,et))}function _e(nt){return c.containerState.initialBlankLine=!0,$++,tt(nt)}function et(nt){return markdownSpace(nt)?(e.enter("listItemPrefixWhitespace"),e.consume(nt),e.exit("listItemPrefixWhitespace"),tt):o(nt)}function tt(nt){return c.containerState.size=$+c.sliceSerialize(e.exit("listItemPrefix"),!0).length,a(nt)}}function tokenizeListContinuation(e,a,o){const c=this;return c.containerState._closeFlow=void 0,e.check(blankLine,d,$);function d(b){return c.containerState.furtherBlankLines=c.containerState.furtherBlankLines||c.containerState.initialBlankLine,factorySpace(e,a,"listItemIndent",c.containerState.size+1)(b)}function $(b){return c.containerState.furtherBlankLines||!markdownSpace(b)?(c.containerState.furtherBlankLines=void 0,c.containerState.initialBlankLine=void 0,g(b)):(c.containerState.furtherBlankLines=void 0,c.containerState.initialBlankLine=void 0,e.attempt(indentConstruct,a,g)(b))}function g(b){return c.containerState._closeFlow=!0,c.interrupt=void 0,factorySpace(e,e.attempt(list$1,a,o),"linePrefix",c.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(b)}}function tokenizeIndent(e,a,o){const c=this;return factorySpace(e,d,"listItemIndent",c.containerState.size+1);function d($){const g=c.events[c.events.length-1];return g&&g[1].type==="listItemIndent"&&g[2].sliceSerialize(g[1],!0).length===c.containerState.size?a($):o($)}}function tokenizeListEnd(e){e.exit(this.containerState.type)}function tokenizeListItemPrefixWhitespace(e,a,o){const c=this;return factorySpace(e,d,"listItemPrefixWhitespace",c.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function d($){const g=c.events[c.events.length-1];return!markdownSpace($)&&g&&g[1].type==="listItemPrefixWhitespace"?a($):o($)}}const setextUnderline={name:"setextUnderline",resolveTo:resolveToSetextUnderline,tokenize:tokenizeSetextUnderline};function resolveToSetextUnderline(e,a){let o=e.length,c,d,$;for(;o--;)if(e[o][0]==="enter"){if(e[o][1].type==="content"){c=o;break}e[o][1].type==="paragraph"&&(d=o)}else e[o][1].type==="content"&&e.splice(o,1),!$&&e[o][1].type==="definition"&&($=o);const g={type:"setextHeading",start:{...e[d][1].start},end:{...e[e.length-1][1].end}};return e[d][1].type="setextHeadingText",$?(e.splice(d,0,["enter",g,a]),e.splice($+1,0,["exit",e[c][1],a]),e[c][1].end={...e[$][1].end}):e[c][1]=g,e.push(["exit",g,a]),e}function tokenizeSetextUnderline(e,a,o){const c=this;let d;return $;function $(j){let _e=c.events.length,et;for(;_e--;)if(c.events[_e][1].type!=="lineEnding"&&c.events[_e][1].type!=="linePrefix"&&c.events[_e][1].type!=="content"){et=c.events[_e][1].type==="paragraph";break}return!c.parser.lazy[c.now().line]&&(c.interrupt||et)?(e.enter("setextHeadingLine"),d=j,g(j)):o(j)}function g(j){return e.enter("setextHeadingLineSequence"),b(j)}function b(j){return j===d?(e.consume(j),b):(e.exit("setextHeadingLineSequence"),markdownSpace(j)?factorySpace(e,_,"lineSuffix")(j):_(j))}function _(j){return j===null||markdownLineEnding(j)?(e.exit("setextHeadingLine"),a(j)):o(j)}}const flow$1={tokenize:initializeFlow};function initializeFlow(e){const a=this,o=e.attempt(blankLine,c,e.attempt(this.parser.constructs.flowInitial,d,factorySpace(e,e.attempt(this.parser.constructs.flow,d,e.attempt(content,d)),"linePrefix")));return o;function c($){if($===null){e.consume($);return}return e.enter("lineEndingBlank"),e.consume($),e.exit("lineEndingBlank"),a.currentConstruct=void 0,o}function d($){if($===null){e.consume($);return}return e.enter("lineEnding"),e.consume($),e.exit("lineEnding"),a.currentConstruct=void 0,o}}const resolver={resolveAll:createResolver()},string$1=initializeFactory("string"),text$5=initializeFactory("text");function initializeFactory(e){return{resolveAll:createResolver(e==="text"?resolveAllLineSuffixes:void 0),tokenize:a};function a(o){const c=this,d=this.parser.constructs[e],$=o.attempt(d,g,b);return g;function g(_e){return j(_e)?$(_e):b(_e)}function b(_e){if(_e===null){o.consume(_e);return}return o.enter("data"),o.consume(_e),_}function _(_e){return j(_e)?(o.exit("data"),$(_e)):(o.consume(_e),_)}function j(_e){if(_e===null)return!0;const et=d[_e];let tt=-1;if(et)for(;++tt<et.length;){const nt=et[tt];if(!nt.previous||nt.previous.call(c,c.previous))return!0}return!1}}}function createResolver(e){return a;function a(o,c){let d=-1,$;for(;++d<=o.length;)$===void 0?o[d]&&o[d][1].type==="data"&&($=d,d++):(!o[d]||o[d][1].type!=="data")&&(d!==$+2&&(o[$][1].end=o[d-1][1].end,o.splice($+2,d-$-2),d=$+2),$=void 0);return e?e(o,c):o}}function resolveAllLineSuffixes(e,a){let o=0;for(;++o<=e.length;)if((o===e.length||e[o][1].type==="lineEnding")&&e[o-1][1].type==="data"){const c=e[o-1][1],d=a.sliceStream(c);let $=d.length,g=-1,b=0,_;for(;$--;){const j=d[$];if(typeof j=="string"){for(g=j.length;j.charCodeAt(g-1)===32;)b++,g--;if(g)break;g=-1}else if(j===-2)_=!0,b++;else if(j!==-1){$++;break}}if(b){const j={type:o===e.length||_||b<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:$?g:c.start._bufferIndex+g,_index:c.start._index+$,line:c.end.line,column:c.end.column-b,offset:c.end.offset-b},end:{...c.end}};c.end={...j.start},c.start.offset===c.end.offset?Object.assign(c,j):(e.splice(o,0,["enter",j,a],["exit",j,a]),o+=2)}o++}return e}const document$1={42:list$1,43:list$1,45:list$1,48:list$1,49:list$1,50:list$1,51:list$1,52:list$1,53:list$1,54:list$1,55:list$1,56:list$1,57:list$1,62:blockQuote},contentInitial={91:definition},flowInitial={[-2]:codeIndented,[-1]:codeIndented,32:codeIndented},flow={35:headingAtx,42:thematicBreak$1,45:[setextUnderline,thematicBreak$1],60:htmlFlow,61:setextUnderline,95:thematicBreak$1,96:codeFenced,126:codeFenced},string={38:characterReference,92:characterEscape},text$4={[-5]:lineEnding,[-4]:lineEnding,[-3]:lineEnding,33:labelStartImage,38:characterReference,42:attention,60:[autolink,htmlText],91:labelStartLink,92:[hardBreakEscape,characterEscape],93:labelEnd,95:attention,96:codeText},insideSpan={null:[attention,resolver]},attentionMarkers={null:[42,95]},disable={null:[]},defaultConstructs=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers,contentInitial,disable,document:document$1,flow,flowInitial,insideSpan,string,text:text$4},Symbol.toStringTag,{value:"Module"}));function createTokenizer(e,a,o){let c={_bufferIndex:-1,_index:0,line:o&&o.line||1,column:o&&o.column||1,offset:o&&o.offset||0};const d={},$=[];let g=[],b=[];const _={attempt:yt(gt),check:yt(ft),consume:st,enter:ut,exit:pt,interrupt:yt(ft,{interrupt:!0})},j={code:null,containerState:{},defineSkip:lt,events:[],now:at,parser:e,previous:null,sliceSerialize:tt,sliceStream:nt,write:et};let _e=a.tokenize.call(j,_);return a.resolveAll&&$.push(a),j;function et(Tt){return g=push(g,Tt),mt(),g[g.length-1]!==null?[]:(_t(a,0),j.events=resolveAll($,j.events,j),j.events)}function tt(Tt,St){return serializeChunks(nt(Tt),St)}function nt(Tt){return sliceChunks(g,Tt)}function at(){const{_bufferIndex:Tt,_index:St,line:qt,column:Ft,offset:Dt}=c;return{_bufferIndex:Tt,_index:St,line:qt,column:Ft,offset:Dt}}function lt(Tt){d[Tt.line]=Tt.column,Pt()}function mt(){let Tt;for(;c._index<g.length;){const St=g[c._index];if(typeof St=="string")for(Tt=c._index,c._bufferIndex<0&&(c._bufferIndex=0);c._index===Tt&&c._bufferIndex<St.length;)ot(St.charCodeAt(c._bufferIndex));else ot(St)}}function ot(Tt){_e=_e(Tt)}function st(Tt){markdownLineEnding(Tt)?(c.line++,c.column=1,c.offset+=Tt===-3?2:1,Pt()):Tt!==-1&&(c.column++,c.offset++),c._bufferIndex<0?c._index++:(c._bufferIndex++,c._bufferIndex===g[c._index].length&&(c._bufferIndex=-1,c._index++)),j.previous=Tt}function ut(Tt,St){const qt=St||{};return qt.type=Tt,qt.start=at(),j.events.push(["enter",qt,j]),b.push(qt),qt}function pt(Tt){const St=b.pop();return St.end=at(),j.events.push(["exit",St,j]),St}function gt(Tt,St){_t(Tt,St.from)}function ft(Tt,St){St.restore()}function yt(Tt,St){return qt;function qt(Ft,Dt,zt){let Nt,Et,At,dt;return Array.isArray(Ft)?It(Ft):"tokenize"in Ft?It([Ft]):Mt(Ft);function Mt(Vt){return Ht;function Ht(Yt){const Kt=Yt!==null&&Vt[Yt],Qt=Yt!==null&&Vt.null,Zt=[...Array.isArray(Kt)?Kt:Kt?[Kt]:[],...Array.isArray(Qt)?Qt:Qt?[Qt]:[]];return It(Zt)(Yt)}}function It(Vt){return Nt=Vt,Et=0,Vt.length===0?zt:$t(Vt[Et])}function $t(Vt){return Ht;function Ht(Yt){return dt=vt(),At=Vt,Vt.partial||(j.currentConstruct=Vt),Vt.name&&j.parser.constructs.disable.null.includes(Vt.name)?Ot():Vt.tokenize.call(St?Object.assign(Object.create(j),St):j,_,Lt,Ot)(Yt)}}function Lt(Vt){return Tt(At,dt),Dt}function Ot(Vt){return dt.restore(),++Et<Nt.length?$t(Nt[Et]):zt}}}function _t(Tt,St){Tt.resolveAll&&!$.includes(Tt)&&$.push(Tt),Tt.resolve&&splice(j.events,St,j.events.length-St,Tt.resolve(j.events.slice(St),j)),Tt.resolveTo&&(j.events=Tt.resolveTo(j.events,j))}function vt(){const Tt=at(),St=j.previous,qt=j.currentConstruct,Ft=j.events.length,Dt=Array.from(b);return{from:Ft,restore:zt};function zt(){c=Tt,j.previous=St,j.currentConstruct=qt,j.events.length=Ft,b=Dt,Pt()}}function Pt(){c.line in d&&c.column<2&&(c.column=d[c.line],c.offset+=d[c.line]-1)}}function sliceChunks(e,a){const o=a.start._index,c=a.start._bufferIndex,d=a.end._index,$=a.end._bufferIndex;let g;if(o===d)g=[e[o].slice(c,$)];else{if(g=e.slice(o,d),c>-1){const b=g[0];typeof b=="string"?g[0]=b.slice(c):g.shift()}$>0&&g.push(e[d].slice(0,$))}return g}function serializeChunks(e,a){let o=-1;const c=[];let d;for(;++o<e.length;){const $=e[o];let g;if(typeof $=="string")g=$;else switch($){case-5:{g="\r";break}case-4:{g=`
`;break}case-3:{g=`\r
`;break}case-2:{g=a?" ":"	";break}case-1:{if(!a&&d)continue;g=" ";break}default:g=String.fromCharCode($)}d=$===-2,c.push(g)}return c.join("")}function parse(e){const c={constructs:combineExtensions([defaultConstructs,...(e||{}).extensions||[]]),content:d(content$1),defined:[],document:d(document$2),flow:d(flow$1),lazy:{},string:d(string$1),text:d(text$5)};return c;function d($){return g;function g(b){return createTokenizer(c,$,b)}}}function postprocess(e){for(;!subtokenize(e););return e}const search$1=/[\0\t\n\r]/g;function preprocess(){let e=1,a="",o=!0,c;return d;function d($,g,b){const _=[];let j,_e,et,tt,nt;for($=a+(typeof $=="string"?$.toString():new TextDecoder(g||void 0).decode($)),et=0,a="",o&&($.charCodeAt(0)===65279&&et++,o=void 0);et<$.length;){if(search$1.lastIndex=et,j=search$1.exec($),tt=j&&j.index!==void 0?j.index:$.length,nt=$.charCodeAt(tt),!j){a=$.slice(et);break}if(nt===10&&et===tt&&c)_.push(-3),c=void 0;else switch(c&&(_.push(-5),c=void 0),et<tt&&(_.push($.slice(et,tt)),e+=tt-et),nt){case 0:{_.push(65533),e++;break}case 9:{for(_e=Math.ceil(e/4)*4,_.push(-2);e++<_e;)_.push(-1);break}case 10:{_.push(-4),e=1;break}default:c=!0,e=1}et=tt+1}return b&&(c&&_.push(-5),a&&_.push(a),_.push(null)),_}}const characterEscapeOrReference=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function decodeString(e){return e.replace(characterEscapeOrReference,decode)}function decode(e,a,o){if(a)return a;if(o.charCodeAt(0)===35){const d=o.charCodeAt(1),$=d===120||d===88;return decodeNumericCharacterReference(o.slice($?2:1),$?16:10)}return decodeNamedCharacterReference(o)||e}const own$4={}.hasOwnProperty;function fromMarkdown(e,a,o){return typeof a!="string"&&(o=a,a=void 0),compiler(o)(postprocess(parse(o).document().write(preprocess()(e,a,!0))))}function compiler(e){const a={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:$(nn),autolinkProtocol:vt,autolinkEmail:vt,atxHeading:$(rn),blockQuote:$(Qt),characterEscape:vt,characterReference:vt,codeFenced:$(Zt),codeFencedFenceInfo:g,codeFencedFenceMeta:g,codeIndented:$(Zt,g),codeText:$(on,g),codeTextData:vt,data:vt,codeFlowValue:vt,definition:$(ln),definitionDestinationString:g,definitionLabelString:g,definitionTitleString:g,emphasis:$(sn),hardBreakEscape:$(Jt),hardBreakTrailing:$(Jt),htmlFlow:$(en,g),htmlFlowData:vt,htmlText:$(en,g),htmlTextData:vt,image:$(an),label:g,link:$(nn),listItem:$(dn),listItemValue:tt,listOrdered:$(un,et),listUnordered:$(un),paragraph:$(fn),reference:$t,referenceString:g,resourceDestinationString:g,resourceTitleString:g,setextHeading:$(rn),strong:$(hn),thematicBreak:$(tn)},exit:{atxHeading:_(),atxHeadingSequence:gt,autolink:_(),autolinkEmail:Kt,autolinkProtocol:Yt,blockQuote:_(),characterEscapeValue:Pt,characterReferenceMarkerHexadecimal:Ot,characterReferenceMarkerNumeric:Ot,characterReferenceValue:Vt,characterReference:Ht,codeFenced:_(mt),codeFencedFence:lt,codeFencedFenceInfo:nt,codeFencedFenceMeta:at,codeFlowValue:Pt,codeIndented:_(ot),codeText:_(Dt),codeTextData:Pt,data:Pt,definition:_(),definitionDestinationString:pt,definitionLabelString:st,definitionTitleString:ut,emphasis:_(),hardBreakEscape:_(St),hardBreakTrailing:_(St),htmlFlow:_(qt),htmlFlowData:Pt,htmlText:_(Ft),htmlTextData:Pt,image:_(Nt),label:At,labelText:Et,lineEnding:Tt,link:_(zt),listItem:_(),listOrdered:_(),listUnordered:_(),paragraph:_(),referenceString:Lt,resourceDestinationString:dt,resourceTitleString:Mt,resource:It,setextHeading:_(_t),setextHeadingLineSequence:yt,setextHeadingText:ft,strong:_(),thematicBreak:_()}};configure(a,(e||{}).mdastExtensions||[]);const o={};return c;function c(kt){let Ct={type:"root",children:[]};const Rt={stack:[Ct],tokenStack:[],config:a,enter:b,exit:j,buffer:g,resume:_e,data:o},Bt=[];let ct=-1;for(;++ct<kt.length;)if(kt[ct][1].type==="listOrdered"||kt[ct][1].type==="listUnordered")if(kt[ct][0]==="enter")Bt.push(ct);else{const rt=Bt.pop();ct=d(kt,rt,ct)}for(ct=-1;++ct<kt.length;){const rt=a[kt[ct][0]];own$4.call(rt,kt[ct][1].type)&&rt[kt[ct][1].type].call(Object.assign({sliceSerialize:kt[ct][2].sliceSerialize},Rt),kt[ct][1])}if(Rt.tokenStack.length>0){const rt=Rt.tokenStack[Rt.tokenStack.length-1];(rt[1]||defaultOnError).call(Rt,void 0,rt[0])}for(Ct.position={start:point(kt.length>0?kt[0][1].start:{line:1,column:1,offset:0}),end:point(kt.length>0?kt[kt.length-2][1].end:{line:1,column:1,offset:0})},ct=-1;++ct<a.transforms.length;)Ct=a.transforms[ct](Ct)||Ct;return Ct}function d(kt,Ct,Rt){let Bt=Ct-1,ct=-1,rt=!1,it,ht,bt,xt;for(;++Bt<=Rt;){const wt=kt[Bt];switch(wt[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{wt[0]==="enter"?ct++:ct--,xt=void 0;break}case"lineEndingBlank":{wt[0]==="enter"&&(it&&!xt&&!ct&&!bt&&(bt=Bt),xt=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:xt=void 0}if(!ct&&wt[0]==="enter"&&wt[1].type==="listItemPrefix"||ct===-1&&wt[0]==="exit"&&(wt[1].type==="listUnordered"||wt[1].type==="listOrdered")){if(it){let jt=Bt;for(ht=void 0;jt--;){const Xt=kt[jt];if(Xt[1].type==="lineEnding"||Xt[1].type==="lineEndingBlank"){if(Xt[0]==="exit")continue;ht&&(kt[ht][1].type="lineEndingBlank",rt=!0),Xt[1].type="lineEnding",ht=jt}else if(!(Xt[1].type==="linePrefix"||Xt[1].type==="blockQuotePrefix"||Xt[1].type==="blockQuotePrefixWhitespace"||Xt[1].type==="blockQuoteMarker"||Xt[1].type==="listItemIndent"))break}bt&&(!ht||bt<ht)&&(it._spread=!0),it.end=Object.assign({},ht?kt[ht][1].start:wt[1].end),kt.splice(ht||Bt,0,["exit",it,wt[2]]),Bt++,Rt++}if(wt[1].type==="listItemPrefix"){const jt={type:"listItem",_spread:!1,start:Object.assign({},wt[1].start),end:void 0};it=jt,kt.splice(Bt,0,["enter",jt,wt[2]]),Bt++,Rt++,bt=void 0,xt=!0}}}return kt[Ct][1]._spread=rt,Rt}function $(kt,Ct){return Rt;function Rt(Bt){b.call(this,kt(Bt),Bt),Ct&&Ct.call(this,Bt)}}function g(){this.stack.push({type:"fragment",children:[]})}function b(kt,Ct,Rt){this.stack[this.stack.length-1].children.push(kt),this.stack.push(kt),this.tokenStack.push([Ct,Rt||void 0]),kt.position={start:point(Ct.start),end:void 0}}function _(kt){return Ct;function Ct(Rt){kt&&kt.call(this,Rt),j.call(this,Rt)}}function j(kt,Ct){const Rt=this.stack.pop(),Bt=this.tokenStack.pop();if(Bt)Bt[0].type!==kt.type&&(Ct?Ct.call(this,kt,Bt[0]):(Bt[1]||defaultOnError).call(this,kt,Bt[0]));else throw new Error("Cannot close `"+kt.type+"` ("+stringifyPosition({start:kt.start,end:kt.end})+"): it’s not open");Rt.position.end=point(kt.end)}function _e(){return toString$2(this.stack.pop())}function et(){this.data.expectingFirstListItemValue=!0}function tt(kt){if(this.data.expectingFirstListItemValue){const Ct=this.stack[this.stack.length-2];Ct.start=Number.parseInt(this.sliceSerialize(kt),10),this.data.expectingFirstListItemValue=void 0}}function nt(){const kt=this.resume(),Ct=this.stack[this.stack.length-1];Ct.lang=kt}function at(){const kt=this.resume(),Ct=this.stack[this.stack.length-1];Ct.meta=kt}function lt(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function mt(){const kt=this.resume(),Ct=this.stack[this.stack.length-1];Ct.value=kt.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function ot(){const kt=this.resume(),Ct=this.stack[this.stack.length-1];Ct.value=kt.replace(/(\r?\n|\r)$/g,"")}function st(kt){const Ct=this.resume(),Rt=this.stack[this.stack.length-1];Rt.label=Ct,Rt.identifier=normalizeIdentifier(this.sliceSerialize(kt)).toLowerCase()}function ut(){const kt=this.resume(),Ct=this.stack[this.stack.length-1];Ct.title=kt}function pt(){const kt=this.resume(),Ct=this.stack[this.stack.length-1];Ct.url=kt}function gt(kt){const Ct=this.stack[this.stack.length-1];if(!Ct.depth){const Rt=this.sliceSerialize(kt).length;Ct.depth=Rt}}function ft(){this.data.setextHeadingSlurpLineEnding=!0}function yt(kt){const Ct=this.stack[this.stack.length-1];Ct.depth=this.sliceSerialize(kt).codePointAt(0)===61?1:2}function _t(){this.data.setextHeadingSlurpLineEnding=void 0}function vt(kt){const Rt=this.stack[this.stack.length-1].children;let Bt=Rt[Rt.length-1];(!Bt||Bt.type!=="text")&&(Bt=mn(),Bt.position={start:point(kt.start),end:void 0},Rt.push(Bt)),this.stack.push(Bt)}function Pt(kt){const Ct=this.stack.pop();Ct.value+=this.sliceSerialize(kt),Ct.position.end=point(kt.end)}function Tt(kt){const Ct=this.stack[this.stack.length-1];if(this.data.atHardBreak){const Rt=Ct.children[Ct.children.length-1];Rt.position.end=point(kt.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&a.canContainEols.includes(Ct.type)&&(vt.call(this,kt),Pt.call(this,kt))}function St(){this.data.atHardBreak=!0}function qt(){const kt=this.resume(),Ct=this.stack[this.stack.length-1];Ct.value=kt}function Ft(){const kt=this.resume(),Ct=this.stack[this.stack.length-1];Ct.value=kt}function Dt(){const kt=this.resume(),Ct=this.stack[this.stack.length-1];Ct.value=kt}function zt(){const kt=this.stack[this.stack.length-1];if(this.data.inReference){const Ct=this.data.referenceType||"shortcut";kt.type+="Reference",kt.referenceType=Ct,delete kt.url,delete kt.title}else delete kt.identifier,delete kt.label;this.data.referenceType=void 0}function Nt(){const kt=this.stack[this.stack.length-1];if(this.data.inReference){const Ct=this.data.referenceType||"shortcut";kt.type+="Reference",kt.referenceType=Ct,delete kt.url,delete kt.title}else delete kt.identifier,delete kt.label;this.data.referenceType=void 0}function Et(kt){const Ct=this.sliceSerialize(kt),Rt=this.stack[this.stack.length-2];Rt.label=decodeString(Ct),Rt.identifier=normalizeIdentifier(Ct).toLowerCase()}function At(){const kt=this.stack[this.stack.length-1],Ct=this.resume(),Rt=this.stack[this.stack.length-1];if(this.data.inReference=!0,Rt.type==="link"){const Bt=kt.children;Rt.children=Bt}else Rt.alt=Ct}function dt(){const kt=this.resume(),Ct=this.stack[this.stack.length-1];Ct.url=kt}function Mt(){const kt=this.resume(),Ct=this.stack[this.stack.length-1];Ct.title=kt}function It(){this.data.inReference=void 0}function $t(){this.data.referenceType="collapsed"}function Lt(kt){const Ct=this.resume(),Rt=this.stack[this.stack.length-1];Rt.label=Ct,Rt.identifier=normalizeIdentifier(this.sliceSerialize(kt)).toLowerCase(),this.data.referenceType="full"}function Ot(kt){this.data.characterReferenceType=kt.type}function Vt(kt){const Ct=this.sliceSerialize(kt),Rt=this.data.characterReferenceType;let Bt;Rt?(Bt=decodeNumericCharacterReference(Ct,Rt==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):Bt=decodeNamedCharacterReference(Ct);const ct=this.stack[this.stack.length-1];ct.value+=Bt}function Ht(kt){const Ct=this.stack.pop();Ct.position.end=point(kt.end)}function Yt(kt){Pt.call(this,kt);const Ct=this.stack[this.stack.length-1];Ct.url=this.sliceSerialize(kt)}function Kt(kt){Pt.call(this,kt);const Ct=this.stack[this.stack.length-1];Ct.url="mailto:"+this.sliceSerialize(kt)}function Qt(){return{type:"blockquote",children:[]}}function Zt(){return{type:"code",lang:null,meta:null,value:""}}function on(){return{type:"inlineCode",value:""}}function ln(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function sn(){return{type:"emphasis",children:[]}}function rn(){return{type:"heading",depth:0,children:[]}}function Jt(){return{type:"break"}}function en(){return{type:"html",value:""}}function an(){return{type:"image",title:null,url:"",alt:null}}function nn(){return{type:"link",title:null,url:"",children:[]}}function un(kt){return{type:"list",ordered:kt.type==="listOrdered",start:null,spread:kt._spread,children:[]}}function dn(kt){return{type:"listItem",spread:kt._spread,checked:null,children:[]}}function fn(){return{type:"paragraph",children:[]}}function hn(){return{type:"strong",children:[]}}function mn(){return{type:"text",value:""}}function tn(){return{type:"thematicBreak"}}}function point(e){return{line:e.line,column:e.column,offset:e.offset}}function configure(e,a){let o=-1;for(;++o<a.length;){const c=a[o];Array.isArray(c)?configure(e,c):extension(e,c)}}function extension(e,a){let o;for(o in a)if(own$4.call(a,o))switch(o){case"canContainEols":{const c=a[o];c&&e[o].push(...c);break}case"transforms":{const c=a[o];c&&e[o].push(...c);break}case"enter":case"exit":{const c=a[o];c&&Object.assign(e[o],c);break}}}function defaultOnError(e,a){throw e?new Error("Cannot close `"+e.type+"` ("+stringifyPosition({start:e.start,end:e.end})+"): a different token (`"+a.type+"`, "+stringifyPosition({start:a.start,end:a.end})+") is open"):new Error("Cannot close document, a token (`"+a.type+"`, "+stringifyPosition({start:a.start,end:a.end})+") is still open")}function remarkParse(e){const a=this;a.parser=o;function o(c){return fromMarkdown(c,{...a.data("settings"),...e,extensions:a.data("micromarkExtensions")||[],mdastExtensions:a.data("fromMarkdownExtensions")||[]})}}function blockquote(e,a){const o={type:"element",tagName:"blockquote",properties:{},children:e.wrap(e.all(a),!0)};return e.patch(a,o),e.applyData(a,o)}function hardBreak(e,a){const o={type:"element",tagName:"br",properties:{},children:[]};return e.patch(a,o),[e.applyData(a,o),{type:"text",value:`
`}]}function code(e,a){const o=a.value?a.value+`
`:"",c={};a.lang&&(c.className=["language-"+a.lang]);let d={type:"element",tagName:"code",properties:c,children:[{type:"text",value:o}]};return a.meta&&(d.data={meta:a.meta}),e.patch(a,d),d=e.applyData(a,d),d={type:"element",tagName:"pre",properties:{},children:[d]},e.patch(a,d),d}function strikethrough(e,a){const o={type:"element",tagName:"del",properties:{},children:e.all(a)};return e.patch(a,o),e.applyData(a,o)}function emphasis(e,a){const o={type:"element",tagName:"em",properties:{},children:e.all(a)};return e.patch(a,o),e.applyData(a,o)}function footnoteReference(e,a){const o=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",c=String(a.identifier).toUpperCase(),d=normalizeUri(c.toLowerCase()),$=e.footnoteOrder.indexOf(c);let g,b=e.footnoteCounts.get(c);b===void 0?(b=0,e.footnoteOrder.push(c),g=e.footnoteOrder.length):g=$+1,b+=1,e.footnoteCounts.set(c,b);const _={type:"element",tagName:"a",properties:{href:"#"+o+"fn-"+d,id:o+"fnref-"+d+(b>1?"-"+b:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(g)}]};e.patch(a,_);const j={type:"element",tagName:"sup",properties:{},children:[_]};return e.patch(a,j),e.applyData(a,j)}function heading(e,a){const o={type:"element",tagName:"h"+a.depth,properties:{},children:e.all(a)};return e.patch(a,o),e.applyData(a,o)}function html(e,a){if(e.options.allowDangerousHtml){const o={type:"raw",value:a.value};return e.patch(a,o),e.applyData(a,o)}}function revert(e,a){const o=a.referenceType;let c="]";if(o==="collapsed"?c+="[]":o==="full"&&(c+="["+(a.label||a.identifier)+"]"),a.type==="imageReference")return[{type:"text",value:"!["+a.alt+c}];const d=e.all(a),$=d[0];$&&$.type==="text"?$.value="["+$.value:d.unshift({type:"text",value:"["});const g=d[d.length-1];return g&&g.type==="text"?g.value+=c:d.push({type:"text",value:c}),d}function imageReference(e,a){const o=String(a.identifier).toUpperCase(),c=e.definitionById.get(o);if(!c)return revert(e,a);const d={src:normalizeUri(c.url||""),alt:a.alt};c.title!==null&&c.title!==void 0&&(d.title=c.title);const $={type:"element",tagName:"img",properties:d,children:[]};return e.patch(a,$),e.applyData(a,$)}function image(e,a){const o={src:normalizeUri(a.url)};a.alt!==null&&a.alt!==void 0&&(o.alt=a.alt),a.title!==null&&a.title!==void 0&&(o.title=a.title);const c={type:"element",tagName:"img",properties:o,children:[]};return e.patch(a,c),e.applyData(a,c)}function inlineCode(e,a){const o={type:"text",value:a.value.replace(/\r?\n|\r/g," ")};e.patch(a,o);const c={type:"element",tagName:"code",properties:{},children:[o]};return e.patch(a,c),e.applyData(a,c)}function linkReference(e,a){const o=String(a.identifier).toUpperCase(),c=e.definitionById.get(o);if(!c)return revert(e,a);const d={href:normalizeUri(c.url||"")};c.title!==null&&c.title!==void 0&&(d.title=c.title);const $={type:"element",tagName:"a",properties:d,children:e.all(a)};return e.patch(a,$),e.applyData(a,$)}function link(e,a){const o={href:normalizeUri(a.url)};a.title!==null&&a.title!==void 0&&(o.title=a.title);const c={type:"element",tagName:"a",properties:o,children:e.all(a)};return e.patch(a,c),e.applyData(a,c)}function listItem(e,a,o){const c=e.all(a),d=o?listLoose(o):listItemLoose(a),$={},g=[];if(typeof a.checked=="boolean"){const _e=c[0];let et;_e&&_e.type==="element"&&_e.tagName==="p"?et=_e:(et={type:"element",tagName:"p",properties:{},children:[]},c.unshift(et)),et.children.length>0&&et.children.unshift({type:"text",value:" "}),et.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:a.checked,disabled:!0},children:[]}),$.className=["task-list-item"]}let b=-1;for(;++b<c.length;){const _e=c[b];(d||b!==0||_e.type!=="element"||_e.tagName!=="p")&&g.push({type:"text",value:`
`}),_e.type==="element"&&_e.tagName==="p"&&!d?g.push(..._e.children):g.push(_e)}const _=c[c.length-1];_&&(d||_.type!=="element"||_.tagName!=="p")&&g.push({type:"text",value:`
`});const j={type:"element",tagName:"li",properties:$,children:g};return e.patch(a,j),e.applyData(a,j)}function listLoose(e){let a=!1;if(e.type==="list"){a=e.spread||!1;const o=e.children;let c=-1;for(;!a&&++c<o.length;)a=listItemLoose(o[c])}return a}function listItemLoose(e){const a=e.spread;return a??e.children.length>1}function list(e,a){const o={},c=e.all(a);let d=-1;for(typeof a.start=="number"&&a.start!==1&&(o.start=a.start);++d<c.length;){const g=c[d];if(g.type==="element"&&g.tagName==="li"&&g.properties&&Array.isArray(g.properties.className)&&g.properties.className.includes("task-list-item")){o.className=["contains-task-list"];break}}const $={type:"element",tagName:a.ordered?"ol":"ul",properties:o,children:e.wrap(c,!0)};return e.patch(a,$),e.applyData(a,$)}function paragraph(e,a){const o={type:"element",tagName:"p",properties:{},children:e.all(a)};return e.patch(a,o),e.applyData(a,o)}function root$1(e,a){const o={type:"root",children:e.wrap(e.all(a))};return e.patch(a,o),e.applyData(a,o)}function strong(e,a){const o={type:"element",tagName:"strong",properties:{},children:e.all(a)};return e.patch(a,o),e.applyData(a,o)}function table(e,a){const o=e.all(a),c=o.shift(),d=[];if(c){const g={type:"element",tagName:"thead",properties:{},children:e.wrap([c],!0)};e.patch(a.children[0],g),d.push(g)}if(o.length>0){const g={type:"element",tagName:"tbody",properties:{},children:e.wrap(o,!0)},b=pointStart(a.children[1]),_=pointEnd(a.children[a.children.length-1]);b&&_&&(g.position={start:b,end:_}),d.push(g)}const $={type:"element",tagName:"table",properties:{},children:e.wrap(d,!0)};return e.patch(a,$),e.applyData(a,$)}function tableRow(e,a,o){const c=o?o.children:void 0,$=(c?c.indexOf(a):1)===0?"th":"td",g=o&&o.type==="table"?o.align:void 0,b=g?g.length:a.children.length;let _=-1;const j=[];for(;++_<b;){const et=a.children[_],tt={},nt=g?g[_]:void 0;nt&&(tt.align=nt);let at={type:"element",tagName:$,properties:tt,children:[]};et&&(at.children=e.all(et),e.patch(et,at),at=e.applyData(et,at)),j.push(at)}const _e={type:"element",tagName:"tr",properties:{},children:e.wrap(j,!0)};return e.patch(a,_e),e.applyData(a,_e)}function tableCell(e,a){const o={type:"element",tagName:"td",properties:{},children:e.all(a)};return e.patch(a,o),e.applyData(a,o)}const tab=9,space=32;function trimLines(e){const a=String(e),o=/\r?\n|\r/g;let c=o.exec(a),d=0;const $=[];for(;c;)$.push(trimLine(a.slice(d,c.index),d>0,!0),c[0]),d=c.index+c[0].length,c=o.exec(a);return $.push(trimLine(a.slice(d),d>0,!1)),$.join("")}function trimLine(e,a,o){let c=0,d=e.length;if(a){let $=e.codePointAt(c);for(;$===tab||$===space;)c++,$=e.codePointAt(c)}if(o){let $=e.codePointAt(d-1);for(;$===tab||$===space;)d--,$=e.codePointAt(d-1)}return d>c?e.slice(c,d):""}function text$3(e,a){const o={type:"text",value:trimLines(String(a.value))};return e.patch(a,o),e.applyData(a,o)}function thematicBreak(e,a){const o={type:"element",tagName:"hr",properties:{},children:[]};return e.patch(a,o),e.applyData(a,o)}const handlers={blockquote,break:hardBreak,code,delete:strikethrough,emphasis,footnoteReference,heading,html,imageReference,image,inlineCode,linkReference,link,listItem,list,paragraph,root:root$1,strong,table,tableCell,tableRow,text:text$3,thematicBreak,toml:ignore,yaml:ignore,definition:ignore,footnoteDefinition:ignore};function ignore(){}const VOID=-1,PRIMITIVE=0,ARRAY=1,OBJECT=2,DATE=3,REGEXP=4,MAP=5,SET=6,ERROR=7,BIGINT=8,env=typeof self=="object"?self:globalThis,deserializer=(e,a)=>{const o=(d,$)=>(e.set($,d),d),c=d=>{if(e.has(d))return e.get(d);const[$,g]=a[d];switch($){case PRIMITIVE:case VOID:return o(g,d);case ARRAY:{const b=o([],d);for(const _ of g)b.push(c(_));return b}case OBJECT:{const b=o({},d);for(const[_,j]of g)b[c(_)]=c(j);return b}case DATE:return o(new Date(g),d);case REGEXP:{const{source:b,flags:_}=g;return o(new RegExp(b,_),d)}case MAP:{const b=o(new Map,d);for(const[_,j]of g)b.set(c(_),c(j));return b}case SET:{const b=o(new Set,d);for(const _ of g)b.add(c(_));return b}case ERROR:{const{name:b,message:_}=g;return o(new env[b](_),d)}case BIGINT:return o(BigInt(g),d);case"BigInt":return o(Object(BigInt(g)),d)}return o(new env[$](g),d)};return c},deserialize=e=>deserializer(new Map,e)(0),EMPTY="",{toString:toString$1}={},{keys}=Object,typeOf=e=>{const a=typeof e;if(a!=="object"||!e)return[PRIMITIVE,a];const o=toString$1.call(e).slice(8,-1);switch(o){case"Array":return[ARRAY,EMPTY];case"Object":return[OBJECT,EMPTY];case"Date":return[DATE,EMPTY];case"RegExp":return[REGEXP,EMPTY];case"Map":return[MAP,EMPTY];case"Set":return[SET,EMPTY]}return o.includes("Array")?[ARRAY,o]:o.includes("Error")?[ERROR,o]:[OBJECT,o]},shouldSkip=([e,a])=>e===PRIMITIVE&&(a==="function"||a==="symbol"),serializer=(e,a,o,c)=>{const d=(g,b)=>{const _=c.push(g)-1;return o.set(b,_),_},$=g=>{if(o.has(g))return o.get(g);let[b,_]=typeOf(g);switch(b){case PRIMITIVE:{let _e=g;switch(_){case"bigint":b=BIGINT,_e=g.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+_);_e=null;break;case"undefined":return d([VOID],g)}return d([b,_e],g)}case ARRAY:{if(_)return d([_,[...g]],g);const _e=[],et=d([b,_e],g);for(const tt of g)_e.push($(tt));return et}case OBJECT:{if(_)switch(_){case"BigInt":return d([_,g.toString()],g);case"Boolean":case"Number":case"String":return d([_,g.valueOf()],g)}if(a&&"toJSON"in g)return $(g.toJSON());const _e=[],et=d([b,_e],g);for(const tt of keys(g))(e||!shouldSkip(typeOf(g[tt])))&&_e.push([$(tt),$(g[tt])]);return et}case DATE:return d([b,g.toISOString()],g);case REGEXP:{const{source:_e,flags:et}=g;return d([b,{source:_e,flags:et}],g)}case MAP:{const _e=[],et=d([b,_e],g);for(const[tt,nt]of g)(e||!(shouldSkip(typeOf(tt))||shouldSkip(typeOf(nt))))&&_e.push([$(tt),$(nt)]);return et}case SET:{const _e=[],et=d([b,_e],g);for(const tt of g)(e||!shouldSkip(typeOf(tt)))&&_e.push($(tt));return et}}const{message:j}=g;return d([b,{name:_,message:j}],g)};return $},serialize=(e,{json:a,lossy:o}={})=>{const c=[];return serializer(!(a||o),!!a,new Map,c)(e),c},structuredClone$1=typeof structuredClone=="function"?(e,a)=>a&&("json"in a||"lossy"in a)?deserialize(serialize(e,a)):structuredClone(e):(e,a)=>deserialize(serialize(e,a));function defaultFootnoteBackContent(e,a){const o=[{type:"text",value:"↩"}];return a>1&&o.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(a)}]}),o}function defaultFootnoteBackLabel(e,a){return"Back to reference "+(e+1)+(a>1?"-"+a:"")}function footer(e){const a=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",o=e.options.footnoteBackContent||defaultFootnoteBackContent,c=e.options.footnoteBackLabel||defaultFootnoteBackLabel,d=e.options.footnoteLabel||"Footnotes",$=e.options.footnoteLabelTagName||"h2",g=e.options.footnoteLabelProperties||{className:["sr-only"]},b=[];let _=-1;for(;++_<e.footnoteOrder.length;){const j=e.footnoteById.get(e.footnoteOrder[_]);if(!j)continue;const _e=e.all(j),et=String(j.identifier).toUpperCase(),tt=normalizeUri(et.toLowerCase());let nt=0;const at=[],lt=e.footnoteCounts.get(et);for(;lt!==void 0&&++nt<=lt;){at.length>0&&at.push({type:"text",value:" "});let st=typeof o=="string"?o:o(_,nt);typeof st=="string"&&(st={type:"text",value:st}),at.push({type:"element",tagName:"a",properties:{href:"#"+a+"fnref-"+tt+(nt>1?"-"+nt:""),dataFootnoteBackref:"",ariaLabel:typeof c=="string"?c:c(_,nt),className:["data-footnote-backref"]},children:Array.isArray(st)?st:[st]})}const mt=_e[_e.length-1];if(mt&&mt.type==="element"&&mt.tagName==="p"){const st=mt.children[mt.children.length-1];st&&st.type==="text"?st.value+=" ":mt.children.push({type:"text",value:" "}),mt.children.push(...at)}else _e.push(...at);const ot={type:"element",tagName:"li",properties:{id:a+"fn-"+tt},children:e.wrap(_e,!0)};e.patch(j,ot),b.push(ot)}if(b.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:$,properties:{...structuredClone$1(g),id:"footnote-label"},children:[{type:"text",value:d}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:e.wrap(b,!0)},{type:"text",value:`
`}]}}const convert=function(e){if(e==null)return ok;if(typeof e=="function")return castFactory$1(e);if(typeof e=="object")return Array.isArray(e)?anyFactory$1(e):propsFactory(e);if(typeof e=="string")return typeFactory(e);throw new Error("Expected function, string, or object as test")};function anyFactory$1(e){const a=[];let o=-1;for(;++o<e.length;)a[o]=convert(e[o]);return castFactory$1(c);function c(...d){let $=-1;for(;++$<a.length;)if(a[$].apply(this,d))return!0;return!1}}function propsFactory(e){const a=e;return castFactory$1(o);function o(c){const d=c;let $;for($ in e)if(d[$]!==a[$])return!1;return!0}}function typeFactory(e){return castFactory$1(a);function a(o){return o&&o.type===e}}function castFactory$1(e){return a;function a(o,c,d){return!!(looksLikeANode(o)&&e.call(this,o,typeof c=="number"?c:void 0,d||void 0))}}function ok(){return!0}function looksLikeANode(e){return e!==null&&typeof e=="object"&&"type"in e}function color(e){return e}const empty=[],CONTINUE=!0,EXIT=!1,SKIP="skip";function visitParents(e,a,o,c){let d;typeof a=="function"&&typeof o!="function"?(c=o,o=a):d=a;const $=convert(d),g=c?-1:1;b(e,void 0,[])();function b(_,j,_e){const et=_&&typeof _=="object"?_:{};if(typeof et.type=="string"){const nt=typeof et.tagName=="string"?et.tagName:typeof et.name=="string"?et.name:void 0;Object.defineProperty(tt,"name",{value:"node ("+(_.type+(nt?"<"+nt+">":""))+")"})}return tt;function tt(){let nt=empty,at,lt,mt;if((!a||$(_,j,_e[_e.length-1]||void 0))&&(nt=toResult(o(_,_e)),nt[0]===EXIT))return nt;if("children"in _&&_.children){const ot=_;if(ot.children&&nt[0]!==SKIP)for(lt=(c?ot.children.length:-1)+g,mt=_e.concat(ot);lt>-1&&lt<ot.children.length;){const st=ot.children[lt];if(at=b(st,lt,mt)(),at[0]===EXIT)return at;lt=typeof at[1]=="number"?at[1]:lt+g}}return nt}}}function toResult(e){return Array.isArray(e)?e:typeof e=="number"?[CONTINUE,e]:e==null?empty:[e]}function visit(e,a,o,c){let d,$,g;typeof a=="function"&&typeof o!="function"?($=void 0,g=a,d=o):($=a,g=o,d=c),visitParents(e,$,b,d);function b(_,j){const _e=j[j.length-1],et=_e?_e.children.indexOf(_):void 0;return g(_,et,_e)}}const own$3={}.hasOwnProperty,emptyOptions$3={};function createState(e,a){const o=a||emptyOptions$3,c=new Map,d=new Map,$=new Map,g={...handlers,...o.handlers},b={all:j,applyData,definitionById:c,footnoteById:d,footnoteCounts:$,footnoteOrder:[],handlers:g,one:_,options:o,patch,wrap:wrap$1};return visit(e,function(_e){if(_e.type==="definition"||_e.type==="footnoteDefinition"){const et=_e.type==="definition"?c:d,tt=String(_e.identifier).toUpperCase();et.has(tt)||et.set(tt,_e)}}),b;function _(_e,et){const tt=_e.type,nt=b.handlers[tt];if(own$3.call(b.handlers,tt)&&nt)return nt(b,_e,et);if(b.options.passThrough&&b.options.passThrough.includes(tt)){if("children"in _e){const{children:lt,...mt}=_e,ot=structuredClone$1(mt);return ot.children=b.all(_e),ot}return structuredClone$1(_e)}return(b.options.unknownHandler||defaultUnknownHandler)(b,_e,et)}function j(_e){const et=[];if("children"in _e){const tt=_e.children;let nt=-1;for(;++nt<tt.length;){const at=b.one(tt[nt],_e);if(at){if(nt&&tt[nt-1].type==="break"&&(!Array.isArray(at)&&at.type==="text"&&(at.value=trimMarkdownSpaceStart(at.value)),!Array.isArray(at)&&at.type==="element")){const lt=at.children[0];lt&&lt.type==="text"&&(lt.value=trimMarkdownSpaceStart(lt.value))}Array.isArray(at)?et.push(...at):et.push(at)}}}return et}}function patch(e,a){e.position&&(a.position=position$1(e))}function applyData(e,a){let o=a;if(e&&e.data){const c=e.data.hName,d=e.data.hChildren,$=e.data.hProperties;if(typeof c=="string")if(o.type==="element")o.tagName=c;else{const g="children"in o?o.children:[o];o={type:"element",tagName:c,properties:{},children:g}}o.type==="element"&&$&&Object.assign(o.properties,structuredClone$1($)),"children"in o&&o.children&&d!==null&&d!==void 0&&(o.children=d)}return o}function defaultUnknownHandler(e,a){const o=a.data||{},c="value"in a&&!(own$3.call(o,"hProperties")||own$3.call(o,"hChildren"))?{type:"text",value:a.value}:{type:"element",tagName:"div",properties:{},children:e.all(a)};return e.patch(a,c),e.applyData(a,c)}function wrap$1(e,a){const o=[];let c=-1;for(a&&o.push({type:"text",value:`
`});++c<e.length;)c&&o.push({type:"text",value:`
`}),o.push(e[c]);return a&&e.length>0&&o.push({type:"text",value:`
`}),o}function trimMarkdownSpaceStart(e){let a=0,o=e.charCodeAt(a);for(;o===9||o===32;)a++,o=e.charCodeAt(a);return e.slice(a)}function toHast(e,a){const o=createState(e,a),c=o.one(e,void 0),d=footer(o),$=Array.isArray(c)?{type:"root",children:c}:c||{type:"root",children:[]};return d&&$.children.push({type:"text",value:`
`},d),$}function remarkRehype(e,a){return e&&"run"in e?async function(o,c){const d=toHast(o,{file:c,...a});await e.run(d,c)}:function(o,c){return toHast(o,{file:c,...e||a})}}function bail(e){if(e)throw e}var hasOwn=Object.prototype.hasOwnProperty,toStr=Object.prototype.toString,defineProperty=Object.defineProperty,gOPD=Object.getOwnPropertyDescriptor,isArray=function e(a){return typeof Array.isArray=="function"?Array.isArray(a):toStr.call(a)==="[object Array]"},isPlainObject$1=function e(a){if(!a||toStr.call(a)!=="[object Object]")return!1;var o=hasOwn.call(a,"constructor"),c=a.constructor&&a.constructor.prototype&&hasOwn.call(a.constructor.prototype,"isPrototypeOf");if(a.constructor&&!o&&!c)return!1;var d;for(d in a);return typeof d>"u"||hasOwn.call(a,d)},setProperty=function e(a,o){defineProperty&&o.name==="__proto__"?defineProperty(a,o.name,{enumerable:!0,configurable:!0,value:o.newValue,writable:!0}):a[o.name]=o.newValue},getProperty=function e(a,o){if(o==="__proto__")if(hasOwn.call(a,o)){if(gOPD)return gOPD(a,o).value}else return;return a[o]},extend=function e(){var a,o,c,d,$,g,b=arguments[0],_=1,j=arguments.length,_e=!1;for(typeof b=="boolean"&&(_e=b,b=arguments[1]||{},_=2),(b==null||typeof b!="object"&&typeof b!="function")&&(b={});_<j;++_)if(a=arguments[_],a!=null)for(o in a)c=getProperty(b,o),d=getProperty(a,o),b!==d&&(_e&&d&&(isPlainObject$1(d)||($=isArray(d)))?($?($=!1,g=c&&isArray(c)?c:[]):g=c&&isPlainObject$1(c)?c:{},setProperty(b,{name:o,newValue:e(_e,g,d)})):typeof d<"u"&&setProperty(b,{name:o,newValue:d}));return b};const extend$1=getDefaultExportFromCjs(extend);function isPlainObject(e){if(typeof e!="object"||e===null)return!1;const a=Object.getPrototypeOf(e);return(a===null||a===Object.prototype||Object.getPrototypeOf(a)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function trough(){const e=[],a={run:o,use:c};return a;function o(...d){let $=-1;const g=d.pop();if(typeof g!="function")throw new TypeError("Expected function as last argument, not "+g);b(null,...d);function b(_,...j){const _e=e[++$];let et=-1;if(_){g(_);return}for(;++et<d.length;)(j[et]===null||j[et]===void 0)&&(j[et]=d[et]);d=j,_e?wrap(_e,b)(...j):g(null,...j)}}function c(d){if(typeof d!="function")throw new TypeError("Expected `middelware` to be a function, not "+d);return e.push(d),a}}function wrap(e,a){let o;return c;function c(...g){const b=e.length>g.length;let _;b&&g.push(d);try{_=e.apply(this,g)}catch(j){const _e=j;if(b&&o)throw _e;return d(_e)}b||(_&&_.then&&typeof _.then=="function"?_.then($,d):_ instanceof Error?d(_):$(_))}function d(g,...b){o||(o=!0,a(g,...b))}function $(g){d(null,g)}}const minpath={basename,dirname,extname,join,sep:"/"};function basename(e,a){if(a!==void 0&&typeof a!="string")throw new TypeError('"ext" argument must be a string');assertPath$1(e);let o=0,c=-1,d=e.length,$;if(a===void 0||a.length===0||a.length>e.length){for(;d--;)if(e.codePointAt(d)===47){if($){o=d+1;break}}else c<0&&($=!0,c=d+1);return c<0?"":e.slice(o,c)}if(a===e)return"";let g=-1,b=a.length-1;for(;d--;)if(e.codePointAt(d)===47){if($){o=d+1;break}}else g<0&&($=!0,g=d+1),b>-1&&(e.codePointAt(d)===a.codePointAt(b--)?b<0&&(c=d):(b=-1,c=g));return o===c?c=g:c<0&&(c=e.length),e.slice(o,c)}function dirname(e){if(assertPath$1(e),e.length===0)return".";let a=-1,o=e.length,c;for(;--o;)if(e.codePointAt(o)===47){if(c){a=o;break}}else c||(c=!0);return a<0?e.codePointAt(0)===47?"/":".":a===1&&e.codePointAt(0)===47?"//":e.slice(0,a)}function extname(e){assertPath$1(e);let a=e.length,o=-1,c=0,d=-1,$=0,g;for(;a--;){const b=e.codePointAt(a);if(b===47){if(g){c=a+1;break}continue}o<0&&(g=!0,o=a+1),b===46?d<0?d=a:$!==1&&($=1):d>-1&&($=-1)}return d<0||o<0||$===0||$===1&&d===o-1&&d===c+1?"":e.slice(d,o)}function join(...e){let a=-1,o;for(;++a<e.length;)assertPath$1(e[a]),e[a]&&(o=o===void 0?e[a]:o+"/"+e[a]);return o===void 0?".":normalize(o)}function normalize(e){assertPath$1(e);const a=e.codePointAt(0)===47;let o=normalizeString(e,!a);return o.length===0&&!a&&(o="."),o.length>0&&e.codePointAt(e.length-1)===47&&(o+="/"),a?"/"+o:o}function normalizeString(e,a){let o="",c=0,d=-1,$=0,g=-1,b,_;for(;++g<=e.length;){if(g<e.length)b=e.codePointAt(g);else{if(b===47)break;b=47}if(b===47){if(!(d===g-1||$===1))if(d!==g-1&&$===2){if(o.length<2||c!==2||o.codePointAt(o.length-1)!==46||o.codePointAt(o.length-2)!==46){if(o.length>2){if(_=o.lastIndexOf("/"),_!==o.length-1){_<0?(o="",c=0):(o=o.slice(0,_),c=o.length-1-o.lastIndexOf("/")),d=g,$=0;continue}}else if(o.length>0){o="",c=0,d=g,$=0;continue}}a&&(o=o.length>0?o+"/..":"..",c=2)}else o.length>0?o+="/"+e.slice(d+1,g):o=e.slice(d+1,g),c=g-d-1;d=g,$=0}else b===46&&$>-1?$++:$=-1}return o}function assertPath$1(e){if(typeof e!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}const minproc={cwd};function cwd(){return"/"}function isUrl(e){return!!(e!==null&&typeof e=="object"&&"href"in e&&e.href&&"protocol"in e&&e.protocol&&e.auth===void 0)}function urlToPath(e){if(typeof e=="string")e=new URL(e);else if(!isUrl(e)){const a=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw a.code="ERR_INVALID_ARG_TYPE",a}if(e.protocol!=="file:"){const a=new TypeError("The URL must be of scheme file");throw a.code="ERR_INVALID_URL_SCHEME",a}return getPathFromURLPosix(e)}function getPathFromURLPosix(e){if(e.hostname!==""){const c=new TypeError('File URL host must be "localhost" or empty on darwin');throw c.code="ERR_INVALID_FILE_URL_HOST",c}const a=e.pathname;let o=-1;for(;++o<a.length;)if(a.codePointAt(o)===37&&a.codePointAt(o+1)===50){const c=a.codePointAt(o+2);if(c===70||c===102){const d=new TypeError("File URL path must not include encoded / characters");throw d.code="ERR_INVALID_FILE_URL_PATH",d}}return decodeURIComponent(a)}const order=["history","path","basename","stem","extname","dirname"];class VFile{constructor(a){let o;a?isUrl(a)?o={path:a}:typeof a=="string"||isUint8Array$1(a)?o={value:a}:o=a:o={},this.cwd="cwd"in o?"":minproc.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let c=-1;for(;++c<order.length;){const $=order[c];$ in o&&o[$]!==void 0&&o[$]!==null&&(this[$]=$==="history"?[...o[$]]:o[$])}let d;for(d in o)order.includes(d)||(this[d]=o[d])}get basename(){return typeof this.path=="string"?minpath.basename(this.path):void 0}set basename(a){assertNonEmpty(a,"basename"),assertPart(a,"basename"),this.path=minpath.join(this.dirname||"",a)}get dirname(){return typeof this.path=="string"?minpath.dirname(this.path):void 0}set dirname(a){assertPath(this.basename,"dirname"),this.path=minpath.join(a||"",this.basename)}get extname(){return typeof this.path=="string"?minpath.extname(this.path):void 0}set extname(a){if(assertPart(a,"extname"),assertPath(this.dirname,"extname"),a){if(a.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(a.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=minpath.join(this.dirname,this.stem+(a||""))}get path(){return this.history[this.history.length-1]}set path(a){isUrl(a)&&(a=urlToPath(a)),assertNonEmpty(a,"path"),this.path!==a&&this.history.push(a)}get stem(){return typeof this.path=="string"?minpath.basename(this.path,this.extname):void 0}set stem(a){assertNonEmpty(a,"stem"),assertPart(a,"stem"),this.path=minpath.join(this.dirname||"",a+(this.extname||""))}fail(a,o,c){const d=this.message(a,o,c);throw d.fatal=!0,d}info(a,o,c){const d=this.message(a,o,c);return d.fatal=void 0,d}message(a,o,c){const d=new VFileMessage(a,o,c);return this.path&&(d.name=this.path+":"+d.name,d.file=this.path),d.fatal=!1,this.messages.push(d),d}toString(a){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(a||void 0).decode(this.value)}}function assertPart(e,a){if(e&&e.includes(minpath.sep))throw new Error("`"+a+"` cannot be a path: did not expect `"+minpath.sep+"`")}function assertNonEmpty(e,a){if(!e)throw new Error("`"+a+"` cannot be empty")}function assertPath(e,a){if(!e)throw new Error("Setting `"+a+"` requires `path` to be set too")}function isUint8Array$1(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}const CallableInstance=function(e){const c=this.constructor.prototype,d=c[e],$=function(){return d.apply($,arguments)};return Object.setPrototypeOf($,c),$},own$2={}.hasOwnProperty;class Processor extends CallableInstance{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=trough()}copy(){const a=new Processor;let o=-1;for(;++o<this.attachers.length;){const c=this.attachers[o];a.use(...c)}return a.data(extend$1(!0,{},this.namespace)),a}data(a,o){return typeof a=="string"?arguments.length===2?(assertUnfrozen("data",this.frozen),this.namespace[a]=o,this):own$2.call(this.namespace,a)&&this.namespace[a]||void 0:a?(assertUnfrozen("data",this.frozen),this.namespace=a,this):this.namespace}freeze(){if(this.frozen)return this;const a=this;for(;++this.freezeIndex<this.attachers.length;){const[o,...c]=this.attachers[this.freezeIndex];if(c[0]===!1)continue;c[0]===!0&&(c[0]=void 0);const d=o.call(a,...c);typeof d=="function"&&this.transformers.use(d)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(a){this.freeze();const o=vfile(a),c=this.parser||this.Parser;return assertParser("parse",c),c(String(o),o)}process(a,o){const c=this;return this.freeze(),assertParser("process",this.parser||this.Parser),assertCompiler("process",this.compiler||this.Compiler),o?d(void 0,o):new Promise(d);function d($,g){const b=vfile(a),_=c.parse(b);c.run(_,b,function(_e,et,tt){if(_e||!et||!tt)return j(_e);const nt=et,at=c.stringify(nt,tt);looksLikeAValue(at)?tt.value=at:tt.result=at,j(_e,tt)});function j(_e,et){_e||!et?g(_e):$?$(et):o(void 0,et)}}}processSync(a){let o=!1,c;return this.freeze(),assertParser("processSync",this.parser||this.Parser),assertCompiler("processSync",this.compiler||this.Compiler),this.process(a,d),assertDone("processSync","process",o),c;function d($,g){o=!0,bail($),c=g}}run(a,o,c){assertNode(a),this.freeze();const d=this.transformers;return!c&&typeof o=="function"&&(c=o,o=void 0),c?$(void 0,c):new Promise($);function $(g,b){const _=vfile(o);d.run(a,_,j);function j(_e,et,tt){const nt=et||a;_e?b(_e):g?g(nt):c(void 0,nt,tt)}}}runSync(a,o){let c=!1,d;return this.run(a,o,$),assertDone("runSync","run",c),d;function $(g,b){bail(g),d=b,c=!0}}stringify(a,o){this.freeze();const c=vfile(o),d=this.compiler||this.Compiler;return assertCompiler("stringify",d),assertNode(a),d(a,c)}use(a,...o){const c=this.attachers,d=this.namespace;if(assertUnfrozen("use",this.frozen),a!=null)if(typeof a=="function")_(a,o);else if(typeof a=="object")Array.isArray(a)?b(a):g(a);else throw new TypeError("Expected usable value, not `"+a+"`");return this;function $(j){if(typeof j=="function")_(j,[]);else if(typeof j=="object")if(Array.isArray(j)){const[_e,...et]=j;_(_e,et)}else g(j);else throw new TypeError("Expected usable value, not `"+j+"`")}function g(j){if(!("plugins"in j)&&!("settings"in j))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");b(j.plugins),j.settings&&(d.settings=extend$1(!0,d.settings,j.settings))}function b(j){let _e=-1;if(j!=null)if(Array.isArray(j))for(;++_e<j.length;){const et=j[_e];$(et)}else throw new TypeError("Expected a list of plugins, not `"+j+"`")}function _(j,_e){let et=-1,tt=-1;for(;++et<c.length;)if(c[et][0]===j){tt=et;break}if(tt===-1)c.push([j,..._e]);else if(_e.length>0){let[nt,...at]=_e;const lt=c[tt][1];isPlainObject(lt)&&isPlainObject(nt)&&(nt=extend$1(!0,lt,nt)),c[tt]=[j,nt,...at]}}}}const unified=new Processor().freeze();function assertParser(e,a){if(typeof a!="function")throw new TypeError("Cannot `"+e+"` without `parser`")}function assertCompiler(e,a){if(typeof a!="function")throw new TypeError("Cannot `"+e+"` without `compiler`")}function assertUnfrozen(e,a){if(a)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function assertNode(e){if(!isPlainObject(e)||typeof e.type!="string")throw new TypeError("Expected node, got `"+e+"`")}function assertDone(e,a,o){if(!o)throw new Error("`"+e+"` finished async. Use `"+a+"` instead")}function vfile(e){return looksLikeAVFile(e)?e:new VFile(e)}function looksLikeAVFile(e){return!!(e&&typeof e=="object"&&"message"in e&&"messages"in e)}function looksLikeAValue(e){return typeof e=="string"||isUint8Array(e)}function isUint8Array(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}const changelog="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",emptyPlugins=[],emptyRemarkRehypeOptions={allowDangerousHtml:!0},safeProtocol=/^(https?|ircs?|mailto|xmpp)$/i,deprecations=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function Markdown(e){const a=e.allowedElements,o=e.allowElement,c=e.children||"",d=e.className,$=e.components,g=e.disallowedElements,b=e.rehypePlugins||emptyPlugins,_=e.remarkPlugins||emptyPlugins,j=e.remarkRehypeOptions?{...e.remarkRehypeOptions,...emptyRemarkRehypeOptions}:emptyRemarkRehypeOptions,_e=e.skipHtml,et=e.unwrapDisallowed,tt=e.urlTransform||defaultUrlTransform,nt=unified().use(remarkParse).use(_).use(remarkRehype,j).use(b),at=new VFile;typeof c=="string"&&(at.value=c);for(const st of deprecations)Object.hasOwn(e,st.from)&&(""+st.from+(st.to?"use `"+st.to+"` instead":"remove it")+changelog+st.id,void 0);const lt=nt.parse(at);let mt=nt.runSync(lt,at);return d&&(mt={type:"element",tagName:"div",properties:{className:d},children:mt.type==="root"?mt.children:[mt]}),visit(mt,ot),toJsxRuntime(mt,{Fragment:jsxRuntimeExports.Fragment,components:$,ignoreInvalidStyle:!0,jsx:jsxRuntimeExports.jsx,jsxs:jsxRuntimeExports.jsxs,passKeys:!0,passNode:!0});function ot(st,ut,pt){if(st.type==="raw"&&pt&&typeof ut=="number")return _e?pt.children.splice(ut,1):pt.children[ut]={type:"text",value:st.value},ut;if(st.type==="element"){let gt;for(gt in urlAttributes)if(Object.hasOwn(urlAttributes,gt)&&Object.hasOwn(st.properties,gt)){const ft=st.properties[gt],yt=urlAttributes[gt];(yt===null||yt.includes(st.tagName))&&(st.properties[gt]=tt(String(ft||""),gt,st))}}if(st.type==="element"){let gt=a?!a.includes(st.tagName):g?g.includes(st.tagName):!1;if(!gt&&o&&typeof ut=="number"&&(gt=!o(st,ut,pt)),gt&&pt&&typeof ut=="number")return et&&st.children?pt.children.splice(ut,1,...st.children):pt.children.splice(ut,1),ut}}}function defaultUrlTransform(e){const a=e.indexOf(":"),o=e.indexOf("?"),c=e.indexOf("#"),d=e.indexOf("/");return a<0||d>-1&&a>d||o>-1&&a>o||c>-1&&a>c||safeProtocol.test(e.slice(0,a))?e:""}function longestStreak(e,a){const o=String(e);let c=o.indexOf(a),d=c,$=0,g=0;for(;c!==-1;)c===d?++$>g&&(g=$):$=1,d=c+a.length,c=o.indexOf(a,d);return g}function mathFromMarkdown(){return{enter:{mathFlow:e,mathFlowFenceMeta:a,mathText:$},exit:{mathFlow:d,mathFlowFence:c,mathFlowFenceMeta:o,mathFlowValue:b,mathText:g,mathTextData:b}};function e(_){const j={type:"element",tagName:"code",properties:{className:["language-math","math-display"]},children:[]};this.enter({type:"math",meta:null,value:"",data:{hName:"pre",hChildren:[j]}},_)}function a(){this.buffer()}function o(){const _=this.resume(),j=this.stack[this.stack.length-1];j.type,j.meta=_}function c(){this.data.mathFlowInside||(this.buffer(),this.data.mathFlowInside=!0)}function d(_){const j=this.resume().replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),_e=this.stack[this.stack.length-1];_e.type,this.exit(_),_e.value=j;const et=_e.data.hChildren[0];et.type,et.tagName,et.children.push({type:"text",value:j}),this.data.mathFlowInside=void 0}function $(_){this.enter({type:"inlineMath",value:"",data:{hName:"code",hProperties:{className:["language-math","math-inline"]},hChildren:[]}},_),this.buffer()}function g(_){const j=this.resume(),_e=this.stack[this.stack.length-1];_e.type,this.exit(_),_e.value=j,_e.data.hChildren.push({type:"text",value:j})}function b(_){this.config.enter.data.call(this,_),this.config.exit.data.call(this,_)}}function mathToMarkdown(e){let a=(e||{}).singleDollarTextMath;return a==null&&(a=!0),c.peek=d,{unsafe:[{character:"\r",inConstruct:"mathFlowMeta"},{character:`
`,inConstruct:"mathFlowMeta"},{character:"$",after:a?void 0:"\\$",inConstruct:"phrasing"},{character:"$",inConstruct:"mathFlowMeta"},{atBreak:!0,character:"$",after:"\\$"}],handlers:{math:o,inlineMath:c}};function o($,g,b,_){const j=$.value||"",_e=b.createTracker(_),et="$".repeat(Math.max(longestStreak(j,"$")+1,2)),tt=b.enter("mathFlow");let nt=_e.move(et);if($.meta){const at=b.enter("mathFlowMeta");nt+=_e.move(b.safe($.meta,{after:`
`,before:nt,encode:["$"],..._e.current()})),at()}return nt+=_e.move(`
`),j&&(nt+=_e.move(j+`
`)),nt+=_e.move(et),tt(),nt}function c($,g,b){let _=$.value||"",j=1;for(a||j++;new RegExp("(^|[^$])"+"\\$".repeat(j)+"([^$]|$)").test(_);)j++;const _e="$".repeat(j);/[^ \r\n]/.test(_)&&(/^[ \r\n]/.test(_)&&/[ \r\n]$/.test(_)||/^\$|\$$/.test(_))&&(_=" "+_+" ");let et=-1;for(;++et<b.unsafe.length;){const tt=b.unsafe[et];if(!tt.atBreak)continue;const nt=b.compilePattern(tt);let at;for(;at=nt.exec(_);){let lt=at.index;_.codePointAt(lt)===10&&_.codePointAt(lt-1)===13&&lt--,_=_.slice(0,lt)+" "+_.slice(at.index+1)}}return _e+_+_e}function d(){return"$"}}const mathFlow={tokenize:tokenizeMathFenced,concrete:!0,name:"mathFlow"},nonLazyContinuation={tokenize:tokenizeNonLazyContinuation,partial:!0};function tokenizeMathFenced(e,a,o){const c=this,d=c.events[c.events.length-1],$=d&&d[1].type==="linePrefix"?d[2].sliceSerialize(d[1],!0).length:0;let g=0;return b;function b(st){return e.enter("mathFlow"),e.enter("mathFlowFence"),e.enter("mathFlowFenceSequence"),_(st)}function _(st){return st===36?(e.consume(st),g++,_):g<2?o(st):(e.exit("mathFlowFenceSequence"),factorySpace(e,j,"whitespace")(st))}function j(st){return st===null||markdownLineEnding(st)?et(st):(e.enter("mathFlowFenceMeta"),e.enter("chunkString",{contentType:"string"}),_e(st))}function _e(st){return st===null||markdownLineEnding(st)?(e.exit("chunkString"),e.exit("mathFlowFenceMeta"),et(st)):st===36?o(st):(e.consume(st),_e)}function et(st){return e.exit("mathFlowFence"),c.interrupt?a(st):e.attempt(nonLazyContinuation,tt,mt)(st)}function tt(st){return e.attempt({tokenize:ot,partial:!0},mt,nt)(st)}function nt(st){return($?factorySpace(e,at,"linePrefix",$+1):at)(st)}function at(st){return st===null?mt(st):markdownLineEnding(st)?e.attempt(nonLazyContinuation,tt,mt)(st):(e.enter("mathFlowValue"),lt(st))}function lt(st){return st===null||markdownLineEnding(st)?(e.exit("mathFlowValue"),at(st)):(e.consume(st),lt)}function mt(st){return e.exit("mathFlow"),a(st)}function ot(st,ut,pt){let gt=0;return factorySpace(st,ft,"linePrefix",c.parser.constructs.disable.null.includes("codeIndented")?void 0:4);function ft(vt){return st.enter("mathFlowFence"),st.enter("mathFlowFenceSequence"),yt(vt)}function yt(vt){return vt===36?(gt++,st.consume(vt),yt):gt<g?pt(vt):(st.exit("mathFlowFenceSequence"),factorySpace(st,_t,"whitespace")(vt))}function _t(vt){return vt===null||markdownLineEnding(vt)?(st.exit("mathFlowFence"),ut(vt)):pt(vt)}}}function tokenizeNonLazyContinuation(e,a,o){const c=this;return d;function d(g){return g===null?a(g):(e.enter("lineEnding"),e.consume(g),e.exit("lineEnding"),$)}function $(g){return c.parser.lazy[c.now().line]?o(g):a(g)}}function mathText(e){let o=(e||{}).singleDollarTextMath;return o==null&&(o=!0),{tokenize:c,resolve:resolveMathText,previous,name:"mathText"};function c(d,$,g){let b=0,_,j;return _e;function _e(lt){return d.enter("mathText"),d.enter("mathTextSequence"),et(lt)}function et(lt){return lt===36?(d.consume(lt),b++,et):b<2&&!o?g(lt):(d.exit("mathTextSequence"),tt(lt))}function tt(lt){return lt===null?g(lt):lt===36?(j=d.enter("mathTextSequence"),_=0,at(lt)):lt===32?(d.enter("space"),d.consume(lt),d.exit("space"),tt):markdownLineEnding(lt)?(d.enter("lineEnding"),d.consume(lt),d.exit("lineEnding"),tt):(d.enter("mathTextData"),nt(lt))}function nt(lt){return lt===null||lt===32||lt===36||markdownLineEnding(lt)?(d.exit("mathTextData"),tt(lt)):(d.consume(lt),nt)}function at(lt){return lt===36?(d.consume(lt),_++,at):_===b?(d.exit("mathTextSequence"),d.exit("mathText"),$(lt)):(j.type="mathTextData",nt(lt))}}}function resolveMathText(e){let a=e.length-4,o=3,c,d;if((e[o][1].type==="lineEnding"||e[o][1].type==="space")&&(e[a][1].type==="lineEnding"||e[a][1].type==="space")){for(c=o;++c<a;)if(e[c][1].type==="mathTextData"){e[a][1].type="mathTextPadding",e[o][1].type="mathTextPadding",o+=2,a-=2;break}}for(c=o-1,a++;++c<=a;)d===void 0?c!==a&&e[c][1].type!=="lineEnding"&&(d=c):(c===a||e[c][1].type==="lineEnding")&&(e[d][1].type="mathTextData",c!==d+2&&(e[d][1].end=e[c-1][1].end,e.splice(d+2,c-d-2),a-=c-d-2,c=d+2),d=void 0);return e}function previous(e){return e!==36||this.events[this.events.length-1][1].type==="characterEscape"}function math$1(e){return{flow:{36:mathFlow},text:{36:mathText(e)}}}class SourceLocation{constructor(a,o,c){this.lexer=void 0,this.start=void 0,this.end=void 0,this.lexer=a,this.start=o,this.end=c}static range(a,o){return o?!a||!a.loc||!o.loc||a.loc.lexer!==o.loc.lexer?null:new SourceLocation(a.loc.lexer,a.loc.start,o.loc.end):a&&a.loc}}class Token{constructor(a,o){this.text=void 0,this.loc=void 0,this.noexpand=void 0,this.treatAsRelax=void 0,this.text=a,this.loc=o}range(a,o){return new Token(o,SourceLocation.range(this,a))}}class ParseError{constructor(a,o){this.name=void 0,this.position=void 0,this.length=void 0,this.rawMessage=void 0;var c="KaTeX parse error: "+a,d,$,g=o&&o.loc;if(g&&g.start<=g.end){var b=g.lexer.input;d=g.start,$=g.end,d===b.length?c+=" at end of input: ":c+=" at position "+(d+1)+": ";var _=b.slice(d,$).replace(/[^]/g,"$&̲"),j;d>15?j="…"+b.slice(d-15,d):j=b.slice(0,d);var _e;$+15<b.length?_e=b.slice($,$+15)+"…":_e=b.slice($),c+=j+_+_e}var et=new Error(c);return et.name="ParseError",et.__proto__=ParseError.prototype,et.position=d,d!=null&&$!=null&&(et.length=$-d),et.rawMessage=a,et}}ParseError.prototype.__proto__=Error.prototype;var contains=function e(a,o){return a.indexOf(o)!==-1},deflt=function e(a,o){return a===void 0?o:a},uppercase=/([A-Z])/g,hyphenate=function e(a){return a.replace(uppercase,"-$1").toLowerCase()},ESCAPE_LOOKUP={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},ESCAPE_REGEX=/[&><"']/g;function escape(e){return String(e).replace(ESCAPE_REGEX,a=>ESCAPE_LOOKUP[a])}var getBaseElem=function e(a){return a.type==="ordgroup"||a.type==="color"?a.body.length===1?e(a.body[0]):a:a.type==="font"?e(a.body):a},isCharacterBox=function e(a){var o=getBaseElem(a);return o.type==="mathord"||o.type==="textord"||o.type==="atom"},assert=function e(a){if(!a)throw new Error("Expected non-null, but got "+String(a));return a},protocolFromUrl=function e(a){var o=/^[\x00-\x20]*([^\\/#?]*?)(:|&#0*58|&#x0*3a|&colon)/i.exec(a);return o?o[2]!==":"||!/^[a-zA-Z][a-zA-Z0-9+\-.]*$/.test(o[1])?null:o[1].toLowerCase():"_relative"},utils={contains,deflt,escape,hyphenate,getBaseElem,isCharacterBox,protocolFromUrl},SETTINGS_SCHEMA={displayMode:{type:"boolean",description:"Render math in display mode, which puts the math in display style (so \\int and \\sum are large, for example), and centers the math on the page on its own line.",cli:"-d, --display-mode"},output:{type:{enum:["htmlAndMathml","html","mathml"]},description:"Determines the markup language of the output.",cli:"-F, --format <type>"},leqno:{type:"boolean",description:"Render display math in leqno style (left-justified tags)."},fleqn:{type:"boolean",description:"Render display math flush left."},throwOnError:{type:"boolean",default:!0,cli:"-t, --no-throw-on-error",cliDescription:"Render errors (in the color given by --error-color) instead of throwing a ParseError exception when encountering an error."},errorColor:{type:"string",default:"#cc0000",cli:"-c, --error-color <color>",cliDescription:"A color string given in the format 'rgb' or 'rrggbb' (no #). This option determines the color of errors rendered by the -t option.",cliProcessor:e=>"#"+e},macros:{type:"object",cli:"-m, --macro <def>",cliDescription:"Define custom macro of the form '\\foo:expansion' (use multiple -m arguments for multiple macros).",cliDefault:[],cliProcessor:(e,a)=>(a.push(e),a)},minRuleThickness:{type:"number",description:"Specifies a minimum thickness, in ems, for fraction lines, `\\sqrt` top lines, `{array}` vertical lines, `\\hline`, `\\hdashline`, `\\underline`, `\\overline`, and the borders of `\\fbox`, `\\boxed`, and `\\fcolorbox`.",processor:e=>Math.max(0,e),cli:"--min-rule-thickness <size>",cliProcessor:parseFloat},colorIsTextColor:{type:"boolean",description:"Makes \\color behave like LaTeX's 2-argument \\textcolor, instead of LaTeX's one-argument \\color mode change.",cli:"-b, --color-is-text-color"},strict:{type:[{enum:["warn","ignore","error"]},"boolean","function"],description:"Turn on strict / LaTeX faithfulness mode, which throws an error if the input uses features that are not supported by LaTeX.",cli:"-S, --strict",cliDefault:!1},trust:{type:["boolean","function"],description:"Trust the input, enabling all HTML features such as \\url.",cli:"-T, --trust"},maxSize:{type:"number",default:1/0,description:"If non-zero, all user-specified sizes, e.g. in \\rule{500em}{500em}, will be capped to maxSize ems. Otherwise, elements and spaces can be arbitrarily large",processor:e=>Math.max(0,e),cli:"-s, --max-size <n>",cliProcessor:parseInt},maxExpand:{type:"number",default:1e3,description:"Limit the number of macro expansions to the specified number, to prevent e.g. infinite macro loops. If set to Infinity, the macro expander will try to fully expand as in LaTeX.",processor:e=>Math.max(0,e),cli:"-e, --max-expand <n>",cliProcessor:e=>e==="Infinity"?1/0:parseInt(e)},globalGroup:{type:"boolean",cli:!1}};function getDefaultValue(e){if(e.default)return e.default;var a=e.type,o=Array.isArray(a)?a[0]:a;if(typeof o!="string")return o.enum[0];switch(o){case"boolean":return!1;case"string":return"";case"number":return 0;case"object":return{}}}class Settings{constructor(a){this.displayMode=void 0,this.output=void 0,this.leqno=void 0,this.fleqn=void 0,this.throwOnError=void 0,this.errorColor=void 0,this.macros=void 0,this.minRuleThickness=void 0,this.colorIsTextColor=void 0,this.strict=void 0,this.trust=void 0,this.maxSize=void 0,this.maxExpand=void 0,this.globalGroup=void 0,a=a||{};for(var o in SETTINGS_SCHEMA)if(SETTINGS_SCHEMA.hasOwnProperty(o)){var c=SETTINGS_SCHEMA[o];this[o]=a[o]!==void 0?c.processor?c.processor(a[o]):a[o]:getDefaultValue(c)}}reportNonstrict(a,o,c){var d=this.strict;if(typeof d=="function"&&(d=d(a,o,c)),!(!d||d==="ignore")){if(d===!0||d==="error")throw new ParseError("LaTeX-incompatible input and strict mode is set to 'error': "+(o+" ["+a+"]"),c);d==="warn"?typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(o+" ["+a+"]")):typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+d+"': "+o+" ["+a+"]"))}}useStrictBehavior(a,o,c){var d=this.strict;if(typeof d=="function")try{d=d(a,o,c)}catch{d="error"}return!d||d==="ignore"?!1:d===!0||d==="error"?!0:d==="warn"?(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(o+" ["+a+"]")),!1):(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+d+"': "+o+" ["+a+"]")),!1)}isTrusted(a){if(a.url&&!a.protocol){var o=utils.protocolFromUrl(a.url);if(o==null)return!1;a.protocol=o}var c=typeof this.trust=="function"?this.trust(a):this.trust;return!!c}}class Style{constructor(a,o,c){this.id=void 0,this.size=void 0,this.cramped=void 0,this.id=a,this.size=o,this.cramped=c}sup(){return styles[sup[this.id]]}sub(){return styles[sub[this.id]]}fracNum(){return styles[fracNum[this.id]]}fracDen(){return styles[fracDen[this.id]]}cramp(){return styles[cramp[this.id]]}text(){return styles[text$1[this.id]]}isTight(){return this.size>=2}}var D=0,Dc=1,T=2,Tc=3,S=4,Sc=5,SS=6,SSc=7,styles=[new Style(D,0,!1),new Style(Dc,0,!0),new Style(T,1,!1),new Style(Tc,1,!0),new Style(S,2,!1),new Style(Sc,2,!0),new Style(SS,3,!1),new Style(SSc,3,!0)],sup=[S,Sc,S,Sc,SS,SSc,SS,SSc],sub=[Sc,Sc,Sc,Sc,SSc,SSc,SSc,SSc],fracNum=[T,Tc,S,Sc,SS,SSc,SS,SSc],fracDen=[Tc,Tc,Sc,Sc,SSc,SSc,SSc,SSc],cramp=[Dc,Dc,Tc,Tc,Sc,Sc,SSc,SSc],text$1=[D,Dc,T,Tc,T,Tc,T,Tc],Style$1={DISPLAY:styles[D],TEXT:styles[T],SCRIPT:styles[S],SCRIPTSCRIPT:styles[SS]},scriptData=[{name:"latin",blocks:[[256,591],[768,879]]},{name:"cyrillic",blocks:[[1024,1279]]},{name:"armenian",blocks:[[1328,1423]]},{name:"brahmic",blocks:[[2304,4255]]},{name:"georgian",blocks:[[4256,4351]]},{name:"cjk",blocks:[[12288,12543],[19968,40879],[65280,65376]]},{name:"hangul",blocks:[[44032,55215]]}];function scriptFromCodepoint(e){for(var a=0;a<scriptData.length;a++)for(var o=scriptData[a],c=0;c<o.blocks.length;c++){var d=o.blocks[c];if(e>=d[0]&&e<=d[1])return o.name}return null}var allBlocks=[];scriptData.forEach(e=>e.blocks.forEach(a=>allBlocks.push(...a)));function supportedCodepoint(e){for(var a=0;a<allBlocks.length;a+=2)if(e>=allBlocks[a]&&e<=allBlocks[a+1])return!0;return!1}var hLinePad=80,sqrtMain=function e(a,o){return"M95,"+(622+a+o)+`
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l`+a/2.075+" -"+a+`
c5.3,-9.3,12,-14,20,-14
H400000v`+(40+a)+`H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M`+(834+a)+" "+o+"h400000v"+(40+a)+"h-400000z"},sqrtSize1=function e(a,o){return"M263,"+(601+a+o)+`c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l`+a/2.084+" -"+a+`
c4.7,-7.3,11,-11,19,-11
H40000v`+(40+a)+`H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M`+(1001+a)+" "+o+"h400000v"+(40+a)+"h-400000z"},sqrtSize2=function e(a,o){return"M983 "+(10+a+o)+`
l`+a/3.13+" -"+a+`
c4,-6.7,10,-10,18,-10 H400000v`+(40+a)+`
H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7
s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744
c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30
c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722
c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5
c53.7,-170.3,84.5,-266.8,92.5,-289.5z
M`+(1001+a)+" "+o+"h400000v"+(40+a)+"h-400000z"},sqrtSize3=function e(a,o){return"M424,"+(2398+a+o)+`
c-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514
c0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20
s-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121
s209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081
l`+a/4.223+" -"+a+`c4,-6.7,10,-10,18,-10 H400000
v`+(40+a)+`H1014.6
s-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185
c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2z M`+(1001+a)+" "+o+`
h400000v`+(40+a)+"h-400000z"},sqrtSize4=function e(a,o){return"M473,"+(2713+a+o)+`
c339.3,-1799.3,509.3,-2700,510,-2702 l`+a/5.298+" -"+a+`
c3.3,-7.3,9.3,-11,18,-11 H400000v`+(40+a)+`H1017.7
s-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200
c0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26
s76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,
606zM`+(1001+a)+" "+o+"h400000v"+(40+a)+"H1017.7z"},phasePath=function e(a){var o=a/2;return"M400000 "+a+" H0 L"+o+" 0 l65 45 L145 "+(a-80)+" H400000z"},sqrtTall=function e(a,o,c){var d=c-54-o-a;return"M702 "+(a+o)+"H400000"+(40+a)+`
H742v`+d+`l-4 4-4 4c-.667.7 -2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1
h-12l-28-84c-16.667-52-96.667 -294.333-240-727l-212 -643 -85 170
c-4-3.333-8.333-7.667-13 -13l-13-13l77-155 77-156c66 199.333 139 419.667
219 661 l218 661zM702 `+o+"H400000v"+(40+a)+"H742z"},sqrtPath=function e(a,o,c){o=1e3*o;var d="";switch(a){case"sqrtMain":d=sqrtMain(o,hLinePad);break;case"sqrtSize1":d=sqrtSize1(o,hLinePad);break;case"sqrtSize2":d=sqrtSize2(o,hLinePad);break;case"sqrtSize3":d=sqrtSize3(o,hLinePad);break;case"sqrtSize4":d=sqrtSize4(o,hLinePad);break;case"sqrtTall":d=sqrtTall(o,hLinePad,c)}return d},innerPath=function e(a,o){switch(a){case"⎜":return"M291 0 H417 V"+o+" H291z M291 0 H417 V"+o+" H291z";case"∣":return"M145 0 H188 V"+o+" H145z M145 0 H188 V"+o+" H145z";case"∥":return"M145 0 H188 V"+o+" H145z M145 0 H188 V"+o+" H145z"+("M367 0 H410 V"+o+" H367z M367 0 H410 V"+o+" H367z");case"⎟":return"M457 0 H583 V"+o+" H457z M457 0 H583 V"+o+" H457z";case"⎢":return"M319 0 H403 V"+o+" H319z M319 0 H403 V"+o+" H319z";case"⎥":return"M263 0 H347 V"+o+" H263z M263 0 H347 V"+o+" H263z";case"⎪":return"M384 0 H504 V"+o+" H384z M384 0 H504 V"+o+" H384z";case"⏐":return"M312 0 H355 V"+o+" H312z M312 0 H355 V"+o+" H312z";case"‖":return"M257 0 H300 V"+o+" H257z M257 0 H300 V"+o+" H257z"+("M478 0 H521 V"+o+" H478z M478 0 H521 V"+o+" H478z");default:return""}},path={doubleleftarrow:`M262 157
l10-10c34-36 62.7-77 86-123 3.3-8 5-13.3 5-16 0-5.3-6.7-8-20-8-7.3
 0-12.2.5-14.5 1.5-2.3 1-4.8 4.5-7.5 10.5-49.3 97.3-121.7 169.3-217 216-28
 14-57.3 25-88 33-6.7 2-11 3.8-13 5.5-2 1.7-3 4.2-3 7.5s1 5.8 3 7.5
c2 1.7 6.3 3.5 13 5.5 68 17.3 128.2 47.8 180.5 91.5 52.3 43.7 93.8 96.2 124.5
 157.5 9.3 8 15.3 12.3 18 13h6c12-.7 18-4 18-10 0-2-1.7-7-5-15-23.3-46-52-87
-86-123l-10-10h399738v-40H218c328 0 0 0 0 0l-10-8c-26.7-20-65.7-43-117-69 2.7
-2 6-3.7 10-5 36.7-16 72.3-37.3 107-64l10-8h399782v-40z
m8 0v40h399730v-40zm0 194v40h399730v-40z`,doublerightarrow:`M399738 392l
-10 10c-34 36-62.7 77-86 123-3.3 8-5 13.3-5 16 0 5.3 6.7 8 20 8 7.3 0 12.2-.5
 14.5-1.5 2.3-1 4.8-4.5 7.5-10.5 49.3-97.3 121.7-169.3 217-216 28-14 57.3-25 88
-33 6.7-2 11-3.8 13-5.5 2-1.7 3-4.2 3-7.5s-1-5.8-3-7.5c-2-1.7-6.3-3.5-13-5.5-68
-17.3-128.2-47.8-180.5-91.5-52.3-43.7-93.8-96.2-124.5-157.5-9.3-8-15.3-12.3-18
-13h-6c-12 .7-18 4-18 10 0 2 1.7 7 5 15 23.3 46 52 87 86 123l10 10H0v40h399782
c-328 0 0 0 0 0l10 8c26.7 20 65.7 43 117 69-2.7 2-6 3.7-10 5-36.7 16-72.3 37.3
-107 64l-10 8H0v40zM0 157v40h399730v-40zm0 194v40h399730v-40z`,leftarrow:`M400000 241H110l3-3c68.7-52.7 113.7-120
 135-202 4-14.7 6-23 6-25 0-7.3-7-11-21-11-8 0-13.2.8-15.5 2.5-2.3 1.7-4.2 5.8
-5.5 12.5-1.3 4.7-2.7 10.3-4 17-12 48.7-34.8 92-68.5 130S65.3 228.3 18 247
c-10 4-16 7.7-18 11 0 8.7 6 14.3 18 17 47.3 18.7 87.8 47 121.5 85S196 441.3 208
 490c.7 2 1.3 5 2 9s1.2 6.7 1.5 8c.3 1.3 1 3.3 2 6s2.2 4.5 3.5 5.5c1.3 1 3.3
 1.8 6 2.5s6 1 10 1c14 0 21-3.7 21-11 0-2-2-10.3-6-25-20-79.3-65-146.7-135-202
 l-3-3h399890zM100 241v40h399900v-40z`,leftbrace:`M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117
-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7
 5-6 9-10 13-.7 1-7.3 1-20 1H6z`,leftbraceunder:`M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z`,leftgroup:`M400000 80
H435C64 80 168.3 229.4 21 260c-5.9 1.2-18 0-18 0-2 0-3-1-3-3v-38C76 61 257 0
 435 0h399565z`,leftgroupunder:`M400000 262
H435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219
 435 219h399565z`,leftharpoon:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3
-3.3 10.2-9.5 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5
-18.3 3-21-1.3-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7
-196 228-6.7 4.7-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40z`,leftharpoonplus:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3-3.3 10.2-9.5
 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5-18.3 3-21-1.3
-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7-196 228-6.7 4.7
-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40zM0 435v40h400000v-40z
m0 0v40h400000v-40z`,leftharpoondown:`M7 241c-4 4-6.333 8.667-7 14 0 5.333.667 9 2 11s5.333
 5.333 12 10c90.667 54 156 130 196 228 3.333 10.667 6.333 16.333 9 17 2 .667 5
 1 9 1h5c10.667 0 16.667-2 18-6 2-2.667 1-9.667-3-21-32-87.333-82.667-157.667
-152-211l-3-3h399907v-40zM93 281 H400000 v-40L7 241z`,leftharpoondownplus:`M7 435c-4 4-6.3 8.7-7 14 0 5.3.7 9 2 11s5.3 5.3 12
 10c90.7 54 156 130 196 228 3.3 10.7 6.3 16.3 9 17 2 .7 5 1 9 1h5c10.7 0 16.7
-2 18-6 2-2.7 1-9.7-3-21-32-87.3-82.7-157.7-152-211l-3-3h399907v-40H7zm93 0
v40h399900v-40zM0 241v40h399900v-40zm0 0v40h399900v-40z`,lefthook:`M400000 281 H103s-33-11.2-61-33.5S0 197.3 0 164s14.2-61.2 42.5
-83.5C70.8 58.2 104 47 142 47 c16.7 0 25 6.7 25 20 0 12-8.7 18.7-26 20-40 3.3
-68.7 15.7-86 37-10 12-15 25.3-15 40 0 22.7 9.8 40.7 29.5 54 19.7 13.3 43.5 21
 71.5 23h399859zM103 281v-40h399897v40z`,leftlinesegment:`M40 281 V428 H0 V94 H40 V241 H400000 v40z
M40 281 V428 H0 V94 H40 V241 H400000 v40z`,leftmapsto:`M40 281 V448H0V74H40V241H400000v40z
M40 281 V448H0V74H40V241H400000v40z`,leftToFrom:`M0 147h400000v40H0zm0 214c68 40 115.7 95.7 143 167h22c15.3 0 23
-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69-70-101l-7-8h399905v-40H95l7-8
c28.7-32 52-65.7 70-101 10.7-23.3 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 265.3
 68 321 0 361zm0-174v-40h399900v40zm100 154v40h399900v-40z`,longequal:`M0 50 h400000 v40H0z m0 194h40000v40H0z
M0 50 h400000 v40H0z m0 194h40000v40H0z`,midbrace:`M200428 334
c-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14
-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7
 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11
 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z`,midbraceunder:`M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z`,oiintSize1:`M512.6 71.6c272.6 0 320.3 106.8 320.3 178.2 0 70.8-47.7 177.6
-320.3 177.6S193.1 320.6 193.1 249.8c0-71.4 46.9-178.2 319.5-178.2z
m368.1 178.2c0-86.4-60.9-215.4-368.1-215.4-306.4 0-367.3 129-367.3 215.4 0 85.8
60.9 214.8 367.3 214.8 307.2 0 368.1-129 368.1-214.8z`,oiintSize2:`M757.8 100.1c384.7 0 451.1 137.6 451.1 230 0 91.3-66.4 228.8
-451.1 228.8-386.3 0-452.7-137.5-452.7-228.8 0-92.4 66.4-230 452.7-230z
m502.4 230c0-111.2-82.4-277.2-502.4-277.2s-504 166-504 277.2
c0 110 84 276 504 276s502.4-166 502.4-276z`,oiiintSize1:`M681.4 71.6c408.9 0 480.5 106.8 480.5 178.2 0 70.8-71.6 177.6
-480.5 177.6S202.1 320.6 202.1 249.8c0-71.4 70.5-178.2 479.3-178.2z
m525.8 178.2c0-86.4-86.8-215.4-525.7-215.4-437.9 0-524.7 129-524.7 215.4 0
85.8 86.8 214.8 524.7 214.8 438.9 0 525.7-129 525.7-214.8z`,oiiintSize2:`M1021.2 53c603.6 0 707.8 165.8 707.8 277.2 0 110-104.2 275.8
-707.8 275.8-606 0-710.2-165.8-710.2-275.8C311 218.8 415.2 53 1021.2 53z
m770.4 277.1c0-131.2-126.4-327.6-770.5-327.6S248.4 198.9 248.4 330.1
c0 130 128.8 326.4 772.7 326.4s770.5-196.4 770.5-326.4z`,rightarrow:`M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z`,rightbrace:`M400000 542l
-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5
s-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1
c124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z`,rightbraceunder:`M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z`,rightgroup:`M0 80h399565c371 0 266.7 149.4 414 180 5.9 1.2 18 0 18 0 2 0
 3-1 3-3v-38c-76-158-257-219-435-219H0z`,rightgroupunder:`M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18
 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z`,rightharpoon:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3
-3.7-15.3-11-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2
-10.7 0-16.7 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58
 69.2 92 94.5zm0 0v40h399900v-40z`,rightharpoonplus:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3-3.7-15.3-11
-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2-10.7 0-16.7
 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58 69.2 92 94.5z
m0 0v40h399900v-40z m100 194v40h399900v-40zm0 0v40h399900v-40z`,rightharpoondown:`M399747 511c0 7.3 6.7 11 20 11 8 0 13-.8 15-2.5s4.7-6.8
 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3 8.5-5.8 9.5
-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3-64.7 57-92 95
-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 241v40h399900v-40z`,rightharpoondownplus:`M399747 705c0 7.3 6.7 11 20 11 8 0 13-.8
 15-2.5s4.7-6.8 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3
 8.5-5.8 9.5-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3
-64.7 57-92 95-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 435v40h399900v-40z
m0-194v40h400000v-40zm0 0v40h400000v-40z`,righthook:`M399859 241c-764 0 0 0 0 0 40-3.3 68.7-15.7 86-37 10-12 15-25.3
 15-40 0-22.7-9.8-40.7-29.5-54-19.7-13.3-43.5-21-71.5-23-17.3-1.3-26-8-26-20 0
-13.3 8.7-20 26-20 38 0 71 11.2 99 33.5 0 0 7 5.6 21 16.7 14 11.2 21 33.5 21
 66.8s-14 61.2-42 83.5c-28 22.3-61 33.5-99 33.5L0 241z M0 281v-40h399859v40z`,rightlinesegment:`M399960 241 V94 h40 V428 h-40 V281 H0 v-40z
M399960 241 V94 h40 V428 h-40 V281 H0 v-40z`,rightToFrom:`M400000 167c-70.7-42-118-97.7-142-167h-23c-15.3 0-23 .3-23
 1 0 1.3 5.3 13.7 16 37 18 35.3 41.3 69 70 101l7 8H0v40h399905l-7 8c-28.7 32
-52 65.7-70 101-10.7 23.3-16 35.7-16 37 0 .7 7.7 1 23 1h23c24-69.3 71.3-125 142
-167z M100 147v40h399900v-40zM0 341v40h399900v-40z`,twoheadleftarrow:`M0 167c68 40
 115.7 95.7 143 167h22c15.3 0 23-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69
-70-101l-7-8h125l9 7c50.7 39.3 85 86 103 140h46c0-4.7-6.3-18.7-19-42-18-35.3
-40-67.3-66-96l-9-9h399716v-40H284l9-9c26-28.7 48-60.7 66-96 12.7-23.333 19
-37.333 19-42h-46c-18 54-52.3 100.7-103 140l-9 7H95l7-8c28.7-32 52-65.7 70-101
 10.7-23.333 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 71.3 68 127 0 167z`,twoheadrightarrow:`M400000 167
c-68-40-115.7-95.7-143-167h-22c-15.3 0-23 .3-23 1 0 1.3 5.3 13.7 16 37 18 35.3
 41.3 69 70 101l7 8h-125l-9-7c-50.7-39.3-85-86-103-140h-46c0 4.7 6.3 18.7 19 42
 18 35.3 40 67.3 66 96l9 9H0v40h399716l-9 9c-26 28.7-48 60.7-66 96-12.7 23.333
-19 37.333-19 42h46c18-54 52.3-100.7 103-140l9-7h125l-7 8c-28.7 32-52 65.7-70
 101-10.7 23.333-16 35.7-16 37 0 .7 7.7 1 23 1h22c27.3-71.3 75-127 143-167z`,tilde1:`M200 55.538c-77 0-168 73.953-177 73.953-3 0-7
-2.175-9-5.437L2 97c-1-2-2-4-2-6 0-4 2-7 5-9l20-12C116 12 171 0 207 0c86 0
 114 68 191 68 78 0 168-68 177-68 4 0 7 2 9 5l12 19c1 2.175 2 4.35 2 6.525 0
 4.35-2 7.613-5 9.788l-19 13.05c-92 63.077-116.937 75.308-183 76.128
-68.267.847-113-73.952-191-73.952z`,tilde2:`M344 55.266c-142 0-300.638 81.316-311.5 86.418
-8.01 3.762-22.5 10.91-23.5 5.562L1 120c-1-2-1-3-1-4 0-5 3-9 8-10l18.4-9C160.9
 31.9 283 0 358 0c148 0 188 122 331 122s314-97 326-97c4 0 8 2 10 7l7 21.114
c1 2.14 1 3.21 1 4.28 0 5.347-3 9.626-7 10.696l-22.3 12.622C852.6 158.372 751
 181.476 676 181.476c-149 0-189-126.21-332-126.21z`,tilde3:`M786 59C457 59 32 175.242 13 175.242c-6 0-10-3.457
-11-10.37L.15 138c-1-7 3-12 10-13l19.2-6.4C378.4 40.7 634.3 0 804.3 0c337 0
 411.8 157 746.8 157 328 0 754-112 773-112 5 0 10 3 11 9l1 14.075c1 8.066-.697
 16.595-6.697 17.492l-21.052 7.31c-367.9 98.146-609.15 122.696-778.15 122.696
 -338 0-409-156.573-744-156.573z`,tilde4:`M786 58C457 58 32 177.487 13 177.487c-6 0-10-3.345
-11-10.035L.15 143c-1-7 3-12 10-13l22-6.7C381.2 35 637.15 0 807.15 0c337 0 409
 177 744 177 328 0 754-127 773-127 5 0 10 3 11 9l1 14.794c1 7.805-3 13.38-9
 14.495l-20.7 5.574c-366.85 99.79-607.3 139.372-776.3 139.372-338 0-409
 -175.236-744-175.236z`,vec:`M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z`,widehat1:`M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z`,widehat2:`M1181 0h2l1171 176c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 220h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat3:`M1181 0h2l1171 236c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 280h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat4:`M1181 0h2l1171 296c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 340h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widecheck1:`M529,159h5l519,-115c5,-1,9,-5,9,-10c0,-1,-1,-2,-1,-3l-4,-22c-1,
-5,-5,-9,-11,-9h-2l-512,92l-513,-92h-2c-5,0,-9,4,-11,9l-5,22c-1,6,2,12,8,13z`,widecheck2:`M1181,220h2l1171,-176c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,153l-1167,-153h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck3:`M1181,280h2l1171,-236c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,213l-1167,-213h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck4:`M1181,340h2l1171,-296c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,273l-1167,-273h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,baraboveleftarrow:`M400000 620h-399890l3 -3c68.7 -52.7 113.7 -120 135 -202
c4 -14.7 6 -23 6 -25c0 -7.3 -7 -11 -21 -11c-8 0 -13.2 0.8 -15.5 2.5
c-2.3 1.7 -4.2 5.8 -5.5 12.5c-1.3 4.7 -2.7 10.3 -4 17c-12 48.7 -34.8 92 -68.5 130
s-74.2 66.3 -121.5 85c-10 4 -16 7.7 -18 11c0 8.7 6 14.3 18 17c47.3 18.7 87.8 47
121.5 85s56.5 81.3 68.5 130c0.7 2 1.3 5 2 9s1.2 6.7 1.5 8c0.3 1.3 1 3.3 2 6
s2.2 4.5 3.5 5.5c1.3 1 3.3 1.8 6 2.5s6 1 10 1c14 0 21 -3.7 21 -11
c0 -2 -2 -10.3 -6 -25c-20 -79.3 -65 -146.7 -135 -202l-3 -3h399890z
M100 620v40h399900v-40z M0 241v40h399900v-40zM0 241v40h399900v-40z`,rightarrowabovebar:`M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32
-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0
13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39
-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5
-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
151.7 139 205zm96 379h399894v40H0zm0 0h399904v40H0z`,baraboveshortleftharpoon:`M507,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17
c2,0.7,5,1,9,1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21
c-32,-87.3,-82.7,-157.7,-152,-211c0,0,-3,-3,-3,-3l399351,0l0,-40
c-398570,0,-399437,0,-399437,0z M593 435 v40 H399500 v-40z
M0 281 v-40 H399908 v40z M0 281 v-40 H399908 v40z`,rightharpoonaboveshortbar:`M0,241 l0,40c399126,0,399993,0,399993,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M0 241 v40 H399908 v-40z M0 475 v-40 H399500 v40z M0 475 v-40 H399500 v40z`,shortbaraboveleftharpoon:`M7,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17c2,0.7,5,1,9,
1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21c-32,-87.3,-82.7,-157.7,
-152,-211c0,0,-3,-3,-3,-3l399907,0l0,-40c-399126,0,-399993,0,-399993,0z
M93 435 v40 H400000 v-40z M500 241 v40 H400000 v-40z M500 241 v40 H400000 v-40z`,shortrightharpoonabovebar:`M53,241l0,40c398570,0,399437,0,399437,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M500 241 v40 H399408 v-40z M500 435 v40 H400000 v-40z`},tallDelim=function e(a,o){switch(a){case"lbrack":return"M403 1759 V84 H666 V0 H319 V1759 v"+o+` v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v`+o+" v1759 h84z";case"rbrack":return"M347 1759 V0 H0 V84 H263 V1759 v"+o+` v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v`+o+" v1759 h84z";case"vert":return"M145 15 v585 v"+o+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-o+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+o+" v585 h43z";case"doublevert":return"M145 15 v585 v"+o+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-o+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+o+` v585 h43z
M367 15 v585 v`+o+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-o+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M410 15 H367 v585 v`+o+" v585 h43z";case"lfloor":return"M319 602 V0 H403 V602 v"+o+` v1715 h263 v84 H319z
MM319 602 V0 H403 V602 v`+o+" v1715 H319z";case"rfloor":return"M319 602 V0 H403 V602 v"+o+` v1799 H0 v-84 H319z
MM319 602 V0 H403 V602 v`+o+" v1715 H319z";case"lceil":return"M403 1759 V84 H666 V0 H319 V1759 v"+o+` v602 h84z
M403 1759 V0 H319 V1759 v`+o+" v602 h84z";case"rceil":return"M347 1759 V0 H0 V84 H263 V1759 v"+o+` v602 h84z
M347 1759 V0 h-84 V1759 v`+o+" v602 h84z";case"lparen":return`M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1
c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,
-36,557 l0,`+(o+84)+`c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,
949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9
c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,
-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189
l0,-`+(o+92)+`c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,
-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z`;case"rparen":return`M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,
63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5
c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,`+(o+9)+`
c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664
c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11
c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17
c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558
l0,-`+(o+144)+`c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,
-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z`;default:throw new Error("Unknown stretchy delimiter.")}};class DocumentFragment{constructor(a){this.children=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.children=a,this.classes=[],this.height=0,this.depth=0,this.maxFontSize=0,this.style={}}hasClass(a){return utils.contains(this.classes,a)}toNode(){for(var a=document.createDocumentFragment(),o=0;o<this.children.length;o++)a.appendChild(this.children[o].toNode());return a}toMarkup(){for(var a="",o=0;o<this.children.length;o++)a+=this.children[o].toMarkup();return a}toText(){var a=o=>o.toText();return this.children.map(a).join("")}}var fontMetricsData={"AMS-Regular":{32:[0,0,0,0,.25],65:[0,.68889,0,0,.72222],66:[0,.68889,0,0,.66667],67:[0,.68889,0,0,.72222],68:[0,.68889,0,0,.72222],69:[0,.68889,0,0,.66667],70:[0,.68889,0,0,.61111],71:[0,.68889,0,0,.77778],72:[0,.68889,0,0,.77778],73:[0,.68889,0,0,.38889],74:[.16667,.68889,0,0,.5],75:[0,.68889,0,0,.77778],76:[0,.68889,0,0,.66667],77:[0,.68889,0,0,.94445],78:[0,.68889,0,0,.72222],79:[.16667,.68889,0,0,.77778],80:[0,.68889,0,0,.61111],81:[.16667,.68889,0,0,.77778],82:[0,.68889,0,0,.72222],83:[0,.68889,0,0,.55556],84:[0,.68889,0,0,.66667],85:[0,.68889,0,0,.72222],86:[0,.68889,0,0,.72222],87:[0,.68889,0,0,1],88:[0,.68889,0,0,.72222],89:[0,.68889,0,0,.72222],90:[0,.68889,0,0,.66667],107:[0,.68889,0,0,.55556],160:[0,0,0,0,.25],165:[0,.675,.025,0,.75],174:[.15559,.69224,0,0,.94666],240:[0,.68889,0,0,.55556],295:[0,.68889,0,0,.54028],710:[0,.825,0,0,2.33334],732:[0,.9,0,0,2.33334],770:[0,.825,0,0,2.33334],771:[0,.9,0,0,2.33334],989:[.08167,.58167,0,0,.77778],1008:[0,.43056,.04028,0,.66667],8245:[0,.54986,0,0,.275],8463:[0,.68889,0,0,.54028],8487:[0,.68889,0,0,.72222],8498:[0,.68889,0,0,.55556],8502:[0,.68889,0,0,.66667],8503:[0,.68889,0,0,.44445],8504:[0,.68889,0,0,.66667],8513:[0,.68889,0,0,.63889],8592:[-.03598,.46402,0,0,.5],8594:[-.03598,.46402,0,0,.5],8602:[-.13313,.36687,0,0,1],8603:[-.13313,.36687,0,0,1],8606:[.01354,.52239,0,0,1],8608:[.01354,.52239,0,0,1],8610:[.01354,.52239,0,0,1.11111],8611:[.01354,.52239,0,0,1.11111],8619:[0,.54986,0,0,1],8620:[0,.54986,0,0,1],8621:[-.13313,.37788,0,0,1.38889],8622:[-.13313,.36687,0,0,1],8624:[0,.69224,0,0,.5],8625:[0,.69224,0,0,.5],8630:[0,.43056,0,0,1],8631:[0,.43056,0,0,1],8634:[.08198,.58198,0,0,.77778],8635:[.08198,.58198,0,0,.77778],8638:[.19444,.69224,0,0,.41667],8639:[.19444,.69224,0,0,.41667],8642:[.19444,.69224,0,0,.41667],8643:[.19444,.69224,0,0,.41667],8644:[.1808,.675,0,0,1],8646:[.1808,.675,0,0,1],8647:[.1808,.675,0,0,1],8648:[.19444,.69224,0,0,.83334],8649:[.1808,.675,0,0,1],8650:[.19444,.69224,0,0,.83334],8651:[.01354,.52239,0,0,1],8652:[.01354,.52239,0,0,1],8653:[-.13313,.36687,0,0,1],8654:[-.13313,.36687,0,0,1],8655:[-.13313,.36687,0,0,1],8666:[.13667,.63667,0,0,1],8667:[.13667,.63667,0,0,1],8669:[-.13313,.37788,0,0,1],8672:[-.064,.437,0,0,1.334],8674:[-.064,.437,0,0,1.334],8705:[0,.825,0,0,.5],8708:[0,.68889,0,0,.55556],8709:[.08167,.58167,0,0,.77778],8717:[0,.43056,0,0,.42917],8722:[-.03598,.46402,0,0,.5],8724:[.08198,.69224,0,0,.77778],8726:[.08167,.58167,0,0,.77778],8733:[0,.69224,0,0,.77778],8736:[0,.69224,0,0,.72222],8737:[0,.69224,0,0,.72222],8738:[.03517,.52239,0,0,.72222],8739:[.08167,.58167,0,0,.22222],8740:[.25142,.74111,0,0,.27778],8741:[.08167,.58167,0,0,.38889],8742:[.25142,.74111,0,0,.5],8756:[0,.69224,0,0,.66667],8757:[0,.69224,0,0,.66667],8764:[-.13313,.36687,0,0,.77778],8765:[-.13313,.37788,0,0,.77778],8769:[-.13313,.36687,0,0,.77778],8770:[-.03625,.46375,0,0,.77778],8774:[.30274,.79383,0,0,.77778],8776:[-.01688,.48312,0,0,.77778],8778:[.08167,.58167,0,0,.77778],8782:[.06062,.54986,0,0,.77778],8783:[.06062,.54986,0,0,.77778],8785:[.08198,.58198,0,0,.77778],8786:[.08198,.58198,0,0,.77778],8787:[.08198,.58198,0,0,.77778],8790:[0,.69224,0,0,.77778],8791:[.22958,.72958,0,0,.77778],8796:[.08198,.91667,0,0,.77778],8806:[.25583,.75583,0,0,.77778],8807:[.25583,.75583,0,0,.77778],8808:[.25142,.75726,0,0,.77778],8809:[.25142,.75726,0,0,.77778],8812:[.25583,.75583,0,0,.5],8814:[.20576,.70576,0,0,.77778],8815:[.20576,.70576,0,0,.77778],8816:[.30274,.79383,0,0,.77778],8817:[.30274,.79383,0,0,.77778],8818:[.22958,.72958,0,0,.77778],8819:[.22958,.72958,0,0,.77778],8822:[.1808,.675,0,0,.77778],8823:[.1808,.675,0,0,.77778],8828:[.13667,.63667,0,0,.77778],8829:[.13667,.63667,0,0,.77778],8830:[.22958,.72958,0,0,.77778],8831:[.22958,.72958,0,0,.77778],8832:[.20576,.70576,0,0,.77778],8833:[.20576,.70576,0,0,.77778],8840:[.30274,.79383,0,0,.77778],8841:[.30274,.79383,0,0,.77778],8842:[.13597,.63597,0,0,.77778],8843:[.13597,.63597,0,0,.77778],8847:[.03517,.54986,0,0,.77778],8848:[.03517,.54986,0,0,.77778],8858:[.08198,.58198,0,0,.77778],8859:[.08198,.58198,0,0,.77778],8861:[.08198,.58198,0,0,.77778],8862:[0,.675,0,0,.77778],8863:[0,.675,0,0,.77778],8864:[0,.675,0,0,.77778],8865:[0,.675,0,0,.77778],8872:[0,.69224,0,0,.61111],8873:[0,.69224,0,0,.72222],8874:[0,.69224,0,0,.88889],8876:[0,.68889,0,0,.61111],8877:[0,.68889,0,0,.61111],8878:[0,.68889,0,0,.72222],8879:[0,.68889,0,0,.72222],8882:[.03517,.54986,0,0,.77778],8883:[.03517,.54986,0,0,.77778],8884:[.13667,.63667,0,0,.77778],8885:[.13667,.63667,0,0,.77778],8888:[0,.54986,0,0,1.11111],8890:[.19444,.43056,0,0,.55556],8891:[.19444,.69224,0,0,.61111],8892:[.19444,.69224,0,0,.61111],8901:[0,.54986,0,0,.27778],8903:[.08167,.58167,0,0,.77778],8905:[.08167,.58167,0,0,.77778],8906:[.08167,.58167,0,0,.77778],8907:[0,.69224,0,0,.77778],8908:[0,.69224,0,0,.77778],8909:[-.03598,.46402,0,0,.77778],8910:[0,.54986,0,0,.76042],8911:[0,.54986,0,0,.76042],8912:[.03517,.54986,0,0,.77778],8913:[.03517,.54986,0,0,.77778],8914:[0,.54986,0,0,.66667],8915:[0,.54986,0,0,.66667],8916:[0,.69224,0,0,.66667],8918:[.0391,.5391,0,0,.77778],8919:[.0391,.5391,0,0,.77778],8920:[.03517,.54986,0,0,1.33334],8921:[.03517,.54986,0,0,1.33334],8922:[.38569,.88569,0,0,.77778],8923:[.38569,.88569,0,0,.77778],8926:[.13667,.63667,0,0,.77778],8927:[.13667,.63667,0,0,.77778],8928:[.30274,.79383,0,0,.77778],8929:[.30274,.79383,0,0,.77778],8934:[.23222,.74111,0,0,.77778],8935:[.23222,.74111,0,0,.77778],8936:[.23222,.74111,0,0,.77778],8937:[.23222,.74111,0,0,.77778],8938:[.20576,.70576,0,0,.77778],8939:[.20576,.70576,0,0,.77778],8940:[.30274,.79383,0,0,.77778],8941:[.30274,.79383,0,0,.77778],8994:[.19444,.69224,0,0,.77778],8995:[.19444,.69224,0,0,.77778],9416:[.15559,.69224,0,0,.90222],9484:[0,.69224,0,0,.5],9488:[0,.69224,0,0,.5],9492:[0,.37788,0,0,.5],9496:[0,.37788,0,0,.5],9585:[.19444,.68889,0,0,.88889],9586:[.19444,.74111,0,0,.88889],9632:[0,.675,0,0,.77778],9633:[0,.675,0,0,.77778],9650:[0,.54986,0,0,.72222],9651:[0,.54986,0,0,.72222],9654:[.03517,.54986,0,0,.77778],9660:[0,.54986,0,0,.72222],9661:[0,.54986,0,0,.72222],9664:[.03517,.54986,0,0,.77778],9674:[.11111,.69224,0,0,.66667],9733:[.19444,.69224,0,0,.94445],10003:[0,.69224,0,0,.83334],10016:[0,.69224,0,0,.83334],10731:[.11111,.69224,0,0,.66667],10846:[.19444,.75583,0,0,.61111],10877:[.13667,.63667,0,0,.77778],10878:[.13667,.63667,0,0,.77778],10885:[.25583,.75583,0,0,.77778],10886:[.25583,.75583,0,0,.77778],10887:[.13597,.63597,0,0,.77778],10888:[.13597,.63597,0,0,.77778],10889:[.26167,.75726,0,0,.77778],10890:[.26167,.75726,0,0,.77778],10891:[.48256,.98256,0,0,.77778],10892:[.48256,.98256,0,0,.77778],10901:[.13667,.63667,0,0,.77778],10902:[.13667,.63667,0,0,.77778],10933:[.25142,.75726,0,0,.77778],10934:[.25142,.75726,0,0,.77778],10935:[.26167,.75726,0,0,.77778],10936:[.26167,.75726,0,0,.77778],10937:[.26167,.75726,0,0,.77778],10938:[.26167,.75726,0,0,.77778],10949:[.25583,.75583,0,0,.77778],10950:[.25583,.75583,0,0,.77778],10955:[.28481,.79383,0,0,.77778],10956:[.28481,.79383,0,0,.77778],57350:[.08167,.58167,0,0,.22222],57351:[.08167,.58167,0,0,.38889],57352:[.08167,.58167,0,0,.77778],57353:[0,.43056,.04028,0,.66667],57356:[.25142,.75726,0,0,.77778],57357:[.25142,.75726,0,0,.77778],57358:[.41951,.91951,0,0,.77778],57359:[.30274,.79383,0,0,.77778],57360:[.30274,.79383,0,0,.77778],57361:[.41951,.91951,0,0,.77778],57366:[.25142,.75726,0,0,.77778],57367:[.25142,.75726,0,0,.77778],57368:[.25142,.75726,0,0,.77778],57369:[.25142,.75726,0,0,.77778],57370:[.13597,.63597,0,0,.77778],57371:[.13597,.63597,0,0,.77778]},"Caligraphic-Regular":{32:[0,0,0,0,.25],65:[0,.68333,0,.19445,.79847],66:[0,.68333,.03041,.13889,.65681],67:[0,.68333,.05834,.13889,.52653],68:[0,.68333,.02778,.08334,.77139],69:[0,.68333,.08944,.11111,.52778],70:[0,.68333,.09931,.11111,.71875],71:[.09722,.68333,.0593,.11111,.59487],72:[0,.68333,.00965,.11111,.84452],73:[0,.68333,.07382,0,.54452],74:[.09722,.68333,.18472,.16667,.67778],75:[0,.68333,.01445,.05556,.76195],76:[0,.68333,0,.13889,.68972],77:[0,.68333,0,.13889,1.2009],78:[0,.68333,.14736,.08334,.82049],79:[0,.68333,.02778,.11111,.79611],80:[0,.68333,.08222,.08334,.69556],81:[.09722,.68333,0,.11111,.81667],82:[0,.68333,0,.08334,.8475],83:[0,.68333,.075,.13889,.60556],84:[0,.68333,.25417,0,.54464],85:[0,.68333,.09931,.08334,.62583],86:[0,.68333,.08222,0,.61278],87:[0,.68333,.08222,.08334,.98778],88:[0,.68333,.14643,.13889,.7133],89:[.09722,.68333,.08222,.08334,.66834],90:[0,.68333,.07944,.13889,.72473],160:[0,0,0,0,.25]},"Fraktur-Regular":{32:[0,0,0,0,.25],33:[0,.69141,0,0,.29574],34:[0,.69141,0,0,.21471],38:[0,.69141,0,0,.73786],39:[0,.69141,0,0,.21201],40:[.24982,.74947,0,0,.38865],41:[.24982,.74947,0,0,.38865],42:[0,.62119,0,0,.27764],43:[.08319,.58283,0,0,.75623],44:[0,.10803,0,0,.27764],45:[.08319,.58283,0,0,.75623],46:[0,.10803,0,0,.27764],47:[.24982,.74947,0,0,.50181],48:[0,.47534,0,0,.50181],49:[0,.47534,0,0,.50181],50:[0,.47534,0,0,.50181],51:[.18906,.47534,0,0,.50181],52:[.18906,.47534,0,0,.50181],53:[.18906,.47534,0,0,.50181],54:[0,.69141,0,0,.50181],55:[.18906,.47534,0,0,.50181],56:[0,.69141,0,0,.50181],57:[.18906,.47534,0,0,.50181],58:[0,.47534,0,0,.21606],59:[.12604,.47534,0,0,.21606],61:[-.13099,.36866,0,0,.75623],63:[0,.69141,0,0,.36245],65:[0,.69141,0,0,.7176],66:[0,.69141,0,0,.88397],67:[0,.69141,0,0,.61254],68:[0,.69141,0,0,.83158],69:[0,.69141,0,0,.66278],70:[.12604,.69141,0,0,.61119],71:[0,.69141,0,0,.78539],72:[.06302,.69141,0,0,.7203],73:[0,.69141,0,0,.55448],74:[.12604,.69141,0,0,.55231],75:[0,.69141,0,0,.66845],76:[0,.69141,0,0,.66602],77:[0,.69141,0,0,1.04953],78:[0,.69141,0,0,.83212],79:[0,.69141,0,0,.82699],80:[.18906,.69141,0,0,.82753],81:[.03781,.69141,0,0,.82699],82:[0,.69141,0,0,.82807],83:[0,.69141,0,0,.82861],84:[0,.69141,0,0,.66899],85:[0,.69141,0,0,.64576],86:[0,.69141,0,0,.83131],87:[0,.69141,0,0,1.04602],88:[0,.69141,0,0,.71922],89:[.18906,.69141,0,0,.83293],90:[.12604,.69141,0,0,.60201],91:[.24982,.74947,0,0,.27764],93:[.24982,.74947,0,0,.27764],94:[0,.69141,0,0,.49965],97:[0,.47534,0,0,.50046],98:[0,.69141,0,0,.51315],99:[0,.47534,0,0,.38946],100:[0,.62119,0,0,.49857],101:[0,.47534,0,0,.40053],102:[.18906,.69141,0,0,.32626],103:[.18906,.47534,0,0,.5037],104:[.18906,.69141,0,0,.52126],105:[0,.69141,0,0,.27899],106:[0,.69141,0,0,.28088],107:[0,.69141,0,0,.38946],108:[0,.69141,0,0,.27953],109:[0,.47534,0,0,.76676],110:[0,.47534,0,0,.52666],111:[0,.47534,0,0,.48885],112:[.18906,.52396,0,0,.50046],113:[.18906,.47534,0,0,.48912],114:[0,.47534,0,0,.38919],115:[0,.47534,0,0,.44266],116:[0,.62119,0,0,.33301],117:[0,.47534,0,0,.5172],118:[0,.52396,0,0,.5118],119:[0,.52396,0,0,.77351],120:[.18906,.47534,0,0,.38865],121:[.18906,.47534,0,0,.49884],122:[.18906,.47534,0,0,.39054],160:[0,0,0,0,.25],8216:[0,.69141,0,0,.21471],8217:[0,.69141,0,0,.21471],58112:[0,.62119,0,0,.49749],58113:[0,.62119,0,0,.4983],58114:[.18906,.69141,0,0,.33328],58115:[.18906,.69141,0,0,.32923],58116:[.18906,.47534,0,0,.50343],58117:[0,.69141,0,0,.33301],58118:[0,.62119,0,0,.33409],58119:[0,.47534,0,0,.50073]},"Main-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.35],34:[0,.69444,0,0,.60278],35:[.19444,.69444,0,0,.95833],36:[.05556,.75,0,0,.575],37:[.05556,.75,0,0,.95833],38:[0,.69444,0,0,.89444],39:[0,.69444,0,0,.31944],40:[.25,.75,0,0,.44722],41:[.25,.75,0,0,.44722],42:[0,.75,0,0,.575],43:[.13333,.63333,0,0,.89444],44:[.19444,.15556,0,0,.31944],45:[0,.44444,0,0,.38333],46:[0,.15556,0,0,.31944],47:[.25,.75,0,0,.575],48:[0,.64444,0,0,.575],49:[0,.64444,0,0,.575],50:[0,.64444,0,0,.575],51:[0,.64444,0,0,.575],52:[0,.64444,0,0,.575],53:[0,.64444,0,0,.575],54:[0,.64444,0,0,.575],55:[0,.64444,0,0,.575],56:[0,.64444,0,0,.575],57:[0,.64444,0,0,.575],58:[0,.44444,0,0,.31944],59:[.19444,.44444,0,0,.31944],60:[.08556,.58556,0,0,.89444],61:[-.10889,.39111,0,0,.89444],62:[.08556,.58556,0,0,.89444],63:[0,.69444,0,0,.54305],64:[0,.69444,0,0,.89444],65:[0,.68611,0,0,.86944],66:[0,.68611,0,0,.81805],67:[0,.68611,0,0,.83055],68:[0,.68611,0,0,.88194],69:[0,.68611,0,0,.75555],70:[0,.68611,0,0,.72361],71:[0,.68611,0,0,.90416],72:[0,.68611,0,0,.9],73:[0,.68611,0,0,.43611],74:[0,.68611,0,0,.59444],75:[0,.68611,0,0,.90138],76:[0,.68611,0,0,.69166],77:[0,.68611,0,0,1.09166],78:[0,.68611,0,0,.9],79:[0,.68611,0,0,.86388],80:[0,.68611,0,0,.78611],81:[.19444,.68611,0,0,.86388],82:[0,.68611,0,0,.8625],83:[0,.68611,0,0,.63889],84:[0,.68611,0,0,.8],85:[0,.68611,0,0,.88472],86:[0,.68611,.01597,0,.86944],87:[0,.68611,.01597,0,1.18888],88:[0,.68611,0,0,.86944],89:[0,.68611,.02875,0,.86944],90:[0,.68611,0,0,.70277],91:[.25,.75,0,0,.31944],92:[.25,.75,0,0,.575],93:[.25,.75,0,0,.31944],94:[0,.69444,0,0,.575],95:[.31,.13444,.03194,0,.575],97:[0,.44444,0,0,.55902],98:[0,.69444,0,0,.63889],99:[0,.44444,0,0,.51111],100:[0,.69444,0,0,.63889],101:[0,.44444,0,0,.52708],102:[0,.69444,.10903,0,.35139],103:[.19444,.44444,.01597,0,.575],104:[0,.69444,0,0,.63889],105:[0,.69444,0,0,.31944],106:[.19444,.69444,0,0,.35139],107:[0,.69444,0,0,.60694],108:[0,.69444,0,0,.31944],109:[0,.44444,0,0,.95833],110:[0,.44444,0,0,.63889],111:[0,.44444,0,0,.575],112:[.19444,.44444,0,0,.63889],113:[.19444,.44444,0,0,.60694],114:[0,.44444,0,0,.47361],115:[0,.44444,0,0,.45361],116:[0,.63492,0,0,.44722],117:[0,.44444,0,0,.63889],118:[0,.44444,.01597,0,.60694],119:[0,.44444,.01597,0,.83055],120:[0,.44444,0,0,.60694],121:[.19444,.44444,.01597,0,.60694],122:[0,.44444,0,0,.51111],123:[.25,.75,0,0,.575],124:[.25,.75,0,0,.31944],125:[.25,.75,0,0,.575],126:[.35,.34444,0,0,.575],160:[0,0,0,0,.25],163:[0,.69444,0,0,.86853],168:[0,.69444,0,0,.575],172:[0,.44444,0,0,.76666],176:[0,.69444,0,0,.86944],177:[.13333,.63333,0,0,.89444],184:[.17014,0,0,0,.51111],198:[0,.68611,0,0,1.04166],215:[.13333,.63333,0,0,.89444],216:[.04861,.73472,0,0,.89444],223:[0,.69444,0,0,.59722],230:[0,.44444,0,0,.83055],247:[.13333,.63333,0,0,.89444],248:[.09722,.54167,0,0,.575],305:[0,.44444,0,0,.31944],338:[0,.68611,0,0,1.16944],339:[0,.44444,0,0,.89444],567:[.19444,.44444,0,0,.35139],710:[0,.69444,0,0,.575],711:[0,.63194,0,0,.575],713:[0,.59611,0,0,.575],714:[0,.69444,0,0,.575],715:[0,.69444,0,0,.575],728:[0,.69444,0,0,.575],729:[0,.69444,0,0,.31944],730:[0,.69444,0,0,.86944],732:[0,.69444,0,0,.575],733:[0,.69444,0,0,.575],915:[0,.68611,0,0,.69166],916:[0,.68611,0,0,.95833],920:[0,.68611,0,0,.89444],923:[0,.68611,0,0,.80555],926:[0,.68611,0,0,.76666],928:[0,.68611,0,0,.9],931:[0,.68611,0,0,.83055],933:[0,.68611,0,0,.89444],934:[0,.68611,0,0,.83055],936:[0,.68611,0,0,.89444],937:[0,.68611,0,0,.83055],8211:[0,.44444,.03194,0,.575],8212:[0,.44444,.03194,0,1.14999],8216:[0,.69444,0,0,.31944],8217:[0,.69444,0,0,.31944],8220:[0,.69444,0,0,.60278],8221:[0,.69444,0,0,.60278],8224:[.19444,.69444,0,0,.51111],8225:[.19444,.69444,0,0,.51111],8242:[0,.55556,0,0,.34444],8407:[0,.72444,.15486,0,.575],8463:[0,.69444,0,0,.66759],8465:[0,.69444,0,0,.83055],8467:[0,.69444,0,0,.47361],8472:[.19444,.44444,0,0,.74027],8476:[0,.69444,0,0,.83055],8501:[0,.69444,0,0,.70277],8592:[-.10889,.39111,0,0,1.14999],8593:[.19444,.69444,0,0,.575],8594:[-.10889,.39111,0,0,1.14999],8595:[.19444,.69444,0,0,.575],8596:[-.10889,.39111,0,0,1.14999],8597:[.25,.75,0,0,.575],8598:[.19444,.69444,0,0,1.14999],8599:[.19444,.69444,0,0,1.14999],8600:[.19444,.69444,0,0,1.14999],8601:[.19444,.69444,0,0,1.14999],8636:[-.10889,.39111,0,0,1.14999],8637:[-.10889,.39111,0,0,1.14999],8640:[-.10889,.39111,0,0,1.14999],8641:[-.10889,.39111,0,0,1.14999],8656:[-.10889,.39111,0,0,1.14999],8657:[.19444,.69444,0,0,.70277],8658:[-.10889,.39111,0,0,1.14999],8659:[.19444,.69444,0,0,.70277],8660:[-.10889,.39111,0,0,1.14999],8661:[.25,.75,0,0,.70277],8704:[0,.69444,0,0,.63889],8706:[0,.69444,.06389,0,.62847],8707:[0,.69444,0,0,.63889],8709:[.05556,.75,0,0,.575],8711:[0,.68611,0,0,.95833],8712:[.08556,.58556,0,0,.76666],8715:[.08556,.58556,0,0,.76666],8722:[.13333,.63333,0,0,.89444],8723:[.13333,.63333,0,0,.89444],8725:[.25,.75,0,0,.575],8726:[.25,.75,0,0,.575],8727:[-.02778,.47222,0,0,.575],8728:[-.02639,.47361,0,0,.575],8729:[-.02639,.47361,0,0,.575],8730:[.18,.82,0,0,.95833],8733:[0,.44444,0,0,.89444],8734:[0,.44444,0,0,1.14999],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.31944],8741:[.25,.75,0,0,.575],8743:[0,.55556,0,0,.76666],8744:[0,.55556,0,0,.76666],8745:[0,.55556,0,0,.76666],8746:[0,.55556,0,0,.76666],8747:[.19444,.69444,.12778,0,.56875],8764:[-.10889,.39111,0,0,.89444],8768:[.19444,.69444,0,0,.31944],8771:[.00222,.50222,0,0,.89444],8773:[.027,.638,0,0,.894],8776:[.02444,.52444,0,0,.89444],8781:[.00222,.50222,0,0,.89444],8801:[.00222,.50222,0,0,.89444],8804:[.19667,.69667,0,0,.89444],8805:[.19667,.69667,0,0,.89444],8810:[.08556,.58556,0,0,1.14999],8811:[.08556,.58556,0,0,1.14999],8826:[.08556,.58556,0,0,.89444],8827:[.08556,.58556,0,0,.89444],8834:[.08556,.58556,0,0,.89444],8835:[.08556,.58556,0,0,.89444],8838:[.19667,.69667,0,0,.89444],8839:[.19667,.69667,0,0,.89444],8846:[0,.55556,0,0,.76666],8849:[.19667,.69667,0,0,.89444],8850:[.19667,.69667,0,0,.89444],8851:[0,.55556,0,0,.76666],8852:[0,.55556,0,0,.76666],8853:[.13333,.63333,0,0,.89444],8854:[.13333,.63333,0,0,.89444],8855:[.13333,.63333,0,0,.89444],8856:[.13333,.63333,0,0,.89444],8857:[.13333,.63333,0,0,.89444],8866:[0,.69444,0,0,.70277],8867:[0,.69444,0,0,.70277],8868:[0,.69444,0,0,.89444],8869:[0,.69444,0,0,.89444],8900:[-.02639,.47361,0,0,.575],8901:[-.02639,.47361,0,0,.31944],8902:[-.02778,.47222,0,0,.575],8968:[.25,.75,0,0,.51111],8969:[.25,.75,0,0,.51111],8970:[.25,.75,0,0,.51111],8971:[.25,.75,0,0,.51111],8994:[-.13889,.36111,0,0,1.14999],8995:[-.13889,.36111,0,0,1.14999],9651:[.19444,.69444,0,0,1.02222],9657:[-.02778,.47222,0,0,.575],9661:[.19444,.69444,0,0,1.02222],9667:[-.02778,.47222,0,0,.575],9711:[.19444,.69444,0,0,1.14999],9824:[.12963,.69444,0,0,.89444],9825:[.12963,.69444,0,0,.89444],9826:[.12963,.69444,0,0,.89444],9827:[.12963,.69444,0,0,.89444],9837:[0,.75,0,0,.44722],9838:[.19444,.69444,0,0,.44722],9839:[.19444,.69444,0,0,.44722],10216:[.25,.75,0,0,.44722],10217:[.25,.75,0,0,.44722],10815:[0,.68611,0,0,.9],10927:[.19667,.69667,0,0,.89444],10928:[.19667,.69667,0,0,.89444],57376:[.19444,.69444,0,0,0]},"Main-BoldItalic":{32:[0,0,0,0,.25],33:[0,.69444,.11417,0,.38611],34:[0,.69444,.07939,0,.62055],35:[.19444,.69444,.06833,0,.94444],37:[.05556,.75,.12861,0,.94444],38:[0,.69444,.08528,0,.88555],39:[0,.69444,.12945,0,.35555],40:[.25,.75,.15806,0,.47333],41:[.25,.75,.03306,0,.47333],42:[0,.75,.14333,0,.59111],43:[.10333,.60333,.03306,0,.88555],44:[.19444,.14722,0,0,.35555],45:[0,.44444,.02611,0,.41444],46:[0,.14722,0,0,.35555],47:[.25,.75,.15806,0,.59111],48:[0,.64444,.13167,0,.59111],49:[0,.64444,.13167,0,.59111],50:[0,.64444,.13167,0,.59111],51:[0,.64444,.13167,0,.59111],52:[.19444,.64444,.13167,0,.59111],53:[0,.64444,.13167,0,.59111],54:[0,.64444,.13167,0,.59111],55:[.19444,.64444,.13167,0,.59111],56:[0,.64444,.13167,0,.59111],57:[0,.64444,.13167,0,.59111],58:[0,.44444,.06695,0,.35555],59:[.19444,.44444,.06695,0,.35555],61:[-.10889,.39111,.06833,0,.88555],63:[0,.69444,.11472,0,.59111],64:[0,.69444,.09208,0,.88555],65:[0,.68611,0,0,.86555],66:[0,.68611,.0992,0,.81666],67:[0,.68611,.14208,0,.82666],68:[0,.68611,.09062,0,.87555],69:[0,.68611,.11431,0,.75666],70:[0,.68611,.12903,0,.72722],71:[0,.68611,.07347,0,.89527],72:[0,.68611,.17208,0,.8961],73:[0,.68611,.15681,0,.47166],74:[0,.68611,.145,0,.61055],75:[0,.68611,.14208,0,.89499],76:[0,.68611,0,0,.69777],77:[0,.68611,.17208,0,1.07277],78:[0,.68611,.17208,0,.8961],79:[0,.68611,.09062,0,.85499],80:[0,.68611,.0992,0,.78721],81:[.19444,.68611,.09062,0,.85499],82:[0,.68611,.02559,0,.85944],83:[0,.68611,.11264,0,.64999],84:[0,.68611,.12903,0,.7961],85:[0,.68611,.17208,0,.88083],86:[0,.68611,.18625,0,.86555],87:[0,.68611,.18625,0,1.15999],88:[0,.68611,.15681,0,.86555],89:[0,.68611,.19803,0,.86555],90:[0,.68611,.14208,0,.70888],91:[.25,.75,.1875,0,.35611],93:[.25,.75,.09972,0,.35611],94:[0,.69444,.06709,0,.59111],95:[.31,.13444,.09811,0,.59111],97:[0,.44444,.09426,0,.59111],98:[0,.69444,.07861,0,.53222],99:[0,.44444,.05222,0,.53222],100:[0,.69444,.10861,0,.59111],101:[0,.44444,.085,0,.53222],102:[.19444,.69444,.21778,0,.4],103:[.19444,.44444,.105,0,.53222],104:[0,.69444,.09426,0,.59111],105:[0,.69326,.11387,0,.35555],106:[.19444,.69326,.1672,0,.35555],107:[0,.69444,.11111,0,.53222],108:[0,.69444,.10861,0,.29666],109:[0,.44444,.09426,0,.94444],110:[0,.44444,.09426,0,.64999],111:[0,.44444,.07861,0,.59111],112:[.19444,.44444,.07861,0,.59111],113:[.19444,.44444,.105,0,.53222],114:[0,.44444,.11111,0,.50167],115:[0,.44444,.08167,0,.48694],116:[0,.63492,.09639,0,.385],117:[0,.44444,.09426,0,.62055],118:[0,.44444,.11111,0,.53222],119:[0,.44444,.11111,0,.76777],120:[0,.44444,.12583,0,.56055],121:[.19444,.44444,.105,0,.56166],122:[0,.44444,.13889,0,.49055],126:[.35,.34444,.11472,0,.59111],160:[0,0,0,0,.25],168:[0,.69444,.11473,0,.59111],176:[0,.69444,0,0,.94888],184:[.17014,0,0,0,.53222],198:[0,.68611,.11431,0,1.02277],216:[.04861,.73472,.09062,0,.88555],223:[.19444,.69444,.09736,0,.665],230:[0,.44444,.085,0,.82666],248:[.09722,.54167,.09458,0,.59111],305:[0,.44444,.09426,0,.35555],338:[0,.68611,.11431,0,1.14054],339:[0,.44444,.085,0,.82666],567:[.19444,.44444,.04611,0,.385],710:[0,.69444,.06709,0,.59111],711:[0,.63194,.08271,0,.59111],713:[0,.59444,.10444,0,.59111],714:[0,.69444,.08528,0,.59111],715:[0,.69444,0,0,.59111],728:[0,.69444,.10333,0,.59111],729:[0,.69444,.12945,0,.35555],730:[0,.69444,0,0,.94888],732:[0,.69444,.11472,0,.59111],733:[0,.69444,.11472,0,.59111],915:[0,.68611,.12903,0,.69777],916:[0,.68611,0,0,.94444],920:[0,.68611,.09062,0,.88555],923:[0,.68611,0,0,.80666],926:[0,.68611,.15092,0,.76777],928:[0,.68611,.17208,0,.8961],931:[0,.68611,.11431,0,.82666],933:[0,.68611,.10778,0,.88555],934:[0,.68611,.05632,0,.82666],936:[0,.68611,.10778,0,.88555],937:[0,.68611,.0992,0,.82666],8211:[0,.44444,.09811,0,.59111],8212:[0,.44444,.09811,0,1.18221],8216:[0,.69444,.12945,0,.35555],8217:[0,.69444,.12945,0,.35555],8220:[0,.69444,.16772,0,.62055],8221:[0,.69444,.07939,0,.62055]},"Main-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.12417,0,.30667],34:[0,.69444,.06961,0,.51444],35:[.19444,.69444,.06616,0,.81777],37:[.05556,.75,.13639,0,.81777],38:[0,.69444,.09694,0,.76666],39:[0,.69444,.12417,0,.30667],40:[.25,.75,.16194,0,.40889],41:[.25,.75,.03694,0,.40889],42:[0,.75,.14917,0,.51111],43:[.05667,.56167,.03694,0,.76666],44:[.19444,.10556,0,0,.30667],45:[0,.43056,.02826,0,.35778],46:[0,.10556,0,0,.30667],47:[.25,.75,.16194,0,.51111],48:[0,.64444,.13556,0,.51111],49:[0,.64444,.13556,0,.51111],50:[0,.64444,.13556,0,.51111],51:[0,.64444,.13556,0,.51111],52:[.19444,.64444,.13556,0,.51111],53:[0,.64444,.13556,0,.51111],54:[0,.64444,.13556,0,.51111],55:[.19444,.64444,.13556,0,.51111],56:[0,.64444,.13556,0,.51111],57:[0,.64444,.13556,0,.51111],58:[0,.43056,.0582,0,.30667],59:[.19444,.43056,.0582,0,.30667],61:[-.13313,.36687,.06616,0,.76666],63:[0,.69444,.1225,0,.51111],64:[0,.69444,.09597,0,.76666],65:[0,.68333,0,0,.74333],66:[0,.68333,.10257,0,.70389],67:[0,.68333,.14528,0,.71555],68:[0,.68333,.09403,0,.755],69:[0,.68333,.12028,0,.67833],70:[0,.68333,.13305,0,.65277],71:[0,.68333,.08722,0,.77361],72:[0,.68333,.16389,0,.74333],73:[0,.68333,.15806,0,.38555],74:[0,.68333,.14028,0,.525],75:[0,.68333,.14528,0,.76888],76:[0,.68333,0,0,.62722],77:[0,.68333,.16389,0,.89666],78:[0,.68333,.16389,0,.74333],79:[0,.68333,.09403,0,.76666],80:[0,.68333,.10257,0,.67833],81:[.19444,.68333,.09403,0,.76666],82:[0,.68333,.03868,0,.72944],83:[0,.68333,.11972,0,.56222],84:[0,.68333,.13305,0,.71555],85:[0,.68333,.16389,0,.74333],86:[0,.68333,.18361,0,.74333],87:[0,.68333,.18361,0,.99888],88:[0,.68333,.15806,0,.74333],89:[0,.68333,.19383,0,.74333],90:[0,.68333,.14528,0,.61333],91:[.25,.75,.1875,0,.30667],93:[.25,.75,.10528,0,.30667],94:[0,.69444,.06646,0,.51111],95:[.31,.12056,.09208,0,.51111],97:[0,.43056,.07671,0,.51111],98:[0,.69444,.06312,0,.46],99:[0,.43056,.05653,0,.46],100:[0,.69444,.10333,0,.51111],101:[0,.43056,.07514,0,.46],102:[.19444,.69444,.21194,0,.30667],103:[.19444,.43056,.08847,0,.46],104:[0,.69444,.07671,0,.51111],105:[0,.65536,.1019,0,.30667],106:[.19444,.65536,.14467,0,.30667],107:[0,.69444,.10764,0,.46],108:[0,.69444,.10333,0,.25555],109:[0,.43056,.07671,0,.81777],110:[0,.43056,.07671,0,.56222],111:[0,.43056,.06312,0,.51111],112:[.19444,.43056,.06312,0,.51111],113:[.19444,.43056,.08847,0,.46],114:[0,.43056,.10764,0,.42166],115:[0,.43056,.08208,0,.40889],116:[0,.61508,.09486,0,.33222],117:[0,.43056,.07671,0,.53666],118:[0,.43056,.10764,0,.46],119:[0,.43056,.10764,0,.66444],120:[0,.43056,.12042,0,.46389],121:[.19444,.43056,.08847,0,.48555],122:[0,.43056,.12292,0,.40889],126:[.35,.31786,.11585,0,.51111],160:[0,0,0,0,.25],168:[0,.66786,.10474,0,.51111],176:[0,.69444,0,0,.83129],184:[.17014,0,0,0,.46],198:[0,.68333,.12028,0,.88277],216:[.04861,.73194,.09403,0,.76666],223:[.19444,.69444,.10514,0,.53666],230:[0,.43056,.07514,0,.71555],248:[.09722,.52778,.09194,0,.51111],338:[0,.68333,.12028,0,.98499],339:[0,.43056,.07514,0,.71555],710:[0,.69444,.06646,0,.51111],711:[0,.62847,.08295,0,.51111],713:[0,.56167,.10333,0,.51111],714:[0,.69444,.09694,0,.51111],715:[0,.69444,0,0,.51111],728:[0,.69444,.10806,0,.51111],729:[0,.66786,.11752,0,.30667],730:[0,.69444,0,0,.83129],732:[0,.66786,.11585,0,.51111],733:[0,.69444,.1225,0,.51111],915:[0,.68333,.13305,0,.62722],916:[0,.68333,0,0,.81777],920:[0,.68333,.09403,0,.76666],923:[0,.68333,0,0,.69222],926:[0,.68333,.15294,0,.66444],928:[0,.68333,.16389,0,.74333],931:[0,.68333,.12028,0,.71555],933:[0,.68333,.11111,0,.76666],934:[0,.68333,.05986,0,.71555],936:[0,.68333,.11111,0,.76666],937:[0,.68333,.10257,0,.71555],8211:[0,.43056,.09208,0,.51111],8212:[0,.43056,.09208,0,1.02222],8216:[0,.69444,.12417,0,.30667],8217:[0,.69444,.12417,0,.30667],8220:[0,.69444,.1685,0,.51444],8221:[0,.69444,.06961,0,.51444],8463:[0,.68889,0,0,.54028]},"Main-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.27778],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.77778],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.19444,.10556,0,0,.27778],45:[0,.43056,0,0,.33333],46:[0,.10556,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.64444,0,0,.5],49:[0,.64444,0,0,.5],50:[0,.64444,0,0,.5],51:[0,.64444,0,0,.5],52:[0,.64444,0,0,.5],53:[0,.64444,0,0,.5],54:[0,.64444,0,0,.5],55:[0,.64444,0,0,.5],56:[0,.64444,0,0,.5],57:[0,.64444,0,0,.5],58:[0,.43056,0,0,.27778],59:[.19444,.43056,0,0,.27778],60:[.0391,.5391,0,0,.77778],61:[-.13313,.36687,0,0,.77778],62:[.0391,.5391,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.77778],65:[0,.68333,0,0,.75],66:[0,.68333,0,0,.70834],67:[0,.68333,0,0,.72222],68:[0,.68333,0,0,.76389],69:[0,.68333,0,0,.68056],70:[0,.68333,0,0,.65278],71:[0,.68333,0,0,.78472],72:[0,.68333,0,0,.75],73:[0,.68333,0,0,.36111],74:[0,.68333,0,0,.51389],75:[0,.68333,0,0,.77778],76:[0,.68333,0,0,.625],77:[0,.68333,0,0,.91667],78:[0,.68333,0,0,.75],79:[0,.68333,0,0,.77778],80:[0,.68333,0,0,.68056],81:[.19444,.68333,0,0,.77778],82:[0,.68333,0,0,.73611],83:[0,.68333,0,0,.55556],84:[0,.68333,0,0,.72222],85:[0,.68333,0,0,.75],86:[0,.68333,.01389,0,.75],87:[0,.68333,.01389,0,1.02778],88:[0,.68333,0,0,.75],89:[0,.68333,.025,0,.75],90:[0,.68333,0,0,.61111],91:[.25,.75,0,0,.27778],92:[.25,.75,0,0,.5],93:[.25,.75,0,0,.27778],94:[0,.69444,0,0,.5],95:[.31,.12056,.02778,0,.5],97:[0,.43056,0,0,.5],98:[0,.69444,0,0,.55556],99:[0,.43056,0,0,.44445],100:[0,.69444,0,0,.55556],101:[0,.43056,0,0,.44445],102:[0,.69444,.07778,0,.30556],103:[.19444,.43056,.01389,0,.5],104:[0,.69444,0,0,.55556],105:[0,.66786,0,0,.27778],106:[.19444,.66786,0,0,.30556],107:[0,.69444,0,0,.52778],108:[0,.69444,0,0,.27778],109:[0,.43056,0,0,.83334],110:[0,.43056,0,0,.55556],111:[0,.43056,0,0,.5],112:[.19444,.43056,0,0,.55556],113:[.19444,.43056,0,0,.52778],114:[0,.43056,0,0,.39167],115:[0,.43056,0,0,.39445],116:[0,.61508,0,0,.38889],117:[0,.43056,0,0,.55556],118:[0,.43056,.01389,0,.52778],119:[0,.43056,.01389,0,.72222],120:[0,.43056,0,0,.52778],121:[.19444,.43056,.01389,0,.52778],122:[0,.43056,0,0,.44445],123:[.25,.75,0,0,.5],124:[.25,.75,0,0,.27778],125:[.25,.75,0,0,.5],126:[.35,.31786,0,0,.5],160:[0,0,0,0,.25],163:[0,.69444,0,0,.76909],167:[.19444,.69444,0,0,.44445],168:[0,.66786,0,0,.5],172:[0,.43056,0,0,.66667],176:[0,.69444,0,0,.75],177:[.08333,.58333,0,0,.77778],182:[.19444,.69444,0,0,.61111],184:[.17014,0,0,0,.44445],198:[0,.68333,0,0,.90278],215:[.08333,.58333,0,0,.77778],216:[.04861,.73194,0,0,.77778],223:[0,.69444,0,0,.5],230:[0,.43056,0,0,.72222],247:[.08333,.58333,0,0,.77778],248:[.09722,.52778,0,0,.5],305:[0,.43056,0,0,.27778],338:[0,.68333,0,0,1.01389],339:[0,.43056,0,0,.77778],567:[.19444,.43056,0,0,.30556],710:[0,.69444,0,0,.5],711:[0,.62847,0,0,.5],713:[0,.56778,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.66786,0,0,.27778],730:[0,.69444,0,0,.75],732:[0,.66786,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.68333,0,0,.625],916:[0,.68333,0,0,.83334],920:[0,.68333,0,0,.77778],923:[0,.68333,0,0,.69445],926:[0,.68333,0,0,.66667],928:[0,.68333,0,0,.75],931:[0,.68333,0,0,.72222],933:[0,.68333,0,0,.77778],934:[0,.68333,0,0,.72222],936:[0,.68333,0,0,.77778],937:[0,.68333,0,0,.72222],8211:[0,.43056,.02778,0,.5],8212:[0,.43056,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5],8224:[.19444,.69444,0,0,.44445],8225:[.19444,.69444,0,0,.44445],8230:[0,.123,0,0,1.172],8242:[0,.55556,0,0,.275],8407:[0,.71444,.15382,0,.5],8463:[0,.68889,0,0,.54028],8465:[0,.69444,0,0,.72222],8467:[0,.69444,0,.11111,.41667],8472:[.19444,.43056,0,.11111,.63646],8476:[0,.69444,0,0,.72222],8501:[0,.69444,0,0,.61111],8592:[-.13313,.36687,0,0,1],8593:[.19444,.69444,0,0,.5],8594:[-.13313,.36687,0,0,1],8595:[.19444,.69444,0,0,.5],8596:[-.13313,.36687,0,0,1],8597:[.25,.75,0,0,.5],8598:[.19444,.69444,0,0,1],8599:[.19444,.69444,0,0,1],8600:[.19444,.69444,0,0,1],8601:[.19444,.69444,0,0,1],8614:[.011,.511,0,0,1],8617:[.011,.511,0,0,1.126],8618:[.011,.511,0,0,1.126],8636:[-.13313,.36687,0,0,1],8637:[-.13313,.36687,0,0,1],8640:[-.13313,.36687,0,0,1],8641:[-.13313,.36687,0,0,1],8652:[.011,.671,0,0,1],8656:[-.13313,.36687,0,0,1],8657:[.19444,.69444,0,0,.61111],8658:[-.13313,.36687,0,0,1],8659:[.19444,.69444,0,0,.61111],8660:[-.13313,.36687,0,0,1],8661:[.25,.75,0,0,.61111],8704:[0,.69444,0,0,.55556],8706:[0,.69444,.05556,.08334,.5309],8707:[0,.69444,0,0,.55556],8709:[.05556,.75,0,0,.5],8711:[0,.68333,0,0,.83334],8712:[.0391,.5391,0,0,.66667],8715:[.0391,.5391,0,0,.66667],8722:[.08333,.58333,0,0,.77778],8723:[.08333,.58333,0,0,.77778],8725:[.25,.75,0,0,.5],8726:[.25,.75,0,0,.5],8727:[-.03472,.46528,0,0,.5],8728:[-.05555,.44445,0,0,.5],8729:[-.05555,.44445,0,0,.5],8730:[.2,.8,0,0,.83334],8733:[0,.43056,0,0,.77778],8734:[0,.43056,0,0,1],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.27778],8741:[.25,.75,0,0,.5],8743:[0,.55556,0,0,.66667],8744:[0,.55556,0,0,.66667],8745:[0,.55556,0,0,.66667],8746:[0,.55556,0,0,.66667],8747:[.19444,.69444,.11111,0,.41667],8764:[-.13313,.36687,0,0,.77778],8768:[.19444,.69444,0,0,.27778],8771:[-.03625,.46375,0,0,.77778],8773:[-.022,.589,0,0,.778],8776:[-.01688,.48312,0,0,.77778],8781:[-.03625,.46375,0,0,.77778],8784:[-.133,.673,0,0,.778],8801:[-.03625,.46375,0,0,.77778],8804:[.13597,.63597,0,0,.77778],8805:[.13597,.63597,0,0,.77778],8810:[.0391,.5391,0,0,1],8811:[.0391,.5391,0,0,1],8826:[.0391,.5391,0,0,.77778],8827:[.0391,.5391,0,0,.77778],8834:[.0391,.5391,0,0,.77778],8835:[.0391,.5391,0,0,.77778],8838:[.13597,.63597,0,0,.77778],8839:[.13597,.63597,0,0,.77778],8846:[0,.55556,0,0,.66667],8849:[.13597,.63597,0,0,.77778],8850:[.13597,.63597,0,0,.77778],8851:[0,.55556,0,0,.66667],8852:[0,.55556,0,0,.66667],8853:[.08333,.58333,0,0,.77778],8854:[.08333,.58333,0,0,.77778],8855:[.08333,.58333,0,0,.77778],8856:[.08333,.58333,0,0,.77778],8857:[.08333,.58333,0,0,.77778],8866:[0,.69444,0,0,.61111],8867:[0,.69444,0,0,.61111],8868:[0,.69444,0,0,.77778],8869:[0,.69444,0,0,.77778],8872:[.249,.75,0,0,.867],8900:[-.05555,.44445,0,0,.5],8901:[-.05555,.44445,0,0,.27778],8902:[-.03472,.46528,0,0,.5],8904:[.005,.505,0,0,.9],8942:[.03,.903,0,0,.278],8943:[-.19,.313,0,0,1.172],8945:[-.1,.823,0,0,1.282],8968:[.25,.75,0,0,.44445],8969:[.25,.75,0,0,.44445],8970:[.25,.75,0,0,.44445],8971:[.25,.75,0,0,.44445],8994:[-.14236,.35764,0,0,1],8995:[-.14236,.35764,0,0,1],9136:[.244,.744,0,0,.412],9137:[.244,.745,0,0,.412],9651:[.19444,.69444,0,0,.88889],9657:[-.03472,.46528,0,0,.5],9661:[.19444,.69444,0,0,.88889],9667:[-.03472,.46528,0,0,.5],9711:[.19444,.69444,0,0,1],9824:[.12963,.69444,0,0,.77778],9825:[.12963,.69444,0,0,.77778],9826:[.12963,.69444,0,0,.77778],9827:[.12963,.69444,0,0,.77778],9837:[0,.75,0,0,.38889],9838:[.19444,.69444,0,0,.38889],9839:[.19444,.69444,0,0,.38889],10216:[.25,.75,0,0,.38889],10217:[.25,.75,0,0,.38889],10222:[.244,.744,0,0,.412],10223:[.244,.745,0,0,.412],10229:[.011,.511,0,0,1.609],10230:[.011,.511,0,0,1.638],10231:[.011,.511,0,0,1.859],10232:[.024,.525,0,0,1.609],10233:[.024,.525,0,0,1.638],10234:[.024,.525,0,0,1.858],10236:[.011,.511,0,0,1.638],10815:[0,.68333,0,0,.75],10927:[.13597,.63597,0,0,.77778],10928:[.13597,.63597,0,0,.77778],57376:[.19444,.69444,0,0,0]},"Math-BoldItalic":{32:[0,0,0,0,.25],48:[0,.44444,0,0,.575],49:[0,.44444,0,0,.575],50:[0,.44444,0,0,.575],51:[.19444,.44444,0,0,.575],52:[.19444,.44444,0,0,.575],53:[.19444,.44444,0,0,.575],54:[0,.64444,0,0,.575],55:[.19444,.44444,0,0,.575],56:[0,.64444,0,0,.575],57:[.19444,.44444,0,0,.575],65:[0,.68611,0,0,.86944],66:[0,.68611,.04835,0,.8664],67:[0,.68611,.06979,0,.81694],68:[0,.68611,.03194,0,.93812],69:[0,.68611,.05451,0,.81007],70:[0,.68611,.15972,0,.68889],71:[0,.68611,0,0,.88673],72:[0,.68611,.08229,0,.98229],73:[0,.68611,.07778,0,.51111],74:[0,.68611,.10069,0,.63125],75:[0,.68611,.06979,0,.97118],76:[0,.68611,0,0,.75555],77:[0,.68611,.11424,0,1.14201],78:[0,.68611,.11424,0,.95034],79:[0,.68611,.03194,0,.83666],80:[0,.68611,.15972,0,.72309],81:[.19444,.68611,0,0,.86861],82:[0,.68611,.00421,0,.87235],83:[0,.68611,.05382,0,.69271],84:[0,.68611,.15972,0,.63663],85:[0,.68611,.11424,0,.80027],86:[0,.68611,.25555,0,.67778],87:[0,.68611,.15972,0,1.09305],88:[0,.68611,.07778,0,.94722],89:[0,.68611,.25555,0,.67458],90:[0,.68611,.06979,0,.77257],97:[0,.44444,0,0,.63287],98:[0,.69444,0,0,.52083],99:[0,.44444,0,0,.51342],100:[0,.69444,0,0,.60972],101:[0,.44444,0,0,.55361],102:[.19444,.69444,.11042,0,.56806],103:[.19444,.44444,.03704,0,.5449],104:[0,.69444,0,0,.66759],105:[0,.69326,0,0,.4048],106:[.19444,.69326,.0622,0,.47083],107:[0,.69444,.01852,0,.6037],108:[0,.69444,.0088,0,.34815],109:[0,.44444,0,0,1.0324],110:[0,.44444,0,0,.71296],111:[0,.44444,0,0,.58472],112:[.19444,.44444,0,0,.60092],113:[.19444,.44444,.03704,0,.54213],114:[0,.44444,.03194,0,.5287],115:[0,.44444,0,0,.53125],116:[0,.63492,0,0,.41528],117:[0,.44444,0,0,.68102],118:[0,.44444,.03704,0,.56666],119:[0,.44444,.02778,0,.83148],120:[0,.44444,0,0,.65903],121:[.19444,.44444,.03704,0,.59028],122:[0,.44444,.04213,0,.55509],160:[0,0,0,0,.25],915:[0,.68611,.15972,0,.65694],916:[0,.68611,0,0,.95833],920:[0,.68611,.03194,0,.86722],923:[0,.68611,0,0,.80555],926:[0,.68611,.07458,0,.84125],928:[0,.68611,.08229,0,.98229],931:[0,.68611,.05451,0,.88507],933:[0,.68611,.15972,0,.67083],934:[0,.68611,0,0,.76666],936:[0,.68611,.11653,0,.71402],937:[0,.68611,.04835,0,.8789],945:[0,.44444,0,0,.76064],946:[.19444,.69444,.03403,0,.65972],947:[.19444,.44444,.06389,0,.59003],948:[0,.69444,.03819,0,.52222],949:[0,.44444,0,0,.52882],950:[.19444,.69444,.06215,0,.50833],951:[.19444,.44444,.03704,0,.6],952:[0,.69444,.03194,0,.5618],953:[0,.44444,0,0,.41204],954:[0,.44444,0,0,.66759],955:[0,.69444,0,0,.67083],956:[.19444,.44444,0,0,.70787],957:[0,.44444,.06898,0,.57685],958:[.19444,.69444,.03021,0,.50833],959:[0,.44444,0,0,.58472],960:[0,.44444,.03704,0,.68241],961:[.19444,.44444,0,0,.6118],962:[.09722,.44444,.07917,0,.42361],963:[0,.44444,.03704,0,.68588],964:[0,.44444,.13472,0,.52083],965:[0,.44444,.03704,0,.63055],966:[.19444,.44444,0,0,.74722],967:[.19444,.44444,0,0,.71805],968:[.19444,.69444,.03704,0,.75833],969:[0,.44444,.03704,0,.71782],977:[0,.69444,0,0,.69155],981:[.19444,.69444,0,0,.7125],982:[0,.44444,.03194,0,.975],1009:[.19444,.44444,0,0,.6118],1013:[0,.44444,0,0,.48333],57649:[0,.44444,0,0,.39352],57911:[.19444,.44444,0,0,.43889]},"Math-Italic":{32:[0,0,0,0,.25],48:[0,.43056,0,0,.5],49:[0,.43056,0,0,.5],50:[0,.43056,0,0,.5],51:[.19444,.43056,0,0,.5],52:[.19444,.43056,0,0,.5],53:[.19444,.43056,0,0,.5],54:[0,.64444,0,0,.5],55:[.19444,.43056,0,0,.5],56:[0,.64444,0,0,.5],57:[.19444,.43056,0,0,.5],65:[0,.68333,0,.13889,.75],66:[0,.68333,.05017,.08334,.75851],67:[0,.68333,.07153,.08334,.71472],68:[0,.68333,.02778,.05556,.82792],69:[0,.68333,.05764,.08334,.7382],70:[0,.68333,.13889,.08334,.64306],71:[0,.68333,0,.08334,.78625],72:[0,.68333,.08125,.05556,.83125],73:[0,.68333,.07847,.11111,.43958],74:[0,.68333,.09618,.16667,.55451],75:[0,.68333,.07153,.05556,.84931],76:[0,.68333,0,.02778,.68056],77:[0,.68333,.10903,.08334,.97014],78:[0,.68333,.10903,.08334,.80347],79:[0,.68333,.02778,.08334,.76278],80:[0,.68333,.13889,.08334,.64201],81:[.19444,.68333,0,.08334,.79056],82:[0,.68333,.00773,.08334,.75929],83:[0,.68333,.05764,.08334,.6132],84:[0,.68333,.13889,.08334,.58438],85:[0,.68333,.10903,.02778,.68278],86:[0,.68333,.22222,0,.58333],87:[0,.68333,.13889,0,.94445],88:[0,.68333,.07847,.08334,.82847],89:[0,.68333,.22222,0,.58056],90:[0,.68333,.07153,.08334,.68264],97:[0,.43056,0,0,.52859],98:[0,.69444,0,0,.42917],99:[0,.43056,0,.05556,.43276],100:[0,.69444,0,.16667,.52049],101:[0,.43056,0,.05556,.46563],102:[.19444,.69444,.10764,.16667,.48959],103:[.19444,.43056,.03588,.02778,.47697],104:[0,.69444,0,0,.57616],105:[0,.65952,0,0,.34451],106:[.19444,.65952,.05724,0,.41181],107:[0,.69444,.03148,0,.5206],108:[0,.69444,.01968,.08334,.29838],109:[0,.43056,0,0,.87801],110:[0,.43056,0,0,.60023],111:[0,.43056,0,.05556,.48472],112:[.19444,.43056,0,.08334,.50313],113:[.19444,.43056,.03588,.08334,.44641],114:[0,.43056,.02778,.05556,.45116],115:[0,.43056,0,.05556,.46875],116:[0,.61508,0,.08334,.36111],117:[0,.43056,0,.02778,.57246],118:[0,.43056,.03588,.02778,.48472],119:[0,.43056,.02691,.08334,.71592],120:[0,.43056,0,.02778,.57153],121:[.19444,.43056,.03588,.05556,.49028],122:[0,.43056,.04398,.05556,.46505],160:[0,0,0,0,.25],915:[0,.68333,.13889,.08334,.61528],916:[0,.68333,0,.16667,.83334],920:[0,.68333,.02778,.08334,.76278],923:[0,.68333,0,.16667,.69445],926:[0,.68333,.07569,.08334,.74236],928:[0,.68333,.08125,.05556,.83125],931:[0,.68333,.05764,.08334,.77986],933:[0,.68333,.13889,.05556,.58333],934:[0,.68333,0,.08334,.66667],936:[0,.68333,.11,.05556,.61222],937:[0,.68333,.05017,.08334,.7724],945:[0,.43056,.0037,.02778,.6397],946:[.19444,.69444,.05278,.08334,.56563],947:[.19444,.43056,.05556,0,.51773],948:[0,.69444,.03785,.05556,.44444],949:[0,.43056,0,.08334,.46632],950:[.19444,.69444,.07378,.08334,.4375],951:[.19444,.43056,.03588,.05556,.49653],952:[0,.69444,.02778,.08334,.46944],953:[0,.43056,0,.05556,.35394],954:[0,.43056,0,0,.57616],955:[0,.69444,0,0,.58334],956:[.19444,.43056,0,.02778,.60255],957:[0,.43056,.06366,.02778,.49398],958:[.19444,.69444,.04601,.11111,.4375],959:[0,.43056,0,.05556,.48472],960:[0,.43056,.03588,0,.57003],961:[.19444,.43056,0,.08334,.51702],962:[.09722,.43056,.07986,.08334,.36285],963:[0,.43056,.03588,0,.57141],964:[0,.43056,.1132,.02778,.43715],965:[0,.43056,.03588,.02778,.54028],966:[.19444,.43056,0,.08334,.65417],967:[.19444,.43056,0,.05556,.62569],968:[.19444,.69444,.03588,.11111,.65139],969:[0,.43056,.03588,0,.62245],977:[0,.69444,0,.08334,.59144],981:[.19444,.69444,0,.08334,.59583],982:[0,.43056,.02778,0,.82813],1009:[.19444,.43056,0,.08334,.51702],1013:[0,.43056,0,.05556,.4059],57649:[0,.43056,0,.02778,.32246],57911:[.19444,.43056,0,.08334,.38403]},"SansSerif-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.36667],34:[0,.69444,0,0,.55834],35:[.19444,.69444,0,0,.91667],36:[.05556,.75,0,0,.55],37:[.05556,.75,0,0,1.02912],38:[0,.69444,0,0,.83056],39:[0,.69444,0,0,.30556],40:[.25,.75,0,0,.42778],41:[.25,.75,0,0,.42778],42:[0,.75,0,0,.55],43:[.11667,.61667,0,0,.85556],44:[.10556,.13056,0,0,.30556],45:[0,.45833,0,0,.36667],46:[0,.13056,0,0,.30556],47:[.25,.75,0,0,.55],48:[0,.69444,0,0,.55],49:[0,.69444,0,0,.55],50:[0,.69444,0,0,.55],51:[0,.69444,0,0,.55],52:[0,.69444,0,0,.55],53:[0,.69444,0,0,.55],54:[0,.69444,0,0,.55],55:[0,.69444,0,0,.55],56:[0,.69444,0,0,.55],57:[0,.69444,0,0,.55],58:[0,.45833,0,0,.30556],59:[.10556,.45833,0,0,.30556],61:[-.09375,.40625,0,0,.85556],63:[0,.69444,0,0,.51945],64:[0,.69444,0,0,.73334],65:[0,.69444,0,0,.73334],66:[0,.69444,0,0,.73334],67:[0,.69444,0,0,.70278],68:[0,.69444,0,0,.79445],69:[0,.69444,0,0,.64167],70:[0,.69444,0,0,.61111],71:[0,.69444,0,0,.73334],72:[0,.69444,0,0,.79445],73:[0,.69444,0,0,.33056],74:[0,.69444,0,0,.51945],75:[0,.69444,0,0,.76389],76:[0,.69444,0,0,.58056],77:[0,.69444,0,0,.97778],78:[0,.69444,0,0,.79445],79:[0,.69444,0,0,.79445],80:[0,.69444,0,0,.70278],81:[.10556,.69444,0,0,.79445],82:[0,.69444,0,0,.70278],83:[0,.69444,0,0,.61111],84:[0,.69444,0,0,.73334],85:[0,.69444,0,0,.76389],86:[0,.69444,.01528,0,.73334],87:[0,.69444,.01528,0,1.03889],88:[0,.69444,0,0,.73334],89:[0,.69444,.0275,0,.73334],90:[0,.69444,0,0,.67223],91:[.25,.75,0,0,.34306],93:[.25,.75,0,0,.34306],94:[0,.69444,0,0,.55],95:[.35,.10833,.03056,0,.55],97:[0,.45833,0,0,.525],98:[0,.69444,0,0,.56111],99:[0,.45833,0,0,.48889],100:[0,.69444,0,0,.56111],101:[0,.45833,0,0,.51111],102:[0,.69444,.07639,0,.33611],103:[.19444,.45833,.01528,0,.55],104:[0,.69444,0,0,.56111],105:[0,.69444,0,0,.25556],106:[.19444,.69444,0,0,.28611],107:[0,.69444,0,0,.53056],108:[0,.69444,0,0,.25556],109:[0,.45833,0,0,.86667],110:[0,.45833,0,0,.56111],111:[0,.45833,0,0,.55],112:[.19444,.45833,0,0,.56111],113:[.19444,.45833,0,0,.56111],114:[0,.45833,.01528,0,.37222],115:[0,.45833,0,0,.42167],116:[0,.58929,0,0,.40417],117:[0,.45833,0,0,.56111],118:[0,.45833,.01528,0,.5],119:[0,.45833,.01528,0,.74445],120:[0,.45833,0,0,.5],121:[.19444,.45833,.01528,0,.5],122:[0,.45833,0,0,.47639],126:[.35,.34444,0,0,.55],160:[0,0,0,0,.25],168:[0,.69444,0,0,.55],176:[0,.69444,0,0,.73334],180:[0,.69444,0,0,.55],184:[.17014,0,0,0,.48889],305:[0,.45833,0,0,.25556],567:[.19444,.45833,0,0,.28611],710:[0,.69444,0,0,.55],711:[0,.63542,0,0,.55],713:[0,.63778,0,0,.55],728:[0,.69444,0,0,.55],729:[0,.69444,0,0,.30556],730:[0,.69444,0,0,.73334],732:[0,.69444,0,0,.55],733:[0,.69444,0,0,.55],915:[0,.69444,0,0,.58056],916:[0,.69444,0,0,.91667],920:[0,.69444,0,0,.85556],923:[0,.69444,0,0,.67223],926:[0,.69444,0,0,.73334],928:[0,.69444,0,0,.79445],931:[0,.69444,0,0,.79445],933:[0,.69444,0,0,.85556],934:[0,.69444,0,0,.79445],936:[0,.69444,0,0,.85556],937:[0,.69444,0,0,.79445],8211:[0,.45833,.03056,0,.55],8212:[0,.45833,.03056,0,1.10001],8216:[0,.69444,0,0,.30556],8217:[0,.69444,0,0,.30556],8220:[0,.69444,0,0,.55834],8221:[0,.69444,0,0,.55834]},"SansSerif-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.05733,0,.31945],34:[0,.69444,.00316,0,.5],35:[.19444,.69444,.05087,0,.83334],36:[.05556,.75,.11156,0,.5],37:[.05556,.75,.03126,0,.83334],38:[0,.69444,.03058,0,.75834],39:[0,.69444,.07816,0,.27778],40:[.25,.75,.13164,0,.38889],41:[.25,.75,.02536,0,.38889],42:[0,.75,.11775,0,.5],43:[.08333,.58333,.02536,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,.01946,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,.13164,0,.5],48:[0,.65556,.11156,0,.5],49:[0,.65556,.11156,0,.5],50:[0,.65556,.11156,0,.5],51:[0,.65556,.11156,0,.5],52:[0,.65556,.11156,0,.5],53:[0,.65556,.11156,0,.5],54:[0,.65556,.11156,0,.5],55:[0,.65556,.11156,0,.5],56:[0,.65556,.11156,0,.5],57:[0,.65556,.11156,0,.5],58:[0,.44444,.02502,0,.27778],59:[.125,.44444,.02502,0,.27778],61:[-.13,.37,.05087,0,.77778],63:[0,.69444,.11809,0,.47222],64:[0,.69444,.07555,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,.08293,0,.66667],67:[0,.69444,.11983,0,.63889],68:[0,.69444,.07555,0,.72223],69:[0,.69444,.11983,0,.59722],70:[0,.69444,.13372,0,.56945],71:[0,.69444,.11983,0,.66667],72:[0,.69444,.08094,0,.70834],73:[0,.69444,.13372,0,.27778],74:[0,.69444,.08094,0,.47222],75:[0,.69444,.11983,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,.08094,0,.875],78:[0,.69444,.08094,0,.70834],79:[0,.69444,.07555,0,.73611],80:[0,.69444,.08293,0,.63889],81:[.125,.69444,.07555,0,.73611],82:[0,.69444,.08293,0,.64584],83:[0,.69444,.09205,0,.55556],84:[0,.69444,.13372,0,.68056],85:[0,.69444,.08094,0,.6875],86:[0,.69444,.1615,0,.66667],87:[0,.69444,.1615,0,.94445],88:[0,.69444,.13372,0,.66667],89:[0,.69444,.17261,0,.66667],90:[0,.69444,.11983,0,.61111],91:[.25,.75,.15942,0,.28889],93:[.25,.75,.08719,0,.28889],94:[0,.69444,.0799,0,.5],95:[.35,.09444,.08616,0,.5],97:[0,.44444,.00981,0,.48056],98:[0,.69444,.03057,0,.51667],99:[0,.44444,.08336,0,.44445],100:[0,.69444,.09483,0,.51667],101:[0,.44444,.06778,0,.44445],102:[0,.69444,.21705,0,.30556],103:[.19444,.44444,.10836,0,.5],104:[0,.69444,.01778,0,.51667],105:[0,.67937,.09718,0,.23889],106:[.19444,.67937,.09162,0,.26667],107:[0,.69444,.08336,0,.48889],108:[0,.69444,.09483,0,.23889],109:[0,.44444,.01778,0,.79445],110:[0,.44444,.01778,0,.51667],111:[0,.44444,.06613,0,.5],112:[.19444,.44444,.0389,0,.51667],113:[.19444,.44444,.04169,0,.51667],114:[0,.44444,.10836,0,.34167],115:[0,.44444,.0778,0,.38333],116:[0,.57143,.07225,0,.36111],117:[0,.44444,.04169,0,.51667],118:[0,.44444,.10836,0,.46111],119:[0,.44444,.10836,0,.68334],120:[0,.44444,.09169,0,.46111],121:[.19444,.44444,.10836,0,.46111],122:[0,.44444,.08752,0,.43472],126:[.35,.32659,.08826,0,.5],160:[0,0,0,0,.25],168:[0,.67937,.06385,0,.5],176:[0,.69444,0,0,.73752],184:[.17014,0,0,0,.44445],305:[0,.44444,.04169,0,.23889],567:[.19444,.44444,.04169,0,.26667],710:[0,.69444,.0799,0,.5],711:[0,.63194,.08432,0,.5],713:[0,.60889,.08776,0,.5],714:[0,.69444,.09205,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,.09483,0,.5],729:[0,.67937,.07774,0,.27778],730:[0,.69444,0,0,.73752],732:[0,.67659,.08826,0,.5],733:[0,.69444,.09205,0,.5],915:[0,.69444,.13372,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,.07555,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,.12816,0,.66667],928:[0,.69444,.08094,0,.70834],931:[0,.69444,.11983,0,.72222],933:[0,.69444,.09031,0,.77778],934:[0,.69444,.04603,0,.72222],936:[0,.69444,.09031,0,.77778],937:[0,.69444,.08293,0,.72222],8211:[0,.44444,.08616,0,.5],8212:[0,.44444,.08616,0,1],8216:[0,.69444,.07816,0,.27778],8217:[0,.69444,.07816,0,.27778],8220:[0,.69444,.14205,0,.5],8221:[0,.69444,.00316,0,.5]},"SansSerif-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.31945],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.75834],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,0,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.65556,0,0,.5],49:[0,.65556,0,0,.5],50:[0,.65556,0,0,.5],51:[0,.65556,0,0,.5],52:[0,.65556,0,0,.5],53:[0,.65556,0,0,.5],54:[0,.65556,0,0,.5],55:[0,.65556,0,0,.5],56:[0,.65556,0,0,.5],57:[0,.65556,0,0,.5],58:[0,.44444,0,0,.27778],59:[.125,.44444,0,0,.27778],61:[-.13,.37,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,0,0,.66667],67:[0,.69444,0,0,.63889],68:[0,.69444,0,0,.72223],69:[0,.69444,0,0,.59722],70:[0,.69444,0,0,.56945],71:[0,.69444,0,0,.66667],72:[0,.69444,0,0,.70834],73:[0,.69444,0,0,.27778],74:[0,.69444,0,0,.47222],75:[0,.69444,0,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,0,0,.875],78:[0,.69444,0,0,.70834],79:[0,.69444,0,0,.73611],80:[0,.69444,0,0,.63889],81:[.125,.69444,0,0,.73611],82:[0,.69444,0,0,.64584],83:[0,.69444,0,0,.55556],84:[0,.69444,0,0,.68056],85:[0,.69444,0,0,.6875],86:[0,.69444,.01389,0,.66667],87:[0,.69444,.01389,0,.94445],88:[0,.69444,0,0,.66667],89:[0,.69444,.025,0,.66667],90:[0,.69444,0,0,.61111],91:[.25,.75,0,0,.28889],93:[.25,.75,0,0,.28889],94:[0,.69444,0,0,.5],95:[.35,.09444,.02778,0,.5],97:[0,.44444,0,0,.48056],98:[0,.69444,0,0,.51667],99:[0,.44444,0,0,.44445],100:[0,.69444,0,0,.51667],101:[0,.44444,0,0,.44445],102:[0,.69444,.06944,0,.30556],103:[.19444,.44444,.01389,0,.5],104:[0,.69444,0,0,.51667],105:[0,.67937,0,0,.23889],106:[.19444,.67937,0,0,.26667],107:[0,.69444,0,0,.48889],108:[0,.69444,0,0,.23889],109:[0,.44444,0,0,.79445],110:[0,.44444,0,0,.51667],111:[0,.44444,0,0,.5],112:[.19444,.44444,0,0,.51667],113:[.19444,.44444,0,0,.51667],114:[0,.44444,.01389,0,.34167],115:[0,.44444,0,0,.38333],116:[0,.57143,0,0,.36111],117:[0,.44444,0,0,.51667],118:[0,.44444,.01389,0,.46111],119:[0,.44444,.01389,0,.68334],120:[0,.44444,0,0,.46111],121:[.19444,.44444,.01389,0,.46111],122:[0,.44444,0,0,.43472],126:[.35,.32659,0,0,.5],160:[0,0,0,0,.25],168:[0,.67937,0,0,.5],176:[0,.69444,0,0,.66667],184:[.17014,0,0,0,.44445],305:[0,.44444,0,0,.23889],567:[.19444,.44444,0,0,.26667],710:[0,.69444,0,0,.5],711:[0,.63194,0,0,.5],713:[0,.60889,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.67937,0,0,.27778],730:[0,.69444,0,0,.66667],732:[0,.67659,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.69444,0,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,0,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,0,0,.66667],928:[0,.69444,0,0,.70834],931:[0,.69444,0,0,.72222],933:[0,.69444,0,0,.77778],934:[0,.69444,0,0,.72222],936:[0,.69444,0,0,.77778],937:[0,.69444,0,0,.72222],8211:[0,.44444,.02778,0,.5],8212:[0,.44444,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5]},"Script-Regular":{32:[0,0,0,0,.25],65:[0,.7,.22925,0,.80253],66:[0,.7,.04087,0,.90757],67:[0,.7,.1689,0,.66619],68:[0,.7,.09371,0,.77443],69:[0,.7,.18583,0,.56162],70:[0,.7,.13634,0,.89544],71:[0,.7,.17322,0,.60961],72:[0,.7,.29694,0,.96919],73:[0,.7,.19189,0,.80907],74:[.27778,.7,.19189,0,1.05159],75:[0,.7,.31259,0,.91364],76:[0,.7,.19189,0,.87373],77:[0,.7,.15981,0,1.08031],78:[0,.7,.3525,0,.9015],79:[0,.7,.08078,0,.73787],80:[0,.7,.08078,0,1.01262],81:[0,.7,.03305,0,.88282],82:[0,.7,.06259,0,.85],83:[0,.7,.19189,0,.86767],84:[0,.7,.29087,0,.74697],85:[0,.7,.25815,0,.79996],86:[0,.7,.27523,0,.62204],87:[0,.7,.27523,0,.80532],88:[0,.7,.26006,0,.94445],89:[0,.7,.2939,0,.70961],90:[0,.7,.24037,0,.8212],160:[0,0,0,0,.25]},"Size1-Regular":{32:[0,0,0,0,.25],40:[.35001,.85,0,0,.45834],41:[.35001,.85,0,0,.45834],47:[.35001,.85,0,0,.57778],91:[.35001,.85,0,0,.41667],92:[.35001,.85,0,0,.57778],93:[.35001,.85,0,0,.41667],123:[.35001,.85,0,0,.58334],125:[.35001,.85,0,0,.58334],160:[0,0,0,0,.25],710:[0,.72222,0,0,.55556],732:[0,.72222,0,0,.55556],770:[0,.72222,0,0,.55556],771:[0,.72222,0,0,.55556],8214:[-99e-5,.601,0,0,.77778],8593:[1e-5,.6,0,0,.66667],8595:[1e-5,.6,0,0,.66667],8657:[1e-5,.6,0,0,.77778],8659:[1e-5,.6,0,0,.77778],8719:[.25001,.75,0,0,.94445],8720:[.25001,.75,0,0,.94445],8721:[.25001,.75,0,0,1.05556],8730:[.35001,.85,0,0,1],8739:[-.00599,.606,0,0,.33333],8741:[-.00599,.606,0,0,.55556],8747:[.30612,.805,.19445,0,.47222],8748:[.306,.805,.19445,0,.47222],8749:[.306,.805,.19445,0,.47222],8750:[.30612,.805,.19445,0,.47222],8896:[.25001,.75,0,0,.83334],8897:[.25001,.75,0,0,.83334],8898:[.25001,.75,0,0,.83334],8899:[.25001,.75,0,0,.83334],8968:[.35001,.85,0,0,.47222],8969:[.35001,.85,0,0,.47222],8970:[.35001,.85,0,0,.47222],8971:[.35001,.85,0,0,.47222],9168:[-99e-5,.601,0,0,.66667],10216:[.35001,.85,0,0,.47222],10217:[.35001,.85,0,0,.47222],10752:[.25001,.75,0,0,1.11111],10753:[.25001,.75,0,0,1.11111],10754:[.25001,.75,0,0,1.11111],10756:[.25001,.75,0,0,.83334],10758:[.25001,.75,0,0,.83334]},"Size2-Regular":{32:[0,0,0,0,.25],40:[.65002,1.15,0,0,.59722],41:[.65002,1.15,0,0,.59722],47:[.65002,1.15,0,0,.81111],91:[.65002,1.15,0,0,.47222],92:[.65002,1.15,0,0,.81111],93:[.65002,1.15,0,0,.47222],123:[.65002,1.15,0,0,.66667],125:[.65002,1.15,0,0,.66667],160:[0,0,0,0,.25],710:[0,.75,0,0,1],732:[0,.75,0,0,1],770:[0,.75,0,0,1],771:[0,.75,0,0,1],8719:[.55001,1.05,0,0,1.27778],8720:[.55001,1.05,0,0,1.27778],8721:[.55001,1.05,0,0,1.44445],8730:[.65002,1.15,0,0,1],8747:[.86225,1.36,.44445,0,.55556],8748:[.862,1.36,.44445,0,.55556],8749:[.862,1.36,.44445,0,.55556],8750:[.86225,1.36,.44445,0,.55556],8896:[.55001,1.05,0,0,1.11111],8897:[.55001,1.05,0,0,1.11111],8898:[.55001,1.05,0,0,1.11111],8899:[.55001,1.05,0,0,1.11111],8968:[.65002,1.15,0,0,.52778],8969:[.65002,1.15,0,0,.52778],8970:[.65002,1.15,0,0,.52778],8971:[.65002,1.15,0,0,.52778],10216:[.65002,1.15,0,0,.61111],10217:[.65002,1.15,0,0,.61111],10752:[.55001,1.05,0,0,1.51112],10753:[.55001,1.05,0,0,1.51112],10754:[.55001,1.05,0,0,1.51112],10756:[.55001,1.05,0,0,1.11111],10758:[.55001,1.05,0,0,1.11111]},"Size3-Regular":{32:[0,0,0,0,.25],40:[.95003,1.45,0,0,.73611],41:[.95003,1.45,0,0,.73611],47:[.95003,1.45,0,0,1.04445],91:[.95003,1.45,0,0,.52778],92:[.95003,1.45,0,0,1.04445],93:[.95003,1.45,0,0,.52778],123:[.95003,1.45,0,0,.75],125:[.95003,1.45,0,0,.75],160:[0,0,0,0,.25],710:[0,.75,0,0,1.44445],732:[0,.75,0,0,1.44445],770:[0,.75,0,0,1.44445],771:[0,.75,0,0,1.44445],8730:[.95003,1.45,0,0,1],8968:[.95003,1.45,0,0,.58334],8969:[.95003,1.45,0,0,.58334],8970:[.95003,1.45,0,0,.58334],8971:[.95003,1.45,0,0,.58334],10216:[.95003,1.45,0,0,.75],10217:[.95003,1.45,0,0,.75]},"Size4-Regular":{32:[0,0,0,0,.25],40:[1.25003,1.75,0,0,.79167],41:[1.25003,1.75,0,0,.79167],47:[1.25003,1.75,0,0,1.27778],91:[1.25003,1.75,0,0,.58334],92:[1.25003,1.75,0,0,1.27778],93:[1.25003,1.75,0,0,.58334],123:[1.25003,1.75,0,0,.80556],125:[1.25003,1.75,0,0,.80556],160:[0,0,0,0,.25],710:[0,.825,0,0,1.8889],732:[0,.825,0,0,1.8889],770:[0,.825,0,0,1.8889],771:[0,.825,0,0,1.8889],8730:[1.25003,1.75,0,0,1],8968:[1.25003,1.75,0,0,.63889],8969:[1.25003,1.75,0,0,.63889],8970:[1.25003,1.75,0,0,.63889],8971:[1.25003,1.75,0,0,.63889],9115:[.64502,1.155,0,0,.875],9116:[1e-5,.6,0,0,.875],9117:[.64502,1.155,0,0,.875],9118:[.64502,1.155,0,0,.875],9119:[1e-5,.6,0,0,.875],9120:[.64502,1.155,0,0,.875],9121:[.64502,1.155,0,0,.66667],9122:[-99e-5,.601,0,0,.66667],9123:[.64502,1.155,0,0,.66667],9124:[.64502,1.155,0,0,.66667],9125:[-99e-5,.601,0,0,.66667],9126:[.64502,1.155,0,0,.66667],9127:[1e-5,.9,0,0,.88889],9128:[.65002,1.15,0,0,.88889],9129:[.90001,0,0,0,.88889],9130:[0,.3,0,0,.88889],9131:[1e-5,.9,0,0,.88889],9132:[.65002,1.15,0,0,.88889],9133:[.90001,0,0,0,.88889],9143:[.88502,.915,0,0,1.05556],10216:[1.25003,1.75,0,0,.80556],10217:[1.25003,1.75,0,0,.80556],57344:[-.00499,.605,0,0,1.05556],57345:[-.00499,.605,0,0,1.05556],57680:[0,.12,0,0,.45],57681:[0,.12,0,0,.45],57682:[0,.12,0,0,.45],57683:[0,.12,0,0,.45]},"Typewriter-Regular":{32:[0,0,0,0,.525],33:[0,.61111,0,0,.525],34:[0,.61111,0,0,.525],35:[0,.61111,0,0,.525],36:[.08333,.69444,0,0,.525],37:[.08333,.69444,0,0,.525],38:[0,.61111,0,0,.525],39:[0,.61111,0,0,.525],40:[.08333,.69444,0,0,.525],41:[.08333,.69444,0,0,.525],42:[0,.52083,0,0,.525],43:[-.08056,.53055,0,0,.525],44:[.13889,.125,0,0,.525],45:[-.08056,.53055,0,0,.525],46:[0,.125,0,0,.525],47:[.08333,.69444,0,0,.525],48:[0,.61111,0,0,.525],49:[0,.61111,0,0,.525],50:[0,.61111,0,0,.525],51:[0,.61111,0,0,.525],52:[0,.61111,0,0,.525],53:[0,.61111,0,0,.525],54:[0,.61111,0,0,.525],55:[0,.61111,0,0,.525],56:[0,.61111,0,0,.525],57:[0,.61111,0,0,.525],58:[0,.43056,0,0,.525],59:[.13889,.43056,0,0,.525],60:[-.05556,.55556,0,0,.525],61:[-.19549,.41562,0,0,.525],62:[-.05556,.55556,0,0,.525],63:[0,.61111,0,0,.525],64:[0,.61111,0,0,.525],65:[0,.61111,0,0,.525],66:[0,.61111,0,0,.525],67:[0,.61111,0,0,.525],68:[0,.61111,0,0,.525],69:[0,.61111,0,0,.525],70:[0,.61111,0,0,.525],71:[0,.61111,0,0,.525],72:[0,.61111,0,0,.525],73:[0,.61111,0,0,.525],74:[0,.61111,0,0,.525],75:[0,.61111,0,0,.525],76:[0,.61111,0,0,.525],77:[0,.61111,0,0,.525],78:[0,.61111,0,0,.525],79:[0,.61111,0,0,.525],80:[0,.61111,0,0,.525],81:[.13889,.61111,0,0,.525],82:[0,.61111,0,0,.525],83:[0,.61111,0,0,.525],84:[0,.61111,0,0,.525],85:[0,.61111,0,0,.525],86:[0,.61111,0,0,.525],87:[0,.61111,0,0,.525],88:[0,.61111,0,0,.525],89:[0,.61111,0,0,.525],90:[0,.61111,0,0,.525],91:[.08333,.69444,0,0,.525],92:[.08333,.69444,0,0,.525],93:[.08333,.69444,0,0,.525],94:[0,.61111,0,0,.525],95:[.09514,0,0,0,.525],96:[0,.61111,0,0,.525],97:[0,.43056,0,0,.525],98:[0,.61111,0,0,.525],99:[0,.43056,0,0,.525],100:[0,.61111,0,0,.525],101:[0,.43056,0,0,.525],102:[0,.61111,0,0,.525],103:[.22222,.43056,0,0,.525],104:[0,.61111,0,0,.525],105:[0,.61111,0,0,.525],106:[.22222,.61111,0,0,.525],107:[0,.61111,0,0,.525],108:[0,.61111,0,0,.525],109:[0,.43056,0,0,.525],110:[0,.43056,0,0,.525],111:[0,.43056,0,0,.525],112:[.22222,.43056,0,0,.525],113:[.22222,.43056,0,0,.525],114:[0,.43056,0,0,.525],115:[0,.43056,0,0,.525],116:[0,.55358,0,0,.525],117:[0,.43056,0,0,.525],118:[0,.43056,0,0,.525],119:[0,.43056,0,0,.525],120:[0,.43056,0,0,.525],121:[.22222,.43056,0,0,.525],122:[0,.43056,0,0,.525],123:[.08333,.69444,0,0,.525],124:[.08333,.69444,0,0,.525],125:[.08333,.69444,0,0,.525],126:[0,.61111,0,0,.525],127:[0,.61111,0,0,.525],160:[0,0,0,0,.525],176:[0,.61111,0,0,.525],184:[.19445,0,0,0,.525],305:[0,.43056,0,0,.525],567:[.22222,.43056,0,0,.525],711:[0,.56597,0,0,.525],713:[0,.56555,0,0,.525],714:[0,.61111,0,0,.525],715:[0,.61111,0,0,.525],728:[0,.61111,0,0,.525],730:[0,.61111,0,0,.525],770:[0,.61111,0,0,.525],771:[0,.61111,0,0,.525],776:[0,.61111,0,0,.525],915:[0,.61111,0,0,.525],916:[0,.61111,0,0,.525],920:[0,.61111,0,0,.525],923:[0,.61111,0,0,.525],926:[0,.61111,0,0,.525],928:[0,.61111,0,0,.525],931:[0,.61111,0,0,.525],933:[0,.61111,0,0,.525],934:[0,.61111,0,0,.525],936:[0,.61111,0,0,.525],937:[0,.61111,0,0,.525],8216:[0,.61111,0,0,.525],8217:[0,.61111,0,0,.525],8242:[0,.61111,0,0,.525],9251:[.11111,.21944,0,0,.525]}},sigmasAndXis={slant:[.25,.25,.25],space:[0,0,0],stretch:[0,0,0],shrink:[0,0,0],xHeight:[.431,.431,.431],quad:[1,1.171,1.472],extraSpace:[0,0,0],num1:[.677,.732,.925],num2:[.394,.384,.387],num3:[.444,.471,.504],denom1:[.686,.752,1.025],denom2:[.345,.344,.532],sup1:[.413,.503,.504],sup2:[.363,.431,.404],sup3:[.289,.286,.294],sub1:[.15,.143,.2],sub2:[.247,.286,.4],supDrop:[.386,.353,.494],subDrop:[.05,.071,.1],delim1:[2.39,1.7,1.98],delim2:[1.01,1.157,1.42],axisHeight:[.25,.25,.25],defaultRuleThickness:[.04,.049,.049],bigOpSpacing1:[.111,.111,.111],bigOpSpacing2:[.166,.166,.166],bigOpSpacing3:[.2,.2,.2],bigOpSpacing4:[.6,.611,.611],bigOpSpacing5:[.1,.143,.143],sqrtRuleThickness:[.04,.04,.04],ptPerEm:[10,10,10],doubleRuleSep:[.2,.2,.2],arrayRuleWidth:[.04,.04,.04],fboxsep:[.3,.3,.3],fboxrule:[.04,.04,.04]},extraCharacterMap={Å:"A",Ð:"D",Þ:"o",å:"a",ð:"d",þ:"o",А:"A",Б:"B",В:"B",Г:"F",Д:"A",Е:"E",Ж:"K",З:"3",И:"N",Й:"N",К:"K",Л:"N",М:"M",Н:"H",О:"O",П:"N",Р:"P",С:"C",Т:"T",У:"y",Ф:"O",Х:"X",Ц:"U",Ч:"h",Ш:"W",Щ:"W",Ъ:"B",Ы:"X",Ь:"B",Э:"3",Ю:"X",Я:"R",а:"a",б:"b",в:"a",г:"r",д:"y",е:"e",ж:"m",з:"e",и:"n",й:"n",к:"n",л:"n",м:"m",н:"n",о:"o",п:"n",р:"p",с:"c",т:"o",у:"y",ф:"b",х:"x",ц:"n",ч:"n",ш:"w",щ:"w",ъ:"a",ы:"m",ь:"a",э:"e",ю:"m",я:"r"};function setFontMetrics(e,a){fontMetricsData[e]=a}function getCharacterMetrics(e,a,o){if(!fontMetricsData[a])throw new Error("Font metrics not found for font: "+a+".");var c=e.charCodeAt(0),d=fontMetricsData[a][c];if(!d&&e[0]in extraCharacterMap&&(c=extraCharacterMap[e[0]].charCodeAt(0),d=fontMetricsData[a][c]),!d&&o==="text"&&supportedCodepoint(c)&&(d=fontMetricsData[a][77]),d)return{depth:d[0],height:d[1],italic:d[2],skew:d[3],width:d[4]}}var fontMetricsBySizeIndex={};function getGlobalMetrics(e){var a;if(e>=5?a=0:e>=3?a=1:a=2,!fontMetricsBySizeIndex[a]){var o=fontMetricsBySizeIndex[a]={cssEmPerMu:sigmasAndXis.quad[a]/18};for(var c in sigmasAndXis)sigmasAndXis.hasOwnProperty(c)&&(o[c]=sigmasAndXis[c][a])}return fontMetricsBySizeIndex[a]}var sizeStyleMap=[[1,1,1],[2,1,1],[3,1,1],[4,2,1],[5,2,1],[6,3,1],[7,4,2],[8,6,3],[9,7,6],[10,8,7],[11,10,9]],sizeMultipliers=[.5,.6,.7,.8,.9,1,1.2,1.44,1.728,2.074,2.488],sizeAtStyle=function e(a,o){return o.size<2?a:sizeStyleMap[a-1][o.size-1]};class Options{constructor(a){this.style=void 0,this.color=void 0,this.size=void 0,this.textSize=void 0,this.phantom=void 0,this.font=void 0,this.fontFamily=void 0,this.fontWeight=void 0,this.fontShape=void 0,this.sizeMultiplier=void 0,this.maxSize=void 0,this.minRuleThickness=void 0,this._fontMetrics=void 0,this.style=a.style,this.color=a.color,this.size=a.size||Options.BASESIZE,this.textSize=a.textSize||this.size,this.phantom=!!a.phantom,this.font=a.font||"",this.fontFamily=a.fontFamily||"",this.fontWeight=a.fontWeight||"",this.fontShape=a.fontShape||"",this.sizeMultiplier=sizeMultipliers[this.size-1],this.maxSize=a.maxSize,this.minRuleThickness=a.minRuleThickness,this._fontMetrics=void 0}extend(a){var o={style:this.style,size:this.size,textSize:this.textSize,color:this.color,phantom:this.phantom,font:this.font,fontFamily:this.fontFamily,fontWeight:this.fontWeight,fontShape:this.fontShape,maxSize:this.maxSize,minRuleThickness:this.minRuleThickness};for(var c in a)a.hasOwnProperty(c)&&(o[c]=a[c]);return new Options(o)}havingStyle(a){return this.style===a?this:this.extend({style:a,size:sizeAtStyle(this.textSize,a)})}havingCrampedStyle(){return this.havingStyle(this.style.cramp())}havingSize(a){return this.size===a&&this.textSize===a?this:this.extend({style:this.style.text(),size:a,textSize:a,sizeMultiplier:sizeMultipliers[a-1]})}havingBaseStyle(a){a=a||this.style.text();var o=sizeAtStyle(Options.BASESIZE,a);return this.size===o&&this.textSize===Options.BASESIZE&&this.style===a?this:this.extend({style:a,size:o})}havingBaseSizing(){var a;switch(this.style.id){case 4:case 5:a=3;break;case 6:case 7:a=1;break;default:a=6}return this.extend({style:this.style.text(),size:a})}withColor(a){return this.extend({color:a})}withPhantom(){return this.extend({phantom:!0})}withFont(a){return this.extend({font:a})}withTextFontFamily(a){return this.extend({fontFamily:a,font:""})}withTextFontWeight(a){return this.extend({fontWeight:a,font:""})}withTextFontShape(a){return this.extend({fontShape:a,font:""})}sizingClasses(a){return a.size!==this.size?["sizing","reset-size"+a.size,"size"+this.size]:[]}baseSizingClasses(){return this.size!==Options.BASESIZE?["sizing","reset-size"+this.size,"size"+Options.BASESIZE]:[]}fontMetrics(){return this._fontMetrics||(this._fontMetrics=getGlobalMetrics(this.size)),this._fontMetrics}getColor(){return this.phantom?"transparent":this.color}}Options.BASESIZE=6;var ptPerUnit={pt:1,mm:7227/2540,cm:7227/254,in:72.27,bp:803/800,pc:12,dd:1238/1157,cc:14856/1157,nd:685/642,nc:1370/107,sp:1/65536,px:803/800},relativeUnit={ex:!0,em:!0,mu:!0},validUnit=function e(a){return typeof a!="string"&&(a=a.unit),a in ptPerUnit||a in relativeUnit||a==="ex"},calculateSize=function e(a,o){var c;if(a.unit in ptPerUnit)c=ptPerUnit[a.unit]/o.fontMetrics().ptPerEm/o.sizeMultiplier;else if(a.unit==="mu")c=o.fontMetrics().cssEmPerMu;else{var d;if(o.style.isTight()?d=o.havingStyle(o.style.text()):d=o,a.unit==="ex")c=d.fontMetrics().xHeight;else if(a.unit==="em")c=d.fontMetrics().quad;else throw new ParseError("Invalid unit: '"+a.unit+"'");d!==o&&(c*=d.sizeMultiplier/o.sizeMultiplier)}return Math.min(a.number*c,o.maxSize)},makeEm=function e(a){return+a.toFixed(4)+"em"},createClass=function e(a){return a.filter(o=>o).join(" ")},initNode=function e(a,o,c){if(this.classes=a||[],this.attributes={},this.height=0,this.depth=0,this.maxFontSize=0,this.style=c||{},o){o.style.isTight()&&this.classes.push("mtight");var d=o.getColor();d&&(this.style.color=d)}},toNode=function e(a){var o=document.createElement(a);o.className=createClass(this.classes);for(var c in this.style)this.style.hasOwnProperty(c)&&(o.style[c]=this.style[c]);for(var d in this.attributes)this.attributes.hasOwnProperty(d)&&o.setAttribute(d,this.attributes[d]);for(var $=0;$<this.children.length;$++)o.appendChild(this.children[$].toNode());return o},toMarkup=function e(a){var o="<"+a;this.classes.length&&(o+=' class="'+utils.escape(createClass(this.classes))+'"');var c="";for(var d in this.style)this.style.hasOwnProperty(d)&&(c+=utils.hyphenate(d)+":"+this.style[d]+";");c&&(o+=' style="'+utils.escape(c)+'"');for(var $ in this.attributes)this.attributes.hasOwnProperty($)&&(o+=" "+$+'="'+utils.escape(this.attributes[$])+'"');o+=">";for(var g=0;g<this.children.length;g++)o+=this.children[g].toMarkup();return o+="</"+a+">",o};class Span{constructor(a,o,c,d){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.width=void 0,this.maxFontSize=void 0,this.style=void 0,initNode.call(this,a,c,d),this.children=o||[]}setAttribute(a,o){this.attributes[a]=o}hasClass(a){return utils.contains(this.classes,a)}toNode(){return toNode.call(this,"span")}toMarkup(){return toMarkup.call(this,"span")}}class Anchor{constructor(a,o,c,d){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,initNode.call(this,o,d),this.children=c||[],this.setAttribute("href",a)}setAttribute(a,o){this.attributes[a]=o}hasClass(a){return utils.contains(this.classes,a)}toNode(){return toNode.call(this,"a")}toMarkup(){return toMarkup.call(this,"a")}}class Img{constructor(a,o,c){this.src=void 0,this.alt=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.alt=o,this.src=a,this.classes=["mord"],this.style=c}hasClass(a){return utils.contains(this.classes,a)}toNode(){var a=document.createElement("img");a.src=this.src,a.alt=this.alt,a.className="mord";for(var o in this.style)this.style.hasOwnProperty(o)&&(a.style[o]=this.style[o]);return a}toMarkup(){var a='<img src="'+utils.escape(this.src)+'"'+(' alt="'+utils.escape(this.alt)+'"'),o="";for(var c in this.style)this.style.hasOwnProperty(c)&&(o+=utils.hyphenate(c)+":"+this.style[c]+";");return o&&(a+=' style="'+utils.escape(o)+'"'),a+="'/>",a}}var iCombinations={î:"ı̂",ï:"ı̈",í:"ı́",ì:"ı̀"};class SymbolNode{constructor(a,o,c,d,$,g,b,_){this.text=void 0,this.height=void 0,this.depth=void 0,this.italic=void 0,this.skew=void 0,this.width=void 0,this.maxFontSize=void 0,this.classes=void 0,this.style=void 0,this.text=a,this.height=o||0,this.depth=c||0,this.italic=d||0,this.skew=$||0,this.width=g||0,this.classes=b||[],this.style=_||{},this.maxFontSize=0;var j=scriptFromCodepoint(this.text.charCodeAt(0));j&&this.classes.push(j+"_fallback"),/[îïíì]/.test(this.text)&&(this.text=iCombinations[this.text])}hasClass(a){return utils.contains(this.classes,a)}toNode(){var a=document.createTextNode(this.text),o=null;this.italic>0&&(o=document.createElement("span"),o.style.marginRight=makeEm(this.italic)),this.classes.length>0&&(o=o||document.createElement("span"),o.className=createClass(this.classes));for(var c in this.style)this.style.hasOwnProperty(c)&&(o=o||document.createElement("span"),o.style[c]=this.style[c]);return o?(o.appendChild(a),o):a}toMarkup(){var a=!1,o="<span";this.classes.length&&(a=!0,o+=' class="',o+=utils.escape(createClass(this.classes)),o+='"');var c="";this.italic>0&&(c+="margin-right:"+this.italic+"em;");for(var d in this.style)this.style.hasOwnProperty(d)&&(c+=utils.hyphenate(d)+":"+this.style[d]+";");c&&(a=!0,o+=' style="'+utils.escape(c)+'"');var $=utils.escape(this.text);return a?(o+=">",o+=$,o+="</span>",o):$}}class SvgNode{constructor(a,o){this.children=void 0,this.attributes=void 0,this.children=a||[],this.attributes=o||{}}toNode(){var a="http://www.w3.org/2000/svg",o=document.createElementNS(a,"svg");for(var c in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,c)&&o.setAttribute(c,this.attributes[c]);for(var d=0;d<this.children.length;d++)o.appendChild(this.children[d].toNode());return o}toMarkup(){var a='<svg xmlns="http://www.w3.org/2000/svg"';for(var o in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,o)&&(a+=" "+o+'="'+utils.escape(this.attributes[o])+'"');a+=">";for(var c=0;c<this.children.length;c++)a+=this.children[c].toMarkup();return a+="</svg>",a}}class PathNode{constructor(a,o){this.pathName=void 0,this.alternate=void 0,this.pathName=a,this.alternate=o}toNode(){var a="http://www.w3.org/2000/svg",o=document.createElementNS(a,"path");return this.alternate?o.setAttribute("d",this.alternate):o.setAttribute("d",path[this.pathName]),o}toMarkup(){return this.alternate?'<path d="'+utils.escape(this.alternate)+'"/>':'<path d="'+utils.escape(path[this.pathName])+'"/>'}}class LineNode{constructor(a){this.attributes=void 0,this.attributes=a||{}}toNode(){var a="http://www.w3.org/2000/svg",o=document.createElementNS(a,"line");for(var c in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,c)&&o.setAttribute(c,this.attributes[c]);return o}toMarkup(){var a="<line";for(var o in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,o)&&(a+=" "+o+'="'+utils.escape(this.attributes[o])+'"');return a+="/>",a}}function assertSymbolDomNode(e){if(e instanceof SymbolNode)return e;throw new Error("Expected symbolNode but got "+String(e)+".")}function assertSpan(e){if(e instanceof Span)return e;throw new Error("Expected span<HtmlDomNode> but got "+String(e)+".")}var ATOMS={bin:1,close:1,inner:1,open:1,punct:1,rel:1},NON_ATOMS={"accent-token":1,mathord:1,"op-token":1,spacing:1,textord:1},symbols={math:{},text:{}};function defineSymbol(e,a,o,c,d,$){symbols[e][d]={font:a,group:o,replace:c},$&&c&&(symbols[e][c]=symbols[e][d])}var math="math",text$2="text",main="main",ams="ams",accent="accent-token",bin="bin",close="close",inner="inner",mathord="mathord",op="op-token",open="open",punct="punct",rel="rel",spacing="spacing",textord="textord";defineSymbol(math,main,rel,"≡","\\equiv",!0);defineSymbol(math,main,rel,"≺","\\prec",!0);defineSymbol(math,main,rel,"≻","\\succ",!0);defineSymbol(math,main,rel,"∼","\\sim",!0);defineSymbol(math,main,rel,"⊥","\\perp");defineSymbol(math,main,rel,"⪯","\\preceq",!0);defineSymbol(math,main,rel,"⪰","\\succeq",!0);defineSymbol(math,main,rel,"≃","\\simeq",!0);defineSymbol(math,main,rel,"∣","\\mid",!0);defineSymbol(math,main,rel,"≪","\\ll",!0);defineSymbol(math,main,rel,"≫","\\gg",!0);defineSymbol(math,main,rel,"≍","\\asymp",!0);defineSymbol(math,main,rel,"∥","\\parallel");defineSymbol(math,main,rel,"⋈","\\bowtie",!0);defineSymbol(math,main,rel,"⌣","\\smile",!0);defineSymbol(math,main,rel,"⊑","\\sqsubseteq",!0);defineSymbol(math,main,rel,"⊒","\\sqsupseteq",!0);defineSymbol(math,main,rel,"≐","\\doteq",!0);defineSymbol(math,main,rel,"⌢","\\frown",!0);defineSymbol(math,main,rel,"∋","\\ni",!0);defineSymbol(math,main,rel,"∝","\\propto",!0);defineSymbol(math,main,rel,"⊢","\\vdash",!0);defineSymbol(math,main,rel,"⊣","\\dashv",!0);defineSymbol(math,main,rel,"∋","\\owns");defineSymbol(math,main,punct,".","\\ldotp");defineSymbol(math,main,punct,"⋅","\\cdotp");defineSymbol(math,main,textord,"#","\\#");defineSymbol(text$2,main,textord,"#","\\#");defineSymbol(math,main,textord,"&","\\&");defineSymbol(text$2,main,textord,"&","\\&");defineSymbol(math,main,textord,"ℵ","\\aleph",!0);defineSymbol(math,main,textord,"∀","\\forall",!0);defineSymbol(math,main,textord,"ℏ","\\hbar",!0);defineSymbol(math,main,textord,"∃","\\exists",!0);defineSymbol(math,main,textord,"∇","\\nabla",!0);defineSymbol(math,main,textord,"♭","\\flat",!0);defineSymbol(math,main,textord,"ℓ","\\ell",!0);defineSymbol(math,main,textord,"♮","\\natural",!0);defineSymbol(math,main,textord,"♣","\\clubsuit",!0);defineSymbol(math,main,textord,"℘","\\wp",!0);defineSymbol(math,main,textord,"♯","\\sharp",!0);defineSymbol(math,main,textord,"♢","\\diamondsuit",!0);defineSymbol(math,main,textord,"ℜ","\\Re",!0);defineSymbol(math,main,textord,"♡","\\heartsuit",!0);defineSymbol(math,main,textord,"ℑ","\\Im",!0);defineSymbol(math,main,textord,"♠","\\spadesuit",!0);defineSymbol(math,main,textord,"§","\\S",!0);defineSymbol(text$2,main,textord,"§","\\S");defineSymbol(math,main,textord,"¶","\\P",!0);defineSymbol(text$2,main,textord,"¶","\\P");defineSymbol(math,main,textord,"†","\\dag");defineSymbol(text$2,main,textord,"†","\\dag");defineSymbol(text$2,main,textord,"†","\\textdagger");defineSymbol(math,main,textord,"‡","\\ddag");defineSymbol(text$2,main,textord,"‡","\\ddag");defineSymbol(text$2,main,textord,"‡","\\textdaggerdbl");defineSymbol(math,main,close,"⎱","\\rmoustache",!0);defineSymbol(math,main,open,"⎰","\\lmoustache",!0);defineSymbol(math,main,close,"⟯","\\rgroup",!0);defineSymbol(math,main,open,"⟮","\\lgroup",!0);defineSymbol(math,main,bin,"∓","\\mp",!0);defineSymbol(math,main,bin,"⊖","\\ominus",!0);defineSymbol(math,main,bin,"⊎","\\uplus",!0);defineSymbol(math,main,bin,"⊓","\\sqcap",!0);defineSymbol(math,main,bin,"∗","\\ast");defineSymbol(math,main,bin,"⊔","\\sqcup",!0);defineSymbol(math,main,bin,"◯","\\bigcirc",!0);defineSymbol(math,main,bin,"∙","\\bullet",!0);defineSymbol(math,main,bin,"‡","\\ddagger");defineSymbol(math,main,bin,"≀","\\wr",!0);defineSymbol(math,main,bin,"⨿","\\amalg");defineSymbol(math,main,bin,"&","\\And");defineSymbol(math,main,rel,"⟵","\\longleftarrow",!0);defineSymbol(math,main,rel,"⇐","\\Leftarrow",!0);defineSymbol(math,main,rel,"⟸","\\Longleftarrow",!0);defineSymbol(math,main,rel,"⟶","\\longrightarrow",!0);defineSymbol(math,main,rel,"⇒","\\Rightarrow",!0);defineSymbol(math,main,rel,"⟹","\\Longrightarrow",!0);defineSymbol(math,main,rel,"↔","\\leftrightarrow",!0);defineSymbol(math,main,rel,"⟷","\\longleftrightarrow",!0);defineSymbol(math,main,rel,"⇔","\\Leftrightarrow",!0);defineSymbol(math,main,rel,"⟺","\\Longleftrightarrow",!0);defineSymbol(math,main,rel,"↦","\\mapsto",!0);defineSymbol(math,main,rel,"⟼","\\longmapsto",!0);defineSymbol(math,main,rel,"↗","\\nearrow",!0);defineSymbol(math,main,rel,"↩","\\hookleftarrow",!0);defineSymbol(math,main,rel,"↪","\\hookrightarrow",!0);defineSymbol(math,main,rel,"↘","\\searrow",!0);defineSymbol(math,main,rel,"↼","\\leftharpoonup",!0);defineSymbol(math,main,rel,"⇀","\\rightharpoonup",!0);defineSymbol(math,main,rel,"↙","\\swarrow",!0);defineSymbol(math,main,rel,"↽","\\leftharpoondown",!0);defineSymbol(math,main,rel,"⇁","\\rightharpoondown",!0);defineSymbol(math,main,rel,"↖","\\nwarrow",!0);defineSymbol(math,main,rel,"⇌","\\rightleftharpoons",!0);defineSymbol(math,ams,rel,"≮","\\nless",!0);defineSymbol(math,ams,rel,"","\\@nleqslant");defineSymbol(math,ams,rel,"","\\@nleqq");defineSymbol(math,ams,rel,"⪇","\\lneq",!0);defineSymbol(math,ams,rel,"≨","\\lneqq",!0);defineSymbol(math,ams,rel,"","\\@lvertneqq");defineSymbol(math,ams,rel,"⋦","\\lnsim",!0);defineSymbol(math,ams,rel,"⪉","\\lnapprox",!0);defineSymbol(math,ams,rel,"⊀","\\nprec",!0);defineSymbol(math,ams,rel,"⋠","\\npreceq",!0);defineSymbol(math,ams,rel,"⋨","\\precnsim",!0);defineSymbol(math,ams,rel,"⪹","\\precnapprox",!0);defineSymbol(math,ams,rel,"≁","\\nsim",!0);defineSymbol(math,ams,rel,"","\\@nshortmid");defineSymbol(math,ams,rel,"∤","\\nmid",!0);defineSymbol(math,ams,rel,"⊬","\\nvdash",!0);defineSymbol(math,ams,rel,"⊭","\\nvDash",!0);defineSymbol(math,ams,rel,"⋪","\\ntriangleleft");defineSymbol(math,ams,rel,"⋬","\\ntrianglelefteq",!0);defineSymbol(math,ams,rel,"⊊","\\subsetneq",!0);defineSymbol(math,ams,rel,"","\\@varsubsetneq");defineSymbol(math,ams,rel,"⫋","\\subsetneqq",!0);defineSymbol(math,ams,rel,"","\\@varsubsetneqq");defineSymbol(math,ams,rel,"≯","\\ngtr",!0);defineSymbol(math,ams,rel,"","\\@ngeqslant");defineSymbol(math,ams,rel,"","\\@ngeqq");defineSymbol(math,ams,rel,"⪈","\\gneq",!0);defineSymbol(math,ams,rel,"≩","\\gneqq",!0);defineSymbol(math,ams,rel,"","\\@gvertneqq");defineSymbol(math,ams,rel,"⋧","\\gnsim",!0);defineSymbol(math,ams,rel,"⪊","\\gnapprox",!0);defineSymbol(math,ams,rel,"⊁","\\nsucc",!0);defineSymbol(math,ams,rel,"⋡","\\nsucceq",!0);defineSymbol(math,ams,rel,"⋩","\\succnsim",!0);defineSymbol(math,ams,rel,"⪺","\\succnapprox",!0);defineSymbol(math,ams,rel,"≆","\\ncong",!0);defineSymbol(math,ams,rel,"","\\@nshortparallel");defineSymbol(math,ams,rel,"∦","\\nparallel",!0);defineSymbol(math,ams,rel,"⊯","\\nVDash",!0);defineSymbol(math,ams,rel,"⋫","\\ntriangleright");defineSymbol(math,ams,rel,"⋭","\\ntrianglerighteq",!0);defineSymbol(math,ams,rel,"","\\@nsupseteqq");defineSymbol(math,ams,rel,"⊋","\\supsetneq",!0);defineSymbol(math,ams,rel,"","\\@varsupsetneq");defineSymbol(math,ams,rel,"⫌","\\supsetneqq",!0);defineSymbol(math,ams,rel,"","\\@varsupsetneqq");defineSymbol(math,ams,rel,"⊮","\\nVdash",!0);defineSymbol(math,ams,rel,"⪵","\\precneqq",!0);defineSymbol(math,ams,rel,"⪶","\\succneqq",!0);defineSymbol(math,ams,rel,"","\\@nsubseteqq");defineSymbol(math,ams,bin,"⊴","\\unlhd");defineSymbol(math,ams,bin,"⊵","\\unrhd");defineSymbol(math,ams,rel,"↚","\\nleftarrow",!0);defineSymbol(math,ams,rel,"↛","\\nrightarrow",!0);defineSymbol(math,ams,rel,"⇍","\\nLeftarrow",!0);defineSymbol(math,ams,rel,"⇏","\\nRightarrow",!0);defineSymbol(math,ams,rel,"↮","\\nleftrightarrow",!0);defineSymbol(math,ams,rel,"⇎","\\nLeftrightarrow",!0);defineSymbol(math,ams,rel,"△","\\vartriangle");defineSymbol(math,ams,textord,"ℏ","\\hslash");defineSymbol(math,ams,textord,"▽","\\triangledown");defineSymbol(math,ams,textord,"◊","\\lozenge");defineSymbol(math,ams,textord,"Ⓢ","\\circledS");defineSymbol(math,ams,textord,"®","\\circledR");defineSymbol(text$2,ams,textord,"®","\\circledR");defineSymbol(math,ams,textord,"∡","\\measuredangle",!0);defineSymbol(math,ams,textord,"∄","\\nexists");defineSymbol(math,ams,textord,"℧","\\mho");defineSymbol(math,ams,textord,"Ⅎ","\\Finv",!0);defineSymbol(math,ams,textord,"⅁","\\Game",!0);defineSymbol(math,ams,textord,"‵","\\backprime");defineSymbol(math,ams,textord,"▲","\\blacktriangle");defineSymbol(math,ams,textord,"▼","\\blacktriangledown");defineSymbol(math,ams,textord,"■","\\blacksquare");defineSymbol(math,ams,textord,"⧫","\\blacklozenge");defineSymbol(math,ams,textord,"★","\\bigstar");defineSymbol(math,ams,textord,"∢","\\sphericalangle",!0);defineSymbol(math,ams,textord,"∁","\\complement",!0);defineSymbol(math,ams,textord,"ð","\\eth",!0);defineSymbol(text$2,main,textord,"ð","ð");defineSymbol(math,ams,textord,"╱","\\diagup");defineSymbol(math,ams,textord,"╲","\\diagdown");defineSymbol(math,ams,textord,"□","\\square");defineSymbol(math,ams,textord,"□","\\Box");defineSymbol(math,ams,textord,"◊","\\Diamond");defineSymbol(math,ams,textord,"¥","\\yen",!0);defineSymbol(text$2,ams,textord,"¥","\\yen",!0);defineSymbol(math,ams,textord,"✓","\\checkmark",!0);defineSymbol(text$2,ams,textord,"✓","\\checkmark");defineSymbol(math,ams,textord,"ℶ","\\beth",!0);defineSymbol(math,ams,textord,"ℸ","\\daleth",!0);defineSymbol(math,ams,textord,"ℷ","\\gimel",!0);defineSymbol(math,ams,textord,"ϝ","\\digamma",!0);defineSymbol(math,ams,textord,"ϰ","\\varkappa");defineSymbol(math,ams,open,"┌","\\@ulcorner",!0);defineSymbol(math,ams,close,"┐","\\@urcorner",!0);defineSymbol(math,ams,open,"└","\\@llcorner",!0);defineSymbol(math,ams,close,"┘","\\@lrcorner",!0);defineSymbol(math,ams,rel,"≦","\\leqq",!0);defineSymbol(math,ams,rel,"⩽","\\leqslant",!0);defineSymbol(math,ams,rel,"⪕","\\eqslantless",!0);defineSymbol(math,ams,rel,"≲","\\lesssim",!0);defineSymbol(math,ams,rel,"⪅","\\lessapprox",!0);defineSymbol(math,ams,rel,"≊","\\approxeq",!0);defineSymbol(math,ams,bin,"⋖","\\lessdot");defineSymbol(math,ams,rel,"⋘","\\lll",!0);defineSymbol(math,ams,rel,"≶","\\lessgtr",!0);defineSymbol(math,ams,rel,"⋚","\\lesseqgtr",!0);defineSymbol(math,ams,rel,"⪋","\\lesseqqgtr",!0);defineSymbol(math,ams,rel,"≑","\\doteqdot");defineSymbol(math,ams,rel,"≓","\\risingdotseq",!0);defineSymbol(math,ams,rel,"≒","\\fallingdotseq",!0);defineSymbol(math,ams,rel,"∽","\\backsim",!0);defineSymbol(math,ams,rel,"⋍","\\backsimeq",!0);defineSymbol(math,ams,rel,"⫅","\\subseteqq",!0);defineSymbol(math,ams,rel,"⋐","\\Subset",!0);defineSymbol(math,ams,rel,"⊏","\\sqsubset",!0);defineSymbol(math,ams,rel,"≼","\\preccurlyeq",!0);defineSymbol(math,ams,rel,"⋞","\\curlyeqprec",!0);defineSymbol(math,ams,rel,"≾","\\precsim",!0);defineSymbol(math,ams,rel,"⪷","\\precapprox",!0);defineSymbol(math,ams,rel,"⊲","\\vartriangleleft");defineSymbol(math,ams,rel,"⊴","\\trianglelefteq");defineSymbol(math,ams,rel,"⊨","\\vDash",!0);defineSymbol(math,ams,rel,"⊪","\\Vvdash",!0);defineSymbol(math,ams,rel,"⌣","\\smallsmile");defineSymbol(math,ams,rel,"⌢","\\smallfrown");defineSymbol(math,ams,rel,"≏","\\bumpeq",!0);defineSymbol(math,ams,rel,"≎","\\Bumpeq",!0);defineSymbol(math,ams,rel,"≧","\\geqq",!0);defineSymbol(math,ams,rel,"⩾","\\geqslant",!0);defineSymbol(math,ams,rel,"⪖","\\eqslantgtr",!0);defineSymbol(math,ams,rel,"≳","\\gtrsim",!0);defineSymbol(math,ams,rel,"⪆","\\gtrapprox",!0);defineSymbol(math,ams,bin,"⋗","\\gtrdot");defineSymbol(math,ams,rel,"⋙","\\ggg",!0);defineSymbol(math,ams,rel,"≷","\\gtrless",!0);defineSymbol(math,ams,rel,"⋛","\\gtreqless",!0);defineSymbol(math,ams,rel,"⪌","\\gtreqqless",!0);defineSymbol(math,ams,rel,"≖","\\eqcirc",!0);defineSymbol(math,ams,rel,"≗","\\circeq",!0);defineSymbol(math,ams,rel,"≜","\\triangleq",!0);defineSymbol(math,ams,rel,"∼","\\thicksim");defineSymbol(math,ams,rel,"≈","\\thickapprox");defineSymbol(math,ams,rel,"⫆","\\supseteqq",!0);defineSymbol(math,ams,rel,"⋑","\\Supset",!0);defineSymbol(math,ams,rel,"⊐","\\sqsupset",!0);defineSymbol(math,ams,rel,"≽","\\succcurlyeq",!0);defineSymbol(math,ams,rel,"⋟","\\curlyeqsucc",!0);defineSymbol(math,ams,rel,"≿","\\succsim",!0);defineSymbol(math,ams,rel,"⪸","\\succapprox",!0);defineSymbol(math,ams,rel,"⊳","\\vartriangleright");defineSymbol(math,ams,rel,"⊵","\\trianglerighteq");defineSymbol(math,ams,rel,"⊩","\\Vdash",!0);defineSymbol(math,ams,rel,"∣","\\shortmid");defineSymbol(math,ams,rel,"∥","\\shortparallel");defineSymbol(math,ams,rel,"≬","\\between",!0);defineSymbol(math,ams,rel,"⋔","\\pitchfork",!0);defineSymbol(math,ams,rel,"∝","\\varpropto");defineSymbol(math,ams,rel,"◀","\\blacktriangleleft");defineSymbol(math,ams,rel,"∴","\\therefore",!0);defineSymbol(math,ams,rel,"∍","\\backepsilon");defineSymbol(math,ams,rel,"▶","\\blacktriangleright");defineSymbol(math,ams,rel,"∵","\\because",!0);defineSymbol(math,ams,rel,"⋘","\\llless");defineSymbol(math,ams,rel,"⋙","\\gggtr");defineSymbol(math,ams,bin,"⊲","\\lhd");defineSymbol(math,ams,bin,"⊳","\\rhd");defineSymbol(math,ams,rel,"≂","\\eqsim",!0);defineSymbol(math,main,rel,"⋈","\\Join");defineSymbol(math,ams,rel,"≑","\\Doteq",!0);defineSymbol(math,ams,bin,"∔","\\dotplus",!0);defineSymbol(math,ams,bin,"∖","\\smallsetminus");defineSymbol(math,ams,bin,"⋒","\\Cap",!0);defineSymbol(math,ams,bin,"⋓","\\Cup",!0);defineSymbol(math,ams,bin,"⩞","\\doublebarwedge",!0);defineSymbol(math,ams,bin,"⊟","\\boxminus",!0);defineSymbol(math,ams,bin,"⊞","\\boxplus",!0);defineSymbol(math,ams,bin,"⋇","\\divideontimes",!0);defineSymbol(math,ams,bin,"⋉","\\ltimes",!0);defineSymbol(math,ams,bin,"⋊","\\rtimes",!0);defineSymbol(math,ams,bin,"⋋","\\leftthreetimes",!0);defineSymbol(math,ams,bin,"⋌","\\rightthreetimes",!0);defineSymbol(math,ams,bin,"⋏","\\curlywedge",!0);defineSymbol(math,ams,bin,"⋎","\\curlyvee",!0);defineSymbol(math,ams,bin,"⊝","\\circleddash",!0);defineSymbol(math,ams,bin,"⊛","\\circledast",!0);defineSymbol(math,ams,bin,"⋅","\\centerdot");defineSymbol(math,ams,bin,"⊺","\\intercal",!0);defineSymbol(math,ams,bin,"⋒","\\doublecap");defineSymbol(math,ams,bin,"⋓","\\doublecup");defineSymbol(math,ams,bin,"⊠","\\boxtimes",!0);defineSymbol(math,ams,rel,"⇢","\\dashrightarrow",!0);defineSymbol(math,ams,rel,"⇠","\\dashleftarrow",!0);defineSymbol(math,ams,rel,"⇇","\\leftleftarrows",!0);defineSymbol(math,ams,rel,"⇆","\\leftrightarrows",!0);defineSymbol(math,ams,rel,"⇚","\\Lleftarrow",!0);defineSymbol(math,ams,rel,"↞","\\twoheadleftarrow",!0);defineSymbol(math,ams,rel,"↢","\\leftarrowtail",!0);defineSymbol(math,ams,rel,"↫","\\looparrowleft",!0);defineSymbol(math,ams,rel,"⇋","\\leftrightharpoons",!0);defineSymbol(math,ams,rel,"↶","\\curvearrowleft",!0);defineSymbol(math,ams,rel,"↺","\\circlearrowleft",!0);defineSymbol(math,ams,rel,"↰","\\Lsh",!0);defineSymbol(math,ams,rel,"⇈","\\upuparrows",!0);defineSymbol(math,ams,rel,"↿","\\upharpoonleft",!0);defineSymbol(math,ams,rel,"⇃","\\downharpoonleft",!0);defineSymbol(math,main,rel,"⊶","\\origof",!0);defineSymbol(math,main,rel,"⊷","\\imageof",!0);defineSymbol(math,ams,rel,"⊸","\\multimap",!0);defineSymbol(math,ams,rel,"↭","\\leftrightsquigarrow",!0);defineSymbol(math,ams,rel,"⇉","\\rightrightarrows",!0);defineSymbol(math,ams,rel,"⇄","\\rightleftarrows",!0);defineSymbol(math,ams,rel,"↠","\\twoheadrightarrow",!0);defineSymbol(math,ams,rel,"↣","\\rightarrowtail",!0);defineSymbol(math,ams,rel,"↬","\\looparrowright",!0);defineSymbol(math,ams,rel,"↷","\\curvearrowright",!0);defineSymbol(math,ams,rel,"↻","\\circlearrowright",!0);defineSymbol(math,ams,rel,"↱","\\Rsh",!0);defineSymbol(math,ams,rel,"⇊","\\downdownarrows",!0);defineSymbol(math,ams,rel,"↾","\\upharpoonright",!0);defineSymbol(math,ams,rel,"⇂","\\downharpoonright",!0);defineSymbol(math,ams,rel,"⇝","\\rightsquigarrow",!0);defineSymbol(math,ams,rel,"⇝","\\leadsto");defineSymbol(math,ams,rel,"⇛","\\Rrightarrow",!0);defineSymbol(math,ams,rel,"↾","\\restriction");defineSymbol(math,main,textord,"‘","`");defineSymbol(math,main,textord,"$","\\$");defineSymbol(text$2,main,textord,"$","\\$");defineSymbol(text$2,main,textord,"$","\\textdollar");defineSymbol(math,main,textord,"%","\\%");defineSymbol(text$2,main,textord,"%","\\%");defineSymbol(math,main,textord,"_","\\_");defineSymbol(text$2,main,textord,"_","\\_");defineSymbol(text$2,main,textord,"_","\\textunderscore");defineSymbol(math,main,textord,"∠","\\angle",!0);defineSymbol(math,main,textord,"∞","\\infty",!0);defineSymbol(math,main,textord,"′","\\prime");defineSymbol(math,main,textord,"△","\\triangle");defineSymbol(math,main,textord,"Γ","\\Gamma",!0);defineSymbol(math,main,textord,"Δ","\\Delta",!0);defineSymbol(math,main,textord,"Θ","\\Theta",!0);defineSymbol(math,main,textord,"Λ","\\Lambda",!0);defineSymbol(math,main,textord,"Ξ","\\Xi",!0);defineSymbol(math,main,textord,"Π","\\Pi",!0);defineSymbol(math,main,textord,"Σ","\\Sigma",!0);defineSymbol(math,main,textord,"Υ","\\Upsilon",!0);defineSymbol(math,main,textord,"Φ","\\Phi",!0);defineSymbol(math,main,textord,"Ψ","\\Psi",!0);defineSymbol(math,main,textord,"Ω","\\Omega",!0);defineSymbol(math,main,textord,"A","Α");defineSymbol(math,main,textord,"B","Β");defineSymbol(math,main,textord,"E","Ε");defineSymbol(math,main,textord,"Z","Ζ");defineSymbol(math,main,textord,"H","Η");defineSymbol(math,main,textord,"I","Ι");defineSymbol(math,main,textord,"K","Κ");defineSymbol(math,main,textord,"M","Μ");defineSymbol(math,main,textord,"N","Ν");defineSymbol(math,main,textord,"O","Ο");defineSymbol(math,main,textord,"P","Ρ");defineSymbol(math,main,textord,"T","Τ");defineSymbol(math,main,textord,"X","Χ");defineSymbol(math,main,textord,"¬","\\neg",!0);defineSymbol(math,main,textord,"¬","\\lnot");defineSymbol(math,main,textord,"⊤","\\top");defineSymbol(math,main,textord,"⊥","\\bot");defineSymbol(math,main,textord,"∅","\\emptyset");defineSymbol(math,ams,textord,"∅","\\varnothing");defineSymbol(math,main,mathord,"α","\\alpha",!0);defineSymbol(math,main,mathord,"β","\\beta",!0);defineSymbol(math,main,mathord,"γ","\\gamma",!0);defineSymbol(math,main,mathord,"δ","\\delta",!0);defineSymbol(math,main,mathord,"ϵ","\\epsilon",!0);defineSymbol(math,main,mathord,"ζ","\\zeta",!0);defineSymbol(math,main,mathord,"η","\\eta",!0);defineSymbol(math,main,mathord,"θ","\\theta",!0);defineSymbol(math,main,mathord,"ι","\\iota",!0);defineSymbol(math,main,mathord,"κ","\\kappa",!0);defineSymbol(math,main,mathord,"λ","\\lambda",!0);defineSymbol(math,main,mathord,"μ","\\mu",!0);defineSymbol(math,main,mathord,"ν","\\nu",!0);defineSymbol(math,main,mathord,"ξ","\\xi",!0);defineSymbol(math,main,mathord,"ο","\\omicron",!0);defineSymbol(math,main,mathord,"π","\\pi",!0);defineSymbol(math,main,mathord,"ρ","\\rho",!0);defineSymbol(math,main,mathord,"σ","\\sigma",!0);defineSymbol(math,main,mathord,"τ","\\tau",!0);defineSymbol(math,main,mathord,"υ","\\upsilon",!0);defineSymbol(math,main,mathord,"ϕ","\\phi",!0);defineSymbol(math,main,mathord,"χ","\\chi",!0);defineSymbol(math,main,mathord,"ψ","\\psi",!0);defineSymbol(math,main,mathord,"ω","\\omega",!0);defineSymbol(math,main,mathord,"ε","\\varepsilon",!0);defineSymbol(math,main,mathord,"ϑ","\\vartheta",!0);defineSymbol(math,main,mathord,"ϖ","\\varpi",!0);defineSymbol(math,main,mathord,"ϱ","\\varrho",!0);defineSymbol(math,main,mathord,"ς","\\varsigma",!0);defineSymbol(math,main,mathord,"φ","\\varphi",!0);defineSymbol(math,main,bin,"∗","*",!0);defineSymbol(math,main,bin,"+","+");defineSymbol(math,main,bin,"−","-",!0);defineSymbol(math,main,bin,"⋅","\\cdot",!0);defineSymbol(math,main,bin,"∘","\\circ",!0);defineSymbol(math,main,bin,"÷","\\div",!0);defineSymbol(math,main,bin,"±","\\pm",!0);defineSymbol(math,main,bin,"×","\\times",!0);defineSymbol(math,main,bin,"∩","\\cap",!0);defineSymbol(math,main,bin,"∪","\\cup",!0);defineSymbol(math,main,bin,"∖","\\setminus",!0);defineSymbol(math,main,bin,"∧","\\land");defineSymbol(math,main,bin,"∨","\\lor");defineSymbol(math,main,bin,"∧","\\wedge",!0);defineSymbol(math,main,bin,"∨","\\vee",!0);defineSymbol(math,main,textord,"√","\\surd");defineSymbol(math,main,open,"⟨","\\langle",!0);defineSymbol(math,main,open,"∣","\\lvert");defineSymbol(math,main,open,"∥","\\lVert");defineSymbol(math,main,close,"?","?");defineSymbol(math,main,close,"!","!");defineSymbol(math,main,close,"⟩","\\rangle",!0);defineSymbol(math,main,close,"∣","\\rvert");defineSymbol(math,main,close,"∥","\\rVert");defineSymbol(math,main,rel,"=","=");defineSymbol(math,main,rel,":",":");defineSymbol(math,main,rel,"≈","\\approx",!0);defineSymbol(math,main,rel,"≅","\\cong",!0);defineSymbol(math,main,rel,"≥","\\ge");defineSymbol(math,main,rel,"≥","\\geq",!0);defineSymbol(math,main,rel,"←","\\gets");defineSymbol(math,main,rel,">","\\gt",!0);defineSymbol(math,main,rel,"∈","\\in",!0);defineSymbol(math,main,rel,"","\\@not");defineSymbol(math,main,rel,"⊂","\\subset",!0);defineSymbol(math,main,rel,"⊃","\\supset",!0);defineSymbol(math,main,rel,"⊆","\\subseteq",!0);defineSymbol(math,main,rel,"⊇","\\supseteq",!0);defineSymbol(math,ams,rel,"⊈","\\nsubseteq",!0);defineSymbol(math,ams,rel,"⊉","\\nsupseteq",!0);defineSymbol(math,main,rel,"⊨","\\models");defineSymbol(math,main,rel,"←","\\leftarrow",!0);defineSymbol(math,main,rel,"≤","\\le");defineSymbol(math,main,rel,"≤","\\leq",!0);defineSymbol(math,main,rel,"<","\\lt",!0);defineSymbol(math,main,rel,"→","\\rightarrow",!0);defineSymbol(math,main,rel,"→","\\to");defineSymbol(math,ams,rel,"≱","\\ngeq",!0);defineSymbol(math,ams,rel,"≰","\\nleq",!0);defineSymbol(math,main,spacing," ","\\ ");defineSymbol(math,main,spacing," ","\\space");defineSymbol(math,main,spacing," ","\\nobreakspace");defineSymbol(text$2,main,spacing," ","\\ ");defineSymbol(text$2,main,spacing," "," ");defineSymbol(text$2,main,spacing," ","\\space");defineSymbol(text$2,main,spacing," ","\\nobreakspace");defineSymbol(math,main,spacing,null,"\\nobreak");defineSymbol(math,main,spacing,null,"\\allowbreak");defineSymbol(math,main,punct,",",",");defineSymbol(math,main,punct,";",";");defineSymbol(math,ams,bin,"⊼","\\barwedge",!0);defineSymbol(math,ams,bin,"⊻","\\veebar",!0);defineSymbol(math,main,bin,"⊙","\\odot",!0);defineSymbol(math,main,bin,"⊕","\\oplus",!0);defineSymbol(math,main,bin,"⊗","\\otimes",!0);defineSymbol(math,main,textord,"∂","\\partial",!0);defineSymbol(math,main,bin,"⊘","\\oslash",!0);defineSymbol(math,ams,bin,"⊚","\\circledcirc",!0);defineSymbol(math,ams,bin,"⊡","\\boxdot",!0);defineSymbol(math,main,bin,"△","\\bigtriangleup");defineSymbol(math,main,bin,"▽","\\bigtriangledown");defineSymbol(math,main,bin,"†","\\dagger");defineSymbol(math,main,bin,"⋄","\\diamond");defineSymbol(math,main,bin,"⋆","\\star");defineSymbol(math,main,bin,"◃","\\triangleleft");defineSymbol(math,main,bin,"▹","\\triangleright");defineSymbol(math,main,open,"{","\\{");defineSymbol(text$2,main,textord,"{","\\{");defineSymbol(text$2,main,textord,"{","\\textbraceleft");defineSymbol(math,main,close,"}","\\}");defineSymbol(text$2,main,textord,"}","\\}");defineSymbol(text$2,main,textord,"}","\\textbraceright");defineSymbol(math,main,open,"{","\\lbrace");defineSymbol(math,main,close,"}","\\rbrace");defineSymbol(math,main,open,"[","\\lbrack",!0);defineSymbol(text$2,main,textord,"[","\\lbrack",!0);defineSymbol(math,main,close,"]","\\rbrack",!0);defineSymbol(text$2,main,textord,"]","\\rbrack",!0);defineSymbol(math,main,open,"(","\\lparen",!0);defineSymbol(math,main,close,")","\\rparen",!0);defineSymbol(text$2,main,textord,"<","\\textless",!0);defineSymbol(text$2,main,textord,">","\\textgreater",!0);defineSymbol(math,main,open,"⌊","\\lfloor",!0);defineSymbol(math,main,close,"⌋","\\rfloor",!0);defineSymbol(math,main,open,"⌈","\\lceil",!0);defineSymbol(math,main,close,"⌉","\\rceil",!0);defineSymbol(math,main,textord,"\\","\\backslash");defineSymbol(math,main,textord,"∣","|");defineSymbol(math,main,textord,"∣","\\vert");defineSymbol(text$2,main,textord,"|","\\textbar",!0);defineSymbol(math,main,textord,"∥","\\|");defineSymbol(math,main,textord,"∥","\\Vert");defineSymbol(text$2,main,textord,"∥","\\textbardbl");defineSymbol(text$2,main,textord,"~","\\textasciitilde");defineSymbol(text$2,main,textord,"\\","\\textbackslash");defineSymbol(text$2,main,textord,"^","\\textasciicircum");defineSymbol(math,main,rel,"↑","\\uparrow",!0);defineSymbol(math,main,rel,"⇑","\\Uparrow",!0);defineSymbol(math,main,rel,"↓","\\downarrow",!0);defineSymbol(math,main,rel,"⇓","\\Downarrow",!0);defineSymbol(math,main,rel,"↕","\\updownarrow",!0);defineSymbol(math,main,rel,"⇕","\\Updownarrow",!0);defineSymbol(math,main,op,"∐","\\coprod");defineSymbol(math,main,op,"⋁","\\bigvee");defineSymbol(math,main,op,"⋀","\\bigwedge");defineSymbol(math,main,op,"⨄","\\biguplus");defineSymbol(math,main,op,"⋂","\\bigcap");defineSymbol(math,main,op,"⋃","\\bigcup");defineSymbol(math,main,op,"∫","\\int");defineSymbol(math,main,op,"∫","\\intop");defineSymbol(math,main,op,"∬","\\iint");defineSymbol(math,main,op,"∭","\\iiint");defineSymbol(math,main,op,"∏","\\prod");defineSymbol(math,main,op,"∑","\\sum");defineSymbol(math,main,op,"⨂","\\bigotimes");defineSymbol(math,main,op,"⨁","\\bigoplus");defineSymbol(math,main,op,"⨀","\\bigodot");defineSymbol(math,main,op,"∮","\\oint");defineSymbol(math,main,op,"∯","\\oiint");defineSymbol(math,main,op,"∰","\\oiiint");defineSymbol(math,main,op,"⨆","\\bigsqcup");defineSymbol(math,main,op,"∫","\\smallint");defineSymbol(text$2,main,inner,"…","\\textellipsis");defineSymbol(math,main,inner,"…","\\mathellipsis");defineSymbol(text$2,main,inner,"…","\\ldots",!0);defineSymbol(math,main,inner,"…","\\ldots",!0);defineSymbol(math,main,inner,"⋯","\\@cdots",!0);defineSymbol(math,main,inner,"⋱","\\ddots",!0);defineSymbol(math,main,textord,"⋮","\\varvdots");defineSymbol(text$2,main,textord,"⋮","\\varvdots");defineSymbol(math,main,accent,"ˊ","\\acute");defineSymbol(math,main,accent,"ˋ","\\grave");defineSymbol(math,main,accent,"¨","\\ddot");defineSymbol(math,main,accent,"~","\\tilde");defineSymbol(math,main,accent,"ˉ","\\bar");defineSymbol(math,main,accent,"˘","\\breve");defineSymbol(math,main,accent,"ˇ","\\check");defineSymbol(math,main,accent,"^","\\hat");defineSymbol(math,main,accent,"⃗","\\vec");defineSymbol(math,main,accent,"˙","\\dot");defineSymbol(math,main,accent,"˚","\\mathring");defineSymbol(math,main,mathord,"","\\@imath");defineSymbol(math,main,mathord,"","\\@jmath");defineSymbol(math,main,textord,"ı","ı");defineSymbol(math,main,textord,"ȷ","ȷ");defineSymbol(text$2,main,textord,"ı","\\i",!0);defineSymbol(text$2,main,textord,"ȷ","\\j",!0);defineSymbol(text$2,main,textord,"ß","\\ss",!0);defineSymbol(text$2,main,textord,"æ","\\ae",!0);defineSymbol(text$2,main,textord,"œ","\\oe",!0);defineSymbol(text$2,main,textord,"ø","\\o",!0);defineSymbol(text$2,main,textord,"Æ","\\AE",!0);defineSymbol(text$2,main,textord,"Œ","\\OE",!0);defineSymbol(text$2,main,textord,"Ø","\\O",!0);defineSymbol(text$2,main,accent,"ˊ","\\'");defineSymbol(text$2,main,accent,"ˋ","\\`");defineSymbol(text$2,main,accent,"ˆ","\\^");defineSymbol(text$2,main,accent,"˜","\\~");defineSymbol(text$2,main,accent,"ˉ","\\=");defineSymbol(text$2,main,accent,"˘","\\u");defineSymbol(text$2,main,accent,"˙","\\.");defineSymbol(text$2,main,accent,"¸","\\c");defineSymbol(text$2,main,accent,"˚","\\r");defineSymbol(text$2,main,accent,"ˇ","\\v");defineSymbol(text$2,main,accent,"¨",'\\"');defineSymbol(text$2,main,accent,"˝","\\H");defineSymbol(text$2,main,accent,"◯","\\textcircled");var ligatures={"--":!0,"---":!0,"``":!0,"''":!0};defineSymbol(text$2,main,textord,"–","--",!0);defineSymbol(text$2,main,textord,"–","\\textendash");defineSymbol(text$2,main,textord,"—","---",!0);defineSymbol(text$2,main,textord,"—","\\textemdash");defineSymbol(text$2,main,textord,"‘","`",!0);defineSymbol(text$2,main,textord,"‘","\\textquoteleft");defineSymbol(text$2,main,textord,"’","'",!0);defineSymbol(text$2,main,textord,"’","\\textquoteright");defineSymbol(text$2,main,textord,"“","``",!0);defineSymbol(text$2,main,textord,"“","\\textquotedblleft");defineSymbol(text$2,main,textord,"”","''",!0);defineSymbol(text$2,main,textord,"”","\\textquotedblright");defineSymbol(math,main,textord,"°","\\degree",!0);defineSymbol(text$2,main,textord,"°","\\degree");defineSymbol(text$2,main,textord,"°","\\textdegree",!0);defineSymbol(math,main,textord,"£","\\pounds");defineSymbol(math,main,textord,"£","\\mathsterling",!0);defineSymbol(text$2,main,textord,"£","\\pounds");defineSymbol(text$2,main,textord,"£","\\textsterling",!0);defineSymbol(math,ams,textord,"✠","\\maltese");defineSymbol(text$2,ams,textord,"✠","\\maltese");var mathTextSymbols='0123456789/@."';for(var i=0;i<mathTextSymbols.length;i++){var ch=mathTextSymbols.charAt(i);defineSymbol(math,main,textord,ch,ch)}var textSymbols='0123456789!@*()-=+";:?/.,';for(var _i=0;_i<textSymbols.length;_i++){var _ch=textSymbols.charAt(_i);defineSymbol(text$2,main,textord,_ch,_ch)}var letters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(var _i2=0;_i2<letters.length;_i2++){var _ch2=letters.charAt(_i2);defineSymbol(math,main,mathord,_ch2,_ch2),defineSymbol(text$2,main,textord,_ch2,_ch2)}defineSymbol(math,ams,textord,"C","ℂ");defineSymbol(text$2,ams,textord,"C","ℂ");defineSymbol(math,ams,textord,"H","ℍ");defineSymbol(text$2,ams,textord,"H","ℍ");defineSymbol(math,ams,textord,"N","ℕ");defineSymbol(text$2,ams,textord,"N","ℕ");defineSymbol(math,ams,textord,"P","ℙ");defineSymbol(text$2,ams,textord,"P","ℙ");defineSymbol(math,ams,textord,"Q","ℚ");defineSymbol(text$2,ams,textord,"Q","ℚ");defineSymbol(math,ams,textord,"R","ℝ");defineSymbol(text$2,ams,textord,"R","ℝ");defineSymbol(math,ams,textord,"Z","ℤ");defineSymbol(text$2,ams,textord,"Z","ℤ");defineSymbol(math,main,mathord,"h","ℎ");defineSymbol(text$2,main,mathord,"h","ℎ");var wideChar="";for(var _i3=0;_i3<letters.length;_i3++){var _ch3=letters.charAt(_i3);wideChar=String.fromCharCode(55349,56320+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text$2,main,textord,_ch3,wideChar),wideChar=String.fromCharCode(55349,56372+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text$2,main,textord,_ch3,wideChar),wideChar=String.fromCharCode(55349,56424+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text$2,main,textord,_ch3,wideChar),wideChar=String.fromCharCode(55349,56580+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text$2,main,textord,_ch3,wideChar),wideChar=String.fromCharCode(55349,56684+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text$2,main,textord,_ch3,wideChar),wideChar=String.fromCharCode(55349,56736+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text$2,main,textord,_ch3,wideChar),wideChar=String.fromCharCode(55349,56788+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text$2,main,textord,_ch3,wideChar),wideChar=String.fromCharCode(55349,56840+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text$2,main,textord,_ch3,wideChar),wideChar=String.fromCharCode(55349,56944+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text$2,main,textord,_ch3,wideChar),_i3<26&&(wideChar=String.fromCharCode(55349,56632+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text$2,main,textord,_ch3,wideChar),wideChar=String.fromCharCode(55349,56476+_i3),defineSymbol(math,main,mathord,_ch3,wideChar),defineSymbol(text$2,main,textord,_ch3,wideChar))}wideChar="𝕜";defineSymbol(math,main,mathord,"k",wideChar);defineSymbol(text$2,main,textord,"k",wideChar);for(var _i4=0;_i4<10;_i4++){var _ch4=_i4.toString();wideChar=String.fromCharCode(55349,57294+_i4),defineSymbol(math,main,mathord,_ch4,wideChar),defineSymbol(text$2,main,textord,_ch4,wideChar),wideChar=String.fromCharCode(55349,57314+_i4),defineSymbol(math,main,mathord,_ch4,wideChar),defineSymbol(text$2,main,textord,_ch4,wideChar),wideChar=String.fromCharCode(55349,57324+_i4),defineSymbol(math,main,mathord,_ch4,wideChar),defineSymbol(text$2,main,textord,_ch4,wideChar),wideChar=String.fromCharCode(55349,57334+_i4),defineSymbol(math,main,mathord,_ch4,wideChar),defineSymbol(text$2,main,textord,_ch4,wideChar)}var extraLatin="ÐÞþ";for(var _i5=0;_i5<extraLatin.length;_i5++){var _ch5=extraLatin.charAt(_i5);defineSymbol(math,main,mathord,_ch5,_ch5),defineSymbol(text$2,main,textord,_ch5,_ch5)}var wideLatinLetterData=[["mathbf","textbf","Main-Bold"],["mathbf","textbf","Main-Bold"],["mathnormal","textit","Math-Italic"],["mathnormal","textit","Math-Italic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["mathscr","textscr","Script-Regular"],["","",""],["","",""],["","",""],["mathfrak","textfrak","Fraktur-Regular"],["mathfrak","textfrak","Fraktur-Regular"],["mathbb","textbb","AMS-Regular"],["mathbb","textbb","AMS-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathitsf","textitsf","SansSerif-Italic"],["mathitsf","textitsf","SansSerif-Italic"],["","",""],["","",""],["mathtt","texttt","Typewriter-Regular"],["mathtt","texttt","Typewriter-Regular"]],wideNumeralData=[["mathbf","textbf","Main-Bold"],["","",""],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathtt","texttt","Typewriter-Regular"]],wideCharacterFont=function e(a,o){var c=a.charCodeAt(0),d=a.charCodeAt(1),$=(c-55296)*1024+(d-56320)+65536,g=o==="math"?0:1;if(119808<=$&&$<120484){var b=Math.floor(($-119808)/26);return[wideLatinLetterData[b][2],wideLatinLetterData[b][g]]}else if(120782<=$&&$<=120831){var _=Math.floor(($-120782)/10);return[wideNumeralData[_][2],wideNumeralData[_][g]]}else{if($===120485||$===120486)return[wideLatinLetterData[0][2],wideLatinLetterData[0][g]];if(120486<$&&$<120782)return["",""];throw new ParseError("Unsupported character: "+a)}},lookupSymbol=function e(a,o,c){return symbols[c][a]&&symbols[c][a].replace&&(a=symbols[c][a].replace),{value:a,metrics:getCharacterMetrics(a,o,c)}},makeSymbol=function e(a,o,c,d,$){var g=lookupSymbol(a,o,c),b=g.metrics;a=g.value;var _;if(b){var j=b.italic;(c==="text"||d&&d.font==="mathit")&&(j=0),_=new SymbolNode(a,b.height,b.depth,j,b.skew,b.width,$)}else typeof console<"u"&&console.warn("No character metrics "+("for '"+a+"' in style '"+o+"' and mode '"+c+"'")),_=new SymbolNode(a,0,0,0,0,0,$);if(d){_.maxFontSize=d.sizeMultiplier,d.style.isTight()&&_.classes.push("mtight");var _e=d.getColor();_e&&(_.style.color=_e)}return _},mathsym=function e(a,o,c,d){return d===void 0&&(d=[]),c.font==="boldsymbol"&&lookupSymbol(a,"Main-Bold",o).metrics?makeSymbol(a,"Main-Bold",o,c,d.concat(["mathbf"])):a==="\\"||symbols[o][a].font==="main"?makeSymbol(a,"Main-Regular",o,c,d):makeSymbol(a,"AMS-Regular",o,c,d.concat(["amsrm"]))},boldsymbol=function e(a,o,c,d,$){return $!=="textord"&&lookupSymbol(a,"Math-BoldItalic",o).metrics?{fontName:"Math-BoldItalic",fontClass:"boldsymbol"}:{fontName:"Main-Bold",fontClass:"mathbf"}},makeOrd=function e(a,o,c){var d=a.mode,$=a.text,g=["mord"],b=d==="math"||d==="text"&&o.font,_=b?o.font:o.fontFamily,j="",_e="";if($.charCodeAt(0)===55349&&([j,_e]=wideCharacterFont($,d)),j.length>0)return makeSymbol($,j,d,o,g.concat(_e));if(_){var et,tt;if(_==="boldsymbol"){var nt=boldsymbol($,d,o,g,c);et=nt.fontName,tt=[nt.fontClass]}else b?(et=fontMap[_].fontName,tt=[_]):(et=retrieveTextFontName(_,o.fontWeight,o.fontShape),tt=[_,o.fontWeight,o.fontShape]);if(lookupSymbol($,et,d).metrics)return makeSymbol($,et,d,o,g.concat(tt));if(ligatures.hasOwnProperty($)&&et.slice(0,10)==="Typewriter"){for(var at=[],lt=0;lt<$.length;lt++)at.push(makeSymbol($[lt],et,d,o,g.concat(tt)));return makeFragment(at)}}if(c==="mathord")return makeSymbol($,"Math-Italic",d,o,g.concat(["mathnormal"]));if(c==="textord"){var mt=symbols[d][$]&&symbols[d][$].font;if(mt==="ams"){var ot=retrieveTextFontName("amsrm",o.fontWeight,o.fontShape);return makeSymbol($,ot,d,o,g.concat("amsrm",o.fontWeight,o.fontShape))}else if(mt==="main"||!mt){var st=retrieveTextFontName("textrm",o.fontWeight,o.fontShape);return makeSymbol($,st,d,o,g.concat(o.fontWeight,o.fontShape))}else{var ut=retrieveTextFontName(mt,o.fontWeight,o.fontShape);return makeSymbol($,ut,d,o,g.concat(ut,o.fontWeight,o.fontShape))}}else throw new Error("unexpected type: "+c+" in makeOrd")},canCombine=(e,a)=>{if(createClass(e.classes)!==createClass(a.classes)||e.skew!==a.skew||e.maxFontSize!==a.maxFontSize)return!1;if(e.classes.length===1){var o=e.classes[0];if(o==="mbin"||o==="mord")return!1}for(var c in e.style)if(e.style.hasOwnProperty(c)&&e.style[c]!==a.style[c])return!1;for(var d in a.style)if(a.style.hasOwnProperty(d)&&e.style[d]!==a.style[d])return!1;return!0},tryCombineChars=e=>{for(var a=0;a<e.length-1;a++){var o=e[a],c=e[a+1];o instanceof SymbolNode&&c instanceof SymbolNode&&canCombine(o,c)&&(o.text+=c.text,o.height=Math.max(o.height,c.height),o.depth=Math.max(o.depth,c.depth),o.italic=c.italic,e.splice(a+1,1),a--)}return e},sizeElementFromChildren=function e(a){for(var o=0,c=0,d=0,$=0;$<a.children.length;$++){var g=a.children[$];g.height>o&&(o=g.height),g.depth>c&&(c=g.depth),g.maxFontSize>d&&(d=g.maxFontSize)}a.height=o,a.depth=c,a.maxFontSize=d},makeSpan$2=function e(a,o,c,d){var $=new Span(a,o,c,d);return sizeElementFromChildren($),$},makeSvgSpan=(e,a,o,c)=>new Span(e,a,o,c),makeLineSpan=function e(a,o,c){var d=makeSpan$2([a],[],o);return d.height=Math.max(c||o.fontMetrics().defaultRuleThickness,o.minRuleThickness),d.style.borderBottomWidth=makeEm(d.height),d.maxFontSize=1,d},makeAnchor=function e(a,o,c,d){var $=new Anchor(a,o,c,d);return sizeElementFromChildren($),$},makeFragment=function e(a){var o=new DocumentFragment(a);return sizeElementFromChildren(o),o},wrapFragment=function e(a,o){return a instanceof DocumentFragment?makeSpan$2([],[a],o):a},getVListChildrenAndDepth=function e(a){if(a.positionType==="individualShift"){for(var o=a.children,c=[o[0]],d=-o[0].shift-o[0].elem.depth,$=d,g=1;g<o.length;g++){var b=-o[g].shift-$-o[g].elem.depth,_=b-(o[g-1].elem.height+o[g-1].elem.depth);$=$+b,c.push({type:"kern",size:_}),c.push(o[g])}return{children:c,depth:d}}var j;if(a.positionType==="top"){for(var _e=a.positionData,et=0;et<a.children.length;et++){var tt=a.children[et];_e-=tt.type==="kern"?tt.size:tt.elem.height+tt.elem.depth}j=_e}else if(a.positionType==="bottom")j=-a.positionData;else{var nt=a.children[0];if(nt.type!=="elem")throw new Error('First child must have type "elem".');if(a.positionType==="shift")j=-nt.elem.depth-a.positionData;else if(a.positionType==="firstBaseline")j=-nt.elem.depth;else throw new Error("Invalid positionType "+a.positionType+".")}return{children:a.children,depth:j}},makeVList=function e(a,o){for(var{children:c,depth:d}=getVListChildrenAndDepth(a),$=0,g=0;g<c.length;g++){var b=c[g];if(b.type==="elem"){var _=b.elem;$=Math.max($,_.maxFontSize,_.height)}}$+=2;var j=makeSpan$2(["pstrut"],[]);j.style.height=makeEm($);for(var _e=[],et=d,tt=d,nt=d,at=0;at<c.length;at++){var lt=c[at];if(lt.type==="kern")nt+=lt.size;else{var mt=lt.elem,ot=lt.wrapperClasses||[],st=lt.wrapperStyle||{},ut=makeSpan$2(ot,[j,mt],void 0,st);ut.style.top=makeEm(-$-nt-mt.depth),lt.marginLeft&&(ut.style.marginLeft=lt.marginLeft),lt.marginRight&&(ut.style.marginRight=lt.marginRight),_e.push(ut),nt+=mt.height+mt.depth}et=Math.min(et,nt),tt=Math.max(tt,nt)}var pt=makeSpan$2(["vlist"],_e);pt.style.height=makeEm(tt);var gt;if(et<0){var ft=makeSpan$2([],[]),yt=makeSpan$2(["vlist"],[ft]);yt.style.height=makeEm(-et);var _t=makeSpan$2(["vlist-s"],[new SymbolNode("​")]);gt=[makeSpan$2(["vlist-r"],[pt,_t]),makeSpan$2(["vlist-r"],[yt])]}else gt=[makeSpan$2(["vlist-r"],[pt])];var vt=makeSpan$2(["vlist-t"],gt);return gt.length===2&&vt.classes.push("vlist-t2"),vt.height=tt,vt.depth=-et,vt},makeGlue=(e,a)=>{var o=makeSpan$2(["mspace"],[],a),c=calculateSize(e,a);return o.style.marginRight=makeEm(c),o},retrieveTextFontName=function e(a,o,c){var d="";switch(a){case"amsrm":d="AMS";break;case"textrm":d="Main";break;case"textsf":d="SansSerif";break;case"texttt":d="Typewriter";break;default:d=a}var $;return o==="textbf"&&c==="textit"?$="BoldItalic":o==="textbf"?$="Bold":o==="textit"?$="Italic":$="Regular",d+"-"+$},fontMap={mathbf:{variant:"bold",fontName:"Main-Bold"},mathrm:{variant:"normal",fontName:"Main-Regular"},textit:{variant:"italic",fontName:"Main-Italic"},mathit:{variant:"italic",fontName:"Main-Italic"},mathnormal:{variant:"italic",fontName:"Math-Italic"},mathsfit:{variant:"sans-serif-italic",fontName:"SansSerif-Italic"},mathbb:{variant:"double-struck",fontName:"AMS-Regular"},mathcal:{variant:"script",fontName:"Caligraphic-Regular"},mathfrak:{variant:"fraktur",fontName:"Fraktur-Regular"},mathscr:{variant:"script",fontName:"Script-Regular"},mathsf:{variant:"sans-serif",fontName:"SansSerif-Regular"},mathtt:{variant:"monospace",fontName:"Typewriter-Regular"}},svgData={vec:["vec",.471,.714],oiintSize1:["oiintSize1",.957,.499],oiintSize2:["oiintSize2",1.472,.659],oiiintSize1:["oiiintSize1",1.304,.499],oiiintSize2:["oiiintSize2",1.98,.659]},staticSvg=function e(a,o){var[c,d,$]=svgData[a],g=new PathNode(c),b=new SvgNode([g],{width:makeEm(d),height:makeEm($),style:"width:"+makeEm(d),viewBox:"0 0 "+1e3*d+" "+1e3*$,preserveAspectRatio:"xMinYMin"}),_=makeSvgSpan(["overlay"],[b],o);return _.height=$,_.style.height=makeEm($),_.style.width=makeEm(d),_},buildCommon={fontMap,makeSymbol,mathsym,makeSpan:makeSpan$2,makeSvgSpan,makeLineSpan,makeAnchor,makeFragment,wrapFragment,makeVList,makeOrd,makeGlue,staticSvg,svgData,tryCombineChars},thinspace={number:3,unit:"mu"},mediumspace={number:4,unit:"mu"},thickspace={number:5,unit:"mu"},spacings={mord:{mop:thinspace,mbin:mediumspace,mrel:thickspace,minner:thinspace},mop:{mord:thinspace,mop:thinspace,mrel:thickspace,minner:thinspace},mbin:{mord:mediumspace,mop:mediumspace,mopen:mediumspace,minner:mediumspace},mrel:{mord:thickspace,mop:thickspace,mopen:thickspace,minner:thickspace},mopen:{},mclose:{mop:thinspace,mbin:mediumspace,mrel:thickspace,minner:thinspace},mpunct:{mord:thinspace,mop:thinspace,mrel:thickspace,mopen:thinspace,mclose:thinspace,mpunct:thinspace,minner:thinspace},minner:{mord:thinspace,mop:thinspace,mbin:mediumspace,mrel:thickspace,mopen:thinspace,mpunct:thinspace,minner:thinspace}},tightSpacings={mord:{mop:thinspace},mop:{mord:thinspace,mop:thinspace},mbin:{},mrel:{},mopen:{},mclose:{mop:thinspace},mpunct:{},minner:{mop:thinspace}},_functions={},_htmlGroupBuilders={},_mathmlGroupBuilders={};function defineFunction(e){for(var{type:a,names:o,props:c,handler:d,htmlBuilder:$,mathmlBuilder:g}=e,b={type:a,numArgs:c.numArgs,argTypes:c.argTypes,allowedInArgument:!!c.allowedInArgument,allowedInText:!!c.allowedInText,allowedInMath:c.allowedInMath===void 0?!0:c.allowedInMath,numOptionalArgs:c.numOptionalArgs||0,infix:!!c.infix,primitive:!!c.primitive,handler:d},_=0;_<o.length;++_)_functions[o[_]]=b;a&&($&&(_htmlGroupBuilders[a]=$),g&&(_mathmlGroupBuilders[a]=g))}function defineFunctionBuilders(e){var{type:a,htmlBuilder:o,mathmlBuilder:c}=e;defineFunction({type:a,names:[],props:{numArgs:0},handler(){throw new Error("Should never be called.")},htmlBuilder:o,mathmlBuilder:c})}var normalizeArgument=function e(a){return a.type==="ordgroup"&&a.body.length===1?a.body[0]:a},ordargument=function e(a){return a.type==="ordgroup"?a.body:[a]},makeSpan$1=buildCommon.makeSpan,binLeftCanceller=["leftmost","mbin","mopen","mrel","mop","mpunct"],binRightCanceller=["rightmost","mrel","mclose","mpunct"],styleMap$1={display:Style$1.DISPLAY,text:Style$1.TEXT,script:Style$1.SCRIPT,scriptscript:Style$1.SCRIPTSCRIPT},DomEnum={mord:"mord",mop:"mop",mbin:"mbin",mrel:"mrel",mopen:"mopen",mclose:"mclose",mpunct:"mpunct",minner:"minner"},buildExpression$1=function e(a,o,c,d){d===void 0&&(d=[null,null]);for(var $=[],g=0;g<a.length;g++){var b=buildGroup$1(a[g],o);if(b instanceof DocumentFragment){var _=b.children;$.push(..._)}else $.push(b)}if(buildCommon.tryCombineChars($),!c)return $;var j=o;if(a.length===1){var _e=a[0];_e.type==="sizing"?j=o.havingSize(_e.size):_e.type==="styling"&&(j=o.havingStyle(styleMap$1[_e.style]))}var et=makeSpan$1([d[0]||"leftmost"],[],o),tt=makeSpan$1([d[1]||"rightmost"],[],o),nt=c==="root";return traverseNonSpaceNodes($,(at,lt)=>{var mt=lt.classes[0],ot=at.classes[0];mt==="mbin"&&utils.contains(binRightCanceller,ot)?lt.classes[0]="mord":ot==="mbin"&&utils.contains(binLeftCanceller,mt)&&(at.classes[0]="mord")},{node:et},tt,nt),traverseNonSpaceNodes($,(at,lt)=>{var mt=getTypeOfDomTree(lt),ot=getTypeOfDomTree(at),st=mt&&ot?at.hasClass("mtight")?tightSpacings[mt][ot]:spacings[mt][ot]:null;if(st)return buildCommon.makeGlue(st,j)},{node:et},tt,nt),$},traverseNonSpaceNodes=function e(a,o,c,d,$){d&&a.push(d);for(var g=0;g<a.length;g++){var b=a[g],_=checkPartialGroup(b);if(_){e(_.children,o,c,null,$);continue}var j=!b.hasClass("mspace");if(j){var _e=o(b,c.node);_e&&(c.insertAfter?c.insertAfter(_e):(a.unshift(_e),g++))}j?c.node=b:$&&b.hasClass("newline")&&(c.node=makeSpan$1(["leftmost"])),c.insertAfter=(et=>tt=>{a.splice(et+1,0,tt),g++})(g)}d&&a.pop()},checkPartialGroup=function e(a){return a instanceof DocumentFragment||a instanceof Anchor||a instanceof Span&&a.hasClass("enclosing")?a:null},getOutermostNode=function e(a,o){var c=checkPartialGroup(a);if(c){var d=c.children;if(d.length){if(o==="right")return e(d[d.length-1],"right");if(o==="left")return e(d[0],"left")}}return a},getTypeOfDomTree=function e(a,o){return a?(o&&(a=getOutermostNode(a,o)),DomEnum[a.classes[0]]||null):null},makeNullDelimiter=function e(a,o){var c=["nulldelimiter"].concat(a.baseSizingClasses());return makeSpan$1(o.concat(c))},buildGroup$1=function e(a,o,c){if(!a)return makeSpan$1();if(_htmlGroupBuilders[a.type]){var d=_htmlGroupBuilders[a.type](a,o);if(c&&o.size!==c.size){d=makeSpan$1(o.sizingClasses(c),[d],o);var $=o.sizeMultiplier/c.sizeMultiplier;d.height*=$,d.depth*=$}return d}else throw new ParseError("Got group of unknown type: '"+a.type+"'")};function buildHTMLUnbreakable(e,a){var o=makeSpan$1(["base"],e,a),c=makeSpan$1(["strut"]);return c.style.height=makeEm(o.height+o.depth),o.depth&&(c.style.verticalAlign=makeEm(-o.depth)),o.children.unshift(c),o}function buildHTML(e,a){var o=null;e.length===1&&e[0].type==="tag"&&(o=e[0].tag,e=e[0].body);var c=buildExpression$1(e,a,"root"),d;c.length===2&&c[1].hasClass("tag")&&(d=c.pop());for(var $=[],g=[],b=0;b<c.length;b++)if(g.push(c[b]),c[b].hasClass("mbin")||c[b].hasClass("mrel")||c[b].hasClass("allowbreak")){for(var _=!1;b<c.length-1&&c[b+1].hasClass("mspace")&&!c[b+1].hasClass("newline");)b++,g.push(c[b]),c[b].hasClass("nobreak")&&(_=!0);_||($.push(buildHTMLUnbreakable(g,a)),g=[])}else c[b].hasClass("newline")&&(g.pop(),g.length>0&&($.push(buildHTMLUnbreakable(g,a)),g=[]),$.push(c[b]));g.length>0&&$.push(buildHTMLUnbreakable(g,a));var j;o?(j=buildHTMLUnbreakable(buildExpression$1(o,a,!0)),j.classes=["tag"],$.push(j)):d&&$.push(d);var _e=makeSpan$1(["katex-html"],$);if(_e.setAttribute("aria-hidden","true"),j){var et=j.children[0];et.style.height=makeEm(_e.height+_e.depth),_e.depth&&(et.style.verticalAlign=makeEm(-_e.depth))}return _e}function newDocumentFragment(e){return new DocumentFragment(e)}class MathNode{constructor(a,o,c){this.type=void 0,this.attributes=void 0,this.children=void 0,this.classes=void 0,this.type=a,this.attributes={},this.children=o||[],this.classes=c||[]}setAttribute(a,o){this.attributes[a]=o}getAttribute(a){return this.attributes[a]}toNode(){var a=document.createElementNS("http://www.w3.org/1998/Math/MathML",this.type);for(var o in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,o)&&a.setAttribute(o,this.attributes[o]);this.classes.length>0&&(a.className=createClass(this.classes));for(var c=0;c<this.children.length;c++)a.appendChild(this.children[c].toNode());return a}toMarkup(){var a="<"+this.type;for(var o in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,o)&&(a+=" "+o+'="',a+=utils.escape(this.attributes[o]),a+='"');this.classes.length>0&&(a+=' class ="'+utils.escape(createClass(this.classes))+'"'),a+=">";for(var c=0;c<this.children.length;c++)a+=this.children[c].toMarkup();return a+="</"+this.type+">",a}toText(){return this.children.map(a=>a.toText()).join("")}}class TextNode{constructor(a){this.text=void 0,this.text=a}toNode(){return document.createTextNode(this.text)}toMarkup(){return utils.escape(this.toText())}toText(){return this.text}}class SpaceNode{constructor(a){this.width=void 0,this.character=void 0,this.width=a,a>=.05555&&a<=.05556?this.character=" ":a>=.1666&&a<=.1667?this.character=" ":a>=.2222&&a<=.2223?this.character=" ":a>=.2777&&a<=.2778?this.character="  ":a>=-.05556&&a<=-.05555?this.character=" ⁣":a>=-.1667&&a<=-.1666?this.character=" ⁣":a>=-.2223&&a<=-.2222?this.character=" ⁣":a>=-.2778&&a<=-.2777?this.character=" ⁣":this.character=null}toNode(){if(this.character)return document.createTextNode(this.character);var a=document.createElementNS("http://www.w3.org/1998/Math/MathML","mspace");return a.setAttribute("width",makeEm(this.width)),a}toMarkup(){return this.character?"<mtext>"+this.character+"</mtext>":'<mspace width="'+makeEm(this.width)+'"/>'}toText(){return this.character?this.character:" "}}var mathMLTree={MathNode,TextNode,SpaceNode,newDocumentFragment},makeText=function e(a,o,c){return symbols[o][a]&&symbols[o][a].replace&&a.charCodeAt(0)!==55349&&!(ligatures.hasOwnProperty(a)&&c&&(c.fontFamily&&c.fontFamily.slice(4,6)==="tt"||c.font&&c.font.slice(4,6)==="tt"))&&(a=symbols[o][a].replace),new mathMLTree.TextNode(a)},makeRow=function e(a){return a.length===1?a[0]:new mathMLTree.MathNode("mrow",a)},getVariant=function e(a,o){if(o.fontFamily==="texttt")return"monospace";if(o.fontFamily==="textsf")return o.fontShape==="textit"&&o.fontWeight==="textbf"?"sans-serif-bold-italic":o.fontShape==="textit"?"sans-serif-italic":o.fontWeight==="textbf"?"bold-sans-serif":"sans-serif";if(o.fontShape==="textit"&&o.fontWeight==="textbf")return"bold-italic";if(o.fontShape==="textit")return"italic";if(o.fontWeight==="textbf")return"bold";var c=o.font;if(!c||c==="mathnormal")return null;var d=a.mode;if(c==="mathit")return"italic";if(c==="boldsymbol")return a.type==="textord"?"bold":"bold-italic";if(c==="mathbf")return"bold";if(c==="mathbb")return"double-struck";if(c==="mathsfit")return"sans-serif-italic";if(c==="mathfrak")return"fraktur";if(c==="mathscr"||c==="mathcal")return"script";if(c==="mathsf")return"sans-serif";if(c==="mathtt")return"monospace";var $=a.text;if(utils.contains(["\\imath","\\jmath"],$))return null;symbols[d][$]&&symbols[d][$].replace&&($=symbols[d][$].replace);var g=buildCommon.fontMap[c].fontName;return getCharacterMetrics($,g,d)?buildCommon.fontMap[c].variant:null},buildExpression=function e(a,o,c){if(a.length===1){var d=buildGroup(a[0],o);return c&&d instanceof MathNode&&d.type==="mo"&&(d.setAttribute("lspace","0em"),d.setAttribute("rspace","0em")),[d]}for(var $=[],g,b=0;b<a.length;b++){var _=buildGroup(a[b],o);if(_ instanceof MathNode&&g instanceof MathNode){if(_.type==="mtext"&&g.type==="mtext"&&_.getAttribute("mathvariant")===g.getAttribute("mathvariant")){g.children.push(..._.children);continue}else if(_.type==="mn"&&g.type==="mn"){g.children.push(..._.children);continue}else if(_.type==="mi"&&_.children.length===1&&g.type==="mn"){var j=_.children[0];if(j instanceof TextNode&&j.text==="."){g.children.push(..._.children);continue}}else if(g.type==="mi"&&g.children.length===1){var _e=g.children[0];if(_e instanceof TextNode&&_e.text==="̸"&&(_.type==="mo"||_.type==="mi"||_.type==="mn")){var et=_.children[0];et instanceof TextNode&&et.text.length>0&&(et.text=et.text.slice(0,1)+"̸"+et.text.slice(1),$.pop())}}}$.push(_),g=_}return $},buildExpressionRow=function e(a,o,c){return makeRow(buildExpression(a,o,c))},buildGroup=function e(a,o){if(!a)return new mathMLTree.MathNode("mrow");if(_mathmlGroupBuilders[a.type]){var c=_mathmlGroupBuilders[a.type](a,o);return c}else throw new ParseError("Got group of unknown type: '"+a.type+"'")};function buildMathML(e,a,o,c,d){var $=buildExpression(e,o),g;$.length===1&&$[0]instanceof MathNode&&utils.contains(["mrow","mtable"],$[0].type)?g=$[0]:g=new mathMLTree.MathNode("mrow",$);var b=new mathMLTree.MathNode("annotation",[new mathMLTree.TextNode(a)]);b.setAttribute("encoding","application/x-tex");var _=new mathMLTree.MathNode("semantics",[g,b]),j=new mathMLTree.MathNode("math",[_]);j.setAttribute("xmlns","http://www.w3.org/1998/Math/MathML"),c&&j.setAttribute("display","block");var _e=d?"katex":"katex-mathml";return buildCommon.makeSpan([_e],[j])}var optionsFromSettings=function e(a){return new Options({style:a.displayMode?Style$1.DISPLAY:Style$1.TEXT,maxSize:a.maxSize,minRuleThickness:a.minRuleThickness})},displayWrap=function e(a,o){if(o.displayMode){var c=["katex-display"];o.leqno&&c.push("leqno"),o.fleqn&&c.push("fleqn"),a=buildCommon.makeSpan(c,[a])}return a},buildTree=function e(a,o,c){var d=optionsFromSettings(c),$;if(c.output==="mathml")return buildMathML(a,o,d,c.displayMode,!0);if(c.output==="html"){var g=buildHTML(a,d);$=buildCommon.makeSpan(["katex"],[g])}else{var b=buildMathML(a,o,d,c.displayMode,!1),_=buildHTML(a,d);$=buildCommon.makeSpan(["katex"],[b,_])}return displayWrap($,c)},buildHTMLTree=function e(a,o,c){var d=optionsFromSettings(c),$=buildHTML(a,d),g=buildCommon.makeSpan(["katex"],[$]);return displayWrap(g,c)},stretchyCodePoint={widehat:"^",widecheck:"ˇ",widetilde:"~",utilde:"~",overleftarrow:"←",underleftarrow:"←",xleftarrow:"←",overrightarrow:"→",underrightarrow:"→",xrightarrow:"→",underbrace:"⏟",overbrace:"⏞",overgroup:"⏠",undergroup:"⏡",overleftrightarrow:"↔",underleftrightarrow:"↔",xleftrightarrow:"↔",Overrightarrow:"⇒",xRightarrow:"⇒",overleftharpoon:"↼",xleftharpoonup:"↼",overrightharpoon:"⇀",xrightharpoonup:"⇀",xLeftarrow:"⇐",xLeftrightarrow:"⇔",xhookleftarrow:"↩",xhookrightarrow:"↪",xmapsto:"↦",xrightharpoondown:"⇁",xleftharpoondown:"↽",xrightleftharpoons:"⇌",xleftrightharpoons:"⇋",xtwoheadleftarrow:"↞",xtwoheadrightarrow:"↠",xlongequal:"=",xtofrom:"⇄",xrightleftarrows:"⇄",xrightequilibrium:"⇌",xleftequilibrium:"⇋","\\cdrightarrow":"→","\\cdleftarrow":"←","\\cdlongequal":"="},mathMLnode=function e(a){var o=new mathMLTree.MathNode("mo",[new mathMLTree.TextNode(stretchyCodePoint[a.replace(/^\\/,"")])]);return o.setAttribute("stretchy","true"),o},katexImagesData={overrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],overleftarrow:[["leftarrow"],.888,522,"xMinYMin"],underrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],underleftarrow:[["leftarrow"],.888,522,"xMinYMin"],xrightarrow:[["rightarrow"],1.469,522,"xMaxYMin"],"\\cdrightarrow":[["rightarrow"],3,522,"xMaxYMin"],xleftarrow:[["leftarrow"],1.469,522,"xMinYMin"],"\\cdleftarrow":[["leftarrow"],3,522,"xMinYMin"],Overrightarrow:[["doublerightarrow"],.888,560,"xMaxYMin"],xRightarrow:[["doublerightarrow"],1.526,560,"xMaxYMin"],xLeftarrow:[["doubleleftarrow"],1.526,560,"xMinYMin"],overleftharpoon:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoonup:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoondown:[["leftharpoondown"],.888,522,"xMinYMin"],overrightharpoon:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoonup:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoondown:[["rightharpoondown"],.888,522,"xMaxYMin"],xlongequal:[["longequal"],.888,334,"xMinYMin"],"\\cdlongequal":[["longequal"],3,334,"xMinYMin"],xtwoheadleftarrow:[["twoheadleftarrow"],.888,334,"xMinYMin"],xtwoheadrightarrow:[["twoheadrightarrow"],.888,334,"xMaxYMin"],overleftrightarrow:[["leftarrow","rightarrow"],.888,522],overbrace:[["leftbrace","midbrace","rightbrace"],1.6,548],underbrace:[["leftbraceunder","midbraceunder","rightbraceunder"],1.6,548],underleftrightarrow:[["leftarrow","rightarrow"],.888,522],xleftrightarrow:[["leftarrow","rightarrow"],1.75,522],xLeftrightarrow:[["doubleleftarrow","doublerightarrow"],1.75,560],xrightleftharpoons:[["leftharpoondownplus","rightharpoonplus"],1.75,716],xleftrightharpoons:[["leftharpoonplus","rightharpoondownplus"],1.75,716],xhookleftarrow:[["leftarrow","righthook"],1.08,522],xhookrightarrow:[["lefthook","rightarrow"],1.08,522],overlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],underlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],overgroup:[["leftgroup","rightgroup"],.888,342],undergroup:[["leftgroupunder","rightgroupunder"],.888,342],xmapsto:[["leftmapsto","rightarrow"],1.5,522],xtofrom:[["leftToFrom","rightToFrom"],1.75,528],xrightleftarrows:[["baraboveleftarrow","rightarrowabovebar"],1.75,901],xrightequilibrium:[["baraboveshortleftharpoon","rightharpoonaboveshortbar"],1.75,716],xleftequilibrium:[["shortbaraboveleftharpoon","shortrightharpoonabovebar"],1.75,716]},groupLength=function e(a){return a.type==="ordgroup"?a.body.length:1},svgSpan=function e(a,o){function c(){var b=4e5,_=a.label.slice(1);if(utils.contains(["widehat","widecheck","widetilde","utilde"],_)){var j=a,_e=groupLength(j.base),et,tt,nt;if(_e>5)_==="widehat"||_==="widecheck"?(et=420,b=2364,nt=.42,tt=_+"4"):(et=312,b=2340,nt=.34,tt="tilde4");else{var at=[1,1,2,2,3,3][_e];_==="widehat"||_==="widecheck"?(b=[0,1062,2364,2364,2364][at],et=[0,239,300,360,420][at],nt=[0,.24,.3,.3,.36,.42][at],tt=_+at):(b=[0,600,1033,2339,2340][at],et=[0,260,286,306,312][at],nt=[0,.26,.286,.3,.306,.34][at],tt="tilde"+at)}var lt=new PathNode(tt),mt=new SvgNode([lt],{width:"100%",height:makeEm(nt),viewBox:"0 0 "+b+" "+et,preserveAspectRatio:"none"});return{span:buildCommon.makeSvgSpan([],[mt],o),minWidth:0,height:nt}}else{var ot=[],st=katexImagesData[_],[ut,pt,gt]=st,ft=gt/1e3,yt=ut.length,_t,vt;if(yt===1){var Pt=st[3];_t=["hide-tail"],vt=[Pt]}else if(yt===2)_t=["halfarrow-left","halfarrow-right"],vt=["xMinYMin","xMaxYMin"];else if(yt===3)_t=["brace-left","brace-center","brace-right"],vt=["xMinYMin","xMidYMin","xMaxYMin"];else throw new Error(`Correct katexImagesData or update code here to support
                    `+yt+" children.");for(var Tt=0;Tt<yt;Tt++){var St=new PathNode(ut[Tt]),qt=new SvgNode([St],{width:"400em",height:makeEm(ft),viewBox:"0 0 "+b+" "+gt,preserveAspectRatio:vt[Tt]+" slice"}),Ft=buildCommon.makeSvgSpan([_t[Tt]],[qt],o);if(yt===1)return{span:Ft,minWidth:pt,height:ft};Ft.style.height=makeEm(ft),ot.push(Ft)}return{span:buildCommon.makeSpan(["stretchy"],ot,o),minWidth:pt,height:ft}}}var{span:d,minWidth:$,height:g}=c();return d.height=g,d.style.height=makeEm(g),$>0&&(d.style.minWidth=makeEm($)),d},encloseSpan=function e(a,o,c,d,$){var g,b=a.height+a.depth+c+d;if(/fbox|color|angl/.test(o)){if(g=buildCommon.makeSpan(["stretchy",o],[],$),o==="fbox"){var _=$.color&&$.getColor();_&&(g.style.borderColor=_)}}else{var j=[];/^[bx]cancel$/.test(o)&&j.push(new LineNode({x1:"0",y1:"0",x2:"100%",y2:"100%","stroke-width":"0.046em"})),/^x?cancel$/.test(o)&&j.push(new LineNode({x1:"0",y1:"100%",x2:"100%",y2:"0","stroke-width":"0.046em"}));var _e=new SvgNode(j,{width:"100%",height:makeEm(b)});g=buildCommon.makeSvgSpan([],[_e],$)}return g.height=b,g.style.height=makeEm(b),g},stretchy={encloseSpan,mathMLnode,svgSpan};function assertNodeType(e,a){if(!e||e.type!==a)throw new Error("Expected node of type "+a+", but got "+(e?"node of type "+e.type:String(e)));return e}function assertSymbolNodeType(e){var a=checkSymbolNodeType(e);if(!a)throw new Error("Expected node of symbol group type, but got "+(e?"node of type "+e.type:String(e)));return a}function checkSymbolNodeType(e){return e&&(e.type==="atom"||NON_ATOMS.hasOwnProperty(e.type))?e:null}var htmlBuilder$a=(e,a)=>{var o,c,d;e&&e.type==="supsub"?(c=assertNodeType(e.base,"accent"),o=c.base,e.base=o,d=assertSpan(buildGroup$1(e,a)),e.base=c):(c=assertNodeType(e,"accent"),o=c.base);var $=buildGroup$1(o,a.havingCrampedStyle()),g=c.isShifty&&utils.isCharacterBox(o),b=0;if(g){var _=utils.getBaseElem(o),j=buildGroup$1(_,a.havingCrampedStyle());b=assertSymbolDomNode(j).skew}var _e=c.label==="\\c",et=_e?$.height+$.depth:Math.min($.height,a.fontMetrics().xHeight),tt;if(c.isStretchy)tt=stretchy.svgSpan(c,a),tt=buildCommon.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:$},{type:"elem",elem:tt,wrapperClasses:["svg-align"],wrapperStyle:b>0?{width:"calc(100% - "+makeEm(2*b)+")",marginLeft:makeEm(2*b)}:void 0}]},a);else{var nt,at;c.label==="\\vec"?(nt=buildCommon.staticSvg("vec",a),at=buildCommon.svgData.vec[1]):(nt=buildCommon.makeOrd({mode:c.mode,text:c.label},a,"textord"),nt=assertSymbolDomNode(nt),nt.italic=0,at=nt.width,_e&&(et+=nt.depth)),tt=buildCommon.makeSpan(["accent-body"],[nt]);var lt=c.label==="\\textcircled";lt&&(tt.classes.push("accent-full"),et=$.height);var mt=b;lt||(mt-=at/2),tt.style.left=makeEm(mt),c.label==="\\textcircled"&&(tt.style.top=".2em"),tt=buildCommon.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:$},{type:"kern",size:-et},{type:"elem",elem:tt}]},a)}var ot=buildCommon.makeSpan(["mord","accent"],[tt],a);return d?(d.children[0]=ot,d.height=Math.max(ot.height,d.height),d.classes[0]="mord",d):ot},mathmlBuilder$9=(e,a)=>{var o=e.isStretchy?stretchy.mathMLnode(e.label):new mathMLTree.MathNode("mo",[makeText(e.label,e.mode)]),c=new mathMLTree.MathNode("mover",[buildGroup(e.base,a),o]);return c.setAttribute("accent","true"),c},NON_STRETCHY_ACCENT_REGEX=new RegExp(["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring"].map(e=>"\\"+e).join("|"));defineFunction({type:"accent",names:["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring","\\widecheck","\\widehat","\\widetilde","\\overrightarrow","\\overleftarrow","\\Overrightarrow","\\overleftrightarrow","\\overgroup","\\overlinesegment","\\overleftharpoon","\\overrightharpoon"],props:{numArgs:1},handler:(e,a)=>{var o=normalizeArgument(a[0]),c=!NON_STRETCHY_ACCENT_REGEX.test(e.funcName),d=!c||e.funcName==="\\widehat"||e.funcName==="\\widetilde"||e.funcName==="\\widecheck";return{type:"accent",mode:e.parser.mode,label:e.funcName,isStretchy:c,isShifty:d,base:o}},htmlBuilder:htmlBuilder$a,mathmlBuilder:mathmlBuilder$9});defineFunction({type:"accent",names:["\\'","\\`","\\^","\\~","\\=","\\u","\\.",'\\"',"\\c","\\r","\\H","\\v","\\textcircled"],props:{numArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["primitive"]},handler:(e,a)=>{var o=a[0],c=e.parser.mode;return c==="math"&&(e.parser.settings.reportNonstrict("mathVsTextAccents","LaTeX's accent "+e.funcName+" works only in text mode"),c="text"),{type:"accent",mode:c,label:e.funcName,isStretchy:!1,isShifty:!0,base:o}},htmlBuilder:htmlBuilder$a,mathmlBuilder:mathmlBuilder$9});defineFunction({type:"accentUnder",names:["\\underleftarrow","\\underrightarrow","\\underleftrightarrow","\\undergroup","\\underlinesegment","\\utilde"],props:{numArgs:1},handler:(e,a)=>{var{parser:o,funcName:c}=e,d=a[0];return{type:"accentUnder",mode:o.mode,label:c,base:d}},htmlBuilder:(e,a)=>{var o=buildGroup$1(e.base,a),c=stretchy.svgSpan(e,a),d=e.label==="\\utilde"?.12:0,$=buildCommon.makeVList({positionType:"top",positionData:o.height,children:[{type:"elem",elem:c,wrapperClasses:["svg-align"]},{type:"kern",size:d},{type:"elem",elem:o}]},a);return buildCommon.makeSpan(["mord","accentunder"],[$],a)},mathmlBuilder:(e,a)=>{var o=stretchy.mathMLnode(e.label),c=new mathMLTree.MathNode("munder",[buildGroup(e.base,a),o]);return c.setAttribute("accentunder","true"),c}});var paddedNode=e=>{var a=new mathMLTree.MathNode("mpadded",e?[e]:[]);return a.setAttribute("width","+0.6em"),a.setAttribute("lspace","0.3em"),a};defineFunction({type:"xArrow",names:["\\xleftarrow","\\xrightarrow","\\xLeftarrow","\\xRightarrow","\\xleftrightarrow","\\xLeftrightarrow","\\xhookleftarrow","\\xhookrightarrow","\\xmapsto","\\xrightharpoondown","\\xrightharpoonup","\\xleftharpoondown","\\xleftharpoonup","\\xrightleftharpoons","\\xleftrightharpoons","\\xlongequal","\\xtwoheadrightarrow","\\xtwoheadleftarrow","\\xtofrom","\\xrightleftarrows","\\xrightequilibrium","\\xleftequilibrium","\\\\cdrightarrow","\\\\cdleftarrow","\\\\cdlongequal"],props:{numArgs:1,numOptionalArgs:1},handler(e,a,o){var{parser:c,funcName:d}=e;return{type:"xArrow",mode:c.mode,label:d,body:a[0],below:o[0]}},htmlBuilder(e,a){var o=a.style,c=a.havingStyle(o.sup()),d=buildCommon.wrapFragment(buildGroup$1(e.body,c,a),a),$=e.label.slice(0,2)==="\\x"?"x":"cd";d.classes.push($+"-arrow-pad");var g;e.below&&(c=a.havingStyle(o.sub()),g=buildCommon.wrapFragment(buildGroup$1(e.below,c,a),a),g.classes.push($+"-arrow-pad"));var b=stretchy.svgSpan(e,a),_=-a.fontMetrics().axisHeight+.5*b.height,j=-a.fontMetrics().axisHeight-.5*b.height-.111;(d.depth>.25||e.label==="\\xleftequilibrium")&&(j-=d.depth);var _e;if(g){var et=-a.fontMetrics().axisHeight+g.height+.5*b.height+.111;_e=buildCommon.makeVList({positionType:"individualShift",children:[{type:"elem",elem:d,shift:j},{type:"elem",elem:b,shift:_},{type:"elem",elem:g,shift:et}]},a)}else _e=buildCommon.makeVList({positionType:"individualShift",children:[{type:"elem",elem:d,shift:j},{type:"elem",elem:b,shift:_}]},a);return _e.children[0].children[0].children[1].classes.push("svg-align"),buildCommon.makeSpan(["mrel","x-arrow"],[_e],a)},mathmlBuilder(e,a){var o=stretchy.mathMLnode(e.label);o.setAttribute("minsize",e.label.charAt(0)==="x"?"1.75em":"3.0em");var c;if(e.body){var d=paddedNode(buildGroup(e.body,a));if(e.below){var $=paddedNode(buildGroup(e.below,a));c=new mathMLTree.MathNode("munderover",[o,$,d])}else c=new mathMLTree.MathNode("mover",[o,d])}else if(e.below){var g=paddedNode(buildGroup(e.below,a));c=new mathMLTree.MathNode("munder",[o,g])}else c=paddedNode(),c=new mathMLTree.MathNode("mover",[o,c]);return c}});var makeSpan=buildCommon.makeSpan;function htmlBuilder$9(e,a){var o=buildExpression$1(e.body,a,!0);return makeSpan([e.mclass],o,a)}function mathmlBuilder$8(e,a){var o,c=buildExpression(e.body,a);return e.mclass==="minner"?o=new mathMLTree.MathNode("mpadded",c):e.mclass==="mord"?e.isCharacterBox?(o=c[0],o.type="mi"):o=new mathMLTree.MathNode("mi",c):(e.isCharacterBox?(o=c[0],o.type="mo"):o=new mathMLTree.MathNode("mo",c),e.mclass==="mbin"?(o.attributes.lspace="0.22em",o.attributes.rspace="0.22em"):e.mclass==="mpunct"?(o.attributes.lspace="0em",o.attributes.rspace="0.17em"):e.mclass==="mopen"||e.mclass==="mclose"?(o.attributes.lspace="0em",o.attributes.rspace="0em"):e.mclass==="minner"&&(o.attributes.lspace="0.0556em",o.attributes.width="+0.1111em")),o}defineFunction({type:"mclass",names:["\\mathord","\\mathbin","\\mathrel","\\mathopen","\\mathclose","\\mathpunct","\\mathinner"],props:{numArgs:1,primitive:!0},handler(e,a){var{parser:o,funcName:c}=e,d=a[0];return{type:"mclass",mode:o.mode,mclass:"m"+c.slice(5),body:ordargument(d),isCharacterBox:utils.isCharacterBox(d)}},htmlBuilder:htmlBuilder$9,mathmlBuilder:mathmlBuilder$8});var binrelClass=e=>{var a=e.type==="ordgroup"&&e.body.length?e.body[0]:e;return a.type==="atom"&&(a.family==="bin"||a.family==="rel")?"m"+a.family:"mord"};defineFunction({type:"mclass",names:["\\@binrel"],props:{numArgs:2},handler(e,a){var{parser:o}=e;return{type:"mclass",mode:o.mode,mclass:binrelClass(a[0]),body:ordargument(a[1]),isCharacterBox:utils.isCharacterBox(a[1])}}});defineFunction({type:"mclass",names:["\\stackrel","\\overset","\\underset"],props:{numArgs:2},handler(e,a){var{parser:o,funcName:c}=e,d=a[1],$=a[0],g;c!=="\\stackrel"?g=binrelClass(d):g="mrel";var b={type:"op",mode:d.mode,limits:!0,alwaysHandleSupSub:!0,parentIsSupSub:!1,symbol:!1,suppressBaseShift:c!=="\\stackrel",body:ordargument(d)},_={type:"supsub",mode:$.mode,base:b,sup:c==="\\underset"?null:$,sub:c==="\\underset"?$:null};return{type:"mclass",mode:o.mode,mclass:g,body:[_],isCharacterBox:utils.isCharacterBox(_)}},htmlBuilder:htmlBuilder$9,mathmlBuilder:mathmlBuilder$8});defineFunction({type:"pmb",names:["\\pmb"],props:{numArgs:1,allowedInText:!0},handler(e,a){var{parser:o}=e;return{type:"pmb",mode:o.mode,mclass:binrelClass(a[0]),body:ordargument(a[0])}},htmlBuilder(e,a){var o=buildExpression$1(e.body,a,!0),c=buildCommon.makeSpan([e.mclass],o,a);return c.style.textShadow="0.02em 0.01em 0.04px",c},mathmlBuilder(e,a){var o=buildExpression(e.body,a),c=new mathMLTree.MathNode("mstyle",o);return c.setAttribute("style","text-shadow: 0.02em 0.01em 0.04px"),c}});var cdArrowFunctionName={">":"\\\\cdrightarrow","<":"\\\\cdleftarrow","=":"\\\\cdlongequal",A:"\\uparrow",V:"\\downarrow","|":"\\Vert",".":"no arrow"},newCell=()=>({type:"styling",body:[],mode:"math",style:"display"}),isStartOfArrow=e=>e.type==="textord"&&e.text==="@",isLabelEnd=(e,a)=>(e.type==="mathord"||e.type==="atom")&&e.text===a;function cdArrow(e,a,o){var c=cdArrowFunctionName[e];switch(c){case"\\\\cdrightarrow":case"\\\\cdleftarrow":return o.callFunction(c,[a[0]],[a[1]]);case"\\uparrow":case"\\downarrow":{var d=o.callFunction("\\\\cdleft",[a[0]],[]),$={type:"atom",text:c,mode:"math",family:"rel"},g=o.callFunction("\\Big",[$],[]),b=o.callFunction("\\\\cdright",[a[1]],[]),_={type:"ordgroup",mode:"math",body:[d,g,b]};return o.callFunction("\\\\cdparent",[_],[])}case"\\\\cdlongequal":return o.callFunction("\\\\cdlongequal",[],[]);case"\\Vert":{var j={type:"textord",text:"\\Vert",mode:"math"};return o.callFunction("\\Big",[j],[])}default:return{type:"textord",text:" ",mode:"math"}}}function parseCD(e){var a=[];for(e.gullet.beginGroup(),e.gullet.macros.set("\\cr","\\\\\\relax"),e.gullet.beginGroup();;){a.push(e.parseExpression(!1,"\\\\")),e.gullet.endGroup(),e.gullet.beginGroup();var o=e.fetch().text;if(o==="&"||o==="\\\\")e.consume();else if(o==="\\end"){a[a.length-1].length===0&&a.pop();break}else throw new ParseError("Expected \\\\ or \\cr or \\end",e.nextToken)}for(var c=[],d=[c],$=0;$<a.length;$++){for(var g=a[$],b=newCell(),_=0;_<g.length;_++)if(!isStartOfArrow(g[_]))b.body.push(g[_]);else{c.push(b),_+=1;var j=assertSymbolNodeType(g[_]).text,_e=new Array(2);if(_e[0]={type:"ordgroup",mode:"math",body:[]},_e[1]={type:"ordgroup",mode:"math",body:[]},!("=|.".indexOf(j)>-1))if("<>AV".indexOf(j)>-1)for(var et=0;et<2;et++){for(var tt=!0,nt=_+1;nt<g.length;nt++){if(isLabelEnd(g[nt],j)){tt=!1,_=nt;break}if(isStartOfArrow(g[nt]))throw new ParseError("Missing a "+j+" character to complete a CD arrow.",g[nt]);_e[et].body.push(g[nt])}if(tt)throw new ParseError("Missing a "+j+" character to complete a CD arrow.",g[_])}else throw new ParseError('Expected one of "<>AV=|." after @',g[_]);var at=cdArrow(j,_e,e),lt={type:"styling",body:[at],mode:"math",style:"display"};c.push(lt),b=newCell()}$%2===0?c.push(b):c.shift(),c=[],d.push(c)}e.gullet.endGroup(),e.gullet.endGroup();var mt=new Array(d[0].length).fill({type:"align",align:"c",pregap:.25,postgap:.25});return{type:"array",mode:"math",body:d,arraystretch:1,addJot:!0,rowGaps:[null],cols:mt,colSeparationType:"CD",hLinesBeforeRow:new Array(d.length+1).fill([])}}defineFunction({type:"cdlabel",names:["\\\\cdleft","\\\\cdright"],props:{numArgs:1},handler(e,a){var{parser:o,funcName:c}=e;return{type:"cdlabel",mode:o.mode,side:c.slice(4),label:a[0]}},htmlBuilder(e,a){var o=a.havingStyle(a.style.sup()),c=buildCommon.wrapFragment(buildGroup$1(e.label,o,a),a);return c.classes.push("cd-label-"+e.side),c.style.bottom=makeEm(.8-c.depth),c.height=0,c.depth=0,c},mathmlBuilder(e,a){var o=new mathMLTree.MathNode("mrow",[buildGroup(e.label,a)]);return o=new mathMLTree.MathNode("mpadded",[o]),o.setAttribute("width","0"),e.side==="left"&&o.setAttribute("lspace","-1width"),o.setAttribute("voffset","0.7em"),o=new mathMLTree.MathNode("mstyle",[o]),o.setAttribute("displaystyle","false"),o.setAttribute("scriptlevel","1"),o}});defineFunction({type:"cdlabelparent",names:["\\\\cdparent"],props:{numArgs:1},handler(e,a){var{parser:o}=e;return{type:"cdlabelparent",mode:o.mode,fragment:a[0]}},htmlBuilder(e,a){var o=buildCommon.wrapFragment(buildGroup$1(e.fragment,a),a);return o.classes.push("cd-vert-arrow"),o},mathmlBuilder(e,a){return new mathMLTree.MathNode("mrow",[buildGroup(e.fragment,a)])}});defineFunction({type:"textord",names:["\\@char"],props:{numArgs:1,allowedInText:!0},handler(e,a){for(var{parser:o}=e,c=assertNodeType(a[0],"ordgroup"),d=c.body,$="",g=0;g<d.length;g++){var b=assertNodeType(d[g],"textord");$+=b.text}var _=parseInt($),j;if(isNaN(_))throw new ParseError("\\@char has non-numeric argument "+$);if(_<0||_>=1114111)throw new ParseError("\\@char with invalid code point "+$);return _<=65535?j=String.fromCharCode(_):(_-=65536,j=String.fromCharCode((_>>10)+55296,(_&1023)+56320)),{type:"textord",mode:o.mode,text:j}}});var htmlBuilder$8=(e,a)=>{var o=buildExpression$1(e.body,a.withColor(e.color),!1);return buildCommon.makeFragment(o)},mathmlBuilder$7=(e,a)=>{var o=buildExpression(e.body,a.withColor(e.color)),c=new mathMLTree.MathNode("mstyle",o);return c.setAttribute("mathcolor",e.color),c};defineFunction({type:"color",names:["\\textcolor"],props:{numArgs:2,allowedInText:!0,argTypes:["color","original"]},handler(e,a){var{parser:o}=e,c=assertNodeType(a[0],"color-token").color,d=a[1];return{type:"color",mode:o.mode,color:c,body:ordargument(d)}},htmlBuilder:htmlBuilder$8,mathmlBuilder:mathmlBuilder$7});defineFunction({type:"color",names:["\\color"],props:{numArgs:1,allowedInText:!0,argTypes:["color"]},handler(e,a){var{parser:o,breakOnTokenText:c}=e,d=assertNodeType(a[0],"color-token").color;o.gullet.macros.set("\\current@color",d);var $=o.parseExpression(!0,c);return{type:"color",mode:o.mode,color:d,body:$}},htmlBuilder:htmlBuilder$8,mathmlBuilder:mathmlBuilder$7});defineFunction({type:"cr",names:["\\\\"],props:{numArgs:0,numOptionalArgs:0,allowedInText:!0},handler(e,a,o){var{parser:c}=e,d=c.gullet.future().text==="["?c.parseSizeGroup(!0):null,$=!c.settings.displayMode||!c.settings.useStrictBehavior("newLineInDisplayMode","In LaTeX, \\\\ or \\newline does nothing in display mode");return{type:"cr",mode:c.mode,newLine:$,size:d&&assertNodeType(d,"size").value}},htmlBuilder(e,a){var o=buildCommon.makeSpan(["mspace"],[],a);return e.newLine&&(o.classes.push("newline"),e.size&&(o.style.marginTop=makeEm(calculateSize(e.size,a)))),o},mathmlBuilder(e,a){var o=new mathMLTree.MathNode("mspace");return e.newLine&&(o.setAttribute("linebreak","newline"),e.size&&o.setAttribute("height",makeEm(calculateSize(e.size,a)))),o}});var globalMap={"\\global":"\\global","\\long":"\\\\globallong","\\\\globallong":"\\\\globallong","\\def":"\\gdef","\\gdef":"\\gdef","\\edef":"\\xdef","\\xdef":"\\xdef","\\let":"\\\\globallet","\\futurelet":"\\\\globalfuture"},checkControlSequence=e=>{var a=e.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(a))throw new ParseError("Expected a control sequence",e);return a},getRHS=e=>{var a=e.gullet.popToken();return a.text==="="&&(a=e.gullet.popToken(),a.text===" "&&(a=e.gullet.popToken())),a},letCommand=(e,a,o,c)=>{var d=e.gullet.macros.get(o.text);d==null&&(o.noexpand=!0,d={tokens:[o],numArgs:0,unexpandable:!e.gullet.isExpandable(o.text)}),e.gullet.macros.set(a,d,c)};defineFunction({type:"internal",names:["\\global","\\long","\\\\globallong"],props:{numArgs:0,allowedInText:!0},handler(e){var{parser:a,funcName:o}=e;a.consumeSpaces();var c=a.fetch();if(globalMap[c.text])return(o==="\\global"||o==="\\\\globallong")&&(c.text=globalMap[c.text]),assertNodeType(a.parseFunction(),"internal");throw new ParseError("Invalid token after macro prefix",c)}});defineFunction({type:"internal",names:["\\def","\\gdef","\\edef","\\xdef"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e){var{parser:a,funcName:o}=e,c=a.gullet.popToken(),d=c.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(d))throw new ParseError("Expected a control sequence",c);for(var $=0,g,b=[[]];a.gullet.future().text!=="{";)if(c=a.gullet.popToken(),c.text==="#"){if(a.gullet.future().text==="{"){g=a.gullet.future(),b[$].push("{");break}if(c=a.gullet.popToken(),!/^[1-9]$/.test(c.text))throw new ParseError('Invalid argument number "'+c.text+'"');if(parseInt(c.text)!==$+1)throw new ParseError('Argument number "'+c.text+'" out of order');$++,b.push([])}else{if(c.text==="EOF")throw new ParseError("Expected a macro definition");b[$].push(c.text)}var{tokens:_}=a.gullet.consumeArg();return g&&_.unshift(g),(o==="\\edef"||o==="\\xdef")&&(_=a.gullet.expandTokens(_),_.reverse()),a.gullet.macros.set(d,{tokens:_,numArgs:$,delimiters:b},o===globalMap[o]),{type:"internal",mode:a.mode}}});defineFunction({type:"internal",names:["\\let","\\\\globallet"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e){var{parser:a,funcName:o}=e,c=checkControlSequence(a.gullet.popToken());a.gullet.consumeSpaces();var d=getRHS(a);return letCommand(a,c,d,o==="\\\\globallet"),{type:"internal",mode:a.mode}}});defineFunction({type:"internal",names:["\\futurelet","\\\\globalfuture"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e){var{parser:a,funcName:o}=e,c=checkControlSequence(a.gullet.popToken()),d=a.gullet.popToken(),$=a.gullet.popToken();return letCommand(a,c,$,o==="\\\\globalfuture"),a.gullet.pushToken($),a.gullet.pushToken(d),{type:"internal",mode:a.mode}}});var getMetrics=function e(a,o,c){var d=symbols.math[a]&&symbols.math[a].replace,$=getCharacterMetrics(d||a,o,c);if(!$)throw new Error("Unsupported symbol "+a+" and font size "+o+".");return $},styleWrap=function e(a,o,c,d){var $=c.havingBaseStyle(o),g=buildCommon.makeSpan(d.concat($.sizingClasses(c)),[a],c),b=$.sizeMultiplier/c.sizeMultiplier;return g.height*=b,g.depth*=b,g.maxFontSize=$.sizeMultiplier,g},centerSpan=function e(a,o,c){var d=o.havingBaseStyle(c),$=(1-o.sizeMultiplier/d.sizeMultiplier)*o.fontMetrics().axisHeight;a.classes.push("delimcenter"),a.style.top=makeEm($),a.height-=$,a.depth+=$},makeSmallDelim=function e(a,o,c,d,$,g){var b=buildCommon.makeSymbol(a,"Main-Regular",$,d),_=styleWrap(b,o,d,g);return c&&centerSpan(_,d,o),_},mathrmSize=function e(a,o,c,d){return buildCommon.makeSymbol(a,"Size"+o+"-Regular",c,d)},makeLargeDelim=function e(a,o,c,d,$,g){var b=mathrmSize(a,o,$,d),_=styleWrap(buildCommon.makeSpan(["delimsizing","size"+o],[b],d),Style$1.TEXT,d,g);return c&&centerSpan(_,d,Style$1.TEXT),_},makeGlyphSpan=function e(a,o,c){var d;o==="Size1-Regular"?d="delim-size1":d="delim-size4";var $=buildCommon.makeSpan(["delimsizinginner",d],[buildCommon.makeSpan([],[buildCommon.makeSymbol(a,o,c)])]);return{type:"elem",elem:$}},makeInner=function e(a,o,c){var d=fontMetricsData["Size4-Regular"][a.charCodeAt(0)]?fontMetricsData["Size4-Regular"][a.charCodeAt(0)][4]:fontMetricsData["Size1-Regular"][a.charCodeAt(0)][4],$=new PathNode("inner",innerPath(a,Math.round(1e3*o))),g=new SvgNode([$],{width:makeEm(d),height:makeEm(o),style:"width:"+makeEm(d),viewBox:"0 0 "+1e3*d+" "+Math.round(1e3*o),preserveAspectRatio:"xMinYMin"}),b=buildCommon.makeSvgSpan([],[g],c);return b.height=o,b.style.height=makeEm(o),b.style.width=makeEm(d),{type:"elem",elem:b}},lapInEms=.008,lap={type:"kern",size:-1*lapInEms},verts=["|","\\lvert","\\rvert","\\vert"],doubleVerts=["\\|","\\lVert","\\rVert","\\Vert"],makeStackedDelim=function e(a,o,c,d,$,g){var b,_,j,_e,et="",tt=0;b=j=_e=a,_=null;var nt="Size1-Regular";a==="\\uparrow"?j=_e="⏐":a==="\\Uparrow"?j=_e="‖":a==="\\downarrow"?b=j="⏐":a==="\\Downarrow"?b=j="‖":a==="\\updownarrow"?(b="\\uparrow",j="⏐",_e="\\downarrow"):a==="\\Updownarrow"?(b="\\Uparrow",j="‖",_e="\\Downarrow"):utils.contains(verts,a)?(j="∣",et="vert",tt=333):utils.contains(doubleVerts,a)?(j="∥",et="doublevert",tt=556):a==="["||a==="\\lbrack"?(b="⎡",j="⎢",_e="⎣",nt="Size4-Regular",et="lbrack",tt=667):a==="]"||a==="\\rbrack"?(b="⎤",j="⎥",_e="⎦",nt="Size4-Regular",et="rbrack",tt=667):a==="\\lfloor"||a==="⌊"?(j=b="⎢",_e="⎣",nt="Size4-Regular",et="lfloor",tt=667):a==="\\lceil"||a==="⌈"?(b="⎡",j=_e="⎢",nt="Size4-Regular",et="lceil",tt=667):a==="\\rfloor"||a==="⌋"?(j=b="⎥",_e="⎦",nt="Size4-Regular",et="rfloor",tt=667):a==="\\rceil"||a==="⌉"?(b="⎤",j=_e="⎥",nt="Size4-Regular",et="rceil",tt=667):a==="("||a==="\\lparen"?(b="⎛",j="⎜",_e="⎝",nt="Size4-Regular",et="lparen",tt=875):a===")"||a==="\\rparen"?(b="⎞",j="⎟",_e="⎠",nt="Size4-Regular",et="rparen",tt=875):a==="\\{"||a==="\\lbrace"?(b="⎧",_="⎨",_e="⎩",j="⎪",nt="Size4-Regular"):a==="\\}"||a==="\\rbrace"?(b="⎫",_="⎬",_e="⎭",j="⎪",nt="Size4-Regular"):a==="\\lgroup"||a==="⟮"?(b="⎧",_e="⎩",j="⎪",nt="Size4-Regular"):a==="\\rgroup"||a==="⟯"?(b="⎫",_e="⎭",j="⎪",nt="Size4-Regular"):a==="\\lmoustache"||a==="⎰"?(b="⎧",_e="⎭",j="⎪",nt="Size4-Regular"):(a==="\\rmoustache"||a==="⎱")&&(b="⎫",_e="⎩",j="⎪",nt="Size4-Regular");var at=getMetrics(b,nt,$),lt=at.height+at.depth,mt=getMetrics(j,nt,$),ot=mt.height+mt.depth,st=getMetrics(_e,nt,$),ut=st.height+st.depth,pt=0,gt=1;if(_!==null){var ft=getMetrics(_,nt,$);pt=ft.height+ft.depth,gt=2}var yt=lt+ut+pt,_t=Math.max(0,Math.ceil((o-yt)/(gt*ot))),vt=yt+_t*gt*ot,Pt=d.fontMetrics().axisHeight;c&&(Pt*=d.sizeMultiplier);var Tt=vt/2-Pt,St=[];if(et.length>0){var qt=vt-lt-ut,Ft=Math.round(vt*1e3),Dt=tallDelim(et,Math.round(qt*1e3)),zt=new PathNode(et,Dt),Nt=(tt/1e3).toFixed(3)+"em",Et=(Ft/1e3).toFixed(3)+"em",At=new SvgNode([zt],{width:Nt,height:Et,viewBox:"0 0 "+tt+" "+Ft}),dt=buildCommon.makeSvgSpan([],[At],d);dt.height=Ft/1e3,dt.style.width=Nt,dt.style.height=Et,St.push({type:"elem",elem:dt})}else{if(St.push(makeGlyphSpan(_e,nt,$)),St.push(lap),_===null){var Mt=vt-lt-ut+2*lapInEms;St.push(makeInner(j,Mt,d))}else{var It=(vt-lt-ut-pt)/2+2*lapInEms;St.push(makeInner(j,It,d)),St.push(lap),St.push(makeGlyphSpan(_,nt,$)),St.push(lap),St.push(makeInner(j,It,d))}St.push(lap),St.push(makeGlyphSpan(b,nt,$))}var $t=d.havingBaseStyle(Style$1.TEXT),Lt=buildCommon.makeVList({positionType:"bottom",positionData:Tt,children:St},$t);return styleWrap(buildCommon.makeSpan(["delimsizing","mult"],[Lt],$t),Style$1.TEXT,d,g)},vbPad=80,emPad=.08,sqrtSvg=function e(a,o,c,d,$){var g=sqrtPath(a,d,c),b=new PathNode(a,g),_=new SvgNode([b],{width:"400em",height:makeEm(o),viewBox:"0 0 400000 "+c,preserveAspectRatio:"xMinYMin slice"});return buildCommon.makeSvgSpan(["hide-tail"],[_],$)},makeSqrtImage=function e(a,o){var c=o.havingBaseSizing(),d=traverseSequence("\\surd",a*c.sizeMultiplier,stackLargeDelimiterSequence,c),$=c.sizeMultiplier,g=Math.max(0,o.minRuleThickness-o.fontMetrics().sqrtRuleThickness),b,_=0,j=0,_e=0,et;return d.type==="small"?(_e=1e3+1e3*g+vbPad,a<1?$=1:a<1.4&&($=.7),_=(1+g+emPad)/$,j=(1+g)/$,b=sqrtSvg("sqrtMain",_,_e,g,o),b.style.minWidth="0.853em",et=.833/$):d.type==="large"?(_e=(1e3+vbPad)*sizeToMaxHeight[d.size],j=(sizeToMaxHeight[d.size]+g)/$,_=(sizeToMaxHeight[d.size]+g+emPad)/$,b=sqrtSvg("sqrtSize"+d.size,_,_e,g,o),b.style.minWidth="1.02em",et=1/$):(_=a+g+emPad,j=a+g,_e=Math.floor(1e3*a+g)+vbPad,b=sqrtSvg("sqrtTall",_,_e,g,o),b.style.minWidth="0.742em",et=1.056),b.height=j,b.style.height=makeEm(_),{span:b,advanceWidth:et,ruleWidth:(o.fontMetrics().sqrtRuleThickness+g)*$}},stackLargeDelimiters=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","⌊","⌋","\\lceil","\\rceil","⌈","⌉","\\surd"],stackAlwaysDelimiters=["\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow","|","\\|","\\vert","\\Vert","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","⟮","⟯","\\lmoustache","\\rmoustache","⎰","⎱"],stackNeverDelimiters=["<",">","\\langle","\\rangle","/","\\backslash","\\lt","\\gt"],sizeToMaxHeight=[0,1.2,1.8,2.4,3],makeSizedDelim=function e(a,o,c,d,$){if(a==="<"||a==="\\lt"||a==="⟨"?a="\\langle":(a===">"||a==="\\gt"||a==="⟩")&&(a="\\rangle"),utils.contains(stackLargeDelimiters,a)||utils.contains(stackNeverDelimiters,a))return makeLargeDelim(a,o,!1,c,d,$);if(utils.contains(stackAlwaysDelimiters,a))return makeStackedDelim(a,sizeToMaxHeight[o],!1,c,d,$);throw new ParseError("Illegal delimiter: '"+a+"'")},stackNeverDelimiterSequence=[{type:"small",style:Style$1.SCRIPTSCRIPT},{type:"small",style:Style$1.SCRIPT},{type:"small",style:Style$1.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4}],stackAlwaysDelimiterSequence=[{type:"small",style:Style$1.SCRIPTSCRIPT},{type:"small",style:Style$1.SCRIPT},{type:"small",style:Style$1.TEXT},{type:"stack"}],stackLargeDelimiterSequence=[{type:"small",style:Style$1.SCRIPTSCRIPT},{type:"small",style:Style$1.SCRIPT},{type:"small",style:Style$1.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4},{type:"stack"}],delimTypeToFont=function e(a){if(a.type==="small")return"Main-Regular";if(a.type==="large")return"Size"+a.size+"-Regular";if(a.type==="stack")return"Size4-Regular";throw new Error("Add support for delim type '"+a.type+"' here.")},traverseSequence=function e(a,o,c,d){for(var $=Math.min(2,3-d.style.size),g=$;g<c.length&&c[g].type!=="stack";g++){var b=getMetrics(a,delimTypeToFont(c[g]),"math"),_=b.height+b.depth;if(c[g].type==="small"){var j=d.havingBaseStyle(c[g].style);_*=j.sizeMultiplier}if(_>o)return c[g]}return c[c.length-1]},makeCustomSizedDelim=function e(a,o,c,d,$,g){a==="<"||a==="\\lt"||a==="⟨"?a="\\langle":(a===">"||a==="\\gt"||a==="⟩")&&(a="\\rangle");var b;utils.contains(stackNeverDelimiters,a)?b=stackNeverDelimiterSequence:utils.contains(stackLargeDelimiters,a)?b=stackLargeDelimiterSequence:b=stackAlwaysDelimiterSequence;var _=traverseSequence(a,o,b,d);return _.type==="small"?makeSmallDelim(a,_.style,c,d,$,g):_.type==="large"?makeLargeDelim(a,_.size,c,d,$,g):makeStackedDelim(a,o,c,d,$,g)},makeLeftRightDelim=function e(a,o,c,d,$,g){var b=d.fontMetrics().axisHeight*d.sizeMultiplier,_=901,j=5/d.fontMetrics().ptPerEm,_e=Math.max(o-b,c+b),et=Math.max(_e/500*_,2*_e-j);return makeCustomSizedDelim(a,et,!0,d,$,g)},delimiter={sqrtImage:makeSqrtImage,sizedDelim:makeSizedDelim,sizeToMaxHeight,customSizedDelim:makeCustomSizedDelim,leftRightDelim:makeLeftRightDelim},delimiterSizes={"\\bigl":{mclass:"mopen",size:1},"\\Bigl":{mclass:"mopen",size:2},"\\biggl":{mclass:"mopen",size:3},"\\Biggl":{mclass:"mopen",size:4},"\\bigr":{mclass:"mclose",size:1},"\\Bigr":{mclass:"mclose",size:2},"\\biggr":{mclass:"mclose",size:3},"\\Biggr":{mclass:"mclose",size:4},"\\bigm":{mclass:"mrel",size:1},"\\Bigm":{mclass:"mrel",size:2},"\\biggm":{mclass:"mrel",size:3},"\\Biggm":{mclass:"mrel",size:4},"\\big":{mclass:"mord",size:1},"\\Big":{mclass:"mord",size:2},"\\bigg":{mclass:"mord",size:3},"\\Bigg":{mclass:"mord",size:4}},delimiters=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","⌊","⌋","\\lceil","\\rceil","⌈","⌉","<",">","\\langle","⟨","\\rangle","⟩","\\lt","\\gt","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","⟮","⟯","\\lmoustache","\\rmoustache","⎰","⎱","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."];function checkDelimiter(e,a){var o=checkSymbolNodeType(e);if(o&&utils.contains(delimiters,o.text))return o;throw o?new ParseError("Invalid delimiter '"+o.text+"' after '"+a.funcName+"'",e):new ParseError("Invalid delimiter type '"+e.type+"'",e)}defineFunction({type:"delimsizing",names:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg"],props:{numArgs:1,argTypes:["primitive"]},handler:(e,a)=>{var o=checkDelimiter(a[0],e);return{type:"delimsizing",mode:e.parser.mode,size:delimiterSizes[e.funcName].size,mclass:delimiterSizes[e.funcName].mclass,delim:o.text}},htmlBuilder:(e,a)=>e.delim==="."?buildCommon.makeSpan([e.mclass]):delimiter.sizedDelim(e.delim,e.size,a,e.mode,[e.mclass]),mathmlBuilder:e=>{var a=[];e.delim!=="."&&a.push(makeText(e.delim,e.mode));var o=new mathMLTree.MathNode("mo",a);e.mclass==="mopen"||e.mclass==="mclose"?o.setAttribute("fence","true"):o.setAttribute("fence","false"),o.setAttribute("stretchy","true");var c=makeEm(delimiter.sizeToMaxHeight[e.size]);return o.setAttribute("minsize",c),o.setAttribute("maxsize",c),o}});function assertParsed(e){if(!e.body)throw new Error("Bug: The leftright ParseNode wasn't fully parsed.")}defineFunction({type:"leftright-right",names:["\\right"],props:{numArgs:1,primitive:!0},handler:(e,a)=>{var o=e.parser.gullet.macros.get("\\current@color");if(o&&typeof o!="string")throw new ParseError("\\current@color set to non-string in \\right");return{type:"leftright-right",mode:e.parser.mode,delim:checkDelimiter(a[0],e).text,color:o}}});defineFunction({type:"leftright",names:["\\left"],props:{numArgs:1,primitive:!0},handler:(e,a)=>{var o=checkDelimiter(a[0],e),c=e.parser;++c.leftrightDepth;var d=c.parseExpression(!1);--c.leftrightDepth,c.expect("\\right",!1);var $=assertNodeType(c.parseFunction(),"leftright-right");return{type:"leftright",mode:c.mode,body:d,left:o.text,right:$.delim,rightColor:$.color}},htmlBuilder:(e,a)=>{assertParsed(e);for(var o=buildExpression$1(e.body,a,!0,["mopen","mclose"]),c=0,d=0,$=!1,g=0;g<o.length;g++)o[g].isMiddle?$=!0:(c=Math.max(o[g].height,c),d=Math.max(o[g].depth,d));c*=a.sizeMultiplier,d*=a.sizeMultiplier;var b;if(e.left==="."?b=makeNullDelimiter(a,["mopen"]):b=delimiter.leftRightDelim(e.left,c,d,a,e.mode,["mopen"]),o.unshift(b),$)for(var _=1;_<o.length;_++){var j=o[_],_e=j.isMiddle;_e&&(o[_]=delimiter.leftRightDelim(_e.delim,c,d,_e.options,e.mode,[]))}var et;if(e.right===".")et=makeNullDelimiter(a,["mclose"]);else{var tt=e.rightColor?a.withColor(e.rightColor):a;et=delimiter.leftRightDelim(e.right,c,d,tt,e.mode,["mclose"])}return o.push(et),buildCommon.makeSpan(["minner"],o,a)},mathmlBuilder:(e,a)=>{assertParsed(e);var o=buildExpression(e.body,a);if(e.left!=="."){var c=new mathMLTree.MathNode("mo",[makeText(e.left,e.mode)]);c.setAttribute("fence","true"),o.unshift(c)}if(e.right!=="."){var d=new mathMLTree.MathNode("mo",[makeText(e.right,e.mode)]);d.setAttribute("fence","true"),e.rightColor&&d.setAttribute("mathcolor",e.rightColor),o.push(d)}return makeRow(o)}});defineFunction({type:"middle",names:["\\middle"],props:{numArgs:1,primitive:!0},handler:(e,a)=>{var o=checkDelimiter(a[0],e);if(!e.parser.leftrightDepth)throw new ParseError("\\middle without preceding \\left",o);return{type:"middle",mode:e.parser.mode,delim:o.text}},htmlBuilder:(e,a)=>{var o;if(e.delim===".")o=makeNullDelimiter(a,[]);else{o=delimiter.sizedDelim(e.delim,1,a,e.mode,[]);var c={delim:e.delim,options:a};o.isMiddle=c}return o},mathmlBuilder:(e,a)=>{var o=e.delim==="\\vert"||e.delim==="|"?makeText("|","text"):makeText(e.delim,e.mode),c=new mathMLTree.MathNode("mo",[o]);return c.setAttribute("fence","true"),c.setAttribute("lspace","0.05em"),c.setAttribute("rspace","0.05em"),c}});var htmlBuilder$7=(e,a)=>{var o=buildCommon.wrapFragment(buildGroup$1(e.body,a),a),c=e.label.slice(1),d=a.sizeMultiplier,$,g=0,b=utils.isCharacterBox(e.body);if(c==="sout")$=buildCommon.makeSpan(["stretchy","sout"]),$.height=a.fontMetrics().defaultRuleThickness/d,g=-.5*a.fontMetrics().xHeight;else if(c==="phase"){var _=calculateSize({number:.6,unit:"pt"},a),j=calculateSize({number:.35,unit:"ex"},a),_e=a.havingBaseSizing();d=d/_e.sizeMultiplier;var et=o.height+o.depth+_+j;o.style.paddingLeft=makeEm(et/2+_);var tt=Math.floor(1e3*et*d),nt=phasePath(tt),at=new SvgNode([new PathNode("phase",nt)],{width:"400em",height:makeEm(tt/1e3),viewBox:"0 0 400000 "+tt,preserveAspectRatio:"xMinYMin slice"});$=buildCommon.makeSvgSpan(["hide-tail"],[at],a),$.style.height=makeEm(et),g=o.depth+_+j}else{/cancel/.test(c)?b||o.classes.push("cancel-pad"):c==="angl"?o.classes.push("anglpad"):o.classes.push("boxpad");var lt=0,mt=0,ot=0;/box/.test(c)?(ot=Math.max(a.fontMetrics().fboxrule,a.minRuleThickness),lt=a.fontMetrics().fboxsep+(c==="colorbox"?0:ot),mt=lt):c==="angl"?(ot=Math.max(a.fontMetrics().defaultRuleThickness,a.minRuleThickness),lt=4*ot,mt=Math.max(0,.25-o.depth)):(lt=b?.2:0,mt=lt),$=stretchy.encloseSpan(o,c,lt,mt,a),/fbox|boxed|fcolorbox/.test(c)?($.style.borderStyle="solid",$.style.borderWidth=makeEm(ot)):c==="angl"&&ot!==.049&&($.style.borderTopWidth=makeEm(ot),$.style.borderRightWidth=makeEm(ot)),g=o.depth+mt,e.backgroundColor&&($.style.backgroundColor=e.backgroundColor,e.borderColor&&($.style.borderColor=e.borderColor))}var st;if(e.backgroundColor)st=buildCommon.makeVList({positionType:"individualShift",children:[{type:"elem",elem:$,shift:g},{type:"elem",elem:o,shift:0}]},a);else{var ut=/cancel|phase/.test(c)?["svg-align"]:[];st=buildCommon.makeVList({positionType:"individualShift",children:[{type:"elem",elem:o,shift:0},{type:"elem",elem:$,shift:g,wrapperClasses:ut}]},a)}return/cancel/.test(c)&&(st.height=o.height,st.depth=o.depth),/cancel/.test(c)&&!b?buildCommon.makeSpan(["mord","cancel-lap"],[st],a):buildCommon.makeSpan(["mord"],[st],a)},mathmlBuilder$6=(e,a)=>{var o=0,c=new mathMLTree.MathNode(e.label.indexOf("colorbox")>-1?"mpadded":"menclose",[buildGroup(e.body,a)]);switch(e.label){case"\\cancel":c.setAttribute("notation","updiagonalstrike");break;case"\\bcancel":c.setAttribute("notation","downdiagonalstrike");break;case"\\phase":c.setAttribute("notation","phasorangle");break;case"\\sout":c.setAttribute("notation","horizontalstrike");break;case"\\fbox":c.setAttribute("notation","box");break;case"\\angl":c.setAttribute("notation","actuarial");break;case"\\fcolorbox":case"\\colorbox":if(o=a.fontMetrics().fboxsep*a.fontMetrics().ptPerEm,c.setAttribute("width","+"+2*o+"pt"),c.setAttribute("height","+"+2*o+"pt"),c.setAttribute("lspace",o+"pt"),c.setAttribute("voffset",o+"pt"),e.label==="\\fcolorbox"){var d=Math.max(a.fontMetrics().fboxrule,a.minRuleThickness);c.setAttribute("style","border: "+d+"em solid "+String(e.borderColor))}break;case"\\xcancel":c.setAttribute("notation","updiagonalstrike downdiagonalstrike");break}return e.backgroundColor&&c.setAttribute("mathbackground",e.backgroundColor),c};defineFunction({type:"enclose",names:["\\colorbox"],props:{numArgs:2,allowedInText:!0,argTypes:["color","text"]},handler(e,a,o){var{parser:c,funcName:d}=e,$=assertNodeType(a[0],"color-token").color,g=a[1];return{type:"enclose",mode:c.mode,label:d,backgroundColor:$,body:g}},htmlBuilder:htmlBuilder$7,mathmlBuilder:mathmlBuilder$6});defineFunction({type:"enclose",names:["\\fcolorbox"],props:{numArgs:3,allowedInText:!0,argTypes:["color","color","text"]},handler(e,a,o){var{parser:c,funcName:d}=e,$=assertNodeType(a[0],"color-token").color,g=assertNodeType(a[1],"color-token").color,b=a[2];return{type:"enclose",mode:c.mode,label:d,backgroundColor:g,borderColor:$,body:b}},htmlBuilder:htmlBuilder$7,mathmlBuilder:mathmlBuilder$6});defineFunction({type:"enclose",names:["\\fbox"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!0},handler(e,a){var{parser:o}=e;return{type:"enclose",mode:o.mode,label:"\\fbox",body:a[0]}}});defineFunction({type:"enclose",names:["\\cancel","\\bcancel","\\xcancel","\\sout","\\phase"],props:{numArgs:1},handler(e,a){var{parser:o,funcName:c}=e,d=a[0];return{type:"enclose",mode:o.mode,label:c,body:d}},htmlBuilder:htmlBuilder$7,mathmlBuilder:mathmlBuilder$6});defineFunction({type:"enclose",names:["\\angl"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!1},handler(e,a){var{parser:o}=e;return{type:"enclose",mode:o.mode,label:"\\angl",body:a[0]}}});var _environments={};function defineEnvironment(e){for(var{type:a,names:o,props:c,handler:d,htmlBuilder:$,mathmlBuilder:g}=e,b={type:a,numArgs:c.numArgs||0,allowedInText:!1,numOptionalArgs:0,handler:d},_=0;_<o.length;++_)_environments[o[_]]=b;$&&(_htmlGroupBuilders[a]=$),g&&(_mathmlGroupBuilders[a]=g)}var _macros={};function defineMacro(e,a){_macros[e]=a}function getHLines(e){var a=[];e.consumeSpaces();var o=e.fetch().text;for(o==="\\relax"&&(e.consume(),e.consumeSpaces(),o=e.fetch().text);o==="\\hline"||o==="\\hdashline";)e.consume(),a.push(o==="\\hdashline"),e.consumeSpaces(),o=e.fetch().text;return a}var validateAmsEnvironmentContext=e=>{var a=e.parser.settings;if(!a.displayMode)throw new ParseError("{"+e.envName+"} can be used only in display mode.")};function getAutoTag(e){if(e.indexOf("ed")===-1)return e.indexOf("*")===-1}function parseArray(e,a,o){var{hskipBeforeAndAfter:c,addJot:d,cols:$,arraystretch:g,colSeparationType:b,autoTag:_,singleRow:j,emptySingleRow:_e,maxNumCols:et,leqno:tt}=a;if(e.gullet.beginGroup(),j||e.gullet.macros.set("\\cr","\\\\\\relax"),!g){var nt=e.gullet.expandMacroAsText("\\arraystretch");if(nt==null)g=1;else if(g=parseFloat(nt),!g||g<0)throw new ParseError("Invalid \\arraystretch: "+nt)}e.gullet.beginGroup();var at=[],lt=[at],mt=[],ot=[],st=_!=null?[]:void 0;function ut(){_&&e.gullet.macros.set("\\@eqnsw","1",!0)}function pt(){st&&(e.gullet.macros.get("\\df@tag")?(st.push(e.subparse([new Token("\\df@tag")])),e.gullet.macros.set("\\df@tag",void 0,!0)):st.push(!!_&&e.gullet.macros.get("\\@eqnsw")==="1"))}for(ut(),ot.push(getHLines(e));;){var gt=e.parseExpression(!1,j?"\\end":"\\\\");e.gullet.endGroup(),e.gullet.beginGroup(),gt={type:"ordgroup",mode:e.mode,body:gt},o&&(gt={type:"styling",mode:e.mode,style:o,body:[gt]}),at.push(gt);var ft=e.fetch().text;if(ft==="&"){if(et&&at.length===et){if(j||b)throw new ParseError("Too many tab characters: &",e.nextToken);e.settings.reportNonstrict("textEnv","Too few columns specified in the {array} column argument.")}e.consume()}else if(ft==="\\end"){pt(),at.length===1&&gt.type==="styling"&&gt.body[0].body.length===0&&(lt.length>1||!_e)&&lt.pop(),ot.length<lt.length+1&&ot.push([]);break}else if(ft==="\\\\"){e.consume();var yt=void 0;e.gullet.future().text!==" "&&(yt=e.parseSizeGroup(!0)),mt.push(yt?yt.value:null),pt(),ot.push(getHLines(e)),at=[],lt.push(at),ut()}else throw new ParseError("Expected & or \\\\ or \\cr or \\end",e.nextToken)}return e.gullet.endGroup(),e.gullet.endGroup(),{type:"array",mode:e.mode,addJot:d,arraystretch:g,body:lt,cols:$,rowGaps:mt,hskipBeforeAndAfter:c,hLinesBeforeRow:ot,colSeparationType:b,tags:st,leqno:tt}}function dCellStyle(e){return e.slice(0,1)==="d"?"display":"text"}var htmlBuilder$6=function e(a,o){var c,d,$=a.body.length,g=a.hLinesBeforeRow,b=0,_=new Array($),j=[],_e=Math.max(o.fontMetrics().arrayRuleWidth,o.minRuleThickness),et=1/o.fontMetrics().ptPerEm,tt=5*et;if(a.colSeparationType&&a.colSeparationType==="small"){var nt=o.havingStyle(Style$1.SCRIPT).sizeMultiplier;tt=.2778*(nt/o.sizeMultiplier)}var at=a.colSeparationType==="CD"?calculateSize({number:3,unit:"ex"},o):12*et,lt=3*et,mt=a.arraystretch*at,ot=.7*mt,st=.3*mt,ut=0;function pt(an){for(var nn=0;nn<an.length;++nn)nn>0&&(ut+=.25),j.push({pos:ut,isDashed:an[nn]})}for(pt(g[0]),c=0;c<a.body.length;++c){var gt=a.body[c],ft=ot,yt=st;b<gt.length&&(b=gt.length);var _t=new Array(gt.length);for(d=0;d<gt.length;++d){var vt=buildGroup$1(gt[d],o);yt<vt.depth&&(yt=vt.depth),ft<vt.height&&(ft=vt.height),_t[d]=vt}var Pt=a.rowGaps[c],Tt=0;Pt&&(Tt=calculateSize(Pt,o),Tt>0&&(Tt+=st,yt<Tt&&(yt=Tt),Tt=0)),a.addJot&&(yt+=lt),_t.height=ft,_t.depth=yt,ut+=ft,_t.pos=ut,ut+=yt+Tt,_[c]=_t,pt(g[c+1])}var St=ut/2+o.fontMetrics().axisHeight,qt=a.cols||[],Ft=[],Dt,zt,Nt=[];if(a.tags&&a.tags.some(an=>an))for(c=0;c<$;++c){var Et=_[c],At=Et.pos-St,dt=a.tags[c],Mt=void 0;dt===!0?Mt=buildCommon.makeSpan(["eqn-num"],[],o):dt===!1?Mt=buildCommon.makeSpan([],[],o):Mt=buildCommon.makeSpan([],buildExpression$1(dt,o,!0),o),Mt.depth=Et.depth,Mt.height=Et.height,Nt.push({type:"elem",elem:Mt,shift:At})}for(d=0,zt=0;d<b||zt<qt.length;++d,++zt){for(var It=qt[zt]||{},$t=!0;It.type==="separator";){if($t||(Dt=buildCommon.makeSpan(["arraycolsep"],[]),Dt.style.width=makeEm(o.fontMetrics().doubleRuleSep),Ft.push(Dt)),It.separator==="|"||It.separator===":"){var Lt=It.separator==="|"?"solid":"dashed",Ot=buildCommon.makeSpan(["vertical-separator"],[],o);Ot.style.height=makeEm(ut),Ot.style.borderRightWidth=makeEm(_e),Ot.style.borderRightStyle=Lt,Ot.style.margin="0 "+makeEm(-_e/2);var Vt=ut-St;Vt&&(Ot.style.verticalAlign=makeEm(-Vt)),Ft.push(Ot)}else throw new ParseError("Invalid separator type: "+It.separator);zt++,It=qt[zt]||{},$t=!1}if(!(d>=b)){var Ht=void 0;(d>0||a.hskipBeforeAndAfter)&&(Ht=utils.deflt(It.pregap,tt),Ht!==0&&(Dt=buildCommon.makeSpan(["arraycolsep"],[]),Dt.style.width=makeEm(Ht),Ft.push(Dt)));var Yt=[];for(c=0;c<$;++c){var Kt=_[c],Qt=Kt[d];if(Qt){var Zt=Kt.pos-St;Qt.depth=Kt.depth,Qt.height=Kt.height,Yt.push({type:"elem",elem:Qt,shift:Zt})}}Yt=buildCommon.makeVList({positionType:"individualShift",children:Yt},o),Yt=buildCommon.makeSpan(["col-align-"+(It.align||"c")],[Yt]),Ft.push(Yt),(d<b-1||a.hskipBeforeAndAfter)&&(Ht=utils.deflt(It.postgap,tt),Ht!==0&&(Dt=buildCommon.makeSpan(["arraycolsep"],[]),Dt.style.width=makeEm(Ht),Ft.push(Dt)))}}if(_=buildCommon.makeSpan(["mtable"],Ft),j.length>0){for(var on=buildCommon.makeLineSpan("hline",o,_e),ln=buildCommon.makeLineSpan("hdashline",o,_e),sn=[{type:"elem",elem:_,shift:0}];j.length>0;){var rn=j.pop(),Jt=rn.pos-St;rn.isDashed?sn.push({type:"elem",elem:ln,shift:Jt}):sn.push({type:"elem",elem:on,shift:Jt})}_=buildCommon.makeVList({positionType:"individualShift",children:sn},o)}if(Nt.length===0)return buildCommon.makeSpan(["mord"],[_],o);var en=buildCommon.makeVList({positionType:"individualShift",children:Nt},o);return en=buildCommon.makeSpan(["tag"],[en],o),buildCommon.makeFragment([_,en])},alignMap={c:"center ",l:"left ",r:"right "},mathmlBuilder$5=function e(a,o){for(var c=[],d=new mathMLTree.MathNode("mtd",[],["mtr-glue"]),$=new mathMLTree.MathNode("mtd",[],["mml-eqn-num"]),g=0;g<a.body.length;g++){for(var b=a.body[g],_=[],j=0;j<b.length;j++)_.push(new mathMLTree.MathNode("mtd",[buildGroup(b[j],o)]));a.tags&&a.tags[g]&&(_.unshift(d),_.push(d),a.leqno?_.unshift($):_.push($)),c.push(new mathMLTree.MathNode("mtr",_))}var _e=new mathMLTree.MathNode("mtable",c),et=a.arraystretch===.5?.1:.16+a.arraystretch-1+(a.addJot?.09:0);_e.setAttribute("rowspacing",makeEm(et));var tt="",nt="";if(a.cols&&a.cols.length>0){var at=a.cols,lt="",mt=!1,ot=0,st=at.length;at[0].type==="separator"&&(tt+="top ",ot=1),at[at.length-1].type==="separator"&&(tt+="bottom ",st-=1);for(var ut=ot;ut<st;ut++)at[ut].type==="align"?(nt+=alignMap[at[ut].align],mt&&(lt+="none "),mt=!0):at[ut].type==="separator"&&mt&&(lt+=at[ut].separator==="|"?"solid ":"dashed ",mt=!1);_e.setAttribute("columnalign",nt.trim()),/[sd]/.test(lt)&&_e.setAttribute("columnlines",lt.trim())}if(a.colSeparationType==="align"){for(var pt=a.cols||[],gt="",ft=1;ft<pt.length;ft++)gt+=ft%2?"0em ":"1em ";_e.setAttribute("columnspacing",gt.trim())}else a.colSeparationType==="alignat"||a.colSeparationType==="gather"?_e.setAttribute("columnspacing","0em"):a.colSeparationType==="small"?_e.setAttribute("columnspacing","0.2778em"):a.colSeparationType==="CD"?_e.setAttribute("columnspacing","0.5em"):_e.setAttribute("columnspacing","1em");var yt="",_t=a.hLinesBeforeRow;tt+=_t[0].length>0?"left ":"",tt+=_t[_t.length-1].length>0?"right ":"";for(var vt=1;vt<_t.length-1;vt++)yt+=_t[vt].length===0?"none ":_t[vt][0]?"dashed ":"solid ";return/[sd]/.test(yt)&&_e.setAttribute("rowlines",yt.trim()),tt!==""&&(_e=new mathMLTree.MathNode("menclose",[_e]),_e.setAttribute("notation",tt.trim())),a.arraystretch&&a.arraystretch<1&&(_e=new mathMLTree.MathNode("mstyle",[_e]),_e.setAttribute("scriptlevel","1")),_e},alignedHandler=function e(a,o){a.envName.indexOf("ed")===-1&&validateAmsEnvironmentContext(a);var c=[],d=a.envName.indexOf("at")>-1?"alignat":"align",$=a.envName==="split",g=parseArray(a.parser,{cols:c,addJot:!0,autoTag:$?void 0:getAutoTag(a.envName),emptySingleRow:!0,colSeparationType:d,maxNumCols:$?2:void 0,leqno:a.parser.settings.leqno},"display"),b,_=0,j={type:"ordgroup",mode:a.mode,body:[]};if(o[0]&&o[0].type==="ordgroup"){for(var _e="",et=0;et<o[0].body.length;et++){var tt=assertNodeType(o[0].body[et],"textord");_e+=tt.text}b=Number(_e),_=b*2}var nt=!_;g.body.forEach(function(ot){for(var st=1;st<ot.length;st+=2){var ut=assertNodeType(ot[st],"styling"),pt=assertNodeType(ut.body[0],"ordgroup");pt.body.unshift(j)}if(nt)_<ot.length&&(_=ot.length);else{var gt=ot.length/2;if(b<gt)throw new ParseError("Too many math in a row: "+("expected "+b+", but got "+gt),ot[0])}});for(var at=0;at<_;++at){var lt="r",mt=0;at%2===1?lt="l":at>0&&nt&&(mt=1),c[at]={type:"align",align:lt,pregap:mt,postgap:0}}return g.colSeparationType=nt?"align":"alignat",g};defineEnvironment({type:"array",names:["array","darray"],props:{numArgs:1},handler(e,a){var o=checkSymbolNodeType(a[0]),c=o?[a[0]]:assertNodeType(a[0],"ordgroup").body,d=c.map(function(g){var b=assertSymbolNodeType(g),_=b.text;if("lcr".indexOf(_)!==-1)return{type:"align",align:_};if(_==="|")return{type:"separator",separator:"|"};if(_===":")return{type:"separator",separator:":"};throw new ParseError("Unknown column alignment: "+_,g)}),$={cols:d,hskipBeforeAndAfter:!0,maxNumCols:d.length};return parseArray(e.parser,$,dCellStyle(e.envName))},htmlBuilder:htmlBuilder$6,mathmlBuilder:mathmlBuilder$5});defineEnvironment({type:"array",names:["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix","matrix*","pmatrix*","bmatrix*","Bmatrix*","vmatrix*","Vmatrix*"],props:{numArgs:0},handler(e){var a={matrix:null,pmatrix:["(",")"],bmatrix:["[","]"],Bmatrix:["\\{","\\}"],vmatrix:["|","|"],Vmatrix:["\\Vert","\\Vert"]}[e.envName.replace("*","")],o="c",c={hskipBeforeAndAfter:!1,cols:[{type:"align",align:o}]};if(e.envName.charAt(e.envName.length-1)==="*"){var d=e.parser;if(d.consumeSpaces(),d.fetch().text==="["){if(d.consume(),d.consumeSpaces(),o=d.fetch().text,"lcr".indexOf(o)===-1)throw new ParseError("Expected l or c or r",d.nextToken);d.consume(),d.consumeSpaces(),d.expect("]"),d.consume(),c.cols=[{type:"align",align:o}]}}var $=parseArray(e.parser,c,dCellStyle(e.envName)),g=Math.max(0,...$.body.map(b=>b.length));return $.cols=new Array(g).fill({type:"align",align:o}),a?{type:"leftright",mode:e.mode,body:[$],left:a[0],right:a[1],rightColor:void 0}:$},htmlBuilder:htmlBuilder$6,mathmlBuilder:mathmlBuilder$5});defineEnvironment({type:"array",names:["smallmatrix"],props:{numArgs:0},handler(e){var a={arraystretch:.5},o=parseArray(e.parser,a,"script");return o.colSeparationType="small",o},htmlBuilder:htmlBuilder$6,mathmlBuilder:mathmlBuilder$5});defineEnvironment({type:"array",names:["subarray"],props:{numArgs:1},handler(e,a){var o=checkSymbolNodeType(a[0]),c=o?[a[0]]:assertNodeType(a[0],"ordgroup").body,d=c.map(function(g){var b=assertSymbolNodeType(g),_=b.text;if("lc".indexOf(_)!==-1)return{type:"align",align:_};throw new ParseError("Unknown column alignment: "+_,g)});if(d.length>1)throw new ParseError("{subarray} can contain only one column");var $={cols:d,hskipBeforeAndAfter:!1,arraystretch:.5};if($=parseArray(e.parser,$,"script"),$.body.length>0&&$.body[0].length>1)throw new ParseError("{subarray} can contain only one column");return $},htmlBuilder:htmlBuilder$6,mathmlBuilder:mathmlBuilder$5});defineEnvironment({type:"array",names:["cases","dcases","rcases","drcases"],props:{numArgs:0},handler(e){var a={arraystretch:1.2,cols:[{type:"align",align:"l",pregap:0,postgap:1},{type:"align",align:"l",pregap:0,postgap:0}]},o=parseArray(e.parser,a,dCellStyle(e.envName));return{type:"leftright",mode:e.mode,body:[o],left:e.envName.indexOf("r")>-1?".":"\\{",right:e.envName.indexOf("r")>-1?"\\}":".",rightColor:void 0}},htmlBuilder:htmlBuilder$6,mathmlBuilder:mathmlBuilder$5});defineEnvironment({type:"array",names:["align","align*","aligned","split"],props:{numArgs:0},handler:alignedHandler,htmlBuilder:htmlBuilder$6,mathmlBuilder:mathmlBuilder$5});defineEnvironment({type:"array",names:["gathered","gather","gather*"],props:{numArgs:0},handler(e){utils.contains(["gather","gather*"],e.envName)&&validateAmsEnvironmentContext(e);var a={cols:[{type:"align",align:"c"}],addJot:!0,colSeparationType:"gather",autoTag:getAutoTag(e.envName),emptySingleRow:!0,leqno:e.parser.settings.leqno};return parseArray(e.parser,a,"display")},htmlBuilder:htmlBuilder$6,mathmlBuilder:mathmlBuilder$5});defineEnvironment({type:"array",names:["alignat","alignat*","alignedat"],props:{numArgs:1},handler:alignedHandler,htmlBuilder:htmlBuilder$6,mathmlBuilder:mathmlBuilder$5});defineEnvironment({type:"array",names:["equation","equation*"],props:{numArgs:0},handler(e){validateAmsEnvironmentContext(e);var a={autoTag:getAutoTag(e.envName),emptySingleRow:!0,singleRow:!0,maxNumCols:1,leqno:e.parser.settings.leqno};return parseArray(e.parser,a,"display")},htmlBuilder:htmlBuilder$6,mathmlBuilder:mathmlBuilder$5});defineEnvironment({type:"array",names:["CD"],props:{numArgs:0},handler(e){return validateAmsEnvironmentContext(e),parseCD(e.parser)},htmlBuilder:htmlBuilder$6,mathmlBuilder:mathmlBuilder$5});defineMacro("\\nonumber","\\gdef\\@eqnsw{0}");defineMacro("\\notag","\\nonumber");defineFunction({type:"text",names:["\\hline","\\hdashline"],props:{numArgs:0,allowedInText:!0,allowedInMath:!0},handler(e,a){throw new ParseError(e.funcName+" valid only within array environment")}});var environments=_environments;defineFunction({type:"environment",names:["\\begin","\\end"],props:{numArgs:1,argTypes:["text"]},handler(e,a){var{parser:o,funcName:c}=e,d=a[0];if(d.type!=="ordgroup")throw new ParseError("Invalid environment name",d);for(var $="",g=0;g<d.body.length;++g)$+=assertNodeType(d.body[g],"textord").text;if(c==="\\begin"){if(!environments.hasOwnProperty($))throw new ParseError("No such environment: "+$,d);var b=environments[$],{args:_,optArgs:j}=o.parseArguments("\\begin{"+$+"}",b),_e={mode:o.mode,envName:$,parser:o},et=b.handler(_e,_,j);o.expect("\\end",!1);var tt=o.nextToken,nt=assertNodeType(o.parseFunction(),"environment");if(nt.name!==$)throw new ParseError("Mismatch: \\begin{"+$+"} matched by \\end{"+nt.name+"}",tt);return et}return{type:"environment",mode:o.mode,name:$,nameGroup:d}}});var htmlBuilder$5=(e,a)=>{var o=e.font,c=a.withFont(o);return buildGroup$1(e.body,c)},mathmlBuilder$4=(e,a)=>{var o=e.font,c=a.withFont(o);return buildGroup(e.body,c)},fontAliases={"\\Bbb":"\\mathbb","\\bold":"\\mathbf","\\frak":"\\mathfrak","\\bm":"\\boldsymbol"};defineFunction({type:"font",names:["\\mathrm","\\mathit","\\mathbf","\\mathnormal","\\mathsfit","\\mathbb","\\mathcal","\\mathfrak","\\mathscr","\\mathsf","\\mathtt","\\Bbb","\\bold","\\frak"],props:{numArgs:1,allowedInArgument:!0},handler:(e,a)=>{var{parser:o,funcName:c}=e,d=normalizeArgument(a[0]),$=c;return $ in fontAliases&&($=fontAliases[$]),{type:"font",mode:o.mode,font:$.slice(1),body:d}},htmlBuilder:htmlBuilder$5,mathmlBuilder:mathmlBuilder$4});defineFunction({type:"mclass",names:["\\boldsymbol","\\bm"],props:{numArgs:1},handler:(e,a)=>{var{parser:o}=e,c=a[0],d=utils.isCharacterBox(c);return{type:"mclass",mode:o.mode,mclass:binrelClass(c),body:[{type:"font",mode:o.mode,font:"boldsymbol",body:c}],isCharacterBox:d}}});defineFunction({type:"font",names:["\\rm","\\sf","\\tt","\\bf","\\it","\\cal"],props:{numArgs:0,allowedInText:!0},handler:(e,a)=>{var{parser:o,funcName:c,breakOnTokenText:d}=e,{mode:$}=o,g=o.parseExpression(!0,d),b="math"+c.slice(1);return{type:"font",mode:$,font:b,body:{type:"ordgroup",mode:o.mode,body:g}}},htmlBuilder:htmlBuilder$5,mathmlBuilder:mathmlBuilder$4});var adjustStyle=(e,a)=>{var o=a;return e==="display"?o=o.id>=Style$1.SCRIPT.id?o.text():Style$1.DISPLAY:e==="text"&&o.size===Style$1.DISPLAY.size?o=Style$1.TEXT:e==="script"?o=Style$1.SCRIPT:e==="scriptscript"&&(o=Style$1.SCRIPTSCRIPT),o},htmlBuilder$4=(e,a)=>{var o=adjustStyle(e.size,a.style),c=o.fracNum(),d=o.fracDen(),$;$=a.havingStyle(c);var g=buildGroup$1(e.numer,$,a);if(e.continued){var b=8.5/a.fontMetrics().ptPerEm,_=3.5/a.fontMetrics().ptPerEm;g.height=g.height<b?b:g.height,g.depth=g.depth<_?_:g.depth}$=a.havingStyle(d);var j=buildGroup$1(e.denom,$,a),_e,et,tt;e.hasBarLine?(e.barSize?(et=calculateSize(e.barSize,a),_e=buildCommon.makeLineSpan("frac-line",a,et)):_e=buildCommon.makeLineSpan("frac-line",a),et=_e.height,tt=_e.height):(_e=null,et=0,tt=a.fontMetrics().defaultRuleThickness);var nt,at,lt;o.size===Style$1.DISPLAY.size||e.size==="display"?(nt=a.fontMetrics().num1,et>0?at=3*tt:at=7*tt,lt=a.fontMetrics().denom1):(et>0?(nt=a.fontMetrics().num2,at=tt):(nt=a.fontMetrics().num3,at=3*tt),lt=a.fontMetrics().denom2);var mt;if(_e){var st=a.fontMetrics().axisHeight;nt-g.depth-(st+.5*et)<at&&(nt+=at-(nt-g.depth-(st+.5*et))),st-.5*et-(j.height-lt)<at&&(lt+=at-(st-.5*et-(j.height-lt)));var ut=-(st-.5*et);mt=buildCommon.makeVList({positionType:"individualShift",children:[{type:"elem",elem:j,shift:lt},{type:"elem",elem:_e,shift:ut},{type:"elem",elem:g,shift:-nt}]},a)}else{var ot=nt-g.depth-(j.height-lt);ot<at&&(nt+=.5*(at-ot),lt+=.5*(at-ot)),mt=buildCommon.makeVList({positionType:"individualShift",children:[{type:"elem",elem:j,shift:lt},{type:"elem",elem:g,shift:-nt}]},a)}$=a.havingStyle(o),mt.height*=$.sizeMultiplier/a.sizeMultiplier,mt.depth*=$.sizeMultiplier/a.sizeMultiplier;var pt;o.size===Style$1.DISPLAY.size?pt=a.fontMetrics().delim1:o.size===Style$1.SCRIPTSCRIPT.size?pt=a.havingStyle(Style$1.SCRIPT).fontMetrics().delim2:pt=a.fontMetrics().delim2;var gt,ft;return e.leftDelim==null?gt=makeNullDelimiter(a,["mopen"]):gt=delimiter.customSizedDelim(e.leftDelim,pt,!0,a.havingStyle(o),e.mode,["mopen"]),e.continued?ft=buildCommon.makeSpan([]):e.rightDelim==null?ft=makeNullDelimiter(a,["mclose"]):ft=delimiter.customSizedDelim(e.rightDelim,pt,!0,a.havingStyle(o),e.mode,["mclose"]),buildCommon.makeSpan(["mord"].concat($.sizingClasses(a)),[gt,buildCommon.makeSpan(["mfrac"],[mt]),ft],a)},mathmlBuilder$3=(e,a)=>{var o=new mathMLTree.MathNode("mfrac",[buildGroup(e.numer,a),buildGroup(e.denom,a)]);if(!e.hasBarLine)o.setAttribute("linethickness","0px");else if(e.barSize){var c=calculateSize(e.barSize,a);o.setAttribute("linethickness",makeEm(c))}var d=adjustStyle(e.size,a.style);if(d.size!==a.style.size){o=new mathMLTree.MathNode("mstyle",[o]);var $=d.size===Style$1.DISPLAY.size?"true":"false";o.setAttribute("displaystyle",$),o.setAttribute("scriptlevel","0")}if(e.leftDelim!=null||e.rightDelim!=null){var g=[];if(e.leftDelim!=null){var b=new mathMLTree.MathNode("mo",[new mathMLTree.TextNode(e.leftDelim.replace("\\",""))]);b.setAttribute("fence","true"),g.push(b)}if(g.push(o),e.rightDelim!=null){var _=new mathMLTree.MathNode("mo",[new mathMLTree.TextNode(e.rightDelim.replace("\\",""))]);_.setAttribute("fence","true"),g.push(_)}return makeRow(g)}return o};defineFunction({type:"genfrac",names:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom","\\\\atopfrac","\\\\bracefrac","\\\\brackfrac"],props:{numArgs:2,allowedInArgument:!0},handler:(e,a)=>{var{parser:o,funcName:c}=e,d=a[0],$=a[1],g,b=null,_=null,j="auto";switch(c){case"\\dfrac":case"\\frac":case"\\tfrac":g=!0;break;case"\\\\atopfrac":g=!1;break;case"\\dbinom":case"\\binom":case"\\tbinom":g=!1,b="(",_=")";break;case"\\\\bracefrac":g=!1,b="\\{",_="\\}";break;case"\\\\brackfrac":g=!1,b="[",_="]";break;default:throw new Error("Unrecognized genfrac command")}switch(c){case"\\dfrac":case"\\dbinom":j="display";break;case"\\tfrac":case"\\tbinom":j="text";break}return{type:"genfrac",mode:o.mode,continued:!1,numer:d,denom:$,hasBarLine:g,leftDelim:b,rightDelim:_,size:j,barSize:null}},htmlBuilder:htmlBuilder$4,mathmlBuilder:mathmlBuilder$3});defineFunction({type:"genfrac",names:["\\cfrac"],props:{numArgs:2},handler:(e,a)=>{var{parser:o,funcName:c}=e,d=a[0],$=a[1];return{type:"genfrac",mode:o.mode,continued:!0,numer:d,denom:$,hasBarLine:!0,leftDelim:null,rightDelim:null,size:"display",barSize:null}}});defineFunction({type:"infix",names:["\\over","\\choose","\\atop","\\brace","\\brack"],props:{numArgs:0,infix:!0},handler(e){var{parser:a,funcName:o,token:c}=e,d;switch(o){case"\\over":d="\\frac";break;case"\\choose":d="\\binom";break;case"\\atop":d="\\\\atopfrac";break;case"\\brace":d="\\\\bracefrac";break;case"\\brack":d="\\\\brackfrac";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",mode:a.mode,replaceWith:d,token:c}}});var stylArray=["display","text","script","scriptscript"],delimFromValue=function e(a){var o=null;return a.length>0&&(o=a,o=o==="."?null:o),o};defineFunction({type:"genfrac",names:["\\genfrac"],props:{numArgs:6,allowedInArgument:!0,argTypes:["math","math","size","text","math","math"]},handler(e,a){var{parser:o}=e,c=a[4],d=a[5],$=normalizeArgument(a[0]),g=$.type==="atom"&&$.family==="open"?delimFromValue($.text):null,b=normalizeArgument(a[1]),_=b.type==="atom"&&b.family==="close"?delimFromValue(b.text):null,j=assertNodeType(a[2],"size"),_e,et=null;j.isBlank?_e=!0:(et=j.value,_e=et.number>0);var tt="auto",nt=a[3];if(nt.type==="ordgroup"){if(nt.body.length>0){var at=assertNodeType(nt.body[0],"textord");tt=stylArray[Number(at.text)]}}else nt=assertNodeType(nt,"textord"),tt=stylArray[Number(nt.text)];return{type:"genfrac",mode:o.mode,numer:c,denom:d,continued:!1,hasBarLine:_e,barSize:et,leftDelim:g,rightDelim:_,size:tt}},htmlBuilder:htmlBuilder$4,mathmlBuilder:mathmlBuilder$3});defineFunction({type:"infix",names:["\\above"],props:{numArgs:1,argTypes:["size"],infix:!0},handler(e,a){var{parser:o,funcName:c,token:d}=e;return{type:"infix",mode:o.mode,replaceWith:"\\\\abovefrac",size:assertNodeType(a[0],"size").value,token:d}}});defineFunction({type:"genfrac",names:["\\\\abovefrac"],props:{numArgs:3,argTypes:["math","size","math"]},handler:(e,a)=>{var{parser:o,funcName:c}=e,d=a[0],$=assert(assertNodeType(a[1],"infix").size),g=a[2],b=$.number>0;return{type:"genfrac",mode:o.mode,numer:d,denom:g,continued:!1,hasBarLine:b,barSize:$,leftDelim:null,rightDelim:null,size:"auto"}},htmlBuilder:htmlBuilder$4,mathmlBuilder:mathmlBuilder$3});var htmlBuilder$3=(e,a)=>{var o=a.style,c,d;e.type==="supsub"?(c=e.sup?buildGroup$1(e.sup,a.havingStyle(o.sup()),a):buildGroup$1(e.sub,a.havingStyle(o.sub()),a),d=assertNodeType(e.base,"horizBrace")):d=assertNodeType(e,"horizBrace");var $=buildGroup$1(d.base,a.havingBaseStyle(Style$1.DISPLAY)),g=stretchy.svgSpan(d,a),b;if(d.isOver?(b=buildCommon.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:$},{type:"kern",size:.1},{type:"elem",elem:g}]},a),b.children[0].children[0].children[1].classes.push("svg-align")):(b=buildCommon.makeVList({positionType:"bottom",positionData:$.depth+.1+g.height,children:[{type:"elem",elem:g},{type:"kern",size:.1},{type:"elem",elem:$}]},a),b.children[0].children[0].children[0].classes.push("svg-align")),c){var _=buildCommon.makeSpan(["mord",d.isOver?"mover":"munder"],[b],a);d.isOver?b=buildCommon.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:_},{type:"kern",size:.2},{type:"elem",elem:c}]},a):b=buildCommon.makeVList({positionType:"bottom",positionData:_.depth+.2+c.height+c.depth,children:[{type:"elem",elem:c},{type:"kern",size:.2},{type:"elem",elem:_}]},a)}return buildCommon.makeSpan(["mord",d.isOver?"mover":"munder"],[b],a)},mathmlBuilder$2=(e,a)=>{var o=stretchy.mathMLnode(e.label);return new mathMLTree.MathNode(e.isOver?"mover":"munder",[buildGroup(e.base,a),o])};defineFunction({type:"horizBrace",names:["\\overbrace","\\underbrace"],props:{numArgs:1},handler(e,a){var{parser:o,funcName:c}=e;return{type:"horizBrace",mode:o.mode,label:c,isOver:/^\\over/.test(c),base:a[0]}},htmlBuilder:htmlBuilder$3,mathmlBuilder:mathmlBuilder$2});defineFunction({type:"href",names:["\\href"],props:{numArgs:2,argTypes:["url","original"],allowedInText:!0},handler:(e,a)=>{var{parser:o}=e,c=a[1],d=assertNodeType(a[0],"url").url;return o.settings.isTrusted({command:"\\href",url:d})?{type:"href",mode:o.mode,href:d,body:ordargument(c)}:o.formatUnsupportedCmd("\\href")},htmlBuilder:(e,a)=>{var o=buildExpression$1(e.body,a,!1);return buildCommon.makeAnchor(e.href,[],o,a)},mathmlBuilder:(e,a)=>{var o=buildExpressionRow(e.body,a);return o instanceof MathNode||(o=new MathNode("mrow",[o])),o.setAttribute("href",e.href),o}});defineFunction({type:"href",names:["\\url"],props:{numArgs:1,argTypes:["url"],allowedInText:!0},handler:(e,a)=>{var{parser:o}=e,c=assertNodeType(a[0],"url").url;if(!o.settings.isTrusted({command:"\\url",url:c}))return o.formatUnsupportedCmd("\\url");for(var d=[],$=0;$<c.length;$++){var g=c[$];g==="~"&&(g="\\textasciitilde"),d.push({type:"textord",mode:"text",text:g})}var b={type:"text",mode:o.mode,font:"\\texttt",body:d};return{type:"href",mode:o.mode,href:c,body:ordargument(b)}}});defineFunction({type:"hbox",names:["\\hbox"],props:{numArgs:1,argTypes:["text"],allowedInText:!0,primitive:!0},handler(e,a){var{parser:o}=e;return{type:"hbox",mode:o.mode,body:ordargument(a[0])}},htmlBuilder(e,a){var o=buildExpression$1(e.body,a,!1);return buildCommon.makeFragment(o)},mathmlBuilder(e,a){return new mathMLTree.MathNode("mrow",buildExpression(e.body,a))}});defineFunction({type:"html",names:["\\htmlClass","\\htmlId","\\htmlStyle","\\htmlData"],props:{numArgs:2,argTypes:["raw","original"],allowedInText:!0},handler:(e,a)=>{var{parser:o,funcName:c,token:d}=e,$=assertNodeType(a[0],"raw").string,g=a[1];o.settings.strict&&o.settings.reportNonstrict("htmlExtension","HTML extension is disabled on strict mode");var b,_={};switch(c){case"\\htmlClass":_.class=$,b={command:"\\htmlClass",class:$};break;case"\\htmlId":_.id=$,b={command:"\\htmlId",id:$};break;case"\\htmlStyle":_.style=$,b={command:"\\htmlStyle",style:$};break;case"\\htmlData":{for(var j=$.split(","),_e=0;_e<j.length;_e++){var et=j[_e].split("=");if(et.length!==2)throw new ParseError("Error parsing key-value for \\htmlData");_["data-"+et[0].trim()]=et[1].trim()}b={command:"\\htmlData",attributes:_};break}default:throw new Error("Unrecognized html command")}return o.settings.isTrusted(b)?{type:"html",mode:o.mode,attributes:_,body:ordargument(g)}:o.formatUnsupportedCmd(c)},htmlBuilder:(e,a)=>{var o=buildExpression$1(e.body,a,!1),c=["enclosing"];e.attributes.class&&c.push(...e.attributes.class.trim().split(/\s+/));var d=buildCommon.makeSpan(c,o,a);for(var $ in e.attributes)$!=="class"&&e.attributes.hasOwnProperty($)&&d.setAttribute($,e.attributes[$]);return d},mathmlBuilder:(e,a)=>buildExpressionRow(e.body,a)});defineFunction({type:"htmlmathml",names:["\\html@mathml"],props:{numArgs:2,allowedInText:!0},handler:(e,a)=>{var{parser:o}=e;return{type:"htmlmathml",mode:o.mode,html:ordargument(a[0]),mathml:ordargument(a[1])}},htmlBuilder:(e,a)=>{var o=buildExpression$1(e.html,a,!1);return buildCommon.makeFragment(o)},mathmlBuilder:(e,a)=>buildExpressionRow(e.mathml,a)});var sizeData=function e(a){if(/^[-+]? *(\d+(\.\d*)?|\.\d+)$/.test(a))return{number:+a,unit:"bp"};var o=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(a);if(!o)throw new ParseError("Invalid size: '"+a+"' in \\includegraphics");var c={number:+(o[1]+o[2]),unit:o[3]};if(!validUnit(c))throw new ParseError("Invalid unit: '"+c.unit+"' in \\includegraphics.");return c};defineFunction({type:"includegraphics",names:["\\includegraphics"],props:{numArgs:1,numOptionalArgs:1,argTypes:["raw","url"],allowedInText:!1},handler:(e,a,o)=>{var{parser:c}=e,d={number:0,unit:"em"},$={number:.9,unit:"em"},g={number:0,unit:"em"},b="";if(o[0])for(var _=assertNodeType(o[0],"raw").string,j=_.split(","),_e=0;_e<j.length;_e++){var et=j[_e].split("=");if(et.length===2){var tt=et[1].trim();switch(et[0].trim()){case"alt":b=tt;break;case"width":d=sizeData(tt);break;case"height":$=sizeData(tt);break;case"totalheight":g=sizeData(tt);break;default:throw new ParseError("Invalid key: '"+et[0]+"' in \\includegraphics.")}}}var nt=assertNodeType(a[0],"url").url;return b===""&&(b=nt,b=b.replace(/^.*[\\/]/,""),b=b.substring(0,b.lastIndexOf("."))),c.settings.isTrusted({command:"\\includegraphics",url:nt})?{type:"includegraphics",mode:c.mode,alt:b,width:d,height:$,totalheight:g,src:nt}:c.formatUnsupportedCmd("\\includegraphics")},htmlBuilder:(e,a)=>{var o=calculateSize(e.height,a),c=0;e.totalheight.number>0&&(c=calculateSize(e.totalheight,a)-o);var d=0;e.width.number>0&&(d=calculateSize(e.width,a));var $={height:makeEm(o+c)};d>0&&($.width=makeEm(d)),c>0&&($.verticalAlign=makeEm(-c));var g=new Img(e.src,e.alt,$);return g.height=o,g.depth=c,g},mathmlBuilder:(e,a)=>{var o=new mathMLTree.MathNode("mglyph",[]);o.setAttribute("alt",e.alt);var c=calculateSize(e.height,a),d=0;if(e.totalheight.number>0&&(d=calculateSize(e.totalheight,a)-c,o.setAttribute("valign",makeEm(-d))),o.setAttribute("height",makeEm(c+d)),e.width.number>0){var $=calculateSize(e.width,a);o.setAttribute("width",makeEm($))}return o.setAttribute("src",e.src),o}});defineFunction({type:"kern",names:["\\kern","\\mkern","\\hskip","\\mskip"],props:{numArgs:1,argTypes:["size"],primitive:!0,allowedInText:!0},handler(e,a){var{parser:o,funcName:c}=e,d=assertNodeType(a[0],"size");if(o.settings.strict){var $=c[1]==="m",g=d.value.unit==="mu";$?(g||o.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+c+" supports only mu units, "+("not "+d.value.unit+" units")),o.mode!=="math"&&o.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+c+" works only in math mode")):g&&o.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+c+" doesn't support mu units")}return{type:"kern",mode:o.mode,dimension:d.value}},htmlBuilder(e,a){return buildCommon.makeGlue(e.dimension,a)},mathmlBuilder(e,a){var o=calculateSize(e.dimension,a);return new mathMLTree.SpaceNode(o)}});defineFunction({type:"lap",names:["\\mathllap","\\mathrlap","\\mathclap"],props:{numArgs:1,allowedInText:!0},handler:(e,a)=>{var{parser:o,funcName:c}=e,d=a[0];return{type:"lap",mode:o.mode,alignment:c.slice(5),body:d}},htmlBuilder:(e,a)=>{var o;e.alignment==="clap"?(o=buildCommon.makeSpan([],[buildGroup$1(e.body,a)]),o=buildCommon.makeSpan(["inner"],[o],a)):o=buildCommon.makeSpan(["inner"],[buildGroup$1(e.body,a)]);var c=buildCommon.makeSpan(["fix"],[]),d=buildCommon.makeSpan([e.alignment],[o,c],a),$=buildCommon.makeSpan(["strut"]);return $.style.height=makeEm(d.height+d.depth),d.depth&&($.style.verticalAlign=makeEm(-d.depth)),d.children.unshift($),d=buildCommon.makeSpan(["thinbox"],[d],a),buildCommon.makeSpan(["mord","vbox"],[d],a)},mathmlBuilder:(e,a)=>{var o=new mathMLTree.MathNode("mpadded",[buildGroup(e.body,a)]);if(e.alignment!=="rlap"){var c=e.alignment==="llap"?"-1":"-0.5";o.setAttribute("lspace",c+"width")}return o.setAttribute("width","0px"),o}});defineFunction({type:"styling",names:["\\(","$"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(e,a){var{funcName:o,parser:c}=e,d=c.mode;c.switchMode("math");var $=o==="\\("?"\\)":"$",g=c.parseExpression(!1,$);return c.expect($),c.switchMode(d),{type:"styling",mode:c.mode,style:"text",body:g}}});defineFunction({type:"text",names:["\\)","\\]"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(e,a){throw new ParseError("Mismatched "+e.funcName)}});var chooseMathStyle=(e,a)=>{switch(a.style.size){case Style$1.DISPLAY.size:return e.display;case Style$1.TEXT.size:return e.text;case Style$1.SCRIPT.size:return e.script;case Style$1.SCRIPTSCRIPT.size:return e.scriptscript;default:return e.text}};defineFunction({type:"mathchoice",names:["\\mathchoice"],props:{numArgs:4,primitive:!0},handler:(e,a)=>{var{parser:o}=e;return{type:"mathchoice",mode:o.mode,display:ordargument(a[0]),text:ordargument(a[1]),script:ordargument(a[2]),scriptscript:ordargument(a[3])}},htmlBuilder:(e,a)=>{var o=chooseMathStyle(e,a),c=buildExpression$1(o,a,!1);return buildCommon.makeFragment(c)},mathmlBuilder:(e,a)=>{var o=chooseMathStyle(e,a);return buildExpressionRow(o,a)}});var assembleSupSub=(e,a,o,c,d,$,g)=>{e=buildCommon.makeSpan([],[e]);var b=o&&utils.isCharacterBox(o),_,j;if(a){var _e=buildGroup$1(a,c.havingStyle(d.sup()),c);j={elem:_e,kern:Math.max(c.fontMetrics().bigOpSpacing1,c.fontMetrics().bigOpSpacing3-_e.depth)}}if(o){var et=buildGroup$1(o,c.havingStyle(d.sub()),c);_={elem:et,kern:Math.max(c.fontMetrics().bigOpSpacing2,c.fontMetrics().bigOpSpacing4-et.height)}}var tt;if(j&&_){var nt=c.fontMetrics().bigOpSpacing5+_.elem.height+_.elem.depth+_.kern+e.depth+g;tt=buildCommon.makeVList({positionType:"bottom",positionData:nt,children:[{type:"kern",size:c.fontMetrics().bigOpSpacing5},{type:"elem",elem:_.elem,marginLeft:makeEm(-$)},{type:"kern",size:_.kern},{type:"elem",elem:e},{type:"kern",size:j.kern},{type:"elem",elem:j.elem,marginLeft:makeEm($)},{type:"kern",size:c.fontMetrics().bigOpSpacing5}]},c)}else if(_){var at=e.height-g;tt=buildCommon.makeVList({positionType:"top",positionData:at,children:[{type:"kern",size:c.fontMetrics().bigOpSpacing5},{type:"elem",elem:_.elem,marginLeft:makeEm(-$)},{type:"kern",size:_.kern},{type:"elem",elem:e}]},c)}else if(j){var lt=e.depth+g;tt=buildCommon.makeVList({positionType:"bottom",positionData:lt,children:[{type:"elem",elem:e},{type:"kern",size:j.kern},{type:"elem",elem:j.elem,marginLeft:makeEm($)},{type:"kern",size:c.fontMetrics().bigOpSpacing5}]},c)}else return e;var mt=[tt];if(_&&$!==0&&!b){var ot=buildCommon.makeSpan(["mspace"],[],c);ot.style.marginRight=makeEm($),mt.unshift(ot)}return buildCommon.makeSpan(["mop","op-limits"],mt,c)},noSuccessor=["\\smallint"],htmlBuilder$2=(e,a)=>{var o,c,d=!1,$;e.type==="supsub"?(o=e.sup,c=e.sub,$=assertNodeType(e.base,"op"),d=!0):$=assertNodeType(e,"op");var g=a.style,b=!1;g.size===Style$1.DISPLAY.size&&$.symbol&&!utils.contains(noSuccessor,$.name)&&(b=!0);var _;if($.symbol){var j=b?"Size2-Regular":"Size1-Regular",_e="";if(($.name==="\\oiint"||$.name==="\\oiiint")&&(_e=$.name.slice(1),$.name=_e==="oiint"?"\\iint":"\\iiint"),_=buildCommon.makeSymbol($.name,j,"math",a,["mop","op-symbol",b?"large-op":"small-op"]),_e.length>0){var et=_.italic,tt=buildCommon.staticSvg(_e+"Size"+(b?"2":"1"),a);_=buildCommon.makeVList({positionType:"individualShift",children:[{type:"elem",elem:_,shift:0},{type:"elem",elem:tt,shift:b?.08:0}]},a),$.name="\\"+_e,_.classes.unshift("mop"),_.italic=et}}else if($.body){var nt=buildExpression$1($.body,a,!0);nt.length===1&&nt[0]instanceof SymbolNode?(_=nt[0],_.classes[0]="mop"):_=buildCommon.makeSpan(["mop"],nt,a)}else{for(var at=[],lt=1;lt<$.name.length;lt++)at.push(buildCommon.mathsym($.name[lt],$.mode,a));_=buildCommon.makeSpan(["mop"],at,a)}var mt=0,ot=0;return(_ instanceof SymbolNode||$.name==="\\oiint"||$.name==="\\oiiint")&&!$.suppressBaseShift&&(mt=(_.height-_.depth)/2-a.fontMetrics().axisHeight,ot=_.italic),d?assembleSupSub(_,o,c,a,g,ot,mt):(mt&&(_.style.position="relative",_.style.top=makeEm(mt)),_)},mathmlBuilder$1=(e,a)=>{var o;if(e.symbol)o=new MathNode("mo",[makeText(e.name,e.mode)]),utils.contains(noSuccessor,e.name)&&o.setAttribute("largeop","false");else if(e.body)o=new MathNode("mo",buildExpression(e.body,a));else{o=new MathNode("mi",[new TextNode(e.name.slice(1))]);var c=new MathNode("mo",[makeText("⁡","text")]);e.parentIsSupSub?o=new MathNode("mrow",[o,c]):o=newDocumentFragment([o,c])}return o},singleCharBigOps={"∏":"\\prod","∐":"\\coprod","∑":"\\sum","⋀":"\\bigwedge","⋁":"\\bigvee","⋂":"\\bigcap","⋃":"\\bigcup","⨀":"\\bigodot","⨁":"\\bigoplus","⨂":"\\bigotimes","⨄":"\\biguplus","⨆":"\\bigsqcup"};defineFunction({type:"op",names:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcup","\\smallint","∏","∐","∑","⋀","⋁","⋂","⋃","⨀","⨁","⨂","⨄","⨆"],props:{numArgs:0},handler:(e,a)=>{var{parser:o,funcName:c}=e,d=c;return d.length===1&&(d=singleCharBigOps[d]),{type:"op",mode:o.mode,limits:!0,parentIsSupSub:!1,symbol:!0,name:d}},htmlBuilder:htmlBuilder$2,mathmlBuilder:mathmlBuilder$1});defineFunction({type:"op",names:["\\mathop"],props:{numArgs:1,primitive:!0},handler:(e,a)=>{var{parser:o}=e,c=a[0];return{type:"op",mode:o.mode,limits:!1,parentIsSupSub:!1,symbol:!1,body:ordargument(c)}},htmlBuilder:htmlBuilder$2,mathmlBuilder:mathmlBuilder$1});var singleCharIntegrals={"∫":"\\int","∬":"\\iint","∭":"\\iiint","∮":"\\oint","∯":"\\oiint","∰":"\\oiiint"};defineFunction({type:"op",names:["\\arcsin","\\arccos","\\arctan","\\arctg","\\arcctg","\\arg","\\ch","\\cos","\\cosec","\\cosh","\\cot","\\cotg","\\coth","\\csc","\\ctg","\\cth","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\sh","\\tan","\\tanh","\\tg","\\th"],props:{numArgs:0},handler(e){var{parser:a,funcName:o}=e;return{type:"op",mode:a.mode,limits:!1,parentIsSupSub:!1,symbol:!1,name:o}},htmlBuilder:htmlBuilder$2,mathmlBuilder:mathmlBuilder$1});defineFunction({type:"op",names:["\\det","\\gcd","\\inf","\\lim","\\max","\\min","\\Pr","\\sup"],props:{numArgs:0},handler(e){var{parser:a,funcName:o}=e;return{type:"op",mode:a.mode,limits:!0,parentIsSupSub:!1,symbol:!1,name:o}},htmlBuilder:htmlBuilder$2,mathmlBuilder:mathmlBuilder$1});defineFunction({type:"op",names:["\\int","\\iint","\\iiint","\\oint","\\oiint","\\oiiint","∫","∬","∭","∮","∯","∰"],props:{numArgs:0},handler(e){var{parser:a,funcName:o}=e,c=o;return c.length===1&&(c=singleCharIntegrals[c]),{type:"op",mode:a.mode,limits:!1,parentIsSupSub:!1,symbol:!0,name:c}},htmlBuilder:htmlBuilder$2,mathmlBuilder:mathmlBuilder$1});var htmlBuilder$1=(e,a)=>{var o,c,d=!1,$;e.type==="supsub"?(o=e.sup,c=e.sub,$=assertNodeType(e.base,"operatorname"),d=!0):$=assertNodeType(e,"operatorname");var g;if($.body.length>0){for(var b=$.body.map(et=>{var tt=et.text;return typeof tt=="string"?{type:"textord",mode:et.mode,text:tt}:et}),_=buildExpression$1(b,a.withFont("mathrm"),!0),j=0;j<_.length;j++){var _e=_[j];_e instanceof SymbolNode&&(_e.text=_e.text.replace(/\u2212/,"-").replace(/\u2217/,"*"))}g=buildCommon.makeSpan(["mop"],_,a)}else g=buildCommon.makeSpan(["mop"],[],a);return d?assembleSupSub(g,o,c,a,a.style,0,0):g},mathmlBuilder=(e,a)=>{for(var o=buildExpression(e.body,a.withFont("mathrm")),c=!0,d=0;d<o.length;d++){var $=o[d];if(!($ instanceof mathMLTree.SpaceNode))if($ instanceof mathMLTree.MathNode)switch($.type){case"mi":case"mn":case"ms":case"mspace":case"mtext":break;case"mo":{var g=$.children[0];$.children.length===1&&g instanceof mathMLTree.TextNode?g.text=g.text.replace(/\u2212/,"-").replace(/\u2217/,"*"):c=!1;break}default:c=!1}else c=!1}if(c){var b=o.map(_e=>_e.toText()).join("");o=[new mathMLTree.TextNode(b)]}var _=new mathMLTree.MathNode("mi",o);_.setAttribute("mathvariant","normal");var j=new mathMLTree.MathNode("mo",[makeText("⁡","text")]);return e.parentIsSupSub?new mathMLTree.MathNode("mrow",[_,j]):mathMLTree.newDocumentFragment([_,j])};defineFunction({type:"operatorname",names:["\\operatorname@","\\operatornamewithlimits"],props:{numArgs:1},handler:(e,a)=>{var{parser:o,funcName:c}=e,d=a[0];return{type:"operatorname",mode:o.mode,body:ordargument(d),alwaysHandleSupSub:c==="\\operatornamewithlimits",limits:!1,parentIsSupSub:!1}},htmlBuilder:htmlBuilder$1,mathmlBuilder});defineMacro("\\operatorname","\\@ifstar\\operatornamewithlimits\\operatorname@");defineFunctionBuilders({type:"ordgroup",htmlBuilder(e,a){return e.semisimple?buildCommon.makeFragment(buildExpression$1(e.body,a,!1)):buildCommon.makeSpan(["mord"],buildExpression$1(e.body,a,!0),a)},mathmlBuilder(e,a){return buildExpressionRow(e.body,a,!0)}});defineFunction({type:"overline",names:["\\overline"],props:{numArgs:1},handler(e,a){var{parser:o}=e,c=a[0];return{type:"overline",mode:o.mode,body:c}},htmlBuilder(e,a){var o=buildGroup$1(e.body,a.havingCrampedStyle()),c=buildCommon.makeLineSpan("overline-line",a),d=a.fontMetrics().defaultRuleThickness,$=buildCommon.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:o},{type:"kern",size:3*d},{type:"elem",elem:c},{type:"kern",size:d}]},a);return buildCommon.makeSpan(["mord","overline"],[$],a)},mathmlBuilder(e,a){var o=new mathMLTree.MathNode("mo",[new mathMLTree.TextNode("‾")]);o.setAttribute("stretchy","true");var c=new mathMLTree.MathNode("mover",[buildGroup(e.body,a),o]);return c.setAttribute("accent","true"),c}});defineFunction({type:"phantom",names:["\\phantom"],props:{numArgs:1,allowedInText:!0},handler:(e,a)=>{var{parser:o}=e,c=a[0];return{type:"phantom",mode:o.mode,body:ordargument(c)}},htmlBuilder:(e,a)=>{var o=buildExpression$1(e.body,a.withPhantom(),!1);return buildCommon.makeFragment(o)},mathmlBuilder:(e,a)=>{var o=buildExpression(e.body,a);return new mathMLTree.MathNode("mphantom",o)}});defineFunction({type:"hphantom",names:["\\hphantom"],props:{numArgs:1,allowedInText:!0},handler:(e,a)=>{var{parser:o}=e,c=a[0];return{type:"hphantom",mode:o.mode,body:c}},htmlBuilder:(e,a)=>{var o=buildCommon.makeSpan([],[buildGroup$1(e.body,a.withPhantom())]);if(o.height=0,o.depth=0,o.children)for(var c=0;c<o.children.length;c++)o.children[c].height=0,o.children[c].depth=0;return o=buildCommon.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:o}]},a),buildCommon.makeSpan(["mord"],[o],a)},mathmlBuilder:(e,a)=>{var o=buildExpression(ordargument(e.body),a),c=new mathMLTree.MathNode("mphantom",o),d=new mathMLTree.MathNode("mpadded",[c]);return d.setAttribute("height","0px"),d.setAttribute("depth","0px"),d}});defineFunction({type:"vphantom",names:["\\vphantom"],props:{numArgs:1,allowedInText:!0},handler:(e,a)=>{var{parser:o}=e,c=a[0];return{type:"vphantom",mode:o.mode,body:c}},htmlBuilder:(e,a)=>{var o=buildCommon.makeSpan(["inner"],[buildGroup$1(e.body,a.withPhantom())]),c=buildCommon.makeSpan(["fix"],[]);return buildCommon.makeSpan(["mord","rlap"],[o,c],a)},mathmlBuilder:(e,a)=>{var o=buildExpression(ordargument(e.body),a),c=new mathMLTree.MathNode("mphantom",o),d=new mathMLTree.MathNode("mpadded",[c]);return d.setAttribute("width","0px"),d}});defineFunction({type:"raisebox",names:["\\raisebox"],props:{numArgs:2,argTypes:["size","hbox"],allowedInText:!0},handler(e,a){var{parser:o}=e,c=assertNodeType(a[0],"size").value,d=a[1];return{type:"raisebox",mode:o.mode,dy:c,body:d}},htmlBuilder(e,a){var o=buildGroup$1(e.body,a),c=calculateSize(e.dy,a);return buildCommon.makeVList({positionType:"shift",positionData:-c,children:[{type:"elem",elem:o}]},a)},mathmlBuilder(e,a){var o=new mathMLTree.MathNode("mpadded",[buildGroup(e.body,a)]),c=e.dy.number+e.dy.unit;return o.setAttribute("voffset",c),o}});defineFunction({type:"internal",names:["\\relax"],props:{numArgs:0,allowedInText:!0},handler(e){var{parser:a}=e;return{type:"internal",mode:a.mode}}});defineFunction({type:"rule",names:["\\rule"],props:{numArgs:2,numOptionalArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["size","size","size"]},handler(e,a,o){var{parser:c}=e,d=o[0],$=assertNodeType(a[0],"size"),g=assertNodeType(a[1],"size");return{type:"rule",mode:c.mode,shift:d&&assertNodeType(d,"size").value,width:$.value,height:g.value}},htmlBuilder(e,a){var o=buildCommon.makeSpan(["mord","rule"],[],a),c=calculateSize(e.width,a),d=calculateSize(e.height,a),$=e.shift?calculateSize(e.shift,a):0;return o.style.borderRightWidth=makeEm(c),o.style.borderTopWidth=makeEm(d),o.style.bottom=makeEm($),o.width=c,o.height=d+$,o.depth=-$,o.maxFontSize=d*1.125*a.sizeMultiplier,o},mathmlBuilder(e,a){var o=calculateSize(e.width,a),c=calculateSize(e.height,a),d=e.shift?calculateSize(e.shift,a):0,$=a.color&&a.getColor()||"black",g=new mathMLTree.MathNode("mspace");g.setAttribute("mathbackground",$),g.setAttribute("width",makeEm(o)),g.setAttribute("height",makeEm(c));var b=new mathMLTree.MathNode("mpadded",[g]);return d>=0?b.setAttribute("height",makeEm(d)):(b.setAttribute("height",makeEm(d)),b.setAttribute("depth",makeEm(-d))),b.setAttribute("voffset",makeEm(d)),b}});function sizingGroup(e,a,o){for(var c=buildExpression$1(e,a,!1),d=a.sizeMultiplier/o.sizeMultiplier,$=0;$<c.length;$++){var g=c[$].classes.indexOf("sizing");g<0?Array.prototype.push.apply(c[$].classes,a.sizingClasses(o)):c[$].classes[g+1]==="reset-size"+a.size&&(c[$].classes[g+1]="reset-size"+o.size),c[$].height*=d,c[$].depth*=d}return buildCommon.makeFragment(c)}var sizeFuncs=["\\tiny","\\sixptsize","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"],htmlBuilder=(e,a)=>{var o=a.havingSize(e.size);return sizingGroup(e.body,o,a)};defineFunction({type:"sizing",names:sizeFuncs,props:{numArgs:0,allowedInText:!0},handler:(e,a)=>{var{breakOnTokenText:o,funcName:c,parser:d}=e,$=d.parseExpression(!1,o);return{type:"sizing",mode:d.mode,size:sizeFuncs.indexOf(c)+1,body:$}},htmlBuilder,mathmlBuilder:(e,a)=>{var o=a.havingSize(e.size),c=buildExpression(e.body,o),d=new mathMLTree.MathNode("mstyle",c);return d.setAttribute("mathsize",makeEm(o.sizeMultiplier)),d}});defineFunction({type:"smash",names:["\\smash"],props:{numArgs:1,numOptionalArgs:1,allowedInText:!0},handler:(e,a,o)=>{var{parser:c}=e,d=!1,$=!1,g=o[0]&&assertNodeType(o[0],"ordgroup");if(g)for(var b="",_=0;_<g.body.length;++_){var j=g.body[_];if(b=j.text,b==="t")d=!0;else if(b==="b")$=!0;else{d=!1,$=!1;break}}else d=!0,$=!0;var _e=a[0];return{type:"smash",mode:c.mode,body:_e,smashHeight:d,smashDepth:$}},htmlBuilder:(e,a)=>{var o=buildCommon.makeSpan([],[buildGroup$1(e.body,a)]);if(!e.smashHeight&&!e.smashDepth)return o;if(e.smashHeight&&(o.height=0,o.children))for(var c=0;c<o.children.length;c++)o.children[c].height=0;if(e.smashDepth&&(o.depth=0,o.children))for(var d=0;d<o.children.length;d++)o.children[d].depth=0;var $=buildCommon.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:o}]},a);return buildCommon.makeSpan(["mord"],[$],a)},mathmlBuilder:(e,a)=>{var o=new mathMLTree.MathNode("mpadded",[buildGroup(e.body,a)]);return e.smashHeight&&o.setAttribute("height","0px"),e.smashDepth&&o.setAttribute("depth","0px"),o}});defineFunction({type:"sqrt",names:["\\sqrt"],props:{numArgs:1,numOptionalArgs:1},handler(e,a,o){var{parser:c}=e,d=o[0],$=a[0];return{type:"sqrt",mode:c.mode,body:$,index:d}},htmlBuilder(e,a){var o=buildGroup$1(e.body,a.havingCrampedStyle());o.height===0&&(o.height=a.fontMetrics().xHeight),o=buildCommon.wrapFragment(o,a);var c=a.fontMetrics(),d=c.defaultRuleThickness,$=d;a.style.id<Style$1.TEXT.id&&($=a.fontMetrics().xHeight);var g=d+$/4,b=o.height+o.depth+g+d,{span:_,ruleWidth:j,advanceWidth:_e}=delimiter.sqrtImage(b,a),et=_.height-j;et>o.height+o.depth+g&&(g=(g+et-o.height-o.depth)/2);var tt=_.height-o.height-g-j;o.style.paddingLeft=makeEm(_e);var nt=buildCommon.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:o,wrapperClasses:["svg-align"]},{type:"kern",size:-(o.height+tt)},{type:"elem",elem:_},{type:"kern",size:j}]},a);if(e.index){var at=a.havingStyle(Style$1.SCRIPTSCRIPT),lt=buildGroup$1(e.index,at,a),mt=.6*(nt.height-nt.depth),ot=buildCommon.makeVList({positionType:"shift",positionData:-mt,children:[{type:"elem",elem:lt}]},a),st=buildCommon.makeSpan(["root"],[ot]);return buildCommon.makeSpan(["mord","sqrt"],[st,nt],a)}else return buildCommon.makeSpan(["mord","sqrt"],[nt],a)},mathmlBuilder(e,a){var{body:o,index:c}=e;return c?new mathMLTree.MathNode("mroot",[buildGroup(o,a),buildGroup(c,a)]):new mathMLTree.MathNode("msqrt",[buildGroup(o,a)])}});var styleMap={display:Style$1.DISPLAY,text:Style$1.TEXT,script:Style$1.SCRIPT,scriptscript:Style$1.SCRIPTSCRIPT};defineFunction({type:"styling",names:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(e,a){var{breakOnTokenText:o,funcName:c,parser:d}=e,$=d.parseExpression(!0,o),g=c.slice(1,c.length-5);return{type:"styling",mode:d.mode,style:g,body:$}},htmlBuilder(e,a){var o=styleMap[e.style],c=a.havingStyle(o).withFont("");return sizingGroup(e.body,c,a)},mathmlBuilder(e,a){var o=styleMap[e.style],c=a.havingStyle(o),d=buildExpression(e.body,c),$=new mathMLTree.MathNode("mstyle",d),g={display:["0","true"],text:["0","false"],script:["1","false"],scriptscript:["2","false"]},b=g[e.style];return $.setAttribute("scriptlevel",b[0]),$.setAttribute("displaystyle",b[1]),$}});var htmlBuilderDelegate=function e(a,o){var c=a.base;if(c)if(c.type==="op"){var d=c.limits&&(o.style.size===Style$1.DISPLAY.size||c.alwaysHandleSupSub);return d?htmlBuilder$2:null}else if(c.type==="operatorname"){var $=c.alwaysHandleSupSub&&(o.style.size===Style$1.DISPLAY.size||c.limits);return $?htmlBuilder$1:null}else{if(c.type==="accent")return utils.isCharacterBox(c.base)?htmlBuilder$a:null;if(c.type==="horizBrace"){var g=!a.sub;return g===c.isOver?htmlBuilder$3:null}else return null}else return null};defineFunctionBuilders({type:"supsub",htmlBuilder(e,a){var o=htmlBuilderDelegate(e,a);if(o)return o(e,a);var{base:c,sup:d,sub:$}=e,g=buildGroup$1(c,a),b,_,j=a.fontMetrics(),_e=0,et=0,tt=c&&utils.isCharacterBox(c);if(d){var nt=a.havingStyle(a.style.sup());b=buildGroup$1(d,nt,a),tt||(_e=g.height-nt.fontMetrics().supDrop*nt.sizeMultiplier/a.sizeMultiplier)}if($){var at=a.havingStyle(a.style.sub());_=buildGroup$1($,at,a),tt||(et=g.depth+at.fontMetrics().subDrop*at.sizeMultiplier/a.sizeMultiplier)}var lt;a.style===Style$1.DISPLAY?lt=j.sup1:a.style.cramped?lt=j.sup3:lt=j.sup2;var mt=a.sizeMultiplier,ot=makeEm(.5/j.ptPerEm/mt),st=null;if(_){var ut=e.base&&e.base.type==="op"&&e.base.name&&(e.base.name==="\\oiint"||e.base.name==="\\oiiint");(g instanceof SymbolNode||ut)&&(st=makeEm(-g.italic))}var pt;if(b&&_){_e=Math.max(_e,lt,b.depth+.25*j.xHeight),et=Math.max(et,j.sub2);var gt=j.defaultRuleThickness,ft=4*gt;if(_e-b.depth-(_.height-et)<ft){et=ft-(_e-b.depth)+_.height;var yt=.8*j.xHeight-(_e-b.depth);yt>0&&(_e+=yt,et-=yt)}var _t=[{type:"elem",elem:_,shift:et,marginRight:ot,marginLeft:st},{type:"elem",elem:b,shift:-_e,marginRight:ot}];pt=buildCommon.makeVList({positionType:"individualShift",children:_t},a)}else if(_){et=Math.max(et,j.sub1,_.height-.8*j.xHeight);var vt=[{type:"elem",elem:_,marginLeft:st,marginRight:ot}];pt=buildCommon.makeVList({positionType:"shift",positionData:et,children:vt},a)}else if(b)_e=Math.max(_e,lt,b.depth+.25*j.xHeight),pt=buildCommon.makeVList({positionType:"shift",positionData:-_e,children:[{type:"elem",elem:b,marginRight:ot}]},a);else throw new Error("supsub must have either sup or sub.");var Pt=getTypeOfDomTree(g,"right")||"mord";return buildCommon.makeSpan([Pt],[g,buildCommon.makeSpan(["msupsub"],[pt])],a)},mathmlBuilder(e,a){var o=!1,c,d;e.base&&e.base.type==="horizBrace"&&(d=!!e.sup,d===e.base.isOver&&(o=!0,c=e.base.isOver)),e.base&&(e.base.type==="op"||e.base.type==="operatorname")&&(e.base.parentIsSupSub=!0);var $=[buildGroup(e.base,a)];e.sub&&$.push(buildGroup(e.sub,a)),e.sup&&$.push(buildGroup(e.sup,a));var g;if(o)g=c?"mover":"munder";else if(e.sub)if(e.sup){var j=e.base;j&&j.type==="op"&&j.limits&&a.style===Style$1.DISPLAY||j&&j.type==="operatorname"&&j.alwaysHandleSupSub&&(a.style===Style$1.DISPLAY||j.limits)?g="munderover":g="msubsup"}else{var _=e.base;_&&_.type==="op"&&_.limits&&(a.style===Style$1.DISPLAY||_.alwaysHandleSupSub)||_&&_.type==="operatorname"&&_.alwaysHandleSupSub&&(_.limits||a.style===Style$1.DISPLAY)?g="munder":g="msub"}else{var b=e.base;b&&b.type==="op"&&b.limits&&(a.style===Style$1.DISPLAY||b.alwaysHandleSupSub)||b&&b.type==="operatorname"&&b.alwaysHandleSupSub&&(b.limits||a.style===Style$1.DISPLAY)?g="mover":g="msup"}return new mathMLTree.MathNode(g,$)}});defineFunctionBuilders({type:"atom",htmlBuilder(e,a){return buildCommon.mathsym(e.text,e.mode,a,["m"+e.family])},mathmlBuilder(e,a){var o=new mathMLTree.MathNode("mo",[makeText(e.text,e.mode)]);if(e.family==="bin"){var c=getVariant(e,a);c==="bold-italic"&&o.setAttribute("mathvariant",c)}else e.family==="punct"?o.setAttribute("separator","true"):(e.family==="open"||e.family==="close")&&o.setAttribute("stretchy","false");return o}});var defaultVariant={mi:"italic",mn:"normal",mtext:"normal"};defineFunctionBuilders({type:"mathord",htmlBuilder(e,a){return buildCommon.makeOrd(e,a,"mathord")},mathmlBuilder(e,a){var o=new mathMLTree.MathNode("mi",[makeText(e.text,e.mode,a)]),c=getVariant(e,a)||"italic";return c!==defaultVariant[o.type]&&o.setAttribute("mathvariant",c),o}});defineFunctionBuilders({type:"textord",htmlBuilder(e,a){return buildCommon.makeOrd(e,a,"textord")},mathmlBuilder(e,a){var o=makeText(e.text,e.mode,a),c=getVariant(e,a)||"normal",d;return e.mode==="text"?d=new mathMLTree.MathNode("mtext",[o]):/[0-9]/.test(e.text)?d=new mathMLTree.MathNode("mn",[o]):e.text==="\\prime"?d=new mathMLTree.MathNode("mo",[o]):d=new mathMLTree.MathNode("mi",[o]),c!==defaultVariant[d.type]&&d.setAttribute("mathvariant",c),d}});var cssSpace={"\\nobreak":"nobreak","\\allowbreak":"allowbreak"},regularSpace={" ":{},"\\ ":{},"~":{className:"nobreak"},"\\space":{},"\\nobreakspace":{className:"nobreak"}};defineFunctionBuilders({type:"spacing",htmlBuilder(e,a){if(regularSpace.hasOwnProperty(e.text)){var o=regularSpace[e.text].className||"";if(e.mode==="text"){var c=buildCommon.makeOrd(e,a,"textord");return c.classes.push(o),c}else return buildCommon.makeSpan(["mspace",o],[buildCommon.mathsym(e.text,e.mode,a)],a)}else{if(cssSpace.hasOwnProperty(e.text))return buildCommon.makeSpan(["mspace",cssSpace[e.text]],[],a);throw new ParseError('Unknown type of space "'+e.text+'"')}},mathmlBuilder(e,a){var o;if(regularSpace.hasOwnProperty(e.text))o=new mathMLTree.MathNode("mtext",[new mathMLTree.TextNode(" ")]);else{if(cssSpace.hasOwnProperty(e.text))return new mathMLTree.MathNode("mspace");throw new ParseError('Unknown type of space "'+e.text+'"')}return o}});var pad=()=>{var e=new mathMLTree.MathNode("mtd",[]);return e.setAttribute("width","50%"),e};defineFunctionBuilders({type:"tag",mathmlBuilder(e,a){var o=new mathMLTree.MathNode("mtable",[new mathMLTree.MathNode("mtr",[pad(),new mathMLTree.MathNode("mtd",[buildExpressionRow(e.body,a)]),pad(),new mathMLTree.MathNode("mtd",[buildExpressionRow(e.tag,a)])])]);return o.setAttribute("width","100%"),o}});var textFontFamilies={"\\text":void 0,"\\textrm":"textrm","\\textsf":"textsf","\\texttt":"texttt","\\textnormal":"textrm"},textFontWeights={"\\textbf":"textbf","\\textmd":"textmd"},textFontShapes={"\\textit":"textit","\\textup":"textup"},optionsWithFont=(e,a)=>{var o=e.font;if(o){if(textFontFamilies[o])return a.withTextFontFamily(textFontFamilies[o]);if(textFontWeights[o])return a.withTextFontWeight(textFontWeights[o]);if(o==="\\emph")return a.fontShape==="textit"?a.withTextFontShape("textup"):a.withTextFontShape("textit")}else return a;return a.withTextFontShape(textFontShapes[o])};defineFunction({type:"text",names:["\\text","\\textrm","\\textsf","\\texttt","\\textnormal","\\textbf","\\textmd","\\textit","\\textup","\\emph"],props:{numArgs:1,argTypes:["text"],allowedInArgument:!0,allowedInText:!0},handler(e,a){var{parser:o,funcName:c}=e,d=a[0];return{type:"text",mode:o.mode,body:ordargument(d),font:c}},htmlBuilder(e,a){var o=optionsWithFont(e,a),c=buildExpression$1(e.body,o,!0);return buildCommon.makeSpan(["mord","text"],c,o)},mathmlBuilder(e,a){var o=optionsWithFont(e,a);return buildExpressionRow(e.body,o)}});defineFunction({type:"underline",names:["\\underline"],props:{numArgs:1,allowedInText:!0},handler(e,a){var{parser:o}=e;return{type:"underline",mode:o.mode,body:a[0]}},htmlBuilder(e,a){var o=buildGroup$1(e.body,a),c=buildCommon.makeLineSpan("underline-line",a),d=a.fontMetrics().defaultRuleThickness,$=buildCommon.makeVList({positionType:"top",positionData:o.height,children:[{type:"kern",size:d},{type:"elem",elem:c},{type:"kern",size:3*d},{type:"elem",elem:o}]},a);return buildCommon.makeSpan(["mord","underline"],[$],a)},mathmlBuilder(e,a){var o=new mathMLTree.MathNode("mo",[new mathMLTree.TextNode("‾")]);o.setAttribute("stretchy","true");var c=new mathMLTree.MathNode("munder",[buildGroup(e.body,a),o]);return c.setAttribute("accentunder","true"),c}});defineFunction({type:"vcenter",names:["\\vcenter"],props:{numArgs:1,argTypes:["original"],allowedInText:!1},handler(e,a){var{parser:o}=e;return{type:"vcenter",mode:o.mode,body:a[0]}},htmlBuilder(e,a){var o=buildGroup$1(e.body,a),c=a.fontMetrics().axisHeight,d=.5*(o.height-c-(o.depth+c));return buildCommon.makeVList({positionType:"shift",positionData:d,children:[{type:"elem",elem:o}]},a)},mathmlBuilder(e,a){return new mathMLTree.MathNode("mpadded",[buildGroup(e.body,a)],["vcenter"])}});defineFunction({type:"verb",names:["\\verb"],props:{numArgs:0,allowedInText:!0},handler(e,a,o){throw new ParseError("\\verb ended by end of line instead of matching delimiter")},htmlBuilder(e,a){for(var o=makeVerb(e),c=[],d=a.havingStyle(a.style.text()),$=0;$<o.length;$++){var g=o[$];g==="~"&&(g="\\textasciitilde"),c.push(buildCommon.makeSymbol(g,"Typewriter-Regular",e.mode,d,["mord","texttt"]))}return buildCommon.makeSpan(["mord","text"].concat(d.sizingClasses(a)),buildCommon.tryCombineChars(c),d)},mathmlBuilder(e,a){var o=new mathMLTree.TextNode(makeVerb(e)),c=new mathMLTree.MathNode("mtext",[o]);return c.setAttribute("mathvariant","monospace"),c}});var makeVerb=e=>e.body.replace(/ /g,e.star?"␣":" "),functions=_functions,spaceRegexString=`[ \r
	]`,controlWordRegexString="\\\\[a-zA-Z@]+",controlSymbolRegexString="\\\\[^\uD800-\uDFFF]",controlWordWhitespaceRegexString="("+controlWordRegexString+")"+spaceRegexString+"*",controlSpaceRegexString=`\\\\(
|[ \r	]+
?)[ \r	]*`,combiningDiacriticalMarkString="[̀-ͯ]",combiningDiacriticalMarksEndRegex=new RegExp(combiningDiacriticalMarkString+"+$"),tokenRegexString="("+spaceRegexString+"+)|"+(controlSpaceRegexString+"|")+"([!-\\[\\]-‧‪-퟿豈-￿]"+(combiningDiacriticalMarkString+"*")+"|[\uD800-\uDBFF][\uDC00-\uDFFF]"+(combiningDiacriticalMarkString+"*")+"|\\\\verb\\*([^]).*?\\4|\\\\verb([^*a-zA-Z]).*?\\5"+("|"+controlWordWhitespaceRegexString)+("|"+controlSymbolRegexString+")");class Lexer{constructor(a,o){this.input=void 0,this.settings=void 0,this.tokenRegex=void 0,this.catcodes=void 0,this.input=a,this.settings=o,this.tokenRegex=new RegExp(tokenRegexString,"g"),this.catcodes={"%":14,"~":13}}setCatcode(a,o){this.catcodes[a]=o}lex(){var a=this.input,o=this.tokenRegex.lastIndex;if(o===a.length)return new Token("EOF",new SourceLocation(this,o,o));var c=this.tokenRegex.exec(a);if(c===null||c.index!==o)throw new ParseError("Unexpected character: '"+a[o]+"'",new Token(a[o],new SourceLocation(this,o,o+1)));var d=c[6]||c[3]||(c[2]?"\\ ":" ");if(this.catcodes[d]===14){var $=a.indexOf(`
`,this.tokenRegex.lastIndex);return $===-1?(this.tokenRegex.lastIndex=a.length,this.settings.reportNonstrict("commentAtEnd","% comment has no terminating newline; LaTeX would fail because of commenting the end of math mode (e.g. $)")):this.tokenRegex.lastIndex=$+1,this.lex()}return new Token(d,new SourceLocation(this,o,this.tokenRegex.lastIndex))}}class Namespace{constructor(a,o){a===void 0&&(a={}),o===void 0&&(o={}),this.current=void 0,this.builtins=void 0,this.undefStack=void 0,this.current=o,this.builtins=a,this.undefStack=[]}beginGroup(){this.undefStack.push({})}endGroup(){if(this.undefStack.length===0)throw new ParseError("Unbalanced namespace destruction: attempt to pop global namespace; please report this as a bug");var a=this.undefStack.pop();for(var o in a)a.hasOwnProperty(o)&&(a[o]==null?delete this.current[o]:this.current[o]=a[o])}endGroups(){for(;this.undefStack.length>0;)this.endGroup()}has(a){return this.current.hasOwnProperty(a)||this.builtins.hasOwnProperty(a)}get(a){return this.current.hasOwnProperty(a)?this.current[a]:this.builtins[a]}set(a,o,c){if(c===void 0&&(c=!1),c){for(var d=0;d<this.undefStack.length;d++)delete this.undefStack[d][a];this.undefStack.length>0&&(this.undefStack[this.undefStack.length-1][a]=o)}else{var $=this.undefStack[this.undefStack.length-1];$&&!$.hasOwnProperty(a)&&($[a]=this.current[a])}o==null?delete this.current[a]:this.current[a]=o}}var macros=_macros;defineMacro("\\noexpand",function(e){var a=e.popToken();return e.isExpandable(a.text)&&(a.noexpand=!0,a.treatAsRelax=!0),{tokens:[a],numArgs:0}});defineMacro("\\expandafter",function(e){var a=e.popToken();return e.expandOnce(!0),{tokens:[a],numArgs:0}});defineMacro("\\@firstoftwo",function(e){var a=e.consumeArgs(2);return{tokens:a[0],numArgs:0}});defineMacro("\\@secondoftwo",function(e){var a=e.consumeArgs(2);return{tokens:a[1],numArgs:0}});defineMacro("\\@ifnextchar",function(e){var a=e.consumeArgs(3);e.consumeSpaces();var o=e.future();return a[0].length===1&&a[0][0].text===o.text?{tokens:a[1],numArgs:0}:{tokens:a[2],numArgs:0}});defineMacro("\\@ifstar","\\@ifnextchar *{\\@firstoftwo{#1}}");defineMacro("\\TextOrMath",function(e){var a=e.consumeArgs(2);return e.mode==="text"?{tokens:a[0],numArgs:0}:{tokens:a[1],numArgs:0}});var digitToNumber={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};defineMacro("\\char",function(e){var a=e.popToken(),o,c="";if(a.text==="'")o=8,a=e.popToken();else if(a.text==='"')o=16,a=e.popToken();else if(a.text==="`")if(a=e.popToken(),a.text[0]==="\\")c=a.text.charCodeAt(1);else{if(a.text==="EOF")throw new ParseError("\\char` missing argument");c=a.text.charCodeAt(0)}else o=10;if(o){if(c=digitToNumber[a.text],c==null||c>=o)throw new ParseError("Invalid base-"+o+" digit "+a.text);for(var d;(d=digitToNumber[e.future().text])!=null&&d<o;)c*=o,c+=d,e.popToken()}return"\\@char{"+c+"}"});var newcommand=(e,a,o)=>{var c=e.consumeArg().tokens;if(c.length!==1)throw new ParseError("\\newcommand's first argument must be a macro name");var d=c[0].text,$=e.isDefined(d);if($&&!a)throw new ParseError("\\newcommand{"+d+"} attempting to redefine "+(d+"; use \\renewcommand"));if(!$&&!o)throw new ParseError("\\renewcommand{"+d+"} when command "+d+" does not yet exist; use \\newcommand");var g=0;if(c=e.consumeArg().tokens,c.length===1&&c[0].text==="["){for(var b="",_=e.expandNextToken();_.text!=="]"&&_.text!=="EOF";)b+=_.text,_=e.expandNextToken();if(!b.match(/^\s*[0-9]+\s*$/))throw new ParseError("Invalid number of arguments: "+b);g=parseInt(b),c=e.consumeArg().tokens}return e.macros.set(d,{tokens:c,numArgs:g}),""};defineMacro("\\newcommand",e=>newcommand(e,!1,!0));defineMacro("\\renewcommand",e=>newcommand(e,!0,!1));defineMacro("\\providecommand",e=>newcommand(e,!0,!0));defineMacro("\\message",e=>{var a=e.consumeArgs(1)[0];return console.log(a.reverse().map(o=>o.text).join("")),""});defineMacro("\\errmessage",e=>{var a=e.consumeArgs(1)[0];return console.error(a.reverse().map(o=>o.text).join("")),""});defineMacro("\\show",e=>{var a=e.popToken(),o=a.text;return console.log(a,e.macros.get(o),functions[o],symbols.math[o],symbols.text[o]),""});defineMacro("\\bgroup","{");defineMacro("\\egroup","}");defineMacro("~","\\nobreakspace");defineMacro("\\lq","`");defineMacro("\\rq","'");defineMacro("\\aa","\\r a");defineMacro("\\AA","\\r A");defineMacro("\\textcopyright","\\html@mathml{\\textcircled{c}}{\\char`©}");defineMacro("\\copyright","\\TextOrMath{\\textcopyright}{\\text{\\textcopyright}}");defineMacro("\\textregistered","\\html@mathml{\\textcircled{\\scriptsize R}}{\\char`®}");defineMacro("ℬ","\\mathscr{B}");defineMacro("ℰ","\\mathscr{E}");defineMacro("ℱ","\\mathscr{F}");defineMacro("ℋ","\\mathscr{H}");defineMacro("ℐ","\\mathscr{I}");defineMacro("ℒ","\\mathscr{L}");defineMacro("ℳ","\\mathscr{M}");defineMacro("ℛ","\\mathscr{R}");defineMacro("ℭ","\\mathfrak{C}");defineMacro("ℌ","\\mathfrak{H}");defineMacro("ℨ","\\mathfrak{Z}");defineMacro("\\Bbbk","\\Bbb{k}");defineMacro("·","\\cdotp");defineMacro("\\llap","\\mathllap{\\textrm{#1}}");defineMacro("\\rlap","\\mathrlap{\\textrm{#1}}");defineMacro("\\clap","\\mathclap{\\textrm{#1}}");defineMacro("\\mathstrut","\\vphantom{(}");defineMacro("\\underbar","\\underline{\\text{#1}}");defineMacro("\\not",'\\html@mathml{\\mathrel{\\mathrlap\\@not}}{\\char"338}');defineMacro("\\neq","\\html@mathml{\\mathrel{\\not=}}{\\mathrel{\\char`≠}}");defineMacro("\\ne","\\neq");defineMacro("≠","\\neq");defineMacro("\\notin","\\html@mathml{\\mathrel{{\\in}\\mathllap{/\\mskip1mu}}}{\\mathrel{\\char`∉}}");defineMacro("∉","\\notin");defineMacro("≘","\\html@mathml{\\mathrel{=\\kern{-1em}\\raisebox{0.4em}{$\\scriptsize\\frown$}}}{\\mathrel{\\char`≘}}");defineMacro("≙","\\html@mathml{\\stackrel{\\tiny\\wedge}{=}}{\\mathrel{\\char`≘}}");defineMacro("≚","\\html@mathml{\\stackrel{\\tiny\\vee}{=}}{\\mathrel{\\char`≚}}");defineMacro("≛","\\html@mathml{\\stackrel{\\scriptsize\\star}{=}}{\\mathrel{\\char`≛}}");defineMacro("≝","\\html@mathml{\\stackrel{\\tiny\\mathrm{def}}{=}}{\\mathrel{\\char`≝}}");defineMacro("≞","\\html@mathml{\\stackrel{\\tiny\\mathrm{m}}{=}}{\\mathrel{\\char`≞}}");defineMacro("≟","\\html@mathml{\\stackrel{\\tiny?}{=}}{\\mathrel{\\char`≟}}");defineMacro("⟂","\\perp");defineMacro("‼","\\mathclose{!\\mkern-0.8mu!}");defineMacro("∌","\\notni");defineMacro("⌜","\\ulcorner");defineMacro("⌝","\\urcorner");defineMacro("⌞","\\llcorner");defineMacro("⌟","\\lrcorner");defineMacro("©","\\copyright");defineMacro("®","\\textregistered");defineMacro("️","\\textregistered");defineMacro("\\ulcorner",'\\html@mathml{\\@ulcorner}{\\mathop{\\char"231c}}');defineMacro("\\urcorner",'\\html@mathml{\\@urcorner}{\\mathop{\\char"231d}}');defineMacro("\\llcorner",'\\html@mathml{\\@llcorner}{\\mathop{\\char"231e}}');defineMacro("\\lrcorner",'\\html@mathml{\\@lrcorner}{\\mathop{\\char"231f}}');defineMacro("\\vdots","{\\varvdots\\rule{0pt}{15pt}}");defineMacro("⋮","\\vdots");defineMacro("\\varGamma","\\mathit{\\Gamma}");defineMacro("\\varDelta","\\mathit{\\Delta}");defineMacro("\\varTheta","\\mathit{\\Theta}");defineMacro("\\varLambda","\\mathit{\\Lambda}");defineMacro("\\varXi","\\mathit{\\Xi}");defineMacro("\\varPi","\\mathit{\\Pi}");defineMacro("\\varSigma","\\mathit{\\Sigma}");defineMacro("\\varUpsilon","\\mathit{\\Upsilon}");defineMacro("\\varPhi","\\mathit{\\Phi}");defineMacro("\\varPsi","\\mathit{\\Psi}");defineMacro("\\varOmega","\\mathit{\\Omega}");defineMacro("\\substack","\\begin{subarray}{c}#1\\end{subarray}");defineMacro("\\colon","\\nobreak\\mskip2mu\\mathpunct{}\\mathchoice{\\mkern-3mu}{\\mkern-3mu}{}{}{:}\\mskip6mu\\relax");defineMacro("\\boxed","\\fbox{$\\displaystyle{#1}$}");defineMacro("\\iff","\\DOTSB\\;\\Longleftrightarrow\\;");defineMacro("\\implies","\\DOTSB\\;\\Longrightarrow\\;");defineMacro("\\impliedby","\\DOTSB\\;\\Longleftarrow\\;");defineMacro("\\dddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ...}}{#1}}");defineMacro("\\ddddot","{\\overset{\\raisebox{-0.1ex}{\\normalsize ....}}{#1}}");var dotsByToken={",":"\\dotsc","\\not":"\\dotsb","+":"\\dotsb","=":"\\dotsb","<":"\\dotsb",">":"\\dotsb","-":"\\dotsb","*":"\\dotsb",":":"\\dotsb","\\DOTSB":"\\dotsb","\\coprod":"\\dotsb","\\bigvee":"\\dotsb","\\bigwedge":"\\dotsb","\\biguplus":"\\dotsb","\\bigcap":"\\dotsb","\\bigcup":"\\dotsb","\\prod":"\\dotsb","\\sum":"\\dotsb","\\bigotimes":"\\dotsb","\\bigoplus":"\\dotsb","\\bigodot":"\\dotsb","\\bigsqcup":"\\dotsb","\\And":"\\dotsb","\\longrightarrow":"\\dotsb","\\Longrightarrow":"\\dotsb","\\longleftarrow":"\\dotsb","\\Longleftarrow":"\\dotsb","\\longleftrightarrow":"\\dotsb","\\Longleftrightarrow":"\\dotsb","\\mapsto":"\\dotsb","\\longmapsto":"\\dotsb","\\hookrightarrow":"\\dotsb","\\doteq":"\\dotsb","\\mathbin":"\\dotsb","\\mathrel":"\\dotsb","\\relbar":"\\dotsb","\\Relbar":"\\dotsb","\\xrightarrow":"\\dotsb","\\xleftarrow":"\\dotsb","\\DOTSI":"\\dotsi","\\int":"\\dotsi","\\oint":"\\dotsi","\\iint":"\\dotsi","\\iiint":"\\dotsi","\\iiiint":"\\dotsi","\\idotsint":"\\dotsi","\\DOTSX":"\\dotsx"};defineMacro("\\dots",function(e){var a="\\dotso",o=e.expandAfterFuture().text;return o in dotsByToken?a=dotsByToken[o]:(o.slice(0,4)==="\\not"||o in symbols.math&&utils.contains(["bin","rel"],symbols.math[o].group))&&(a="\\dotsb"),a});var spaceAfterDots={")":!0,"]":!0,"\\rbrack":!0,"\\}":!0,"\\rbrace":!0,"\\rangle":!0,"\\rceil":!0,"\\rfloor":!0,"\\rgroup":!0,"\\rmoustache":!0,"\\right":!0,"\\bigr":!0,"\\biggr":!0,"\\Bigr":!0,"\\Biggr":!0,$:!0,";":!0,".":!0,",":!0};defineMacro("\\dotso",function(e){var a=e.future().text;return a in spaceAfterDots?"\\ldots\\,":"\\ldots"});defineMacro("\\dotsc",function(e){var a=e.future().text;return a in spaceAfterDots&&a!==","?"\\ldots\\,":"\\ldots"});defineMacro("\\cdots",function(e){var a=e.future().text;return a in spaceAfterDots?"\\@cdots\\,":"\\@cdots"});defineMacro("\\dotsb","\\cdots");defineMacro("\\dotsm","\\cdots");defineMacro("\\dotsi","\\!\\cdots");defineMacro("\\dotsx","\\ldots\\,");defineMacro("\\DOTSI","\\relax");defineMacro("\\DOTSB","\\relax");defineMacro("\\DOTSX","\\relax");defineMacro("\\tmspace","\\TextOrMath{\\kern#1#3}{\\mskip#1#2}\\relax");defineMacro("\\,","\\tmspace+{3mu}{.1667em}");defineMacro("\\thinspace","\\,");defineMacro("\\>","\\mskip{4mu}");defineMacro("\\:","\\tmspace+{4mu}{.2222em}");defineMacro("\\medspace","\\:");defineMacro("\\;","\\tmspace+{5mu}{.2777em}");defineMacro("\\thickspace","\\;");defineMacro("\\!","\\tmspace-{3mu}{.1667em}");defineMacro("\\negthinspace","\\!");defineMacro("\\negmedspace","\\tmspace-{4mu}{.2222em}");defineMacro("\\negthickspace","\\tmspace-{5mu}{.277em}");defineMacro("\\enspace","\\kern.5em ");defineMacro("\\enskip","\\hskip.5em\\relax");defineMacro("\\quad","\\hskip1em\\relax");defineMacro("\\qquad","\\hskip2em\\relax");defineMacro("\\tag","\\@ifstar\\tag@literal\\tag@paren");defineMacro("\\tag@paren","\\tag@literal{({#1})}");defineMacro("\\tag@literal",e=>{if(e.macros.get("\\df@tag"))throw new ParseError("Multiple \\tag");return"\\gdef\\df@tag{\\text{#1}}"});defineMacro("\\bmod","\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}\\mathbin{\\rm mod}\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}");defineMacro("\\pod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern8mu}{\\mkern8mu}{\\mkern8mu}(#1)");defineMacro("\\pmod","\\pod{{\\rm mod}\\mkern6mu#1}");defineMacro("\\mod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern12mu}{\\mkern12mu}{\\mkern12mu}{\\rm mod}\\,\\,#1");defineMacro("\\newline","\\\\\\relax");defineMacro("\\TeX","\\textrm{\\html@mathml{T\\kern-.1667em\\raisebox{-.5ex}{E}\\kern-.125emX}{TeX}}");var latexRaiseA=makeEm(fontMetricsData["Main-Regular"][84][1]-.7*fontMetricsData["Main-Regular"][65][1]);defineMacro("\\LaTeX","\\textrm{\\html@mathml{"+("L\\kern-.36em\\raisebox{"+latexRaiseA+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{LaTeX}}");defineMacro("\\KaTeX","\\textrm{\\html@mathml{"+("K\\kern-.17em\\raisebox{"+latexRaiseA+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{KaTeX}}");defineMacro("\\hspace","\\@ifstar\\@hspacer\\@hspace");defineMacro("\\@hspace","\\hskip #1\\relax");defineMacro("\\@hspacer","\\rule{0pt}{0pt}\\hskip #1\\relax");defineMacro("\\ordinarycolon",":");defineMacro("\\vcentcolon","\\mathrel{\\mathop\\ordinarycolon}");defineMacro("\\dblcolon",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-.9mu}\\vcentcolon}}{\\mathop{\\char"2237}}');defineMacro("\\coloneqq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2254}}');defineMacro("\\Coloneqq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2237\\char"3d}}');defineMacro("\\coloneq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"3a\\char"2212}}');defineMacro("\\Coloneq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"2237\\char"2212}}');defineMacro("\\eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2255}}');defineMacro("\\Eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"3d\\char"2237}}');defineMacro("\\eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2239}}');defineMacro("\\Eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"2212\\char"2237}}');defineMacro("\\colonapprox",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"3a\\char"2248}}');defineMacro("\\Colonapprox",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"2237\\char"2248}}');defineMacro("\\colonsim",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"3a\\char"223c}}');defineMacro("\\Colonsim",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"2237\\char"223c}}');defineMacro("∷","\\dblcolon");defineMacro("∹","\\eqcolon");defineMacro("≔","\\coloneqq");defineMacro("≕","\\eqqcolon");defineMacro("⩴","\\Coloneqq");defineMacro("\\ratio","\\vcentcolon");defineMacro("\\coloncolon","\\dblcolon");defineMacro("\\colonequals","\\coloneqq");defineMacro("\\coloncolonequals","\\Coloneqq");defineMacro("\\equalscolon","\\eqqcolon");defineMacro("\\equalscoloncolon","\\Eqqcolon");defineMacro("\\colonminus","\\coloneq");defineMacro("\\coloncolonminus","\\Coloneq");defineMacro("\\minuscolon","\\eqcolon");defineMacro("\\minuscoloncolon","\\Eqcolon");defineMacro("\\coloncolonapprox","\\Colonapprox");defineMacro("\\coloncolonsim","\\Colonsim");defineMacro("\\simcolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\vcentcolon}");defineMacro("\\simcoloncolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\dblcolon}");defineMacro("\\approxcolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\vcentcolon}");defineMacro("\\approxcoloncolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\dblcolon}");defineMacro("\\notni","\\html@mathml{\\not\\ni}{\\mathrel{\\char`∌}}");defineMacro("\\limsup","\\DOTSB\\operatorname*{lim\\,sup}");defineMacro("\\liminf","\\DOTSB\\operatorname*{lim\\,inf}");defineMacro("\\injlim","\\DOTSB\\operatorname*{inj\\,lim}");defineMacro("\\projlim","\\DOTSB\\operatorname*{proj\\,lim}");defineMacro("\\varlimsup","\\DOTSB\\operatorname*{\\overline{lim}}");defineMacro("\\varliminf","\\DOTSB\\operatorname*{\\underline{lim}}");defineMacro("\\varinjlim","\\DOTSB\\operatorname*{\\underrightarrow{lim}}");defineMacro("\\varprojlim","\\DOTSB\\operatorname*{\\underleftarrow{lim}}");defineMacro("\\gvertneqq","\\html@mathml{\\@gvertneqq}{≩}");defineMacro("\\lvertneqq","\\html@mathml{\\@lvertneqq}{≨}");defineMacro("\\ngeqq","\\html@mathml{\\@ngeqq}{≱}");defineMacro("\\ngeqslant","\\html@mathml{\\@ngeqslant}{≱}");defineMacro("\\nleqq","\\html@mathml{\\@nleqq}{≰}");defineMacro("\\nleqslant","\\html@mathml{\\@nleqslant}{≰}");defineMacro("\\nshortmid","\\html@mathml{\\@nshortmid}{∤}");defineMacro("\\nshortparallel","\\html@mathml{\\@nshortparallel}{∦}");defineMacro("\\nsubseteqq","\\html@mathml{\\@nsubseteqq}{⊈}");defineMacro("\\nsupseteqq","\\html@mathml{\\@nsupseteqq}{⊉}");defineMacro("\\varsubsetneq","\\html@mathml{\\@varsubsetneq}{⊊}");defineMacro("\\varsubsetneqq","\\html@mathml{\\@varsubsetneqq}{⫋}");defineMacro("\\varsupsetneq","\\html@mathml{\\@varsupsetneq}{⊋}");defineMacro("\\varsupsetneqq","\\html@mathml{\\@varsupsetneqq}{⫌}");defineMacro("\\imath","\\html@mathml{\\@imath}{ı}");defineMacro("\\jmath","\\html@mathml{\\@jmath}{ȷ}");defineMacro("\\llbracket","\\html@mathml{\\mathopen{[\\mkern-3.2mu[}}{\\mathopen{\\char`⟦}}");defineMacro("\\rrbracket","\\html@mathml{\\mathclose{]\\mkern-3.2mu]}}{\\mathclose{\\char`⟧}}");defineMacro("⟦","\\llbracket");defineMacro("⟧","\\rrbracket");defineMacro("\\lBrace","\\html@mathml{\\mathopen{\\{\\mkern-3.2mu[}}{\\mathopen{\\char`⦃}}");defineMacro("\\rBrace","\\html@mathml{\\mathclose{]\\mkern-3.2mu\\}}}{\\mathclose{\\char`⦄}}");defineMacro("⦃","\\lBrace");defineMacro("⦄","\\rBrace");defineMacro("\\minuso","\\mathbin{\\html@mathml{{\\mathrlap{\\mathchoice{\\kern{0.145em}}{\\kern{0.145em}}{\\kern{0.1015em}}{\\kern{0.0725em}}\\circ}{-}}}{\\char`⦵}}");defineMacro("⦵","\\minuso");defineMacro("\\darr","\\downarrow");defineMacro("\\dArr","\\Downarrow");defineMacro("\\Darr","\\Downarrow");defineMacro("\\lang","\\langle");defineMacro("\\rang","\\rangle");defineMacro("\\uarr","\\uparrow");defineMacro("\\uArr","\\Uparrow");defineMacro("\\Uarr","\\Uparrow");defineMacro("\\N","\\mathbb{N}");defineMacro("\\R","\\mathbb{R}");defineMacro("\\Z","\\mathbb{Z}");defineMacro("\\alef","\\aleph");defineMacro("\\alefsym","\\aleph");defineMacro("\\Alpha","\\mathrm{A}");defineMacro("\\Beta","\\mathrm{B}");defineMacro("\\bull","\\bullet");defineMacro("\\Chi","\\mathrm{X}");defineMacro("\\clubs","\\clubsuit");defineMacro("\\cnums","\\mathbb{C}");defineMacro("\\Complex","\\mathbb{C}");defineMacro("\\Dagger","\\ddagger");defineMacro("\\diamonds","\\diamondsuit");defineMacro("\\empty","\\emptyset");defineMacro("\\Epsilon","\\mathrm{E}");defineMacro("\\Eta","\\mathrm{H}");defineMacro("\\exist","\\exists");defineMacro("\\harr","\\leftrightarrow");defineMacro("\\hArr","\\Leftrightarrow");defineMacro("\\Harr","\\Leftrightarrow");defineMacro("\\hearts","\\heartsuit");defineMacro("\\image","\\Im");defineMacro("\\infin","\\infty");defineMacro("\\Iota","\\mathrm{I}");defineMacro("\\isin","\\in");defineMacro("\\Kappa","\\mathrm{K}");defineMacro("\\larr","\\leftarrow");defineMacro("\\lArr","\\Leftarrow");defineMacro("\\Larr","\\Leftarrow");defineMacro("\\lrarr","\\leftrightarrow");defineMacro("\\lrArr","\\Leftrightarrow");defineMacro("\\Lrarr","\\Leftrightarrow");defineMacro("\\Mu","\\mathrm{M}");defineMacro("\\natnums","\\mathbb{N}");defineMacro("\\Nu","\\mathrm{N}");defineMacro("\\Omicron","\\mathrm{O}");defineMacro("\\plusmn","\\pm");defineMacro("\\rarr","\\rightarrow");defineMacro("\\rArr","\\Rightarrow");defineMacro("\\Rarr","\\Rightarrow");defineMacro("\\real","\\Re");defineMacro("\\reals","\\mathbb{R}");defineMacro("\\Reals","\\mathbb{R}");defineMacro("\\Rho","\\mathrm{P}");defineMacro("\\sdot","\\cdot");defineMacro("\\sect","\\S");defineMacro("\\spades","\\spadesuit");defineMacro("\\sub","\\subset");defineMacro("\\sube","\\subseteq");defineMacro("\\supe","\\supseteq");defineMacro("\\Tau","\\mathrm{T}");defineMacro("\\thetasym","\\vartheta");defineMacro("\\weierp","\\wp");defineMacro("\\Zeta","\\mathrm{Z}");defineMacro("\\argmin","\\DOTSB\\operatorname*{arg\\,min}");defineMacro("\\argmax","\\DOTSB\\operatorname*{arg\\,max}");defineMacro("\\plim","\\DOTSB\\mathop{\\operatorname{plim}}\\limits");defineMacro("\\bra","\\mathinner{\\langle{#1}|}");defineMacro("\\ket","\\mathinner{|{#1}\\rangle}");defineMacro("\\braket","\\mathinner{\\langle{#1}\\rangle}");defineMacro("\\Bra","\\left\\langle#1\\right|");defineMacro("\\Ket","\\left|#1\\right\\rangle");var braketHelper=e=>a=>{var o=a.consumeArg().tokens,c=a.consumeArg().tokens,d=a.consumeArg().tokens,$=a.consumeArg().tokens,g=a.macros.get("|"),b=a.macros.get("\\|");a.macros.beginGroup();var _=et=>tt=>{e&&(tt.macros.set("|",g),d.length&&tt.macros.set("\\|",b));var nt=et;if(!et&&d.length){var at=tt.future();at.text==="|"&&(tt.popToken(),nt=!0)}return{tokens:nt?d:c,numArgs:0}};a.macros.set("|",_(!1)),d.length&&a.macros.set("\\|",_(!0));var j=a.consumeArg().tokens,_e=a.expandTokens([...$,...j,...o]);return a.macros.endGroup(),{tokens:_e.reverse(),numArgs:0}};defineMacro("\\bra@ket",braketHelper(!1));defineMacro("\\bra@set",braketHelper(!0));defineMacro("\\Braket","\\bra@ket{\\left\\langle}{\\,\\middle\\vert\\,}{\\,\\middle\\vert\\,}{\\right\\rangle}");defineMacro("\\Set","\\bra@set{\\left\\{\\:}{\\;\\middle\\vert\\;}{\\;\\middle\\Vert\\;}{\\:\\right\\}}");defineMacro("\\set","\\bra@set{\\{\\,}{\\mid}{}{\\,\\}}");defineMacro("\\angln","{\\angl n}");defineMacro("\\blue","\\textcolor{##6495ed}{#1}");defineMacro("\\orange","\\textcolor{##ffa500}{#1}");defineMacro("\\pink","\\textcolor{##ff00af}{#1}");defineMacro("\\red","\\textcolor{##df0030}{#1}");defineMacro("\\green","\\textcolor{##28ae7b}{#1}");defineMacro("\\gray","\\textcolor{gray}{#1}");defineMacro("\\purple","\\textcolor{##9d38bd}{#1}");defineMacro("\\blueA","\\textcolor{##ccfaff}{#1}");defineMacro("\\blueB","\\textcolor{##80f6ff}{#1}");defineMacro("\\blueC","\\textcolor{##63d9ea}{#1}");defineMacro("\\blueD","\\textcolor{##11accd}{#1}");defineMacro("\\blueE","\\textcolor{##0c7f99}{#1}");defineMacro("\\tealA","\\textcolor{##94fff5}{#1}");defineMacro("\\tealB","\\textcolor{##26edd5}{#1}");defineMacro("\\tealC","\\textcolor{##01d1c1}{#1}");defineMacro("\\tealD","\\textcolor{##01a995}{#1}");defineMacro("\\tealE","\\textcolor{##208170}{#1}");defineMacro("\\greenA","\\textcolor{##b6ffb0}{#1}");defineMacro("\\greenB","\\textcolor{##8af281}{#1}");defineMacro("\\greenC","\\textcolor{##74cf70}{#1}");defineMacro("\\greenD","\\textcolor{##1fab54}{#1}");defineMacro("\\greenE","\\textcolor{##0d923f}{#1}");defineMacro("\\goldA","\\textcolor{##ffd0a9}{#1}");defineMacro("\\goldB","\\textcolor{##ffbb71}{#1}");defineMacro("\\goldC","\\textcolor{##ff9c39}{#1}");defineMacro("\\goldD","\\textcolor{##e07d10}{#1}");defineMacro("\\goldE","\\textcolor{##a75a05}{#1}");defineMacro("\\redA","\\textcolor{##fca9a9}{#1}");defineMacro("\\redB","\\textcolor{##ff8482}{#1}");defineMacro("\\redC","\\textcolor{##f9685d}{#1}");defineMacro("\\redD","\\textcolor{##e84d39}{#1}");defineMacro("\\redE","\\textcolor{##bc2612}{#1}");defineMacro("\\maroonA","\\textcolor{##ffbde0}{#1}");defineMacro("\\maroonB","\\textcolor{##ff92c6}{#1}");defineMacro("\\maroonC","\\textcolor{##ed5fa6}{#1}");defineMacro("\\maroonD","\\textcolor{##ca337c}{#1}");defineMacro("\\maroonE","\\textcolor{##9e034e}{#1}");defineMacro("\\purpleA","\\textcolor{##ddd7ff}{#1}");defineMacro("\\purpleB","\\textcolor{##c6b9fc}{#1}");defineMacro("\\purpleC","\\textcolor{##aa87ff}{#1}");defineMacro("\\purpleD","\\textcolor{##7854ab}{#1}");defineMacro("\\purpleE","\\textcolor{##543b78}{#1}");defineMacro("\\mintA","\\textcolor{##f5f9e8}{#1}");defineMacro("\\mintB","\\textcolor{##edf2df}{#1}");defineMacro("\\mintC","\\textcolor{##e0e5cc}{#1}");defineMacro("\\grayA","\\textcolor{##f6f7f7}{#1}");defineMacro("\\grayB","\\textcolor{##f0f1f2}{#1}");defineMacro("\\grayC","\\textcolor{##e3e5e6}{#1}");defineMacro("\\grayD","\\textcolor{##d6d8da}{#1}");defineMacro("\\grayE","\\textcolor{##babec2}{#1}");defineMacro("\\grayF","\\textcolor{##888d93}{#1}");defineMacro("\\grayG","\\textcolor{##626569}{#1}");defineMacro("\\grayH","\\textcolor{##3b3e40}{#1}");defineMacro("\\grayI","\\textcolor{##21242c}{#1}");defineMacro("\\kaBlue","\\textcolor{##314453}{#1}");defineMacro("\\kaGreen","\\textcolor{##71B307}{#1}");var implicitCommands={"^":!0,_:!0,"\\limits":!0,"\\nolimits":!0};class MacroExpander{constructor(a,o,c){this.settings=void 0,this.expansionCount=void 0,this.lexer=void 0,this.macros=void 0,this.stack=void 0,this.mode=void 0,this.settings=o,this.expansionCount=0,this.feed(a),this.macros=new Namespace(macros,o.macros),this.mode=c,this.stack=[]}feed(a){this.lexer=new Lexer(a,this.settings)}switchMode(a){this.mode=a}beginGroup(){this.macros.beginGroup()}endGroup(){this.macros.endGroup()}endGroups(){this.macros.endGroups()}future(){return this.stack.length===0&&this.pushToken(this.lexer.lex()),this.stack[this.stack.length-1]}popToken(){return this.future(),this.stack.pop()}pushToken(a){this.stack.push(a)}pushTokens(a){this.stack.push(...a)}scanArgument(a){var o,c,d;if(a){if(this.consumeSpaces(),this.future().text!=="[")return null;o=this.popToken(),{tokens:d,end:c}=this.consumeArg(["]"])}else({tokens:d,start:o,end:c}=this.consumeArg());return this.pushToken(new Token("EOF",c.loc)),this.pushTokens(d),o.range(c,"")}consumeSpaces(){for(;;){var a=this.future();if(a.text===" ")this.stack.pop();else break}}consumeArg(a){var o=[],c=a&&a.length>0;c||this.consumeSpaces();var d=this.future(),$,g=0,b=0;do{if($=this.popToken(),o.push($),$.text==="{")++g;else if($.text==="}"){if(--g,g===-1)throw new ParseError("Extra }",$)}else if($.text==="EOF")throw new ParseError("Unexpected end of input in a macro argument, expected '"+(a&&c?a[b]:"}")+"'",$);if(a&&c)if((g===0||g===1&&a[b]==="{")&&$.text===a[b]){if(++b,b===a.length){o.splice(-b,b);break}}else b=0}while(g!==0||c);return d.text==="{"&&o[o.length-1].text==="}"&&(o.pop(),o.shift()),o.reverse(),{tokens:o,start:d,end:$}}consumeArgs(a,o){if(o){if(o.length!==a+1)throw new ParseError("The length of delimiters doesn't match the number of args!");for(var c=o[0],d=0;d<c.length;d++){var $=this.popToken();if(c[d]!==$.text)throw new ParseError("Use of the macro doesn't match its definition",$)}}for(var g=[],b=0;b<a;b++)g.push(this.consumeArg(o&&o[b+1]).tokens);return g}countExpansion(a){if(this.expansionCount+=a,this.expansionCount>this.settings.maxExpand)throw new ParseError("Too many expansions: infinite loop or need to increase maxExpand setting")}expandOnce(a){var o=this.popToken(),c=o.text,d=o.noexpand?null:this._getExpansion(c);if(d==null||a&&d.unexpandable){if(a&&d==null&&c[0]==="\\"&&!this.isDefined(c))throw new ParseError("Undefined control sequence: "+c);return this.pushToken(o),!1}this.countExpansion(1);var $=d.tokens,g=this.consumeArgs(d.numArgs,d.delimiters);if(d.numArgs){$=$.slice();for(var b=$.length-1;b>=0;--b){var _=$[b];if(_.text==="#"){if(b===0)throw new ParseError("Incomplete placeholder at end of macro body",_);if(_=$[--b],_.text==="#")$.splice(b+1,1);else if(/^[1-9]$/.test(_.text))$.splice(b,2,...g[+_.text-1]);else throw new ParseError("Not a valid argument number",_)}}}return this.pushTokens($),$.length}expandAfterFuture(){return this.expandOnce(),this.future()}expandNextToken(){for(;;)if(this.expandOnce()===!1){var a=this.stack.pop();return a.treatAsRelax&&(a.text="\\relax"),a}throw new Error}expandMacro(a){return this.macros.has(a)?this.expandTokens([new Token(a)]):void 0}expandTokens(a){var o=[],c=this.stack.length;for(this.pushTokens(a);this.stack.length>c;)if(this.expandOnce(!0)===!1){var d=this.stack.pop();d.treatAsRelax&&(d.noexpand=!1,d.treatAsRelax=!1),o.push(d)}return this.countExpansion(o.length),o}expandMacroAsText(a){var o=this.expandMacro(a);return o&&o.map(c=>c.text).join("")}_getExpansion(a){var o=this.macros.get(a);if(o==null)return o;if(a.length===1){var c=this.lexer.catcodes[a];if(c!=null&&c!==13)return}var d=typeof o=="function"?o(this):o;if(typeof d=="string"){var $=0;if(d.indexOf("#")!==-1)for(var g=d.replace(/##/g,"");g.indexOf("#"+($+1))!==-1;)++$;for(var b=new Lexer(d,this.settings),_=[],j=b.lex();j.text!=="EOF";)_.push(j),j=b.lex();_.reverse();var _e={tokens:_,numArgs:$};return _e}return d}isDefined(a){return this.macros.has(a)||functions.hasOwnProperty(a)||symbols.math.hasOwnProperty(a)||symbols.text.hasOwnProperty(a)||implicitCommands.hasOwnProperty(a)}isExpandable(a){var o=this.macros.get(a);return o!=null?typeof o=="string"||typeof o=="function"||!o.unexpandable:functions.hasOwnProperty(a)&&!functions[a].primitive}}var unicodeSubRegEx=/^[₊₋₌₍₎₀₁₂₃₄₅₆₇₈₉ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓᵦᵧᵨᵩᵪ]/,uSubsAndSups=Object.freeze({"₊":"+","₋":"-","₌":"=","₍":"(","₎":")","₀":"0","₁":"1","₂":"2","₃":"3","₄":"4","₅":"5","₆":"6","₇":"7","₈":"8","₉":"9","ₐ":"a","ₑ":"e","ₕ":"h","ᵢ":"i","ⱼ":"j","ₖ":"k","ₗ":"l","ₘ":"m","ₙ":"n","ₒ":"o","ₚ":"p","ᵣ":"r","ₛ":"s","ₜ":"t","ᵤ":"u","ᵥ":"v","ₓ":"x","ᵦ":"β","ᵧ":"γ","ᵨ":"ρ","ᵩ":"ϕ","ᵪ":"χ","⁺":"+","⁻":"-","⁼":"=","⁽":"(","⁾":")","⁰":"0","¹":"1","²":"2","³":"3","⁴":"4","⁵":"5","⁶":"6","⁷":"7","⁸":"8","⁹":"9","ᴬ":"A","ᴮ":"B","ᴰ":"D","ᴱ":"E","ᴳ":"G","ᴴ":"H","ᴵ":"I","ᴶ":"J","ᴷ":"K","ᴸ":"L","ᴹ":"M","ᴺ":"N","ᴼ":"O","ᴾ":"P","ᴿ":"R","ᵀ":"T","ᵁ":"U","ⱽ":"V","ᵂ":"W","ᵃ":"a","ᵇ":"b","ᶜ":"c","ᵈ":"d","ᵉ":"e","ᶠ":"f","ᵍ":"g",ʰ:"h","ⁱ":"i",ʲ:"j","ᵏ":"k",ˡ:"l","ᵐ":"m",ⁿ:"n","ᵒ":"o","ᵖ":"p",ʳ:"r",ˢ:"s","ᵗ":"t","ᵘ":"u","ᵛ":"v",ʷ:"w",ˣ:"x",ʸ:"y","ᶻ":"z","ᵝ":"β","ᵞ":"γ","ᵟ":"δ","ᵠ":"ϕ","ᵡ":"χ","ᶿ":"θ"}),unicodeAccents={"́":{text:"\\'",math:"\\acute"},"̀":{text:"\\`",math:"\\grave"},"̈":{text:'\\"',math:"\\ddot"},"̃":{text:"\\~",math:"\\tilde"},"̄":{text:"\\=",math:"\\bar"},"̆":{text:"\\u",math:"\\breve"},"̌":{text:"\\v",math:"\\check"},"̂":{text:"\\^",math:"\\hat"},"̇":{text:"\\.",math:"\\dot"},"̊":{text:"\\r",math:"\\mathring"},"̋":{text:"\\H"},"̧":{text:"\\c"}},unicodeSymbols={á:"á",à:"à",ä:"ä",ǟ:"ǟ",ã:"ã",ā:"ā",ă:"ă",ắ:"ắ",ằ:"ằ",ẵ:"ẵ",ǎ:"ǎ",â:"â",ấ:"ấ",ầ:"ầ",ẫ:"ẫ",ȧ:"ȧ",ǡ:"ǡ",å:"å",ǻ:"ǻ",ḃ:"ḃ",ć:"ć",ḉ:"ḉ",č:"č",ĉ:"ĉ",ċ:"ċ",ç:"ç",ď:"ď",ḋ:"ḋ",ḑ:"ḑ",é:"é",è:"è",ë:"ë",ẽ:"ẽ",ē:"ē",ḗ:"ḗ",ḕ:"ḕ",ĕ:"ĕ",ḝ:"ḝ",ě:"ě",ê:"ê",ế:"ế",ề:"ề",ễ:"ễ",ė:"ė",ȩ:"ȩ",ḟ:"ḟ",ǵ:"ǵ",ḡ:"ḡ",ğ:"ğ",ǧ:"ǧ",ĝ:"ĝ",ġ:"ġ",ģ:"ģ",ḧ:"ḧ",ȟ:"ȟ",ĥ:"ĥ",ḣ:"ḣ",ḩ:"ḩ",í:"í",ì:"ì",ï:"ï",ḯ:"ḯ",ĩ:"ĩ",ī:"ī",ĭ:"ĭ",ǐ:"ǐ",î:"î",ǰ:"ǰ",ĵ:"ĵ",ḱ:"ḱ",ǩ:"ǩ",ķ:"ķ",ĺ:"ĺ",ľ:"ľ",ļ:"ļ",ḿ:"ḿ",ṁ:"ṁ",ń:"ń",ǹ:"ǹ",ñ:"ñ",ň:"ň",ṅ:"ṅ",ņ:"ņ",ó:"ó",ò:"ò",ö:"ö",ȫ:"ȫ",õ:"õ",ṍ:"ṍ",ṏ:"ṏ",ȭ:"ȭ",ō:"ō",ṓ:"ṓ",ṑ:"ṑ",ŏ:"ŏ",ǒ:"ǒ",ô:"ô",ố:"ố",ồ:"ồ",ỗ:"ỗ",ȯ:"ȯ",ȱ:"ȱ",ő:"ő",ṕ:"ṕ",ṗ:"ṗ",ŕ:"ŕ",ř:"ř",ṙ:"ṙ",ŗ:"ŗ",ś:"ś",ṥ:"ṥ",š:"š",ṧ:"ṧ",ŝ:"ŝ",ṡ:"ṡ",ş:"ş",ẗ:"ẗ",ť:"ť",ṫ:"ṫ",ţ:"ţ",ú:"ú",ù:"ù",ü:"ü",ǘ:"ǘ",ǜ:"ǜ",ǖ:"ǖ",ǚ:"ǚ",ũ:"ũ",ṹ:"ṹ",ū:"ū",ṻ:"ṻ",ŭ:"ŭ",ǔ:"ǔ",û:"û",ů:"ů",ű:"ű",ṽ:"ṽ",ẃ:"ẃ",ẁ:"ẁ",ẅ:"ẅ",ŵ:"ŵ",ẇ:"ẇ",ẘ:"ẘ",ẍ:"ẍ",ẋ:"ẋ",ý:"ý",ỳ:"ỳ",ÿ:"ÿ",ỹ:"ỹ",ȳ:"ȳ",ŷ:"ŷ",ẏ:"ẏ",ẙ:"ẙ",ź:"ź",ž:"ž",ẑ:"ẑ",ż:"ż",Á:"Á",À:"À",Ä:"Ä",Ǟ:"Ǟ",Ã:"Ã",Ā:"Ā",Ă:"Ă",Ắ:"Ắ",Ằ:"Ằ",Ẵ:"Ẵ",Ǎ:"Ǎ",Â:"Â",Ấ:"Ấ",Ầ:"Ầ",Ẫ:"Ẫ",Ȧ:"Ȧ",Ǡ:"Ǡ",Å:"Å",Ǻ:"Ǻ",Ḃ:"Ḃ",Ć:"Ć",Ḉ:"Ḉ",Č:"Č",Ĉ:"Ĉ",Ċ:"Ċ",Ç:"Ç",Ď:"Ď",Ḋ:"Ḋ",Ḑ:"Ḑ",É:"É",È:"È",Ë:"Ë",Ẽ:"Ẽ",Ē:"Ē",Ḗ:"Ḗ",Ḕ:"Ḕ",Ĕ:"Ĕ",Ḝ:"Ḝ",Ě:"Ě",Ê:"Ê",Ế:"Ế",Ề:"Ề",Ễ:"Ễ",Ė:"Ė",Ȩ:"Ȩ",Ḟ:"Ḟ",Ǵ:"Ǵ",Ḡ:"Ḡ",Ğ:"Ğ",Ǧ:"Ǧ",Ĝ:"Ĝ",Ġ:"Ġ",Ģ:"Ģ",Ḧ:"Ḧ",Ȟ:"Ȟ",Ĥ:"Ĥ",Ḣ:"Ḣ",Ḩ:"Ḩ",Í:"Í",Ì:"Ì",Ï:"Ï",Ḯ:"Ḯ",Ĩ:"Ĩ",Ī:"Ī",Ĭ:"Ĭ",Ǐ:"Ǐ",Î:"Î",İ:"İ",Ĵ:"Ĵ",Ḱ:"Ḱ",Ǩ:"Ǩ",Ķ:"Ķ",Ĺ:"Ĺ",Ľ:"Ľ",Ļ:"Ļ",Ḿ:"Ḿ",Ṁ:"Ṁ",Ń:"Ń",Ǹ:"Ǹ",Ñ:"Ñ",Ň:"Ň",Ṅ:"Ṅ",Ņ:"Ņ",Ó:"Ó",Ò:"Ò",Ö:"Ö",Ȫ:"Ȫ",Õ:"Õ",Ṍ:"Ṍ",Ṏ:"Ṏ",Ȭ:"Ȭ",Ō:"Ō",Ṓ:"Ṓ",Ṑ:"Ṑ",Ŏ:"Ŏ",Ǒ:"Ǒ",Ô:"Ô",Ố:"Ố",Ồ:"Ồ",Ỗ:"Ỗ",Ȯ:"Ȯ",Ȱ:"Ȱ",Ő:"Ő",Ṕ:"Ṕ",Ṗ:"Ṗ",Ŕ:"Ŕ",Ř:"Ř",Ṙ:"Ṙ",Ŗ:"Ŗ",Ś:"Ś",Ṥ:"Ṥ",Š:"Š",Ṧ:"Ṧ",Ŝ:"Ŝ",Ṡ:"Ṡ",Ş:"Ş",Ť:"Ť",Ṫ:"Ṫ",Ţ:"Ţ",Ú:"Ú",Ù:"Ù",Ü:"Ü",Ǘ:"Ǘ",Ǜ:"Ǜ",Ǖ:"Ǖ",Ǚ:"Ǚ",Ũ:"Ũ",Ṹ:"Ṹ",Ū:"Ū",Ṻ:"Ṻ",Ŭ:"Ŭ",Ǔ:"Ǔ",Û:"Û",Ů:"Ů",Ű:"Ű",Ṽ:"Ṽ",Ẃ:"Ẃ",Ẁ:"Ẁ",Ẅ:"Ẅ",Ŵ:"Ŵ",Ẇ:"Ẇ",Ẍ:"Ẍ",Ẋ:"Ẋ",Ý:"Ý",Ỳ:"Ỳ",Ÿ:"Ÿ",Ỹ:"Ỹ",Ȳ:"Ȳ",Ŷ:"Ŷ",Ẏ:"Ẏ",Ź:"Ź",Ž:"Ž",Ẑ:"Ẑ",Ż:"Ż",ά:"ά",ὰ:"ὰ",ᾱ:"ᾱ",ᾰ:"ᾰ",έ:"έ",ὲ:"ὲ",ή:"ή",ὴ:"ὴ",ί:"ί",ὶ:"ὶ",ϊ:"ϊ",ΐ:"ΐ",ῒ:"ῒ",ῑ:"ῑ",ῐ:"ῐ",ό:"ό",ὸ:"ὸ",ύ:"ύ",ὺ:"ὺ",ϋ:"ϋ",ΰ:"ΰ",ῢ:"ῢ",ῡ:"ῡ",ῠ:"ῠ",ώ:"ώ",ὼ:"ὼ",Ύ:"Ύ",Ὺ:"Ὺ",Ϋ:"Ϋ",Ῡ:"Ῡ",Ῠ:"Ῠ",Ώ:"Ώ",Ὼ:"Ὼ"};class Parser{constructor(a,o){this.mode=void 0,this.gullet=void 0,this.settings=void 0,this.leftrightDepth=void 0,this.nextToken=void 0,this.mode="math",this.gullet=new MacroExpander(a,o,this.mode),this.settings=o,this.leftrightDepth=0}expect(a,o){if(o===void 0&&(o=!0),this.fetch().text!==a)throw new ParseError("Expected '"+a+"', got '"+this.fetch().text+"'",this.fetch());o&&this.consume()}consume(){this.nextToken=null}fetch(){return this.nextToken==null&&(this.nextToken=this.gullet.expandNextToken()),this.nextToken}switchMode(a){this.mode=a,this.gullet.switchMode(a)}parse(){this.settings.globalGroup||this.gullet.beginGroup(),this.settings.colorIsTextColor&&this.gullet.macros.set("\\color","\\textcolor");try{var a=this.parseExpression(!1);return this.expect("EOF"),this.settings.globalGroup||this.gullet.endGroup(),a}finally{this.gullet.endGroups()}}subparse(a){var o=this.nextToken;this.consume(),this.gullet.pushToken(new Token("}")),this.gullet.pushTokens(a);var c=this.parseExpression(!1);return this.expect("}"),this.nextToken=o,c}parseExpression(a,o){for(var c=[];;){this.mode==="math"&&this.consumeSpaces();var d=this.fetch();if(Parser.endOfExpression.indexOf(d.text)!==-1||o&&d.text===o||a&&functions[d.text]&&functions[d.text].infix)break;var $=this.parseAtom(o);if($){if($.type==="internal")continue}else break;c.push($)}return this.mode==="text"&&this.formLigatures(c),this.handleInfixNodes(c)}handleInfixNodes(a){for(var o=-1,c,d=0;d<a.length;d++)if(a[d].type==="infix"){if(o!==-1)throw new ParseError("only one infix operator per group",a[d].token);o=d,c=a[d].replaceWith}if(o!==-1&&c){var $,g,b=a.slice(0,o),_=a.slice(o+1);b.length===1&&b[0].type==="ordgroup"?$=b[0]:$={type:"ordgroup",mode:this.mode,body:b},_.length===1&&_[0].type==="ordgroup"?g=_[0]:g={type:"ordgroup",mode:this.mode,body:_};var j;return c==="\\\\abovefrac"?j=this.callFunction(c,[$,a[o],g],[]):j=this.callFunction(c,[$,g],[]),[j]}else return a}handleSupSubscript(a){var o=this.fetch(),c=o.text;this.consume(),this.consumeSpaces();var d=this.parseGroup(a);if(!d)throw new ParseError("Expected group after '"+c+"'",o);return d}formatUnsupportedCmd(a){for(var o=[],c=0;c<a.length;c++)o.push({type:"textord",mode:"text",text:a[c]});var d={type:"text",mode:this.mode,body:o},$={type:"color",mode:this.mode,color:this.settings.errorColor,body:[d]};return $}parseAtom(a){var o=this.parseGroup("atom",a);if(this.mode==="text")return o;for(var c,d;;){this.consumeSpaces();var $=this.fetch();if($.text==="\\limits"||$.text==="\\nolimits"){if(o&&o.type==="op"){var g=$.text==="\\limits";o.limits=g,o.alwaysHandleSupSub=!0}else if(o&&o.type==="operatorname")o.alwaysHandleSupSub&&(o.limits=$.text==="\\limits");else throw new ParseError("Limit controls must follow a math operator",$);this.consume()}else if($.text==="^"){if(c)throw new ParseError("Double superscript",$);c=this.handleSupSubscript("superscript")}else if($.text==="_"){if(d)throw new ParseError("Double subscript",$);d=this.handleSupSubscript("subscript")}else if($.text==="'"){if(c)throw new ParseError("Double superscript",$);var b={type:"textord",mode:this.mode,text:"\\prime"},_=[b];for(this.consume();this.fetch().text==="'";)_.push(b),this.consume();this.fetch().text==="^"&&_.push(this.handleSupSubscript("superscript")),c={type:"ordgroup",mode:this.mode,body:_}}else if(uSubsAndSups[$.text]){var j=unicodeSubRegEx.test($.text),_e=[];for(_e.push(new Token(uSubsAndSups[$.text])),this.consume();;){var et=this.fetch().text;if(!uSubsAndSups[et]||unicodeSubRegEx.test(et)!==j)break;_e.unshift(new Token(uSubsAndSups[et])),this.consume()}var tt=this.subparse(_e);j?d={type:"ordgroup",mode:"math",body:tt}:c={type:"ordgroup",mode:"math",body:tt}}else break}return c||d?{type:"supsub",mode:this.mode,base:o,sup:c,sub:d}:o}parseFunction(a,o){var c=this.fetch(),d=c.text,$=functions[d];if(!$)return null;if(this.consume(),o&&o!=="atom"&&!$.allowedInArgument)throw new ParseError("Got function '"+d+"' with no arguments"+(o?" as "+o:""),c);if(this.mode==="text"&&!$.allowedInText)throw new ParseError("Can't use function '"+d+"' in text mode",c);if(this.mode==="math"&&$.allowedInMath===!1)throw new ParseError("Can't use function '"+d+"' in math mode",c);var{args:g,optArgs:b}=this.parseArguments(d,$);return this.callFunction(d,g,b,c,a)}callFunction(a,o,c,d,$){var g={funcName:a,parser:this,token:d,breakOnTokenText:$},b=functions[a];if(b&&b.handler)return b.handler(g,o,c);throw new ParseError("No function handler for "+a)}parseArguments(a,o){var c=o.numArgs+o.numOptionalArgs;if(c===0)return{args:[],optArgs:[]};for(var d=[],$=[],g=0;g<c;g++){var b=o.argTypes&&o.argTypes[g],_=g<o.numOptionalArgs;(o.primitive&&b==null||o.type==="sqrt"&&g===1&&$[0]==null)&&(b="primitive");var j=this.parseGroupOfType("argument to '"+a+"'",b,_);if(_)$.push(j);else if(j!=null)d.push(j);else throw new ParseError("Null argument, please report this as a bug")}return{args:d,optArgs:$}}parseGroupOfType(a,o,c){switch(o){case"color":return this.parseColorGroup(c);case"size":return this.parseSizeGroup(c);case"url":return this.parseUrlGroup(c);case"math":case"text":return this.parseArgumentGroup(c,o);case"hbox":{var d=this.parseArgumentGroup(c,"text");return d!=null?{type:"styling",mode:d.mode,body:[d],style:"text"}:null}case"raw":{var $=this.parseStringGroup("raw",c);return $!=null?{type:"raw",mode:"text",string:$.text}:null}case"primitive":{if(c)throw new ParseError("A primitive argument cannot be optional");var g=this.parseGroup(a);if(g==null)throw new ParseError("Expected group as "+a,this.fetch());return g}case"original":case null:case void 0:return this.parseArgumentGroup(c);default:throw new ParseError("Unknown group type as "+a,this.fetch())}}consumeSpaces(){for(;this.fetch().text===" ";)this.consume()}parseStringGroup(a,o){var c=this.gullet.scanArgument(o);if(c==null)return null;for(var d="",$;($=this.fetch()).text!=="EOF";)d+=$.text,this.consume();return this.consume(),c.text=d,c}parseRegexGroup(a,o){for(var c=this.fetch(),d=c,$="",g;(g=this.fetch()).text!=="EOF"&&a.test($+g.text);)d=g,$+=d.text,this.consume();if($==="")throw new ParseError("Invalid "+o+": '"+c.text+"'",c);return c.range(d,$)}parseColorGroup(a){var o=this.parseStringGroup("color",a);if(o==null)return null;var c=/^(#[a-f0-9]{3}|#?[a-f0-9]{6}|[a-z]+)$/i.exec(o.text);if(!c)throw new ParseError("Invalid color: '"+o.text+"'",o);var d=c[0];return/^[0-9a-f]{6}$/i.test(d)&&(d="#"+d),{type:"color-token",mode:this.mode,color:d}}parseSizeGroup(a){var o,c=!1;if(this.gullet.consumeSpaces(),!a&&this.gullet.future().text!=="{"?o=this.parseRegexGroup(/^[-+]? *(?:$|\d+|\d+\.\d*|\.\d*) *[a-z]{0,2} *$/,"size"):o=this.parseStringGroup("size",a),!o)return null;!a&&o.text.length===0&&(o.text="0pt",c=!0);var d=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(o.text);if(!d)throw new ParseError("Invalid size: '"+o.text+"'",o);var $={number:+(d[1]+d[2]),unit:d[3]};if(!validUnit($))throw new ParseError("Invalid unit: '"+$.unit+"'",o);return{type:"size",mode:this.mode,value:$,isBlank:c}}parseUrlGroup(a){this.gullet.lexer.setCatcode("%",13),this.gullet.lexer.setCatcode("~",12);var o=this.parseStringGroup("url",a);if(this.gullet.lexer.setCatcode("%",14),this.gullet.lexer.setCatcode("~",13),o==null)return null;var c=o.text.replace(/\\([#$%&~_^{}])/g,"$1");return{type:"url",mode:this.mode,url:c}}parseArgumentGroup(a,o){var c=this.gullet.scanArgument(a);if(c==null)return null;var d=this.mode;o&&this.switchMode(o),this.gullet.beginGroup();var $=this.parseExpression(!1,"EOF");this.expect("EOF"),this.gullet.endGroup();var g={type:"ordgroup",mode:this.mode,loc:c.loc,body:$};return o&&this.switchMode(d),g}parseGroup(a,o){var c=this.fetch(),d=c.text,$;if(d==="{"||d==="\\begingroup"){this.consume();var g=d==="{"?"}":"\\endgroup";this.gullet.beginGroup();var b=this.parseExpression(!1,g),_=this.fetch();this.expect(g),this.gullet.endGroup(),$={type:"ordgroup",mode:this.mode,loc:SourceLocation.range(c,_),body:b,semisimple:d==="\\begingroup"||void 0}}else if($=this.parseFunction(o,a)||this.parseSymbol(),$==null&&d[0]==="\\"&&!implicitCommands.hasOwnProperty(d)){if(this.settings.throwOnError)throw new ParseError("Undefined control sequence: "+d,c);$=this.formatUnsupportedCmd(d),this.consume()}return $}formLigatures(a){for(var o=a.length-1,c=0;c<o;++c){var d=a[c],$=d.text;$==="-"&&a[c+1].text==="-"&&(c+1<o&&a[c+2].text==="-"?(a.splice(c,3,{type:"textord",mode:"text",loc:SourceLocation.range(d,a[c+2]),text:"---"}),o-=2):(a.splice(c,2,{type:"textord",mode:"text",loc:SourceLocation.range(d,a[c+1]),text:"--"}),o-=1)),($==="'"||$==="`")&&a[c+1].text===$&&(a.splice(c,2,{type:"textord",mode:"text",loc:SourceLocation.range(d,a[c+1]),text:$+$}),o-=1)}}parseSymbol(){var a=this.fetch(),o=a.text;if(/^\\verb[^a-zA-Z]/.test(o)){this.consume();var c=o.slice(5),d=c.charAt(0)==="*";if(d&&(c=c.slice(1)),c.length<2||c.charAt(0)!==c.slice(-1))throw new ParseError(`\\verb assertion failed --
                    please report what input caused this bug`);return c=c.slice(1,-1),{type:"verb",mode:"text",body:c,star:d}}unicodeSymbols.hasOwnProperty(o[0])&&!symbols[this.mode][o[0]]&&(this.settings.strict&&this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Accented Unicode text character "'+o[0]+'" used in math mode',a),o=unicodeSymbols[o[0]]+o.slice(1));var $=combiningDiacriticalMarksEndRegex.exec(o);$&&(o=o.substring(0,$.index),o==="i"?o="ı":o==="j"&&(o="ȷ"));var g;if(symbols[this.mode][o]){this.settings.strict&&this.mode==="math"&&extraLatin.indexOf(o)>=0&&this.settings.reportNonstrict("unicodeTextInMathMode",'Latin-1/Unicode text character "'+o[0]+'" used in math mode',a);var b=symbols[this.mode][o].group,_=SourceLocation.range(a),j;if(ATOMS.hasOwnProperty(b)){var _e=b;j={type:"atom",mode:this.mode,family:_e,loc:_,text:o}}else j={type:b,mode:this.mode,loc:_,text:o};g=j}else if(o.charCodeAt(0)>=128)this.settings.strict&&(supportedCodepoint(o.charCodeAt(0))?this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Unicode text character "'+o[0]+'" used in math mode',a):this.settings.reportNonstrict("unknownSymbol",'Unrecognized Unicode character "'+o[0]+'"'+(" ("+o.charCodeAt(0)+")"),a)),g={type:"textord",mode:"text",loc:SourceLocation.range(a),text:o};else return null;if(this.consume(),$)for(var et=0;et<$[0].length;et++){var tt=$[0][et];if(!unicodeAccents[tt])throw new ParseError("Unknown accent ' "+tt+"'",a);var nt=unicodeAccents[tt][this.mode]||unicodeAccents[tt].text;if(!nt)throw new ParseError("Accent "+tt+" unsupported in "+this.mode+" mode",a);g={type:"accent",mode:this.mode,loc:SourceLocation.range(a),label:nt,isStretchy:!1,isShifty:!0,base:g}}return g}}Parser.endOfExpression=["}","\\endgroup","\\end","\\right","&"];var parseTree=function e(a,o){if(!(typeof a=="string"||a instanceof String))throw new TypeError("KaTeX can only parse string typed expression");var c=new Parser(a,o);delete c.gullet.macros.current["\\df@tag"];var d=c.parse();if(delete c.gullet.macros.current["\\current@color"],delete c.gullet.macros.current["\\color"],c.gullet.macros.get("\\df@tag")){if(!o.displayMode)throw new ParseError("\\tag works only in display equations");d=[{type:"tag",mode:"text",body:d,tag:c.subparse([new Token("\\df@tag")])}]}return d},render=function e(a,o,c){o.textContent="";var d=renderToDomTree(a,c).toNode();o.appendChild(d)};typeof document<"u"&&document.compatMode!=="CSS1Compat"&&(typeof console<"u"&&console.warn("Warning: KaTeX doesn't work in quirks mode. Make sure your website has a suitable doctype."),render=function(){throw new ParseError("KaTeX doesn't work in quirks mode.")});var renderToString=function e(a,o){var c=renderToDomTree(a,o).toMarkup();return c},generateParseTree=function e(a,o){var c=new Settings(o);return parseTree(a,c)},renderError=function e(a,o,c){if(c.throwOnError||!(a instanceof ParseError))throw a;var d=buildCommon.makeSpan(["katex-error"],[new SymbolNode(o)]);return d.setAttribute("title",a.toString()),d.setAttribute("style","color:"+c.errorColor),d},renderToDomTree=function e(a,o){var c=new Settings(o);try{var d=parseTree(a,c);return buildTree(d,a,c)}catch($){return renderError($,a,c)}},renderToHTMLTree=function e(a,o){var c=new Settings(o);try{var d=parseTree(a,c);return buildHTMLTree(d,a,c)}catch($){return renderError($,a,c)}},katex={version:"0.16.15",render,renderToString,ParseError,SETTINGS_SCHEMA,__parse:generateParseTree,__renderToDomTree:renderToDomTree,__renderToHTMLTree:renderToHTMLTree,__setFontMetrics:setFontMetrics,__defineSymbol:defineSymbol,__defineFunction:defineFunction,__defineMacro:defineMacro,__domTree:{Span,Anchor,SymbolNode,SvgNode,PathNode,LineNode}};const emptyOptions$2={};function remarkMath(e){const a=this,o=e||emptyOptions$2,c=a.data(),d=c.micromarkExtensions||(c.micromarkExtensions=[]),$=c.fromMarkdownExtensions||(c.fromMarkdownExtensions=[]),g=c.toMarkdownExtensions||(c.toMarkdownExtensions=[]);d.push(math$1(o)),$.push(mathFromMarkdown()),g.push(mathToMarkdown(o))}const regex=/[\0-\x1F!-,\.\/:-@\[-\^`\{-\xA9\xAB-\xB4\xB6-\xB9\xBB-\xBF\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u0378\u0379\u037E\u0380-\u0385\u0387\u038B\u038D\u03A2\u03F6\u0482\u0530\u0557\u0558\u055A-\u055F\u0589-\u0590\u05BE\u05C0\u05C3\u05C6\u05C8-\u05CF\u05EB-\u05EE\u05F3-\u060F\u061B-\u061F\u066A-\u066D\u06D4\u06DD\u06DE\u06E9\u06FD\u06FE\u0700-\u070F\u074B\u074C\u07B2-\u07BF\u07F6-\u07F9\u07FB\u07FC\u07FE\u07FF\u082E-\u083F\u085C-\u085F\u086B-\u089F\u08B5\u08C8-\u08D2\u08E2\u0964\u0965\u0970\u0984\u098D\u098E\u0991\u0992\u09A9\u09B1\u09B3-\u09B5\u09BA\u09BB\u09C5\u09C6\u09C9\u09CA\u09CF-\u09D6\u09D8-\u09DB\u09DE\u09E4\u09E5\u09F2-\u09FB\u09FD\u09FF\u0A00\u0A04\u0A0B-\u0A0E\u0A11\u0A12\u0A29\u0A31\u0A34\u0A37\u0A3A\u0A3B\u0A3D\u0A43-\u0A46\u0A49\u0A4A\u0A4E-\u0A50\u0A52-\u0A58\u0A5D\u0A5F-\u0A65\u0A76-\u0A80\u0A84\u0A8E\u0A92\u0AA9\u0AB1\u0AB4\u0ABA\u0ABB\u0AC6\u0ACA\u0ACE\u0ACF\u0AD1-\u0ADF\u0AE4\u0AE5\u0AF0-\u0AF8\u0B00\u0B04\u0B0D\u0B0E\u0B11\u0B12\u0B29\u0B31\u0B34\u0B3A\u0B3B\u0B45\u0B46\u0B49\u0B4A\u0B4E-\u0B54\u0B58-\u0B5B\u0B5E\u0B64\u0B65\u0B70\u0B72-\u0B81\u0B84\u0B8B-\u0B8D\u0B91\u0B96-\u0B98\u0B9B\u0B9D\u0BA0-\u0BA2\u0BA5-\u0BA7\u0BAB-\u0BAD\u0BBA-\u0BBD\u0BC3-\u0BC5\u0BC9\u0BCE\u0BCF\u0BD1-\u0BD6\u0BD8-\u0BE5\u0BF0-\u0BFF\u0C0D\u0C11\u0C29\u0C3A-\u0C3C\u0C45\u0C49\u0C4E-\u0C54\u0C57\u0C5B-\u0C5F\u0C64\u0C65\u0C70-\u0C7F\u0C84\u0C8D\u0C91\u0CA9\u0CB4\u0CBA\u0CBB\u0CC5\u0CC9\u0CCE-\u0CD4\u0CD7-\u0CDD\u0CDF\u0CE4\u0CE5\u0CF0\u0CF3-\u0CFF\u0D0D\u0D11\u0D45\u0D49\u0D4F-\u0D53\u0D58-\u0D5E\u0D64\u0D65\u0D70-\u0D79\u0D80\u0D84\u0D97-\u0D99\u0DB2\u0DBC\u0DBE\u0DBF\u0DC7-\u0DC9\u0DCB-\u0DCE\u0DD5\u0DD7\u0DE0-\u0DE5\u0DF0\u0DF1\u0DF4-\u0E00\u0E3B-\u0E3F\u0E4F\u0E5A-\u0E80\u0E83\u0E85\u0E8B\u0EA4\u0EA6\u0EBE\u0EBF\u0EC5\u0EC7\u0ECE\u0ECF\u0EDA\u0EDB\u0EE0-\u0EFF\u0F01-\u0F17\u0F1A-\u0F1F\u0F2A-\u0F34\u0F36\u0F38\u0F3A-\u0F3D\u0F48\u0F6D-\u0F70\u0F85\u0F98\u0FBD-\u0FC5\u0FC7-\u0FFF\u104A-\u104F\u109E\u109F\u10C6\u10C8-\u10CC\u10CE\u10CF\u10FB\u1249\u124E\u124F\u1257\u1259\u125E\u125F\u1289\u128E\u128F\u12B1\u12B6\u12B7\u12BF\u12C1\u12C6\u12C7\u12D7\u1311\u1316\u1317\u135B\u135C\u1360-\u137F\u1390-\u139F\u13F6\u13F7\u13FE-\u1400\u166D\u166E\u1680\u169B-\u169F\u16EB-\u16ED\u16F9-\u16FF\u170D\u1715-\u171F\u1735-\u173F\u1754-\u175F\u176D\u1771\u1774-\u177F\u17D4-\u17D6\u17D8-\u17DB\u17DE\u17DF\u17EA-\u180A\u180E\u180F\u181A-\u181F\u1879-\u187F\u18AB-\u18AF\u18F6-\u18FF\u191F\u192C-\u192F\u193C-\u1945\u196E\u196F\u1975-\u197F\u19AC-\u19AF\u19CA-\u19CF\u19DA-\u19FF\u1A1C-\u1A1F\u1A5F\u1A7D\u1A7E\u1A8A-\u1A8F\u1A9A-\u1AA6\u1AA8-\u1AAF\u1AC1-\u1AFF\u1B4C-\u1B4F\u1B5A-\u1B6A\u1B74-\u1B7F\u1BF4-\u1BFF\u1C38-\u1C3F\u1C4A-\u1C4C\u1C7E\u1C7F\u1C89-\u1C8F\u1CBB\u1CBC\u1CC0-\u1CCF\u1CD3\u1CFB-\u1CFF\u1DFA\u1F16\u1F17\u1F1E\u1F1F\u1F46\u1F47\u1F4E\u1F4F\u1F58\u1F5A\u1F5C\u1F5E\u1F7E\u1F7F\u1FB5\u1FBD\u1FBF-\u1FC1\u1FC5\u1FCD-\u1FCF\u1FD4\u1FD5\u1FDC-\u1FDF\u1FED-\u1FF1\u1FF5\u1FFD-\u203E\u2041-\u2053\u2055-\u2070\u2072-\u207E\u2080-\u208F\u209D-\u20CF\u20F1-\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u2140-\u2144\u214A-\u214D\u214F-\u215F\u2189-\u24B5\u24EA-\u2BFF\u2C2F\u2C5F\u2CE5-\u2CEA\u2CF4-\u2CFF\u2D26\u2D28-\u2D2C\u2D2E\u2D2F\u2D68-\u2D6E\u2D70-\u2D7E\u2D97-\u2D9F\u2DA7\u2DAF\u2DB7\u2DBF\u2DC7\u2DCF\u2DD7\u2DDF\u2E00-\u2E2E\u2E30-\u3004\u3008-\u3020\u3030\u3036\u3037\u303D-\u3040\u3097\u3098\u309B\u309C\u30A0\u30FB\u3100-\u3104\u3130\u318F-\u319F\u31C0-\u31EF\u3200-\u33FF\u4DC0-\u4DFF\u9FFD-\u9FFF\uA48D-\uA4CF\uA4FE\uA4FF\uA60D-\uA60F\uA62C-\uA63F\uA673\uA67E\uA6F2-\uA716\uA720\uA721\uA789\uA78A\uA7C0\uA7C1\uA7CB-\uA7F4\uA828-\uA82B\uA82D-\uA83F\uA874-\uA87F\uA8C6-\uA8CF\uA8DA-\uA8DF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA954-\uA95F\uA97D-\uA97F\uA9C1-\uA9CE\uA9DA-\uA9DF\uA9FF\uAA37-\uAA3F\uAA4E\uAA4F\uAA5A-\uAA5F\uAA77-\uAA79\uAAC3-\uAADA\uAADE\uAADF\uAAF0\uAAF1\uAAF7-\uAB00\uAB07\uAB08\uAB0F\uAB10\uAB17-\uAB1F\uAB27\uAB2F\uAB5B\uAB6A-\uAB6F\uABEB\uABEE\uABEF\uABFA-\uABFF\uD7A4-\uD7AF\uD7C7-\uD7CA\uD7FC-\uD7FF\uE000-\uF8FF\uFA6E\uFA6F\uFADA-\uFAFF\uFB07-\uFB12\uFB18-\uFB1C\uFB29\uFB37\uFB3D\uFB3F\uFB42\uFB45\uFBB2-\uFBD2\uFD3E-\uFD4F\uFD90\uFD91\uFDC8-\uFDEF\uFDFC-\uFDFF\uFE10-\uFE1F\uFE30-\uFE32\uFE35-\uFE4C\uFE50-\uFE6F\uFE75\uFEFD-\uFF0F\uFF1A-\uFF20\uFF3B-\uFF3E\uFF40\uFF5B-\uFF65\uFFBF-\uFFC1\uFFC8\uFFC9\uFFD0\uFFD1\uFFD8\uFFD9\uFFDD-\uFFFF]|\uD800[\uDC0C\uDC27\uDC3B\uDC3E\uDC4E\uDC4F\uDC5E-\uDC7F\uDCFB-\uDD3F\uDD75-\uDDFC\uDDFE-\uDE7F\uDE9D-\uDE9F\uDED1-\uDEDF\uDEE1-\uDEFF\uDF20-\uDF2C\uDF4B-\uDF4F\uDF7B-\uDF7F\uDF9E\uDF9F\uDFC4-\uDFC7\uDFD0\uDFD6-\uDFFF]|\uD801[\uDC9E\uDC9F\uDCAA-\uDCAF\uDCD4-\uDCD7\uDCFC-\uDCFF\uDD28-\uDD2F\uDD64-\uDDFF\uDF37-\uDF3F\uDF56-\uDF5F\uDF68-\uDFFF]|\uD802[\uDC06\uDC07\uDC09\uDC36\uDC39-\uDC3B\uDC3D\uDC3E\uDC56-\uDC5F\uDC77-\uDC7F\uDC9F-\uDCDF\uDCF3\uDCF6-\uDCFF\uDD16-\uDD1F\uDD3A-\uDD7F\uDDB8-\uDDBD\uDDC0-\uDDFF\uDE04\uDE07-\uDE0B\uDE14\uDE18\uDE36\uDE37\uDE3B-\uDE3E\uDE40-\uDE5F\uDE7D-\uDE7F\uDE9D-\uDEBF\uDEC8\uDEE7-\uDEFF\uDF36-\uDF3F\uDF56-\uDF5F\uDF73-\uDF7F\uDF92-\uDFFF]|\uD803[\uDC49-\uDC7F\uDCB3-\uDCBF\uDCF3-\uDCFF\uDD28-\uDD2F\uDD3A-\uDE7F\uDEAA\uDEAD-\uDEAF\uDEB2-\uDEFF\uDF1D-\uDF26\uDF28-\uDF2F\uDF51-\uDFAF\uDFC5-\uDFDF\uDFF7-\uDFFF]|\uD804[\uDC47-\uDC65\uDC70-\uDC7E\uDCBB-\uDCCF\uDCE9-\uDCEF\uDCFA-\uDCFF\uDD35\uDD40-\uDD43\uDD48-\uDD4F\uDD74\uDD75\uDD77-\uDD7F\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDFF\uDE12\uDE38-\uDE3D\uDE3F-\uDE7F\uDE87\uDE89\uDE8E\uDE9E\uDEA9-\uDEAF\uDEEB-\uDEEF\uDEFA-\uDEFF\uDF04\uDF0D\uDF0E\uDF11\uDF12\uDF29\uDF31\uDF34\uDF3A\uDF45\uDF46\uDF49\uDF4A\uDF4E\uDF4F\uDF51-\uDF56\uDF58-\uDF5C\uDF64\uDF65\uDF6D-\uDF6F\uDF75-\uDFFF]|\uD805[\uDC4B-\uDC4F\uDC5A-\uDC5D\uDC62-\uDC7F\uDCC6\uDCC8-\uDCCF\uDCDA-\uDD7F\uDDB6\uDDB7\uDDC1-\uDDD7\uDDDE-\uDDFF\uDE41-\uDE43\uDE45-\uDE4F\uDE5A-\uDE7F\uDEB9-\uDEBF\uDECA-\uDEFF\uDF1B\uDF1C\uDF2C-\uDF2F\uDF3A-\uDFFF]|\uD806[\uDC3B-\uDC9F\uDCEA-\uDCFE\uDD07\uDD08\uDD0A\uDD0B\uDD14\uDD17\uDD36\uDD39\uDD3A\uDD44-\uDD4F\uDD5A-\uDD9F\uDDA8\uDDA9\uDDD8\uDDD9\uDDE2\uDDE5-\uDDFF\uDE3F-\uDE46\uDE48-\uDE4F\uDE9A-\uDE9C\uDE9E-\uDEBF\uDEF9-\uDFFF]|\uD807[\uDC09\uDC37\uDC41-\uDC4F\uDC5A-\uDC71\uDC90\uDC91\uDCA8\uDCB7-\uDCFF\uDD07\uDD0A\uDD37-\uDD39\uDD3B\uDD3E\uDD48-\uDD4F\uDD5A-\uDD5F\uDD66\uDD69\uDD8F\uDD92\uDD99-\uDD9F\uDDAA-\uDEDF\uDEF7-\uDFAF\uDFB1-\uDFFF]|\uD808[\uDF9A-\uDFFF]|\uD809[\uDC6F-\uDC7F\uDD44-\uDFFF]|[\uD80A\uD80B\uD80E-\uD810\uD812-\uD819\uD824-\uD82B\uD82D\uD82E\uD830-\uD833\uD837\uD839\uD83D\uD83F\uD87B-\uD87D\uD87F\uD885-\uDB3F\uDB41-\uDBFF][\uDC00-\uDFFF]|\uD80D[\uDC2F-\uDFFF]|\uD811[\uDE47-\uDFFF]|\uD81A[\uDE39-\uDE3F\uDE5F\uDE6A-\uDECF\uDEEE\uDEEF\uDEF5-\uDEFF\uDF37-\uDF3F\uDF44-\uDF4F\uDF5A-\uDF62\uDF78-\uDF7C\uDF90-\uDFFF]|\uD81B[\uDC00-\uDE3F\uDE80-\uDEFF\uDF4B-\uDF4E\uDF88-\uDF8E\uDFA0-\uDFDF\uDFE2\uDFE5-\uDFEF\uDFF2-\uDFFF]|\uD821[\uDFF8-\uDFFF]|\uD823[\uDCD6-\uDCFF\uDD09-\uDFFF]|\uD82C[\uDD1F-\uDD4F\uDD53-\uDD63\uDD68-\uDD6F\uDEFC-\uDFFF]|\uD82F[\uDC6B-\uDC6F\uDC7D-\uDC7F\uDC89-\uDC8F\uDC9A-\uDC9C\uDC9F-\uDFFF]|\uD834[\uDC00-\uDD64\uDD6A-\uDD6C\uDD73-\uDD7A\uDD83\uDD84\uDD8C-\uDDA9\uDDAE-\uDE41\uDE45-\uDFFF]|\uD835[\uDC55\uDC9D\uDCA0\uDCA1\uDCA3\uDCA4\uDCA7\uDCA8\uDCAD\uDCBA\uDCBC\uDCC4\uDD06\uDD0B\uDD0C\uDD15\uDD1D\uDD3A\uDD3F\uDD45\uDD47-\uDD49\uDD51\uDEA6\uDEA7\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3\uDFCC\uDFCD]|\uD836[\uDC00-\uDDFF\uDE37-\uDE3A\uDE6D-\uDE74\uDE76-\uDE83\uDE85-\uDE9A\uDEA0\uDEB0-\uDFFF]|\uD838[\uDC07\uDC19\uDC1A\uDC22\uDC25\uDC2B-\uDCFF\uDD2D-\uDD2F\uDD3E\uDD3F\uDD4A-\uDD4D\uDD4F-\uDEBF\uDEFA-\uDFFF]|\uD83A[\uDCC5-\uDCCF\uDCD7-\uDCFF\uDD4C-\uDD4F\uDD5A-\uDFFF]|\uD83B[\uDC00-\uDDFF\uDE04\uDE20\uDE23\uDE25\uDE26\uDE28\uDE33\uDE38\uDE3A\uDE3C-\uDE41\uDE43-\uDE46\uDE48\uDE4A\uDE4C\uDE50\uDE53\uDE55\uDE56\uDE58\uDE5A\uDE5C\uDE5E\uDE60\uDE63\uDE65\uDE66\uDE6B\uDE73\uDE78\uDE7D\uDE7F\uDE8A\uDE9C-\uDEA0\uDEA4\uDEAA\uDEBC-\uDFFF]|\uD83C[\uDC00-\uDD2F\uDD4A-\uDD4F\uDD6A-\uDD6F\uDD8A-\uDFFF]|\uD83E[\uDC00-\uDFEF\uDFFA-\uDFFF]|\uD869[\uDEDE-\uDEFF]|\uD86D[\uDF35-\uDF3F]|\uD86E[\uDC1E\uDC1F]|\uD873[\uDEA2-\uDEAF]|\uD87A[\uDFE1-\uDFFF]|\uD87E[\uDE1E-\uDFFF]|\uD884[\uDF4B-\uDFFF]|\uDB40[\uDC00-\uDCFF\uDDF0-\uDFFF]/g,own$1=Object.hasOwnProperty;class BananaSlug{constructor(){this.occurrences,this.reset()}slug(a,o){const c=this;let d=slug(a,o===!0);const $=d;for(;own$1.call(c.occurrences,d);)c.occurrences[$]++,d=$+"-"+c.occurrences[$];return c.occurrences[d]=0,d}reset(){this.occurrences=Object.create(null)}}function slug(e,a){return typeof e!="string"?"":(a||(e=e.toLowerCase()),e.replace(regex,"").replace(/ /g,"-"))}function headingRank(e){const a=e.type==="element"?e.tagName.toLowerCase():"",o=a.length===2&&a.charCodeAt(0)===104?a.charCodeAt(1):0;return o>48&&o<55?o-48:void 0}function toString(e){return"children"in e?all$1(e):"value"in e?e.value:""}function one$1(e){return e.type==="text"?e.value:"children"in e?all$1(e):""}function all$1(e){let a=-1;const o=[];for(;++a<e.children.length;)o[a]=one$1(e.children[a]);return o.join("")}const emptyOptions$1={},slugs=new BananaSlug;function rehypeSlug(e){const o=(e||emptyOptions$1).prefix||"";return function(c){slugs.reset(),visit(c,"element",function(d){headingRank(d)&&!d.properties.id&&(d.properties.id=o+slugs.slug(toString(d)))})}}const search=/[#.]/g;function parseSelector(e,a){const o=e||"",c={};let d=0,$,g;for(;d<o.length;){search.lastIndex=d;const b=search.exec(o),_=o.slice(d,b?b.index:o.length);_&&($?$==="#"?c.id=_:Array.isArray(c.className)?c.className.push(_):c.className=[_]:g=_,d+=_.length),b&&($=b[0],d++)}return{type:"element",tagName:g||a||"div",properties:c,children:[]}}const own={}.hasOwnProperty;function createH(e,a,o){const c=o&&createAdjustMap(o);function d($,g,...b){let _=-1,j;if($==null){j={type:"root",children:[]};const _e=g;b.unshift(_e)}else if(j=parseSelector($,a),j.tagName=j.tagName.toLowerCase(),c&&own.call(c,j.tagName)&&(j.tagName=c[j.tagName]),isChild(g))b.unshift(g);else{let _e;for(_e in g)own.call(g,_e)&&addProperty(e,j.properties,_e,g[_e])}for(;++_<b.length;)addChild(j.children,b[_]);return j.type==="element"&&j.tagName==="template"&&(j.content={type:"root",children:j.children},j.children=[]),j}return d}function isChild(e){if(e===null||typeof e!="object"||Array.isArray(e))return!0;if(typeof e.type!="string")return!1;const a=e,o=Object.keys(e);for(const c of o){const d=a[c];if(d&&typeof d=="object"){if(!Array.isArray(d))return!0;const $=d;for(const g of $)if(typeof g!="number"&&typeof g!="string")return!0}}return!!("children"in e&&Array.isArray(e.children))}function addProperty(e,a,o,c){const d=find(e,o);let $=-1,g;if(c!=null){if(typeof c=="number"){if(Number.isNaN(c))return;g=c}else typeof c=="boolean"?g=c:typeof c=="string"?d.spaceSeparated?g=parse$1(c):d.commaSeparated?g=parse$2(c):d.commaOrSpaceSeparated?g=parse$1(parse$2(c).join(" ")):g=parsePrimitive(d,d.property,c):Array.isArray(c)?g=c.concat():g=d.property==="style"?style(c):String(c);if(Array.isArray(g)){const b=[];for(;++$<g.length;){const _=parsePrimitive(d,d.property,g[$]);b[$]=_}g=b}if(d.property==="className"&&Array.isArray(a.className)){const b=g;g=a.className.concat(b)}a[d.property]=g}}function addChild(e,a){let o=-1;if(a!=null)if(typeof a=="string"||typeof a=="number")e.push({type:"text",value:String(a)});else if(Array.isArray(a))for(;++o<a.length;)addChild(e,a[o]);else if(typeof a=="object"&&"type"in a)a.type==="root"?addChild(e,a.children):e.push(a);else throw new Error("Expected node, nodes, or string, got `"+a+"`")}function parsePrimitive(e,a,o){if(typeof o=="string"){if(e.number&&o&&!Number.isNaN(Number(o)))return Number(o);if((e.boolean||e.overloadedBoolean)&&(o===""||normalize$1(o)===normalize$1(a)))return!0}return o}function style(e){const a=[];let o;for(o in e)own.call(e,o)&&a.push([o,e[o]].join(": "));return a.join("; ")}function createAdjustMap(e){const a={};let o=-1;for(;++o<e.length;)a[e[o].toLowerCase()]=e[o];return a}const svgCaseSensitiveTagNames=["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","solidColor","textArea","textPath"],h=createH(html$1,"div"),s=createH(svg,"g",svgCaseSensitiveTagNames),webNamespaces={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function fromDom(e,a){return transform(e,{})||{type:"root",children:[]}}function transform(e,a){const o=one(e,a);return o&&a.afterTransform&&a.afterTransform(e,o),o}function one(e,a){switch(e.nodeType){case 1:return element$1(e,a);case 3:return text(e);case 8:return comment(e);case 9:return root(e,a);case 10:return doctype();case 11:return root(e,a);default:return}}function root(e,a){return{type:"root",children:all(e,a)}}function doctype(){return{type:"doctype"}}function text(e){return{type:"text",value:e.nodeValue||""}}function comment(e){return{type:"comment",value:e.nodeValue||""}}function element$1(e,a){const o=e.namespaceURI,c=o===webNamespaces.svg?s:h,d=o===webNamespaces.html?e.tagName.toLowerCase():e.tagName,$=o===webNamespaces.html&&d==="template"?e.content:e,g=e.getAttributeNames(),b={};let _=-1;for(;++_<g.length;)b[g[_]]=e.getAttribute(g[_])||"";return c(d,b,all($,a))}function all(e,a){const o=e.childNodes,c=[];let d=-1;for(;++d<o.length;){const $=transform(o[d],a);$!==void 0&&c.push($)}return c}new DOMParser;function fromHtmlIsomorphic(e,a){const o=parseFragment(e);return fromDom(o)}function parseFragment(e){const a=document.createElement("template");return a.innerHTML=e,a.content}const findAfter=function(e,a,o){const c=convert(o);if(!e||!e.type||!e.children)throw new Error("Expected parent node");if(typeof a=="number"){if(a<0||a===Number.POSITIVE_INFINITY)throw new Error("Expected positive finite number as index")}else if(a=e.children.indexOf(a),a<0)throw new Error("Expected child node or index");for(;++a<e.children.length;)if(c(e.children[a],a,e))return e.children[a]},convertElement=function(e){if(e==null)return element;if(typeof e=="string")return tagNameFactory(e);if(typeof e=="object")return anyFactory(e);if(typeof e=="function")return castFactory(e);throw new Error("Expected function, string, or array as `test`")};function anyFactory(e){const a=[];let o=-1;for(;++o<e.length;)a[o]=convertElement(e[o]);return castFactory(c);function c(...d){let $=-1;for(;++$<a.length;)if(a[$].apply(this,d))return!0;return!1}}function tagNameFactory(e){return castFactory(a);function a(o){return o.tagName===e}}function castFactory(e){return a;function a(o,c,d){return!!(looksLikeAnElement(o)&&e.call(this,o,typeof c=="number"?c:void 0,d||void 0))}}function element(e){return!!(e&&typeof e=="object"&&"type"in e&&e.type==="element"&&"tagName"in e&&typeof e.tagName=="string")}function looksLikeAnElement(e){return e!==null&&typeof e=="object"&&"type"in e&&"tagName"in e}const searchLineFeeds=/\n/g,searchTabOrSpaces=/[\t ]+/g,br=convertElement("br"),cell=convertElement(isCell),p=convertElement("p"),row=convertElement("tr"),notRendered=convertElement(["datalist","head","noembed","noframes","noscript","rp","script","style","template","title",hidden,closedDialog]),blockOrCaption=convertElement(["address","article","aside","blockquote","body","caption","center","dd","dialog","dir","dl","dt","div","figure","figcaption","footer","form,","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","legend","li","listing","main","menu","nav","ol","p","plaintext","pre","section","ul","xmp"]);function toText(e,a){const o=a||{},c="children"in e?e.children:[],d=blockOrCaption(e),$=inferWhitespace(e,{whitespace:o.whitespace||"normal",breakBefore:!1,breakAfter:!1}),g=[];(e.type==="text"||e.type==="comment")&&g.push(...collectText(e,{whitespace:$,breakBefore:!0,breakAfter:!0}));let b=-1;for(;++b<c.length;)g.push(...renderedTextCollection(c[b],e,{whitespace:$,breakBefore:b?void 0:d,breakAfter:b<c.length-1?br(c[b+1]):d}));const _=[];let j;for(b=-1;++b<g.length;){const _e=g[b];typeof _e=="number"?j!==void 0&&_e>j&&(j=_e):_e&&(j!==void 0&&j>-1&&_.push(`
`.repeat(j)||" "),j=-1,_.push(_e))}return _.join("")}function renderedTextCollection(e,a,o){return e.type==="element"?collectElement(e,a,o):e.type==="text"?o.whitespace==="normal"?collectText(e,o):collectPreText(e):[]}function collectElement(e,a,o){const c=inferWhitespace(e,o),d=e.children||[];let $=-1,g=[];if(notRendered(e))return g;let b,_;for(br(e)||row(e)&&findAfter(a,e,row)?_=`
`:p(e)?(b=2,_=2):blockOrCaption(e)&&(b=1,_=1);++$<d.length;)g=g.concat(renderedTextCollection(d[$],e,{whitespace:c,breakBefore:$?void 0:b,breakAfter:$<d.length-1?br(d[$+1]):_}));return cell(e)&&findAfter(a,e,cell)&&g.push("	"),b&&g.unshift(b),_&&g.push(_),g}function collectText(e,a){const o=String(e.value),c=[],d=[];let $=0;for(;$<=o.length;){searchLineFeeds.lastIndex=$;const _=searchLineFeeds.exec(o),j=_&&"index"in _?_.index:o.length;c.push(trimAndCollapseSpacesAndTabs(o.slice($,j).replace(/[\u061C\u200E\u200F\u202A-\u202E\u2066-\u2069]/g,""),$===0?a.breakBefore:!0,j===o.length?a.breakAfter:!0)),$=j+1}let g=-1,b;for(;++g<c.length;)c[g].charCodeAt(c[g].length-1)===8203||g<c.length-1&&c[g+1].charCodeAt(0)===8203?(d.push(c[g]),b=void 0):c[g]?(typeof b=="number"&&d.push(b),d.push(c[g]),b=0):(g===0||g===c.length-1)&&d.push(0);return d}function collectPreText(e){return[String(e.value)]}function trimAndCollapseSpacesAndTabs(e,a,o){const c=[];let d=0,$;for(;d<e.length;){searchTabOrSpaces.lastIndex=d;const g=searchTabOrSpaces.exec(e);$=g?g.index:e.length,!d&&!$&&g&&!a&&c.push(""),d!==$&&c.push(e.slice(d,$)),d=g?$+g[0].length:$}return d!==$&&!o&&c.push(""),c.join(" ")}function inferWhitespace(e,a){if(e.type==="element"){const o=e.properties||{};switch(e.tagName){case"listing":case"plaintext":case"xmp":return"pre";case"nobr":return"nowrap";case"pre":return o.wrap?"pre-wrap":"pre";case"td":case"th":return o.noWrap?"nowrap":a.whitespace;case"textarea":return"pre-wrap"}}return a.whitespace}function hidden(e){return!!(e.properties||{}).hidden}function isCell(e){return e.tagName==="td"||e.tagName==="th"}function closedDialog(e){return e.tagName==="dialog"&&!(e.properties||{}).open}const emptyOptions={},emptyClasses=[];function rehypeKatex(e){const a=e||emptyOptions;return function(o,c){visitParents(o,"element",function(d,$){const g=Array.isArray(d.properties.className)?d.properties.className:emptyClasses,b=g.includes("language-math"),_=g.includes("math-display"),j=g.includes("math-inline");let _e=_;if(!b&&!_&&!j)return;let et=$[$.length-1],tt=d;if(d.tagName==="code"&&b&&et&&et.type==="element"&&et.tagName==="pre"&&(tt=et,et=$[$.length-2],_e=!0),!et)return;const nt=toText(tt,{whitespace:"pre"});let at;try{at=katex.renderToString(nt,{...a,displayMode:_e,throwOnError:!0})}catch(mt){const ot=mt,st=ot.name.toLowerCase();c.message("Could not render math with KaTeX",{ancestors:[...$,d],cause:ot,place:d.position,ruleId:st,source:"rehype-katex"});try{at=katex.renderToString(nt,{...a,displayMode:_e,strict:"ignore",throwOnError:!1})}catch{at=[{type:"element",tagName:"span",properties:{className:["katex-error"],style:"color:"+(a.errorColor||"#cc0000"),title:String(mt)},children:[{type:"text",value:nt}]}]}}typeof at=="string"&&(at=fromHtmlIsomorphic(at).children);const lt=et.children.indexOf(tt);return et.children.splice(lt,1,...at),SKIP})}}const TableOfContents=({content:e,isOpen:a,setIsOpen:o,isMobile:c})=>{const[d,$]=reactExports.useState([]),g=useNavigate(),b=useLocation();reactExports.useEffect(()=>{const tt=document.querySelectorAll("h1, h2, h3, h4, h5, h6"),nt=Array.from(tt).map(at=>({id:at.id,text:at.textContent||"",level:parseInt(at.tagName[1])}));$(j(nt))},[e]);const _=tt=>{const nt=document.getElementById(tt);if(nt){nt.scrollIntoView({behavior:"smooth"}),o(!1);const at=new URLSearchParams(b.search);at.set("scrollTo",tt),g(`${b.pathname}?${at.toString()}`,{replace:!0})}},j=tt=>{const nt=[],at=[];return tt.forEach(lt=>{for(;at.length>0&&lt.level<=at[at.length-1].level;)at.pop();if(at.length===0)nt.push(lt),at.push(lt);else{const mt=at[at.length-1];mt.children||(mt.children=[]),mt.children.push(lt),at.push(lt)}}),nt},_e=tt=>jsxRuntimeExports.jsx("ul",{className:"space-y-1",children:tt.map(nt=>jsxRuntimeExports.jsxs("li",{children:[jsxRuntimeExports.jsx("div",{className:`cursor-pointer hover:bg-sky-200 rounded-md transition-colors ${et(nt.level)} whitespace-normal break-words`,onClick:()=>_(nt.id),children:nt.text}),nt.children&&_e(nt.children)]},nt.id))}),et=tt=>{switch(tt){case 1:return"text-lg font-bold pl-0";case 2:return"text-base pl-4";case 3:return"text-sm pl-8";default:return"text-xs pl-12"}};return jsxRuntimeExports.jsxs("div",{className:`sticky top-4 flex flex-col items-start mr-8 mt-4 transition-all duration-300 ease-in-out bg-sky-900 z-50
        ${c?"fixed right-0 top-16":"sticky"}`,style:{width:a?c?"90vw":"30rem":"3rem",borderRadius:a?"0.75rem":"1.5rem",right:c?a?"1rem":"-2rem":void 0,top:c?"4rem":void 0,boxShadow:c&&a?"0 4px 6px rgba(0, 0, 0, 0.1)":void 0},children:[jsxRuntimeExports.jsx(Button,{variant:"default",className:`flex-shrink-0 w-12 h-12 bg-sky-900 hover:bg-sky-600 rounded-full shadow-lg focus:outline-none
          ${c?"fixed right-4 top-20 z-50":""}`,onClick:()=>o(!a),children:jsxRuntimeExports.jsx(Menu,{className:"h-4 w-4 text-white"})}),jsxRuntimeExports.jsx("div",{className:"transition-all duration-300 ease-in-out overflow-hidden",style:{maxHeight:a?c?"70vh":"calc(100vh - 8rem)":"0px",margin:a?"1rem":"0px",width:c?"100%":void 0},children:jsxRuntimeExports.jsx("div",{className:`transition-all duration-300 ease-in-out 
            ${a?"p-4 opacity-100":"p-0 opacity-0"}
            ${c?"max-h-[60vh]":""} bg-sky-100 rounded-md`,children:jsxRuntimeExports.jsx("div",{className:"overflow-y-auto",style:{maxHeight:c?"60vh":"calc(100vh - 8rem)",WebkitOverflowScrolling:"touch"},children:_e(d)})})}),c&&a&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black/30 z-40",onClick:()=>o(!1)})]})},MarkdownContent=({children:e})=>{const a=useLocation(),o=useNavigate();return reactExports.useEffect(()=>{const c=d=>{let $=d.target;for(;$&&$.tagName!=="A";)$=$.parentElement;if(($==null?void 0:$.tagName)==="A"){const g=$.getAttribute("href");if(g!=null&&g.startsWith("#")&&!g.startsWith("#/")){d.preventDefault();const b=g.slice(1),_=document.getElementById(b);if(_){_.scrollIntoView({behavior:"smooth"});const j=new URLSearchParams(a.search);j.set("scrollTo",b),o(`${a.pathname}?${j.toString()}`,{replace:!0})}}}};return document.addEventListener("click",c,!0),()=>document.removeEventListener("click",c,!0)},[a,o]),reactExports.useEffect(()=>{const d=new URLSearchParams(a.search).get("scrollTo");if(d){const $=document.getElementById(d);$&&$.scrollIntoView({behavior:"smooth"})}},[a.search]),jsxRuntimeExports.jsx("div",{className:"markdown-content",children:e})},remarkWrapSections=()=>e=>{const a=[];let o=[],c=null;const d=e;if(d.children.forEach($=>{if($.type==="heading"){const g=$;if(o.length>0){const b={type:"element",tagName:"div",properties:{className:[`section-level-${c}`]},children:o};a.push(b),o=[]}c=g.depth,o.push($)}else o.push($)}),o.length>0){const $={type:"element",tagName:"div",properties:{className:[`section-level-${c}`]},children:o};a.push($)}d.children=a},PostDetails=()=>{const{"*":e}=useParams(),{posts:a,contents:o}=usePosts(),[c,d]=reactExports.useState(void 0),[$,g]=reactExports.useState(void 0),[b,_]=reactExports.useState(!1),[j,_e]=reactExports.useState(!1),[et,tt]=reactExports.useState(!1),[nt,at]=reactExports.useState("");return reactExports.useEffect(()=>{const lt=mt=>{mt.key==="/"&&!et&&(mt.preventDefault(),tt(!0)),mt.key==="Escape"&&et&&tt(!1)};return document.addEventListener("keydown",lt),()=>document.removeEventListener("keydown",lt)},[et]),reactExports.useEffect(()=>{const lt=()=>{_e(window.innerWidth<768)};return lt(),window.addEventListener("resize",lt),()=>window.removeEventListener("resize",lt)},[]),reactExports.useEffect(()=>{if(a.length>0&&e){const lt=a.find(mt=>mt.contentKey===e);lt?(d(lt),g(o[lt.contentKey])):(console.error(`Post not found for slug: ${e}`),console.log("Available posts:",a.map(mt=>mt.contentKey)))}},[a,o,e]),!c||!$?jsxRuntimeExports.jsx("div",{className:"container mx-auto mt-10 pt-16",children:jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-sky-100",children:"404 NOT FOUND"})}):jsxRuntimeExports.jsxs("div",{className:"flex items-start relative transition-all duration-300 ease-in-out",children:[jsxRuntimeExports.jsx("div",{className:`flex-1 transition-all duration-300 ease-in-out ${j?"":b?"md:mr-[16rem]":"md:mr-[3rem]"}`,children:jsxRuntimeExports.jsxs("div",{className:`container mx-auto mt-10 p-6 bg-sky-100 rounded-lg shadow pt-16 w-3/4
          max-md:w-full max-md:mt-2 max-md:pt-20 max-md:px-3`,children:[jsxRuntimeExports.jsx("h1",{className:"text-3xl font-bold mb-4 text-sky-950",children:c.title}),jsxRuntimeExports.jsxs("div",{className:"text-sm text-sky-950 mb-4",children:[c.date," • ",c.author]}),jsxRuntimeExports.jsx(MarkdownContent,{content:$,children:jsxRuntimeExports.jsx("div",{className:"prose prose-sky max-w-full",children:jsxRuntimeExports.jsx(Markdown,{remarkPlugins:[remarkMath,remarkWrapSections],rehypePlugins:[rehypeKatex,rehypeSlug],children:$})})})]})}),jsxRuntimeExports.jsx(TableOfContents,{content:$,isOpen:b,setIsOpen:_,isMobile:j}),et&&jsxRuntimeExports.jsx(SearchModal,{searchTerm:nt,onSearchTermChange:at,onClose:()=>{tt(!1),at("")},posts:a})]})},Warp=()=>jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"mx-auto w-1/2 mt-10 p-6 bg-sky-100 rounded-lg shadow",children:jsxRuntimeExports.jsx("a",{href:"https://www.cameudis.com/",className:`font-bold mb-0.5 text-sky-900
            text-xl
            sm:text-xl
            lg:text-3xl
            `,children:"Cameudis"})}),jsxRuntimeExports.jsxs("div",{className:"mx-auto w-1/2 mt-10 p-6 bg-sky-100 rounded-lg shadow",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsx("div",{className:` rounded-full overflow-hidden
          w-8 h-8 mr-3
          sm:w-8 sm:h-8 sm:mr-3
          lg:w-16 lg:h-16 lg:mr-6
          `,children:jsxRuntimeExports.jsx("a",{href:"https://icelava.top",children:jsxRuntimeExports.jsx("img",{src:"https://icelava.top/FkLog/@icon/icelava.jpg",alt:"Circular Image",className:"w-full h-full object-cover"})})}),jsxRuntimeExports.jsx("a",{href:"https://icelava.top",className:`font-bold mb-0.5 text-sky-900
            text-xl
            sm:text-xl
            lg:text-3xl
            `,children:"IceLava Top"})]}),jsxRuntimeExports.jsx("p",{className:`mt-4 mx-1 text-sky-900 leading-7
        text-sm
        sm:text-sm
        lg:text-base
        `,children:"No Code No Life"})]}),jsxRuntimeExports.jsx("div",{className:"mx-auto w-1/2 mt-10 p-6 bg-sky-100 rounded-lg shadow",children:jsxRuntimeExports.jsx("a",{href:"https://blog.iin0.cn/",className:`font-bold mb-0.5 text-sky-900
            text-xl
            sm:text-xl
            lg:text-3xl
            `,children:"暮色音铃"})}),jsxRuntimeExports.jsx("div",{className:"mx-auto w-1/2 mt-10 p-6 bg-sky-100 rounded-lg shadow",children:jsxRuntimeExports.jsx("a",{href:"https://www.sapium.site/wordpress/",className:`font-bold mb-0.5 text-sky-900
            text-xl
            sm:text-xl
            lg:text-3xl
            `,children:"乌桕Sapium"})})]}),ImageScroller=()=>{const{fontToggle:e}=useFontToggle(),a=["xd.png","fl.png","pr.png","vs.png","blender.png","rd.png","bp.png","sai.png","au.png","pc.png","ps.png","ds.png","unity.png","vsc.png","rr.png","ae.png","mma.png","cl.png"],o=3,c=Math.ceil(a.length/o),d=Array.from({length:o},(g,b)=>a.slice(b*c,(b+1)*c)),$=e?"/ico/pixel":"/ico/common";return jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("div",{className:"overflow-hidden",children:d.map((g,b)=>jsxRuntimeExports.jsx("div",{className:`flex whitespace-nowrap my-4 ${b%2===0?"animate-scroll-left":"animate-scroll-right"}`,style:{"--animation-duration":`${300+b*5}s`},children:[...g,...g,...g,...g,...g,...g,...g,...g].map((_,j)=>jsxRuntimeExports.jsx("img",{src:`${$}/${_}`,alt:_,className:"w-40 h-40 object-cover mx-2"},j))},b))})})},Show=()=>jsxRuntimeExports.jsxs("div",{className:"container mx-auto mt-10",children:[jsxRuntimeExports.jsx("h1",{className:`font-bold mb-8 text-center text-sky-100
      text-5xl
      sm:text-5xl
      lg:text-6xl
      `,children:"This is Luna's world."}),jsxRuntimeExports.jsx(ImageScroller,{})]}),Card=({imageUrl:e,name:a,shortDescription:o,longDescription:c})=>{const[d,$]=reactExports.useState(!1),g=()=>{$(!d)};return jsxRuntimeExports.jsxs(motion.div,{className:"bg-sky-100 border border-sky-200 rounded-lg overflow-hidden shadow-md cursor-pointer transition-all duration-300 hover:bg-sky-200",onClick:g,layout:!0,children:[jsxRuntimeExports.jsx("img",{src:e,alt:a,className:"w-full h-48 object-cover rounded-t-lg"}),jsxRuntimeExports.jsxs("div",{className:"p-4",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-sky-900",children:a}),jsxRuntimeExports.jsx("p",{className:"text-sky-700 mt-1",children:o}),jsxRuntimeExports.jsx(AnimatePresence,{children:d&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"mt-4 text-sky-800",children:jsxRuntimeExports.jsx("p",{children:c})})})]})]})},Magic=()=>{const e=[{imageUrl:"/assets/magic/Dice.jpg",name:"打扁骰子",shortDescription:"打扁骰子123456",longDescription:"打扁骰子123456789123456789"},{imageUrl:"/assets/magic/Handcuff.jpg",name:"千里眼1",shortDescription:"千里眼123455678",longDescription:"千里眼1123145468794651231"},{imageUrl:"/assets/magic/SeeThrough.jpg",name:"逃脱手铐",shortDescription:"逃脱手铐12654",longDescription:"逃脱手铐45645498465123"}];return jsxRuntimeExports.jsx("div",{className:"container mx-auto p-4",children:jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:e.map((a,o)=>jsxRuntimeExports.jsx(Card,{imageUrl:a.imageUrl,name:a.name,shortDescription:a.shortDescription,longDescription:a.longDescription},o))})})};function App(){return jsxRuntimeExports.jsx(FontToggleProvider,{children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col w-screen min-h-screen bg-sky-600",children:[jsxRuntimeExports.jsx(Navbar,{}),jsxRuntimeExports.jsx("main",{className:"flex-grow",children:jsxRuntimeExports.jsxs(Routes,{children:[jsxRuntimeExports.jsx(Route,{path:"/",element:jsxRuntimeExports.jsx(Home,{})}),jsxRuntimeExports.jsx(Route,{path:"/warp",element:jsxRuntimeExports.jsx(Warp,{})}),jsxRuntimeExports.jsx(Route,{path:"/show",element:jsxRuntimeExports.jsx(Show,{})}),jsxRuntimeExports.jsx(Route,{path:"/about",element:jsxRuntimeExports.jsx(About,{})}),jsxRuntimeExports.jsx(Route,{path:"/posts/*",element:jsxRuntimeExports.jsx(PostDetails,{})})," ",jsxRuntimeExports.jsx(Route,{path:"/magic",element:jsxRuntimeExports.jsx(Magic,{})})]})}),jsxRuntimeExports.jsx(Footer,{})]})})}client.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React.StrictMode,{children:jsxRuntimeExports.jsx(HashRouter,{children:jsxRuntimeExports.jsx(App,{})})}));
